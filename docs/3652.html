<html>
<head>
<title>Angular Offline Capability: Service Worker And PWA</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度离线能力:服务人员和 PWA</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/angular-offline-capability-service-worker-and-pwa-12b94ebbb141?source=collection_archive---------0-----------------------#2021-06-18">https://medium.com/nerd-for-tech/angular-offline-capability-service-worker-and-pwa-12b94ebbb141?source=collection_archive---------0-----------------------#2021-06-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="037a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，离线能力是市场上的一个新的大事件。越来越多的开发者致力于为用户提供离线功能的应用。有了 Angular Service Worker 和 Angular CLI 内置的 PWA 支持，现在让我们的 web 应用程序可以下载和安装比以往任何时候都简单，就像一个本地移动应用程序一样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/823a892bef5ea62086cbb697bf1977f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xC6OUuV4CZIk9_P_O8zwxQ.jpeg"/></div></div></figure><h1 id="6883" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">什么是 PWA </strong></h1><p id="bc83" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">渐进式 web 应用程序(PWA)是一种通过 Web 交付的应用软件，使用 HTML、CSS 和 JavaScript 构建。它适用于任何使用符合标准的浏览器的平台。</p><p id="212f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在内部，PWA 使用服务工作者浏览器 API 来提供对一些本机功能的访问。此外，它给你一个类似应用程序的感觉。缓存存储是一个非常棒的特性，可以帮助大幅缩短页面加载时间</p><h1 id="2e01" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是服务人员</h1><p id="2def" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">服务人员是您的浏览器在后台运行的脚本，独立于网页，为不需要网页或用户交互的功能打开了大门。如今，它们已经包括了像<a class="ae ks" href="https://developers.google.com/web/updates/2015/03/push-notifications-on-the-open-web" rel="noopener ugc nofollow" target="_blank">推送通知</a>和<a class="ae ks" href="https://developers.google.com/web/updates/2015/12/background-sync" rel="noopener ugc nofollow" target="_blank">后台同步</a>这样的功能。核心特性是拦截和处理网络请求的能力，包括以编程方式管理响应缓存。</p><h1 id="1385" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><p id="e3b2" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">要使用 Angular service worker 的所有功能，请使用 Angular 和 Angular CLI 的最新版本。</p><p id="ae35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了注册服务人员，应用程序必须通过 HTTPS 访问，而不是 HTTP。浏览器会忽略通过不安全连接提供服务的页面上的服务人员。原因是服务工作者非常强大，所以需要格外小心以确保服务工作者脚本没有被篡改。</p><p id="9c48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个规则有一个例外:为了使本地开发更容易，浏览器在访问<code class="du ku kv kw kx b">localhost</code>上的应用程序时<em class="kt">不</em>要求安全连接。</p><p id="e74c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们开始在我们的 angular 应用程序中实现 Service worker 和 PWA。</p><blockquote class="ky kz la"><p id="c946" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">步骤 1:创建角度应用</strong></p></blockquote><p id="3a54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果在现有的角度应用程序上实现，可以跳过此步骤。我们将使用角度 CLI。</p><pre class="je jf jg jh fd le kx lf lg aw lh bi"><span id="2a39" class="li jq hi kx b fi lj lk l ll lm">ng new angular-pwa</span></pre><p id="c376" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述命令将在<code class="du ku kv kw kx b">angular-pwa</code>文件夹中创建一个脚手架角度应用程序。让我们导航到<code class="du ku kv kw kx b">angular-pwa</code>文件夹</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/73f318d3a96f9381850197748199e5e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_PShj44Sic5Qqroe-VNECQ.png"/></div></div></figure><blockquote class="ky kz la"><p id="c5a9" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">第二步:添加 PWA 包</strong></p></blockquote><p id="2296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该命令会触发添加和修改多个文件的原理图。它负责通过添加<code class="du ku kv kw kx b">service-worker</code>包以及设置必要的支持文件来配置您的应用程序以使用服务工作者</p><pre class="je jf jg jh fd le kx lf lg aw lh bi"><span id="7cb2" class="li jq hi kx b fi lj lk l ll lm">ng add @angular/pwa</span></pre><p id="adcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述命令完成以下操作:</p><ol class=""><li id="083c" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc lt lu lv lw bi translated">将<code class="du ku kv kw kx b">@angular/service-worker</code>包添加到项目中。</li><li id="6e52" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">支持服务人员在 CLI 中构建支持。</li><li id="3d96" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">在应用程序模块中导入并注册服务工作者。</li><li id="62f3" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">安装图标文件以支持已安装的渐进式 Web 应用程序(PWA)。</li><li id="4c77" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">创建名为<code class="du ku kv kw kx b"><a class="ae ks" href="https://angular.io/guide/service-worker-config" rel="noopener ugc nofollow" target="_blank">ngsw-config.json</a></code>的服务工作器配置文件，该文件指定缓存行为和其他设置。</li><li id="4aa9" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">更新<code class="du ku kv kw kx b">index.html</code>文件:</li></ol><ul class=""><li id="a267" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc mc lu lv lw bi translated">包括添加<code class="du ku kv kw kx b">manifest.webmanifest</code>文件的链接。</li><li id="5482" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc mc lu lv lw bi translated">为<code class="du ku kv kw kx b">theme-color</code>添加 meta 标签。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es md"><img src="../Images/eec2a7b1552f5c0a3797139abcfb9994.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*8ylSPhOrEhjH_BLwuOMDQw.png"/></div></figure><blockquote class="ky kz la"><p id="ce7d" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">步骤 3:创建构建</strong></p></blockquote><p id="e3c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这需要一点时间，但是过一会儿，我们将在<code class="du ku kv kw kx b">dist</code>文件夹中提供我们的应用程序构建。</p><pre class="je jf jg jh fd le kx lf lg aw lh bi"><span id="c631" class="li jq hi kx b fi lj lk l ll lm">ng build --prod</span></pre><p id="ed5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看在我们的构建文件夹中有什么，这里是生成的大多数文件:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/911de19f6bcaeb97c421d190dabad3c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*AXp7tSqLpt3ewALLY1hzKw.png"/></div></figure><blockquote class="ky kz la"><p id="6162" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">步骤 4:运行角度 PWA 应用</strong></p></blockquote><p id="efbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为<code class="du ku kv kw kx b">ng serve</code>不与服务工作者一起工作，所以您必须使用一个单独的 HTTP 服务器来本地运行您的项目的 PWA 功能。您可以使用任何 HTTP 服务器。下面的例子使用了来自 npm 的<a class="ae ks" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank"> http-server </a>包。</p><p id="cc3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">全局安装 http-server(<a class="ae ks" href="https://www.npmjs.com/package/http-server" rel="noopener ugc nofollow" target="_blank">链接</a>)</p><pre class="je jf jg jh fd le kx lf lg aw lh bi"><span id="34c0" class="li jq hi kx b fi lj lk l ll lm">npm install -g http-server</span></pre><p id="0683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用<code class="du ku kv kw kx b">http-server</code>提供包含 web 文件的目录，请运行以下命令:</p><pre class="je jf jg jh fd le kx lf lg aw lh bi"><span id="3046" class="li jq hi kx b fi lj lk l ll lm">http-server -p 8080 -c-1 dist/angular-pwa</span></pre><p id="217f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">-c-1</code>选项将禁用服务器缓存，一个服务器将在端口<code class="du ku kv kw kx b">8080</code>上运行，为应用程序的生产版本提供服务。如果端口<code class="du ku kv kw kx b">8080</code>繁忙，那么您可以更改为任何端口号。</p><blockquote class="ky kz la"><p id="aaf4" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">步骤 5:测试角度 PWA 应用</strong></p></blockquote><p id="1ef5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在服务器运行的情况下，可以将浏览器指向<a class="ae ks" href="http://localhost:8080/." rel="noopener ugc nofollow" target="_blank"> http://localhost:8080/。您的应用程序应该可以正常加载。</a></p><p id="fb28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提示:在测试 Angular 服务人员时，在浏览器中使用匿名或私人窗口是一个好主意，以确保服务人员不会从以前的剩余状态读取数据，这可能会导致意外行为。</p><p id="6d9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您的浏览器开发工具应该已经安装了服务人员</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/14ac1b79563601730106a3b572b38f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0MzSOKIisKG3iH7Lez7Eaw.png"/></div></div></figure><p id="e056" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将网络设置更改为脱机</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/8563f38470e5ae0f71e36f6ad794a0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h7T4gg3TeWgus_JkwE0k4g.png"/></div></div></figure><p id="bb67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在刷新应用程序，应用程序将在没有网络连接的情况下再次加载</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mh"><img src="../Images/64c682bb48e073dcb565931e55c1d898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cznAXzSgr_D2omJAQmkn-g.png"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">离线模式下的网络日志</figcaption></figure><blockquote class="ky kz la"><p id="bf5b" class="if ig kt ih b ii ij ik il im in io ip lb ir is it lc iv iw ix ld iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p></blockquote><p id="1631" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们已经学会了在任何角度应用程序上构建离线功能和 PWA 功能。感谢阅读:)</p><p id="3b5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章，请按👏鼓掌按钮 1000 次或你想要多少次。如果你有任何问题，请随意提问。非常感谢你的阅读！</p><h1 id="f2b5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在你走之前</h1><p id="6777" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><strong class="ih hj"> <em class="kt">感谢</em> </strong> <em class="kt">的阅读！如果你想与我取得联系，请随时联系我在 gauravrathee0@gmail.com 或我的</em> <a class="ae ks" href="https://www.linkedin.com/in/gaurav-rathee-5b4253b7/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="kt"> LinkedIn 简介</em> </strong> </a> <em class="kt">。还有，随意探索</em> <strong class="ih hj"> <em class="kt">我的简介</em> </strong> <em class="kt">阅读不同的文章。</em></p></div></div>    
</body>
</html>