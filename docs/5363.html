<html>
<head>
<title>Useful Extensions Or Simple DSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有用的扩展或简单的DSL</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/useful-extensions-or-simple-dsl-23d594af29bb?source=collection_archive---------10-----------------------#2021-09-22">https://medium.com/nerd-for-tech/useful-extensions-or-simple-dsl-23d594af29bb?source=collection_archive---------10-----------------------#2021-09-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="299f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将考虑一些有用的扩展，允许创建某种DSL…</p><p id="9daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在C#中从开始。NET 2.0有一些漂亮的构造。其中之一，我可以说字符串上的静态方法，即:<a class="ae jd" href="https://docs.microsoft.com/en-us/dotnet/api/system.string.isnullorempty?view=net-5.0" rel="noopener ugc nofollow" target="_blank">字符串。IsNullOrEmpty </a>。对不起<a class="ae jd" href="https://docs.microsoft.com/en-us/dotnet/api/system.string.empty?view=net-5.0" rel="noopener ugc nofollow" target="_blank">弦。Empty </a>返回空常量字符串:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="2f7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哇，以前我不得不声明empty为计算属性，很难相信empty会被编译一次。显然，String是一种结构，在foundational framework中声明，可以在库外扩展，所以我假设它是一个模块级的“常量”。</p><p id="a00b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们考虑一些可选类型的有用扩展:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div></figure><p id="825c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以使用一种新的方式，而不是与nil进行比较，或者使用合并运算符:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="6c60" class="jq jr hi jm b fi js jt l ju jv">var item: Any? <br/>let oldWay1 = item != nil<br/>let newWay1 = item.hasValue // new way instead of !=<br/>assert(oldWay1 == newWay1)</span><span id="5147" class="jq jr hi jm b fi jw jt l ju jv">var str: String?</span><span id="4cdf" class="jq jr hi jm b fi jw jt l ju jv">let str1 = str ?? "item not a String"<br/>let str2 = str.valueOrDefault("item not a String") //str.valueOrEmpty == str ?? ""<br/>assert(str1 == str2)</span><span id="6c75" class="jq jr hi jm b fi jw jt l ju jv">The issue with Swift 5.5 compiler is that long complex impressions might need brackets.</span><span id="b70b" class="jq jr hi jm b fi jw jt l ju jv">For instance <strong class="jm hj">items?.first?.description?.valueOrEmpty</strong> - isn't compiled. Placing inside brackets makes code compilable.</span><span id="0cad" class="jq jr hi jm b fi jw jt l ju jv">let description = items?.first?.description<br/>description.valueOrEmpty - is OK.<br/>(<strong class="jm hj">items?.first?.description).valueOrEmpty - </strong>is also fine.</span></pre><p id="36bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在允许避免打字错误的语言中出现<strong class="ih hj">关键路径</strong>:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="aef1" class="jq jr hi jm b fi js jt l ju jv">NSExpression(format: "flag")<br/>NSExpression(forKeyPath: \CheckItem.flag) // better than 1st variant</span></pre><p id="c3a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是并不是所有情况下都支持key path，例如在<strong class="ih hj">n predicate</strong>构造函数方法中。但至少我们可以检查聊天键路径是否可用，即使不使用它:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="9c31" class="jq jr hi jm b fi js jt l ju jv">NSExpression(format: "country.address.firstLine == %@", "Line")<br/>_ = \Destination.country.address.firstLine // will be checked by compiler &amp; raise compile error</span></pre><p id="90df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">顺便说一下，一些简化可以使用可选的<strong class="ih hj"> map &amp; flatMap </strong>方法存档:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jj jk l"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">Optional.flatMap的用法</figcaption></figure></div></div>    
</body>
</html>