<html>
<head>
<title>Web Cookies 101</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">网络 Cookies 101</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/browser-cookies-101-e8b4c2484e1?source=collection_archive---------16-----------------------#2021-03-11">https://medium.com/nerd-for-tech/browser-cookies-101-e8b4c2484e1?source=collection_archive---------16-----------------------#2021-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4b69" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">介绍和实施</h2></div><p id="3c72" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建 web 应用程序时，不可避免地会遇到… <strong class="iz hj"> <em class="jt"> cookies </em> </strong>。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ju"><img src="../Images/e86781467b1805840c164b0b8370359b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nfqx72n_AZL5MshqqbnjoA.jpeg"/></div></div></figure><h1 id="3264" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">介绍</h1><p id="04ed" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">web cookie(也称为<em class="jt"> http cookie </em>或<em class="jt">浏览器 cookie </em>)只是一个文本文件。当用户导航到一个网站时，浏览器向服务器请求一段数据。作为响应，服务器发送数据——一个很小的文件，是一串文本。这一小块数据然后被存储在浏览器的内存中，允许它记住有状态的信息。例如，当用户导航到其他网站时，它能够从第一次登录和后续操作中识别用户。</p><p id="26a7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将网络 cookiess 与网上购物联系起来，对理解网络 cookie 非常有帮助。Web cookies 有助于记住用户提供的任意信息，如输入表单字段的用户名、密码、地址和借记卡信息。Cookies 可以解决一些问题，例如将用户与他们在访问购物网站的不同页面时所采取的行动联系起来。如果没有 cookies，用户每次访问网站或新页面时都必须“介绍”自己。很明显，cookies 可以通过消除多余的动作来实现更无缝的交互，从而改善用户体验。</p><p id="480c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">值得注意的是，有不同类型的网络 cookies。三种常见的 cookie 是“会话”、“持久”和“第三方”cookie。只有当用户当前登录到一个网站并且他们的浏览器主动打开时，会话 cookies 才存在。通常，一旦用户关闭浏览器，会话 cookies 就会被删除。相反，持久 cookies 会存在一段预定的时间，或者直到指定的某个日期。第三方 cookies 允许跨多个域或网站跟踪用户。当用户在当前页面时，这些 cookies 引用并来自其他网站。第三方 cookies 最适用的用例之一是定向广告。</p><h1 id="6dd0" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">实现 Cookies</h1><h2 id="4d29" class="ld kh hi bd ki le lf lg km lh li lj kq jg lk ll ks jk lm ln ku jo lo lp kw lq bi translated">创建 Cookies 服务器端</h2><p id="041d" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">创建 cookie 时，服务器可以将一个<code class="du lr ls lt lu b">Set-Cookie</code>头和 HTTP 响应一起发送给客户机。这个头将通知浏览器创建和存储 cookie。当创建额外的 HTTP 请求时，浏览器将自动包含<code class="du lr ls lt lu b">Cookie</code>头。</p><p id="13f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通用 cookie 语法示例:</p><p id="4b96" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: key=value;</code></p><p id="6fb8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Node.js，cookie 语法示例:</p><p id="f50c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">response.setHeader('Set-Cookie', 'key=value');</code></p><p id="9664" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的值是一个字符串或一个字符串数组，其中包含与同一个 cookie 相关联的值:<code class="du lr ls lt lu b">response.setHeader('Set-Cookie', ['id=1', 'name=Diogenis']);</code>要删除一个 cookie，您可以使用以下方法:</p><ul class=""><li id="1bb1" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">将<code class="du lr ls lt lu b">Expires</code>标志设置为过去的日期</li><li id="3762" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">将<code class="du lr ls lt lu b">Max-Age</code>标志设置为<code class="du lr ls lt lu b">0</code></li><li id="ac10" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">利用带有上述 cookie 标志的 ExpressJS <code class="du lr ls lt lu b">clearCookie()</code>方法</li></ul><h2 id="b957" class="ld kh hi bd ki le lf lg km lh li lj kq jg lk ll ks jk lm ln ku jo lo lp kw lq bi translated">设置 Cookies 客户端</h2><p id="bca8" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">也可以通过访问 Javascript 对象<code class="du lr ls lt lu b">Document.cookie</code>在客户端创建 Cookies。</p><p id="dec3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了创建一个客户端 cookie，类似于上面的 NodeJS 示例，您可以将一个值和任何适用的标志作为一个字符串传入:<code class="du lr ls lt lu b">document.cookie = “name=Diogenis”;</code></p><p id="dd8c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要访问 cookie，您可以直接从对象中读取:</p><ul class=""><li id="a115" class="lv lw hi iz b ja jb jd je jg lx jk ly jo lz js ma mb mc md bi translated">输入:<code class="du lr ls lt lu b">console.log(document.cookie);</code></li><li id="6a7e" class="lv lw hi iz b ja me jd mf jg mg jk mh jo mi js ma mb mc md bi translated">输出:<code class="du lr ls lt lu b">“name=Diogenis”</code></li></ul><p id="2554" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了删除 cookie，将值改写为空，并设置一个过去的到期数据:<code class="du lr ls lt lu b">document.cookie = “name=; expires=Mon, 20 Dec 1920 00:00:00 UTC;”;</code></p><h1 id="afdc" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">Cookie 标志</h1><p id="94b5" class="pw-post-body-paragraph ix iy hi iz b ja ky ij jc jd kz im jf jg la ji jj jk lb jm jn jo lc jq jr js hb bi translated">可以将附加标志传递到 cookies 中，以增加数据的特异性。</p><p id="5fd7" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Expires</code>和<code class="du lr ls lt lu b">Max-Age</code></p><p id="da8a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了构建持久 cookie，需要设置一个截止日期。这可以通过特定的日期和<code class="du lr ls lt lu b">Expires</code>标志来实现，或者通过<code class="du lr ls lt lu b">Max-Age</code>标签来实现特定的时间长度。</p><p id="faf1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=2; Expires=Monday, 20 Jan 2021 00:00:00 GMT;</code></p><p id="f96d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=2; Max-Age=58162000;</code></p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="8a05" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Domain</code>和<code class="du lr ls lt lu b">Path</code></p><p id="6663" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Domain</code>和<code class="du lr ls lt lu b">Path</code>标志决定了 cookie 的作用域和可访问域。<code class="du lr ls lt lu b">Domain</code>指定允许的主机，包括子域。如果没有此标志，默认行为只允许当前站点的主机，不包括子域。<code class="du lr ls lt lu b">Path</code>标志指定了一个 URL 路径，该路径必须包含在所请求的 URL 中，以便允许 cookie 与 HTTP 请求一起发送。设置标志时，使用正斜杠，将包括子目录。</p><p id="b7c0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Path=/page</code>也会允许<code class="du lr ls lt lu b">Path=/page/1</code>和<code class="du lr ls lt lu b">Path=/page/1/custom</code></p><p id="0463" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=1; Path=/custom;</code></p><p id="bf69" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=1; Domain: github.com;</code></p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="ef6d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Secure</code>和<code class="du lr ls lt lu b">HttpOnly</code></p><p id="3aa5" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在通过 HTTPS 协议发送到服务器的加密请求中，cookies 可以包含<code class="du lr ls lt lu b">Secure</code>标志。cookie 本身是不安全的，敏感信息不应该存储在 cookie 中。一些浏览器(Chrome、Firefox 等。)已经开始阻止不安全的站点设置带有<code class="du lr ls lt lu b">Secure</code>标志的 cookies。</p><p id="6ffe" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Cookies 也可以设置<code class="du lr ls lt lu b">HttpOnly</code>标志。这可以防止在 Javascript 的文档对象中访问 cookiescookies 将只发送到服务器。对于只需要保存服务器端会话信息的 cookies，应该使用下面的标志。</p><p id="5c99" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=1; Secure; HttpOnly;</code></p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="b950" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">SameSite</code></p><p id="b305" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于安全原因，为了防止 cookies 接收跨站点请求，可以设置<code class="du lr ls lt lu b">SameSite</code>标志。它可以遵循以下属性:<code class="du lr ls lt lu b">None</code>、<code class="du lr ls lt lu b">Lax</code>或<code class="du lr ls lt lu b">Strict</code>(不区分大小写)。允许在同一个站点或跨站点发送 cookies。<code class="du lr ls lt lu b">Lax</code>当客户端从外部站点导航到该域时，将允许发送 cookies。<code class="du lr ls lt lu b">Strict</code>只允许浏览器发送相同站点请求的 cookies。在所有其他情况下，跨站点子请求会保留 cookies。通常，<code class="du lr ls lt lu b">Lax</code>被用作浏览器默认值。</p><p id="04ff" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">Set-Cookie: id=1; SameSite=Strict;</code></p></div></div>    
</body>
</html>