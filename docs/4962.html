<html>
<head>
<title>Maven with Github Actions and Packages — A CI ✅ Read</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Maven 的 Github 操作和包——✅的一篇文章</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/maven-with-github-actions-and-packages-a-ci-read-b968173b018f?source=collection_archive---------2-----------------------#2021-08-17">https://medium.com/nerd-for-tech/maven-with-github-actions-and-packages-a-ci-read-b968173b018f?source=collection_archive---------2-----------------------#2021-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9d29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> GitHub 动作</strong>🎬是一项免费使用的服务🤖您的 CI/CD 工作流程直接从 GitHub 控制台开始。</p><p id="9bac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> GitHub 包</strong>📦是一个托管工件存储库，用于存储和共享您的代码二进制文件⏩甚至是码头工人的照片。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8b59baf465ab86afba9030530365734d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*m9hAxjphNBOk3eBA.png"/></div></div></figure><blockquote class="jp"><p id="6289" class="jq jr hi bd js jt ju jv jw jx jy jc dx translated">我们将深入一个为 Java/Spring 应用程序设置 Maven build 的例子。</p></blockquote><blockquote class="jz ka kb"><p id="6fb9" class="if ig kc ih b ii kd ik il im ke io ip kf kg is it kh ki iw ix kj kk ja jb jc hb bi translated"><em class="hi"> PS:如果你对使用 Heroku </em>  <em class="hi">的</em> <strong class="ih hj"> <em class="hi"> CD 感兴趣，可以看看我之前的文章——《Heroku 云上的</em><a class="ae kl" rel="noopener" href="/nerd-for-tech/spring-app-on-heroku-cloud-with-continuous-deployment-328ff8fbfe7a">Spring app</a><em class="hi">。</em></strong></p></blockquote></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><p id="b9b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要建立一个 GitHub 工作流，你只需要定义一个<strong class="ih hj">触发点</strong>和一个必须运行的<strong class="ih hj">作业</strong>。</p><p id="e949" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，要设置 GitHub 操作，导航到 GitHub 存储库的“操作”标签→“新建工作流”→“自己设置工作流”。</p><p id="720f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将打开一个 YML 文件，我们可以用它来定义 GitHub 动作定义。</p></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><h1 id="a396" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">—第一部分:触发器</h1><p id="c3eb" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">第一部分定义了“当”——即<a class="ae kl" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#on" rel="noopener ugc nofollow" target="_blank">的触发点</a>。</p><p id="57f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个例子，我们将把触发条件定义为“推”到“主”分支，如下所示。</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="77e0" class="mb ku hi lx b fi mc md l me mf">name: My project build  <br/>on:   <br/>    push:<br/>    branches: <br/>        [ main ]</span></pre><blockquote class="jz ka kb"><p id="e966" class="if ig kc ih b ii ij ik il im in io ip kf ir is it kh iv iw ix kj iz ja jb jc hb bi translated">除了推送事件之外，您还可以配置工作流，以便在推送特定的文件夹/glob 模式、拉取请求或 corn 时触发。</p></blockquote></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><h1 id="a889" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">第二部分:行动</h1><p id="c4a0" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">这里是我们定义“<a class="ae kl" href="https://docs.github.com/en/actions/learn-github-actions/introduction-to-github-actions#the-components-of-github-actions" rel="noopener ugc nofollow" target="_blank">什么</a>部分的地方。用 DevOps 的术语来说，它相当于作业/管道阶段。</p><p id="338a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们需要用一个跑步者来定义一个“作业”。GitHub 官方支持几个<a class="ae kl" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions#github-hosted-runners" rel="noopener ugc nofollow" target="_blank">托管的跑步者</a>。</p><blockquote class="jp"><p id="5666" class="jq jr hi bd js jt mg mh mi mj mk jc dx translated">每个触发器创建一个用于运行作业中的步骤的一次性容器。</p></blockquote><pre class="ml mm mn mo mp lw lx ly lz aw ma bi"><span id="7815" class="mb ku hi lx b fi mc md l me mf">jobs:<br/>   build:<br/>     runs-on: ubuntu-latest<br/>     steps:</span></pre><p id="e29b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作是一系列步骤的集合。每个步骤可以是一个 shell 命令，也可以是一个“动作”。</p><blockquote class="jz ka kb"><p id="fbeb" class="if ig kc ih b ii ij ik il im in io ip kf ir is it kh iv iw ix kj iz ja jb jc hb bi translated">社区中有许多预置的“动作”可用，例如，要在容器中设置<strong class="ih hj"> java 和 maven </strong>，我们可以使用<a class="ae kl" href="https://github.com/actions/setup-java" rel="noopener ugc nofollow" target="_blank"> setup-java </a>。</p></blockquote><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="1473" class="mb ku hi lx b fi mc md l me mf">     - name: Set up JDK 11<br/>       uses: actions/setup-java@v2<br/>       with:<br/>         java-version: '11'<br/>         distribution: 'adopt'<br/>         server-id: github<br/>         settings-path: ${{ github.workspace }}</span></pre></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><h1 id="ea86" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">—第三部分:构建</h1><p id="1518" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated">这是最后一步，我们为要发布的二进制文件指定<a class="ae kl" href="https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-apache-maven-registry#publishing-a-package" rel="noopener ugc nofollow" target="_blank"> Github 包注册表</a>。</p><p id="ac49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们使用的是 maven，pom 中的以下条目定义了目标。</p><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="efb1" class="mb ku hi lx b fi mc md l me mf">&lt;distributionManagement&gt;<br/>    &lt;repository&gt;<br/>      &lt;id&gt;github&lt;/id&gt;<br/>      &lt;name&gt;GitHub Packages&lt;/name&gt;<br/>      &lt;url&gt;https://maven.pkg.github.com/OWNER/REPOSITORY&lt;/url&gt;<br/>    &lt;/repository&gt;<br/>&lt;/distributionManagement&gt;</span></pre><p id="fe24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，运行 maven deploy 应该会将二进制文件发布到 GitHub 包中。</p><blockquote class="jz ka kb"><p id="13f9" class="if ig kc ih b ii ij ik il im in io ip kf ir is it kh iv iw ix kj iz ja jb jc hb bi translated">请注意，您也可以在这里使用 maven 发布目标。</p></blockquote><pre class="je jf jg jh fd lw lx ly lz aw ma bi"><span id="0637" class="mb ku hi lx b fi mc md l me mf">     - name: Publish to GitHub Packages Apache Maven<br/>       run: mvn deploy -s $GITHUB_WORKSPACE/settings.xml<br/>       env:<br/>         GITHUB_TOKEN: ${{ github.token }}</span></pre></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><h1 id="ff2e" class="kt ku hi bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq bi translated">例子</h1><h2 id="f645" class="mb ku hi bd kv mq mr ms kz mt mu mv ld iq mw mx lh iu my mz ll iy na nb lp nc bi translated">以下存储库是上述设置的一个示例。</h2><p id="42e2" class="pw-post-body-paragraph if ig hi ih b ii lr ik il im ls io ip iq lt is it iu lu iw ix iy lv ja jb jc hb bi translated"><a class="ae kl" href="https://github.com/arjunchakri/sherlock-heroku-poc/actions" rel="noopener ugc nofollow" target="_blank">阿尔琼恰克里/夏洛克-埃罗库-poc </a></p><p id="78bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作流文件→ <em class="kc">。github/workflows/maven-publish . yml</em></p></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><p id="139e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi nd translated">现在，我们已经成功整合了 GH 行动🎉！！<br/>每一次代码更改都会构建一个新的二进制文件并发布到 GitHub 包中！！</p></div></div>    
</body>
</html>