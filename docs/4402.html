<html>
<head>
<title>Extract JSONs like a pro with Chompjs and JMESPath</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">像专业人员一样用Chompjs和JMESPath提取JSONs</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/extract-jsons-like-a-pro-with-chompjs-and-jmespath-74e97429cc8a?source=collection_archive---------20-----------------------#2021-07-19">https://medium.com/nerd-for-tech/extract-jsons-like-a-pro-with-chompjs-and-jmespath-74e97429cc8a?source=collection_archive---------20-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/69ab2af7026f82322b20fa6c9b4ab656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2Wrv0oyYTkTSz4q1.png"/></div></div></figure><p id="27ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于任何web数据提取开发人员来说，处理javascript对象都是一项重要的技能。在处理动态页面时，您可能只是刚刚开始涉足这个领域，但是您很快就会发现<script>标记是获取一般数据的好方法。开始时，从javascript代码块中的这些嵌套字典中获取数据似乎令人望而生畏，但是，我将向您介绍两个包，我用它们来使从这些字典中获取信息变得轻而易举！&lt;/root&gt;</script></p><h1 id="cf48" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用chompjs库解析脚本文本</h1><p id="bf89" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">因此，让我们假设您已经从脚本标记中提取了这段文本</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="1d30" class="la jp hi kw b fi lb lc l ld le">__DATA__ = {"data":{"type":"@products", "products":[{"id":12345678, "name":"Bacon", "brand": "Some Brand", "price":2.50, "instock": false},{"id":12345679, "name":"Ham", "price":3.50, "instock": true},{"id":12345680, "name":"Beef", "price":1.50, "instock": false}]}}; some_javascript(data) {results = do_stuff(data); return results}; new beep_boop_js_var = some_javascript(__DATA__)</span></pre><p id="3051" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段文字有很多你不想要的元素，但它也有，看起来很像python字典，包含很多产品的数据。这是一个javascript对象。通常你会有一个JSON包来帮助你把它变成一个字典。但是当它不是一个干净的JSON时你会怎么做呢？在这种情况下，Zytan Mariusz Obajtek制作了一个包来帮助我们:<a class="ae lf" href="https://github.com/Nykakin/chompjs" rel="noopener ugc nofollow" target="_blank"> chompjs </a>。</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="a0b6" class="la jp hi kw b fi lb lc l ld le">from chompjs import parse_js_object <br/>script = """__DATA__ = {"data":{"type":"@products", "products":[{"id":12345678, "name":"Bacon", "brand": "Some Brand", "price":2.50, "instock": false},{"id":12345679, "name":"Ham", "price":3.50, "instock": true},{"id":12345680, "name":"Beef", "price":1.50, "instock": false}]}}; <br/>some_javascript(data) {results = do_stuff(data); return results}; new beep_boop_js_var = some_javascript(__DATA__)""" </span><span id="bc6e" class="la jp hi kw b fi lg lc l ld le">data = parse_js_object(script)</span></pre><p id="99bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这种情况下，parse_js_object函数在脚本中查找第一个js对象，提取它，然后将其转换为python字典。这只是chompjs的冰山一角，查看Github上的例子，看看其他更难的格式，用它可以很容易地解析。</p><h1 id="81cc" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用JMESPath提取数据</h1><p id="dba9" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">那么，现在你有了字典，从字典中获取数据的最好方法是什么呢？使用嵌套字典，挑选您需要的字段可能会很麻烦，但是您可以通过使用另一个包来使它变得容易得多:<a class="ae lf" href="https://github.com/jmespath/jmespath.py" rel="noopener ugc nofollow" target="_blank"> JMESPath </a>。</p><p id="5153" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如果您想从字典中获取产品列表，您可以通过一个函数调用来实现:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="5ecb" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products', data)</span></pre><p id="c4f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它不止于此。让我们更进一步，假设您想要产品的名称？您可以:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="9430" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[].name', data)</span></pre><p id="3adc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此处的更改表明我想浏览产品列表并拉出名称字段，这将留给我一个产品名称列表。现在，虽然这已经非常有用，我们可以更深入一点。</p><p id="8e7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设您只想要这些产品中的一种产品的名称，即“培根”。实际上，我们可以在方括号中输入一个查询来过滤我们的结果:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="e46b" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[?name==`Bacon`]', data)</span></pre><p id="1626" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">和前面一样，我们也可以拉出一个特定的字段:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="5307" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[?name==`Bacon`].price', data)</span></pre><p id="ee52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们做一些更有趣的事情。比方说，我想找到超过一定价格的产品。嗯，我也可以在这些括号里做其他种类的条件句:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="b274" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[?price&gt;`2`], data)</span></pre><p id="9039" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能已经注意到，只有一件商品有品牌，所以如果我执行以下操作，它将只给出该商品的品牌名称。在这种情况下要小心，如果有不完整的结果，您将不知道这些数据实际上来自哪个字典:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="8f56" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[].brand', data)</span></pre><p id="0290" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您可能已经注意到我们示例中的instock字段有一个布尔值，所以如果我们只想获得所有库存商品的名称，我们可以这样做:</p><pre class="kr ks kt ku fd kv kw kx ky aw kz bi"><span id="6e8c" class="la jp hi kw b fi lb lc l ld le">jmespath.search('data.products[?instock].name', data)</span></pre><h1 id="8112" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="1d08" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这两个包可能是我在提取web数据时使用的两个比较重要的包。许多站点通常会在源代码中使用标准的JSON或js脚本，chompjs可以为您提取这些脚本。对于这些情况以及大多数API响应，您可能最终会得到嵌套的字典，JMESPath使筛选变得轻而易举。</p><p id="dbf0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想看这些措施的视频，请查看我在Youtube上的视频。</p><p id="d030" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看其他用于解析HTML和提取数据的有用开源包:</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><p id="173e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lo">最初发表于</em><a class="ae lf" href="https://www.zyte.com/blog/extract-json-using-chompjs-and-jmespath/" rel="noopener ugc nofollow" target="_blank">T5【https://www.zyte.com】</a><em class="lo">。</em></p></div></div>    
</body>
</html>