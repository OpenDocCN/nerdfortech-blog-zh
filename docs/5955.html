<html>
<head>
<title>Guide to JNI (Java Native Interface)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JNI指南(Java本地接口)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/guide-to-jni-java-native-interface-5b63fea01828?source=collection_archive---------2-----------------------#2021-12-11">https://medium.com/nerd-for-tech/guide-to-jni-java-native-interface-5b63fea01828?source=collection_archive---------2-----------------------#2021-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0dcb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有没有想过“我们可以从Java代码中调用C/C++代码吗？”是的，我们可以使用JNI，一个由JVM提供的接口，让你的java代码调用本地C/C++代码。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e7970a9f42b592901515864ba56f440c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4kXxTeJmwB7_etBymMahQ.jpeg"/></div></div></figure><p id="3065" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我发现我的朋友在JNI实习，并被它所提供的价值深深吸引。价值？我们究竟为什么需要在Java代码中调用C/C++代码？</p><p id="6921" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们都知道Java是独立于平台的(编写一次，在任何地方运行),但是它是有代价的，与本地代码相比，它的性能降低了。假设你想写一个像本地代码一样高效运行的fast⚡程序，或者你想使用一个c库提供的Java中没有的功能。当然，你可以用Java重新编写整个C库，但你不想再从头开始，JNI会支持你的。</p><blockquote class="jp jq jr"><p id="3725" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">我写这篇文章的主要原因是，我和我的朋友<strong class="ih hj">在试图从网上复制一个简单的JNI程序时失败了很多次</strong>，我不希望你经历我们已经经历过的艰难历程。</p></blockquote><p id="0a6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将在windows中演示这一点。但是一旦你理解了如何把这些点联系起来，它就很容易在任何操作系统中复制。</p><p id="9526" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件</strong>:</p><blockquote class="jp jq jr"><p id="56de" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">Java和g++/gcc应该安装在你的pc上。</p><p id="c62d" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><a class="ae jw" href="https://confluence.atlassian.com/doc/setting-the-java_home-variable-in-windows-8895.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> JAVA_HOME </strong> </a>变量应该被设置。</p><p id="46b2" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><a class="ae jw" href="https://www.javatpoint.com/how-to-set-path-in-java" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> JDK的</strong>宾</a> &amp; <a class="ae jw" href="https://stackoverflow.com/questions/48612744/how-to-add-g-from-mingw-to-path/48828104" rel="noopener ugc nofollow" target="_blank"> MinGW g++ </a>应该在你的道路上。</p></blockquote><h2 id="42d6" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">1.用<strong class="ak">本机</strong>关键字声明一个函数。</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><ul class=""><li id="0900" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">我们正在加载一个名为<strong class="ih hj"> <em class="js"> native的dll库(</em> </strong>它可以是任何名字)。之所以把它放在一个静态块中，是因为我们需要在我们的类被加载后立即加载库。</li></ul><p id="1a6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行以下命令</p><blockquote class="ld"><p id="06ee" class="le lf hi bd lg lh li lj lk ll lm jc dx translated">贾瓦茨-HelloWorldJNI.java</p></blockquote><ul class=""><li id="4d3c" class="ku kv hi ih b ii ln im lo iq lp iu lq iy lr jc kz la lb lc bi translated">-h . —创建一个头文件，其中包含我们在java文件中声明的所有本机函数声明。圆点表示应该在当前目录下创建文件。</li></ul><p id="b25d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将生成一个名为“HelloWorldJNI.h”的头文件，该文件声明了一个与sayHello()具有相同签名(JNI风格)的函数。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">下面是<strong class="ak">自动生成的</strong> <strong class="ak">头文件</strong> <strong class="ak">文件</strong>(去掉所有注释后)</figcaption></figure><h2 id="79e7" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">2.创建一个CPP文件并从中生成一个目标文件。</h2><p id="947d" class="pw-post-body-paragraph if ig hi ih b ii lw ik il im lx io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">现在我们要创建一个C++文件，它有一个与“HelloWorldJNI.h”中的方法签名相同的函数。(从头文件复制粘贴签名，ctrl+C/ctrl+V我们最喜欢的东西)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">确保函数签名是相同的。</figcaption></figure><ul class=""><li id="5637" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">在这个c++文件中，我们试图从我们的JNI风格的c++函数中调用一个本地方法(<em class="js">【say hello()</em>)。</li><li id="e7a8" class="ku kv hi ih b ii mb im mc iq md iu me iy mf jc kz la lb lc bi translated">确保包含“HelloWorldJNI.h”头文件。(否则，您将得到<strong class="ih hj">不支持链接错误</strong></li><li id="31d5" class="ku kv hi ih b ii mb im mc iq md iu me iy mf jc kz la lb lc bi translated">如果你使用的是任何代码编辑器，<em class="js"> #include &lt; jni.h &gt; </em>可能会带有弯弯曲曲的红线下划线，这是因为你的IDE找不到<em class="js"> jni.h </em>文件，相信我，一旦我们在编译时包含路径，它就会消失。</li></ul><p id="f1de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行下面的命令，</p><blockquote class="jp jq jr"><p id="7fc5" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated"><strong class="ih hj">g++-c-I " % JAVA _ HOME % \ include "-I " % JAVA _ HOME % \ include \ win32 " hello world JNI . CPP</strong></p></blockquote><ul class=""><li id="62e0" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">-c —输出一个对象文件(。o)</li><li id="b5e3" class="ku kv hi ih b ii mb im mc iq md iu me iy mf jc kz la lb lc bi translated">-I-指定一个包含目录</li></ul><blockquote class="jp jq jr"><p id="f502" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">" % JAVA _ HOME % \ include "-路径包含jni.h文件</p></blockquote><p id="5051" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将得到一个目标文件(HelloWorldJNI.o)作为输出，我们将使用它来创建一个dll(动态链接库)文件。</p><h2 id="69c2" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">3.从目标文件创建一个dll文件</h2><p id="079f" class="pw-post-body-paragraph if ig hi ih b ii lw ik il im lx io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">运行下面的命令，</p><blockquote class="ld"><p id="8b40" class="le lf hi bd lg lh li lj lk ll lm jc dx translated">g++-共享-o native.dll hello world JNI . o</p></blockquote><ul class=""><li id="38f9" class="ku kv hi ih b ii ln im lo iq lp iu lq iy lr jc kz la lb lc bi translated">-shared-创建共享库文件(windows中的dll文件)</li><li id="9112" class="ku kv hi ih b ii mb im mc iq md iu me iy mf jc kz la lb lc bi translated">-哦，native.dll-把它命名为native.dll</li><li id="05e4" class="ku kv hi ih b ii mb im mc iq md iu me iy mf jc kz la lb lc bi translated">确保dll文件的名称与从java程序加载的名称相同。</li></ul><p id="1b7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你会在当前目录中看到一个native.dll。</p><h2 id="7c9d" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">4.执行Java文件</h2><p id="b3a8" class="pw-post-body-paragraph if ig hi ih b ii lw ik il im lx io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">现在我们有了运行Java程序的一切。运行下面的命令，或者在任何IDE中将它作为Java程序运行。</p><blockquote class="jp jq jr"><p id="b91a" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">java HelloWorldJNI</p></blockquote><p id="aaa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，我们完成了，“你好，来自C++！!"会被输出到你的终端。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><h1 id="9ea7" class="mn jy hi bd jz mo mp mq kd mr ms mt kh mu mv mw kk mx my mz kn na nb nc kq nd bi translated">额外收获:让我们让您的生活更加轻松</h1><p id="80a1" class="pw-post-body-paragraph if ig hi ih b ii lw ik il im lx io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">如果你不断地改变你的c++代码，不断的链接和编译会变得非常乏味。所以让我们创建一个批处理文件，</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div><figcaption class="ls lt et er es lu lv bd b be z dx translated">将该文件另存为<strong class="ak"> runJ.bat </strong></figcaption></figure><p id="33e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你只需要在你的控制台中键入<strong class="ih hj"> runJ </strong>。所有的命令都会为你逐一执行，这就是批处理文件的妙处。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ne"><img src="../Images/1d692d2754faef6dc53cc4fc333e527e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECofxkx1DAJn5cVxwM0T-Q.png"/></div></div></figure><p id="8066" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你在本教程中学到了一些新的东西，不要再后悔为什么在早期学习C/C++。为了更好地了解JNI，我强烈推荐这篇文章。</p><blockquote class="jp jq jr"><p id="6986" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">奇怪的错误:如果你得到一个错误，试着在cmd而不是powershell中运行它(在vs代码中)</p></blockquote><p id="3e64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拍手声👏👏如果你喜欢这篇文章，并与你的朋友分享，如果他们也在实习中做JNI任务😂。</p></div></div>    
</body>
</html>