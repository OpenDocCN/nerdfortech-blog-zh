<html>
<head>
<title>JavaScript to Xamarin.Forms Two Way Communication Setup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript到Xamarin。形成双向通信设置</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/javascript-to-xamarin-forms-two-way-communication-setup-dcf980228bdb?source=collection_archive---------0-----------------------#2022-01-11">https://medium.com/nerd-for-tech/javascript-to-xamarin-forms-two-way-communication-setup-dcf980228bdb?source=collection_archive---------0-----------------------#2022-01-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9e54" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何设置WebView JavaScript和Xamarin之间的通信？表单应用程序</h2></div><p id="c654" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大家好👋！！！在今年切换到毛伊岛之前，让我们总结一个不典型的案例——通过WebView与JavaScript的通信。这篇博文将向您展示如何为Android和iOS设置JS到XF和XF到JS的命令。</p><p id="a282" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于我们的例子，我们将发送一些信息并显示一个延迟的警报。并对Xamarin应用程序中的一些HTML按钮做出反应。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="a11d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk io kl ip km ir kn is ko iu kp iv kq kr bi translated">准备WebView</h1><p id="5e29" class="pw-post-body-paragraph ix iy hi iz b ja ks ij jc jd kt im jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">首先，我们需要创建一个从WebView继承的新的自定义控件。此外，它将包含一个函数来调用预定义的JS函数和动作，WebView将从JS调用这些函数和动作。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="28ef" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">CustomWebView可以通过以下方式在Popup或Page后面的代码中使用它。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="bb70" class="ka kb hi bd kc kd ke kf kg kh ki kj kk io kl ip km ir kn is ko iu kp iv kq kr bi translated">iOS上的JavaScript绑定</h1><p id="04e9" class="pw-post-body-paragraph ix iy hi iz b ja ks ij jc jd kt im jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">对于iOS足以创建一个渲染器；姑且称之为<code class="du le lf lg lh b">CustomWebViewRenderer</code>。它应该继承自<code class="du le lf lg lh b">WkWebViewRenderer</code>并实现<code class="du le lf lg lh b">IWKScriptMessageHandler</code>的一个接口。此外，它应该包含我们的JS函数<code class="du le lf lg lh b">InvokeDisplayJSText</code>的定义和我们的脚本消息处理器的注册。是的，iOS不需要这么多。以下是完整的渲染器代码:</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h1 id="ff70" class="ka kb hi bd kc kd ke kf kg kh ki kj kk io kl ip km ir kn is ko iu kp iv kq kr bi translated">Android上的JavaScript绑定</h1><p id="635e" class="pw-post-body-paragraph ix iy hi iz b ja ks ij jc jd kt im jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">对于Android来说稍微复杂一些，但是实现也是从创建一个渲染器开始的，姑且给它起个相同的名字<code class="du le lf lg lh b">CustomWebViewRenderer</code>。应该是继承了<code class="du le lf lg lh b">WebViewRenderer</code>。此外，它应该包含我们的JS函数<code class="du le lf lg lh b">InvokeDisplayJSText</code>(类似于iOS)的定义和我们的自定义<code class="du le lf lg lh b">JSBridge</code>和<code class="du le lf lg lh b">JavascriptWebViewClient</code>的注册。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="aa9a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du le lf lg lh b">JavascriptWebViewClient</code>的定义非常简单——它只需要在WebView加载页面时加载定义好的JS脚本。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="c2ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du le lf lg lh b">JSBridge</code>的定义不会更复杂。我们需要导出JS代码定义的同名JS接口。</p><figure class="kx ky kz la fd lb"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="c21a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们正在加载JS并通过JS桥执行Xamarin代码🙃</p></div></div>    
</body>
</html>