<html>
<head>
<title>Understanding ARP and performing ARP spoofing attack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解ARP并执行ARP欺骗攻击</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/understanding-arp-and-performing-arp-spoofing-attack-e3b6a39de873?source=collection_archive---------4-----------------------#2021-03-23">https://medium.com/nerd-for-tech/understanding-arp-and-performing-arp-spoofing-attack-e3b6a39de873?source=collection_archive---------4-----------------------#2021-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1917" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将首先理解地址解析协议，然后使用<em class="jd">ARP欺骗执行ARP欺骗攻击。</em></p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="1197" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">地址解析协议</strong></h1><p id="3ece" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">ARP是一种通信协议，用于将动态互联网协议地址(IP)映射/解析为静态媒体访问控制地址(MAC)。</p><blockquote class="ko kp kq"><p id="8e60" class="if ig jd ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">互联网协议(IP)是逻辑32位地址，是网络层协议，而MAC是物理48位地址，位于数据链路层。ARP工作在OSI模型的第2层和第3层之间。</p></blockquote><p id="c85c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还要提一下，ARP是一个请求-响应协议；因为它基于请求及其相应的响应工作。它总是在单个网段下运行，从不通过网关或路由器进行路由。</p><p id="78a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">ARP是如何工作的？</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/c0cb49087286c2fdb69e4532348b19c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BNkLWc0e3t-eMyITvJ7_Jw.png"/></div></div></figure><p id="4d78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设魔鬼和天使连接在同一个局域网中。现在魔鬼想开始与天使交流。于是魔鬼先用DNS获取天使的IP地址为192.168.43.1。魔鬼也需要天使的MAC地址来启动通信，因为IP是一个动态的逻辑地址。</p><p id="9711" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每台计算机都维护一个ARP缓存表(其中存储了具有相应MAC地址的IP条目)。所以魔鬼的机器会先在ARP缓存表中寻找天使的IP (192.168.43.1)对应的MAC的条目。如果找到了，魔鬼就会直接开始通讯。否则，为了获得天使的MAC，它将在网络中广播具有其自己的IP (192.168.43.246)、MAC、天使的IP(目的地IP)和广播MAC (FF:FF:FF:FF:FF: FF作为目的地MAC)的分组。连接到同一个网络的每台计算机都会收到这个数据包。只有安吉尔的计算机会接受这个数据包(当目的IP匹配时)。然后，它将发送一个响应，其中包含天使的MAC和IP(作为源地址)和魔鬼的MAC和IP(作为目的地址)。现在devil和angle的电脑都会更新各自的ARP缓存表，开始通信。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lg"><img src="../Images/561c92f3ca3209bb1c0ed39fdcbcfe9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EX5vtYpJN696ljPEw7y8qQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated">使用Wireshark捕获的ARP广播消息(不要将其与上述示例联系起来)</figcaption></figure><p id="fa2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> ARP欺骗</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ll"><img src="../Images/51e6794864deeb812acec74cbf58a63b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BggWmij91rxz4FZrcAJp2A.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx translated"><a class="ae lm" href="https://docs.cpanel.net/img/mitm.png" rel="noopener ugc nofollow" target="_blank">https://docs.cpanel.net/img/mitm.png</a></figcaption></figure><p id="526a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在上面看到的，ARP协议是多么简单。恶意行为者利用了ARP的简单性。ARP没有任何安全检查或响应验证检查。因此，攻击者可以欺骗ARP响应来执行ARP欺骗攻击。</p><p id="5c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设一个恶意的演员僵尸想要进行ARP欺骗攻击，拦截魔鬼的机器和魔鬼连接的默认网关之间的通信。为此，僵尸将试图操纵魔鬼机器中的ARP缓存表。僵尸将发送一个虚假的ARP响应到魔鬼的机器，这意味着将僵尸的MAC关联到默认网关的IP。所以在收到这个假响应后，魔鬼的机器会假设僵尸的机器的MAC地址是默认网关的MAC地址，但这不是实际情况。同样，Zombie可以向默认网关发送一个假的响应消息，将Zombie的MAC与devil的IP关联在默认网关缓存表中。通过成功地做到这一点，僵尸变成了中间人，可以拦截所有的流量。</p><h1 id="28d8" class="jl jm hi bd jn jo ln jq jr js lo ju jv jw lp jy jz ka lq kc kd ke lr kg kh ki bi translated">执行ARP欺骗攻击</h1><p id="9618" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我们将使用运行在虚拟机器上的Kali机器作为攻击者，使用Windows主机作为受害者。</p><blockquote class="ko kp kq"><p id="5db6" class="if ig jd ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">确保在Kali中启用了桥接网络，以便它也可以连接到与Windows计算机连接的相同默认网关(在本例中为路由器)。</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es ls"><img src="../Images/7d969acaf87c22d801532367dfe0e3f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*9QkE8rZinpaQdqnhgohNTg.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">攻击前的ARP缓存表</figcaption></figure><p id="90ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在windows上，打开CMD并使用命令<em class="jd"> arp -a </em>显示arp缓存表。现在打开Kali机器并在其上启用端口转发。在kali中打开两个不同的终端，在第一个终端<strong class="ih hj"> <em class="jd">中运行以下命令ARP spoof–I【接口】–t【目标IP】【路由器IP】</em></strong><em class="jd"/>，在第二个终端上运行<strong class="ih hj"><em class="jd">ARP spoof–I【接口】–t【路由器IP】【目标IP】</em></strong><em class="jd"/>。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lt"><img src="../Images/a88c5e2ae52bd1776aee1fcccd97f36c.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*xvhbMzOozHjMmkdaz-SAAA.png"/></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lu"><img src="../Images/666c80d7277a70258697ed72d9819c77.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*EVunEQ9E8FuQKYTZDlnipg.png"/></div></figure><blockquote class="ko kp kq"><p id="9f44" class="if ig jd ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">[interface] =您可以使用<em class="hi"> ifconfig </em>识别kali机器上的接口，使用CMD中的<em class="hi"> ipconfig </em>可以找到【目标IP】和【路由器IP】。</p><p id="89d2" class="if ig jd ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated">在我这里<em class="hi"> eth2 </em>是接口，192.168.43.1是网关的IP，192.168.43.246是Windows的机器IP，192.168.43.74是kali的IP</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lv"><img src="../Images/58da62d08c0bcee6ced0346050531cad.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*l1Mz-mqKTZJ9y9N3oktauQ.png"/></div><figcaption class="lh li et er es lj lk bd b be z dx translated">攻击后的ARP缓存表</figcaption></figure><p id="6bb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上图中，可以看到MAC对应的路由器被更改为kali的MAC</p><p id="d3a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在执行这两个命令时，它会向目标Windows机器和默认网关发送虚假的ARP数据包。为了验证攻击的执行，在Windows机器上使用<em class="jd"> arp -a </em>，你会发现缓存表被与默认网关的IP对应的kali机器的MAC的假条目操纵。要终止这种攻击，在两个kali终端上按下<em class="jd"> ctrl+c </em>，并再次使用<em class="jd"> arp -a </em>进行确认。现在ARP缓存表将恢复到原来的状态。</p><p id="4d00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功的ARP欺骗攻击可以为一些更严重的攻击打开大门，如中间人、拒绝服务和会话劫持。</p><p id="d6a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述攻击仅用于教育目的。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="f874" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于任何技术或其他错误，随时与我联系，以便进一步的读者受益。</p><p id="590f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读。知识就是力量，所以不断获取！😈</p><p id="0342" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在GitHub上关注我吧！</p></div></div>    
</body>
</html>