<html>
<head>
<title>Re-using your Github Action Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重用您的Github动作工作流程</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/re-using-your-github-action-workflow-888660df183c?source=collection_archive---------2-----------------------#2021-11-27">https://medium.com/nerd-for-tech/re-using-your-github-action-workflow-888660df183c?source=collection_archive---------2-----------------------#2021-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5b2328057f4c37f9a8d5e662d405e977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8aKNyLdexCQEcToL"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@noahbuscher?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">诺亚·布舍尔</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="995e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">您是否曾遇到过需要跨文件复制粘贴Github动作工作流程而无法找到重用它们的方法的情况</strong>，</p><p id="5341" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我这里有一篇文章，会给你一个关于Github的beta特性的新想法，让你跨文件重用你的工作流</p><h2 id="d39b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">什么是工作流？</h2><figure class="kp kq kr ks fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/40db8e2aadb11273106dae9cd18c6d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RUkRC90kBZh_FaIMu8YyoA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">工作流程</figcaption></figure><p id="019f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每个工作流包含一组作业，可以简化为测试、部署或检查lint，此外，一个作业被划分为步骤，这些步骤是内部流程的更简化版本</p><h1 id="d716" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">创建可重用的工作流</h1><p id="9bf5" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">为了创建一个可重用的工作流，我们需要附加一个不同于常规onPush或onPR的调度程序，您需要包含<code class="du lp lq lr ls b">onWorkflowCall</code>，它将在工作流中触发工作流</p><h2 id="0336" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">限制和选项</h2><p id="110a" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">在创建工作流程之前，请尝试了解您应该记住的事项，例如</p><ul class=""><li id="0856" class="lt lu hi ix b iy iz jc jd jg lv jk lw jo lx js ly lz ma mb bi translated">可重用工作流不能在另一个可重用工作流中重用</li><li id="f744" class="lt lu hi ix b iy mc jc md jg me jk mf jo mg js ly lz ma mb bi translated">您不能从调用的地方继承变量，您需要显式传递变量</li><li id="9be0" class="lt lu hi ix b iy mc jc md jg me jk mf jo mg js ly lz ma mb bi translated">工作流可以包含除<code class="du lp lq lr ls b">onWorkflowCall</code>之外的其他触发器</li><li id="986c" class="lt lu hi ix b iy mc jc md jg me jk mf jo mg js ly lz ma mb bi translated">如果可重用工作流是公共的，则只能在同一回购协议或同一组织内使用</li></ul><h2 id="5a95" class="jt ju hi bd jv jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn bi translated">开始</h2><p id="4df4" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">首先，你可以在<code class="du lp lq lr ls b">.github/workflows/sample-test.yml</code>或者类似的地方创建一个文件</p><pre class="kp kq kr ks fd mh ls mi mj aw mk bi"><span id="7c96" class="jt ju hi ls b fi ml mm l mn mo">on:  <br/> workflow_call:<br/>    inputs:<br/>      image_name:<br/>        required: true<br/>        type: string<br/>      tag:<br/>         type: string<br/>    secrets:<br/>      registry_username:<br/>        required: true<br/>      registry_password:<br/>        required: true</span><span id="2565" class="jt ju hi ls b fi mp mm l mn mo">jobs:  <br/> build:<br/>// your steps...</span></pre><p id="dbae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，您可以使用键<code class="du lp lq lr ls b">workflow_call</code>创建一个工作流，并使用<code class="du lp lq lr ls b">input</code>和加密输入作为<code class="du lp lq lr ls b">secrets</code>传递变量</p><p id="5f09" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，如果您调用这个工作流，您在作业中编写的任何内容都将运行</p><h1 id="9f8c" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">怎么打电话？</h1><p id="26d3" class="pw-post-body-paragraph iv iw hi ix b iy lk ja jb jc ll je jf jg lm ji jj jk ln jm jn jo lo jq jr js hb bi translated">接下来，可能会有一个问题，如何在另一个工作流中调用这个工作流</p><p id="048d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要使用一个工作流，你应该遵循与常规工作流文件相同的过程，但是主区域在<code class="du lp lq lr ls b">jobs</code>里面</p><p id="123d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以创建一个单独的</p><pre class="kp kq kr ks fd mh ls mi mj aw mk bi"><span id="1e52" class="jt ju hi ls b fi ml mm l mn mo"><br/>jobs:</span><span id="bb1a" class="jt ju hi ls b fi mp mm l mn mo">..other jobs </span><span id="d6af" class="jt ju hi ls b fi mp mm l mn mo">docker:    <br/> uses: n3wt0n/ReusableWorkflow/.github/workflows/buildAndPublishDockerImage.yml@main    <br/> with:<br/>      image_name: my-awesome-app<br/>      tag: $GITHUB_RUN_NUMBER    <br/>secrets:<br/>      registry_username: ${{secrets.REGISTRY_USERNAME}}<br/>      registry_password: ${{secrets.REGISTRY_PASSWORD}}</span></pre><p id="d95f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是你需要做的。完成此操作后，您可以在项目中运行和重用任意数量的工作流</p><p id="f5e2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你喜欢我的内容，请考虑订阅我的substack账户<a class="ae iu" href="https://piyushdubey.substack.com/?r=omfzc&amp;utm_campaign=pub&amp;utm_medium=web&amp;utm_source=copy" rel="noopener ugc nofollow" target="_blank">这里</a></p><p id="3651" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">谢谢！</p></div></div>    
</body>
</html>