<html>
<head>
<title>Using Next.js ▲ with styled-components 💅 easy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Next.js ▲用于样式化组件💅容易的</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/using-next-js-with-styled-components-easy-dfff3849e4f1?source=collection_archive---------0-----------------------#2021-07-27">https://medium.com/nerd-for-tech/using-next-js-with-styled-components-easy-dfff3849e4f1?source=collection_archive---------0-----------------------#2021-07-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7408" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要服务器端渲染的时候React app。<a class="ae jd" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>是最好的选择。当谈到样式react组件时，我首先想到的是<a class="ae jd" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank">样式组件</a>。虽然这取决于你的喜好。</p><p id="cdfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您想要将<a class="ae jd" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>与<a class="ae jd" href="https://www.styled-components.com/" rel="noopener ugc nofollow" target="_blank">样式化组件</a>配对。但是在Next.js中使用样式化组件并不简单。这有点棘手。让我们看看如何实现这一点。</p><ol class=""><li id="096c" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#1-setup-nextjs-project" rel="noopener ugc nofollow" target="_blank"> Setup Next.js </a></li><li id="a6be" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#2-create-our-first-nextjs-page" rel="noopener ugc nofollow" target="_blank">创建我们的第一个Next.js页面</a></li><li id="23a2" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#3-install-styled-components" rel="noopener ugc nofollow" target="_blank">安装样式组件</a></li><li id="509d" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#4-install-and-setup-styled-components-babel-plugin" rel="noopener ugc nofollow" target="_blank">安装并设置样式组件巴别插件</a></li><li id="3206" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#5-create-custom-_documentjs-file" rel="noopener ugc nofollow" target="_blank"> Create _document.js文件</a></li><li id="4e0c" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><a class="ae jd" href="https://app.contentful.com/spaces/x2hu75nfw600/entries/2VoqEfclBehJH5eZK6OrnW#6-result" rel="noopener ugc nofollow" target="_blank">结果</a></li></ol><h1 id="565b" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1.设置Next.js项目</h1><p id="9380" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我们首先创建一个新目录。和cd放入该目录。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="cdf3" class="le jt hi la b fi lf lg l lh li">mkdir next-with-styled-component &amp;amp;&amp;amp; cd next-with-styled-component</span></pre><p id="7954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们需要创建我们的<code class="du lj lk ll la b">package.json</code>文件。然后在您的终端中运行以下命令。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="cf40" class="le jt hi la b fi lf lg l lh li">npm init</span></pre><p id="caaf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将创建一个<code class="du lj lk ll la b">package.json</code>文件。现在我们需要为我们的项目安装所有与Next.js相关的依赖项。在cmd/终端中运行以下命令。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="53fc" class="le jt hi la b fi lf lg l lh li">npm install --save next react react-dom</span></pre><p id="4f92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它将创建一个<code class="du lj lk ll la b">node_module</code>文件夹，并在其中安装所有Next.js相关的依赖项。</p><p id="98f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在您喜欢的编辑器中打开package.json文件。添加以下内容。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5d0a" class="le jt hi la b fi lf lg l lh li">{<br/>  "scripts": {<br/>    "dev": "next",<br/>    "build": "next build",<br/>    "start": "next start"<br/>  }<br/>}</span></pre><h1 id="9a2d" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">2.创建我们的第一个Next.js页面</h1><p id="962f" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">创建pages目录，并在pages目录下创建文件名<code class="du lj lk ll la b">index.js</code>。现在打开<code class="du lj lk ll la b">index.js</code>文件，将以下内容粘贴进去。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="61d5" class="le jt hi la b fi lf lg l lh li">function Home() {<br/>  return &lt;div&gt;Hello world!&lt;/div&gt;;<br/>}</span><span id="6722" class="le jt hi la b fi lm lg l lh li">export default Home;</span></pre><p id="eedc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用下面的命令在浏览器中运行我们的第一个页面。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f143" class="le jt hi la b fi lf lg l lh li">npm run dev</span></pre><p id="8a5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在<a class="ae jd" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>启动开发服务器。</p><h1 id="ef2b" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.安装样式组件</h1><p id="5833" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">现在是时候将样式组件添加到我们的项目中了。您可以使用以下命令添加样式化的组件。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="30ca" class="le jt hi la b fi lf lg l lh li">npm install --save styled-components</span></pre><h1 id="28d5" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">4.安装和设置样式组件巴别塔插件</h1><p id="5c8a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">我们还需要<code class="du lj lk ll la b">babel-plugin-styled-components</code>。它有助于在不同的环境之间保持一致的组件类名散列(这是服务器端呈现所必须的)。</p><p id="5768" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用下面的命令将<code class="du lj lk ll la b">babel-plugin-styled-components</code>安装为一个开发依赖项。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="50f4" class="le jt hi la b fi lf lg l lh li">npm install --save-dev babel-plugin-styled-components</span></pre><p id="2815" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在项目的根目录下创建一个<code class="du lj lk ll la b">.babelrc</code>文件。</p><p id="f7cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开<code class="du lj lk ll la b">.babelrc</code>文件添加以下内容。</p><ol class=""><li id="7db6" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">添加“下一个/巴别塔”作为预设</li><li id="7b52" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">添加一个样式化组件插件，并将SSR选项设置为true</li></ol><p id="72aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你的<code class="du lj lk ll la b">.babelrc</code>文件看起来是这样的。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="6c91" class="le jt hi la b fi lf lg l lh li">{ <br/>  "presets": ["next/babel"], <br/>  "plugins": [<br/>      ["styled-components", { "ssr": true }]<br/>   ]<br/>}</span></pre><h1 id="bac3" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5.创建custom _document.js文件</h1><p id="d57a" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">为了在服务器端呈现我们的样式化组件，我们需要覆盖<code class="du lj lk ll la b">_document.js</code>。为此，在pages文件夹下创建一个<code class="du lj lk ll la b">_document.js</code>文件。并在其中添加以下内容。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="aeff" class="le jt hi la b fi lf lg l lh li">import Document from "next/document";<br/>//highlight-next-line<br/>import { ServerStyleSheet } from "styled-components";<br/>export default class MyDocument extends Document {<br/>  static async getInitialProps(ctx) {<br/>    //highlight-next-line<br/>    const sheet = new ServerStyleSheet();<br/>    const originalRenderPage = ctx.renderPage;<br/>    try {<br/>      ctx.renderPage = () =&amp;gt;<br/>        originalRenderPage({<br/>          //highlight-next-line<br/>          enhanceApp: App =&amp;gt; props =&amp;gt; sheet.collectStyles()<br/>        });<br/>      const initialProps = await Document.getInitialProps(ctx);</span><span id="5f5f" class="le jt hi la b fi lm lg l lh li">      return {<br/>        ...initialProps,<br/>        styles: (<br/>          &amp;lt;&amp;gt;<br/>            {initialProps.styles}<br/>            //highlight-next-line               <br/>            {sheet.getStyleElement()}<br/>          <br/>        )<br/>      };<br/>    } finally {<br/>      sheet.seal();<br/>    }<br/>  }<br/>}</span></pre><p id="9756" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的基本思想是，每次在服务器端加载页面时，我们都需要将样式表插入到文档中。</p><h1 id="423f" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">6.结果</h1><figure class="kv kw kx ky fd ln"><div class="bz dy l di"><div class="lo lp l"/></div></figure></div></div>    
</body>
</html>