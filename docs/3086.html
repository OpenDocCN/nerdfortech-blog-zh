<html>
<head>
<title>Use Google App Script to Create a Line bot Reminder</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用谷歌应用程序脚本创建一个线机器人提醒</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/use-google-app-script-to-create-a-line-bot-reminder-ebf5f8a8a1dc?source=collection_archive---------6-----------------------#2021-05-29">https://medium.com/nerd-for-tech/use-google-app-script-to-create-a-line-bot-reminder-ebf5f8a8a1dc?source=collection_archive---------6-----------------------#2021-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d50f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的新公司正在寻找一种方法来提醒成员每天打卡/下班。由于他们主要使用 LINE，我想如果我可以触发 LINE bot 定期发送消息，它可能会有所帮助🤖</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/661fdaa709d58d560240714bce990fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCRYpAed_y09cNzolE4hDw.png"/></div></div></figure><p id="8cd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将向你展示如何使用谷歌应用程序脚本来实现这一点:</p><ol class=""><li id="a712" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">设置环境</li><li id="ebd6" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">写我们的剧本</li><li id="c3f9" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">奔跑</li></ol></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h2 id="d1b8" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">我们的目标</h2><p id="e3b9" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">创建一个 LINE bot，在每天上午 9 点和下午 6 点向一组用户发送消息。</p><h2 id="6b28" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">系统需求</h2><p id="a69b" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">一个谷歌账户和线消息 API(是的，就这些🙌)</p></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="1d2e" class="lk kl hi bd km ll lm ln kq lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated">设置环境</h1><p id="f48c" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">1️⃣:我们需要将自己注册为线路开发人员→创建一个提供商→创建一个消息 API。<a class="ae mb" href="https://developers.line.biz/en/docs/messaging-api/getting-started/" rel="noopener ugc nofollow" target="_blank">下面是官方的分步说明</a>。最后我们可以通过二维码添加 bot:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/c95d2e793dff055814e41637dc7f0179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejcaWyCIP2m3NHM1Hm8Ciw.png"/></div></div></figure><p id="72a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2️⃣转到你的谷歌驱动器，创建一个新文件夹(💬我的是“Linebot”)。接下来，创建:</p><ul class=""><li id="3b4d" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc md jv jw jx bi translated">这将是我们的数据库，存储需要接收消息的成员的用户标识。</li><li id="6286" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc md jv jw jx bi translated"><strong class="ih hj">一个 Google App 脚本:</strong>在这里写我们的逻辑，存储 userIDs，发送提醒。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/532969f0db38bdd1584f1c7159eb8bc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bVRig-fBDTA4GXqZZTf0Cg.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="185f" class="lk kl hi bd km ll lm ln kq lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated">写我们的剧本</h1><p id="6567" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">如果您也不熟悉天然气，这些部件会很方便:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/e76b9a24725b41da3ea3270a3d7498a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5hhs27kue8Xqc7VBgJzog.png"/></div></div></figure><ol class=""><li id="722f" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">我们可以在这里创建许多文件。但是，重要的是，每个文件中的⚠ <strong class="ih hj">函数名称都应该不同</strong>！⚠既然我们<strong class="ih hj">不</strong>需要在 GAS 中写<code class="du mg mh mi mj b">import functionA from "./a.gs"</code>，如果在同一个项目中有重复的函数名就会混淆。</li><li id="4ac3" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">保存图标将保存当前项目中的所有修改(在上面的例子中，三个文件中的修改都将被保存)💾)</li><li id="0ec1" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">要测试一个功能，点击<strong class="ih hj">运行</strong>，右边的功能(上例:<code class="du mg mh mi mj b">replyMsg</code>)将被单独执行👟</li></ol><p id="7ff0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到工作中，我们的脚本包含👌主要部分:</p><ul class=""><li id="ba50" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc md jv jw jx bi translated">处理来自线路的消息</li><li id="f7f2" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc md jv jw jx bi translated">将用户 ID 添加到 Google 表单中</li><li id="3418" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc md jv jw jx bi translated">向所有用户发送提醒</li></ul><h2 id="f615" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">1.处理来自线路的消息</h2><p id="e919" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">最后，我们将部署 GAS 作为消息传递 API 的 Webhook URL。通过这种方式，无论何时收到任何消息，LINE 都会发送一个 HTTP <code class="du mg mh mi mj b">POST</code>请求。因此，在我们的应用程序脚本中，我们使用<code class="du mg mh mi mj b">Code.gs</code>中的<code class="du mg mh mi mj b">doPost(e)</code>函数来处理从 Line 发送的事件。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="5054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">别忘了用你自己的替换上面的<code class="du mg mh mi mj b">channelToken</code>，你可以在开发者控制台找到:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mm"><img src="../Images/1a54d170f9313c8465f3b2bf22301c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppn1RruV_teCsrYfoMyH3Q.png"/></div></div></figure><h2 id="1c35" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">2.将用户 ID 添加到 Google 表单中</h2><p id="eabb" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">当用户告诉我们的 LINE bot:“提醒我打卡”时，在回复消息之前，我们必须检查该用户是否已经在我们的提醒列表中:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="dc3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还记得我们为存储用户 id 而创建的 Google Sheet 吗？我们现在需要它的工作表 id😉</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/0ba4987c94da0950dc9968b1e8a5ccb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-h_sI4wZ0XftvKFfJirDZg.png"/></div></div></figure><p id="408f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们把它放在下面的代码中(在<code class="du mg mh mi mj b">openSheet.gs</code>):</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="82b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果 userId 不在工作表中，我们使用<code class="du mg mh mi mj b">appendRow</code>在最后一行添加它的 Id。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="d886" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太棒了，现在我们有了一个用户 Id 列表。我们可以继续给他们发送提醒⏰</p><h2 id="d3a2" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">3.向所有用户发送提醒</h2><p id="8ab6" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">在消息传递 API 中，我们需要每个用户的 id 来向他们发送消息:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="4e35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，让我们从工作表中获取 userId 列表:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="05e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于提醒不应该在周末发送消息，我增加了一个<code class="du mg mh mi mj b">checkDay()</code>功能。<a class="ae mb" href="https://sites.google.com/site/scriptsexamples/available-web-apps/event-manager/documentation/tools/time-zones" rel="noopener ugc nofollow" target="_blank">您可以从该列表中更改您的时区</a>🌏</p><p id="9be1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后但同样重要的是，我们需要一个触发器在工作日的上午 9 点和下午 6 点执行<code class="du mg mh mi mj b">sendReminder()</code>。<a class="ae mb" href="https://www.youtube.com/watch?v=5BYhGGPQlyA" rel="noopener ugc nofollow" target="_blank">本视频解释了许多可用于设置基于时间的触发器的其他功能</a>⏳</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mk ml l"/></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="7bba" class="lk kl hi bd km ll lm ln kq lo lp lq ku lr ls lt kx lu lv lw la lx ly lz ld ma bi translated">奔跑</h1><p id="4d35" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">快到了！最后的☝+✌步骤:</p><ol class=""><li id="087e" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">设置触发器</li><li id="1ec6" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">部署天然气项目</li><li id="4bc2" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">验证行消息 API 中的 webhook</li></ol><h2 id="eb41" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">1.设置触发器</h2><p id="bd40" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">在部署之前，我们必须确保扳机已经扣好。所以保存项目→运行<code class="du mg mh mi mj b">trigger.gs</code>(功能应该是<code class="du mg mh mi mj b">setupTrigger()</code> ) →检查触发标签</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/2e430f79727cec42ef6835eb783b6491.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZMhzlvTxYpLEFoaDih12pQ.png"/></div></div></figure><p id="368c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在选项卡中，我们应该看到两个触发器(<code class="du mg mh mi mj b">morningReminder </code>和<code class="du mg mh mi mj b">eveningReminder</code>)。当选择<code class="du mg mh mi mj b">edit</code>时，我们可以看到更多的细节(下面的触发器是我们在上午 8:55 设置的)。你可能会发现，是的，在代码中设置触发器给了我们更多的灵活性</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/6f01a1a3b01ad7df8e881ba0e4944ed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X8g_C0Jq2jOeGIRmmtuVKg.png"/></div></div></figure><p id="788b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">🙋‍♀️ <strong class="ih hj">边注</strong>:我们设定的时间和气体被触发的时间可能会有时间差。在上面的<code class="du mg mh mi mj b">LastRun</code>日志中，我的 8:55 提醒是在 8:57 执行的，而 18:00 提醒是在 18:03 触发的🤷‍♂️，我们已经尽力了😅</p><h2 id="6544" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">2.部署天然气项目</h2><p id="d7d0" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">部署→新部署→类型:<code class="du mg mh mi mj b">Web app</code> → <code class="du mg mh mi mj b">Anyone</code>可以访问(所以不会要求用户授权脚本)→部署</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/9cd42b92072866c645e9e5200666a164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3KDegUDD102QCn10G1rnWA.png"/></div></div></figure><h2 id="2d30" class="kk kl hi bd km kn ko kp kq kr ks kt ku iq kv kw kx iu ky kz la iy lb lc ld le bi translated">3.验证行消息 API 中的 webhook</h2><p id="b595" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">复制 Web app URL →设置为 Messaging API 的 Webhook URL →验证(有些时候会出现诡异的错误，但是再点一下<code class="du mg mh mi mj b">Verify</code>就好了。应该能行😏)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/31c2d6078ceacfde62ea28ecf8e7196d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KUxr2aQn04wIg3pjH2JdLg.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><p id="55ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">万岁！它工作了🍕🍕🍕</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/a50c02a42d476cfad0269bca7b91e982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Agukh-Lgcag6xsrT9CEWdQ.png"/></div></div></figure></div></div>    
</body>
</html>