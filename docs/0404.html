<html>
<head>
<title>Cloudformation Status Transition</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云形成状态转变</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/cloudformation-status-transition-ea402050c7aa?source=collection_archive---------0-----------------------#2020-11-26">https://medium.com/nerd-for-tech/cloudformation-status-transition-ea402050c7aa?source=collection_archive---------0-----------------------#2020-11-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="96da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Stack 是 AWS 资源的集合，我们可以将其作为一个单元来管理。我们可以在这个单元上执行创建、删除和更新等操作。当我们执行这些操作时，堆栈从一种状态转换到另一种状态。比如从 CREATE_IN_PROGRESS 到 CREATE_COMPLETE。了解转换状态有助于调试任何问题。这个博客试图直观地描述状态转换。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4009935dfb34f73e2888cfb6b20bb7cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0xKonEVwgBJwD1ddA1Drw.png"/></div></div></figure><p id="b8f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在高层次上，我们对栈执行创建|更新|删除操作。首先，我们使用一些模板创建一个堆栈。创建后，我们可以删除或更新堆栈。我们也可以在更新后删除堆栈。在内部，在上述每个操作期间，堆栈通过多个状态进行转换。我们将一个一个来看。</p><h1 id="727c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创造</h1><p id="41f5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">因此，让我们从创建操作开始。让我们看看堆栈经历了哪些不同的状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ks"><img src="../Images/bb9f5756b5f14f19526797c701de13be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7nK9G3RHmekGMq39jvDbg.png"/></div></div></figure><p id="6dc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦我们将语法上有效的模板传递给创建堆栈 API，堆栈就进入 CREATE_IN_PROGRESS。在变更集 API 的情况下，我们有额外的状态，在那里 cloudformation 审查并决定什么将被变更。一旦它决定了所有的改变，它将进入 CREATE_IN_PROGRESS。它将继续按照提到的依赖顺序创建资源。如果没有创建任何东西，那么堆栈会在 ROLLBACK_IN_PROGRESS 中转换。在这种状态下，它会尝试删除到目前为止创建的资源。如果它能够删除所有这些，它将进入 ROLLBACK_COMPLETE 状态，然后堆栈将被删除。但是如果它未能删除中间的任何资源，它将进入 ROLLBACK_FAILED 状态。</p><h1 id="fbda" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">更新</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kt"><img src="../Images/7e0f95aa1d6980920a32df5caa1b21b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIZ9NZSiXipF5G9IH9jhSw.png"/></div></div></figure><p id="5c86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了能够更新堆栈，堆栈状态不应处于以下状态。</p><blockquote class="ku kv kw"><p id="6497" class="if ig kx ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated"><em class="hi">CREATE _ IN _ PROGRESS<br/>UPDATE _ IN _ PROGRESS<br/>UPDATE _ COMPLETE _ clean up _ IN _ PROGRESS<br/>UPDATE _ roll back _ IN _ PROGRESS<br/>UPDATE _ roll back _ COMPLETE _ IN _ PROGRESS<br/>UPDATE _ roll back _ FAILED<br/>DELETE _ IN _ PROGRESS<br/>DELETE _ FAILED</em></p></blockquote><p id="c912" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在除 UPDATE _ roll back _ FAILED &amp; DELETE _ FAILED 之外的所有情况下，您都需要等待状态更改。在其他两种情况下，您需要修复导致失败的错误，然后尝试更新。</p><p id="af03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在更新过程中，CFN 首先创建新资源，然后删除受支持资源类型的旧资源。因此，我们有额外的状态，如 UPDATE_COMPLETE_CLEANUP_*和 UPDATE _ roll back _ COMPLETE _ CLAENUP _ *。静止流与上面讨论的相似。如果堆栈无法更新资源或无法完成回滚，则相应地输入 UPDATE_FAILED 或 UPDATE_ROLLBACK_FAILED。</p><h1 id="d327" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">删除</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/caf768094d089ef714af3052f0866543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xBGHa0cIQ4lssCJYO0Qqpg.png"/></div></div></figure><p id="8787" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们由于某种原因试图删除堆栈时，堆栈中的任何资源都没有被删除，那么堆栈进入 DELETE_FAILED 状态。我们需要修复未能删除的资源(比如在删除之前清空存储桶，删除在 CFN 之外创建的任何其他引用)。</p><p id="a9d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在最后三张图中，<strong class="ih hj">红色的状态需要人工干预</strong>，然后才能变为绿色或橙色状态。在红色状态下，对堆栈的进一步操作将不起作用。</p><p id="404c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">堆栈始终卡在<strong class="ih hj">* _ 进行中</strong>状态。请注意自定义资源、ECS、证书、自动缩放资源。他们很可能是罪魁祸首，<strong class="ih hj">等待成功信号(健康信号)或手动干预(证书验证)</strong>。</p><p id="97c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！！感谢反馈。</p></div></div>    
</body>
</html>