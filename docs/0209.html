<html>
<head>
<title>Deploying Joomla, Prometheus &amp; Grafana on AWS EKS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在AWS EKS上部署Joomla、Prometheus和Grafana</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploying-joomla-prometheus-grafana-on-aws-eks-37177a116acb?source=collection_archive---------1-----------------------#2020-07-15">https://medium.com/nerd-for-tech/deploying-joomla-prometheus-grafana-on-aws-eks-37177a116acb?source=collection_archive---------1-----------------------#2020-07-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2b3cd562abdf9635046ba53ad2a56dd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DKwI2OgmufV_xZDIqkYX4w.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">由Raktim创建</figcaption></figure><div class=""/><p id="1718" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，您将了解如何在AWS EKS上部署Joomla、Prometheus和Grafana。我将详细讨论每一件事，并向你展示示范。所以让我们开始…</p><p id="d7c0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">下面是任务的视频演示:</strong></p><div class="hh hi ez fb hj js"><a href="https://www.linkedin.com/posts/raktim00_awscloud-awseks-kubernetes-activity-6689262931009404928-frrO" rel="noopener  ugc nofollow" target="_blank"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hy fi z dy jx ea eb jy ed ef hw bi translated">Raktim M .发布在LinkedIn上</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">⭕很高兴与大家分享，我在AWS EKS培训下完成了一项伟大的任务。😊 🔶简要介绍我的任务…</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">www.linkedin.com</p></div></div><div class="kb l"><div class="kc l kd ke kf kb kg hp js"/></div></div></a></div><h2 id="da5f" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">什么是AWS EKS？？？</h2><p id="afff" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">Amazon Web Services俗称AWS，是一家云服务提供商。我不想在这里谈论太多关于AWS的事情，但是如果你想知道更多关于AWS的事情，你可以看看我下面的文章。</p><div class="hh hi ez fb hj js"><a rel="noopener follow" target="_blank" href="/@raktim00/getting-started-with-aws-terraform-293e9125dff"><div class="jt ab dw"><div class="ju ab jv cl cj jw"><h2 class="bd hy fi z dy jx ea eb jy ed ef hw bi translated">AWS &amp; Terraform入门。</h2><div class="jz l"><h3 class="bd b fi z dy jx ea eb jy ed ef dx translated">如何入门使用Terraform在AWS中构建基础设施？</h3></div><div class="ka l"><p class="bd b fp z dy jx ea eb jy ed ef dx translated">medium.com</p></div></div><div class="kb l"><div class="lh l kd ke kf kb kg hp js"/></div></div></a></div><p id="da63" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在AWS，我们完全管理称为EKS的Kubernetes服务(弹性Kubernetes服务)。EKS最大的特点是可以创建多节点集群，你不需要自己设置任何东西。在这里，您只需告诉EKS您想要使用哪些资源，EKS就会自动提供这些资源，并自动为您设置一切。</p><h2 id="9758" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">Joomla是什么？？？</h2><p id="5818" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">Joomla是一个用于创建Web内容的开源内容管理系统。它是用PHP编写的，使用MySQL数据库存储数据，并使用面向对象的编程技术。我们将使用预先创建的Joomla和MySQL的Docker图像。</p><h2 id="abc0" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">普罗米修斯是什么？？？</h2><p id="4117" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">Prometheus是一个用于事件监控和警报的免费软件应用程序。它在使用HTTP拉模型构建的时间序列数据库中记录实时指标，具有灵活的查询和实时警报。我们将使用它来监控我们的多节点集群。</p><h2 id="9d6b" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">Grafana是什么？？？</h2><p id="f15d" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">Grafana是一个多平台开源分析和交互式可视化web应用程序。它可以通过一个插件系统进行扩展。终端用户可以使用交互式查询构建器创建复杂的监控仪表板。我们将通过Grafana连接Prometheus数据库服务器，以监控我们的多集群节点。</p><h1 id="a9e8" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">正在设置AWS EKS集群…</h1><h2 id="e898" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">先决条件:</h2><ul class=""><li id="a1cc" class="lz ma hx iw b ix lc jb ld jf mb jj mc jn md jr me mf mg mh bi translated">您应该有一个AWS帐户，并且应该在您的系统中安装AWS CLI。接下来，您应该用您的访问密钥和秘密密钥配置AWS CLI。</li><li id="d686" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">接下来，您应该在系统上安装“eksctl”程序。eksctl是一个可以非常容易地创建EKS集群的程序。</li><li id="86ac" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">你还应该在你的系统上安装“kubectl”程序。kubectl是一个客户端程序，它与运行在AWS上的Kubernetes主程序联系，以满足我们的需求。</li></ul><h2 id="0897" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">写入yml文件以创建EKS集群:</h2><p id="735c" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">要使用eksctl创建集群，我们需要创建一个yml文件。在下面你可以看到这个文件。别担心，我会讨论如何写这个文件。</p><figure class="mn mo mp mq fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure><ul class=""><li id="a8ad" class="lz ma hx iw b ix iy jb jc jf mt jj mu jn mv jr me mf mg mh bi translated">在这个文件中的前两个选项(kind和apiVersion)你可以认为是默认选项。在元数据中，我们提到了我的集群的名称，以及我们希望我们的集群部署在哪个区域。</li><li id="d581" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">接下来在节点组中，我们提到了我们需要哪种类型的节点。在这里，我用3种不同的资源创建了3种节点组。这取决于您的应用程序负载，您希望提供哪种资源。</li></ul><h2 id="4f36" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">创建EKS集群:</h2><p id="0758" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">您只需运行一个CMD来创建集群。在cluster.yml文件所在的文件夹中，打开CMD提示符并运行下面提到的CMD命令。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="eea8" class="kh ki hx mx b fi nb nc l nd ne">eksctl create cluster -f cluster.yml</span></pre><p id="1da5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来在下面提到的图片中，你可以看到我运行CMD。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/ff9b52e468a30c24cf459afc96560aa3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v-Xz02FGX3J-dwrPJ2baAw.png"/></div></div></figure><p id="1b7e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，如果我转到AWS并转到EKS，我们可以看到群集已经创建。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ng"><img src="../Images/c138e7c7d48d5b6aa34064f408e0689b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SxG5on9qBLol54OlNFpf1A.png"/></div></div></figure><p id="b6d9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我转到AWS中的云形成，我们可以看到云形成创建了集群、节点组、VPC和所需的一切。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nh"><img src="../Images/973395d11d1a0dd1a4fb9e9958f36f19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jr5LspA-LD-1mQV47g7Log.png"/></div></div></figure><p id="d63c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">另外，如果我转到EC2，我们可以看到总共有5个实例已经成功部署。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ni"><img src="../Images/5fe503cb6f3a82642ae64e11e4fa14f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XbrBH3swaymjFoD23RB2xQ.png"/></div></div></figure><p id="6553" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，集群终于可以使用了。</p><h2 id="8a2f" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">配置kubectl:</h2><p id="c999" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">因此，我们将运行下面提到的cmd来设置kubeconfig文件。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="36be" class="kh ki hx mx b fi nb nc l nd ne">aws eks update-kubeconfig --name rmcluster </span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nj"><img src="../Images/fd011e5035e93eb478fe0370d3d86c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lK4CvNQB7H5bf7OnAV92RQ.png"/></div></div></figure><p id="0f0d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">恭喜，我们完成了Kubernetes的全部设置。现在，我们可以轻松地部署我们的应用程序。</p><h1 id="3af2" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">正在部署Joomla…</h1><p id="20d1" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">我们必须创建3个yml文件来部署Joomla。我将逐一讨论所有的文件。</p><h2 id="8c98" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">MySQL部署文件:</h2><p id="157d" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">使用下面提到的文件，我们将创建MySQL pod，它将作为Joomla的数据库。</p><figure class="mn mo mp mq fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure><ul class=""><li id="123a" class="lz ma hx iw b ix iy jb jc jf mt jj mu jn mv jr me mf mg mh bi translated">我已经讲述了apiVersion、kind和元数据。现在在spec中，我们告诉了MySQL的工作端口，以及我们希望MySQL使用哪种Kubernetes服务。现在我不希望外人能访问我的数据库。所以，我用了clusterIP服务。</li><li id="1d9a" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">接下来，我创建了一个永久保存我的MySQL数据的pvc。意味着如果由于任何原因我的吊舱被终止，我不会失去任何东西。</li><li id="4c39" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">接下来，我创建了一个部署文件来部署MySQL pod。这里我们可以注意到MySQL的密码来自另一个文件。通常我们会创建一个秘密文件，在里面安全地保存我们的密码，并给出文件的位置。现在，我部署自动从该文件中检索密码。还有一件事，我把pvc附加到“/var/lib/mysql”文件夹中，因为mysql把它的数据保存在这个文件夹中。</li></ul><h2 id="6a77" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">Joomla部署文件:</h2><p id="fd18" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">使用下面提到的这个文件，我为前端Web应用程序Joomla创建了pod。</p><figure class="mn mo mp mq fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure><ul class=""><li id="15f0" class="lz ma hx iw b ix iy jb jc jf mt jj mu jn mv jr me mf mg mh bi translated">这也是我以前讨论过的每一点。但在这里，我没有使用集群IP，而是使用了负载平衡器，因为这是我们的前端应用程序，这个负载平衡器将为我提供一个公共DNS，我们将其提供给客户端，以便客户端可以看到我的站点。</li><li id="0a5c" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">这里还有一件事，我们提到了我们的数据库细节，以便Joomla可以连接到数据库。</li><li id="7b69" class="lz ma hx iw b ix mi jb mj jf mk jj ml jn mm jr me mf mg mh bi translated">还有最后一件事，我让我的“/var/www/html”文件夹持久化，因为我们在Apache webserver上使用Joomla。Apache webserver将其数据存储在这个文件夹中。</li></ul><h2 id="90b1" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">Kustomization文件:</h2><p id="8696" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">这是我们必须写的最后一个文件。这个文件会自动找出其他文件并运行它们。你可以认为这是一个小的自动化。我们不是手动运行每个文件，而是简单地提到其中的文件名。记住一件事，这个文件的名字是固定的。</p><figure class="mn mo mp mq fd hk"><div class="bz dy l di"><div class="mr ms l"/></div></figure><ul class=""><li id="b1b9" class="lz ma hx iw b ix iy jb jc jf mt jj mu jn mv jr me mf mg mh bi translated">在这个文件中还有一件事，我们提到了我们传递给MySQL和Joomla的秘密密钥。所以，这将为我们生成秘密。</li></ul><h2 id="4181" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">让我们运行这些文件，看看如何访问Joomla:</h2><p id="2972" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">首先，为每个目的创建名称空间总是一个好的做法。这使得事情井井有条。我首先还创建了一个名为Joomla的名称空间，使用</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="e2e3" class="kh ki hx mx b fi nb nc l nd ne">kubectl create namespace joomla</span></pre><p id="9c15" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后我将默认名称空间改为Joomla，使用</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="f02a" class="kh ki hx mx b fi nb nc l nd ne">kubectl config set-context --current --namespace=joomla</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nk"><img src="../Images/da754b04b26b8168b0478f4210f77799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qdxb8qO_oWAFWdvJqRyXsg.png"/></div></div></figure><p id="a372" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我运行一个简单的CMD来部署MySQL和Joomla。CMD是</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="b436" class="kh ki hx mx b fi nb nc l nd ne">kubectl create -k .</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nl"><img src="../Images/98c672f8882ef00c77842fbf277bf109.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5XrKRyl6rjjajC-vAqvag.png"/></div></div></figure><p id="e466" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，我的完整设置终于准备好了。现在我运行“kubectl get all”并获得了外部IP。现在，如果我在5分钟后转到这个IP，我们将看到Joomla正在运行。这需要5分钟，因为AWS创建了一个负载平衡器。</p><h1 id="0a51" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">让我们看看如何设置Joomla…</h1><p id="1a72" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">在第一页，只需填写基本信息，如网站名称，电子邮件，用户名和密码。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nm"><img src="../Images/5bc50bc1428bb73c79218a60271d494c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7RKheHZkgMK3G_h6ahxXEg.png"/></div></div></figure><p id="b49e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在下一页中，我们必须设置数据库详细信息。在主机名中键入“joomla-mysql ”,因为这是我们的mysql部署的名称。接下来，在用户名中键入“root”。您也可以在数据库中创建一个用户，但为此您必须在MySQL部署文件上多写几行。在密码中，给出您存储在秘密文件中密码。在数据库名称中输入“joomla ”,它将创建一个名为joomla的数据库。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nn"><img src="../Images/84e9ba9343fced7e8b974561c5cd56f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxpaDI1YZmEqh8ZYeU2tLA.png"/></div></div></figure><p id="b641" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后运行安装程序，几秒钟后你的网络应用就可以使用了。接下来，您将看到一个登录屏幕，只需登录，您将看到下面给出的这种页面。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es no"><img src="../Images/c8957d239a525505bd9008332d3a187d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbrMNd_HMYDOceO3d2MyAw.png"/></div></div></figure><h1 id="11be" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">部署普罗米修斯…</h1><h2 id="9b28" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">先决条件:</h2><ul class=""><li id="7955" class="lz ma hx iw b ix lc jb ld jf mb jj mc jn md jr me mf mg mh bi translated">你需要有舵和舵程序安装在你的系统上。在部署普罗米修斯之前，我们要设置舵和舵杆。</li></ul><h2 id="fe9d" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">设置舵:</h2><p id="3e6d" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">你只需要运行3 CMD来设置舵。下面提到了这些命令。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="fa6d" class="kh ki hx mx b fi nb nc l nd ne">helm init</span><span id="e292" class="kh ki hx mx b fi np nc l nd ne">helm repo add stable <a class="ae nq" href="https://kubernetes-charts.storage.googleapis.com/" rel="noopener ugc nofollow" target="_blank">https://kubernetes-charts.storage.googleapis.com/</a></span><span id="9cea" class="kh ki hx mx b fi np nc l nd ne">helm repo update</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/24815f34c580161ba5cba8d3d0a912f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkP1LWU2XCf9nGQFUHpcaA.png"/></div></div></figure><h2 id="b11a" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">设置舵杆:</h2><p id="2ebb" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">这里我们也要运行几个命令。这将为tiller创建一个服务帐户，以便tiller可以部署我们所需的资源，如pod、pvc等。cmd如下所述。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="c107" class="kh ki hx mx b fi nb nc l nd ne">kubectl -n kube-system create serviceaccount tiller</span><span id="646d" class="kh ki hx mx b fi np nc l nd ne">kubectl create clusterrolebinding tiller — clusterrole cluster-admin — serviceaccount=kube-system:tiller</span><span id="1f54" class="kh ki hx mx b fi np nc l nd ne">helm init — service-account tiller</span><span id="385b" class="kh ki hx mx b fi np nc l nd ne">helm init — service-account tiller --upgrade</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ns"><img src="../Images/ece56277d69d196ed1696b212a5c80d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t7zJtmRxpfTlawy_VkLUcw.png"/></div></div></figure><h2 id="aec9" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">普罗米修斯使用头盔展开:</h2><p id="6cd7" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">现在我们可以使用头盔轻松部署普罗米修斯。因此，这里我们运行三个命令来部署Prometheus。第一个是为Prometheus创建一个名称空间，然后部署下一个名称空间，最后一个是获取IP one Prometheus服务器，以便我们可以将其与Grafana集成。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="c9fe" class="kh ki hx mx b fi nb nc l nd ne">kubectl create namespace prometheus</span><span id="029a" class="kh ki hx mx b fi np nc l nd ne">helm install stable/prometheus --namespace prometheus --set alertmanager.persistentVolume.storageClass=”gp2" --set server.persistentVolume.storageClass=”gp2"</span><span id="87ad" class="kh ki hx mx b fi np nc l nd ne">kubectl get svc -n prometheus</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ni"><img src="../Images/9b450fc99cd99e74cce56462a8f415f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*du9nBtfnHeAtbF5Fr8mexA.png"/></div></div></figure><p id="9da2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，最后你会看到普罗米修斯已经成功部署。</p><h1 id="8b81" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">部署和设置Grafana…</h1><h2 id="05de" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">Grafana使用头盔展开:</h2><p id="b13a" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">与我们为普罗米修斯所做的一样，这里我们也将运行3个命令。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="e10c" class="kh ki hx mx b fi nb nc l nd ne">kubectl create namespace grafana</span><span id="2881" class="kh ki hx mx b fi np nc l nd ne">helm install stable/grafana --namespace grafana --set persistence.storageClassName=”gp2" --set adminPassword=grafana --set service.type=LoadBalancer</span><span id="9b14" class="kh ki hx mx b fi np nc l nd ne">kubectl get svc -n grafana</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/da38edc701aaf2b45af197d4817ff857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y9NbJ7ap6GlqfrkL_cykxw.png"/></div></div></figure><p id="25ad" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有一点需要注意，在Grafana中，默认登录用户名是“admin”。在运行grafana的helm cmd时，我们将管理员帐户密码设置为“Grafana”。你想怎么设置都可以。接下来，我们获得外部IP，现在让我们转到这个IP来探索Grafana。</p><h2 id="d0f2" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">设置Grafana:</h2><p id="2d60" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">第一次登录Grafana，登录后你会发现一个名为数据资源的选项。点击并选择普罗米修斯。现在我们必须提供Prometheus服务器的主机地址。所以，这里给出普罗米修斯服务器的IP地址并保存它。</p><p id="5206" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面我展示了截图。</p><div class="mn mo mp mq fd ab cb"><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/a03965e0a64bbae2ab444c83eeaca8ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*DyrqGbU18yZqBzRWQgoL3w.png"/></div></figure><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/a1a2c32185a3942e5ed02cbe96d3034e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*w08dZFdJIrUSkPfHYsGung.png"/></div></figure></div><div class="ab cb"><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/30ee505433c36f7e5188b615c1a369e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*cRj6OEkf-Zsm9rEyzOCLWg.png"/></div></figure><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/6c7916ae1bd8068ca94f77b605af6937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*7kV5CNA42x30FstVhrgECA.png"/></div></figure></div><p id="fc6a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，单击左侧的加号图标(+)，然后单击导入。接下来给出值“10000”。实际上，这是为Kubernetes多节点集群预先创建的控制面板。接下来选择普罗米修斯，然后点击导入。然后，您将能够看到对Kubernetes所有集群和一切的完整监控。</p><p id="3579" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是截图，仅供参考。</p><div class="mn mo mp mq fd ab cb"><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/4ae55ebe4ec836b3cd02acc06d433078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*EnIl53K-br8t6dW8cFPoTg.png"/></div></figure><figure class="nu hk nv nw nx ny nz paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><img src="../Images/375b54fc50c41f6dbc3dd2dbbc59d66f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*HmO8csCkv16o0POFPojsxQ.png"/></div></figure></div><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es no"><img src="../Images/23332ce6a101aa0abef72773eae3f477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fbSXKQ01HLHV7c-G9sZJiA.png"/></div></div></figure><h2 id="2cd4" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">所以，终于完成了。这就是任务。</h2><h1 id="97d2" class="li ki hx bd kj lj lk ll kn lm ln lo kr lp lq lr ku ls lt lu kx lv lw lx la ly bi translated">现在，我将向你展示我们可以多么容易地完全摧毁完整的任务…</h1><p id="5a4e" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">让我们摧毁我们所有的部署意味着让我们摧毁Joomla，MySQL，Prometheus和Grafana。</p><p id="e77d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了摧毁Joomla和MySQL，我们将运行3个命令。实际上第一个CMD就足够删除Joomla和MySQL了。但是我们也会删除pvc和secrets。cmd如下所述。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="5ce6" class="kh ki hx mx b fi nb nc l nd ne">kubectl delete all --all</span><span id="531a" class="kh ki hx mx b fi np nc l nd ne">kubectl delete pvc --all</span><span id="b7ab" class="kh ki hx mx b fi np nc l nd ne">kubectl delete secrets (secret name)</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oa"><img src="../Images/983f2ca79f96308ccbb49b5d8941ade4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p0BXG-a-VVIMtMKNGOVEfQ.png"/></div></div></figure><p id="1cff" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，我们为普罗米修斯和格拉夫纳使用头盔，所以我们不需要手动删除一切。只有两个命令，一切都会被摧毁。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="b454" class="kh ki hx mx b fi nb nc l nd ne">helm list</span><span id="17fd" class="kh ki hx mx b fi np nc l nd ne">helm del (name of your deployment) --purge</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ob"><img src="../Images/b81a1ab5685b6f0862570bc942bfda90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c5g24UiV567NnIJIGRyYng.png"/></div></div></figure><h2 id="e810" class="kh ki hx bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">现在，让我们删除完整的EKS集群:</h2><p id="67eb" class="pw-post-body-paragraph iu iv hx iw b ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn lg jp jq jr hb bi translated">我们只需要运行一个CMD，整个群集就会被销毁。</p><pre class="mn mo mp mq fd mw mx my mz aw na bi"><span id="0e89" class="kh ki hx mx b fi nb nc l nd ne">kubectl delete cluster -f cluster.yml</span></pre><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oc"><img src="../Images/953f66495f7f58d52eef4267ffb26bcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jgIslfLgx0BtA3YfcoS8lw.png"/></div></div></figure><p id="d2cd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，如果您在AWS上看到云的形成，您会看到它启动了删除过程。</p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es no"><img src="../Images/f1ad7ce6f71bf8e383c6f6da1a53fba3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-FQhZxgxwLFVPSerjSVrw.png"/></div></div></figure><p id="faf9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">好了，谢谢大家的阅读。我真的很喜欢做这个任务。暂时停止。拜拜👋… </p><figure class="mn mo mp mq fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es od"><img src="../Images/8c7f1f8215dc1aaecd1e708e7650e726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Piks8Tu6xUYpF4DU"/></div></div></figure></div></div>    
</body>
</html>