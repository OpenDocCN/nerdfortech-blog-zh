<html>
<head>
<title>AWS Elastic Map Reduce— Intro!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS弹性贴图减少—简介！</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/aws-elastic-map-reduce-intro-55206fd47c85?source=collection_archive---------0-----------------------#2020-12-19">https://medium.com/nerd-for-tech/aws-elastic-map-reduce-intro-55206fd47c85?source=collection_archive---------0-----------------------#2020-12-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a353" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EMR是一个托管集群平台，可简化在AWS云上运行大数据框架，如Hadoop、Spark、Presto。</p><p id="0d90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EMR有多种部署选项。下图总结了所有这些部署模型。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9f95e6ce3f75e3cb1d0b187c4900abad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m0BSLBNK8QOyjbN2cMUhvQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">EMR部署选项</figcaption></figure><h1 id="8d48" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">EMR组件—群集和节点</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/d2344a342c40a98840f4cb201c4626e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IxkQArXI7opT-yeor8h4Ug.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">EC2上的EMR</figcaption></figure><p id="576b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">集群:</strong>集群只是一个称为节点的EC2实例的集合。根据节点的角色，它们分为三种类型。主节点、核心节点和任务节点。</p><p id="6e71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">主节点:</strong>管理&amp;监控集群，协调其他节点之间的数据和任务分配。它还跟踪任务的状态。每个</p><p id="cf94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">核心节点:</strong>保存数据和执行任务的节点。</p><p id="916a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任务节点:提供额外的计算能力。不保存任何数据。</p><h1 id="55db" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">EMR架构</h1><p id="eb35" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">Amazon EMR服务架构由四个基本层组成。</p><h2 id="314a" class="kx ju hi bd jv ky kz la jz lb lc ld kd iq le lf kh iu lg lh kl iy li lj kp lk bi translated">存储层</h2><p id="98ad" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在决定存储层时，AWS提供了三个选项。</p><ol class=""><li id="3c6e" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">使用EBS的HDFS(HDFS://主ip地址/数据路径)</li><li id="eb52" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">使用S3的emrf(S3://bucket-name/path-to-file-in-bucket)</li><li id="a130" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">HDFS使用实例存储</li></ol><h2 id="c067" class="kx ju hi bd jv ky kz la jz lb lc ld kd iq le lf kh iu lg lh kl iy li lj kp lk bi translated">资源管理</h2><p id="74a8" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">默认情况下，EMR使用YARN作为资源管理器。在最近的版本中，EMR还支持在Kubernetes上运行工作负载。</p><h2 id="480f" class="kx ju hi bd jv ky kz la jz lb lc ld kd iq le lf kh iu lg lh kl iy li lj kp lk bi translated">数据处理框架</h2><p id="354d" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">EMR开箱即用支持Hadoop、Spark和Presto框架。</p><h2 id="665d" class="kx ju hi bd jv ky kz la jz lb lc ld kd iq le lf kh iu lg lh kl iy li lj kp lk bi translated">应用框架:</h2><p id="0340" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">EMR支持Spark Streaming、Hive、Hbase、Presto、Flink、Pig等应用。</p><h1 id="3fc8" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">集群状态</h1><p id="b59a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">EMR集群在其生命周期中会在多个状态之间转换。下图列出了所有这些状态及其软血统。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/4715e0b99405921b5f0afdff59e465e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFEEMuH_6VWwIhLD2eBS1Q.png"/></div></div></figure><ol class=""><li id="3385" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">当我们创建启动群集创建时，它将进入开始状态。在这种状态下，AWS EMR服务根据我们提供的硬件配置提供EC2实例组。</li><li id="3ccb" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">一个EC2实例被提供，引导状态开始。在这种状态下，我们提供的任何脚本都在实例上执行。<br/>—bootstrap-actions Path = " S3://my bucket/filename "，Args=[arg1，arg 2]<br/>[{ ' class ification ':'&lt;conf-type&gt;'，' Properties ':{ ' key ':' value ' }]</li><li id="dec6" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">执行脚本后，EMR服务会安装我们选择在集群上运行的应用程序。</li><li id="6cc2" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">安装完所有应用程序后，集群进入等待状态。在这种状态下，集群正在等待任何需要执行的步骤。</li><li id="701d" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">一旦我们向集群提交了一个作业或任务，状态就会转变为正在运行。在此步骤中，集群运行我们提交的任何作业。</li><li id="6bb4" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">一旦所有任务完成，集群或者可以返回等待状态，或者可以进入终止状态。在这种状态下，EMR会删除实例。</li><li id="9fbb" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">根据终止的原因，最终状态可能被终止或以错误状态终止。</li></ol><h1 id="77ab" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">步骤状态</strong></h1><p id="19fb" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在上图中，我们看到在运行模式下，集群正在处理任务。任务/步骤遵循它们自己的生命周期。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/363c858de8e65a23ffcfc9fc9df97144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Goiv7RUZ73VYKO2Kgvz--w.png"/></div></div></figure><ol class=""><li id="a9a7" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">因此，任务从挂起状态开始。</li><li id="a74f" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">当它被执行时，它进入运行状态。</li><li id="f20a" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">根据成功或失败，任务会转换到已完成或失败状态。</li><li id="a228" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">我们可以选择忽略上一步中的错误并继续下一步，或者取消剩余的状态。</li><li id="cbed" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">万一我们忽略了下一步就进入运行状态了。</li><li id="cb99" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">如果我们不忽略这个错误。所有剩余状态进入取消状态。</li></ol><p id="5f81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有多种方式向集群提交作业。</p><blockquote class="mb mc md"><p id="9b32" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><em class="hi">使用控制台添加步骤，同时创建集群或通过修改运行集群。</em></p><p id="30be" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><em class="hi">使用cli或API。</em></p><p id="6766" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><em class="hi">通过SSH连接到主节点直接使用应用程序。</em></p></blockquote><p id="9e03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在集群状态转换中，我们看到终止或以错误状态终止。由于以下原因，这两种状态可以转换到它们的状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/4fb9c4ef14056466f84377a6cf5305ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9HXt_wlEHh5iIlXf1KMxmw.png"/></div></div></figure><p id="ae91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的错误中，除了前两个之外，大多数都是不言自明的。验证错误主要发生在相关API应用的约束不满足时。内部错误主要是由于服务问题和服务访问问题。</p><h1 id="8baf" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">高可用性:</h1><p id="9a64" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在单主节点部署中，主节点的故障将导致集群无法正常工作。EMR也支持多主机模式。在这种情况下，EMR启动3主节点。应用程序和服务在(1或2个额外节点)中复制。例如，资源管理器在所有节点中复制(1个活动节点2个备用节点)，而名称节点复制到1个额外节点(1个活动节点1个备用节点)。Flink、Ganglia、JupyterHub和Zeppelin等应用程序安装在所有三个主节点上。</p><p id="8b13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> Sqoop、Hive、Phoenix、HBase、Hue、Oozie和Presto需要外部数据库，因此在多主机设置中需要特别注意。</p><h1 id="3a7d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安全功能</h1><p id="ad20" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><strong class="ih hj"> IAM </strong> — AWS EMR支持服务角色与各种AWS服务进行交互，如KMS(加密)、SQS(调试)和其他AWS服务。</p><blockquote class="mb mc md"><p id="2518" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><strong class="ih hj">服务角色—</strong>EMR服务访问AWS资源所承担的IAM角色</p><p id="158b" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><strong class="ih hj"> JobFlowRole — </strong>由集群的C2实例承担的IAM角色</p><p id="44b5" class="if ig me ih b ii ij ik il im in io ip mf ir is it mg iv iw ix mh iz ja jb jc hb bi translated"><strong class="ih hj">自动缩放角色— </strong>我是一个角色，通过自动缩放来管理实例组中的实例。可以组合成服务角色本身。</p></blockquote><p id="9371" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安全组— </strong> EMR使用安全组来控制节点之间的网络流量。默认情况下，它创建两个安全组，一个用于主节点，另一个用于核心或任务节点。我们可以创建并附加我们自己的安全组，以便更好地控制网络流量。</p><p id="ab8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">加密— </strong> EMR支持数据加密。在使用EMRFS时，我们也可以使用服务器端加密。</p><p id="5f24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> EC2密钥对— </strong> EMR节点可以使用密钥对启动，这样我们就可以验证并获得对节点的服务器级访问。</p><p id="9474" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> VPC — </strong> EMR集群在VPC启动，因此所有与VPC相关的网络概念(包括VPC流量日志)都可用于EMR。</p><h1 id="961b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">审计和日志记录功能</h1><p id="4bc6" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">日志记录— EMR日志存储在主节点上，也可以发送到s3。</p><pre class="je jf jg jh fd mj mk ml mm aw mn bi"><span id="77e6" class="kx ju hi mk b fi mo mp l mq mr">/mnt/var/log/hadoop/steps/</span><span id="288e" class="kx ju hi mk b fi ms mp l mq mr">/mnt/var/log/hadoop-[hdfs|httpfs|yarn]</span><span id="85e2" class="kx ju hi mk b fi ms mp l mq mr">/mnt/var/log/hadoopmapreduce</span><span id="7d11" class="kx ju hi mk b fi ms mp l mq mr">/mnt/var/log/bootstrap-actions/</span><span id="ddea" class="kx ju hi mk b fi ms mp l mq mr">/mnt/var/log/instance-state/</span></pre><p id="668b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它还可以与云监控日志集成，以获取警报和指标。</p><p id="33e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">云轨迹— </strong> EMR记录对云轨迹的控制平面API调用。</p><p id="66ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐学习！！</p></div></div>    
</body>
</html>