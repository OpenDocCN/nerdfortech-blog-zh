<html>
<head>
<title>Implementing Event Sourcing PHP Application in 15 minutes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 15 分钟内实现事件源 PHP 应用程序</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/implementing-event-sourcing-php-application-in-15-minutes-806cffa1e5ca?source=collection_archive---------3-----------------------#2022-02-06">https://medium.com/nerd-for-tech/implementing-event-sourcing-php-application-in-15-minutes-806cffa1e5ca?source=collection_archive---------3-----------------------#2022-02-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/6d99363601afc422c47162eb83b7429d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sq9QPIMbBIT2eZHpWwg8UA.jpeg"/></div></div></figure><div class=""/><p id="5d5c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将直接跳到代码，我们将在 15 分钟内实现事件源应用程序。在开始之前，唯一值得一读的是来自<a class="ae jo" rel="noopener" href="/nerd-for-tech/starting-with-event-sourcing-in-php-161a83597d69">上一篇</a>的事件概述。没有时间可以浪费了，我们开始吧。</p><h1 id="d115" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第一分钟—设置项目</h1><ol class=""><li id="ccb0" class="kn ko ht is b it kp ix kq jb kr jf ks jj kt jn ku kv kw kx bi translated">创建一个空目录“App”并在<em class="ky">中运行“<em class="ky">作曲初始化”</em>。</em>将应用程序命名为“<em class="ky">生态区/应用程序”</em>，并使用默认值。<br/>处理后我们应该有 composer.json:</li></ol><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="bba8" class="li jq ht le b fi lj lk l ll lm">{<br/>    "name": "ecotone/app",<br/>    "autoload": {<br/>        "psr-4": {<br/>            "Ecotone\\App\\": "src/"<br/>        }<br/>    },<br/>    "require": {}<br/>}</span></pre><p id="3ae9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.现在，让我们要求生态区建兴包事件采购</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="4d80" class="li jq ht le b fi lj lk l ll lm">composer require ecotone/lite-event-sourcing-starter</span></pre><h1 id="38f8" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第三分钟—实施</h1><p id="04db" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">我们将创建电子钱包，将保持所有交易的日志。<br/>我们将在内存实现中做到不在数据库配置上浪费任何时间。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq lr l"/></div></figure><blockquote class="ls lt lu"><p id="6ae6" class="iq ir ky is b it iu iv iw ix iy iz ja lv jc jd je lw jg jh ji lx jk jl jm jn hb bi translated">生态交错区由经过良好测试且坚固的<a class="ae jo" href="https://github.com/prooph/event-store" rel="noopener ugc nofollow" target="_blank">事件存储库</a>提供动力，用于存储事件。<br/>除了在内存实现上，我们可以切换到 PostgreSQL/MySQL/MariaDB。</p></blockquote><p id="c3d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将对 Wallet 进行三种可能的操作:</p><ol class=""><li id="330e" class="kn ko ht is b it iu ix iy jb ly jf lz jj ma jn ku kv kw kx bi translated">注册新钱包</li><li id="031a" class="kn ko ht is b it mb ix mc jb md jf me jj mf jn ku kv kw kx bi translated">向钱包中添加钱</li><li id="42dc" class="kn ko ht is b it mb ix mc jb md jf me jj mf jn ku kv kw kx bi translated">从钱包中减去钱</li></ol><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq lr l"/></div></figure><blockquote class="ls lt lu"><p id="e4d8" class="iq ir ky is b it iu iv iw ix iy iz ja lv jc jd je lw jg jh ji lx jk jl jm jn hb bi translated">请记住，我们是在事件源世界中，所以在执行动作之后，我们返回事件。<br/> <em class="ht">如果我们想从之前的事件中重建状态，以验证给定的动作是否可以执行，我们可以实现类似</em> onWalletWasRegistered <em class="ht">的方法。</em></p></blockquote><p id="faf7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看我们的活动是什么样的:</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h1 id="eb63" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第 9 分钟—建筑投影</h1><p id="3540" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">所以现在我们希望能够回答这样一个问题，给定的钱包里现在有多少钱。为此，我们将利用投影，它订阅事件并进行计算。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="907f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的预测会在事件发生时重新计算当前的钱包余额。这也暴露了通过“<em class="ky">getWalletBalance”</em>来查询它可能性。</p><h1 id="6cfd" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第 13 分钟—运行示例</h1><p id="adc2" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">我们现在注册钱包，然后加 100 减 40。在这些事件发生后，我们的预测应该会告诉我们，当前的数量是 60。</p><p id="a8ea" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在项目的根目录下创建名为"<em class="ky"> run_example.php" </em>的文件</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="4fef" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，当我们运行它时，结果将是 60。</p><h1 id="5c8a" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">第 15 分钟—总结</h1><p id="ef89" class="pw-post-body-paragraph iq ir ht is b it kp iv iw ix kq iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">我们已经建立了事件源钱包。<br/>生态交错带的目标是直线前进的构型。我们只定义了该功能所需的类，配置量很少。得益于此，我们可以快速实现新功能，并保持代码整洁。</p><p id="0631" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解生态交错带框架<a class="ae jo" href="https://github.com/ecotoneframework/ecotone" rel="noopener ugc nofollow" target="_blank">，请点击这里</a>。<br/>如果你想看上面的实现，去<a class="ae jo" href="https://github.com/dgafka/php-event-sourcing-application-in-15-minutes" rel="noopener ugc nofollow" target="_blank">这个库</a>。</p></div></div>    
</body>
</html>