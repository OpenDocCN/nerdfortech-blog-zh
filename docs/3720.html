<html>
<head>
<title>How I created my first three.js project</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何创建我的第一个 three.js 项目</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-i-created-my-first-three-js-project-fb8fadbe9b6d?source=collection_archive---------2-----------------------#2021-06-21">https://medium.com/nerd-for-tech/how-i-created-my-first-three-js-project-fb8fadbe9b6d?source=collection_archive---------2-----------------------#2021-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="e1f0" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">木星和土星会合</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/0228fb4c138aea74a0b229bcc65c166c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OzOkrFUfV_VWvAD0"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://unsplash.com/@zoltantasi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Zoltan·塔斯</a>在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="d547" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我把这篇文章分成几个部分:</p><ul class=""><li id="cbcc" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">想法</li><li id="6372" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">Three.js 基础</li><li id="f4f1" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">创造星辰(宇宙)</li><li id="b10a" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">添加行星</li><li id="bc4f" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">添加音乐</li><li id="ec4e" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">循环动画</li></ul></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="ff5b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="http://conjunction.mairo.eu/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">Demo</strong></a><strong class="jq hj">*/Github 上的代码:</strong></p><div class="lf lg ez fb lh li"><a href="https://github.com/miresk/planets-conjunction/blob/master/main.js" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">米雷斯克/行星-会合</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">github.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw jh li"/></div></div></a></div><p id="5df4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">*我建议在更大的屏幕上打开演示(应用程序的缺陷列在文章的最后)</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="6617" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">想法</h2><p id="5f78" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">几年前，我发现了这个<a class="ae jn" href="https://christmasexperiments.com/experiments" rel="noopener ugc nofollow" target="_blank">圣诞实验网站</a>——一个以各种数字艺术家为特色的降临节网络日历。看起来该项目已经被放弃，最后一个版本是 2018 年的。</p><p id="6fe6" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">无论如何，当我检查这些例子时，我的头脑被震惊了，我感到很受鼓舞。但学习 three.js、canvas 或 WebGL 也感觉是一项令人生畏的任务，我的愿望出现得越快，消失得越快。多亏了我的一个朋友，我想到了一个 2020 年末的简单项目。</p><p id="1efb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我首先想到的是创造一些圣诞节的东西，包括雪、树等等。但最终我发现，木星和土星将在 2020 年 12 月 21 日靠近他们的伟大会合。上一次发生这种情况是在 400 年前。正如<a class="ae jn" href="https://www.npr.org/2020/12/09/944560103/jupiter-and-saturn-will-be-together-again-for-the-holidays?t=1607870435507" rel="noopener ugc nofollow" target="_blank">npr.org</a>所写:</p><blockquote class="mx my mz"><p id="63b4" class="jo jp na jq b jr js ij jt ju jv im jw nb jy jz ka nc kc kd ke nd kg kh ki kj hb bi translated">在正确的时间，无论是通过望远镜还是肉眼，这些气态巨行星的间距大约是典型满月直径的五分之一。在这种接近度下， <strong class="jq hj"> <em class="hi">行星看起来会接触甚至形成天空中一颗大而明亮的星星。</em>T19】</strong></p></blockquote><p id="2e0e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是一个激动人心的大事件，我决定用网络技术来可视化它。网上有很多 three.js <a class="ae jn" href="https://threejs.org/examples/" rel="noopener ugc nofollow" target="_blank">的例子</a>帮助我把它们放在一起。这是结果的预览:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ne"><img src="../Images/e101eb50c3da294c29d61eb22d571322.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*cWaf8sUqsvbMmH4YbmYdFQ.gif"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">土星和木星会合</figcaption></figure></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="072c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我将只简要描述 three.js 的几个概念和项目的具体部分，因此要了解更多的实现细节，我推荐这本免费的书— <a class="ae jn" href="https://discoverthreejs.com/book/" rel="noopener ugc nofollow" target="_blank"> Discover three.js </a>，它解释了开始时你需要知道的一切！</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="5e97" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">Three.js 基础</h2><p id="62b5" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">Three.js 由 3 个主要部分组成:</p><ul class=""><li id="6da6" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">事件</li><li id="bfba" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">照相机</li><li id="4ccd" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">渲染器</li></ul><p id="409d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="https://threejs.org/docs/?q=scene#manual/en/introduction/Creating-a-scene" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">场景</strong> </a>就是你在上面 Gif 中看到的宇宙。这是一个三维空间，其坐标系有三个轴— <em class="na"> x，y，z </em> (0，0，0 是宇宙的中心)。我们这样创建它:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="4d6e" class="lx ly hi ng b fi nk nl l nm nn">scene = new THREE.Scene();</span></pre><p id="df38" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">相机有几种类型，常见的有<a class="ae jn" href="https://threejs.org/docs/#api/en/cameras/PerspectiveCamera" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">透视相机</strong> </a>。它模仿了我们的视觉方式。有一种东西叫做<a class="ae jn" href="https://en.wikipedia.org/wiki/Viewing_frustum" rel="noopener ugc nofollow" target="_blank">截锥</a>，是屏幕上出现的空间的一部分。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/8ae577e9bea2ca02e79c6effe1e87eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*beBnPlTg4h1RP7MddVV9qA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://en.wikipedia.org/wiki/Viewing_frustum#/media/File:ViewFrustum.svg" rel="noopener ugc nofollow" target="_blank">观察平截头体</a></figcaption></figure><p id="b8bc" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">例如，放在它后面的一些东西是看不见的。相机是这样定义的:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="58e7" class="lx ly hi ng b fi nk nl l nm nn">camera = new THREE.PerspectiveCamera(<br/>  fieldOfView,<br/>  aspectRatio,<br/>  nearPlane,<br/>  farPlane<br/>);</span><span id="5c6a" class="lx ly hi ng b fi np nl l nm nn">camera.position.x = 0;<br/>camera.position.y = 100;<br/>camera.position.z = 200;</span></pre><p id="a8d3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">渲染器</strong>使用 WebGL 库在你的屏幕(画布)上显示场景。它叫做<a class="ae jn" href="https://threejs.org/docs/?q=renderer#api/en/renderers/WebGLRenderer" rel="noopener ugc nofollow" target="_blank"> WebGLRenderer </a>，定义为:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="4257" class="lx ly hi ng b fi nk nl l nm nn">renderer = new THREE.WebGLRenderer();</span></pre><p id="f4eb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">作为最后一步，我们必须调用<em class="na"> render() </em>方法，在这个方法中，我们传递先前创建的场景和摄像机。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="9340" class="lx ly hi ng b fi nk nl l nm nn">renderer.render(scene, camera);</span></pre><p id="9afa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此时，我们还看不到任何东西，因为我们没有创建任何几何对象，也没有灯光来照亮它们。</p><blockquote class="mx my mz"><p id="4a9d" class="jo jp na jq b jr js ij jt ju jv im jw nb jy jz ka nc kc kd ke nd kg kh ki kj hb bi translated">有趣的事实:你在场景中看到的一切都是由三角形组成的。</p></blockquote><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nq"><img src="../Images/0b6bca1c3f255a9d6eab4702d7ce9194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*mLWFl-9RUtJmQwmUFNEGNQ.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">球体也是三角形:-)</figcaption></figure><p id="bc03" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">几乎所有其他东西都是从 main <em class="na"> THREE </em>类派生的，所以对于上面的球体，我们可以写:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="ad68" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">const</em> sphereGeometry = new THREE.SphereGeometry(1, 32, 16);</span></pre><p id="05ac" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在我们变得更具体之前，我想先解释一下 three.js 的基础知识。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="0049" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">创造星辰(宇宙)</h2><p id="82ae" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">我们可以用几何图形(BufferGeometry)和粒子(Points)来创建星星。</p><blockquote class="mx my mz"><p id="8b61" class="jo jp na jq b jr js ij jt ju jv im jw nb jy jz ka nc kc kd ke nd kg kh ki kj hb bi translated"><a class="ae jn" href="https://threejs.org/docs/?q=BufferGeometry#api/en/core/BufferGeometry" rel="noopener ugc nofollow" target="_blank">buffer gerometry</a>——网格、线或点几何图形的表示。包括顶点位置、面索引、法线、颜色、uv 和缓冲区中的自定义属性，减少了将所有这些数据传递给 GPU 的成本。</p></blockquote><p id="82a8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以把它想象成一个里面有很多点的长方形。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nr"><img src="../Images/e4685314511c9e64031c66b86360b71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fP9jOvPXTsfJdoGRvCtqaA.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated"><a class="ae jn" href="https://redstapler.co/space-warp-background-effect-three-js/" rel="noopener ugc nofollow" target="_blank">恒星粒子</a></figcaption></figure><p id="866e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在下面的代码中，你可以看到我们定义了一个几何变量和一个顶点数组。我们为六千颗星星创建一个循环，并用随机分布的值(x，y，z)填充顶点数组。你可以想象一下上面的矩形里填满了 6000 个点。</p><p id="c069" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们将 1500 作为每个坐标的值。用数字来定义界限。然后我们使用<em class="na"> geometry.setAttribute </em>方法设置这些值的位置。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="3d55" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">const</em> geometry = new THREE.BufferGeometry();<br/><em class="na">const</em> vertices = [];</span><span id="2740" class="lx ly hi ng b fi np nl l nm nn"><em class="na">for</em> (<em class="na">let</em> i = 0; i &lt; 6000; i++) {<br/>  vertices.push(THREE.MathUtils.randFloatSpread(1500)); <em class="na">// x<br/>  </em>vertices.push(THREE.MathUtils.randFloatSpread(1500)); <em class="na">// y<br/>  </em>vertices.push(THREE.MathUtils.randFloatSpread(1500)); <em class="na">// z<br/></em>}</span><span id="d2a4" class="lx ly hi ng b fi np nl l nm nn">geometry.setAttribute(<br/>  "position",<br/>  new THREE.Float32BufferAttribute(vertices, 3)<br/>);</span></pre><p id="d7cb" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在让我们创建代表恒星的粒子。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="841c" class="lx ly hi ng b fi nk nl l nm nn">particles = new THREE.Points(<br/>  geometry,<br/>  new THREE.PointsMaterial({ color: 0x888888 })<br/>);</span><span id="e954" class="lx ly hi ng b fi np nl l nm nn">scene.add(particles);</span></pre><p id="39f3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以给它们添加一些漂亮的纹理，但是在这种情况下仅仅定义一种颜色就足够了。这是我们静态宇宙的结果。我们将稍后制作动画。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ns"><img src="../Images/570caa6b388db7ad47b13292c948cfe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GpGwkuJvtH7gW0RZQisAJQ.png"/></div></div></figure></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="3c49" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">添加行星</h2><p id="7aa8" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">要创造一个星球我们必须使用<a class="ae jn" href="https://threejs.org/docs/#api/en/geometries/SphereGeometry" rel="noopener ugc nofollow" target="_blank">三个<em class="na">。球面几何</em> </a> <em class="na"> () </em>。</p><p id="1e75" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们还使用<em class="na"> TextureLoader() </em>给球体添加纹理(图像)，使它们看起来像我们想要使用的行星。然后纹理被映射到材质上。three.js 中最主要的写实材质是<a class="ae jn" href="https://threejs.org/docs/?q=MeshStandardMaterial#api/en/materials/MeshStandardMaterial" rel="noopener ugc nofollow" target="_blank"><em class="na">mesh standard material</em></a>。有了这个材质，我们必须创建一些灯光(例如<a class="ae jn" href="https://threejs.org/docs/?q=PointLight#api/en/lights/PointLight" rel="noopener ugc nofollow" target="_blank"> <em class="na">点光源</em> </a>)并将它们添加到场景中，以便看到物体(行星)。</p><p id="7140" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在下面的代码中，我们为每个行星创建了三个. js 网格对象，它采用了之前定义的两个参数——几何体和材质。</p><p id="1063" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有一个辅助函数<em class="na"> createPlanet() </em>我们用来让代码更简洁(<a class="ae jn" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">干</a>)。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="eab8" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">const</em> sphereGeometry = new THREE.SphereGeometry(1, 32, 16);</span><span id="d99f" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// TEXTURES<br/>const</em> loader = new THREE.TextureLoader();<br/><em class="na">const</em> sunTexture = loader.load("assets/sun.jpg");<br/><em class="na">const</em> jupiterTexture = loader.load("assets/jupiter.jpg");<br/><em class="na">const</em> saturnTexture = loader.load("assets/saturn.jpg");</span><span id="9787" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// MATERIALS<br/>const</em> sunMaterial = new THREE.MeshStandardMaterial({ map: sunTexture });<br/><em class="na">const</em> jupiterMaterial = new THREE.MeshStandardMaterial({map: jupiterTexture,});<br/><em class="na">const</em> saturnMaterial = new THREE.MeshStandardMaterial({ map: saturnTexture });</span><span id="57bb" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// SUN</em><br/>sunMesh = new THREE.Mesh(sphereGeometry, sunMaterial);<br/>sunMesh.position.set(0, -200, 0);<br/>sunMesh.scale.setScalar(200);<br/>scene.add(sunMesh);</span><span id="bbb1" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// JUPITER</em><br/>jupiterGroup = new THREE.Group();<br/><em class="na">var</em> jupiterGroupRadius = -300;<br/><em class="na">var</em> jupiterGroupX = (2 * Math.PI * jupiterGroupRadius) / 4;<br/>jupiterMesh = new THREE.Mesh(sphereGeometry, jupiterMaterial);<br/>createPlanet(scene, jupiterMesh, jupiterGroup, jupiterGroupX , 23, jupiterGroupRadius, 20);</span><span id="cfbe" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// SATURN</em><br/>saturnGroup = new THREE.Group();<br/><em class="na">var</em> saturnGroupRadius = -400;<br/><em class="na">var</em> saturnGroupX = (2 * Math.PI * saturnGroupRadius) / 4;<br/>saturnMesh = new THREE.Mesh(sphereGeometry, saturnMaterial);<br/>createPlanet(scene, saturnMesh, saturnGroup, saturnGroupX, 10, saturnGroupRadius, 18);</span><span id="d6c3" class="lx ly hi ng b fi np nl l nm nn"><em class="na">// LIGHT<br/>const</em> light = new THREE.PointLight("white", 1.2);<br/>light.position.set(0, 0, 0);<br/>scene.add(light);</span><span id="3b39" class="lx ly hi ng b fi np nl l nm nn"><em class="na">function</em> createPlanet(scene, mesh, group, x, y, z, scale) {<br/>  mesh.position.set(x, y, z);<br/>  mesh.scale.setScalar(scale);<br/>  group.add(mesh);<br/>  scene.add(group);<br/>}</span></pre><p id="d085" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我希望太阳的顶部出现在屏幕的中间，所以我把它放大了 200 倍，并在 Y 轴上移动了-200 倍。这是因为摄像机已经在 Y 轴和 Z 轴上移动了。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nt"><img src="../Images/b7c2f4d290bae5ebc1f5300774363241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s0KtOlsH9AGBGNYh-1fVFA.png"/></div></div></figure><p id="59b3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在 Three.js 中，角度是用弧度指定的，所以圆中没有 360∘，而是有 2 个<em class="na"> π </em>弧度。为了定位场景中的行星，我使用了一些基本的三角学。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="8e1d" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">添加音乐</h2><p id="91ce" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">在我们开始之前，让我们先给场景添加音乐。我添加了一个“播放”按钮来启动音乐和动画。为了工作，我只是从官方文档中复制并调整了一段关于音频的片段。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="fdbc" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">function</em> playScene() {<br/>  <em class="na">var</em> music = document.getElementById("music");<br/>  music.classList.add("playing");<br/>  playBtn.disabled = true;</span><span id="bd33" class="lx ly hi ng b fi np nl l nm nn">  // create an AudioListener and add it to the camera<br/>  <em class="na">const</em> listener = new THREE.AudioListener();<br/>  camera.add(listener);</span><span id="48cf" class="lx ly hi ng b fi np nl l nm nn"><em class="na">  // create a global audio source<br/>  const</em> sound = new THREE.Audio(listener);</span><span id="bc51" class="lx ly hi ng b fi np nl l nm nn"><em class="na">  // load a sound and set it as the Audio object's buffer<br/>  const</em> audioLoader = new THREE.AudioLoader();<br/>  audioLoader.load("assets/Orloe-PassingJupiter.mp3", <em class="na">function</em> (buffer) {<br/>    sound.setBuffer(buffer);<br/>    sound.setLoop(false);<br/>    sound.setVolume(0.5);<br/>    dur = buffer.duration.toFixed(0); <em class="na">// 176s<br/>    </em>sound.play();<br/>    rotatePlanets();<br/>  });<br/>}</span></pre><p id="7602" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我使用的轨迹叫做<a class="ae jn" href="https://orloe.bandcamp.com/track/passing-jupiter" rel="noopener ugc nofollow" target="_blank">从 Orloe 经过木星</a>，你也可以看到我存储了轨迹的持续时间。动画循环中使用持续时间来确定行星旋转到屏幕中间并形成新恒星所需的时间。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="8c96" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated">循环动画</h2><p id="07ad" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">在 three.js 中，我们可以制作任何对象属性的动画。例如，我们可以随时改变物体的旋转、缩放或颜色。网上有很多使用<a class="ae jn" href="https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame" rel="noopener ugc nofollow" target="_blank"><em class="na">requestAnimationFrame()</em></a>Javascript 方法的例子，但是较新版本的 Three.js 为我们提供了<code class="du nu nv nw ng b">.setAnimationLoop</code>方法，内部使用了<em class="na"> requestAnimationFrame </em>。</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="9393" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">// start the loop</em><br/>renderer.setAnimationLoop(() =&gt; {<br/>  renderer.render(scene, camera);<br/>});</span></pre><p id="5ad2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们用这个方法旋转行星。不过，我们也必须处理跨帧的时间。为此，我们可以使用 Three.js <em class="na"> Clock </em>类及其方法<em class="na"> getDelta()，</em>，它告诉我们从上一帧开始已经过去了多长时间。</p><p id="11ff" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我用来旋转行星的完整函数是这样的:</p><pre class="iy iz ja jb fd nf ng nh ni aw nj bi"><span id="d28a" class="lx ly hi ng b fi nk nl l nm nn"><em class="na">function</em> rotatePlanets() {<br/>  clock.start();</span><span id="151b" class="lx ly hi ng b fi np nl l nm nn">  renderer.setAnimationLoop(() <em class="na">=&gt;</em> {<br/>    <em class="na">const</em> time = clock.elapsedTime;<br/>    <em class="na">const</em> delta = clock.<!-- -->getDelta<!-- -->();</span><span id="a8ca" class="lx ly hi ng b fi np nl l nm nn">    sunMesh.rotation.y += 0.03 * delta;<br/>    particles.rotation.y += 0.01 * delta;</span><span id="76c0" class="lx ly hi ng b fi np nl l nm nn"><em class="na">    if</em> (time &lt;= (dur/2)) {<br/>      jupiterGroup.rotation.y -= delta/(dur/2);<br/>      saturnGroup.rotation.y -= delta/(dur/2);<br/>      jupiterMesh.rotation.y += 0.015 * delta;<br/>      saturnMesh.rotation.y += 0.025 * delta;<br/>    } <em class="na">else</em> <em class="na">if</em> (time &gt; (dur/2)) {<br/>      scene.add(flareLight);<br/>      renderer.setAnimationLoop(null);<br/>    }</span><span id="9c25" class="lx ly hi ng b fi np nl l nm nn">    renderer.render(scene, camera);<br/>  });<br/>}</span></pre><p id="d2ec" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">布鲁诺·西蒙在他的<a class="ae jn" href="https://threejs-journey.xyz/lessons/6" rel="noopener ugc nofollow" target="_blank">课程</a>中使用了<a class="ae jn" href="https://threejs.org/docs/#api/en/core/Clock.getElapsedTime" rel="noopener ugc nofollow" target="_blank"><em class="na">getElapsedTime</em></a>方法，他说我们不应该使用<em class="na"> getDelta </em>:</p><blockquote class="mx my mz"><p id="92a0" class="jo jp na jq b jr js ij jt ju jv im jw nb jy jz ka nc kc kd ke nd kg kh ki kj hb bi translated">另一个可用的方法是<code class="du nu nv nw ng b"><strong class="jq hj">getDelta(...)</strong></code>，但是除非您确切知道<a class="ae jn" href="https://threejs.org/docs/#api/en/core/Clock" rel="noopener ugc nofollow" target="_blank">时钟</a>类代码中发生了什么，否则您不应该使用它。使用它可能会扰乱你的动画，你会得到不想要的结果。</p></blockquote><p id="b7af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我不知道时钟里到底发生了什么，但是 getDelta()现在对我起作用了。然而，很高兴知道我们在这里有更多的选择。</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><h2 id="f859" class="lx ly hi bd lz ma mb mc md me mf mg mh jx mi mj mk kb ml mm mn kf mo mp mq mr bi translated"><strong class="ak">总结</strong></h2><p id="ed00" class="pw-post-body-paragraph jo jp hi jq b jr ms ij jt ju mt im jw jx mu jz ka kb mv kd ke kf mw kh ki kj hb bi translated">我创建了这个小项目来尝试和学习 Three.js 的一些部分。我简要地解释了 three.js 的基础是如何工作的，然后我描述了提供代码片段的项目的特定部分。这不是一步一步的详细解释，但作为参考，我列出了一些详细学习 Three.js 的好资源。</p><p id="94c1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这款应用还有很大的改进空间。我想正确地加载资源，并在所有东西都完全加载之前显示一些漂亮的进度条。现在我们可以看到一秒钟的空白屏幕，因为我只是在渲染场景之前使用 setTimeout(不好)。</p><p id="85aa" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我想让行星从屏幕的左边移到它们重叠的中间。我摆弄这些值来得到我满意的结果，但是在手机屏幕上我们几秒钟都看不到行星。因此，可以改进响应行为和计算。</p><p id="abca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Three.js 是一项非常酷的技术，用于创建身临其境的 3D 网络体验，我很高兴我可以将这个不完美的演示放在一起，并学到一些新的东西。</p><p id="358b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">试试看！欢迎大家分享自己的尝试:)</p><p id="775c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><a class="ae jn" href="http://conjunction.mairo.eu/" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">演示</strong> </a></p><p id="4c3b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">Github 上的代码:</strong></p><div class="lf lg ez fb lh li"><a href="https://github.com/miresk/planets-conjunction/blob/master/main.js" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">米雷斯克/行星-会合</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">github.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw jh li"/></div></div></a></div></div></div>    
</body>
</html>