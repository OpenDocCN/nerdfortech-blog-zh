<html>
<head>
<title>File Upload/Download with SpringBoot and MongoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用SpringBoot和MongoDB上传/下载文件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/file-upload-with-springboot-and-mongodb-76a8f5b9f75d?source=collection_archive---------0-----------------------#2021-06-01">https://medium.com/nerd-for-tech/file-upload-with-springboot-and-mongodb-76a8f5b9f75d?source=collection_archive---------0-----------------------#2021-06-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/15538bdf55c2b18aa1b660c20c4c3b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yKt0uvEY5ByeUZAcXEDzQ.png"/></div></div></figure><p id="4303" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我们将使用SpringBoot和MongoDB创建一个简单的RESTful web服务。我们将使用GridFS来存储文件。</p><h1 id="8933" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">什么是GridFS？</h1><blockquote class="km kn ko"><p id="b3f3" class="iq ir kp is b it iu iv iw ix iy iz ja kq jc jd je kr jg jh ji ks jk jl jm jn hb bi translated">GridFS是一种用于存储和检索超过BSON文档大小限制(16MB)的文件的规范。(来源:<a class="ae kt" href="https://docs.mongodb.com/manual/core/gridfs/" rel="noopener ugc nofollow" target="_blank"> MongoDB手册</a>)</p></blockquote><p id="3e82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GridFS将文件分成称为<strong class="is hj">块</strong>的小部分，并将它们存储为单独的文档。块的默认大小是255KB。</p><p id="5cd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">GridFS使用两个集合来存储文件。</p><ul class=""><li id="eec1" class="ku kv hi is b it iu ix iy jb kw jf kx jj ky jn kz la lb lc bi translated"><strong class="is hj"> fs.files </strong> -存储文件的元数据。</li><li id="4a87" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><strong class="is hj">fs . chunks</strong>——存储文件的二进制块。</li></ul><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es li"><img src="../Images/3c741305e983d1861e43c0875d65f352.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tNMb1smzqFdz3aS2.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated"><a class="ae kt" href="https://www.mongodb.com/blog/post/building-mongodb-applications-binary-files-using-gridfs-part-2" rel="noopener ugc nofollow" target="_blank">grid fs如何工作</a></figcaption></figure><p id="c285" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将从创建用于上传和下载的REST APIs开始，并使用Postman测试它们。好吧！我们开始吧。</p><h1 id="7e51" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">1.创建项目</h1><p id="dbeb" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">访问<a class="ae kt" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank">https://start . Spring . io</a>通过Spring Initializr使用以下依赖项生成应用。这将下载一个zip文件，您需要在IDE中提取并打开该文件。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/fdac935cd40b849dbd17cacbaf3b28da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T68JHZPlxX6fEuEe6CD5cw.png"/></div></div></figure><h1 id="c1bd" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2.Spring Boot房产</h1><p id="18bc" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">必须在“resources”文件夹的<strong class="is hj"> application.properties </strong>文件中提供以下配置。</p><p id="6984" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是MongoDB属性:</p><pre class="lj lk ll lm fd lx ly lz ma aw mb bi"><span id="28b4" class="mc jp hi ly b fi md me l mf mg">spring.data.mongodb.port = 27017<br/>spring.data.mongodb.host = localhost<br/>spring.data.mongodb.database = uploads<br/><br/>server.port=8080</span></pre><blockquote class="km kn ko"><p id="6efa" class="iq ir kp is b it iu iv iw ix iy iz ja kq jc jd je kr jg jh ji ks jk jl jm jn hb bi translated"><em class="hi">服务的默认端口是8080。如果您愿意，可以更改端口。如果有的话，你也可以添加认证。</em></p></blockquote><p id="32d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">也可以使用MongoDB Atlas，而不是在localhost上运行MongoDB。在应用程序中使用下列属性。</p><blockquote class="km kn ko"><p id="3bea" class="iq ir kp is b it iu iv iw ix iy iz ja kq jc jd je kr jg jh ji ks jk jl jm jn hb bi translated">将<strong class="is hj"> &lt; passsword &gt; </strong>替换为管理员密码，将<strong class="is hj"> &lt; database &gt; </strong>替换为数据库名称。</p></blockquote><pre class="lj lk ll lm fd lx ly lz ma aw mb bi"><span id="24b0" class="mc jp hi ly b fi md me l mf mg">spring.data.mongodb.uri=mongodb+srv://admin:<strong class="ly hj">&lt;password&gt;</strong>@cluster0.eypdh.mongodb.net/<strong class="ly hj">&lt;database&gt;</strong>?retryWrites=true&amp;w=majority</span></pre><p id="39e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，应该添加以下属性以允许文件上载。</p><pre class="lj lk ll lm fd lx ly lz ma aw mb bi"><span id="3fcd" class="mc jp hi ly b fi md me l mf mg">spring.servlet.multipart.enabled = true<br/>spring.servlet.multipart.max-file-size = 200MB<br/>spring.servlet.multipart.max-request-size = 200MB</span></pre><h1 id="4431" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">3.定义类别</h1><p id="a5fb" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">注意，我们在这里没有定义文档类，因为我们将只上传一个文件，它将直接存储在GridFS集合中。</p><p id="619e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的类将用于在下载文件时返回必要的响应。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h1 id="71a4" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">4.创建服务类</h1><p id="0252" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">这个服务类包含从GridFS中存储和检索文件的服务。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="8240" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">存储文件</h2><ul class=""><li id="4901" class="ku kv hi is b it lr ix ls jb mw jf mx jj my jn kz la lb lc bi translated"><strong class="is hj"> addFile() </strong>方法将文件存储在数据库中并返回文件的对象ID。</li><li id="b4c4" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">您可以将额外的信息作为元数据添加到文件中。例如，我添加了文件大小作为附加信息。但这不是必须的。</li><li id="c63f" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">要存储该文件，您需要将以下数据传递给GridFsTemplate中的store方法。</li></ul><pre class="lj lk ll lm fd lx ly lz ma aw mb bi"><span id="984a" class="mc jp hi ly b fi md me l mf mg">template.store(Inputstream content, filename, ContentType, metadata)</span></pre><h2 id="21f3" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">检索文件</h2><ul class=""><li id="34a9" class="ku kv hi is b it lr ix ls jb mw jf mx jj my jn kz la lb lc bi translated"><strong class="is hj"> downloadFile() </strong>方法用于从数据库中返回一个特定的文件。</li><li id="e825" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><strong class="is hj">GridFSTemplate中的findOne </strong>方法将返回与查询匹配的文件。</li><li id="1a5e" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">然后，我们将响应及其内容设置为步骤1中创建的LoadFile类中的一个对象，并返回它。</li><li id="7106" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">我们需要将文件设置为一个字节数组。为了将InputStream转换成一个字节数组，我们使用了<a class="ae kt" href="http://commons.apache.org/proper/commons-io/" rel="noopener ugc nofollow" target="_blank"> Apache Commons IO </a>。</li><li id="dd46" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">为此，您需要在您的<strong class="is hj"> <em class="kp"> pom.xml </em> </strong>文件中添加以下依赖项。</li></ul><pre class="lj lk ll lm fd lx ly lz ma aw mb bi"><span id="c951" class="mc jp hi ly b fi md me l mf mg">&lt;dependency&gt;<br/>   &lt;groupId&gt;commons-io&lt;/groupId&gt;<br/>   &lt;artifactId&gt;commons-io&lt;/artifactId&gt;<br/>   &lt;version&gt;2.8.0&lt;/version&gt;<br/>&lt;/dependency&gt;</span></pre><h1 id="b32c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">5.创建控制器</h1><p id="1329" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">控制器类由用于上传和下载文件的REST APIs组成。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="8d27" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">邮政</h2><ul class=""><li id="2712" class="ku kv hi is b it lr ix ls jb mw jf mx jj my jn kz la lb lc bi translated">为了上传文件，我们使用了<strong class="is hj"> POST </strong>方法。</li><li id="179d" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><strong class="is hj"> upload() </strong>方法在这里接受一个多文件类型的对象。</li></ul><h2 id="f108" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">得到</h2><ul class=""><li id="c2b6" class="ku kv hi is b it lr ix ls jb mw jf mx jj my jn kz la lb lc bi translated"><strong class="is hj"> GET </strong>方法将<strong class="is hj"> {id} </strong>作为路径参数返回一个特定的文档。</li><li id="1cce" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">通过<strong class="is hj"> download() </strong>方法，首先接收LoadFile对象，然后将必要的细节映射到响应头，使其可下载。</li></ul><p id="a66a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="kp">注意</em> </strong> <em class="kp">我们将数据作为ByteArrayResource返回。</em></p><h1 id="f833" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">6.通过邮递员测试REST端点</h1><p id="c1b6" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">一旦运行了应用程序，就可以在<code class="du mz na nb ly b"><a class="ae kt" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>访问它</p><h2 id="3b34" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">#上传文件</h2><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/1757770449e0382606e6901c788db980.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDvvkbl3kNoRIDZxDnVEQw.png"/></div></div></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/611993d99cdd709276ab09b468b483fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*juhjKlNbXWhmJGKeh_2CAQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated"><strong class="bd jq"> fs.files </strong>包含上传文件元数据的集合</figcaption></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/b62620d46b464b00431cb24cc202d2c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p_cX7XBaK73hPAExvn3CGQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">上传的文件将被分成几个块并存储在<strong class="bd jq"> fs.chunks </strong>集合中</figcaption></figure><h2 id="38d0" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated">#下载文件</h2><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nf"><img src="../Images/b3920501e9170b6b222c77e2d4dd3fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J4ySLSZcOtQxnf95sj3pZw.png"/></div></div></figure><h1 id="a451" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">7.开发前端</h1><p id="7dc8" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">现在我们已经完成了我们的后端，它工作顺利，让我们添加一个前端。😃</p><p id="c586" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经将所有的前端文件包含在了<code class="du mz na nb ly b">src/main/resources/static</code>文件夹中。</p><h2 id="ce02" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated"># index.html</h2><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="2a08" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated"># main.css</h2><p id="b34f" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">让我们添加一些CSS，让它看起来不那么无聊。😅</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure><h2 id="2d73" class="mc jp hi bd jq mj mk ml ju mm mn mo jy jb mp mq kc jf mr ms kg jj mt mu kk mv bi translated"># main.js</h2><p id="7628" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">为了让一切工作，让我们添加一点javascript。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="mh mi l"/></div></figure></div><div class="ab cl ng nh gp ni" role="separator"><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl nm"/><span class="nj bw bk nk nl"/></div><div class="hb hc hd he hf"><h1 id="9ef4" class="jo jp hi bd jq jr nn jt ju jv no jx jy jz np kb kc kd nq kf kg kh nr kj kk kl bi translated">结论</h1><p id="d039" class="pw-post-body-paragraph iq ir hi is b it lr iv iw ix ls iz ja jb lt jd je jf lu jh ji jj lv jl jm jn hb bi translated">我在为我的第三年项目开发一个web应用程序时遇到了这个话题，当时我正在努力寻找合适的资源。</p><p id="72ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以，我希望这篇教程对你有所帮助。😊</p><p id="ad76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有，你可以从我的GitHub repo <em class="kp"> </em> <a class="ae kt" href="https://github.com/hansitharaka/springboot-mongodb-file-upload-download" rel="noopener ugc nofollow" target="_blank"> <em class="kp">这里</em> </a>下载这个项目。</p><p id="9ead" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看这些链接以了解更多关于GridFS的信息。</p><ul class=""><li id="4dad" class="ku kv hi is b it iu ix iy jb kw jf kx jj ky jn kz la lb lc bi translated"><a class="ae kt" href="https://docs.mongodb.com/manual/core/gridfs/" rel="noopener ugc nofollow" target="_blank">https://docs.mongodb.com/manual/core/gridfs</a></li><li id="dba3" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><a class="ae kt" href="https://www.baeldung.com/spring-data-mongodb-gridfs" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/spring-data-mongodb-gridfs</a></li><li id="e53e" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated"><a class="ae kt" href="https://www.baeldung.com/spring-boot-mongodb-upload-file" rel="noopener ugc nofollow" target="_blank">https://www.baeldung.com/spring-boot-mongodb-upload-file</a></li></ul><p id="ad79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">直到下次，继续探索！！！🤓💪</p></div></div>    
</body>
</html>