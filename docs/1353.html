<html>
<head>
<title>Deploy your smart contracts to a public testnet</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的智能合约部署到公共测试网</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploy-your-smart-contracts-to-a-public-testnet-7f9aef3f6039?source=collection_archive---------4-----------------------#2021-03-15">https://medium.com/nerd-for-tech/deploy-your-smart-contracts-to-a-public-testnet-7f9aef3f6039?source=collection_archive---------4-----------------------#2021-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="c188" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">将智能合约部署到公共测试网的快速指南</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b89772dcffc13162bf358351dfc4b816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HkRkTb5s4gSb4zCNMn-kTg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">安德烈·拉林在 Unsplash<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">拍摄的照片</a></figcaption></figure><p id="0766" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">欢迎阅读以太坊编程基础的另一篇文章。在以前的文章中，我们已经看到了开发一个分散式应用程序的过程和基本工具，在今天的文章中，我们将看到如何在一个公共测试网中部署一个 dapp，我还会给你一些资源，你可以用它们来加强你作为一个以太坊开发者的技能。</p></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="94aa" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">什么是 Infura</h1><p id="a532" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">Infura 的主要目标是提供对以太坊和 IPFS 网络的即时访问，而无需设置自己的以太坊或 IPFS 节点。</p><blockquote class="lo lp lq"><p id="8634" class="jo jp lr jq b jr js ij jt ju jv im jw ls jy jz ka lt kc kd ke lu kg kh ki kj hb bi translated">Infura 由尖端的微服务驱动架构提供支持，该架构可动态扩展以支持我们的 API。开发人员可以通过 HTTPS 和 WebSocket 连接到以太坊和 IPFS，那里的请求响应时间比其他服务和自托管解决方案快 20 倍。我们的 API 套件始终拥有最新的网络更新，并在所有网络变化期间保持服务可用性。—来自 Infura <a class="ae jn" href="https://infura.io/product" rel="noopener ugc nofollow" target="_blank">产品描述</a>。</p></blockquote><h1 id="9525" class="kr ks hi bd kt ku lv kw kx ky lw la lb io lx ip ld ir ly is lf iu lz iv lh li bi translated">部署到 kovan testnet</h1><p id="3411" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">在这一节中，我将向您展示将智能合约部署到 kovan testnet 所需的步骤。<br/>你可以在<a class="ae jn" href="https://ethereum.stackexchange.com/questions/27048/comparison-of-the-different-testnets" rel="noopener ugc nofollow" target="_blank">以太坊 stackexchange </a>这里找到不同以太坊测试网的详细对比。</p><ol class=""><li id="5217" class="ma mb hi jq b jr js ju jv jx mc kb md kf me kj mf mg mh mi bi translated"><strong class="jq hj">在 Infura 中创建一个项目:</strong>为了使用 infura API，您需要创建一个帐户和一个新项目，因为您需要项目 Id 以便能够向 API 发送请求(更多详细信息请参见<a class="ae jn" href="https://blog.infura.io/getting-started-with-infura-28e41844cc89/" rel="noopener ugc nofollow" target="_blank">此链接</a>)。</li><li id="eda4" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated"><strong class="jq hj">在 MetaMask 中获取您帐户的助记符:</strong>如果您尚未保存您的帐户助记符，您可以转到 MetaMask 设置，选择安全和隐私，然后单击“显示种子短语”并输入您的密码以显示助记符。</li><li id="00a2" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj mf mg mh mi bi translated"><strong class="jq hj">创建一个文件来保存项目秘密，如助记符和 infura 项目 id 私有:</strong>在 truffle 项目的根目录下创建一个名为<code class="du mo mp mq mr b">.secrets.json</code>的 json 文件，并添加以下内容:</li></ol><pre class="iy iz ja jb fd ms mr mt mu aw mv bi"><span id="0f4c" class="mw ks hi mr b fi mx my l mz na">{<br/>   "mnemonic": &lt;your mnemonic&gt;,<br/>   "projectId": &lt;your project Id&gt;<br/>}</span></pre><p id="6b5e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> 4。</strong> <strong class="jq hj">安装</strong> <code class="du mo mp mq mr b"><strong class="jq hj">HDWalletProvider</strong></code> <strong class="jq hj"> : </strong>为了部署智能合约，我们必须将带有合约字节码的事务发送到网络，并且为了能够签署该事务，我们需要来自 truffle 框架的<code class="du mo mp mq mr b">hdwallet-provider</code>包:<code class="du mo mp mq mr b">npm install @truffle/hdwallet-provider</code></p><p id="f44c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj"> 5。更新 truffle-config.js 文件:</strong>从导入依赖项和解析<code class="du mo mp mq mr b">.secrets.json</code>文件开始。(关于配置的更多细节可在<a class="ae jn" href="https://www.trufflesuite.com/docs/truffle/reference/configuration#providers" rel="noopener ugc nofollow" target="_blank">块菌文档</a>中找到)。</p><pre class="iy iz ja jb fd ms mr mt mu aw mv bi"><span id="9b02" class="mw ks hi mr b fi mx my l mz na">const HDWalletProvider = require("@truffle/hdwallet-provider");</span><span id="cfb9" class="mw ks hi mr b fi nb my l mz na">const fs = require("fs");<br/>const secrets = JSON.parse(fs.readFileSync(".secrets.json").toString().trim());</span></pre><p id="c8a1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在“网络”部分，添加一个新网络，如下所示:</p><pre class="iy iz ja jb fd ms mr mt mu aw mv bi"><span id="9e93" class="mw ks hi mr b fi mx my l mz na">kovan: {<br/>   networkCheckTimeout: 10000,<br/>   provider: () =&gt; {<br/>      return new HDWalletProvider(<br/>        secrets.mnemonic,<br/>        `wss://kovan.infura.io/ws/v3/${secrets.projectId}`<br/>      );<br/>   },<br/>   network_id: "42",<br/>},</span></pre><p id="6921" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在，您可以进入终端，使用以下命令将您的项目部署到 Kovan 网络:</p><pre class="iy iz ja jb fd ms mr mt mu aw mv bi"><span id="bc09" class="mw ks hi mr b fi mx my l mz na">truffle migrate --network kovan</span></pre></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="25ac" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">下一步是什么</h1><p id="f05b" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">现在你已经有了撰写智能合同的基础，并且开发了你自己的 dapps，你已经准备好进入下一个阶段了。</p><p id="fe98" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这一部分，我会给你一些资源，你可以用它们来提高你作为以太坊开发者的技能:</p><h2 id="2242" class="mw ks hi bd kt nc nd ne kx nf ng nh lb jx ni nj ld kb nk nl lf kf nm nn lh no bi translated">书籍:</h2><div class="np nq ez fb nr ns"><a href="https://www.amazon.com/Mastering-Ethereum-Building-Smart-Contracts-ebook/dp/B07KGLNL76" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">掌握以太坊:构建智能合约和 DApps</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">掌握以太坊:建立智能合同和 DApps - Kindle 版</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">www.amazon.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og jh ns"/></div></div></a></div><div class="np nq ez fb nr ns"><a href="https://www.amazon.com/Hands-Contract-Development-Solidity-Ethereum/dp/1492045268/ref=sr_1_1?crid=1BEZJDSK8C00C&amp;dchild=1&amp;keywords=hands+on+smart+contract+development&amp;qid=1614801020&amp;sprefix=hands+on+smart+contract+%2Cdigital-text%2C661&amp;sr=8-1" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">使用 Solidity 和 Ethereum 进行智能合约开发:从基础到部署</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">使用 Solidity 和以太坊进行智能合约开发:从基础到部署</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">www.amazon.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og jh ns"/></div></div></a></div><div class="np nq ez fb nr ns"><a href="https://www.amazon.com/Mastering-Blockchain-Programming-Solidity-production-ready-ebook/dp/B07W5F8S1L/ref=sr_1_1?dchild=1&amp;keywords=Mastering+Blockchain+Programming+with+Solidity&amp;qid=1614801145&amp;sr=8-1" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">用 Solidity 掌握区块链编程:为以太坊编写生产就绪的智能合约…</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">Amazon.com:用 Solidity 掌握区块链编程:为以太坊编写生产就绪的智能合约…</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">www.amazon.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og jh ns"/></div></div></a></div><h2 id="8d95" class="mw ks hi bd kt nc nd ne kx nf ng nh lb jx ni nj ld kb nk nl lf kf nm nn lh no bi translated">课程:</h2><ul class=""><li id="0051" class="ma mb hi jq b jr lj ju lk jx oj kb ok kf ol kj om mg mh mi bi translated">来自<a class="ae jn" href="https://eattheblocks-pro.teachable.com/p/6-figure-blockchain-developer" rel="noopener ugc nofollow" target="_blank">eatheblock-pro</a>的 6 位数区块链开发者。</li><li id="a7b2" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated"><a class="ae jn" href="https://learn.consensys.net/catalog" rel="noopener ugc nofollow" target="_blank"> Consensys 学院课程</a>。</li></ul><h2 id="7da9" class="mw ks hi bd kt nc nd ne kx nf ng nh lb jx ni nj ld kb nk nl lf kf nm nn lh no bi translated">其他资源:</h2><div class="np nq ez fb nr ns"><a href="https://consensys.github.io/smart-contract-best-practices/" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">以太坊智能合约最佳实践</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">本文档为中级 Solidity 程序员提供了安全考虑的基本知识。这是…</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">consensys.github.io</p></div></div></div></a></div><div class="np nq ez fb nr ns"><a href="https://github.com/ConsenSys/ethereum-developer-tools-list" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">ConsenSys/以太坊-开发者-工具-列表</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">以太坊可用开发工具和平台指南。-ConsenSys/以太坊-开发者-工具-列表</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">github.com</p></div></div><div class="ob l"><div class="on l od oe of ob og jh ns"/></div></div></a></div><div class="np nq ez fb nr ns"><a href="https://docs.soliditylang.org/en/v0.8.2/security-considerations.html" rel="noopener  ugc nofollow" target="_blank"><div class="nt ab dw"><div class="nu ab nv cl cj nw"><h2 class="bd hj fi z dy nx ea eb ny ed ef hh bi translated">安全考虑-可靠性 0.8.2 文档</h2><div class="nz l"><h3 class="bd b fi z dy nx ea eb ny ed ef dx translated">虽然构建按预期工作的软件通常很容易，但检查没有人能使用它却要困难得多…</h3></div><div class="oa l"><p class="bd b fp z dy nx ea eb ny ed ef dx translated">docs.soliditylang.org</p></div></div></div></a></div><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="oo op l"/></div></figure></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="7394" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">需要记住的一些提示</h1><ul class=""><li id="bd0c" class="ma mb hi jq b jr lj ju lk jx oj kb ok kf ol kj om mg mh mi bi translated">在为生产环境编译智能契约时启用优化器，以优化生成的字节码。</li><li id="3e2a" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">如果一个函数需要将以太网传输给接收方，传输操作应该是该函数执行的最后一件事，以防接收方是带有恶意可支付回退(重入攻击)的智能合约。如果在转移之后需要执行一些其他操作，可以考虑使用 openzeppelin 的 ReentrancyGuard。(参见<a class="ae jn" href="https://docs.soliditylang.org/en/v0.8.2/security-considerations.html#use-the-checks-effects-interactions-pattern" rel="noopener ugc nofollow" target="_blank">此链接</a>)</li><li id="8ac3" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">不要在像循环或 if/else 语句这样的控制结构中使用以太传输。(与上一点相同，在恶意回退的情况下，如果攻击者无法窃取以太网，他可以执行一些 DOS 攻击)。</li><li id="49b6" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">最好使用<a class="ae jn" href="https://github.com/wissalHaji/solidity-coding-advices/tree/master/design-patterns/security#withdrawal-pattern" rel="noopener ugc nofollow" target="_blank">撤回模式</a>转移乙醚，以避免重入攻击。</li><li id="3338" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">不要在一个事务中使用无界循环，这可能导致一个事务由于气体成本超过块气体限制而永远无法到达区块链。(参见<a class="ae jn" href="https://github.com/wissalHaji/solidity-coding-advices/blob/master/best-practices/be-careful-with-loops.md" rel="noopener ugc nofollow" target="_blank">此链接</a>)</li><li id="a437" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">如果合同不应该接收乙醚，则不要使用<code class="du mo mp mq mr b">address(this).balance</code>基于合同余额进行任何逻辑，因为乙醚可以使用<code class="du mo mp mq mr b">selfdestrct(recipient)</code>强制发送到合同。</li><li id="c902" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">使用 openzeppelin 的 SafeMath 库来避免整数溢出和下溢。</li><li id="38c3" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">如果需要根据用户角色限制对功能的访问，可以使用 openzeppelin 库中的 AccessControl 契约。</li><li id="88f8" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">请勿使用<code class="du mo mp mq mr b">tx.origin</code>进行授权。</li><li id="828d" class="ma mb hi jq b jr mj ju mk jx ml kb mm kf mn kj om mg mh mi bi translated">在使用函数的参数之前，总是用 require 语句检查它们是否有效。</li></ul></div><div class="ab cl kk kl gp km" role="separator"><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp kq"/><span class="kn bw bk ko kp"/></div><div class="hb hc hd he hf"><h1 id="9828" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">结论</h1><p id="7801" class="pw-post-body-paragraph jo jp hi jq b jr lj ij jt ju lk im jw jx ll jz ka kb lm kd ke kf ln kh ki kj hb bi translated">这是本系列中介绍以太坊编程基础的最后一篇文章。如果你觉得你需要更高级的话题，这里有一些开始:<a class="ae jn" href="https://ethereum.org/en/developers/docs/oracles/" rel="noopener ugc nofollow" target="_blank">神谕</a>，<a class="ae jn" href="https://docs.openzeppelin.com/learn/sending-gasless-transactions" rel="noopener ugc nofollow" target="_blank">无气交易</a>。<br/>你可能还想看看 github 的一些工具:<br/><a class="ae jn" href="https://github.com/austintgriffith/scaffold-eth" rel="noopener ugc nofollow" target="_blank">scaffold-eth</a><br/><a class="ae jn" href="https://github.com/paulrberg/solidity-template" rel="noopener ugc nofollow" target="_blank">solidity-template</a></p><p id="b9ae" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">往期文章:<br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-introduction-327b1f9eb30e">学扎实:简介</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-variables-part-1-657fc27c2cc1">学扎实:变量第一部分</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-variables-part-2-f3b842f5bfb8">学扎实:变量第二部分</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-variables-part-3-3b02ca71cf06">学扎实:变量第三部分</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-functions-ddd8ea24c00d">学扎实:函数</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-smart-contract-creation-and-inheritance-8424adac3570">学扎实:智能契约创建与继承</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/learn-solidity-the-factory-pattern-75d11c3e7d29">学扎实:工厂模式</a> <br/> <a class="ae jn" rel="noopener" href="/better-programming/build-your-first-dapp-with-web3-js-9a7306d16a61">用 web3 构建您的第一个 dapp</a></p></div></div>    
</body>
</html>