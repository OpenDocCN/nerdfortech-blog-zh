<html>
<head>
<title>Beginners guide to Hangfire</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hangfire初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/a-beginners-guide-to-hangfire-6cda13315e74?source=collection_archive---------7-----------------------#2021-05-16">https://medium.com/nerd-for-tech/a-beginners-guide-to-hangfire-6cda13315e74?source=collection_archive---------7-----------------------#2021-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b6510845f0898458bb9d6f8e35ddc50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*92HJZ2eITOR1s741CLYXJQ.jpeg"/></div></div></figure><p id="de30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">想象一个网站，让用户管理自己每月的收入和支出。它甚至可以显示易读的图表以及有助于更好决策的见解。这个网站所需要的只是一个输入——一个标题为“支出”和“收入”的电子表格，以及下面相应的金额。</p><p id="ffa3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电子表格上传后，网站需要一些时间来处理信息。现在，如果用户最终需要等待很长时间才能获得输出，就会降低整体用户体验。如果处理任务在后台进行就好了，这样用户可以继续查看网站上的其他信息。为了实现这一点，网站开发人员需要有后台任务来处理上传的信息。这可以在中实现。Net编程的多种方式，包括内置的技术，如线程和任务。</p><p id="b28c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，在这篇博客中，我们将使用名为“Hangfire”的第三方库来实现相同的后台处理。事不宜迟，我们先来了解一下什么是Hangfire，以及如何使用Hangfire实现后台任务。</p><p id="1a87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="fce2" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">什么是Hangfire？</li><li id="7801" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用Hangfire实现后台任务</li><li id="ae83" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">包扎</li></ol><h1 id="64ed" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是Hangfire？</h1><p id="0fc5" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">Hangfire是一个开源框架，可用于在中执行后台处理。Net和。Net核心应用程序。它主要用于执行后台任务，如批量/电子邮件通知、文件批量导入、视频/图像处理、数据库维护、文件清除等。Hangfire可以用于具有高/低CPU消耗的后台任务、短/长时间运行的任务、循环作业、启动并忘记等等。</p><h1 id="6536" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">用Hangfire实现后台任务</h1><p id="58d5" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">为了使用Hangfire，我们将创建一个ASP。Net核心Web应用程序和API类型的应用程序。</p><h2 id="1c1f" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第一步</h2><p id="b6cf" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建一个ASP。Net Web应用程序，并为项目提供有效的名称和路径。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/69f8f3a7d346fc6d2ba7d34ddc71f13e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/0*1HLoJ1fq7EBP8L2p"/></div></figure><h2 id="7ba1" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第二步</h2><p id="1416" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">选择模板为API，版本为。网芯as 3.1。确保“为HTTPS配置”已选中。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/2323f6e8faa0d05b7d77f7429eb60b4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*19Og5RTYLy8mulK7"/></div></div></figure><h2 id="6cc7" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第三步</h2><p id="a44e" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">默认的API模板项目结构如下所示。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/7d353aa61fb6dea68e90833c9092ba5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/0*lPoKblYrkIa5k1Mv"/></div></figure><h2 id="f02d" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第四步</h2><p id="8d9f" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">让我们安装Hangfire所需的包，以便在项目中实现。要安装软件包，右键单击项目并单击Manage NuGet Packages。</p><p id="3bda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">软件包安装</strong></p><ul class=""><li id="073b" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn ma ju jv jw bi translated">绞刑。核心</li><li id="34bb" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ma ju jv jw bi translated">绞刑。AspNetCore</li><li id="aa2c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ma ju jv jw bi translated">绞刑。Core(这是用来利用代码内部的Hangfire内存存储的。有一个选项可以存储它们并在数据库级别维护它们(Install-Package Hangfire。SqlServer)，这提供了即使在应用程序重启时也能保持作业顺序和执行时间的优势)。</li></ul><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/07f4b288c6319d0e421f8cd553e18fc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JuaJ4cWNdDkCp6Yf"/></div></div></figure><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/ed165788424968d6ebedc41fc2b43d70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yjWCQCpjnSE64FDv"/></div></div></figure><h2 id="21a8" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第五步</h2><p id="b2c5" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">一旦安装了软件包，该过程就转移到在启动服务中配置已安装的软件包。为此，打开Startup.cs文件，转到ConfigureServices方法并添加以下行</p><pre class="lu lv lw lx fd mb mc md me aw mf bi"><span id="93fd" class="lf kd hi mc b fi mg mh l mi mj">services.AddHangfire(c =&gt; c.UseMemoryStorage()); JobStorage.Current = new MemoryStorage();</span></pre><p id="88ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你还需要参考下面的库。</p><pre class="lu lv lw lx fd mb mc md me aw mf bi"><span id="908a" class="lf kd hi mc b fi mg mh l mi mj">using Hangfire; using Hangfire.MemoryStorage;</span></pre><p id="26c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们使用存储作业数据的“memorystorage”方法来实例化Hangfire。</p><h2 id="90ab" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第六步</h2><p id="e7fb" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在同一个startup.cs文件的Configure方法中，添加以下行</p><p id="0d86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">app。UseHangfireServer()；</p><p id="89c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并在app.useEndpoints内添加端点。MapHangfireDashboard()；。</p><p id="f885" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该选项为我们提供了一个仪表板，可以提供Hangfire库正在处理的后台作业和重复作业的实时数据。</p><p id="32da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置完上述代码后，启动文件方法应该如下所示。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mk"><img src="../Images/90ceb0013bf89fbe4fa2cd8782f0ed13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*AaKYfAOhPmpZzY1Y"/></div></figure><h2 id="c423" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第七步</h2><p id="f29b" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一步是利用代码中的Hangfire。为此，请打开控制器— weatherforecastcontroller.cs，并在类的开头声明一个全局变量，以利用后台作业客户端注入。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/fd701e34dbf7fa871c45eb733ae8b36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*-SemcVjCI4jtTgtI"/></div></figure><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/d2487c12873e46f39faf3b39c66472fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SC-IFvU778nwIHDl"/></div></div></figure><h2 id="f4c6" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第八步</h2><p id="6580" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">利用Get方法中声明的变量，并添加以下代码行。这里，我们实现了一个后台任务，它在每次调用端点时运行。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/71ffc2596f1cae044ce79d8f681097d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/0*etj26vvoiiC6t1YO"/></div></figure><h2 id="7c28" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第九步</h2><p id="3669" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">现在要运行应用程序，打开运行应用程序选项中的下拉菜单，选择应用程序名“PARTECH_Hangfire”作为运行应用程序的默认方式。这将在所需的端口运行应用程序，并打开应用程序的控制台窗口(可用于跟踪我们在代码中输入的日志)。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/ebbe5241ed903e717a36c2bfb3ce2c11.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/0*sT9aY-h3mf_tEc7_"/></div></div></figure><h2 id="5f8f" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十步</h2><p id="9492" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">运行应用程序后，控制台窗口会打开，并指出应用程序已经启动。几秒钟后，它会记录我们已经登录到方法中的信息(已经入队)。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/894a04d3009a4a45fb93d4ddaf38ce7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*l_fI8KaD-rCulksX"/></div></div></figure><h2 id="0002" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">步骤11</h2><p id="6d9e" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一步是在我们的代码中使用Hangfire创建一个循环作业。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mo"><img src="../Images/560c76bdacac6e672b4726735b6be811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/0*GTI9Bm6WFH16PnxU"/></div></figure><p id="fdba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，在weatherforecastcontroller.cs文件中，添加全局变量并分配注入的值，就像我们对后台作业客户端所做的那样。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/97233767e196bac3a4c5791b347fbffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*76XqcWZoW5cpmDi-"/></div></div></figure><h2 id="dd39" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">步骤12</h2><p id="b2ca" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">利用循环作业变量，并添加一个将被定期调用的日志。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/a3cc591af4ab07132b10b2652ca52ff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aYnweeb4ITOgGtn1"/></div></div></figure><p id="ada9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，上面的行被分成三部分，第一部分是jobid，第二部分是必须执行的任务，最后一部分是Cron表达式，它规定了必须重复该作业的时间范围。在我们的示例中，作业将每一分钟重复一次。</p><h2 id="cb49" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十三步</h2><p id="2000" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">运行应用程序以观察结果。每隔一分钟就会执行一次日志消息。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/e624e58d8bccc34d579e8996dec6ada0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LqbgARSWyzBMSVp7"/></div></div></figure><p id="00f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，Hangfire还提供了一个选项来可视化作业并查看每个作业的结果(成功或失败)(按天和按周)。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/621b27c4cbc40b3d5f2f344bcc05ce7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pQhYy6zOtgDj8-ae"/></div></div></figure><p id="16f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，它还提供了一个选项来查看通过代码配置的重复性作业，并提供了一个选项来在运行时删除它们。它还列出了正在运行的活动Hservers。仪表盘还提供了很多更酷的功能，可以方便地维护作业。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/a8f36cadd90e99443c4936efd648cfc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u5Y7aQ2tEwpnZS_u"/></div></div></figure><h1 id="ddf4" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="37b6" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">正如我们在这篇博客中看到的，Hangfire令人印象深刻，易于安装/使用，用户友好(通过仪表板)，并且可以立即部署。总之，使用Hangfire，配置和运行后台和循环作业是一项非常简单的任务。</p></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><p id="4204" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mw">原载于</em><a class="ae mx" href="https://www.partech.nl/nl/publicaties/2021/05/a-beginners-guide-to-hangfire" rel="noopener ugc nofollow" target="_blank"><em class="mw">https://www . partech . nl</em></a><em class="mw">。</em></p></div></div>    
</body>
</html>