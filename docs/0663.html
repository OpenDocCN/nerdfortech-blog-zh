<html>
<head>
<title>Giving a Voice to Rasa with Botium Speech</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用波特姆语给拉莎一个声音</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/giving-a-voice-to-rasa-with-botium-speech-1c65a7513bdf?source=collection_archive---------2-----------------------#2021-02-02">https://medium.com/nerd-for-tech/giving-a-voice-to-rasa-with-botium-speech-1c65a7513bdf?source=collection_archive---------2-----------------------#2021-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4cd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像 Alexa 和 Google Assistant 这样的语音平台可以轻松构建自己的语音体验，甚至无需深入音频处理——一切都是平台的一部分。但是，如果你想选择一个由你自己托管的解决方案，在你自己的网站上，在你自己的基础设施中运行一个助手呢？</p><p id="c0c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章的目标是展示如何使用开源工具<a class="ae je" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>和<a class="ae je" href="https://github.com/codeforequity-at/botium-speech-processing" rel="noopener ugc nofollow" target="_blank"> Botium 语音处理</a>构建自己的语音平台。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/fdbe663a95d9332dd07833e12f1f093b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sA-l3c-rxpwZj_wtRqU5tg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">一个令人敬畏的立体视觉</figcaption></figure><p id="a00c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rasa 是一个开发人员友好的、可扩展的聊天机器人构建工具，用于自托管。Botium Speech Processing 是一个统一的、开发人员友好的 API，提供最好的免费和开源的语音到文本和文本到语音服务。让我们结合这一点，但首先让我们快速看一下架构。</p><h1 id="6b6b" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">体系结构</h1><ol class=""><li id="29e6" class="kt ku hi ih b ii kv im kw iq kx iu ky iy kz jc la lb lc ld bi translated">用户对着麦克风说话</li><li id="a067" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">语音到文本服务翻译成文本<strong class="ih hj">(语音处理)</strong></li><li id="e515" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">NLU 引擎从文本<strong class="ih hj"> (Rasa) </strong>中提取信息</li><li id="de67" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">对话引擎构建文本响应<strong class="ih hj"> (Rasa) </strong></li><li id="8543" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">文本到语音服务翻译成口语文本<strong class="ih hj">(语音处理)</strong></li><li id="ed11" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">用户收听音频文件</li></ol><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lj"><img src="../Images/676297300e39cfdd045d9f2cc076d85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lNFooupZpiOaJPEM"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">图片来自<a class="ae je" href="https://blog.rasa.com/how-to-build-a-voice-assistant-with-open-source-rasa-and-mozilla-tools/" rel="noopener ugc nofollow" target="_blank">这篇 Rasa 博文</a></figcaption></figure></div><div class="ab cl lk ll gp lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="hb hc hd he hf"><h1 id="085c" class="jv jw hi bd jx jy lr ka kb kc ls ke kf kg lt ki kj kk lu km kn ko lv kq kr ks bi translated">安装步骤</h1><p id="deb7" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">所以让我们来看有趣的部分。</p><h2 id="21b4" class="lz jw hi bd jx ma mb mc kb md me mf kf iq mg mh kj iu mi mj kn iy mk ml kr mm bi translated">先决条件</h2><p id="2bc4" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">以下是您需要在工作站上提供的内容:</p><ul class=""><li id="d4df" class="kt ku hi ih b ii ij im in iq mn iu mo iy mp jc mq lb lc ld bi translated">Git 客户端</li><li id="77fa" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc mq lb lc ld bi translated">Docker 和 Docker-撰写</li></ul><h2 id="7546" class="lz jw hi bd jx ma mb mc kb md me mf kf iq mg mh kj iu mi mj kn iy mk ml kr mm bi translated">启动 Botium 语音处理服务</h2><p id="b389" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">Botium 语音处理带有合理的默认配置。</p><ul class=""><li id="f3ac" class="kt ku hi ih b ii ij im in iq mn iu mo iy mp jc mq lb lc ld bi translated"><a class="ae je" href="http://mary.dfki.de/" rel="noopener ugc nofollow" target="_blank">用于文本到语音转换的 MaryTTS </a></li><li id="304e" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc mq lb lc ld bi translated"><a class="ae je" href="https://kaldi-asr.org/" rel="noopener ugc nofollow" target="_blank"> Kaldi </a>用于语音转文本</li></ul><blockquote class="mr ms mt"><p id="898c" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">它们都是免费和开源的，是语音技术入门的好搭档，另一方面，它们无疑是最好的免费语音工具之一。</p></blockquote><p id="d568" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">启动它可以通过几个命令行调用来完成。</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="1a63" class="lz jw hi my b fi nc nd l ne nf">$ git clone <a class="ae je" href="https://github.com/codeforequity-at/botium-speech-processing.git" rel="noopener ugc nofollow" target="_blank">https://github.com/codeforequity-at/botium-speech-processing.git</a><br/>$ cd botium-speech-processing<br/>$ docker-compose up -d</span></pre><blockquote class="mr ms mt"><p id="dfe4" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">根据网络速度和硬件，这一步可能需要一段时间。</p></blockquote><p id="ed3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将你的浏览器指向 http://localhost 将会显示 Botium 语音处理的 API explorer。</p><h2 id="e040" class="lz jw hi bd jx ma mb mc kb md me mf kf iq mg mh kj iu mi mj kn iy mk ml kr mm bi translated">设置 Rasa</h2><p id="64ec" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">我们将以 Rasa 演示机器人 Sara 为例。</p><blockquote class="mr ms mt"><p id="860d" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">你可以从<a class="ae je" href="https://github.com/RasaHQ/rasa-demo" rel="noopener ugc nofollow" target="_blank"> Github 资源库</a>中找到第一手资料</p></blockquote><p id="6e6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我更喜欢使用 Docker，而不是在本地安装所有东西。因此，您可以使用这些命令行调用来下载 Rasa 演示机器人并运行第一次培训:</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="0422" class="lz jw hi my b fi nc nd l ne nf">$ git clone <a class="ae je" href="https://github.com/RasaHQ/rasa-demo.git" rel="noopener ugc nofollow" target="_blank">https://github.com/RasaHQ/rasa-demo.git</a><br/>$ cd rasa-demo<br/>$ docker run --rm -v .:/app rasa/rasa:latest-full train --domain domain.yml --data data/core data/nlu --out models/dialogue --augmentation 0</span></pre><blockquote class="mr ms mt"><p id="8ae5" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">根据网络速度和硬件，这一步可能需要一段时间。</p></blockquote><p id="9fa1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将这个<em class="jd"> docker-compose.yml </em>文件放到 Rasa 文件夹中:</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="24d1" class="lz jw hi my b fi nc nd l ne nf">version: '3.0'<br/>services:<br/>  rasa:<br/>    image: rasa/rasa:latest-full<br/>    ports:<br/>      - 5005:5005<br/>    volumes:<br/>      - ./:/app<br/>    environment:<br/>      RASA_DUCKLING_HTTP_URL: http://rasa-duckling:8000<br/>    command: run --model models/dialogue --endpoints endpoints.yml<br/>  rasa-actions:<br/>    build:<br/>      context: .<br/>    ports:<br/>      - 5055:5055<br/>  rasa-duckling:<br/>    image: rasa/duckling<br/>    ports:<br/>      - 8000:8000</span></pre><p id="2ec1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在文件<em class="jd"> endpoints.yml </em>中，将动作端点 url 从<em class="jd">http://localhost:5055/web hook</em>更改为<em class="jd">http://rasa-actions:5055/web hook</em>。现在启动 Rasa 服务:</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="c2c5" class="lz jw hi my b fi nc nd l ne nf">$ docker-compose up -d</span></pre><p id="f5f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Rasa 服务正在等待连接。</p><h2 id="62dd" class="lz jw hi bd jx ma mb mc kb md me mf kf iq mg mh kj iu mi mj kn iy mk ml kr mm bi translated">为 Rasa 添加语音功能</h2><p id="0fa2" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated"><a class="ae je" href="https://github.com/codeforequity-at/botium-speech-processing/tree/master/connectors/rasa" rel="noopener ugc nofollow" target="_blank">这个 Github 库</a>包括一个基于 Rasa 内置 Socket.io-connector 的<a class="ae je" href="https://rasa.com/docs/rasa/connectors/custom-connectors/" rel="noopener ugc nofollow" target="_blank">定制连接器</a>，它为 Rasa 增加了语音到文本和文本到语音的功能。</p><p id="f5f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，克隆存储库并将连接器文件夹复制到 Rasa 文件夹:</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="f8ad" class="lz jw hi my b fi nc nd l ne nf">$ <!-- -->git clone <a class="ae je" href="https://github.com/codeforequity-at/botium-speech-processing.git" rel="noopener ugc nofollow" target="_blank">https://github.com/codeforequity-at/botium-speech-processing.git</a><br/>$ cd botium-speech-processing<br/>$ cp -R connectors &lt;rasa-dir&gt;</span></pre><p id="1035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在文件<em class="jd">connectors/rasa/credentials . yml</em>中，有一个 Rasa 自定义连接器的<strong class="ih hj">示例</strong> <strong class="ih hj">配置</strong>。</p><blockquote class="mr ms mt"><p id="00d1" class="if ig jd ih b ii ij ik il im in io ip mu ir is it mv iv iw ix mw iz ja jb jc hb bi translated">你可以直接使用这个文件或者复制<em class="hi">僵尸工具的配置。socketivoice input</em>连接器连接到您现有的 Rasa <em class="hi">凭证. yml </em></p></blockquote><p id="4521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将文件更改为指向本地工作站进行语音处理(为了方便和其他测试，它还会启动一个 REST 连接器):</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="57a1" class="lz jw hi my b fi nc nd l ne nf">botium.SocketIOVoiceInput:<br/>  socketio_path: /socket.io<br/>  user_message_evt: user_uttered<br/>  bot_message_evt: bot_uttered<br/>  session_persistence: false<br/>  botium_speech_url: <a class="ae je" href="https://speech.botiumbox.com" rel="noopener ugc nofollow" target="_blank">http://l</a>ocalhost<br/>  botium_speech_apikey:<br/>  botium_speech_language: en<br/>  botium_speech_voice: dfki-poppy-hsmm</span><span id="2a32" class="lz jw hi my b fi ng nd l ne nf">rest:</span></pre><p id="4ff0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，为 Rasa 更改<em class="jd"> docker-compose.yml </em>文件以使用该连接器。</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="0a1e" class="lz jw hi my b fi nc nd l ne nf">version: '3.0'<br/>services:<br/>  rasa:<br/>    image: rasa/rasa:latest-full<br/>    ports:<br/>      - 5005:5005<br/>    volumes:<br/>      - ./:/app<br/>    environment:<br/>      PYTHONPATH: "/app/connectors/rasa:/app"<br/>      RASA_DUCKLING_HTTP_URL: http://rasa-duckling:8000<br/>    command: run --cors "*" --credentials /app/connectors/rasa/credentials.yml --enable-api --model models/dialogue --endpoints endpoints.yml<br/>  rasa-actions:<br/>    build:<br/>      context: .<br/>    ports:<br/>      - 5055:5055<br/>  rasa-duckling:<br/>    image: rasa/duckling<br/>    ports:<br/>      - 8000:8000</span></pre><p id="6468" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重新启动 Rasa，对 Docker 容器进行修改。</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="84fd" class="lz jw hi my b fi nc nd l ne nf">$ docker-compose up -d</span></pre><h1 id="be98" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">测试</h1><p id="5d1d" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">Botium 语音处理项目中有一个基于<a class="ae je" href="https://github.com/RasaHQ/rasa-voice-interface" rel="noopener ugc nofollow" target="_blank"> Rasa 语音接口</a>的简单测试客户端。</p><p id="154d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="jd"> connectors/rasa/client </em>目录中，更改<em class="jd"> docker-compose.yml </em>文件中的 rasa 端点:</p><pre class="jg jh ji jj fd mx my mz na aw nb bi"><span id="cd55" class="lz jw hi my b fi nc nd l ne nf">version: '3'<br/>services:<br/>  frontend:<br/>    build:<br/>      context: .<br/>      args:<br/>        RASA_ENDPOINT: <a class="ae je" href="https://demo.botiumbox.com" rel="noopener ugc nofollow" target="_blank">http://l</a>ocalhost:5005<br/>        RASA_PATH: /socket.io<br/>        PUBLIC_PATH: /<br/>    image: botium/botium-speech-rasa-voice<br/>    restart: always<br/>    ports:<br/>      - 4700:8080</span></pre><p id="0126" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后使用<em class="jd">“docker-compose up-d”</em>启动网站，并访问位于<a class="ae je" href="http://localhost:4700" rel="noopener ugc nofollow" target="_blank"> http://localhost:4700 </a>的 web 界面，与您的 Rasa 聊天机器人聊天。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nh"><img src="../Images/ffed97e3212c9d5aafa122d72ae38b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6646Otl8L_OqEH_P5Oc81Q.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">运行中的语音界面</figcaption></figure><p id="3533" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候运行您的麦克风和扬声器，并与 Rasa 聊天了！</p><p id="ecdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看到这篇西班牙文的文章<a class="ae je" href="https://planetachatbot.com/dando-voz-a-rasa-con-botium-speech-4b6b67319efd" rel="noopener ugc nofollow" target="_blank">这里</a>！🇪🇸</p></div></div>    
</body>
</html>