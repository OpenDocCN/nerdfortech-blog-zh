<html>
<head>
<title>What are Proxies in Purescript?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Purescript 中的代理是什么？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-are-proxies-in-purescript-b4ebe38aa919?source=collection_archive---------1-----------------------#2022-08-19">https://medium.com/nerd-for-tech/what-are-proxies-in-purescript-b4ebe38aa919?source=collection_archive---------1-----------------------#2022-08-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1a6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有没有遇到过这样的情况，你想传递一个类型而不是值，或者你被我刚才说的搞糊涂了？让我解释一下。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b27e76dcc511a6bb46472635e284abe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UF0r4Qh0M3sgF9YpdfWvcg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><a class="ae jt" href="https://unsplash.com/@ranjbarpic?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Abolfazl Ranjbar </a>在<a class="ae jt" href="https://unsplash.com/s/photos/paper-rocket?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍照</figcaption></figure><p id="014b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们先了解一下，类型和值之间有什么区别。</p><pre class="je jf jg jh fd ju jv jw bn jx jy bi"><span id="3870" class="jz ka hi jv b be kb kc l kd ke">myFavoriteNumber :: Int<br/>myFavoriteNumber = 3</span></pre><pre class="kf ju jv jw bn jx jy bi"><span id="325b" class="jz ka hi jv b be kb kc l kd ke">myName :: String<br/>myName = "Saravanan"</span></pre><pre class="kf ju jv jw bn jx jy bi"><span id="6857" class="jz ka hi jv b be kb kc l kd ke">newtype Email = Email String<br/><br/>myEmail :: Email <br/>myEmail = Email "saravanan.m@gmail.com"</span></pre><p id="083d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，所有出现在`::'后面的东西称为类型，出现在左边的东西称为值。</p><p id="c6a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果考虑<code class="du kg kh ki jv b">myFavoriteNumber</code>，<code class="du kg kh ki jv b">3</code>是数值，<code class="du kg kh ki jv b">Int</code>是类型。</p><p id="82c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们总是传递值给一个函数，如果我们简单地传递<code class="du kg kh ki jv b">Int </code>给它，而不是指定它的值，函数会做什么？(两个整数相加，输出是多少？)</p><p id="36de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有没有什么地方我们想传递类型而不是值？这可能吗？是的，这在很多情况下都是可能的和有用的。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="a061" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你们都熟悉类型类<code class="du kg kh ki jv b"><a class="ae jt" href="https://pursuit.purescript.org/packages/purescript-prelude/6.0.1/docs/Data.Bounded#t:Bounded" rel="noopener ugc nofollow" target="_blank">Bounded</a></code>，它有两个值<code class="du kg kh ki jv b">top</code>和<code class="du kg kh ki jv b">bottom</code>，分别给出定义它的相应类型的最高值和最低值。(不知道也没什么大不了，继续看就好)</p><p id="f71a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设您想要创建一个函数来打印特定类型的最低和最高可能值</p><pre class="je jf jg jh fd ju jv jw bn jx jy bi"><span id="c79f" class="jz ka hi jv b be kb kc l kd ke">getRange :: forall a. Bounded a =&gt; {lowest :: a , highest :: a }<br/>getRange  = { lowest :  bottom<br/>            , highest :  top<br/>            }</span></pre><p id="0a83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是这个不行，为什么？编译器如何决定我们想要哪个顶部，哪个底部..？我们想要 String 或 Int 或任何其他类型的顶部？我们如何在这里指定类型呢？</p><p id="1daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以这样做，</p><pre class="je jf jg jh fd ju jv jw bn jx jy bi"><span id="afe2" class="jz ka hi jv b be kb kc l kd ke">getRange :: forall a.(Bounded a) =&gt; a -&gt; {lowest :: a,highest :: a }<br/>getRange _ = { lowest :  bottom<br/>             ,  highest :  top<br/>             }</span></pre><p id="5c33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以这样调用这个函数</p><pre class="je jf jg jh fd ju jv jw bn jx jy bi"><span id="550e" class="jz ka hi jv b be kb kc l kd ke">&gt;&gt;&gt; getRange 1<br/>{lowest: -2147483648, highest: 2147483647 }<br/><br/>&gt;&gt;&gt; getRange false<br/>{lowest: false, highest: true }<br/><br/>&gt;&gt;&gt; getRange 1.0<br/></span></pre><p id="8bd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在 purescript 编译器知道我们想要哪个<code class="du kg kh ki jv b">top</code>，<code class="du kg kh ki jv b">bottom</code>。</p><p id="4fe5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是传递一个值在这里没有意义，我们甚至没有使用这个值。那么为什么我们在这里传递一个像<code class="du kg kh ki jv b">1</code>、<code class="du kg kh ki jv b">false</code>、<code class="du kg kh ki jv b">1.0</code>这样的值呢？</p><p id="ca95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只能通过<code class="du kg kh ki jv b">Int</code>、<code class="du kg kh ki jv b">Boolean</code>、<code class="du kg kh ki jv b">Number</code>类型吗？</p><p id="8754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，我们可以，这正是代理人的作用。让我们看看代理的定义</p><pre class="je jf jg jh fd ju jv kq kr aw ks bi"><span id="508d" class="kt ka hi jv b fi ku kv l kw ke">data Proxy a = Proxy</span></pre><p id="7ac5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代理只有一个没有参数的构造函数(Proxy)，有趣的部分是左边的<code class="du kg kh ki jv b">a</code>，通过这个<code class="du kg kh ki jv b">a</code>(称为<a class="ae jt" href="https://wiki.haskell.org/Phantom_type" rel="noopener ugc nofollow" target="_blank">幻影类型</a>)我们可以<code class="du kg kh ki jv b">encode</code>类型信息。</p><p id="30f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我这里说的<code class="du kg kh ki jv b">encode</code>到底是什么意思？</p><p id="8f95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代理将充当 T 类型的持有者，你可以在其中编码(持有)一个类型，请看下面的例子</p><pre class="je jf jg jh fd ju jv kq kr aw ks bi"><span id="d916" class="kt ka hi jv b fi ku kv l kw ke">_intProxy :: Proxy Int<br/>_intProxy = Proxy</span><span id="26be" class="kt ka hi jv b fi kx kv l kw ke">_numberProxy :: Proxy Number<br/>_numberProxy = Proxy</span></pre><p id="a4e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里<code class="du kg kh ki jv b">_intProxy</code>和<code class="du kg kh ki jv b">_numberProxy</code>的值是相同的(<strong class="ih hj">代理</strong>)(是的，它们实际上是没用的)</p><p id="d406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是他们的类型。</p><p id="2a32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它们的类型以一种非常微妙的方式不同(<strong class="ih hj">代理&lt;类型&gt;类型</strong>)这里的<strong class="ih hj"> <em class="ky"> &lt;类型&gt; </em> </strong>帮助携带<em class="ky">额外的类型信息。</em></p><p id="7567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<code class="du kg kh ki jv b">_intProxy</code>其<code class="du kg kh ki jv b">Int</code>对于<code class="du kg kh ki jv b">_numerProxy</code>其<code class="du kg kh ki jv b">Number</code></p><p id="35f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么我们如何在上面的例子中使用编码的类型信息呢？</p><p id="a470" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的函数<code class="du kg kh ki jv b">getRange</code>中，我们可以不传递<code class="du kg kh ki jv b">a</code>，而是传递<code class="du kg kh ki jv b">Proxy a</code></p><pre class="je jf jg jh fd ju jv kq kr aw ks bi"><span id="cf38" class="kt ka hi jv b fi ku kv l kw ke">getRange :: forall a. (Bounded a) <br/>           -&gt; Proxy a<br/>           =&gt; {lowest :: a , highest :: a }<br/>getRange _ = { lowest :  bottom<br/>             ,  highest :  top<br/>             }</span></pre><p id="5c4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你可以做一些事情</p><pre class="je jf jg jh fd ju jv jw bn jx jy bi"><span id="41ae" class="jz ka hi jv b be kb kc l kd ke">&gt;&gt;&gt; getRange _intProxy <br/>{lowest: -2147483648, highest: 2147483647 }</span></pre><pre class="kf ju jv jw bn jx jy bi"><span id="ef23" class="jz ka hi jv b be kb kc l kd ke">&gt;&gt;&gt; getRange (Proxy :: Proxy Boolean)-- boolean proxy defined inline<br/>{lowest: false, highest: true }</span></pre><pre class="kf ju jv jw bn jx jy bi"><span id="79ee" class="jz ka hi jv b be kb kc l kd ke">&gt;&gt;&gt; getRange 1.0 <br/>{ lowest: -Infinity, highest: -Infinity }</span></pre><blockquote class="kz la lb"><p id="6db1" class="if ig ky ih b ii ij ik il im in io ip lc ir is it ld iv iw ix le iz ja jb jc hb bi translated">注意:我们必须明确指定代理的类型，以表明代理中的<code class="du kg kh ki jv b">a</code>是什么类型。</p></blockquote><p id="9ed9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代理只不过是传递类型信息的一种方式，它们广泛用于类型信息足以做出决定的地方，比如类型类实例选择。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="49ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有其他类型的代理，如 SProxy(捕获符号)、RLProxy(用于行类型)等。但是这些都被否决了，所以知道<code class="du kg kh ki jv b">Proxy</code>就足够了😉</p></div></div>    
</body>
</html>