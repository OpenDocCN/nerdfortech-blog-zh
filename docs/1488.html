<html>
<head>
<title>Deploying a Gitlab Repository and Runner Server on Google Cloud.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Google Cloud上部署Gitlab存储库和Runner服务器。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploying-a-gitlab-repository-and-runner-server-on-google-cloud-57b9d490c975?source=collection_archive---------4-----------------------#2021-03-22">https://medium.com/nerd-for-tech/deploying-a-gitlab-repository-and-runner-server-on-google-cloud-57b9d490c975?source=collection_archive---------4-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6c7994dae308a19a1255807e648ff0b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AFZiUU_9AH4PuM7gjt9pg.png"/></div></div></figure><p id="5dbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本教程是本帖的一个子部分，在这里你可以找到如何运行你的Android工具测试，以及如何使用Gitlab可视化合并请求上新代码的覆盖率。在这篇文章中，你会发现如何设置两个服务器，一个用于Gitlab仓库，另一个用于Google Cloud上的Gitlab Runner。</p><h1 id="504d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">建筑</strong></h1><p id="9964" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们将使用以下架构:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ks"><img src="../Images/1542c2b85e1ea877b04c728a41c5c787.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rdRBnoUcH23XXqY7ha_7xQ.png"/></div></div></figure><p id="5532" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要两台服务器，第一台用作Git资源库:<em class="kx"> gitlab-repository-server </em>，第二台将运行我们的管道:<em class="kx"> gitlab-runner-server </em></p><p id="38d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这只是在Gitlab上启用CI/CD的一种方式，事实上，您可以在您的本地机器上注册跑步者或使用类似<a class="ae jo" href="https://docs.gitlab.com/runner/executors/kubernetes.html" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>的东西，这背后的美妙之处在于模块化和可用的倍数选项。</p><p id="a194" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开您的Google Cloud帐户，进入计算引擎&gt;创建实例。</p><p id="185c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于本教程，我将选择一个e2-standard-4，100 GB SSD磁盘和ubuntu20:04，这种CPU/RAM配置对于概念验证来说是可以的，但如果您打算将它用作团队的Git存储库，您肯定需要更多的功率。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/873e50a58697fb6c6764f7170f76a58f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*I44UKoQMWnHvWKIb7A5zbA.png"/></div></figure><p id="7656" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">获取一个静态外部Ip，如果没有，google将在每次重启服务器时为您重新分配一个可用的IP地址，您必须重新配置许多东西，单击<em class="kx">管理、安全性、磁盘、网络、单独租赁</em>并转到<em class="kx">网络</em>选项卡，选择编辑图标并在外部IP下选择保留静态IP地址，保留其他选项为默认。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/229b4c7ee6780da527e091f846d8c31c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*MZfdLSnuaWB5qnznNqdciQ.png"/></div></figure><p id="be82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的最终设置应该是这样的，不要忘记标记允许HTTP流量，现在，我们不会设置HTTPS:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es la"><img src="../Images/beeb1c57a14e808f136735d67f912e5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*9V7fmDPLVnQnU7g6Ya8zgA.png"/></div></figure><h1 id="82a3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">允许来自端口5037的流量</strong></h1><p id="a7e7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">对于ADB守护进程，我们必须允许端口5037上<em class="kx"> gitlab-runner-server </em>和您的笔记本电脑之间的流量。在左侧面板中，在网络上选择VPC网络和防火墙:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/ea0e65aa885011abab359fc198f769b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*ogoknnej6Gzi4GJVm0dsPQ.png"/></div></figure><blockquote class="lc ld le"><p id="2371" class="iq ir kx is b it iu iv iw ix iy iz ja lf jc jd je lg jg jh ji lh jk jl jm jn hb bi translated">这些规则对于生产环境来说太宽泛了，我们允许来自所有网络的各种流量从所有实例到达我们的端口5037。您必须设置一个特定规则，允许您团队中的少数人访问该端口，并与您公司的安全团队一起检查防火墙规则，否则，您可能会在您公司的网络上引入一个漏洞。</p></blockquote><p id="0b0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是入口流量的设置:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es li"><img src="../Images/9cd0a93ae687afe53e283b2cf113d1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*a501vY_rMSLtStTEzbnTbQ.png"/></div></figure><p id="b81f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于处理出口流量，重复上述步骤，稍作修改，首先将名称改为类似于<em class="kx"> allow-5037-egress，</em>选择出口作为流量方向。</p><p id="9dd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">向服务器添加ssh元数据。</strong></p><p id="47ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在linux/osx上，检查ssh的本地文件夹，您应该会看到一个以。酒馆，在您的终端上:</p><p id="218f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ls ~/。嘘</p><p id="fd90" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果没有，您应该创建一个新的密钥，键入:</p><p id="1d54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ssh-keygen</p><p id="e160" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输入所需数据或按Enter键跳过每个提示，在生产中，您必须使用具有强密码的密钥。这个命令将为您生成两个文件id_rsa和id_rsa.pub，您不能与任何人共享文件id_rsa，因为这是您的私钥，请妥善保管。</p><p id="634b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您完成后，获取您的全新密钥，我们将使用它，以便您的服务器可以与您的笔记本电脑通信，而无需每次询问密码。</p><p id="e3c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">猫~/。ssh/id_rsa.pub</p><p id="2b44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">复制所有输出并粘贴到计算引擎&gt;设置&gt;元数据SHH键选项卡，编辑按钮，添加项目，并保存。在该部分下保存用户名，我们将使用它通过ssh进行连接。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/4ec400ea1795a38e7acb1977e5f2340f.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*mY7mITPvw5KYr5qhJcj-9w.png"/></div></div></figure><p id="3f6b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将使用jimraynor用户连接到服务器。</p><h1 id="5d1a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">配置Gitlab存储库服务器。</strong></h1><p id="c1e8" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">打开一个终端，我们将使用ssh连接到我们的gitlab-repository-server，我的用户是jimraynor，来自我的服务器的外部IP是77.111.24.77，第一次它会提示询问“是一个安全的地方”键入yes::</p><p id="c30f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">宋承宪jimraynor@77.111.24.77</p><p id="3687" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://about.gitlab.com/install/?version=ce#ubuntu" rel="noopener ugc nofollow" target="_blank">git lab网站上的说明</a>:</p><p id="eaf3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx">sudo apt-get install-y curl OpenSSH-server ca-certificates tz data perl</em></p><p id="ed1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx"> sudo apt-get install -y后缀</em></p><p id="7edd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们不打算配置电子邮件，因此单击“否”</p><p id="3b2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx">curl-sS</em><a class="ae jo" href="https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh" rel="noopener ugc nofollow" target="_blank"><em class="kx">https://packages . gitlab . com/install/repositories/gitlab/gitlab-ce/script . deb . sh</em></a><em class="kx">| sudo bash</em></p><p id="f5bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以为该地址配置DNS，并将EXTERNAL_URL设置为domain，但目前我们不会这样做。现在复制您的外部IP，在我的例子中是77.111.24.77，注意不要使用服务器本地IP(以10.xxx.xxx.xxx开始)，否则，您无法从google intranet的外部连接，除非进行一些额外的步骤:</p><p id="9e0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">sudo EXTERNAL _ URL = " http://77 . 111 . 24 . 77 " apt-get安装gitlab-ce</p><p id="d049" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">等待大约10分钟，你现在在谷歌云上有一个Gitlab存储服务器，从你的外部URL访问它，在我的例子中是http://77.111.24.77</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/9685a13290ccc8dfc885769cb319d35e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ToS1oIAYil_BzqmCWrryhQ.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">Gitlab安装完成</figcaption></figure><p id="b903" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您必须设置您的root密码。使用root作为用户名登录。</p><p id="460e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们应该添加我们的公钥，单击您的个人资料图像、首选项、ssh-keys，并添加密钥，这样我们就可以克隆、拉和推，而无需每次在笔记本电脑上使用Gitlab凭据进行身份验证。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/5b1c2e9a829eae5c67f7eb8f1eccaaaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HpIDXGDIzfe4drYFHJFtow.png"/></div></div></figure><p id="28f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你完了！Gitlab存储库已启动并运行，让我们开始使用Gitlab Runner服务器吧！</p><h1 id="bb28" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">配置Gitlab Runner服务器。</strong></h1><p id="0280" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在这个服务器中，我们需要Docker来运行管道，按照来自Docker.com的<a class="ae jo" href="https://docs.docker.com/engine/install/ubuntu/#install-using-the-repository" rel="noopener ugc nofollow" target="_blank">指令</a>使用您的用户名和服务器的外部IP通过ssh连接到您的实例:</p><p id="c095" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">【jimraynor@104.128.137.30 T2】宋承宪</p><p id="ea3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在终端上:</p><pre class="kt ku kv kw fd lq lr ls lt aw lu bi"><span id="3b5c" class="lv jq hi lr b fi lw lx l ly lz"><em class="kx">sudo apt-get update</em></span><span id="7997" class="lv jq hi lr b fi ma lx l ly lz"><em class="kx">sudo apt-get install -y apt-transport-https ca-certificates curl gnupg lsb-release</em></span><span id="bee8" class="lv jq hi lr b fi ma lx l ly lz">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg</span><span id="61dd" class="lv jq hi lr b fi ma lx l ly lz">echo \<br/>  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu \<br/>  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null</span><span id="3fa0" class="lv jq hi lr b fi ma lx l ly lz"><em class="kx">sudo apt-get update</em></span><span id="2c13" class="lv jq hi lr b fi ma lx l ly lz"><em class="kx">sudo apt-get install -y docker-ce docker-ce-cli containerd.io</em></span></pre><p id="0499" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们有码头工人！接下来，用Android的工具箱(命令行工具，平台工具等)拉一个图像，我将使用这个<a class="ae jo" href="https://gitlab.com/ciandroidinstrumentationtest/android_build_container" rel="noopener ugc nofollow" target="_blank">图像</a>，但是你可以选择任何让你使用ADB和gradle的。</p><p id="eb06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<em class="kx"> gitlab-runner-server </em>的终端上:</p><p id="e06f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx">sudo docker image pull Andres maca/Android _ build _ container:1.0</em></p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/ff876559adbad6549877850bb9e87c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PG6ipBY8cy2jnVZh0KSbKg.png"/></div></div></figure><p id="e66f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将一部安卓手机连接到你的笔记本电脑，然后<a class="ae jo" href="https://developer.android.com/studio/debug/dev-options#enable" rel="noopener ugc nofollow" target="_blank">启用开发者选项</a>。在本地计算机上打开终端，并键入:</p><p id="bae8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">adb设备</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/8642824a99f8b96669d22faa882b4e39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-6K4lrpfTOBYYZjsxWrHBA.png"/></div></div></figure><p id="a9d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目标是参赛者可以使用您本地计算机的adb@localhost:5037，在您本地计算机的终端上实现:</p><p id="e7d2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kx"> ssh -XC -v -R 5037:本地主机:5037 jimraynor@104.128.137.30</em></p><p id="7382" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将jimraynor和IP地址替换为你的用户名Gitlab Runner服务器的外部IP地址，不要关闭终端，因为这是“桥”。</p><p id="41d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在新的终端窗口中，通过SSH再次连接到Gitlab Runner存储库，并键入:</p><pre class="kt ku kv kw fd lq lr ls lt aw lu bi"><span id="5217" class="lv jq hi lr b fi lw lx l ly lz">sudo docker run -it --network=host andresmaca/android_build_container:1.0 /bin/bash</span></pre><p id="9dbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦你进入集装箱，你就可以使用ADB。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/36165afdd421e05d63b332022e10c163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IC3U-FZ6YV1fP-cG0k3sKg.png"/></div></div></figure><p id="1ca1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">在Gitlab项目中注册跑步者。</strong></p><p id="2c65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用实例的外部IP地址通过浏览器访问Gitlab实例。选择一个项目以添加您的跑步者，然后进入设置&gt; CI/CD &gt;跑步者。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/5128a3a1827560b8d4ce151b9a63ce79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5k1fqKnA_eJ7PwZ7T1HfRQ.png"/></div></div></figure><p id="ac12" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在通过ssh访问您的Gitlab Runner实例，我们必须添加gitlab runner并注册它。在控制台上:</p><pre class="kt ku kv kw fd lq lr ls lt aw lu bi"><span id="17f5" class="lv jq hi lr b fi lw lx l ly lz">sudo docker volume create gitlab-runner-config</span><span id="7272" class="lv jq hi lr b fi ma lx l ly lz">sudo docker run -d --name gitlab-runner --restart always     -v /var/run/docker.sock:/var/run/docker.sock     -v gitlab-runner-config:/etc/gitlab-runner     gitlab/gitlab-runner:latest</span><span id="7f35" class="lv jq hi lr b fi ma lx l ly lz">sudo docker run --rm -it -v gitlab-runner-config:/etc/gitlab-runner gitlab/gitlab-runner:latest register</span></pre><p id="6d18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并用Gitlab存储库实例数据填充表单:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/87941cad98dbf9a52989e2f48ea73b8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3OMKyuYBOyFVSZomzyqxA.png"/></div></div></figure><p id="45af" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须为runner更改docker网络，我们安装了一个docker卷，因此我们必须使用sudo来修改它:</p><pre class="kt ku kv kw fd lq lr ls lt aw lu bi"><span id="727a" class="lv jq hi lr b fi lw lx l ly lz">sudo su<br/>cd /var/lib/docker/volumes/gitlab-runner-config/_data<br/>vim config.toml</span></pre><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/9cd81cef3ad88f5dd663c8c9d0b9f651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wV_Dvze3MJQS_1LLnnvATg.png"/></div></div></figure><p id="d3ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在runners.docker下添加network_mode="host "</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/b4522aeab92c60a08b97aee8122ad2de.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/1*vXGSRMCwL8xeqXziqlw6Jw.png"/></div></figure><p id="97ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用“esc”键和“:wq”退出，重新启动docker容器:</p><pre class="kt ku kv kw fd lq lr ls lt aw lu bi"><span id="bbbf" class="lv jq hi lr b fi lw lx l ly lz">docker restart gitlab-runner</span></pre><p id="cece" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已！开始使用Gitlab的DevOps并享受其中的乐趣！如果你想知道这对你的团队绩效和指标有什么帮助，去<a class="ae jo" rel="noopener" href="/@andresmaca/android-continuous-integration-and-coverage-visualization-on-gitlab-4a15d58f624c">我的另一篇文章</a></p></div><div class="ab cl mi mj gp mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="hb hc hd he hf"><p id="9132" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对你的开源/ONG项目有任何疑问或者需要帮助，你可以在linkedIn上点击我的DM。</p><p id="12fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有用的话，别忘了按拍手按钮！</p></div></div>    
</body>
</html>