<html>
<head>
<title>paper summary: Swin Transformer: Hierarchical Vision Transformer using Shifted Windows</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">论文摘要:Swin转换器:使用移位窗口的分层视觉转换器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/paper-summary-swin-transformer-hierarchical-vision-transformer-using-shifted-windows-a6c09c34c79f?source=collection_archive---------0-----------------------#2021-09-10">https://medium.com/nerd-for-tech/paper-summary-swin-transformer-hierarchical-vision-transformer-using-shifted-windows-a6c09c34c79f?source=collection_archive---------0-----------------------#2021-09-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a4ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://arxiv.org/abs/2103.14030</p><h1 id="e6e0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">要点</h1><ul class=""><li id="a015" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">多尺度特征提取。可以认为是采纳了FPN的想法。</li><li id="0713" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">将转换器操作限制在每个窗口内，而不是整个特征映射→允许保持整体的线性复杂度，而不是二次复杂度</li><li id="2c0a" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">应用移位窗口以允许窗口间交互</li><li id="8fb0" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">融合自我关注中相对位置信息</li></ul><h1 id="e289" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">背景</h1><p id="9060" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">变形金刚开始在图像领域被采用</p><p id="cc5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以前的作品，如VIT，DEIT是一个很好的进步，但他们在一些地方缺乏，主要是</p><ul class=""><li id="1632" class="kc kd hi ih b ii ij im in iq kv iu kw iy kx jc kj kk kl km bi translated">无法处理不同的图像比例</li><li id="e389" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">二次复杂度</li></ul><p id="f780" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这项工作将试图克服这些缺点</p><h1 id="1854" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">体系结构</h1><p id="52c3" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">对于输入图像，将4x4像素展平为一个矢量。因此，4x4的非重叠面片，其中每个像素有三个RGB值，每个面片将被转换为长度为4x4x3=48的矢量。该向量将通过线性嵌入层，并被转换为具有维度c。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ky"><img src="../Images/e8816aaac26eafba43fb33c2a1221972.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0bnQmZqQnMYDr7otZNb7lg.png"/></div></div></figure><p id="8933" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这需要经过一个经过修改的变压器模块，称为“swin变压器模块”,它有一些修改，将在后面描述。在这之后，我们仍然得到一个特征图，其中每个元素都有维度c。这个变换器和它前面的线性嵌入层被称为“阶段1”</p><p id="956e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从这一点开始，特征映射经历“面片合并+ swin变换器块”的若干次重复，并且该过程每个都将被称为“阶段”。</p><p id="7a2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">面片合并是通过连接四个元素对2x2相邻面片进行分组，然后应用线性层。例如，第一次面片合并，由于输入要素地图的每个位置的矢量大小为C，因此将2×2个面片连接成一个面片将得到长度为4C的矢量。它后面的线性层将通道大小从4C更改为2C。此过程相当于将特征图的宽度和高度减少2倍的下采样。补丁合并后，应用swin变压器块。</p><p id="e731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如你所见，每次应用“补丁合并+ swin变压器块”，我们得到一个简化的功能图。这是重复3次，总的来说，我们得到4个不同比例的特征地图。</p><p id="c3e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是可以用于对象检测、分类或分割的主干结构。</p><h1 id="ccb5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">Swin变压器组</h1><p id="13f8" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">那么swin变压器有什么特别之处呢？swin transformer的核心有三个理念</p><ul class=""><li id="5b26" class="kc kd hi ih b ii ij im in iq kv iu kw iy kx jc kj kk kl km bi translated">将面片分割成多个窗口，并且仅在每个窗口内的面片内应用变换→这将限制变换的复杂性，从增加每个特征贴图的面片总数到窗口大小(每个窗口内的面片数)</li><li id="1de2" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">将补丁切片到窗口中，第一次应用transformer后，窗口拆分会移动，然后再次应用transformer→允许相邻窗口相互交互。</li><li id="eeba" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">添加相对位置偏差</li></ul><h1 id="982e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">窗口分区</h1><p id="d998" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">每个窗口将覆盖MxM个补丁，缺省值为M=7。如果是普通的变形金刚多头自关注模块，复杂度会是</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lk"><img src="../Images/61a2f9dadedb08345c6f80e3545efaf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/1*ZQwfA7N9DKOA2AhiCvnF0Q.png"/></div></figure><p id="c534" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是通过将变换限制到每个窗口区域，复杂度现在被降低并且依赖于M。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ll"><img src="../Images/57842ee8281ae7e0f46179cacf908005.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*aQIEeou3rr2q4Iwfmtg3rQ.png"/></div></figure><p id="0fd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MxM补丁的分区从特征图的最左上角开始。下图显示了一个4x4分区的示例。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lm"><img src="../Images/169e386ff0cf682fb6877bf08e5c9dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*1WavH8s0WMT7zj5FlbIwGg.png"/></div></figure><h1 id="bef9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">移位窗口划分</h1><p id="03aa" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">移位版本分区从(M/2，M/2)开始。下面的例子是当M=4时</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ln"><img src="../Images/8a9b601b8be15d1823fab2781874b312.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*HS4HsefQCQc-Md_mw1PAaQ.png"/></div></figure><p id="4fac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩余部分(不完全是MxM大小的分区)以循环的方式修补在一起。很难用语言来表达，所以下图将展示如何将剩余的部分缝合在一起。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lo"><img src="../Images/2712dc842c7f403db35ad4eec10c3865.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqUAmJU4zOg5P_m4kT94Vw.png"/></div></div></figure><p id="bc91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些“缝合”的窗口不是“纯的”，换句话说，区域实际上在实际位置上不相邻，因此当在该窗口上应用自我关注时，我们对每个子区域应用掩码，使得不相邻的子区域在自我关注期间不交换信息。</p><p id="cbeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种“拼接”方法的另一个优点是移位窗口划分的划分数量与应用正常窗口划分时的数量相同。如果我们不做拼接，而只是将剩余部分视为一个窗口，那么分区的数量将大于正常窗口分区的数量。当窗口尺寸小于特征图尺寸时，这种差异会变得显著。</p><p id="61bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于拼接窗口的结果子区域，它需要恢复到原来的位置，所以请确保应用“反向循环移位”。</p><h1 id="6946" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">相对位置偏差</h1><p id="8c6c" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在应用softmax计算查询的值矩阵权重之前，作者将相对位置信息添加到QK乘积中。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lp"><img src="../Images/17c622490340624163285ec666eb40f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*G9YKts71526wOf2B4375yw.png"/></div></figure><p id="8879" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当MxM窗口存在于特征地图时，x轴或y轴的相对位置值将在范围(-M+1，M-1)内。为了整合这种相对位置信息，我们准备了具有形状(2M-1，2M-1)的可学习参数matrix(B^。每个元素将代表一个向量，该向量代表相对的x，y位置差。实际相对位置偏差矩阵(b)将从B^.采样</p><p id="6c44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过实验，没有任何偏见或使用绝对位置嵌入给出了低劣的性能。</p><h1 id="806d" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">窗口自我注意和转移窗口自我注意是连锁的</h1><p id="80ac" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">一个变压器块将由(窗口或移位窗口自关注模块+ MLP)组成。并且当顺序链接swin变压器时，自关注模块应该在窗口自关注和移位窗口自关注模块之间切换。下图显示了应用于2个swin变压器模块的规则示例。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lq"><img src="../Images/03dc0ca719a4b133f523f6d82f91c5e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Co0yfg7XUJjyNN6HRHXo5w.png"/></div></div></figure><h1 id="13fe" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">小细节</h1><ul class=""><li id="d1b3" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">在窗口MSA(多头自我关注)或移位窗口MSA之后，应用2层MLP (GELU在中间)。MSA(窗口/移位窗口)和2层MLP的输入首先通过层规范。</li></ul><h1 id="3885" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">架构变体</h1><p id="23b8" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">本文创建了swin变压器架构的几个变体，以便模型大小与ViT/DeiT模型或ResNet-50、ResNet-101相当。模型尺寸由C(初始特征图的通道尺寸)的尺寸、每个阶段中的swin变换器块的层尺寸、窗口尺寸、MLP层的扩展因子等控制。</p><p id="89c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在纸张中，窗口大小(M)固定为7，MLP层的扩展因子为4，头部的尺寸为32，下表显示了变体及其C、swin变压器块的层大小。</p><p id="1e8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些术语在这里以协商的方式使用，但是swin变压器模块的层大小=每个阶段中的swin变压器模块号。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lr"><img src="../Images/b79630884016a05edd6291f046d96e74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*kEd3Pf7xkS_wfUMfjQzixQ.png"/></div></figure><h1 id="eaba" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">实验</h1><h1 id="a7d5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">图像分类</h1><p id="8969" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在imagenet上测试。与变形金刚(VIT，DEIT)相比，Swin变形金刚表现更好。与诸如EfficientNet之类的conv网络变体相比，它的性能稍低，但是考虑到EfficientNet是广泛架构优化的结果，作者指出swin transformer有潜力做得更好。</p><h1 id="94ab" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">对象检测和实例分割</h1><p id="0854" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">在COCO身上测试过。与改良的DeiT和Resnet主干网相比，Swin变压器性能更好。</p></div></div>    
</body>
</html>