<html>
<head>
<title>One to many database relationship(+CRUD) with PostgreSQL and Flask Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与PostgreSQL和Flask的一对多数据库关系(+CRUD)第2部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-2-3e3e78255ef2?source=collection_archive---------12-----------------------#2021-06-05">https://medium.com/nerd-for-tech/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-2-3e3e78255ef2?source=collection_archive---------12-----------------------#2021-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/645d875d6f45ddb914fe0b90644b6a42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iLYE0RWXVx58harN_fJ_0A.jpeg"/></div></div></figure><p id="323c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，这是第二部分，也是第一部分，如下所示:</p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-1-6f87fb574b7c"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">与PostgreSQL和Flask的一对多数据库关系(+CRUD)第1部分</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">一对多关系是您必须掌握的东西(多对多也是一样)。我将使用我自己的项目作为…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><p id="ebcd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将继续我们开始的地方，这里我们实际上进入了数据库关系部分，以及CRUD操作将如何操作。</p><h1 id="a150" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">您的帖子页面</h1><p id="be7c" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">那些你已经登录，然后你将能够创建一个<strong class="is hj">新职位，编辑</strong>以及<strong class="is hj">删除</strong>你的职位这里是如何功能的结构。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h2 id="9272" class="lp kh hi bd ki lq lr ls km lt lu lv kq jb lw lx ku jf ly lz ky jj ma mb lc mc bi translated">邮政</h2><p id="fd16" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">创建了member() route，它将包括创建新帖子以及列出现有帖子。</p><pre class="lj lk ll lm fd md me mf mg aw mh bi"><span id="f034" class="lp kh hi me b fi mi mj l mk ml">page = request.args.get(‘page’, 1, type=int)</span></pre><p id="79b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">“page”用于分页，并将它设置为type = int = 1</p><pre class="lj lk ll lm fd md me mf mg aw mh bi"><span id="ae2f" class="lp kh hi me b fi mi mj l mk ml">user_id = db.session.query(Users.id).filter_by(username = username).scalar()<br/>user_posts = db.session.query(Posts).filter_by(parent_id=user_id)\</span><span id="c1ae" class="lp kh hi me b fi mm mj l mk ml">.order_by(Posts.post_time.desc()).paginate(page=page, per_page=3)</span></pre><p id="4482" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们在user_id中获取会话中的当前用户。user_posts将通过使用<strong class="is hj"> <em class="mn">来查找来自该特定用户的所有<strong class="is hj">帖子</strong>。filter _ by(parent _ id = user _ id)</em></strong>按最新帖子排序。在<strong class="is hj">中。分页</strong>模块<strong class="is hj"> </strong>每页最多有3篇文章。</p><p id="b2ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">初始化表单变量中的PostForm，并获取相应的标题、内容值。</p><p id="ef2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果已提交，则发布并提交至数据库，重定向至<strong class="is hj">members.html。</strong></p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/02388412577784400a3aa39ff54ed41a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yvut6LD__pVMfMnOYInc4w.png"/></div></div></figure><h2 id="a22f" class="lp kh hi bd ki lq lr ls km lt lu lv kq jb lw lx ku jf ly lz ky jj ma mb lc mc bi translated">编辑</h2><pre class="lj lk ll lm fd md me mf mg aw mh bi"><span id="fc37" class="lp kh hi me b fi mi mj l mk ml">@app.route('/edit_post/&lt;string:id&gt;', methods= ["POST", "GET"])<br/>def edit_post(id):<br/>    post = db.session.query(Posts).filter_by(id = id).first()<br/>    post_id = db.session.query(Posts.id).filter_by(id = id).first()</span></pre><p id="c98f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们想要编辑或删除帖子时，最好的选择是在router函数中添加一个<strong class="is hj"> id </strong>属性，这样我们就可以找到那个特定的<strong class="is hj">帖子</strong>及其<strong class="is hj"> post_id。</strong></p><pre class="lj lk ll lm fd md me mf mg aw mh bi"><span id="6547" class="lp kh hi me b fi mi mj l mk ml">form = PostForm(obj=post)<br/>if request.method == "POST":<br/>    form.populate_obj(post)</span></pre><p id="f1c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正在创建新的表单实例，然后用编辑过的文章填充表单实例。</p><blockquote class="mo mp mq"><p id="135b" class="iq ir mn is b it iu iv iw ix iy iz ja mr jc jd je ms jg jh ji mt jk jl jm jn hb bi translated">注意:当我们按下编辑按钮时，我们最终会重定向到<strong class="is hj"> edit_post.html </strong></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/cb51ee71a860a51477e0c1ed84162e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Jamt4b17d_YSrLUo9m88Q.png"/></div></div></figure><h2 id="0342" class="lp kh hi bd ki lq lr ls km lt lu lv kq jb lw lx ku jf ly lz ky jj ma mb lc mc bi translated">删除</h2><p id="1387" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">使用删除路由器功能非常简单，首先总是检查是否在会话中，然后获取id属性。</p><pre class="lj lk ll lm fd md me mf mg aw mh bi"><span id="559b" class="lp kh hi me b fi mi mj l mk ml">db.session.query(Posts).filter_by(id = id).delete()<br/>db.session.commit()</span></pre><p id="bbe3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完成后，我们重定向回members.html</p><h1 id="c299" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">成员模板</h1><p id="6a89" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">为了简单和方便，模板在gist文件中有解释。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="d213" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有人认为，只有当我们按下<strong class="is hj">编辑</strong>时，我们才会重定向到该特定帖子的编辑模板，因为在members.html中无法做到这一点(至少我不这么认为)。</p><p id="0a65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有不确定的地方，请随时询问或给❤建议！</p><h1 id="5699" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">编辑模板</h1><p id="77cf" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">因为它只包括编辑文章，它是一个非常短的模板。</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="24de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">帖子更新后，我们将返回到用户帖子页面。</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8a28999027686686e58501996a4d1ae5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MlH4pIirOpmBT34Q0Sticw.png"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">上面你可以看到文章已经被调整。</figcaption></figure><p id="8ac1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Posts数据库表应该看起来像这样。此外，您可以看到分页开始发挥作用，因为有“1”和“2”按钮，因为我们有超过3个用户的职位。</p><h1 id="e1d5" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">搜索用户</h1><p id="da6d" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">这是在主页上实现的，所以即使你没有登录，你也可以搜索用户的帖子！</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="7f7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们获取表单的“username”值，然后通过用户名查询Users表。如果找到了这个名字的用户，就获取所有的user_posts并按最近创建的顺序排列，render_template到s<strong class="is hj">earch.html</strong></p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure></div><div class="ab cl my mz gp na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hb hc hd he hf"><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6d4ede7259a0b3088999b37d4d277430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1nJW-P_NI810RRbUc3xCg.png"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">当您已经搜索了用户名时</figcaption></figure><p id="67cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在主页中，搜索表单</p><figure class="lj lk ll lm fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure></div><div class="ab cl my mz gp na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="hb hc hd he hf"><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7e4b54e7b99732c06dbfdf5ba11b7ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM_ONtHf3FErW1OaAUpK9g.png"/></div></div></figure><p id="5ee5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以看到用户名输入字段，如果用户不存在，将会出现一条提示消息，说明您搜索的用户名下没有帖子。</p><h2 id="8997" class="lp kh hi bd ki lq lr ls km lt lu lv kq jb lw lx ku jf ly lz ky jj ma mb lc mc bi translated">帖子表</h2><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nf"><img src="../Images/0748fb9d06f3fba43ee57fd523c2c5cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XX6p_124EGy2zY3EyKITyg.png"/></div></div><figcaption class="mu mv et er es mw mx bd b be z dx translated">您可以在posts表中看到parent_id只有1，2，3个its，因为我只创建了3个用户！</figcaption></figure><h1 id="b7bd" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="f23f" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">这个项目是我迄今为止遇到的最具挑战性的项目之一，但同时也学到了很多东西，主要是关于数据库关系是如何工作的，我喜欢在前端/Flask web框架中进行更深入的探索！</p><p id="971e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最肯定的是，这个项目有很大的增长和调整空间。我的进一步计划是在当前项目中添加<a class="ae ng" href="https://en.wikipedia.org/wiki/Many-to-many_(data_model)" rel="noopener ugc nofollow" target="_blank">多对多</a>关系，以便更深入地了解。尽管如此，我希望你在一对多数据库关系、CRUD操作和Flask Web框架方面学到了很多！</p><p id="77b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面你会发现GitHub回购:</p><div class="jo jp ez fb jq jr"><a href="https://github.com/Mozes721/Flask_Blog_App" rel="noopener  ugc nofollow" target="_blank"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">Mozes721/Flask_Blog_App</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">github.com</p></div></div><div class="ka l"><div class="nh l kc kd ke ka kf io jr"/></div></div></a></div></div></div>    
</body>
</html>