<html>
<head>
<title>Matt’s Tidbits #99 — Handling null elegantly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Matt的花絮#99 —优雅地处理null</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/matts-tidbits-99-handling-null-elegantly-6d95200dae4?source=collection_archive---------12-----------------------#2021-07-06">https://medium.com/nerd-for-tech/matts-tidbits-99-handling-null-elegantly-6d95200dae4?source=collection_archive---------12-----------------------#2021-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/38aac84142469fb3e19295382d341213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emarK1xFUj42xdKh6D2nAA.jpeg"/></div></div></figure><p id="7973" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上周我写了一些JavaScript中的真实边缘案例。这一次，我有一个优雅地处理空值/未定义值的快速花絮。</p><p id="9d31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">被它的发明者C.A.R. Hoare称为“十亿美元的错误”,大多数程序员可能对此非常熟悉(以及为什么它可能被归类为错误！)</p><p id="60ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们肯定都写过这样的代码:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="0c86" class="kb kc hi js b fi kd ke l kf kg">if(foo != null) {<br/>  // Do something with foo<br/>}</span></pre><p id="987c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果<code class="du jp jq jr js b">foo</code>是一个有多层嵌套对象的对象呢？您可能会同意这样写有点麻烦:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="2a1a" class="kb kc hi js b fi kd ke l kf kg">if(foo != null) {<br/>  if(foo.bar != null) {<br/>    if(foo.bar.baz != null) {<br/>      // Now it's safe to use foo.bar.baz<br/>    }<br/>  }<br/>}</span></pre><p id="dbc0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些更现代的语言(Kotlin，JavaScript 2020，Swift等。)支持所谓的“安全调用/可选链接”，它看起来像这样:</p><p id="74e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jp jq jr js b">x = foo?.bar?.baz?.doSomething()</code></p><p id="fd83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jp jq jr js b">?</code>表示只有当左侧不是<code class="du jp jq jr js b">null</code>时，才应该评估右侧。但是，如果这个表达式的任何一部分是<code class="du jp jq jr js b">null</code>，那么<code class="du jp jq jr js b">x</code>将是<code class="du jp jq jr js b">null</code>。</p><p id="8eeb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们想要指定在任何一个<code class="du jp jq jr js b">null</code>检查失败的情况下<code class="du jp jq jr js b">x</code>应该有什么值呢？很明显，我们可以通过检查语句后的<code class="du jp jq jr js b">x</code>是否为<code class="du jp jq jr js b">null</code>来实现这一点，然后给它分配一个不同的值，但是如果我们希望<code class="du jp jq jr js b">x</code>为常量，这是不可能的。</p><p id="d3d7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有些语言支持三元运算符，所以您可以这样做:</p><p id="5f8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jp jq jr js b">x = foo?.bar?.baz ? foo?.bar?.baz?.doSomething() : &lt;fallback value&gt;</code></p><p id="c86f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我看来，这是重复的，也是容易出错的——如果<code class="du jp jq jr js b">doSomething()</code>返回<code class="du jp jq jr js b">null</code>，那么<code class="du jp jq jr js b">x</code>仍然可能是<code class="du jp jq jr js b">null</code>！您可以通过将<code class="du jp jq jr js b">?.doSomething()</code>放在三元运算符的<code class="du jp jq jr js b">?</code>之前来解决这个问题，但是我们确定多次调用<code class="du jp jq jr js b">doSomething()</code>是安全的吗？它可能会产生副作用，在我们的代码中引入微妙的错误，或者占用大量资源，降低应用程序的性能。</p><p id="7d2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相反，我想提出一种更好的方法——零(稍)合并运算符:</p><p id="309b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du jp jq jr js b">x = foo?.bar?.baz?.doSomething() ?? &lt;fallback value&gt;</code></p><p id="c762" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，<code class="du jp jq jr js b">x</code>仍然可以是一个常数，我们将捕捉整个链中任何可能的<code class="du jp jq jr js b">null</code>值，并且我们只调用<code class="du jp jq jr js b">doSomething()</code>一次(最多一次)。</p><p id="6212" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果你明白了，为什么我称之为null <em class="kh"> (ish) </em>合并操作符？这是因为在JavaScript中，可选的链接操作符和空合并操作符适用于<code class="du jp jq jr js b">null</code>和<code class="du jp jq jr js b">undefined</code>。很整洁，是吧？</p><p id="f818" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在科特林工作时就知道这个概念，在那里这个功能被称为“猫王操作员”。它被写成<code class="du jp jq jr js b">?:</code>——这看起来有点像猫王的头顶(眼睛&amp;他标志性的卷发)——另外，在Kotlin社区中，我们可以记住，当“猫王已经离开大楼”(也就是说，如果你遇到了<code class="du jp jq jr js b">null</code>并离开了可选链)时，发生在操作符右边的任何事情都会发生，是的，我知道——程序员有时可能是真正的书呆子。；-)</p><p id="cc4c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我已经使用TypeScript(构建在JavaScript之上)在React Native中工作，我发现这个功能也存在于其中。这让我发现Swift也有同样的概念——“零合并运算符”(用<code class="du jp jq jr js b">??</code>表示)。</p><p id="1156" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">总之，我认为越来越多的现代编程语言正在融合并支持越来越相似的代码编写方式，这真的很令人兴奋。每种语言都有其独特之处(以及优点和缺点)，但我认为我们越来越接近这样一个世界，Android开发人员可以通读iOS代码库并理解正在发生的事情(不是回到他们仍然用Objective C编写的时候)，或者传统的web开发人员可以在移动应用程序上工作(由于React Native等技术，这已经成为现实)。</p><p id="70ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">知道其他支持可选链接/空合并的语言吗？我很想在评论中听到你的意见！</p><p id="57fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有兴趣和我一起在埃森哲出色的数字产品团队工作吗？我们正在招聘<a class="ae jo" href="https://www.accenture.com/us-en/careers/jobdetails?id=00960587_en&amp;title=Native+Mobile+Developer" rel="noopener ugc nofollow" target="_blank">移动开发人员</a>、<a class="ae jo" href="https://www.accenture.com/us-en/careers/jobdetails?id=00906120_en&amp;title=Web+Developer" rel="noopener ugc nofollow" target="_blank">网络开发人员</a>，以及<a class="ae jo" href="https://www.accenture.com/us-en/careers/jobsearch?jk=%22Digital%20Products%22&amp;sb=0&amp;pg=1&amp;is_rj=0&amp;ct=ma%20-%20cambridge|ny%20-%20new%20york" rel="noopener ugc nofollow" target="_blank">更多的</a>！</p></div></div>    
</body>
</html>