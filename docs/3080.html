<html>
<head>
<title>Image Classification Using Transfer Learning (VGG-16)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用迁移学习的图像分类(VGG-16)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/image-classification-using-transfer-learning-vgg-16-2dc2221be34c?source=collection_archive---------0-----------------------#2021-05-29">https://medium.com/nerd-for-tech/image-classification-using-transfer-learning-vgg-16-2dc2221be34c?source=collection_archive---------0-----------------------#2021-05-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2615" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始之前，您只需要了解一些关于 TensorFlow/Keras 卷积神经网络实现的知识。我已经写了一篇关于卷积神经网络的文章，你可以从<a class="ae jd" rel="noopener" href="/nerd-for-tech/image-classification-using-convolutional-neural-networks-cnn-eef587ed0c1"> <strong class="ih hj">链接</strong> </a> <strong class="ih hj">来看看。</strong></p><p id="1215" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">众所周知，目前图像分类正变得越来越流行，其应用也在迅速增加。在这篇博客中，我们将使用卷积神经网络对皮肤癌数据进行图像分类。</p><blockquote class="je jf jg"><p id="9380" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">“我们将从 google colab 开始，因为 python 库、它们的依赖关系以及它的云环境都没有问题，所以我们不需要太多配置。”</p><p id="b8a2" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:让我们开始实现，如果你将遵循一步一步的教程，那么最终将不会有错误。</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/603f92f3b57aa3049a124182d93526c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9leHulqJ8stJR6J5LQUzw.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">转移学习工作流</figcaption></figure><p id="70fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-1 </strong>:我们需要在 google drive 中创建一个名为“<strong class="ih hj"> <em class="jh">【图像分类】</em> </strong>的文件夹。这不是必需的名称，您也可以用另一个名称创建文件夹。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kb"><img src="../Images/62fb6a348e8e06f1226d1fb8802058c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47gszLQyTpr89v_r1hj9HA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">图像分类文件夹</figcaption></figure><p id="e5b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-2 </strong>:现在，我们需要在图像分类文件夹中制作一个文件夹，里面是“<strong class="ih hj"><em class="jh">dataset”</em></strong>的文件夹，我们将在其中存储我们的训练和测试数据。这不是必需的名称，您也可以用另一个名称创建文件夹。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kb"><img src="../Images/fd5fe5ae661826dd12c292a4db2ed5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFbHpV79zXVZ23hjOO8x4g.png"/></div></div></figure><blockquote class="je jf jg"><p id="d733" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">您可以使用任何数据集，但在本文中，我将重点关注二元分类，这意味着我将使用的数据集有两个类。对于多类分类，程序将是相同的，但在一些步骤需要很少的变化，我会在下面提到的每一步。</p></blockquote><p id="ff94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong>现在，我们需要在<strong class="ih hj"> <em class="jh">【数据集】</em> </strong>文件夹内添加数据，可以使用任何数据集，而我用过的数据集是来自 Kaggle，数据是关于<strong class="ih hj"> <em class="jh">【皮肤癌二级分类】</em> </strong>。可以从<a class="ae jd" href="https://drive.google.com/drive/folders/1Aid67MXI7ks0l3y3CsLv4om4n_5zG9dG?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jh">链接</em> </strong> </a>下载数据集。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kc"><img src="../Images/01d885a38bc0a8bce5be8d1fe59b49f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6NbLUJGI4I_PRulrRxyFA.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">数据集子文件夹</figcaption></figure><p id="e528" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 4: </strong>现在，我们需要在<strong class="ih hj"> <em class="jh">【图像分类】</em> </strong>文件夹中制作一个笔记本，因为我们将在该文件中编写代码，并且还将能够从 google drive 访问数据集。</p><blockquote class="je jf jg"><p id="cf43" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">你可以打开<strong class="ih hj">【图像分类】</strong>文件夹然后点击</p><p id="092f" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">新建-&gt;更多-&gt;Google 协作室(在文件夹中创建 google colab 文件的过程)</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kd"><img src="../Images/279f353b0b8365a8a52a5b57a34b9f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tA4WyBI3gnUM1QEId_MluQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">Google colab 文件创建</figcaption></figure><blockquote class="je jf jg"><p id="4f24" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">现在，我们已经设置了数据集路径和创建的笔记本文件。让我们从对皮肤中的癌症进行分类的代码开始。</p></blockquote><p id="e866" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 5 步:</strong>打开 Google-Colab 文件，这里我们首先需要装载 google drive 来访问存储在<strong class="ih hj"> <em class="jh">【图像分类】</em> </strong>文件夹中的数据集。你可以使用下面写的代码来安装谷歌驱动器。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="53cd" class="kj kk hi kf b fi kl km l kn ko">from google.colab import drive</span><span id="4409" class="kj kk hi kf b fi kp km l kn ko">drive.mount(‘/content/drive’)</span></pre><p id="33be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你运行了上面的代码。它会问你一个授权码，一旦你添加了，你的谷歌驱动器将被安装。</p><blockquote class="je jf jg"><p id="d7ec" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> google drive 和 google colab 帐户必须相同才能进行授权。如果谷歌帐户改变了，那么谷歌驱动器将不会安装。</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kq"><img src="../Images/875f15bb573a669380a3d6c7c22cb6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*SqeUY0v5EJi-2CLPufEC3A.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">Google drive 已安装</figcaption></figure><p id="a243" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 6: </strong>现在，我们需要导入用于数据集读取和 CNN(卷积神经网络)模型创建的库。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="7353" class="kj kk hi kf b fi kl km l kn ko">import os</span><span id="3a9a" class="kj kk hi kf b fi kp km l kn ko">import cv2</span><span id="e655" class="kj kk hi kf b fi kp km l kn ko">from PIL import Image</span><span id="3272" class="kj kk hi kf b fi kp km l kn ko">import tensorflow as tf</span><span id="7bdb" class="kj kk hi kf b fi kp km l kn ko">from keras import backend as K</span><span id="3b88" class="kj kk hi kf b fi kp km l kn ko">from keras.models import load_model</span><span id="68c3" class="kj kk hi kf b fi kp km l kn ko">from keras.preprocessing.image import img_to_array</span><span id="2454" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.optimizers import Adam, RMSprop</span><span id="1405" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.callbacks import ReduceLROnPlateau</span><span id="efa6" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.preprocessing.image import ImageDataGenerator</span></pre><p id="70b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 7 步:</strong>现在，我们需要设置培训、测试和验证目录路径。只能使用(测试和培训文件夹)，不需要使用验证文件夹。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="c765" class="kj kk hi kf b fi kl km l kn ko">base_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset'</span><span id="c3a0" class="kj kk hi kf b fi kp km l kn ko">train_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train'</span><span id="bf95" class="kj kk hi kf b fi kp km l kn ko">train_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train/benign'</span><span id="7e2c" class="kj kk hi kf b fi kp km l kn ko">train_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train/malignant'</span><span id="6be4" class="kj kk hi kf b fi kp km l kn ko">test_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test'</span><span id="544e" class="kj kk hi kf b fi kp km l kn ko">test_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test/benign'</span><span id="7845" class="kj kk hi kf b fi kp km l kn ko">test_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test/malignant'</span><span id="a412" class="kj kk hi kf b fi kp km l kn ko">valid_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation'</span><span id="1146" class="kj kk hi kf b fi kp km l kn ko">valid_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation/benign'</span><span id="6b98" class="kj kk hi kf b fi kp km l kn ko">valid_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation/malignant'</span></pre><blockquote class="je jf jg"><p id="ea6c" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">备注</strong>:点击左侧垂直页签<strong class="ih hj">-&gt;Drive-&gt;My Drive-&gt;Folder Path</strong>中的文件夹，可以选择路径</p></blockquote><p id="ff18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 8: </strong>现在，我们需要借助 os 库从这些文件夹中获取数据。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="460a" class="kj kk hi kf b fi kl km l kn ko">num_benign_train = len(os.listdir(train_benign_dir))</span><span id="739c" class="kj kk hi kf b fi kp km l kn ko">num_malignant_train = len(os.listdir(train_malign_dir))</span><span id="1de0" class="kj kk hi kf b fi kp km l kn ko">num_benign_validaition = len(os.listdir(valid_benign_dir))</span><span id="3604" class="kj kk hi kf b fi kp km l kn ko">num_malignant_validation= len(os.listdir(valid_malign_dir))</span><span id="48a8" class="kj kk hi kf b fi kp km l kn ko">num_benign_test = len(os.listdir(test_benign_dir))</span><span id="0779" class="kj kk hi kf b fi kp km l kn ko">num_malignant_test= len(os.listdir(test_malign_dir))</span></pre><blockquote class="je jf jg"><p id="ab52" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">到目前为止，我们的 colab 笔记本有四个包含代码的单元，如下图所示。</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kr"><img src="../Images/f230681e5e5eb9cd2312b02acc008f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrnyHNqgNOUEA5oVFn7gZQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">前两个单元</figcaption></figure><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es ks"><img src="../Images/6a97e2b275fc8eca3a9da33a9d0c6adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vo31r8zBIR7PH2_ze1ISqQ.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">最后两个单元格</figcaption></figure><p id="1a47" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 9: </strong>现在，让我们看一看，我们的数据集中有多少个训练和测试图像？</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="d852" class="kj kk hi kf b fi kl km l kn ko">print("Total Training Benign Images",num_benign_train)</span><span id="ab83" class="kj kk hi kf b fi kp km l kn ko">print("Total Training Malignant Images",num_malignant_train)</span><span id="3293" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="ad51" class="kj kk hi kf b fi kp km l kn ko">print("Total validation Benign Images",num_benign_validaition)</span><span id="94dc" class="kj kk hi kf b fi kp km l kn ko">print("Total validation Malignant Images",num_malignant_validation)</span><span id="f84d" class="kj kk hi kf b fi kp km l kn ko">print("--")print("Total Test Benign Images", num_benign_test)</span><span id="3e55" class="kj kk hi kf b fi kp km l kn ko">print("Total Test Malignant Images",num_malignant_test)</span><span id="d3ce" class="kj kk hi kf b fi kp km l kn ko">total_train = num_benign_train+num_malignant_train</span><span id="deed" class="kj kk hi kf b fi kp km l kn ko">total_validation = num_benign_validaition+num_malignant_validation</span><span id="5d8f" class="kj kk hi kf b fi kp km l kn ko">total_test = num_benign_test+num_malignant_test</span><span id="a196" class="kj kk hi kf b fi kp km l kn ko">print("Total Training Images",total_train)</span><span id="d1a2" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="0a08" class="kj kk hi kf b fi kp km l kn ko">print("Total Validation Images",total_validation)</span><span id="a0d9" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="01b9" class="kj kk hi kf b fi kp km l kn ko">print("Total Testing Images",total_test)</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kt"><img src="../Images/eeb0f49f5345a3871a00e20b11030f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIgJdDhzhdj-oFyyQi0rVw.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">数据集信息</figcaption></figure><p id="cf21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-10: </strong>现在，我们需要设置图像的大小(高度、宽度)。当数据集图像具有不同的大小时，这一步是最需要的，它将加快训练过程。我使用了(224，224)的图像形状。</p><blockquote class="je jf jg"><p id="7bbc" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">注意:我们需要调整图像大小到(224，224)，因为 VGG 16 只接受该图像大小。</strong></p></blockquote><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="70b2" class="kj kk hi kf b fi kl km l kn ko">IMG_SHAPE  = 224</span><span id="d414" class="kj kk hi kf b fi kp km l kn ko">batch_size = 32</span></pre><p id="7f7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 11: </strong>现在，我们需要对数据进行预处理(训练、测试、验证)，包括重新缩放和洗牌。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="4768" class="kj kk hi kf b fi kl km l kn ko">image_gen_train = ImageDataGenerator(rescale = 1./255)</span><span id="3159" class="kj kk hi kf b fi kp km l kn ko">train_data_gen = image_gen_train.flow_from_directory(batch_size = batch_size,</span><span id="b30f" class="kj kk hi kf b fi kp km l kn ko">directory = train_dir,</span><span id="8ee3" class="kj kk hi kf b fi kp km l kn ko">shuffle= True,</span><span id="45ec" class="kj kk hi kf b fi kp km l kn ko">target_size = (IMG_SHAPE,IMG_SHAPE),</span><span id="49e6" class="kj kk hi kf b fi kp km l kn ko">class_mode = 'binary')</span><span id="f699" class="kj kk hi kf b fi kp km l kn ko">image_generator_validation = ImageDataGenerator(rescale=1./255)</span><span id="20eb" class="kj kk hi kf b fi kp km l kn ko">val_data_gen = image_generator_validation.flow_from_directory(batch_size=batch_size,</span><span id="38a1" class="kj kk hi kf b fi kp km l kn ko">directory=valid_dir,</span><span id="4a51" class="kj kk hi kf b fi kp km l kn ko">target_size=(IMG_SHAPE, IMG_SHAPE),</span><span id="dd78" class="kj kk hi kf b fi kp km l kn ko">class_mode='binary')</span><span id="31d2" class="kj kk hi kf b fi kp km l kn ko">image_gen_test = ImageDataGenerator(rescale=1./255)</span><span id="8043" class="kj kk hi kf b fi kp km l kn ko">test_data_gen = image_gen_test.flow_from_directory(batch_size=batch_size,</span><span id="7548" class="kj kk hi kf b fi kp km l kn ko">directory=test_dir,</span><span id="a928" class="kj kk hi kf b fi kp km l kn ko">target_size=(IMG_SHAPE, IMG_SHAPE),</span><span id="d649" class="kj kk hi kf b fi kp km l kn ko">class_mode='binary')</span></pre><p id="a04d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 12: </strong>继续下一步之前，让我们检查类名，图像数据生成器将使用文件夹名作为类名。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ku"><img src="../Images/79360fc479aaa7d7c13fe93911b69d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*4T63PB7FTkPpXFAfkmOe_A.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">类名</figcaption></figure><blockquote class="je jf jg"><p id="9184" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">现在，我们的数据预处理步骤已经完成，是时候下载 VGG-16 预训练权重了。</strong></p></blockquote><p id="0aa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-13: </strong>让我们下载 VGG-16 权重，包括顶层参数为 false。</p><blockquote class="je jf jg"><p id="bf3f" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">我们知道 VGG-16 是分多个班进行培训的，所以如果我们使用<strong class="ih hj"> top_layer = True </strong>，那么我们需要在 VGG-16 培训的所有班上对其进行再培训，但是如果我们使用<strong class="ih hj"> top_layer = False </strong>，那么在再培训中，我们只需要增加我们的培训班。</p></blockquote><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="0403" class="kj kk hi kf b fi kl km l kn ko">pre_trained_model = tf.keras.applications.VGG16(input_shape=(224, 224, 3), include_top=False, weights="imagenet")</span></pre><p id="d581" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-14: </strong>现在，我们需要冻结 VGG-16 的训练层。(因为 VGG——16 岁，就已经在巨大的数据上接受过训练)。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="4547" class="kj kk hi kf b fi kl km l kn ko">for layer in pre_trained_model.layers:</span><span id="6631" class="kj kk hi kf b fi kp km l kn ko">print(layer.name)</span><span id="4a43" class="kj kk hi kf b fi kp km l kn ko">layer.trainable = False</span></pre><p id="d6f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于 VGG 16 的所有层都被冻结了，我们需要为我们的班级修改最后一层。我添加了一个最大轮询，一个密集层，一个下降，和一个输出与 VGG-16 的最后一层。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="b1b0" class="kj kk hi kf b fi kl km l kn ko">last_layer = pre_trained_model.get_layer('block5_pool')</span><span id="367c" class="kj kk hi kf b fi kp km l kn ko">last_output = last_layer.output</span><span id="5762" class="kj kk hi kf b fi kp km l kn ko">x = tf.keras.layers.GlobalMaxPooling2D()(last_output)</span><span id="ab68" class="kj kk hi kf b fi kp km l kn ko">x = tf.keras.layers.Dense(512, activation='relu')(x)</span><span id="c1b7" class="kj kk hi kf b fi kp km l kn ko">x = tf.keras.layers.Dropout(0.5)(x)</span><span id="e283" class="kj kk hi kf b fi kp km l kn ko">x = tf.keras.layers.Dense(2, activation='sigmoid')(x)</span></pre><blockquote class="je jf jg"><p id="1423" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">对于“<strong class="ih hj">多类分类</strong>，将最后一个密集层值改为 3，用 softmax 激活。</p></blockquote><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="7b5b" class="kj kk hi kf b fi kl km l kn ko">x = tf.keras.layers.Dense(3, activation='softmax')(x)</span></pre><p id="e23f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 16: </strong>现在，我们需要合并原始的 VGG 16 层，与我们的自定义层。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="ad35" class="kj kk hi kf b fi kl km l kn ko">model = tf.keras.Model(pre_trained_model.input, x)</span></pre><p id="1a79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 17 步:</strong>在开始训练之前，我们先编译一下模型。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="930e" class="kj kk hi kf b fi kl km l kn ko">model.compile(optimizer='adam', loss=tf.keras.losses.sparse_categorical_crossentropy, metrics=['acc'])</span></pre><blockquote class="je jf jg"><p id="f45f" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">对于“<strong class="ih hj">多类分类</strong>，用 categorical _ crossentropy 改变损失。</p></blockquote><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="012e" class="kj kk hi kf b fi kl km l kn ko">model.compile(optimizer='adam', loss=tf.keras.losses.categorical_crossentropy, metrics=['acc'])</span></pre><p id="9478" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 18 步:</strong>我们来查看一下车型汇总。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kv"><img src="../Images/c5b23eb8220c6bc9a58cf7c8c61ff6a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*GS0ruiVDvndfH3rxr8gT1g.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">模型摘要</figcaption></figure><p id="cbc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 19 步:</strong>最后，我们需要开始我们的培训过程。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="f13a" class="kj kk hi kf b fi kl km l kn ko">vgg_classifier = model.fit(train_data_gen,</span><span id="8470" class="kj kk hi kf b fi kp km l kn ko">steps_per_epoch=(total_train//batch_size),</span><span id="9b6a" class="kj kk hi kf b fi kp km l kn ko">epochs = 5,</span><span id="5283" class="kj kk hi kf b fi kp km l kn ko">validation_data=val_data_gen,</span><span id="ba9a" class="kj kk hi kf b fi kp km l kn ko">validation_steps=(total_validation//batch_size),</span><span id="8377" class="kj kk hi kf b fi kp km l kn ko">batch_size = batch_size,</span><span id="c39e" class="kj kk hi kf b fi kp km l kn ko">verbose = 1)</span></pre><blockquote class="je jf jg"><p id="1fd1" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>我在五个历元上训练模型。为了获得更好的结果，可以测试 50-60 个时期，以达到 85%的测试数据准确性。</p></blockquote><p id="4437" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jh">如果，你遵循了上面所有的步骤，那么现在，你可以看到 epochs 在步骤 19 之后运行的代码也显示在下面的图片中。</em>T19】</strong></p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kw"><img src="../Images/f9a60878d65a48a4d7a46d118e0a3bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awVFf1zWjj-aubMSl1gN8g.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">训练时代</figcaption></figure><p id="1b29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤 20: </strong>现在，我们可以在测试数据上测试我们的模型了。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="d2b3" class="kj kk hi kf b fi kl km l kn ko">result = model.evaluate(test_data_gen,batch_size=batch_size)</span><span id="0270" class="kj kk hi kf b fi kp km l kn ko">print("test_loss, test accuracy",result)</span></pre><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kx"><img src="../Images/096a414a8828168b1298ef65d1f0cf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*Cf8bGmFPDmrhusNGLE4cAA.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">测试</figcaption></figure><p id="686d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要保存我们的模型。</p><pre class="jm jn jo jp fd ke kf kg kh aw ki bi"><span id="793c" class="kj kk hi kf b fi kl km l kn ko">model_json = model.to_json()</span><span id="6d39" class="kj kk hi kf b fi kp km l kn ko">with open("/content/drive/MyDrive/Image Classification/VGG_Skin_Classifier.json", "w") as json_file:</span><span id="1a73" class="kj kk hi kf b fi kp km l kn ko">json_file.write(model_json)</span><span id="68f9" class="kj kk hi kf b fi kp km l kn ko">model.save("/content/drive/MyDrive/Image Classification/VGG_Skin_Classifier.h5")</span><span id="f87d" class="kj kk hi kf b fi kp km l kn ko">print("Saved model to disk")</span><span id="d312" class="kj kk hi kf b fi kp km l kn ko">model.save_weights("/content/drive/MyDrive/Image Classification/VGG_Skin.h5")</span></pre><blockquote class="je jf jg"><p id="1e00" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong>恭喜你，你已经用自己的数据重新训练了 VGG-16。本文只关注二进制分类，而您可以在自己的数据上进行测试(二进制或多类分类)。</p></blockquote><p id="531a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有视频，并想从这些视频中开发一个数据集，请阅读我关于这些的文章，</p><ul class=""><li id="38b9" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated"><a class="ae jd" rel="noopener" href="/nerd-for-tech/extraction-of-frames-from-a-single-video-2b9fdd901208"> <strong class="ih hj"> <em class="jh">从单个视频中提取帧</em> </strong> </a></li><li id="8ddb" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><a class="ae jd" rel="noopener" href="/nerd-for-tech/extraction-of-frames-from-multiple-videos-3ddbced6f3c2"> <strong class="ih hj"> <em class="jh">从多个视频中提取帧</em> </strong> </a></li></ul><p id="b3d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有数据，并想标记为对象检测，对象跟踪等，请阅读我的文章，</p><ul class=""><li id="e33e" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated"><a class="ae jd" rel="noopener" href="/nerd-for-tech/labeling-data-for-object-detection-yolo-5a4fa4f05844"> <strong class="ih hj"> <em class="jh">为物体检测标注数据</em> </strong> </a></li></ul></div></div>    
</body>
</html>