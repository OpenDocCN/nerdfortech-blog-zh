<html>
<head>
<title>How to Improve Microsoft SQL Server Database Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何提高Microsoft SQL Server数据库性能</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-improve-microsoft-sql-server-mssql-database-c2b159ced54d?source=collection_archive---------1-----------------------#2021-01-19">https://medium.com/nerd-for-tech/how-to-improve-microsoft-sql-server-mssql-database-c2b159ced54d?source=collection_archive---------1-----------------------#2021-01-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/206d5c4c42ac24fec46ea73f7e03e50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kn2d699zQmsKr_Q9fdMOPw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:Pixabay</figcaption></figure><p id="978d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有时，我们的数据库甚至外部数据库需要在数据结构方面进行一些优化。</p><p id="c9ee" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据我的经验，我们可以采取三种方法:一种更基本、更快速，另一种更深入，包括重构和重新规划数据库，最后一种是前两种方法的混合。</p><p id="ad7b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这篇文章中，我想分享这个微软数据库引擎的基本和快速的方法。如果你想看到类似的内容，但对于MySQL/MariaDB，请查看我的另一篇文章:<a class="ae js" href="https://pirex360.medium.com/how-to-improve-mysql-mariadb-database-performance-181f270d7fbe" rel="noopener">如何提高MYSQL / MariaDB数据库性能</a>。</p><p id="9d7f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我有很多项目需要将现有的客户端MSSQL数据库集成到一个定制的web应用程序中，原因有很多，比如获取客户、供应商、产品和各种数据。有时我会遇到性能问题，瓶颈是外部数据库，在大多数情况下使用这种方法可以获得可见的结果，但这总是取决于目标数据库的状态。</p><p id="f3ef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">数据库中的索引在这种方法中起着主要作用，在大型数据库中，重建索引可能会将数据库的性能带到另一个级别，遗憾的是，索引的糟糕实现也可能会使数据库变慢(这是一个更高级的主题，不在本文讨论之列)。</p><p id="a8ae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此，让我们加快我们的数据库！<br/> <em class="jt">注意:它是安全的，您的数据库数据没有风险！</em></p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="6b2e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以使用以下SQL命令手动按表重建(只需更改数据库表的table_name):</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="1b77" class="kk kl hi kg b fi km kn l ko kp">ALTER INDEX ALL ON table_name REBUILD ;</span></pre><p id="0976" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">或者，您可以对整个数据库执行这个更高级的脚本，这将获取所有数据库表，并对每个表使用上面的命令，只需将第7行中的database_name替换为您的目标数据库名:</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="e62d" class="kk kl hi kg b fi km kn l ko kp">DECLARE <a class="ae js" href="http://twitter.com/Database" rel="noopener ugc nofollow" target="_blank">@Database</a> NVARCHAR(255)   <br/>DECLARE <a class="ae js" href="http://twitter.com/Table" rel="noopener ugc nofollow" target="_blank">@Table</a> NVARCHAR(255)  <br/>DECLARE <a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a> NVARCHAR(1000)</span><span id="590d" class="kk kl hi kg b fi kq kn l ko kp">DECLARE DatabaseCursor CURSOR READ_ONLY FOR  <br/>    SELECT name FROM master.sys.databases   <br/>    WHERE name IN ('database_name')  -- databases<br/>    AND state = 0 -- database is online<br/>    AND is_in_standby = 0 -- database is not read only for log shipping<br/>    ORDER BY 1</span><span id="ce68" class="kk kl hi kg b fi kq kn l ko kp">OPEN DatabaseCursor</span><span id="5d8a" class="kk kl hi kg b fi kq kn l ko kp">FETCH NEXT FROM DatabaseCursor INTO <a class="ae js" href="http://twitter.com/Database" rel="noopener ugc nofollow" target="_blank">@Database</a>  <br/>    WHILE @@FETCH_STATUS = 0  <br/>    BEGIN</span><span id="bb39" class="kk kl hi kg b fi kq kn l ko kp">SET <a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a> = 'DECLARE TableCursor CURSOR READ_ONLY FOR SELECT ''['' + table_catalog + ''].['' + table_schema + ''].['' +  <br/>       table_name + '']'' as tableName FROM [' + <a class="ae js" href="http://twitter.com/Database" rel="noopener ugc nofollow" target="_blank">@Database</a> + '].INFORMATION_SCHEMA.TABLES WHERE table_type = ''BASE TABLE'''</span><span id="3c1e" class="kk kl hi kg b fi kq kn l ko kp">-- create table cursor  <br/>       EXEC (<a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a>)  <br/>       OPEN TableCursor</span><span id="32fe" class="kk kl hi kg b fi kq kn l ko kp">FETCH NEXT FROM TableCursor INTO <a class="ae js" href="http://twitter.com/Table" rel="noopener ugc nofollow" target="_blank">@Table</a>   <br/>       WHILE @@FETCH_STATUS = 0   <br/>       BEGIN<br/>          BEGIN TRY   <br/>             SET <a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a> = 'ALTER INDEX ALL ON ' + <a class="ae js" href="http://twitter.com/Table" rel="noopener ugc nofollow" target="_blank">@Table</a> + ' REBUILD' <br/>             PRINT <a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a> -- uncomment if you want to see commands<br/>             EXEC (<a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a>) <br/>          END TRY<br/>          BEGIN CATCH<br/>             PRINT '---'<br/>             PRINT <a class="ae js" href="http://twitter.com/cmd" rel="noopener ugc nofollow" target="_blank">@cmd</a><br/>             PRINT ERROR_MESSAGE() <br/>             PRINT '---'<br/>          END CATCH</span><span id="f748" class="kk kl hi kg b fi kq kn l ko kp">FETCH NEXT FROM TableCursor INTO <a class="ae js" href="http://twitter.com/Table" rel="noopener ugc nofollow" target="_blank">@Table</a>   <br/>       END</span><span id="f7e0" class="kk kl hi kg b fi kq kn l ko kp">CLOSE TableCursor   <br/>       DEALLOCATE TableCursor</span><span id="c416" class="kk kl hi kg b fi kq kn l ko kp">FETCH NEXT FROM DatabaseCursor INTO <a class="ae js" href="http://twitter.com/Database" rel="noopener ugc nofollow" target="_blank">@Database</a>  <br/>    END  <br/>    CLOSE DatabaseCursor   <br/>    DEALLOCATE DatabaseCursor</span></pre><p id="2c57" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样，执行并等待一段时间(取决于您的数据库大小)…然后测试您的查询的性能。</p><p id="3c7c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望这些信息能帮助到别人。</p></div></div>    
</body>
</html>