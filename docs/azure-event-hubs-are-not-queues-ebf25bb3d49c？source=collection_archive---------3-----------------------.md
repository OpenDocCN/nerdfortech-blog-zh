# Azure 事件中心不是队列

> 原文：<https://medium.com/nerd-for-tech/azure-event-hubs-are-not-queues-ebf25bb3d49c?source=collection_archive---------3----------------------->

不幸的是，我见过相当多的人使用 Azure 事件中心，而他们真正想要的是一个队列。

事件中心非常适合大规模数据接收，但是如果您只需要在服务之间传递消息，请使用其他工具。以下是几个原因。

# 消息阻塞了队列

事件中心使用分区模型，发送给它的消息分布在各个分区中。
每个分区都有一个可以并发读取的读取器，消息总是按顺序处理。

这意味着，如果您有一条消息需要一段时间来处理，那么该分区上的其余消息也会被延迟。
这意味着，如果你有一条导致你的应用崩溃的消息，你就不能在那个分区上处理任何其他东西，直到你以某种方式处理了这条消息。通过等待和重试、丢弃消息或者将它保存在其他地方。

相比之下，Azure 存储队列可以锁定消息并尝试处理它。
如果你处理不了或者需要一段时间，你就不会耽误任何人。其他消费者不需要等你处理完你的信息才可以继续。

# 检查点使错误处理变得困难

事件中心是面向批处理的。你接收一批消息，然后当你处理足够多的消息时，你创建一个所谓的[检查点](https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features#checkpointing)。

检查点是一种写下来的方式:这是我处理的消息的数量。检查点是您偶尔会做的事情，并不意味着您对每封邮件都要做。
如果你的应用程序在检查点之间崩溃，它将从最后一个检查点开始，你将重新处理每条消息，直到你再次更新。
这意味着您的系统必须对多次发送的消息相当耐用。

虽然这是大多数队列都存在的问题(应用程序在接收和处理消息之间总是会崩溃)，但通常情况下，您一次只能处理一条消息，因此如果出现故障，造成的伤害会更小。

# 活动中心需要一个额外的存储帐户

分区读取器使用 Azure 存储帐户来协调它们之间的检查点和[分区所有权](https://docs.microsoft.com/en-us/azure/event-hubs/event-processor-balance-partition-load)。

这意味着，如果没有存储帐户，您将无法从事件中心进行读取。这没什么大不了的，但是确实增加了一个额外的连接字符串需要管理，一个额外的 Azure 资源需要部署。

# 地方发展

没有办法在本地运行活动中心。
与 Azure 存储队列形成对比，你可以使用[Azure](https://github.com/Azure/Azurite)在本地运行 Azure 存储队列，或者你可以在 Docker 中运行许多其他队列。

能够在本地运行您的依赖项真是太好了。这意味着您不必为每个开发人员处理事件中心。

# 使用活动中心的理由

我不讨厌活动中心。如果你需要它提供的功能，比如[事件捕获功能](https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-capture-overview)，或者你有大量数据，它们是一个很好的工具。

但是如果只是需要在服务之间发送消息呢？用别的。

*最初发布于*[*https://www . Gustav wengel . dk*](https://www.gustavwengel.dk/event-hubs-are-not-queues)*。*