# 消化安全外壳

> 原文：<https://medium.com/nerd-for-tech/digesting-the-secure-shell-fc9158b70764?source=collection_archive---------0----------------------->

借此机会，我在这里向大家解释我们如何使用一个非常知名的工具，但主要是软件开发人员和计算机相关人员，即 **SSH** 或**安全外壳**。

SSH 终端可以为我们的业务、项目甚至开发工作流做很多事情，包括配置、VCS 设置、用户管理、部署活动等等，SSH 终端是服务器管理的主要窗口。

我将向您展示一些与 **SSH 基本用法**、协议交互、安全实践等相关的孤立概念。但首先，我们需要给它一个自定义但正式的定义。一个 **SSH** 是一个控制台，帮助你以一种加密的方式访问计算机和网络设备，就是这样，没有更多要添加的了。当然，在它之后还有一个全新的世界，宋承宪只是它的一扇大门。

## 背景

以防前面的概念不是那么不言自明。我会尽量扩展一点，但不会太深入。SSH 的主要功能是提供一种远程管理的方式，前提是安全的加密连接。

`SSH`是一套工具，你也可能在周围遇到`scp`或`sftp`。`SSH`也可以被认为是一种网络协议，是`telnet`的一种演变，因为它不能在通信中处理加密，所以不安全。

`SSH`工作在端口`22`

## 装置

大多数基于 Linux 的发行版已经安装了`SSH`，通常附带了`OpenSSH`工具，但也可以安装其他工具。实际上，在`apt`或`yum`包管理器的帮助下，你可以安装相关的构建(来自源代码)、预编译的软件，甚至为操作系统库下载。

另一方面，Windows 系统支持 SSH 协议，但不包含任何工具。你可以看看`Putty`(这是 Windows 最流行的版本)，但是我很确定`OpenSSH`也有 Windows 操作系统的解决方案。

从现在开始，我只从基于 Linux 的角度来谈。我实际上是在一台 Debian 9 机器上工作，所以，大多数概念可以复制到 Windows 机器上，但是一些特性或与之交互的方式可能会因操作系统而异。说完了，我们继续。

您可以使用命令`which ssh`检查位置，使用`man ssh`检查文档

## 配置

对于大多数用户来说，`SSH`客户端在默认配置下工作得很好，但是实际上你可以改变它来实现任何特定的目标。`SSH`配置文件在`/etc/ssh/sshd_config`(服务器端)和`/etc/ssh/ssh_config`(客户端)上。

对于服务器端，您可以配置的主要内容是服务端口号(`PORT`)、监听 IP 地址(`ListenAddress`)、协议版本(`Protocol`和`HostKey`。当然还有更多，但是所有的都与日志、认证和其他相关特性有关。

## SSH 客户端

为了使用`SSH Client`，必须在远程服务器上安装并运行`SSH server`。当然，端口`22`必须打开(如果保持默认)。

然后，如果您使用的是`Windows` (w/ `Putty`)，打开程序并输入`host`、`port`，软件将尝试连接，同时会提示您接受并注册您的`HostKey`，之后您需要添加您的`username`和`password`。在此之后，一个会话将会完成，然后您将能够提示任何命令

对于`Debian`(基于 Linux)来说，需要一个 shell，这个过程更简单，您需要键入以下内容。

`ssh <user>@<ip>`

之后的过程是一样的。

## 证明

通过`SSH`执行有效认证的另一种方式是使用来自`SSH client`的公钥或私钥。这对于远程脚本执行非常有用，因为您可以绕过键入`user`和`password.`的过程

在`ssh-keygen`命令的帮助下，您可以在机器中创建密钥。该过程生成两个密钥，一个是存储在机器上的`private key`,另一个是远程传输的`public key`,以便在目标机器上进行身份验证。

因此，这可以总结为 4 个主要步骤:

1.  生成密钥:`ssh-keygen [options]`
2.  复制公钥:`scp id_rsa.pub root@IP:/home/david/id_rsa.pub`
3.  发送用于识别远程机器的密钥(从远程服务器)，例如:`cat id_rsa.pub > .ssh/authorized_keys`
4.  用您的 IP、域和用户更改`/etc/hosts`文件

## 避免 Root 访问

一旦与`root`用户建立连接，您将需要配置服务以避免使用`root`用户访问。必须保护好`root account`并在必要时使用，但不要用于日常使用。

您必须使用普通(或不同)用户帐户，然后在需要时提升权限。

为了避免根用户访问，您需要配置 SSH 服务器，特别是`/etc/ssh/sshd_config`文件，并阻塞`PermitRootLogin=no`选项。

之后，必须重新启动服务。这是这样完成的:`service sshd restart`

## 远程连接工具

以前，`telnet`、`ftp`和`tftp`是远程访问机器的传统协议。许多人仍然使用这些服务来维护旧软件、配置 CMS 和不太旧的生产软件。

最常见的使用案例是`Wordpress CMS`的最终设置，许多人使用`FTP clients`来更改`wp-config.php`文件中的数据库凭证，忽略这一点，`ftp`以及`telnet`和`tftp`都是不安全的协议，信息以明文形式传输，没有任何加密，因此容易受到任何基于流量拦截(嗅探)的攻击。

您可以在受控环境中轻松启动与`Wireshark`的会话，并开始嗅探网络流量，当您使用`telnet client`进行身份验证时，甚至在使用`FTP client`时，您将在捕获的流量中的任何地方看到明文形式的身份验证凭证(您可以过滤 FTP 数据包)

出于这个原因，`SSH`附带了一套专门处理加密连接的工具。信息的传播没有任何易读的可能性。

然后，一个“新生”的工具概念出现了，它们是`scp`、`sftp`和`sshfs`。我说“新生”是因为它们并不新，已经存在了一段时间。

## 单细胞蛋白质

这个工具是`SSH`程序的一部分，`SCP`代表`Secure Copy protocol`。这是一个程序，让您复制文件安全之间的本地网络或互联网加密连接。

该服务需要远程服务器中的`user`和`password`来建立连接。使用的基本限制是您需要非常了解它们`system directory`，因为该工具不会让您轻松地“穿越”目录树，所以如果这是您的第一种情况，可能会有点混乱。

这里有一个例子:

`scp file.txt root@IP:/root/file.txt`

## science for the people 为人类服务的科学

名字本身就说明了问题，是`FTP`的安全版。这个工具让你以一种安全的方式远程传输和复制文件。很酷的一点是，它维护了一个到远程服务器的会话，让您可以轻松地与目录树进行交互。

`SFTP`使用两个命令下载(`get`)和上传(`put`)

这里有一个例子:

`sftp root@192.168.1.12`(执行连接)

`sftp> ls`(清单目录)

`sftp>`上传文件到服务器

## SSHFS

这个工具用于远程共享文件，通过本地安装远程文件系统，就像`Docker Volumes`一样，如果你熟悉这个概念的话。`SSHFS`需要分开安装。

SSHFS 非常容易使用，你只需要创建一个目录作为远程本地目录，这个目录在远程机器上也是可见的，就像两台机器共享的文件系统。

这是本地和远程文件夹之间的简单文件夹映射，类似于客户端-服务器。

我来从头解释一下。

假设我们有一个名为`files`的本地目录，其中有一个`anything.txt`文件，所以我们需要共享这个文件，对吗？。

你可以很容易地启动一个`sftp session`和`upload`文件，但是用`SSHFS`我们将使用整个目录，所以让我们共享这个文件夹

`sshfs root@IP:/home/files/ home/david/Documents`

命令的第一部分指的是`remote server`，第二个目录指的是`local machine`

您可以关闭和卸载引用本地机器目录的连接，如下所示:

`fusermount -u /home/david/Documents`

## 多个 SSH 会话怎么办？

总的来说，只在一个 shell 中打开和关闭 SSH 连接有点乏味，有许多多路复用器终端可以让您一次处理多个 shell(以及可能的多个连接)。

最后。

## 保护 SSH 配置和连接

默认情况下，SSH 是一个安全的协议，但是它总是可以得到更好的保护。为了保护服务器或客户机的 SSH 连接，您可以做一些事情。让我给你列出来。

**服务器端**

1.  将默认端口从`22`更改为任意端口
2.  避免`root access`
3.  使用协议`ver 1`禁用`SSH`
4.  限制用户连接、会话和重新连接尝试。

**客户端**

1.  连接到正确的端口
2.  编辑永久设置的设置文件
3.  使用基于密钥的身份验证，并安全地处理生成的密钥。

对于双方，您可能需要重新启动服务。

就是这样。

在我离开之前，让我说我故意漏掉了`SSH port forwarding`和`X-forwarding`(这是为了用 SSH 打开 GUI 应用程序)。两者都是不常见的概念，很少能在周围看到。如果你有兴趣，做简单的研究，并不是什么大事。

这篇文章来自我的经验，如果你看到有什么不对的地方，请随时补充。知识是免费的

快乐编码:)