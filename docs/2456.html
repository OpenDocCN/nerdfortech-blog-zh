<html>
<head>
<title>Predicting the Outcome of NBA Games Using Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用机器学习预测NBA比赛结果</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/predicting-the-outcome-of-nba-games-using-machine-learning-676a62549040?source=collection_archive---------7-----------------------#2021-05-07">https://medium.com/nerd-for-tech/predicting-the-outcome-of-nba-games-using-machine-learning-676a62549040?source=collection_archive---------7-----------------------#2021-05-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7584" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">主题:本博客是“2004-2020年NBA主场优势探索性数据分析”的延伸，可以在这里找到<a class="ae jd" href="https://jyduan-8715.medium.com/exploratory-data-analysis-of-home-team-advantage-in-the-nba-2004-2020-58c9922a8744" rel="noopener"/>。在EDA中，发现助攻、三分球命中率和投篮命中率对为什么NBA主场球队在近60%的时间里获胜具有最大的影响。使用这些结论作为进一步分析的基础，我们将尝试使用比赛统计数据通过各种模型来预测NBA比赛的结果。</p><p id="bc5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据集:我使用了与EDA相同的数据集，其中包含了2004年至2020年NBA比赛的统计数据。这些统计数据包括得分(PTS)、助攻(AST)、篮板(REB)、投篮命中率(FG)、三分球投篮命中率(FG3)，并按主客场球队分列。空数据和异常值被移除，留给我们超过23，000场比赛的数据。附加了主队和客场队之间的PTS差异(PTS_dif)、AST差异(AST_dif)、REB差异(REB_dif)、FG差异(FG_dif)和FG3差异(FG3_dif)的附加列。链接到数据集可以在<a class="ae jd" href="https://www.kaggle.com/nathanlauga/nba-games/notebooks" rel="noopener ugc nofollow" target="_blank">这里</a>或者<a class="ae jd" href="https://drive.google.com/file/d/1JKrgiC6-JVwVSodYbIDdB9Ah4jYp0W_D/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">这里</a>找到。有关数据处理的更多细节，请参考<a class="ae jd" href="https://jyduan-8715.medium.com/exploratory-data-analysis-of-home-team-advantage-in-the-nba-2004-2020-58c9922a8744" rel="noopener"> EDA </a>。代码链接可以在我的<a class="ae jd" href="https://github.com/jduannn/MachineLearningModel" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="893e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">检查变量之间的关系</strong></p><p id="33c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在做任何建模之前，我首先检查了我的自变量和因变量之间的关系。所有的预测变量似乎至少与PTS_dif有适度的正相关。FG_dif与PTS_dif的相关性最强，相关系数(r)为0.769。另一个好的迹象是，除了PTS_dif稍微有点零星之外，每个变量都近似正态分布。另一点需要注意的是，AST_dif和FG_dif之间似乎存在某种共线性。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/51808b7cfa091797c7b3654c5a6f810c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b37MUG4OPDSMef2kp64g8A.png"/></div></div></figure><p id="f94e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模型1:多元回归</strong></p><p id="6cfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于我们拥有的变量和数据，我将首先使用多元回归创建一个模型，以预测给定AST、REB、FG和FG3差异的NBA比赛的PTS_dif。因为我在EDA中的结论是，REB_dif并没有对获胜产生巨大的影响，所以我将首先使用AST_dif、FG_dif和FG3_dif构建一个回归模型。数据分为70%的训练和30%的测试，以测量模型的准确性。该模型的R平方得分为0.65，平均绝对误差(MAE)为6.21(请注意，我们使用平均绝对误差而不是均方根误差作为准确性的衡量标准，因为它对较大的数据集更一致，对异常值更不敏感)。对于这个模型，预测变量的方差只能解释PTS_dif方差的65%。平均而言，该模型的预测误差为6.21个百分点。添加REB_dif作为另一个独立变量会将R平方增加到0.71，并将MAE降低到5.65。似乎通过多元回归模型，REB_dif实际上提高了预测PTS_dif的准确性。包括所有预测器的模型解释了PTS_dif的大约71%的方差，同时平均错过了5.65个PTS的预测。这个模型的残差图看起来很好，没有异方差的迹象。此外，误差的分布似乎是近似正态的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jq"><img src="../Images/19bda66fba46bccedc241d3179cb1691.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*kJ3gjCdwlKl3F7mhq6Ys-g.png"/></div></figure><p id="6403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，多元回归模型在预测NBA比赛的得分差异方面做得相当一般。基于R平方，看起来我是不合适的，并且缺少一些其他变量来解释PTS_dif的变化。这可能是失误或犯规之类的统计数据。然而，由于NBA没有以一种容易理解的方式提供这些统计数据，所以很难尝试将它们纳入我的模型。</p><p id="9cb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模型1B:多元回归续</strong></p><p id="5321" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我不能添加更多的预测变量，我试图通过只考虑不接近的比赛(PTS_dif大于4)来改进模型。这样做可以将R平方提高到0.75，但会将MAE提高到5.83。这是有意义的，因为预测具有较大PTS差异的游戏也将导致较高的误差。当我使用这个模型预测接近的游戏的PTS _ dif(PTS _ dif在4以内)时，结果极差。R平方为0.09，MAE为2.35(MAE较小，因为对于4分以内的游戏，PTS_dif范围要小得多)。基于这些观察，似乎这个多元回归模型对于预测接近的NBA比赛中的PTS差异不是很好，并且在预测不接近的比赛中仅略微好一点。展望未来，预测一场比赛的结果(赢/输)可能比试图预测PTS_dif更合理。</p><p id="bdf8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模型2:预测结果的逻辑回归</strong></p><p id="1410" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于回归模型，我首先通过简单地猜测最频繁的结果(主场获胜)来建立0.596的基线准确度。使用数据集，我使用HOME_TEAM_WINS作为我的目标变量，它的值为1表示主场获胜，为0表示主场失败。由于所有四个预测因子似乎对多元回归都很重要，我将使用AST_dif、REB_dif、FG_dif和FG3_dif作为回归模型中的独立变量。就像模型1一样，数据被分为70%的训练和30%的测试，以测量模型的准确性。将逻辑回归模型应用到测试数据中，我得到了0.836的准确度分数，与基线准确度0.596相比，这是非常好的。分类报告上的回忆和f1分数显示，该模型在预测主场获胜方面比主场失败方面更加准确。这种趋势得到了混淆矩阵的支持，混淆矩阵的假阳性分类比例上多于假阴性。这意味着这个模型偏向于主场获胜，这是有道理的，因为我们的EDA透露，主队赢得了近60%的比赛。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jr"><img src="../Images/cf970dd284df393a7ae1f234a5bfc449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*xIVHTtn1LwF4AtVLd6HjPA.png"/></div></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es js"><img src="../Images/a7c4675da52623b738231fb17e8ff220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*ut6ryzOvP4uzV1rA_v2sAQ.png"/></div></figure><p id="7dcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">总的来说，尽管有偏差，逻辑回归模型在预测NBA比赛结果方面做得非常好。但是，在进一步探索这个模型之前，我想考虑一些其他的分类器，看看是否有另一个模型值得使用。</p><p id="a356" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">模型3:分类器</strong></p><p id="abe0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在使用其他分类器来尝试和预测比赛结果之前，我对数据进行了标准化，以确保模型之间的一致性。然后，这个标准化数据被分成70%的训练数据和30%的测试数据。我使用的模型包括一个通用的bagging分类器，一个随机森林分类器，一个自适应boosting分类器，最后是一个投票集成分类器。模型的准确度得分如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jt"><img src="../Images/2d48459c9c391694ffce895755acd489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*pAv6ruauTsgysoWOy5FgJw.png"/></div></figure><p id="a6e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用相同的变量，测试的其他分类器没有一个超过逻辑回归的准确度。值得注意的是，AdaBoost模型给予REB_dif比随机森林更大的权重，而随机森林给予AST_dif更大的重要性。两者都将FG_dif指定为最重要的特性，FG3_dif次之。AdaBoost比随机森林更准确，它给FG_dif和AST_dif分配较小的权重，给FG3_dif和REB_dif分配较大的权重。这一发现引起了人们的注意，因为它有可能改进逻辑回归模型。</p><p id="ed59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最终模型:逻辑回归续</strong></p><p id="5b10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为其他分类器都无法达到模型2的精度，所以我决定进一步探索逻辑回归模型的潜力(有时最简单的模型可以获得最好的结果)。以前用逻辑回归模型发现的一个问题是假阳性的比例很大。为了解决这个问题，并希望提高模型的准确性，我将对数据进行标准化和重新采样。最初的训练数据中，主场输球和主场赢球的比例约为4:6。这是假阳性和模型固有偏差的主要原因。为了解决这个问题，我使用了随机过采样和欠采样(即随机去除主场胜利，随机复制主场失败)，直到我得到主场失败与主场胜利的比率为9:10。这应该会减少模型的偏差和误报，同时仍然保留我在EDA中讨论过的固有的“主场优势”。与原始模型相比，混淆矩阵显示假阳性显著减少。然而，除了以Home_Win为代价提高了Home_Loss的回忆分数之外，模型的整体准确性没有显著变化。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ju"><img src="../Images/290ae94f5872adc7de181df41392719b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*Ugwno2L333B3NCErjT4c2g.png"/></div></figure><p id="46ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还尝试使用网格搜索进行超参数优化。我对C、penalty、不同的求解器和max迭代使用了网格搜索，交叉验证了3次，总共测试了2700次拟合。令人惊讶的是,“最优”模型的性能并没有真正的区别。精确度与基础模型的0.836相同，正如分类报告所揭示的，两个模型之间几乎没有任何差异。主要的区别是在重新取样的数据模型中，房屋损失的回忆分数要高得多。</p><p id="3fca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">基本型号</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jr"><img src="../Images/cf970dd284df393a7ae1f234a5bfc449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/1*xIVHTtn1LwF4AtVLd6HjPA.png"/></div></figure><p id="c680" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">归一化&amp;重采样模型</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jv"><img src="../Images/bd399b87ab2447da8009d45102ccab88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*dq0bllSqXnT8eb9aHzVOiQ.png"/></div></figure><p id="6659" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">网格搜索CV模型</strong></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jw"><img src="../Images/08508cd08bce066dad4b90184cc33ccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*59Gf-VR70SYFClbebuGrqg.png"/></div></figure><p id="0cb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="1fe0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很难断定哪个逻辑回归模型是最好的，因为准确性始终非常一致。尽管尝试了不同的模型，对数据进行了归一化和重采样，并对参数进行了微调，但我无法真正提高模型的准确性(就预测NBA比赛的结果而言)。这向我表明，我的模型的主要限制是缺乏额外的预测变量。包括另一个变量，如失误差、犯规差或抢断差，可以显著提高分类模型的性能。同样，由于我的数据集的限制，这很难做到。在未来的模型中，我会尝试收集更多的变量，并进一步探索投票集成分类器作为另一种选择，因为它显示出很好的潜力。总的来说，这个模型在这个时间点上是怎样的，我不习惯用它来准确预测NBA比赛。在考虑使用这个模型之前，我想得到至少90%的准确率。其他<a class="ae jd" href="https://library.ndsu.edu/ir/bitstream/handle/10365/28084/Predicting%20Outcomes%20of%20NBA%20Basketball%20Games.pdf" rel="noopener ugc nofollow" target="_blank">型号</a>已经能够达到88–94%之间的准确率，所以这是基准。</p><p id="7ff2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">重要提示</strong></p><p id="5eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个模型不要与其他模型混淆，其他模型试图在不知道实际游戏统计数据的情况下预测游戏的结果。这些模型依赖于每个队的统计比率来预测比赛的结果，而不知道比赛本身的任何统计数据。我的模型更像是一种分类，我们只是试图根据给定的最终统计数据进行分类和输赢。这就是为什么我们的目标是更高的准确率。</p></div></div>    
</body>
</html>