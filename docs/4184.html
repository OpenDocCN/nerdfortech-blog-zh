<html>
<head>
<title>Debouncing &amp; Throttling in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript中的去抖动和节流</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/debouncing-throttling-in-javascript-d36ace200cea?source=collection_archive---------0-----------------------#2021-07-10">https://medium.com/nerd-for-tech/debouncing-throttling-in-javascript-d36ace200cea?source=collection_archive---------0-----------------------#2021-07-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/76b38f1417211a958231ffa0d9073425.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JdXNjkwq9R5hyZuzWGDF_Q.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">詹姆斯·哈里逊在<a class="ae hv" href="https://unsplash.com/s/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><div class=""/><p id="ed16" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">去抖动和节流是javascript中优化应用程序和浏览器性能的技术。</p><p id="53ce" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">什么是去抖功能？</strong></p><p id="8102" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">去抖功能限制函数调用的执行，并在再次运行之前等待一段时间。</p><p id="8407" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来看一个我们最常用的真实场景。</p><p id="78aa" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">大多数网站都有搜索栏，帮助用户用特定的关键字搜索，以得到他们想要的东西。如果我们以电子商务为例，当用户试图搜索一个特定的产品时，甚至在他输入整个关键词之前，就可以看到多个建议弹出来。</p><p id="4cff" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以这里发生的事情是，一旦用户开始键入关键字，我们就对每个字符进行API调用。如果用户键入“Apple MacBook Pro”，那么我们已经进行了17次(包括空格)API调用来获得结果。</p><p id="f170" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这种方法并不理想，尽管我们的初衷是在用户打字时向他显示建议。</p><p id="abf3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过去抖逻辑优化和减少API调用的数量。在进行下一次API调用之前，我们可以等待一段时间。</p><p id="45d6" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里我们监控用户在两次按键之间给出的延迟。如果这个延迟符合我们的阈值限制，那么我们进行另一个API调用。</p><p id="74e7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们将500毫秒作为这个延迟的阈值限制，这意味着如果用户花费500毫秒或更长时间来键入下一个字符，那么我们才进行下一个API调用。理想情况下，当用户键入“Apple MacBook Pro”时，每次按键之间的延迟时间为500毫秒或更长，只有3到5次。这样，我们可以将API调用的数量从17个减少到3-5个。</p><p id="0769" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看我们的代码在第一个场景中是怎样的，其中17个API调用发生在“Apple MacBook Pro”上</p><p id="1ea4" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通常我们会用onChange或onKeyUp事件来处理搜索功能。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1645" class="kc kd hy jy b fi ke kf l kg kh">&lt;input</span><span id="fc2f" class="kc kd hy jy b fi ki kf l kg kh">className="search-bar"</span><span id="fb78" class="kc kd hy jy b fi ki kf l kg kh">onChange={ <strong class="jy hz">searchHandler</strong> }</span><span id="bbc6" class="kc kd hy jy b fi ki kf l kg kh">/&gt;</span></pre><p id="a682" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">searchHandler函数将如下所示:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="dc88" class="kc kd hy jy b fi ke kf l kg kh">function <strong class="jy hz">searchHandler</strong>(...args){</span><span id="cc24" class="kc kd hy jy b fi ki kf l kg kh">/* capture the search query entered by customer */<br/>const { value } = args[0].target;</span><span id="782f" class="kc kd hy jy b fi ki kf l kg kh">/* Make an API call with search query */<br/>getSearchResults(value);</span><span id="42c0" class="kc kd hy jy b fi ki kf l kg kh">}</span></pre><p id="e18d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们看看如何使用searchHandler和delay threshold作为参数编写一个可重用的去抖函数:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6c01" class="kc kd hy jy b fi ke kf l kg kh">const <strong class="jy hz">optimisedSearchHandler</strong> = <strong class="jy hz">debounceFunc</strong>(<em class="kj">searchHandler</em>, <em class="kj">500</em>)</span><span id="2d41" class="kc kd hy jy b fi ki kf l kg kh">const <strong class="jy hz">debounceFunc</strong> = (<em class="kj">func</em>, <em class="kj">delay</em>) =&gt; {<br/>   let timer;<br/>    return function(...<em class="kj">args</em>) {<br/>       const context = this;<br/>       clearTimeOut(timer);<br/>       timer = setTimeOut(() =&gt; {<br/>           func.apply(context, args);<br/>       }, delay)<br/>     }</span><span id="1169" class="kc kd hy jy b fi ki kf l kg kh">}</span></pre><p id="2f53" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">去抖功能逻辑分解:</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kk"><img src="../Images/4e1bebd6bc30a862cbd99dad0843188e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J11IX1jHl4sqF-8Y4FKleg.png"/></div></div></figure><p id="0fa3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以将optimisedSearchHandler传递给我们的搜索栏输入onChange事件</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7349" class="kc kd hy jy b fi ke kf l kg kh">&lt;input</span><span id="199b" class="kc kd hy jy b fi ki kf l kg kh">className="search-bar"</span><span id="fee3" class="kc kd hy jy b fi ki kf l kg kh">onChange={ <strong class="jy hz">optimisedSearchHandler</strong> }</span><span id="7b50" class="kc kd hy jy b fi ki kf l kg kh">/&gt;</span></pre><p id="de0e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样，我们可以避免多次执行任何昂贵的功能，如基于用户行为逻辑的searchHandler。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="be5e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">什么是节流功能？</strong></p><p id="b54d" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">节流是一种限制事件处理函数执行的技术，即使该事件由于用户操作而连续触发。(例如:调整浏览器大小)</p><p id="a5cc" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们举一个射击游戏的例子，用户连续扣动武器的扳机。我们需要注意不同类型武器的<a class="ae hv" href="https://en.wikipedia.org/wiki/Rate_of_fire" rel="noopener ugc nofollow" target="_blank"><strong class="ix hz"/></a><strong class="ix hz"/>射速。</p><p id="6b2a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">散弹枪在两轮射击之间可能需要更多的时间间隔，而机关枪需要更少的时间间隔。但这里的挑战是，通常用户连续点击触发按钮，我们需要注意每次拍摄之间的时间间隔。</p><p id="a4b7" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设霰弹枪发射下一发子弹需要500毫秒，而机枪只需要100毫秒。我们需要编写这样的逻辑，即使用户在这个阈值之前点击触发按钮，我们也应该根据武器的<strong class="ix hz">射速保持射击。</strong></p><p id="4440" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">触发器单击的事件处理程序:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6b05" class="kc kd hy jy b fi ke kf l kg kh">window.addEventListener(onclick, <strong class="jy hz">handlerTrigger</strong>);</span><span id="1050" class="kc kd hy jy b fi ki kf l kg kh">const handlerTrigger = () =&gt; {</span><span id="a37a" class="kc kd hy jy b fi ki kf l kg kh">  fireShot();      // Expensive call</span><span id="50e8" class="kc kd hy jy b fi ki kf l kg kh">}</span></pre><p id="4f26" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">每当用户点击某个按钮时，上面的代码调用handlerTrigger函数。</p><p id="7664" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，让我们看看如何使用handlerTrigger和interval作为参数编写一个可重用的throttle函数:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f255" class="kc kd hy jy b fi ke kf l kg kh">const <strong class="jy hz">optimisedTriggerHandler</strong> = <strong class="jy hz">throttleFunc</strong>(handlerTrigger, 100);</span><span id="bfcd" class="kc kd hy jy b fi ki kf l kg kh">const <strong class="jy hz">throttleFunc</strong> = (func, interval) =&gt; {<br/>     let shouldFire = true;<br/>   return function() {<br/>         if (shouldFire) {<br/>             func();</span><span id="6b96" class="kc kd hy jy b fi ki kf l kg kh">             shouldFire = false;</span><span id="9c84" class="kc kd hy jy b fi ki kf l kg kh">             setTimeOut(() =&gt; {<br/>               shouldFire = true;<br/>              }, interval)</span><span id="ce1e" class="kc kd hy jy b fi ki kf l kg kh">          }<br/>       }<br/>  }</span></pre><p id="b1f5" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">节流功能逻辑分解:</p><figure class="jt ju jv jw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/2a5554f6b441a268e3c4fff69d4eb882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O7jF7AXhUn1d8jHJE6oRSQ.png"/></div></div></figure><p id="eef3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我们可以将<strong class="ix hz">optimized trigger handler</strong>传递给onclick事件监听器:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="be52" class="kc kd hy jy b fi ke kf l kg kh">window.addEventListener(onclick, <strong class="jy hz">optimisedTriggerHandler</strong>);</span></pre><p id="10bd" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样我们可以为不同时间间隔的<strong class="ix hz"> </strong>不同武器制作<strong class="ix hz">优化扳机手柄</strong>的副本。</p><p id="804f" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要理解apply方法是如何工作的，请查阅我关于用JavaScript调用、应用和绑定的文章。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="404b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hz">概要:</strong></p><ol class=""><li id="7be6" class="kt ku hy ix b iy iz jc jd jg kv jk kw jo kx js ky kz la lb bi translated"><strong class="ix hz">去抖</strong>是一种技术，我们可以监控用户动作的时间延迟，一旦该延迟达到我们预定的阈值，我们就可以进行函数调用。</li><li id="5606" class="kt ku hy ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated"><strong class="ix hz">节流</strong>是一种技术，在这种技术中，我们在预先确定的时间间隔内进行函数调用，而不考虑连续的用户操作。</li><li id="f9fe" class="kt ku hy ix b iy lc jc ld jg le jk lf jo lg js ky kz la lb bi translated">尽管去抖动和节流看起来很相似，但它们都有自己的使用案例。不建议在<strong class="ix hz">搜索栏</strong>中使用节流逻辑，我们不能在<strong class="ix hz">射击游戏</strong>场景或<strong class="ix hz">浏览器调整</strong>或<strong class="ix hz">滚动</strong>事件中使用去抖动。</li></ol></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><p id="082a" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae hv" href="https://www.linkedin.com/in/chidanandan-p/" rel="noopener ugc nofollow" target="_blank"><strong class="ix hz">Chidanandan</strong><strong class="ix hz">P</strong></a>(如果这个名字很难发音，就叫他<strong class="ix hz"> <em class="kj"> Chidu </em> </strong>)是马士基公司的一名软件开发工程师，他在那里帮助构建技术和解决方案，为劳氏公司及其各种业务提供动力。</p></div></div>    
</body>
</html>