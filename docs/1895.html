<html>
<head>
<title>Logging in Rust</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">铁锈伐木</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/logging-in-rust-e529c241f92e?source=collection_archive---------0-----------------------#2021-04-12">https://medium.com/nerd-for-tech/logging-in-rust-e529c241f92e?source=collection_archive---------0-----------------------#2021-04-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="96e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我想谈谈Rust中的日志记录。有了一些背景信息，我将带您浏览两个日志库:env_logger和log4rs。最后分享一下我的推荐和github for snippets。</p><h1 id="1a02" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">背景</h1><p id="79ae" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated"><a class="ae kg" href="https://docs.rs/log/" rel="noopener ugc nofollow" target="_blank"> log </a> create是Rust中事实上的日志API。有五个日志级别:错误(最高优先级)、警告、信息、调试和跟踪(最低优先级)。要记录消息，可以使用相应的日志marcos: error！，警告！等。这些马科斯表现得像println！并且支持<a class="ae kg" href="https://doc.rust-lang.org/std/fmt/" rel="noopener ugc nofollow" target="_blank">格式的语法！</a>。也就是说，{}调用显示在一个对象上，{:？}对对象调用debug，并且{:#？}漂亮地打印调试格式。(后面我们会看到一些例子。)</p><p id="522b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个重要的注意事项是，log crate只提供API，不提供实现。您必须选择一个实现记录器的库。那么，Rust中最常用的日志库是什么呢？</p><h1 id="c6fe" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">图书馆</h1><h2 id="9eb8" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">环境记录器</h2><p id="a479" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">到目前为止，Rust中最常用的日志库是<a class="ae kg" href="https://docs.rs/env_logger/" rel="noopener ugc nofollow" target="_blank"> env_logger </a> crate。在<a class="ae kg" href="https://crates.io/crates/env_logger" rel="noopener ugc nofollow" target="_blank"> crates.io </a>上，env_logger的总下载量已经超过了2300万次。通过代码中的一行配置，<code class="du kv kw kx ky b">env_logger::init()</code>，这个简单的库将您的所有日志写到<code class="du kv kw kx ky b">stderr</code>(可配置为<code class="du kv kw kx ky b">stdout</code>)。顾名思义，env_logger使用环境变量RUST_LOG来配置其日志级别。例如，<code class="du kv kw kx ky b">RUST_LOG=debug cargo run --bin env_logger</code>记录由<code class="du kv kw kx ky b">env_logger</code>二进制文件在调试级别或以上发出的所有内容，即除了跟踪之外的所有内容。</p><p id="77df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个简单的rust程序将它们联系在一起:</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="13fc" class="kh je hi ky b fi lh li l lj lk">use log::debug;<br/>use log::error;<br/>use log::info;<br/>use log::warn;</span><span id="f392" class="kh je hi ky b fi ll li l lj lk">fn main() {<br/>    env_logger::init();<br/>    debug!("Mary has a little lamb");<br/>    error!("{}", "Its fleece was white as snow");<br/>    info!("{:?}", "And every where that Mary went");<br/>    warn!("{:#?}", "The lamb was sure to go");<br/>}</span></pre><p id="5b37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是输出:</p><figure class="kz la lb lc fd ln er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lm"><img src="../Images/58b741bb34841f0d57ef9283077f94e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8xTe73C45rPK9VFFrmxe-w.png"/></div></div></figure><p id="228b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，还有其他一些构建在env_logger之上的库。例如，<a class="ae kg" href="https://docs.rs/pretty_env_logger" rel="noopener ugc nofollow" target="_blank"> pretty_env_logger </a>和<a class="ae kg" href="https://docs.rs/json_env_logger" rel="noopener ugc nofollow" target="_blank"> json_env_logger </a>板条箱。如果你想把你的日志打印出来或者把你的消息记录成json而不是文本，你会发现它们很有用。</p><h2 id="37f9" class="kh je hi bd jf ki kj kk jj kl km kn jn iq ko kp jr iu kq kr jv iy ks kt jz ku bi translated">log4rs</h2><p id="b6fe" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这个<a class="ae kg" href="https://docs.rs/log4rs" rel="noopener ugc nofollow" target="_blank"> log4rs </a>机箱是仿照Java的<a class="ae kg" href="https://logging.apache.org/log4j/2.x/" rel="noopener ugc nofollow" target="_blank"> log4j </a>库设计的。要开始日志记录，您必须创建一个appender，它告诉日志到哪里:控制台、文件或syslog。在生产系统中，您几乎总是希望使用滚动文件附加器。滚动文件附加器根据时间生成一个新的日志文件，比如每小时。这很自然地按时间组织你的日志文件，让你跳过任何不感兴趣的时间段，比如说，当你只想看发生在4月15日晚上7点的事情时。</p><p id="9835" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您需要配置要在系统中保留多少日志文件，通常是按存储大小(保留300GB)或按保留时间(保留30天)。</p><p id="63ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个rust程序将它结合在一起:(正如您所看到的，配置更加详细)</p><pre class="kz la lb lc fd ld ky le lf aw lg bi"><span id="23b3" class="kh je hi ky b fi lh li l lj lk">use log::error;<br/>use log::info;<br/>use log::warn;<br/>use log::{debug, LevelFilter};<br/>use log4rs::append::console::ConsoleAppender;<br/>use log4rs::config::{Appender, Root};<br/>use log4rs::Config;</span><span id="529c" class="kh je hi ky b fi ll li l lj lk">fn main() {<br/>    let stdout = ConsoleAppender::builder().build();</span><span id="4014" class="kh je hi ky b fi ll li l lj lk">    let config = Config::builder()<br/>        .appender(Appender::builder().build("stdout", Box::new(stdout)))<br/>        .build(Root::builder().appender("stdout").build(LevelFilter::Trace))<br/>        .unwrap();</span><span id="80d5" class="kh je hi ky b fi ll li l lj lk">    let _handle = log4rs::init_config(config).unwrap();</span><span id="11d7" class="kh je hi ky b fi ll li l lj lk">    debug!("Mary has a little lamb");<br/>    error!("{}", "Its fleece was white as snow");<br/>    info!("{:?}", "And every where that Mary went");<br/>    warn!("{:#?}", "The lamb was sure to go");<br/>}</span></pre><p id="990b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是输出:</p><figure class="kz la lb lc fd ln er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es lu"><img src="../Images/fa176371d12ab892a1387367d94c4589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H_6OM6LYRYRl0ZKfbbxRmg.png"/></div></div></figure><h1 id="66ee" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="8f79" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我的建议是从简单的开始— <a class="ae kg" href="https://docs.rs/env_logger" rel="noopener ugc nofollow" target="_blank"> env_logger </a>。如果你对你的业余项目越来越认真，切换到<a class="ae kg" href="https://docs.rs/log4rs" rel="noopener ugc nofollow" target="_blank"> log4rs </a>以获得更好的解决问题的能力。</p><p id="43fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我把这些例子放在github的<a class="ae kg" href="https://github.com/j4ckcyw/rust-logging-samples" rel="noopener ugc nofollow" target="_blank"> rust-logging-samples </a>下。请随时向我发送添加更多库的请求。如果你对这个话题感兴趣，也可以在<a class="ae kg" href="https://twitter.com/jackchan_1" rel="noopener ugc nofollow" target="_blank"> twitter </a>上关注我。</p></div></div>    
</body>
</html>