<html>
<head>
<title>AWS-Lambda-Trigger_Automation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS-Lambda-触发器_自动化</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/aws-lambda-trigger-automation-38b2f4ac928a?source=collection_archive---------11-----------------------#2021-05-15">https://medium.com/nerd-for-tech/aws-lambda-trigger-automation-38b2f4ac928a?source=collection_archive---------11-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a48f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用Lambda和Dynamo DB设置S3触发器。在这里，我们将通过使用AWS lambda函数获取/触发S3存储桶中添加的新文件来更新dynamo DB，这将是完全自动化的。</p><p id="3914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤1: </strong> <br/>创建一个IAM角色(拥有访问AWS服务的特定权限)。<br/>转到角色&gt;创建角色&gt; AWS服务&gt; lambda并选择策略。<br/>在这里，我们附加到我们的角色是“AmazonDynamoDBFullAccess”并向前移动一步以完成进一步的配置。<br/>添加角色名称，角色名称可以是任意的，点击创建。<br/>遵循以下输出。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/455e2a345dde358c457a375a15444bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zZdmyUKrtP6GGOcp.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/bebe7980ac3cb2de4013221d0f6b91cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RZpbryViIu-acDvM.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/48ba79a9b592020f3c4590d55ea39874.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*srJ2k95U8muSCjWi.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c4413bd6f1cef9475e3612b6a8181c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FbOqVIzUjlT5lq19.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/f1c4f709ee950ec5df88afbbedbf38e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aso1Hwyz1kosoMX_.png"/></div></div></figure><p id="9635" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤2: </strong> <br/>创建一个Lambda函数(这个函数将被进一步用来触发S3桶服务)。<br/>这里，我们将使用python 3.6版本集成dynamo DB。<br/>必须选择在步骤1中创建的角色。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/94cb01cf1cfdf6a420d8d899737c88a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zKSBnNRld2CvJMFz.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a37afec5fccc4287153b6b3d644c6d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mvYCsSu8tIOab3n2.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ab9cf07d8a7044a6b43e320b430c5fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lX-sMEyDlJABuK7r.png"/></div></div></figure><p id="1fef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">lambda函数的名称可以是任何名称。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/64cbbfabf029187ce641e7d63f5b5755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3lISMWtxazjlN7-o.png"/></div></div></figure><p id="c8a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里的配置中，您可以看到该功能所访问的服务的权限。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/cc0c597ac2b5d16565e955cf492ff318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HTlDO0ot-5hWj4SI.png"/></div></div></figure><p id="0b06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在代码源代码中，实现了一个Python脚本来与Dynamo DB交互。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/2c1cba9271caba9ec64fcc99f5d9e2a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gjJYtZH7wF2oNky2.png"/></div></div></figure><pre class="je jf jg jh fd jr js jt ju aw jv bi"><span id="5c0e" class="jw jx hi js b fi jy jz l ka kb">import boto3 <br/>from uuid import uuid4 <br/>def lambda_handler(event, context):<br/>    s3 = boto3.client("s3")<br/>    dynamodb = boto3.resource('dynamodb')<br/>    for record in event['Records']:<br/>        bucket_name = record['s3']['bucket']['name']<br/>        object_key = record['s3']['object']['key']<br/>        size = record['s3']['object'].get('size', -1)<br/>        event_name = record ['eventName']<br/>        event_time = record['eventTime']<br/>        dynamoTable = dynamodb.Table('newtable')<br/>        dynamoTable.put_item(<br/>            Item={'unique': str(uuid4()), 'Bucket': bucket_name, 'Object': object_key,'Size': size, 'Event': event_name, 'EventTime': event_time})</span></pre><p id="2296" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤3: </strong> <br/>创建一个S3桶，从Lambda函数触发。<br/>现在，存储桶和区域的名称可以是任意的。<br/>允许所有公共访问，因为这是学习阶段。<br/>最后，桶创建完成。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/edbe057bc5c5119f7ed39c5bef8678aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_6m2hF1cYAn7D-Nr.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/59677da1a0314b0172819af4c354368b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mOGAZgzSSZM1Epb9.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kc"><img src="../Images/ab7c8d9e2ba7d8ba13e5cda475b7a142.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3WKRcS47CMwnsuyu.png"/></div></div></figure><p id="2b2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4: </strong> <br/>现在我们将设置S3桶，通过使用lambda函数来触发它。<br/>转到“添加触发器”,添加我们之前创建的S3存储桶。<br/>事件类型基本上是一种我们想要的功能类型，如上传删除等。在这里，我们将选择“所有对象创建事件”。<br/>如果我们想添加一个任何扩展名的特定文件，需要使用前缀和后缀。<br/> S3铲斗准备使用Lambda函数触发。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/378d9d5532a8917fc7b33a10a7db813f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*c5nsrC3-WQZUb2R2.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ke"><img src="../Images/a202682613b8f037a0dca3e322657808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3bCOy_rzEjUuW784.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/d44ff956168893b5dfb342c0487a8278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ESiGZavy0wv6DLY7.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2ef9c28679579ddd4eeaab2747bb57ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LPyGD4L1ADYOkPy4.png"/></div></div></figure><p id="2404" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤5: </strong> <br/> DynamoDB将用于存储来自S3存储桶的数据的输入和输出。<br/>转到数据库服务并选择Dynamo DB。<br/>这里我们取表名，即“newtable”和分区键“unique”。这个值可以在我们用来集成dynamo DB的代码中更改。起初，你会看到迪纳摩数据库项目列表是空的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d12bc4fff37dc3b2f22be69ee9a58413.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6TZ3zqmQ3f_eA1c1.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/24713066618c1bcfa9d165efb826205d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*b1hgeHnl5iF9Zp-W.png"/></div></div></figure><p id="b3f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到S3桶尝试手动添加文件/文件夹到你的桶中，我们将看到lambda函数触发器并更新dynamo DB数据库。</p><p id="e2b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，下面的输出显示文件已经在S3桶中更新。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/87a6111b5a90a6881af8aa3ca82d7251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*S9OdYtqvuL-xQtKl.png"/></div></div></figure><p id="c87c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二，通过触发S3桶，使用aws lambda更新DynamoDB。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9ac0d61a01d6197e6a47529477fde0cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XQyq6Qz_Zv9eH7Fr.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/879e0f6b3a131629b36738e219f701ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1q1HSn6C21tkUDkd.png"/></div></div></figure></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="4bba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ko">原载于</em><a class="ae kp" href="https://github.com/kushagra67414/AWS-Lambda-Trigger_Automation/blob/main/README.md" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://github.com</em></a><em class="ko">。</em></p></div></div>    
</body>
</html>