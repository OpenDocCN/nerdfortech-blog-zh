<html>
<head>
<title>Free and Automatic SSL Certificates in Kubernetes using Cert Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用证书管理器在Kubernetes中免费提供自动SSL证书</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/free-and-automatic-ssl-certificates-in-kubernetes-using-cert-manager-6fb65ac63d5?source=collection_archive---------2-----------------------#2021-06-05">https://medium.com/nerd-for-tech/free-and-automatic-ssl-certificates-in-kubernetes-using-cert-manager-6fb65ac63d5?source=collection_archive---------2-----------------------#2021-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2f06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用证书管理器获得免费和自动SSL证书，让我们加密</p><p id="3403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在今天的场景中，SSL证书是将应用程序部署到互联网的最重要部分。只有最重要的属性才能决定你的网站是否安全。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/58f2c00913d3547b01450c50ac7ecb69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kT4ZylzYckLcAPS6.jpg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来源:谷歌</figcaption></figure><p id="f83d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个拨片锁符号向您的客户传达他们正在访问的网站是安全的、受保护的和经过验证的。那么你如何在你的网站上实现HTTPS呢？</p><p id="fb4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">HTTP + SSL = HTTPS。</p><p id="f2d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得SSL证书并不容易。此外，它也很贵。在当今世界，Kubernetes无处不在。由于Kubernetes中有大量的入口资源，获取如此大量的证书、监控它们并每次轮换它们变得非常困难。这对DevOps工程师来说将是一场噩梦。如果我告诉你，有一种工具可以让你免费获得SSL证书，并在证书过期时自动轮换它们，那会怎么样？这里来了<a class="ae jt" href="https://cert-manager.io/docs/" rel="noopener ugc nofollow" target="_blank">证书管理器</a>。Cert-manager是由<a class="ae jt" href="https://jetstack.io/" rel="noopener ugc nofollow" target="_blank"> Jetstack </a>创建的，很多开发仍然由他们赞助。根据证书管理器的官方指南，证书管理器是一个本地的<a class="ae jt" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>证书管理控制器。它可以帮助从各种来源发布证书，例如<a class="ae jt" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank"> Let's Encrypt </a>、<a class="ae jt" href="https://www.vaultproject.io/" rel="noopener ugc nofollow" target="_blank"> HashiCorp Vault </a>、<a class="ae jt" href="https://www.venafi.com/" rel="noopener ugc nofollow" target="_blank"> Venafi </a>、简单签名密钥对或自签名。它将确保证书是有效的和最新的，并尝试在到期前的配置时间续订证书。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ju"><img src="../Images/2da29e55984bb5c17afabbe5075a6ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TUZ9pAACV7oTolqum-Pp7A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片来源:<a class="ae jt" href="https://cert-manager.io/docs/" rel="noopener ugc nofollow" target="_blank">证书管理器</a></figcaption></figure><h1 id="2612" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">整个故事是关于什么的？(TLDR)</h1><ol class=""><li id="d13a" class="kt ku hi ih b ii kv im kw iq kx iu ky iy kz jc la lb lc ld bi translated">理解证书管理器的概念</li><li id="b37d" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">了解各种ACME挑战(DNS01、HTTP01)</li><li id="f0eb" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">从“让我们加密暂存”中创建一个证书，最后从“让我们加密生产”中获取证书。</li></ol><h1 id="0cda" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">先决条件</h1><ol class=""><li id="a6eb" class="kt ku hi ih b ii kv im kw iq kx iu ky iy kz jc la lb lc ld bi translated">GCP帐户(创建GKE群集和云DNS托管区域。您可以获得300美元免费积分的免费等级帐户)。</li><li id="87e1" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">一个领域。(可以从<a class="ae jt" href="https://my.freenom.com/" rel="noopener ugc nofollow" target="_blank"> freenom </a>获得一个免费域名)。</li></ol><h1 id="f0fc" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">故事资源</h1><ol class=""><li id="279f" class="kt ku hi ih b ii kv im kw iq kx iu ky iy kz jc la lb lc ld bi translated">GitHub链接:<a class="ae jt" href="https://github.com/pavan-kumar-99/medium-manifests" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests</a></li><li id="cc92" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">GitHub分支:证书管理器。</li></ol><h1 id="52d3" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建GKE集群</h1><p id="6b58" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">在本文的范围内，我们将使用gcloud CLI来创建集群。我们可以使用<a class="ae jt" href="https://pavan1999-kumar.medium.com/creating-a-gke-cluster-with-github-actions-dd34e2de50a6" rel="noopener"> Github actions </a>自动化创建GKE集群的过程。你可以参考我的<a class="ae jt" href="https://pavan1999-kumar.medium.com/creating-a-gke-cluster-with-github-actions-dd34e2de50a6" rel="noopener">文章</a>关于如何使用GitHub动作创建GKE集群。你也可以克隆我的<a class="ae jt" href="https://github.com/pavan-kumar-99/medium-github-actions/tree/master/gke_tf" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>来应用它。</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="9363" class="lr jw hi ln b fi ls lt l lu lv">gcloud auth login </span><span id="fa46" class="lr jw hi ln b fi lw lt l lu lv"><strong class="ln hj">#Create a GKE Cluster</strong></span><span id="5f06" class="lr jw hi ln b fi lw lt l lu lv">gcloud container clusters create "production-cluster" \<br/> --num-nodes 3 \<br/> --scopes   "https://www.googleapis.com/auth/ndev.clouddns.readwrite" \<br/>--zone us-central1-a \<br/>--node-locations us-central1-a,us-central1-b \ <br/>--project <strong class="ln hj">&lt;project_name&gt;</strong></span><span id="a87c" class="lr jw hi ln b fi lw lt l lu lv"><strong class="ln hj">#Connect to the GKE Cluster</strong></span><span id="628d" class="lr jw hi ln b fi lw lt l lu lv">gcloud container clusters get-credentials production-cluster --zone us-central1-a --project <strong class="ln hj">&lt;project_name&gt;</strong></span></pre><h1 id="6bb0" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">创建谷歌云域名系统和云域</h1><p id="40ee" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">您可以按照此处的步骤注册一个新域，或者将现有域导入GCP，然后创建一个受管理的公共区域。或者，你可以使用<a class="ae jt" href="https://www.freenom.com/en/index.html?lang=en" rel="noopener ugc nofollow" target="_blank"> freenom </a>为自己获得一个免费域名，并在你的GCP账户中创建一个公共区域。</p><div class="lx ly ez fb lz ma"><a href="https://cloud.google.com/dns/docs/quickstart" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">快速入门|云DNS |谷歌云</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">发送反馈本页解释了如何为您的域名设置云DNS管理区域和资源记录。它…</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">cloud.google.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo jn ma"/></div></div></a></div><h2 id="c9bd" class="lr jw hi bd jx mp mq mr kb ms mt mu kf iq mv mw kj iu mx my kn iy mz na kr nb bi translated">安装证书管理器舵图</h2><p id="4b95" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">让我们知道在我们的集群上安装证书管理器的舵图。</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="2529" class="lr jw hi ln b fi ls lt l lu lv">$ helm repo add jetstack <a class="ae jt" href="https://charts.jetstack.io" rel="noopener ugc nofollow" target="_blank">https://charts.jetstack.io</a></span><span id="a42b" class="lr jw hi ln b fi lw lt l lu lv">$ helm repo add jetstack <a class="ae jt" href="https://charts.jetstack.io" rel="noopener ugc nofollow" target="_blank">https://charts.jetstack.io</a></span><span id="4008" class="lr jw hi ln b fi lw lt l lu lv">$ helm install \<br/>  cert-manager jetstack/cert-manager \<br/>  --namespace cert-manager \<br/>  --version v1.2.0 \<br/>  --create-namespace \<br/>  <em class="nc">--set installCRDs=true</em></span></pre><p id="fd75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您应该看到在证书管理器的名称空间中安装了以下组件</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="0148" class="lr jw hi ln b fi ls lt l lu lv">$ <!-- -->k get po -n cert-manager</span><span id="7083" class="lr jw hi ln b fi lw lt l lu lv">NAME                                      READY   STATUS    RESTARTS   AGE</span><span id="5f02" class="lr jw hi ln b fi lw lt l lu lv">cert-manager-7c6df46cf4-k9xnt             1/1     Running   0          39s</span><span id="0e00" class="lr jw hi ln b fi lw lt l lu lv">cert-manager-cainjector-794f5cd9d-ppkmv   1/1     Running   0          39s</span><span id="7a0c" class="lr jw hi ln b fi lw lt l lu lv">cert-manager-webhook-7f97b786f5-7ltnn     1/1     Running   0          39s</span></pre><p id="8c4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有接下来的CRD的</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="b8dd" class="lr jw hi ln b fi ls lt l lu lv">$ <!-- -->k get crd | grep cert-manager | cut -d " " -f1</span><span id="919a" class="lr jw hi ln b fi lw lt l lu lv">certificaterequests.cert-manager.io</span><span id="43dc" class="lr jw hi ln b fi lw lt l lu lv">certificates.cert-manager.io</span><span id="4056" class="lr jw hi ln b fi lw lt l lu lv">challenges.acme.cert-manager.io</span><span id="cb71" class="lr jw hi ln b fi lw lt l lu lv">clusterissuers.cert-manager.io</span><span id="0a88" class="lr jw hi ln b fi lw lt l lu lv">issuers.cert-manager.io</span><span id="6262" class="lr jw hi ln b fi lw lt l lu lv">orders.acme.cert-manager.io</span></pre><h2 id="ab50" class="lr jw hi bd jx mp mq mr kb ms mt mu kf iq mv mw kj iu mx my kn iy mz na kr nb bi translated">安装入口控制器舵图</h2><p id="a81c" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们将使用helm图表在集群中安装入口控制器。但是，您可以参照<a class="ae jt" href="https://kubernetes.github.io/ingress-nginx/deploy/#using-helm" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">本</strong> </a>使用其他方法进行安装。</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="36e1" class="lr jw hi ln b fi ls lt l lu lv">$ helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx </span><span id="1899" class="lr jw hi ln b fi lw lt l lu lv">$ helm repo update  </span><span id="93a0" class="lr jw hi ln b fi lw lt l lu lv">$ helm install ingress-nginx ingress-nginx/ingress-nginx</span></pre><p id="2c62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一个包含部署、服务(类型:ClusterIP)和入口(类型:ingress)的示例Nginx应用程序。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nd ne l"/></div></figure><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="b447" class="lr jw hi ln b fi ls lt l lu lv">$ ip=$(k get ing certmanagerapp-ingress -o jsonpath='{.status.loadBalancer.ingress[0].ip}')</span><span id="d6cf" class="lr jw hi ln b fi lw lt l lu lv">$ echo | openssl s_client -connect $ip:443 2&gt;/dev/null | openssl x509 -noout -issuer</span><span id="c34e" class="lr jw hi ln b fi lw lt l lu lv">issuer=O = Acme Co, CN = Kubernetes Ingress Controller Fake Certificate</span></pre><p id="68b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由此可以清楚地看出，该证书不是一个有效的证书，但它是入口控制器默认提供的证书。</p><h2 id="fc95" class="lr jw hi bd jx mp mq mr kb ms mt mu kf iq mv mw kj iu mx my kn iy mz na kr nb bi translated">使用证书管理器创建证书</h2><p id="f2e2" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">Cert Manager支持从ACME服务器请求证书(自动证书管理环境)。这种ACME服务器的一个例子是Let's Encrypt。大多数电脑都信任由“让我们加密”颁发的证书。要从Let's Encrypt获得此证书，必须解决一个ACME挑战。这证明了客户端拥有他实际请求证书的DNS主机。ACME协议支持各种机制。</p><ol class=""><li id="0431" class="kt ku hi ih b ii ij im in iq nf iu ng iy nh jc la lb lc ld bi translated">HTTP01</li><li id="6079" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">DNS01(在本文中有解释)。</li></ol><p id="3fe6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与DNS01机制相比，HTTP01机制相对更容易。但是DNS01机制比HTTP01安全。</p><p id="99ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> DNS01 </strong>挑战赛中，当证书管理器可以在您的托管区域中成功创建TXT记录时，您的域的所有权就得到证明。</p><p id="3f69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> HTTP01 </strong>中，当证书管理器能够成功地确保一个文件存在于给定路径下的域中时，你的域的所有权被证明。</p><p id="20dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们加密2个ACME服务器URL</p><ol class=""><li id="42af" class="kt ku hi ih b ii ij im in iq nf iu ng iy nh jc la lb lc ld bi translated">分期:<code class="du ni nj nk ln b"><a class="ae jt" href="https://acme-staging-v02.api.letsencrypt.org/directory" rel="noopener ugc nofollow" target="_blank">https://acme-staging-v02.api.letsencrypt.org/directory</a></code></li><li id="f0f0" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">产量:<code class="du ni nj nk ln b"><a class="ae jt" href="https://acme-v02.api.letsencrypt.org/directory" rel="noopener ugc nofollow" target="_blank">https://acme-v02.api.letsencrypt.org/directory</a></code></li></ol><p id="2702" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在生产服务器上有一些受限的速率限制(例如:<strong class="ih hj">每个注册域的证书</strong> - &gt;每周50个等等)。因此，总是建议对暂存URL执行任何类型的测试，然后进入生产环境。</p><p id="f9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，说够了。让我们现在行动起来。</p><p id="bbfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们为我们的证书管理器创建一个秘密，以便它可以访问我们的clouddns进行<strong class="ih hj"> DNS01 </strong>挑战。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nl"><img src="../Images/f115e14ab16cdebd172f2328d69a5912.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Wuh8z6dSHa1jrUyAtw0ww.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Google服务帐户</figcaption></figure><p id="5cdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从GCP控制台创建一个服务帐户，并创建一个具有所需权限的JSON密钥。下载密钥后，让我们通过以下方式在cert-manager名称空间中创建秘密</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="10e4" class="lr jw hi ln b fi ls lt l lu lv">$ kubectl create secret generic clouddns --from-file="./clouddns.json" -n cert-manager </span></pre><p id="8f59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们使用临时ACME服务器创建一个集群发布者，以验证我们的DNS01质询是否按预期工作</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="eab3" class="lr jw hi ln b fi ls lt l lu lv">$ git clone <a class="ae jt" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b cert-manager </span><span id="03d8" class="lr jw hi ln b fi lw lt l lu lv">$ kubectl apply -f cert-manager-staging.yaml</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="855a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们仔细观察清单。</p><ol class=""><li id="feeb" class="kt ku hi ih b ii ij im in iq nf iu ng iy nh jc la lb lc ld bi translated">集群颁发者:颁发者代表一个证书颁发机构，从该机构获取证书。发布者是一个命名空间对象，而集群发布者是一个非命名空间对象。在spec.acme部分下面，我们给acme服务器提供我们之前创建的临时URL和GCP秘密，以及作为我们网站名称的dns名称。</li><li id="1d66" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">证书:这是实际的证书资源。因此，这里我们要求证书管理器创建一个名为bettercallpavan的TLS秘密(使用获得的证书)。这里的群集发布者是让我们加密staging以及我们网站的dns名称。</li><li id="0cb5" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">入口的TLS机密名称与证书资源中提到的名称相同。</li></ol><p id="b27b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们访问我们的网站来检查证书。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nm"><img src="../Images/1f1950438f294685fb9f1c5c29626132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z3tHYymG9CIW981Rs97how.png"/></div></div></figure><p id="32d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">哎，我们的证书现在已经从假的入口控制器证书变成了让我们加密暂存证书。我们现在准备将这一更改推广到生产环境，让我们加密ACME服务器。</p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="ec65" class="lr jw hi ln b fi ls lt l lu lv">$ git clone <a class="ae jt" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b cert-manager</span><span id="6152" class="lr jw hi ln b fi lw lt l lu lv">$ kubectl apply -f cert-manager-production.yaml</span></pre><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nd ne l"/></div></figure><p id="46ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们仔细观察清单。</p><ol class=""><li id="c201" class="kt ku hi ih b ii ij im in iq nf iu ng iy nh jc la lb lc ld bi translated">集群颁发者:颁发者代表一个证书颁发机构，从该机构获取证书。发布者是一个命名空间对象，而集群发布者是一个非命名空间对象。在spec.acme部分，我们给出了ACME server be生产URL和我们之前创建的GCP秘密，以及作为我们网站名称的dns名称。</li><li id="2b26" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">证书:这是实际的证书资源。因此，这里我们要求证书管理器创建一个名为bettercallpavan-production的TLS秘密(使用获得的证书)。这里的群集发布者是让我们加密生产以及我们网站的dns名称。</li><li id="6d11" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">入口的TLS机密名称与证书资源中提到的名称相同。</li></ol><p id="f7b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们访问我们的网站来检查证书。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nn"><img src="../Images/2aa2d4aee5d50ba6843771ad6f61d90e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bYTkeWg3AjZ1ZEAgxY5wCA.png"/></div></div></figure><p id="08b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">啊呀，我们的网站现在安全了。所有证书的默认持续时间为90天，默认续订窗口为30天。这意味着证书的有效期为3个月，到期后1个月内将尝试续订。</p><p id="08fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">清理</strong></p><pre class="je jf jg jh fd lm ln lo lp aw lq bi"><span id="d42a" class="lr jw hi ln b fi ls lt l lu lv">$ git clone <a class="ae jt" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b cert-manager</span><span id="25f2" class="lr jw hi ln b fi lw lt l lu lv">$ cd medium-manifests </span><span id="f8e3" class="lr jw hi ln b fi lw lt l lu lv">$ kubectl delete -f ./* </span><span id="8e83" class="lr jw hi ln b fi lw lt l lu lv">$ kubectl delete secret clouddns -n cert-manager </span></pre><h1 id="6232" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">结论</h1><ol class=""><li id="4c3d" class="kt ku hi ih b ii kv im kw iq kx iu ky iy kz jc la lb lc ld bi translated">Cert-Manager可用于获取有效期为90天的免费SSL证书。</li><li id="5209" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">这些证书可以在到期后一个月内自动尝试更新。</li><li id="40df" class="kt ku hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">这些证书也可以从HashiCorp Vault PKI后端获得(将在我以后的文章中发布)。</li></ol><p id="2b07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读我的文章。希望你喜欢它。以下是我的一些其他文章，你可能会感兴趣。</p><p id="f33e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直到下次……..</p><h1 id="dc76" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">被推荐的</h1><div class="lx ly ez fb lz ma"><a href="https://www.techmanyu.com/creating-self-hosted-github-runners-in-a-kubernetes-cluster-fd05560de34a" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">在Kubernetes集群中创建自托管GitHub运行程序</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">在您自己的Kubernetes集群上运行GitHub操作</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">www.techmanyu.com</p></div></div><div class="mj l"><div class="no l ml mm mn mj mo jn ma"/></div></div></a></div><div class="lx ly ez fb lz ma"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/autoscaling-in-kubernetes-hpa-vpa-ab61a2177950"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">Kubernetes中的自动缩放(HPA / VPA)</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">使用垂直Pod自动缩放器(VPA)和水平Pod自动缩放器(HPA)在Kubernetes中自动缩放您的应用程序</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">medium.com</p></div></div><div class="mj l"><div class="np l ml mm mn mj mo jn ma"/></div></div></a></div><div class="lx ly ez fb lz ma"><a href="https://faun.pub/introduction-to-bitnami-sealed-secrets-bb5ae74d9a25" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">比特纳米密封秘密介绍</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">如何使用Sealed Secrets和Kubese在GitHub中存储您的秘密</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">faun.pub</p></div></div><div class="mj l"><div class="nq l ml mm mn mj mo jn ma"/></div></div></a></div><div class="lx ly ez fb lz ma"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/introduction-to-crossplane-2f873ae0f9f3"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hj fi z dy mf ea eb mg ed ef hh bi translated">交叉平面简介</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">如何使用Kubernetes清单和Crossplane在云上创建任何资源。</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">medium.com</p></div></div><div class="mj l"><div class="nr l ml mm mn mj mo jn ma"/></div></div></a></div></div></div>    
</body>
</html>