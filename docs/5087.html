<html>
<head>
<title>Do MMA fighters with longer arms win more fights? An end-to-end analysis in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">手臂越长的MMA拳手是否会赢得更多的打斗？Python中的端到端分析</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/do-mma-fighters-with-longer-arms-win-more-fights-an-end-to-end-analysis-in-python-a688ed52179?source=collection_archive---------4-----------------------#2021-08-27">https://medium.com/nerd-for-tech/do-mma-fighters-with-longer-arms-win-more-fights-an-end-to-end-analysis-in-python-a688ed52179?source=collection_archive---------4-----------------------#2021-08-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1691" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今年早些时候，我发表了一个由3部分组成的博客系列，讲述如何在R语言中收集、清理和分析MMA格斗家的数据。从那以后，我离开了学术界(R语言很常见)，进入了数据科学领域，在那里Python语言更为常见。因此，我开始每天使用Python。所以我想为喜欢MMA数据但想学Python而不是r的人提供一个翻译。</p><p id="9ffa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经完成了MMA in R三部曲的第2部分和第3部分，并在下面为您将代码翻译成python。我打算以后翻译网页抓取教程。下面的代码将允许你从我的Github下载原始数据，并带你通过清理和分析它。你不需要看R版就能明白这一点；它应该是独立的。</p><h1 id="3487" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">手臂越长的MMA拳手是否会赢得更多的打斗？</h1><p id="8394" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">清理数据是数据科学家日常工作的很大一部分，所以最好练习并寻找有效的方法。如果你能想到任何改进我的代码的方法，我很乐意听听！</p><h2 id="dde4" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">我们开始吧</h2><p id="91da" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">使用下面的代码从我的Github读入您的数据。我们将数据复制到新的数据帧<em class="ku"> data_clean </em> <strong class="ih hj">。</strong>我们这样做是为了当我们在清理过程中搞砸了一些事情(比如不小心删除了一列)时，我们总是有原始数据可以参考。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="115a" class="kg je hi la b fi le lf l lg lh">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="d40c" class="kg je hi la b fi li lf l lg lh">data_raw = pd.read_csv(‘https://github.com/Thomas-Richardson/Blog_post_data/blob/main/UFC_data_raw_2021-03-11.csv?raw=true')</span><span id="42bd" class="kg je hi la b fi li lf l lg lh">data_clean = data_raw</span></pre><p id="c0d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">库:我们需要pandas来处理数据，需要numpy来处理丢失的数据，需要matplotlib和seaborn来生成好看的图形。</p><h2 id="85bc" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">看数据</h2><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f197" class="kg je hi la b fi le lf l lg lh">data_clean.head(20)<br/>data_clean.info()</span></pre><p id="e7ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。head() </strong>显示了前20行(如果没有提供数字，则给出5行)。</p><p id="36ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。info() </strong>告诉我我的数据有3598行和12列。每排是一架战斗机，所以我们有3598架战斗机。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/58cc23a8dcc02514aec1d7fb1fadf6f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IKOEMD7g-m8e_DjyNSs9A.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">data_clean.head(20)</figcaption></figure><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es lv"><img src="../Images/093f2eb3d5527d1603a9016a7c8c0577.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*9rrVdIdARHtLjbPq-4fcrw.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">data_clean.info()</figcaption></figure><p id="49a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以进行一些观察，并勾画出一个粗略的数据清理计划:</p><ul class=""><li id="b4c9" class="lw lx hi ih b ii ij im in iq ly iu lz iy ma jc mb mc md me bi translated">第一列称为“未命名:0 ”,似乎只包含行号。我们可能会摆脱它。<em class="ku">带</em>栏里好像也没什么东西。</li><li id="47a1" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><em class="ku"> Ht </em>。以及<em class="ku"> Wt </em>。显然是身高和体重。它们已经作为“对象”被读入，这不是我们想要的。身高和体重都是数字，所以应该编码为‘int’。因为Wt。列显示“170磅”而不仅仅是“170”，Python认为它们是字符串。</li><li id="1b20" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated">更惨:<em class="ku"> Ht </em>。似乎以英尺和英寸为单位，两者都在<strong class="ih hj">相同的</strong>栏中编码。我们将把这两者都转换成仅用英寸表示的高度。</li><li id="77c9" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated"><em class="ku"> Reach </em>(臂展的格斗俚语说法)也是一个角色，对一些格斗家来说是缺失的。我们记下检查我们有多少，因为这是我们项目中的一个关键变量。</li><li id="23d2" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated">对于<em class="ku"> reach，ht </em>和<em class="ku"> wt，</em>。info说它们没有“非空值”,这表明我们有完整的数据。然而，看看标题中的这些列，我们肯定有缺失的数据！这里的问题是这些列的缺失数据被编码为“-”，Python认为这是文本数据的有效选择。我们需要将这些值改为空值。</li><li id="b343" class="lw lx hi ih b ii mf im mg iq mh iu mi iy mj jc mb mc md me bi translated">对于一个拳手的<em class="ku">姿态</em>，。<strong class="ih hj"> head() </strong>显示‘正统’、‘左撇子’、‘开关’，虽然可能还有其他。</li></ul><h1 id="62b9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">开始清洗</h1><p id="58fa" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">首先可以去掉第一列<em class="ku"> X </em>和<em class="ku">带</em>列。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="78de" class="kg je hi la b fi le lf l lg lh">data_clean = data_clean.drop(['Unnamed: 0', 'Belt'], axis = 1)</span></pre><p id="1332" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们<em class="ku">删除</em>不想要的列。Axis = 1表示我们删除的是列而不是行(对于删除行，我们使用axis = 0)</p><p id="fb18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们重命名这些列，使其更容易操作，并提供更多信息。您应该始终考虑您得到的列名对您和任何可能阅读您的代码的人是否有意义。我已经盯着这些数据看了几个小时了，所以我知道体重是以磅为单位的，但一位同事可能不知道，所以为了他们的缘故，我把体重也以磅为单位。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="6612" class="kg je hi la b fi le lf l lg lh">data_clean.columns = [‘first_name’, ‘last_name’, ‘nickname’, ‘height’, ‘weight_lbs’, ‘armspan_inches’, ‘stance’, ‘wins’, ‘losses’, ‘draws’]</span></pre><h2 id="ade1" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">清洁臂展</h2><p id="da36" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">先说臂展。我们首先将'-'转换成NaNs，它代表“不是一个数”。将数据编码为NaNs意味着Python会将其识别为缺失数据，从而更容易将列转换为数字。然后我们必须删除“臂展之后的”表示英寸。我们这样做的方法是使用<strong class="ih hj"> .str.replace() </strong>将其替换为空。我们将数据转换为浮点类型。在这个上下文中，Float type基本上表示数字。</p><p id="fc75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们制作一个直方图，它会给我们一个分布、平均值、分布以及是否有任何奇怪值的感觉。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f8a8" class="kg je hi la b fi le lf l lg lh">data_clean.loc[data_clean.armspan_inches =='--','armspan_inches'] = np.nan</span><span id="c07d" class="kg je hi la b fi li lf l lg lh">data_clean.armspan_inches = data_clean.armspan_inches \<br/>.str.replace('\"','') \<br/>.astype('float')</span><span id="02fb" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean,<br/>x = 'armspan_inches',<br/>color = 'navy')</span><span id="d5b4" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter armpan in inches')<br/>plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mk"><img src="../Images/83c99083c92f067aa50a85ca149d5f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*bxRjWO8iU_4cJsoL12Q82A.png"/></div></figure><p id="5922" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们有一个很好的正态分布，似乎没有异常值。这是理想；当数据像这样分布时，一切都变得容易了！</p><h2 id="b779" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">清洁高度</h2><p id="9807" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下一个高度，这有点困难，因为它需要将包含英尺和英寸的单个字符变量转换为只包含英寸的单个列。我们可以把它分解成一栏代表英尺，一栏代表英寸，然后再把它们组合起来。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="4bae" class="kg je hi la b fi le lf l lg lh">data_clean.height = data_clean.height.str.replace('\"','')</span><span id="c6f9" class="kg je hi la b fi li lf l lg lh">data_clean.loc[data_clean.height == '--','height'] = np.nan</span><span id="d687" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_split'] = data_clean.height.str.split('\' ')</span><span id="37ef" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_split']</span></pre><p id="669a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像臂展一样，我们去掉了“并把“-”变成了“NaNs”。然后我们使用<strong class="ih hj"> .str.split() </strong>将英尺和英寸拆分成2个独立的数据位，并将其放入一个名为“height_split”的新列中。让我们来看看那一栏:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es ml"><img src="../Images/d3686be9108ebee478b3c8fdcd6b1974.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*WwU9i1MQ9P0ga3ssBQEEzw.png"/></div></figure><p id="8c16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在每一行包含两个项目的列表:英尺和英寸。我们需要把这些分成两个独立的栏目，我们用列表理解来完成。如果你不知道什么是列表排版，一定要去了解一下，它们是非常宝贵的。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d1cc" class="kg je hi la b fi le lf l lg lh">data_clean.loc[:,'height_ft'] = [row[0] if isinstance(row,list) else np.nan for row in data_clean.height_split]</span><span id="ce10" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_inches'] = [row[1] if isinstance(row,list) else np.nan for row in data_clean.height_split]</span></pre><p id="e6d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们有了一个高度_英尺和高度_英寸的列。我们现在将height列设置为等于inches列+height列乘以12(因为一英尺中有12英寸)。当我们进行时，我们把它们转换成浮点数。然后，我们放弃旧的英寸，英尺和分裂列，因为他们已经达到了目的。我们还将最终身高列重命名为height_inches，以符合我们的其他变量(例如weight_lbs，armspan_inches)。然后我们制作一个直方图来检查我们做了什么:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="ff77" class="kg je hi la b fi le lf l lg lh">data_clean.loc[:,'height'] = data_clean.loc[:,'height_inches'].astype('float')+ (data_clean.loc[:,'height_ft'].astype('float')*12)</span><span id="83be" class="kg je hi la b fi li lf l lg lh">data_clean = data_clean.drop(columns = ['height_inches','height_ft','height_split']).rename(columns = {'height':'height_inches'})</span><span id="0eeb" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean, x = 'height_inches', color = 'navy',bins = 15)</span><span id="9104" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter height in inches')<br/>plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mm"><img src="../Images/e21ebfad380f06f255274a223b4f9453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*JKny6jkMfbAGklqjivjYIw.png"/></div></figure><p id="8be3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">再一次，我们有一个很好的正态分布。</p><h2 id="cd94" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">清洗重量:</h2><p id="ce92" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">在这之后，清洗重量是在公园散步！</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="12f6" class="kg je hi la b fi le lf l lg lh">data_clean.loc[data_clean.weight_lbs =='--','weight_lbs'] = np.nan</span><span id="56d0" class="kg je hi la b fi li lf l lg lh">data_clean.weight_lbs= data_clean.weight_lbs.str.replace(' lbs','').astype('float')</span><span id="79d8" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean, x = 'weight_lbs', color = 'navy', bins = 30)</span><span id="cc46" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter weight in lbs')<br/>plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mk"><img src="../Images/fe19c79066fc7e229778c71b1029fb3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*gQ3wpANJq6D5WNdP7_C7_g.png"/></div></figure><p id="d755" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯……这里发生了什么事？似乎只有极少数战斗机的重量接近800磅。我们来调查一下！</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="3c10" class="kg je hi la b fi le lf l lg lh">data_clean.weight_lbs.sort_values(ascending = False)</span></pre><p id="53c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先打印出重量排序最重的战斗机。从这里我们可以看到有一架战斗机重达770磅？！让我们通过过滤所有体重等于770的战士来将他们从数据集中取出:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="c2dd" class="kg je hi la b fi le lf l lg lh">data_clean.loc[data_clean.weight_lbs==770,:]</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mn"><img src="../Images/7f0fbadcd6bf6ee69cf2710fd32446a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MGMGS0O2Kp8niBxqZM51w.png"/></div></div></figure><p id="0643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到的名字是“伊曼纽尔·亚伯勒”。我谷歌了他，然后:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mo"><img src="../Images/f4b1d0d438cc435eaeda0cb9577631fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/0*lt8sY8GPG0WzTb2D"/></div></figure><p id="29e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">显然这里没有错误。他是存在的，而且确实是770lb！或者曾经是，因为他死于51岁，而他的3场MMA比赛是在一段时间以前。让我们在没有他的情况下制作直方图，看看是否还有其他情况:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="c937" class="kg je hi la b fi le lf l lg lh">without_emmanuel = data_clean.loc[data_clean.weight_lbs &lt;770,:]</span><span id="536b" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = without_emmanuel, x = 'weight_lbs', color = 'navy', binwidth=12)<br/>plt.xlabel('fighter weight in lbs')<br/>plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mp"><img src="../Images/c86cf61e581139c2eb0f6d02e122c876.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*UhhkL2QpZIrACbknEGSLOg.png"/></div></figure><p id="beff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个剧情有一些奇怪的空白，大概是因为拳手在限制重量级比赛。因此，拳手会试图达到重量级极限的顶端，这意味着在重量级极限之间的拳手会很少。数据也是高度正偏的，有很长的右尾巴，但这也是有道理的，因为一旦你到了重量级，你或多或少可以像你喜欢的那样重，一些家伙选择战斗<em class="ku">重。</em></p><h2 id="7f8f" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">立场</h2><p id="a897" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">这与我们对手臂长度的分析并不相关，但是站姿很有趣(<a class="ae mq" href="https://www.nature.com/articles/s41598-019-51975-3" rel="noopener ugc nofollow" target="_blank">我也发表了一篇关于这个的论文</a>)。所以让我们也清理立场。把分析这些数据当作你的家庭作业，告诉我你发现了什么！首先，让我们做一个表格:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="2a63" class="kg je hi la b fi le lf l lg lh">data_clean = data_clean.fillna('Missing')<br/>data_clean.value_counts('stance')</span></pre><p id="9ce0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们用“失踪”这个词来填Na。该表显示，我们有7个“开放姿态”的人，3个“侧身姿态”的人和126个“转换姿态”的战士。我们有804架战斗机的姿态不见了。</p><p id="77b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以使用seaborn中的<strong class="ih hj"> countplot() </strong>函数制作一个柱状图:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9130" class="kg je hi la b fi le lf l lg lh">sns.countplot(y = 'stance', data = data_clean, order = ['Orthodox', 'Southpaw','Switch','Open Stance','Sideways','Missing'])<br/>plt.show()</span></pre><p id="c5cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意我们如何指定条形的顺序。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mr"><img src="../Images/69e11dc1a4ccffb88c26c0395841a36f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yj4A9jh0gliJg-0EoRIByQ.png"/></div></div></figure><h1 id="e32e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">特征工程</h1><p id="32f7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">现在我们已经清理了很多数据，我们可以从现有的变量中产生一些新的有用的变量。或者如数据科学家所说:“特征工程”。让我们从计算每一个战士的总战斗次数开始:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b19f" class="kg je hi la b fi le lf l lg lh">data_clean.loc[:,'total_fights'] = data_clean.loc[:,['wins','draws','losses']].sum(axis = 1)</span></pre><p id="73dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们选择赢、输和平的列，然后使用。<strong class="ih hj"> sum() </strong>将它们相加，再次将axis设置为1，对列而不是行执行求和。</p><p id="78a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于很少有拳手有像“开”和“侧身”这样的小众姿态，我们也将制作一个新的<em class="ku">姿态2 </em>变量，我们将“开”、“侧身”和“转换”姿态的拳手归为一类“混合”姿态。我们创建一个新值映射到旧值的字典，并将该字典提供给<strong class="ih hj">。替换()</strong>。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e3c7" class="kg je hi la b fi le lf l lg lh">mapping = {'Open Stance':'Mixed','Sideways':'Mixed','Switch':'Mixed'}</span><span id="2ae0" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'stance2'] = data_clean.loc[:,'stance'].replace(mapping)</span><span id="4663" class="kg je hi la b fi li lf l lg lh">sns.countplot(y = 'stance2', data=data_clean, order = ['Orthodox','Southpaw','Mixed','Missing'])</span><span id="ce13" class="kg je hi la b fi li lf l lg lh">plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ms"><img src="../Images/d8c6e756a58e2580c6e64130314afa28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NrbrHo0QWel6WzUMptTDKw.png"/></div></div></figure><p id="5d71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，让我们保存清理后的数据:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="8da8" class="kg je hi la b fi le lf l lg lh">write.csv(data_clean, ’UFC_data_cleaned.csv’)</span></pre><p id="7cbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上半场到此结束！我们已经清理了用于分析的杂乱数据。</p><h1 id="0250" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">分析干净的数据</h1><p id="6e4d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">最后，我们准备开始分析。</p><p id="cf23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我建议重新加载Python并读入您刚刚保存的数据。或者用我的。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9035" class="kg je hi la b fi le lf l lg lh">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import statsmodels.api as sm</span><span id="2f2b" class="kg je hi la b fi li lf l lg lh">data = pd.read_csv('https://raw.githubusercontent.com/Thomas-Richardson/Blog_post_data/main/UFC_data_cleaned.csv')</span></pre><p id="7475" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们像以前一样在同一个图书馆里阅读，因为它们在分析数据和清理方面很有用。此外，我们加载<strong class="ih hj"> statsmodels </strong>，稍后我们将使用它来拟合我们的回归模型。</p><p id="f2e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意！大多数数据科学家使用<a class="ae mq" href="https://scikit-learn.org/stable/index.html" rel="noopener ugc nofollow" target="_blank"> Scikit-Learn </a>来拟合回归等模型。然而，sklearn的设计旨在使其易于适应<em class="ku">预测模型</em>，而我们今天所做的更多的是关于<em class="ku">解释模型</em>。这个区别我们以后再说，但是请相信我，用statsmodels做我们需要做的事情要比sklearn容易得多。</p><p id="142e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像之前一样，我们放弃了在保存数据帧时引入的随机行号列:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="4a83" class="kg je hi la b fi le lf l lg lh">data.head(20)<br/>data.info()</span><span id="5a27" class="kg je hi la b fi li lf l lg lh">data = data.drop(axis = 1, columns = ['Unnamed: 0'])</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mt"><img src="../Images/4cbe0e23899db28ebda383b83971d188.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*qNxXVWYxTisp8sl7eg9Pew.png"/></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">data.info()</figcaption></figure><p id="3fc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。info() </strong>告诉我我们有12个变量和3598个战士，还有。<strong class="ih hj"> head(20) </strong>让我们快速看一下数据的样子:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mn"><img src="../Images/c1d96bca2967b6793c6a7fbb30425113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRZ7ERzyyUnNRWgPeN6GrA.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx translated">data.head(20)</figcaption></figure><h2 id="ca0f" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">探索性分析:直方图</h2><p id="1e8b" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我建议每个数据科学家在第一次接触数据时做的第一件事就是<strong class="ih hj">制作直方图。他们会告诉你很多关于你的变量。正如我们前面看到的，他们可以捕捉异常值(如770磅艾曼纽)，但他们也可以向我们展示我们的数据分布，这是均值，均值是否有用，方差…许多事情！</strong></p><p id="966f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，python使得用<strong class="ih hj">绘制数据帧中每个数值变量的直方图变得很简单。历史()。</strong></p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="78f3" class="kg je hi la b fi le lf l lg lh">data.hist(grid = False, bins = 15)<br/>plt.show()</span></pre><p id="3261" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们设置网格为假，因为网格看起来有点垃圾。根据您的数据，您可能需要调整条柱的数量，以获得能告诉您一些信息的直方图。它们不应该太块状，也不应该有很多空隙。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mu"><img src="../Images/8fd851ca682f3b84f006906a0ebe840a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Y8sc6eg1q1Oy6eyxvK8jw.png"/></div></div></figure><p id="eb92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以看起来非常大的值给了我们非常倾斜的直方图！少数拳手有很高的胜率，输球率，结果是总胜率。让我们看看这些:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="68f3" class="kg je hi la b fi le lf l lg lh">data.loc[data.total_fights &gt; 100,:]</span></pre><p id="2dcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们过滤所有拥有100场或以上战斗的战士。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mv"><img src="../Images/eb39d433bc1a077ac797eadac05383a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5JZ9Mqi2nTW3zsyBC6L3KA.png"/></div></div></figure><p id="815c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有些拳手的战斗次数非常多！</p><h2 id="29aa" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">探索性分析:相关性分析</h2><p id="dd3e" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">让我们探索我们的变量如何与相关矩阵相关，相关矩阵计算每对变量之间的相关性。为了更容易看到发生了什么，我们使用这个矩阵来制作一个<strong class="ih hj"> heatplot(): </strong></p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e13c" class="kg je hi la b fi le lf l lg lh">correlation_matrix = data.loc[:,['height_inches', 'weight_lb', 'armspan_inches', 'losses', 'wins','total_fights']].corr(method = 'spearman').round(2)</span><span id="ec62" class="kg je hi la b fi li lf l lg lh">mask = np.zeros_like(correlation_matrix)<br/>mask[np.triu_indices_from(mask)] = True</span><span id="9782" class="kg je hi la b fi li lf l lg lh">sns.heatmap(correlation_matrix, annot=True,vmin = -1, vmax=1,mask=mask, square=True, cmap="BuPu")</span><span id="65de" class="kg je hi la b fi li lf l lg lh">plt.xticks(rotation = 60)<br/>plt.yticks(rotation = 0)<br/>plt.show()</span></pre><p id="512b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了制作我们的相关矩阵，我们使用<strong class="ih hj">。loc[] </strong>来获取我们感兴趣的列，然后<strong class="ih hj">。corr() </strong>计算相关矩阵和<strong class="ih hj">。round(2) </strong>给出小数点后两位的相关性，因为我们不需要比这里更高的精度。</p><p id="c38c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们创建了一个零掩码，我们可以用它来消除相关矩阵的上半部分，因为它只是底部的重复。</p><p id="cb95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们将关联矩阵传递给seaborn热图。不能意味着把我们的相关性放在方块上。vmin 和vmax允许我们指定颜色的最大值和最小值，而不是让python从数据本身中计算出来。这是因为我们知道相关性只能在-1和1之间。我选择了<em class="ku">“布普”</em>调色板。这有点过分，但确实管用，而且默认是<em class="ku">丑。</em></p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mw"><img src="../Images/2ebeaed81b35e2326f06f4fb551f32b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Am5PAFITQFa6HkoHF8boA.png"/></div></div></figure><p id="437b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">两件事引起了我的注意:</p><p id="6ea3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，身高、体重和臂展(左上角的方块)都是高度相关的。这是有道理的:高个子通常更重，手臂也更长。这些都是某种“大”的量度。这意味着，如果我们想知道臂展是否影响获胜的数量，我们不能只看相关性，因为臂展与身高和体重是相互混淆的。我们需要建立模型来观察臂展的影响，同时消除身高和体重的影响，我们在下面用多元回归来做。</p><p id="9493" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二，赢的次数和输的次数在r = 0.63时高度相关。这是因为打架次数多的拳手，日积月累，输赢都会累积。这可能会给我们的分析带来一个问题:战士们可能会因为打了很多场比赛而获得很多胜利。我们想看看胜利的数量，同时考虑战斗的数量。</p><h2 id="304a" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">特征工程:创建win_percentage作为战斗能力的度量</h2><p id="86f7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">看来我们得进行另一轮功能工程了。这是典型的数据科学:你了解数据，构建一些功能，进一步了解数据，并提出新的功能。你迭代。</p><p id="8c9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个很好的衡量战斗能力的方法是计算一个战士赢得战斗的百分比。我们定义了一个叫做<em class="ku"> win_percentage </em>的新变量，它是赢的次数+平局次数的一半，除以总的比赛次数。这样平局也算半个赢。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="932e" class="kg je hi la b fi le lf l lg lh">data.loc[:,'win_percentage'] = (data.loc[:,'wins']+ (0.5*data.loc[:,'draws']) )/data.loc[:,'total_fights']</span><span id="056e" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data, x = 'win_percentage', color = 'navy', bins = 20)<br/>plt.show()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es mx"><img src="../Images/03998c24b1b55f361c591b75999a7bab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*k50b4lIORWgzU4IHro_Iaw.png"/></div></figure><p id="f009" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来获胜的百分比大部分是正态分布的，但有0(即输掉所有战斗的战士)和1(赢得所有战斗的战士)的起伏。</p><h2 id="309b" class="kg je hi bd jf kh ki kj jj kk kl km jn iq kn ko jr iu kp kq jv iy kr ks jz kt bi translated">臂展、身高和体重</h2><p id="50a9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">从上面的相关性中我们可以看出，臂展、身高和体重都是相互关联的。我们可能想知道的一件事是，身高和体重是否分别与臂展相关。可能身高和臂展有联系，身高和体重有联系，但是臂展和体重没有联系。我不清楚为什么考虑到身高，更重也意味着更长的手臂。换句话说，如果我们有一群身高完全相同的人，我们会期望较重的人有更长的手臂吗？我不会这么说。也许体重和臂展之间的相关性是<em class="ku">虚假的</em>，仅仅是因为它们与身高的共同关系。为了区分这些，我们进行了多重回归测试，看身高和体重是否能预测臂展。</p><p id="e3ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们创建一个名为<em class="ku"> data_model </em>的新数据框架，它只包含我们需要的列，并删除所有NaN值，因为多元回归不能处理缺失值。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="87d1" class="kg je hi la b fi le lf l lg lh">data_model = data.loc[:, [‘armspan_inches’, ’height_inches’, ’weight_lb’]].dropna()</span></pre><p id="6e08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们拟合普通最小二乘(OLS)模型，指定我们的X变量和y变量，并添加一个截距。add_constant()。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="e165" class="kg je hi la b fi le lf l lg lh">X = data_model.loc[:,['height_inches','weight_lb']]<br/>X = sm.add_constant(X)</span><span id="9cc5" class="kg je hi la b fi li lf l lg lh">y = data_model.loc[:,'armspan_inches']</span><span id="3760" class="kg je hi la b fi li lf l lg lh">sm.OLS(y, X).fit().summary()</span></pre><p id="40ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们得到这个(我用黄色突出了重要的部分):</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es my"><img src="../Images/8bca5f5f52af4ded054fb629e9204a07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ERbRm9wOheSlFI-smtenDA.png"/></div></div></figure><p id="e26b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当四舍五入到3个小数位时，p值为0(但是请注意，在这种类型的分析中，它们不可能恰好为0)。在科学上，我们通常会说，如果一个p值是&lt;0.05 then the effect is <strong class="ih hj">统计显著的</strong>。这表明身高和体重都与臂展有独特的关系。这意味着，如果我们让所有人都一样高，较重的人可能会有更长的手臂，如果我们让一群体重相同的人，较高的人会有更长的手臂。我错了！没关系，在数据科学中，你经常是错的。犯错最大的好处是你可以学到新东西！</p><p id="b8e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如系数(coef栏)所示:身高增加1英寸，臂展增加0.92英寸。体重每增加1磅，臂展就会增加0.017英寸。调整后的R平方告诉我们，身高和体重一起解释了臂展变化的80%,这是一个很大的数字！如果我们知道某人的身高和体重，我们就能相当准确地说出他们的臂展。如果我们想知道身高和体重对臂展的预测有多准确，我们可以使用scikit-learn建立一个预测模型。但这不是我们今天要做的。</p><p id="1830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个分析也告诉我们，要确定臂展真的与战斗能力有关，我们需要控制身高和体重。否则，我们可能会得出结论，臂展与战斗能力有关，而实际上是身高和/或体重造成了这种影响。</p><h1 id="27fa" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">手臂较长的拳手会赢得更多比赛吗？</h1><p id="1a42" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们准备解决我们的主要问题。我们拟合多元回归，其中响应变量(或因变量，它们的意思基本相同)是<em class="ku"> win_percentage </em>，我们的预测因子(或自变量)是<em class="ku">臂展、身高</em>和<em class="ku">体重。</em></p><p id="79b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们必须控制体重的另一个原因是因为拳手在重量级比赛。如果康纳·麦格雷戈有81%的胜率，那只能告诉我们，与同等重量的拳手相比，他是个好拳手。目前还不知道(也不太可能)他是否有能力对抗重量级选手。因此，将战斗机与和他们体重相近的其他战斗机进行比较才有意义。控制体重使得臂展的效果代表了更长手臂的效果<em class="ku">假设所有的拳手体重相等</em>(嗯，有点复杂)。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="d6b8" class="kg je hi la b fi le lf l lg lh">data_model2 = data.loc[:,['armspan_inches','height_inches','weight_lb', 'win_percentage']].dropna()</span><span id="6594" class="kg je hi la b fi li lf l lg lh">X = data_model2.loc[:,['height_inches','weight_lb','armspan_inches']]<br/>X = sm.add_constant(X)</span><span id="b417" class="kg je hi la b fi li lf l lg lh">y = data_model2.loc[:,'win_percentage']</span><span id="6ad5" class="kg je hi la b fi li lf l lg lh">sm.OLS(y,X).fit().summary()</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es mz"><img src="../Images/c06cf00e4723f56791dded9892ec8157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1zmIncVo3b_m8bVOT-h2KA.png"/></div></div></figure><p id="062a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你应该得到这样的东西。我们查看p值部分，发现只有臂展的影响是&lt; 0.05. Height and weight are not. This suggests that only armspan has a statistically significant effect on win percentage: height and weight do not have independent effects on the percentage of fights a fighter wins. You can also see this in that the confidence intervals for the effect of armspan do not contain 0, whereas the confidence intervals for the other effects do contain 0.</p><p id="9ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">However, looking at the coefficient, it seems that the effect of armspan is small. Indeed, looking at the adjusted R² suggests that all 3 factors, height weight and armspan explain very little of the variance in % of fights won. Increasing armspan by 1 inch increases the percentage of fights won by 0.005 or 0.5%. Still, that might be big if fighters vary by 10 or 20 inches in their armspan. To get a feel for the real-world size of the effect, let’s take all the fighters with a weight of 155lb and find the longest and shortest armspan.</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="854d" class="kg je hi la b fi le lf l lg lh">data.loc[data.weight_lb == 155,'armspan_inches'].agg(['min','max'])</span></pre><p id="d8db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">。agg() </strong>允许我们对一个数据集应用多个函数，在本例中是<strong class="ih hj"> max </strong>和<strong class="ih hj"> min </strong>。</p><p id="7012" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们发现155磅的人最长的臂展是80英寸，最短的是64英寸，差别相当大。我们预计长臂战斗机的胜率为16 x 0.005 = 0.08或高8%！因此，虽然对于大多数拳击手来说，臂展对他们职业生涯的影响很小，但那些臂展很高或很低的人可能会看到对他们成功的长期影响。</p><h1 id="f4dc" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="e6b9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">所以看起来手臂更长的拳手确实赢得了更多的比赛！这不仅仅是因为它们更大。事实上，看起来高个子战士赢得更多战斗的唯一原因是因为他们的手臂更长:当臂展也在模型中时，身高对胜率没有独特的影响。</p><p id="eb6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你跟了我这么久！我希望你已经从中学到了一些东西，无论是数据清理、数据分析还是制作图表。如果你对这些数据做了其他分析，请告诉我！我很想看看你在做什么。谢谢！</p><h1 id="2096" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">完整的代码</h1><p id="a79d" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">为了避免您将所有代码复制并粘贴到一个文档中的麻烦，我收集了以下所有代码:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b549" class="kg je hi la b fi le lf l lg lh">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns</span><span id="c1a0" class="kg je hi la b fi li lf l lg lh">data_raw = pd.read_csv('https://github.com/Thomas-Richardson/Blog_post_data/blob/main/UFC_data_raw_2021-03-11.csv?raw=true')</span><span id="77cb" class="kg je hi la b fi li lf l lg lh">data_clean = data_raw</span><span id="3328" class="kg je hi la b fi li lf l lg lh">data_clean.head(20)<br/>data_clean.info()</span><span id="5464" class="kg je hi la b fi li lf l lg lh"># onto cleaning</span><span id="568d" class="kg je hi la b fi li lf l lg lh">data_clean = data_clean.drop(['Unnamed: 0', 'Belt'], axis = 1)</span><span id="e84e" class="kg je hi la b fi li lf l lg lh">data_clean.columns = ['first_name', 'last_name', 'nickname', 'height', 'weight_lbs', 'armspan_inches', 'stance', 'wins', 'losses', 'draws']</span><span id="ea61" class="kg je hi la b fi li lf l lg lh"># cleaning armspan</span><span id="8a33" class="kg je hi la b fi li lf l lg lh">data_clean.loc[data_clean.armspan_inches =='--','armspan_inches'] = np.nan</span><span id="ecbb" class="kg je hi la b fi li lf l lg lh">data_clean.armspan_inches = data_clean.armspan_inches \<br/>.str.replace('\"','') \<br/>.astype('float')</span><span id="8a43" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean, x = 'armspan_inches', color = 'navy')</span><span id="9cc6" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter armpan in inches')<br/>plt.show()</span><span id="45f6" class="kg je hi la b fi li lf l lg lh"># cleaning height</span><span id="317d" class="kg je hi la b fi li lf l lg lh">data_clean.height = data_clean.height.str.replace('\"','')</span><span id="2f5a" class="kg je hi la b fi li lf l lg lh">data_clean.loc[data_clean.height=='--','height'] = np.nan</span><span id="8cb9" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_split'] = data_clean.height.str.split('\' ')</span><span id="a8d9" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_split']</span><span id="6fdb" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_ft'] = [row[0] if isinstance(row,list) else np.nan for row in data_clean.height_split]</span><span id="2489" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height_inches'] = [row[1] if isinstance(row,list) else np.nan for row in data_clean.height_split]</span><span id="4d02" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'height'] = data_clean.loc[:,'height_inches'].astype('float')+ (data_clean.loc[:,'height_ft'].astype('float')*12)</span><span id="a67a" class="kg je hi la b fi li lf l lg lh">data_clean = data_clean.drop(columns = ['height_inches','height_ft','height_split']).rename(columns = {'height':'height_inches'})</span><span id="a8dd" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean, x = 'height_inches', color = 'navy',bins = 15)</span><span id="6bd1" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter height in inches')<br/>plt.show()</span><span id="929a" class="kg je hi la b fi li lf l lg lh"># cleaning weight</span><span id="4f61" class="kg je hi la b fi li lf l lg lh">data_clean.loc[data_clean.weight_lbs =='--','weight_lbs'] = np.nan</span><span id="c065" class="kg je hi la b fi li lf l lg lh">data_clean.weight_lbs= data_clean.weight_lbs.str.replace(' lbs','').astype('float')</span><span id="bc00" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data_clean, x = 'weight_lbs', color = 'navy', bins = 30)</span><span id="d824" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter weight in lbs')<br/>plt.show()</span><span id="2f31" class="kg je hi la b fi li lf l lg lh">data_clean.weight_lbs.sort_values(ascending = False)</span><span id="97b1" class="kg je hi la b fi li lf l lg lh">data_clean.loc[data_clean.weight_lbs==770,:]</span><span id="60d9" class="kg je hi la b fi li lf l lg lh">without_emmanuel = data_clean.loc[data_clean.weight_lbs &lt;770,:]</span><span id="a119" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = without_emmanuel, x = 'weight_lbs', color = 'navy', binwidth=12)</span><span id="4427" class="kg je hi la b fi li lf l lg lh">plt.xlabel('fighter weight in lbs')<br/>plt.show()</span><span id="7c30" class="kg je hi la b fi li lf l lg lh"># stance</span><span id="04ee" class="kg je hi la b fi li lf l lg lh">data_clean = data_clean.fillna('Missing')</span><span id="e4d0" class="kg je hi la b fi li lf l lg lh">data_clean.value_counts('stance')</span><span id="5363" class="kg je hi la b fi li lf l lg lh">sns.countplot(y = 'stance', data = data_clean, order = ['Orthodox', 'Southpaw','Switch','Open Stance','Sideways','Missing'])</span><span id="9f29" class="kg je hi la b fi li lf l lg lh">plt.show()</span><span id="0316" class="kg je hi la b fi li lf l lg lh"># feature engineering</span><span id="3bb0" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'total_fights'] = data_clean.loc[:,['wins','draws','losses']].sum(axis = 1)</span><span id="c4ae" class="kg je hi la b fi li lf l lg lh">mapping = {'Open Stance':'Mixed','Sideways':'Mixed','Switch':'Mixed'}</span><span id="4ffc" class="kg je hi la b fi li lf l lg lh">data_clean.loc[:,'stance2'] = data_clean.loc[:,'stance'].replace(mapping)</span><span id="a8b5" class="kg je hi la b fi li lf l lg lh">sns.countplot(y = 'stance2', data=data_clean, order = ['Orthodox','Southpaw','Mixed','Missing'])</span><span id="45ec" class="kg je hi la b fi li lf l lg lh">plt.show()</span><span id="c814" class="kg je hi la b fi li lf l lg lh">data_clean.to_csv("UFC_data_cleaned.csv") # save/write csv</span><span id="6785" class="kg je hi la b fi li lf l lg lh"># ============== Analysis =======================================</span><span id="a224" class="kg je hi la b fi li lf l lg lh">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import statsmodels.api as sm</span><span id="083d" class="kg je hi la b fi li lf l lg lh">data = pd.read_csv('https://raw.githubusercontent.com/Thomas-Richardson/Blog_post_data/main/UFC_data_cleaned.csv')</span><span id="965f" class="kg je hi la b fi li lf l lg lh">data = data.drop(axis = 1, columns = ['Unnamed: 0'])<br/>data.head(20)<br/>data.info()</span><span id="c32c" class="kg je hi la b fi li lf l lg lh">data.hist(grid = False, bins = 15)<br/>plt.show()</span><span id="627d" class="kg je hi la b fi li lf l lg lh">data.loc[data.total_fights &gt; 100,:]</span><span id="de72" class="kg je hi la b fi li lf l lg lh">correlation_matrix = data.loc[:,['height_inches', 'weight_lb', 'armspan_inches', 'losses', 'wins','total_fights']].corr(method = 'spearman').round(2)</span><span id="818e" class="kg je hi la b fi li lf l lg lh">mask = np.zeros_like(correlation_matrix)<br/>mask[np.triu_indices_from(mask)] = True</span><span id="cf64" class="kg je hi la b fi li lf l lg lh">sns.heatmap(correlation_matrix, annot=True,vmin = -1, vmax=1,mask=mask, square=True, cmap="BuPu")</span><span id="f456" class="kg je hi la b fi li lf l lg lh">plt.xticks(rotation = 60)<br/>plt.yticks(rotation = 0)<br/>plt.show()<br/></span><span id="53ba" class="kg je hi la b fi li lf l lg lh">data.loc[:,'win_percentage'] = (data.loc[:,'wins']+ (0.5*data.loc[:,'draws']) )/data.loc[:,'total_fights']</span><span id="dcf1" class="kg je hi la b fi li lf l lg lh">sns.histplot(data = data, x = 'win_percentage', color = 'navy', bins = 20)</span><span id="c392" class="kg je hi la b fi li lf l lg lh">plt.show()</span><span id="31bf" class="kg je hi la b fi li lf l lg lh">data_model = data.loc[:,['armspan_inches','height_inches','weight_lb']].dropna()</span><span id="7897" class="kg je hi la b fi li lf l lg lh"># regression 1: is armspan related to height and weight?</span><span id="588b" class="kg je hi la b fi li lf l lg lh">X = data_model.loc[:,['height_inches','weight_lb']]<br/>X = sm.add_constant(X)</span><span id="3bfe" class="kg je hi la b fi li lf l lg lh">y = data_model.loc[:,'armspan_inches']</span><span id="301c" class="kg je hi la b fi li lf l lg lh">sm.OLS(y,X).fit().summary()</span><span id="a852" class="kg je hi la b fi li lf l lg lh"><br/># regression 2: is armspan related to fighting success controlling for height and weight?</span><span id="2518" class="kg je hi la b fi li lf l lg lh">data_model2 = data.loc[:,['armspan_inches','height_inches','weight_lb', 'win_percentage']].dropna()</span><span id="f5d4" class="kg je hi la b fi li lf l lg lh">X = data_model2.loc[:,['height_inches','weight_lb','armspan_inches']]<br/>X = sm.add_constant(X)</span><span id="e79c" class="kg je hi la b fi li lf l lg lh">y = data_model2.loc[:,'win_percentage']</span><span id="ea19" class="kg je hi la b fi li lf l lg lh">sm.OLS(y,X).fit().summary()</span><span id="370c" class="kg je hi la b fi li lf l lg lh">data.loc[data.weight_lb == 155,'armspan_inches'].agg(['min','max'])</span></pre></div></div>    
</body>
</html>