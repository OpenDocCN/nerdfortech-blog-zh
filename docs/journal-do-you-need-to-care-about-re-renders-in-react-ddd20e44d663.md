# Journal:你需要关心 react 中的重新渲染吗？

> 原文：<https://medium.com/nerd-for-tech/journal-do-you-need-to-care-about-re-renders-in-react-ddd20e44d663?source=collection_archive---------8----------------------->

![](img/48748572b9b050cfd6ff24c198bac647.png)

弗朗西斯科·德·托马索在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上拍摄的照片

背景故事:早在 2013/12 年 React 发布时，它就因为虚拟 DOM 而广受欢迎。DOM 更新是耗时的和同步的，所以对 DOM 的多次更新是批处理的。所以 react 分渲染和提交两个阶段更新 DOM。
呈现阶段是为了理解发生了什么变化，比如 DOM 属性是否更新或者添加了新节点等等。所以 react 解析所有的 DOM 节点并构造一个 JSON 对象，这就是虚拟 DOM。我已经把和解的过程抽象成了一行，我将在接下来的几天里写更多的内容。我们现在就坚持做这个吧。
一旦构建了虚拟 DOM，react 会将当前的 VDOM 与之前的进行比较，并获得需要更新的所有属性的列表，将所有更新进行批处理并一次性提交。本文的目的不是解释渲染和提交阶段，所以背景故事要简短。

我从下面的博客
[https://epicreact.dev/css-variables/](https://epicreact.dev/css-variables/)
开始，这解释了为什么 React context 不需要在你的 DOM 树中更新主题。这确实是一个有趣的想法。
来自 React 上下文的更新触发了对所有使用上下文的组件的重新渲染，我觉得这是不必要的。虽然渲染阶段非常快，但没有必要渲染，然后再次要求 React 安排一个提交阶段来将所有更新推送到 DOM。
相反，作者解释了 CSS 变量技术来实现同样的功能。从性能角度来看，它做的工作要少得多。只有浏览器要求的布局+重画。在上下文方法中有(重新渲染+布局+重画)，但是问题是如何处理这些更新。当 react 需要做一些它安排的工作，这涉及到大量的 CPU，这对于普通计算机来说是好的，但是对于慢速手机来说可能是一种痛苦。

然后我不知何故偶然发现了[这个](https://kentcdodds.com/blog/fix-the-slow-render-before-you-fix-the-re-render) :
两个博客的相似之处是都在谈论廉价的渲染阶段，但后者指出缓慢的渲染比多次重新渲染要危险得多。我非常同意，作者还指出了一个错误，即“client height”API。我从来没有意识到这是同步的，每次被调用时都会重新计算。有时这可能会导致灾难性的错误。

来自 Paul Irish 的博客列出了所有患有这种疾病的原料药。所以，这并不是说这些 API 要从你的代码库中被抛弃，而是我们需要知道它是如何工作和明智地使用的。

**摘自本刊:** 1。重新渲染是便宜的，但是上下文 API 对于实现主题化来说是一个大杀器。
2。Nextjs 爱好者可能无法利用主题化。
3。重新渲染不是瓶颈的原因，但缓慢的渲染才是。
4。小心你使用的浏览器 API，你不想大量使用同步 API。在使用它之前要意识到它可能造成的危险。

那么你需要担心 React 中的重渲染吗？
真希望有个二进制的答案。它的上下文，如果你的应用程序很慢，通常不是因为重新渲染。这并不意味着重新渲染是好的，如果你看到特定的子树被重新渲染，一般建议重构。当你的应用变成一头野兽，你应该能够驯服它，而不是任由它摆布。

**重新呈现会造成伤害的一个场景:** 假设你有一个列表，它没有`key`属性，它会重新呈现和重新绘制。就像我说的，重新粉刷很便宜，但不需要重新粉刷。重画是繁重的，同步的(这就足够让人害怕了)。你的普通 JSX 不会有这个问题，它可以重画但是不会重画。注意，你的一些使用效果可能会运行。

React 的虚拟 DOM diff 已经有了很大的发展，并且适用于大多数情况，但是对于旧的/慢的手机。手机通常很忙，重新渲染可能会把它推下悬崖(在某些情况下，它也可以工作，但容易失败)。所以想想你的受众会在哪里和谁使用你的应用，自己决定吧。

快乐编码。