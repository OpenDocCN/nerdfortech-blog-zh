<html>
<head>
<title>Running Automotive Grade Linux on a Raspberry Pi 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Raspberry Pi 4 上运行汽车级 Linux</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/running-automotive-grade-linux-on-a-raspberry-pi-4-535490ddda82?source=collection_archive---------2-----------------------#2021-02-11">https://medium.com/nerd-for-tech/running-automotive-grade-linux-on-a-raspberry-pi-4-535490ddda82?source=collection_archive---------2-----------------------#2021-02-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/de77cad7006acd8ffc58da47637297b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bp9QKVW6Q8CJLbuKMckHeQ.png"/></div></div></figure><div class=""/><p id="4179" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章的目的是描述我如何设法为一个 Raspberry Pi4 目标构建汽车级 Linux 演示应用程序。为此，我将介绍 AGL，描述所发现的问题，以及我如何超越它们。</p><p id="9b78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">TL 博士:AGL 摇滚。安装 docker，运行一个容器，运行您的构建并获取最终的系统映像。如果您对如何操作有疑问，请向下滚动到<em class="jo">使用 Docker </em>为 RPi4 构建 AGL 部分。如果有时间，通读:)</p><h1 id="83f6" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于汽车级 Linux</h1><p id="acdf" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">不久前，我开始研究针对汽车行业的 Linux 应用程序和项目，因为了解这个行业的技术和趋势是成功的关键之一。</p><p id="080f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我很快就发现了汽车级 Linux，这是一个看起来很整洁的项目，它提供了一个 Linux 发行版，其中包含了汽车行业的所有商品。</p><p id="3a02" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">汽车级 Linux (AGL)是一个开源的合作项目，是 Linux 基金会的一部分，旨在成为事实上的行业标准。它的一些目标是:改进汽车用例的开源组件，在发布改进时遵循上游优先的策略，以及使用通用的参考平台进行测试和集成。</p><p id="972c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然 AGL 最初的重点是信息娱乐，但 AGL 也计划解决所有的车载软件:信息娱乐、仪表组、平视显示器(HUD)、远程信息处理/联网汽车、高级驾驶辅助系统(ADAS)、功能安全和自动驾驶。要了解更多关于如何与 AGL 互动的信息，请访问 https://www.automotivelinux.org/和该项目的维基 https://wiki.automotivelinux.org/<a class="ae ks" href="https://wiki.automotivelinux.org/" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="bb31" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">支持的设备范围有点广:</p><ul class=""><li id="50a8" class="kt ku ht is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">QEMU——本质上不是一个目标硬件，但是对于测试来说仍然非常有用；</li><li id="456c" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">Raspberry Pi —支持的硬件:RPi4(推荐)、RPi3、RPi2(在最新和最好的版本上已弃用)；</li><li id="0f61" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">瑞萨 R-Car-M3；</li><li id="baf9" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">英特尔 Up2</li><li id="da61" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">恩智浦 i . MX6</li><li id="9c94" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">高通骁龙 410；</li><li id="07cb" class="kt ku ht is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">可能有更多我不知道的兼容目标。</li></ul><p id="cd83" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要获得这种工具的神奇之处，有几个选项:</p><p id="63bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae ks" href="https://wiki.automotivelinux.org/agl-distro/source-code#download_master_branch" rel="noopener ugc nofollow" target="_blank">从 git 下载最新源代码</a> <br/> <a class="ae ks" href="https://wiki.automotivelinux.org/agl-distro/source-code#download_latest_stable_release" rel="noopener ugc nofollow" target="_blank">下载最新稳定版代码</a> <br/> <a class="ae ks" href="https://wiki.automotivelinux.org/agl-distro/release-notes#latest_stable_release" rel="noopener ugc nofollow" target="_blank">下载最新 AGL UCB 版</a> <br/> <a class="ae ks" href="https://wiki.automotivelinux.org/agl-distro?&amp;#supported_hardware" rel="noopener ugc nofollow" target="_blank">最新稳定版的预建二进制和源代码压缩包</a></p><p id="40a2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于学习的目的——也可能是为了获得更深入的知识——我相信，如果打算用代码的方式使用它，你至少应该能够构建这个东西。这就是我想要的。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="e96b" class="jp jq ht bd jr js lo ju jv jw lp jy jz ka lq kc kd ke lr kg kh ki ls kk kl km bi translated">愿问题开始</h1><p id="2fe6" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">因此，AGL 是一个基于<a class="ae ks" href="https://www.yoctoproject.org" rel="noopener ugc nofollow" target="_blank"> Yocto 项目</a>的项目。我不会在这里深入讨论 Yocto 的内部情况，但是，请不要客气，请你自己去看看吧。引用这一页的标题就足够了:“Yocto 项目。它不是嵌入式 Linux 发行版，而是为您创建一个自定义发行版”。</p><p id="3da0" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编译 Yocto 项目可能是一个时间问题:它很大程度上依赖于您的主机。因此，如果您要在当前的操作系统机器上编译一个最新版本，它很可能会无缝地工作。我过去去过那里。输入一些命令行，等待几个小时，收集价值 120 千兆字节的软件，这是一件美好的事情。</p><p id="571a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，随着时间的推移，你最终更新你的操作系统，旧的程序开始弹出各种错误。那正是发生在我身上事。我甚至开始尝试修补和向前推进。我发现 GCC 10 不能被正确识别，m4 不能构建，还有一个 elf 二进制工具，我现在记不起来了。我解决了这些问题。然后更多的出现了。</p><p id="1608" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那时，我放弃了，尝试了一个经典的方法:将 VirtualBox 移植到旧的操作系统中。这“奏效”:经过一夜的构建，我已经成功运行了 8270 个任务中的 1000 个，我很快得出结论，这也不是一条路可走。</p><p id="0928" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我只剩下几个选择:降级我的主机或者尝试看看在野外有什么。第二个让我在<a class="ae ks" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">码头</a>到达。Docker 使用“操作系统级虚拟化来交付被称为容器的软件包中的软件。容器是相互隔离的，捆绑了它们自己的软件、库和配置文件”。</p><p id="f8a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这似乎正是我一直在寻找的:以最小的开销虚拟化操作系统。过去，我已经使用 chroot 实现了这一点，但我不会为此再走那么远。</p></div><div class="ab cl lh li gp lj" role="separator"><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm ln"/><span class="lk bw bk ll lm"/></div><div class="hb hc hd he hf"><h1 id="7942" class="jp jq ht bd jr js lo ju jv jw lp jy jz ka lq kc kd ke lr kg kh ki ls kk kl km bi translated">使用 Docker 为 RPi4 构建 AGL</h1><p id="8a0b" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">所以，直截了当地说，这是 Ubuntu 20.10 主机的程序。</p><h2 id="5e72" class="lt jq ht bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">码头设备</h2><p id="7f77" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">首先，确保你没有以前的 Docker 安装。</p><p id="8d86" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，安装 Docker:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="a782" class="lt jq ht mm b fi mq mr l ms mt">sudo apt update<br/>sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br/>curl -fsSL <a class="ae ks" href="https://download.docker.com/linux/ubuntu/gpg" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu/gpg</a> | sudo apt-key add<br/>sudo add-apt-repository “deb [arch=amd64] <a class="ae ks" href="https://download.docker.com/linux/ubuntu" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/ubuntu</a> $(lsb_release -cs) stable”<br/>sudo apt update<br/>sudo apt-get -y install docker-ce</span></pre><p id="f538" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有关此过程的更多信息，请访问<a class="ae ks" href="https://docs.docker.com/engine/install/ubuntu/" rel="noopener ugc nofollow" target="_blank">在 Ubuntu 上安装 Docker 引擎</a>。</p><p id="d6bb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要测试您最近安装的 Docker 包，请运行入门映像:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="c97b" class="lt jq ht mm b fi mq mr l ms mt">sudo docker run -p 80:80 docker/getting-started</span></pre><p id="5fa9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实例运行后，进入浏览器，通过访问<a class="ae ks" href="http://0.0.0.0" rel="noopener ugc nofollow" target="_blank"> http://0.0.0.0 </a>打开本地主机。您应该得到一个在您刚刚启动的 docker 容器中运行的页面。很迷人，是吧？</p><figure class="mh mi mj mk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mu"><img src="../Images/7bfa8a32bb5043ab0820ee1e014542f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jc4ZXrZ9KbHPjUMB"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx translated">您的 docker 自托管入门页面。</figcaption></figure><p id="f18f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，您可以通过 CTRL+C '进入终端来停止正在运行的 docker 进程。</p><h2 id="49f7" class="lt jq ht bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">在 Docker 上运行 Yocto 构建</h2><p id="c8b7" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">所以，现在我们已经解决了这个问题，我写了一个 Dockerfile 文件来加速这个过程。我从头开始酝酿这个，它可能还没有完全优化，因为我对 docker 相当陌生。</p><p id="c638" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，为了构建映像，对您的 git 用户名和电子邮件进行调整:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="5810" class="lt jq ht mm b fi mq mr l ms mt">mkdir ~/agl &amp;&amp; cd ~/agl<br/>wget <a class="ae ks" href="https://github.com/pauloasherring/agl-playground/raw/main/Dockerfile" rel="noopener ugc nofollow" target="_blank">https://github.com/pauloasherring/agl-playground/raw/main/Dockerfile</a><br/>sudo docker build \<br/>--build-arg USER_NAME=$USER \<br/>--build-arg HOST_UID=`id -u` \<br/>--build-arg HOST_GID=`id -g` \<br/>--build-arg GIT_USER_NAME=yourUserName \<br/>--build-arg GIT_EMAIL=your@Email.com \<br/>-t agl:latest .</span></pre><p id="7c85" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">未能调整您的 Git 凭据可能会导致以下错误消息:</p><figure class="mh mi mj mk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mz"><img src="../Images/2f7dcd932564f4daffeae4107ba648ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAKzl9T2kmLAkDaRu248cg.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx translated">如果您错过设置 git 用户的常见问题。</figcaption></figure><p id="9025" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，运行容器:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="e019" class="lt jq ht mm b fi mq mr l ms mt">rm -rf out<br/>mkdir out<br/>sudo docker run -it \<br/>-v $PWD/out:/home/$USER/agl \<br/>agl:latest</span></pre><p id="ee01" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此时，您在正在运行的 docker 中<em class="jo">。接下来，运行 Yocto 构建:</em></p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="7914" class="lt jq ht mm b fi mq mr l ms mt">./../bin/repo init -b koi -u https://gerrit.automotivelinux.org/gerrit/AGL/AGL-repo<br/>./../bin/repo sync<br/>source meta-agl/scripts/aglsetup.sh -m raspberrypi4 agl-demo agl-appfw-smack<br/>bitbake agl-demo-platform</span></pre><p id="bdff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后去喝杯咖啡。去他妈的，点个披萨，吃了它，睡了它。观看原版指环王三部曲。您有足够的时间，并且希望处理器空闲时间很少:)</p><p id="b41d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">漫长的冬天过后，您应该在<code class="du na nb nc mm b">~/agl/out/build/tmp/deploy/images/raspberrypi4–64</code>文件夹中看到构建结果:</p><figure class="mh mi mj mk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nd"><img src="../Images/56876f3402d67236860b18a2c2851d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NUpkWfyxxoaQ3H1wNyNLng.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx translated">AGL 生成的结果树的一部分。</figcaption></figure><h2 id="c274" class="lt jq ht bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">闪烁的树莓 Pi 4</h2><p id="2af8" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">最后，闪烁时间。插入你的 sd 卡，找出它在/dev 文件夹中的路径。你可以运行<code class="du na nb nc mm b">lsblk</code>并在<code class="du na nb nc mm b">/dev</code>上找到你的 sd 卡的入口。下面是我的系统中的一个例子:</p><figure class="mh mi mj mk fd hk er es paragraph-image"><div class="er es ne"><img src="../Images/57db051ee3c7808d408b58907779f354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/1*EF1_t5qBRAApMFZuHwxosA.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx translated">lsblk 输出示例</figcaption></figure><p id="1409" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个例子中，我有一个 4 GiB 的 sd 卡，只有一个分区。<code class="du na nb nc mm b">/dev/sda</code>是磁盘的路径，<code class="du na nb nc mm b">/dev/sda1</code>是它的分区。当发出下面的命令时，你应该参考你的<strong class="is hu"> <em class="jo">磁盘</em> </strong>，而不是它的<em class="jo">分区，即</em> <code class="du na nb nc mm b">/dev/sda</code>。此外，请记住，您的图像名称可能有些不同。</p><p id="2068" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从终端导航至<code class="du na nb nc mm b">~/agl/out/build/tmp/deploy/images/raspberrypi4–64</code>。在那里，你会发现一个 flashable 图像，一个用 xz 压缩的 wic 文件。要刷新您的新映像，请运行:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="c460" class="lt jq ht mm b fi mq mr l ms mt">xzcat {<em class="jo">yourimagename</em>}.wic.xz| sudo dd of=/dev/{<em class="jo">your-sd-disk</em>} bs=4M status=progress<br/>sync</span></pre><h2 id="75de" class="lt jq ht bd jr lu lv lw jv lx ly lz jz jb ma mb kd jf mc md kh jj me mf kl mg bi translated">投入运行</h2><p id="429a" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">将 sd 卡插入您的目标并通电。第一次启动应该需要更长一点的时间——在这里，只需要不到一分钟。下一次，内核加载后 10 秒多一点——因此，总的来说，考虑到 bootloader 和通常的进入 U-Boot、内核加载和初始系统设置的三秒钟，时间会多一点。</p><figure class="mh mi mj mk fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nf"><img src="../Images/547282429dc9cf34cb8ed9d7827db15c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t_LyPNsVrfkbpvHq2u7TZg.jpeg"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx translated">汽车级 Linux 笨拙地运行在我当时仅有的一个屏幕上:一个 29 英寸的显示器。</figcaption></figure><h1 id="f608" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="ca31" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">虽然汽车级 Linux 可能不是第一次接触嵌入式 Linux 的合适人选，但它无疑为竞争激烈的行业领域(如汽车行业)打包了许多产品，是一个相关的框架。</p><p id="1126" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为一个开源项目，它遇到了同行中一个非常常见的问题:项目(和代码，它的依赖项，等等)在发展，而文档却没有，特别是当涉及到教程方法时，比如我试图带给你的方法。</p><p id="5c77" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望对你有帮助:)</p><p id="a7ab" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果有，请告诉我。此外，反馈将非常感谢，因为这是我的第一篇文章。</p></div></div>    
</body>
</html>