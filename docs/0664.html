<html>
<head>
<title>Using EdgeX as an IoT middleware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 EdgeX 作为物联网中间件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/using-edgex-as-an-iot-middleware-6074288ca6dd?source=collection_archive---------3-----------------------#2021-02-02">https://medium.com/nerd-for-tech/using-edgex-as-an-iot-middleware-6074288ca6dd?source=collection_archive---------3-----------------------#2021-02-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="20b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di"> E </span> <a class="ae jm" href="https://www.edgexfoundry.org/" rel="noopener ugc nofollow" target="_blank"> dgeX </a>是一个<strong class="ih hj">开源</strong>，厂商中立的边缘物联网中间件平台，以前由戴尔开发，现在在 Linux 基础下开发和维护。它目前得到了英特尔、Canonical、戴尔、IBM、Wipro 和其他大公司的支持。</p><p id="2a59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EdgeX 翻译和转换来自设备的传感器数据，并通过基于网络的协议将其交付给应用程序，以满足客户的需求。它能够发送和接收数据，并用于控制和启动边缘节点。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es jn"><img src="../Images/0dbb3eef93f4d5e1f6902ebca75dcf4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*h_zGjGs3A6fr09I0hePKZw.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">EdgeX(来源:<a class="ae jm" href="https://www.edgexfoundry.org/" rel="noopener ugc nofollow" target="_blank">https://www.edgexfoundry.org/</a></figcaption></figure><p id="3c91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为实习的一部分，我曾在这个平台上工作过，当我在开发过程中遇到问题时，惊讶地发现缺少在线支持。我不得不依靠 EdgeX Slack 社区来了解某些问题的原因。这可以追溯到 EdgeX 仍然没有被广泛用于开发物联网解决方案的原因。本文的目的是分享我的经验以及一个关于建立一个简单物联网用例的简短指南。</p><h2 id="3a8f" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">入门指南</h2><p id="88d6" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">现在我们已经对 EdgeX 有了基本的了解，让我们继续讨论开发方面的事情。EdgeX 由多个微服务组成，这些微服务以 docker 容器映像的形式打包，保存在 DockerHub 上，可以在这里<a class="ae jm" href="https://hub.docker.com/u/edgexfoundry/" rel="noopener ugc nofollow" target="_blank">找到</a>。</p><p id="9d6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要注意的是，本文讨论了 EdgeX 部署在边缘设备(如 Raspberry Pi)上的场景。幸运的是，EdgeX 支持 arm64 和 amd64 arch 类型。为了区分两种拱门类型的容器图像，arm64 的图像以“-arm64”结尾。因此，在这种情况下，我们将使用每个微服务的 arm64 版本。</p><p id="513a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个例子是'<a class="ae jm" href="https://hub.docker.com/r/edgexfoundry/docker-device-bacnet-c-arm64" rel="noopener ugc nofollow" target="_blank">edgexfoundry/docker-device-BAC net-c-arm 64</a>，它的 amd64 对应物是'<a class="ae jm" href="https://hub.docker.com/r/edgexfoundry/docker-device-bacnet-c" rel="noopener ugc nofollow" target="_blank">edgexfoundry/docker-device-BAC net-c</a></p><p id="b326" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">值得注意的是，EdgeX 正在积极开发中，每年都有两个主要版本。截止到撰写本文时，当前版本是河内的<a class="ae jm" href="https://github.com/edgexfoundry/developer-scripts/tree/master/releases/hanoi/compose-files" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a>版本。</p><p id="8d4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EdgeX 可以通过使用 docker-compose 文件来运行，可以在这里找到<a class="ae jm" href="https://github.com/edgexfoundry/developer-scripts/blob/master/releases/hanoi/compose-files/docker-compose-hanoi-no-secty-arm64.yml" rel="noopener ugc nofollow" target="_blank"/>，也可以使用 Linux 上的<a class="ae jm" href="https://snapcraft.io/edgexfoundry" rel="noopener ugc nofollow" target="_blank">快照存储</a>来运行。从个人经验来看，我推荐使用 docker-compose 方法。</p><p id="d02c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">docker-compose 文件包含要从 DockerHub 中提取并使用的每个微服务的必要版本。它还允许修改微服务的某些参数，这将在本文的后面部分讨论。为了将来参考，来自<a class="ae jm" href="https://github.com/edgexfoundry/developer-scripts/blob/master/releases/hanoi/compose-files/docker-compose-hanoi-no-secty-arm64.yml" rel="noopener ugc nofollow" target="_blank">这里</a>的 docker-compose 文件将用于接下来的部分。需要注意的是，EdgeX 使用<strong class="ih hj"> Redis </strong>在本地存储传感器数据。</p><p id="f3e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kz">注意:docker-compose 文件包含启动 EdgeX 所需的最少微服务，可以根据需要进行修改以包含必要的微服务。</em></p><p id="f71b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要在 Raspberry Pi 上运行 EdgeX，我推荐使用 Ubuntu 服务器(在这里找到<a class="ae jm" href="https://ubuntu.com/download/raspberry-pi" rel="noopener ugc nofollow" target="_blank"/>)并使用 SSH 进行开发。我将不解释设置，但将留下此<a class="ae jm" href="https://pimylifeup.com/ubuntu-server-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">链接</a>以供参考。一旦 Ubuntu 安装程序准备好了必要的要求和下载的文件，终端上的以下命令(在 docker-compose.yml 文件的目录中)将启动并运行 EdgeX。</p><pre class="jo jp jq jr fd la lb lc ld aw le bi"><span id="61e5" class="jz ka hi lb b fi lf lg l lh li">docker-compose up -d</span></pre><p id="6cab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kz">注意:如果您想监控每个微服务的日志，可以跳过“-d”</em></p><p id="a96d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 EdgeX 没有任何错误地启动之后，我们可以通过使用在端口 8500 上运行的 Consul 服务来查看每个微服务的状态。只需在您的网络浏览器上访问<strong class="ih hj"> localhost:8500 </strong>即可打开 GUI 界面。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/d1cb33e4b9cc355a034415ed259704d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-DHUbjwvOezWpvCFn9nLEw.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">领事</figcaption></figure><p id="ae40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了保持文章的简洁，我不会深入到每一步的每一个细节，但会包括一个可以在这里找到的参考文献<a class="ae jm" href="https://docs.edgexfoundry.org/1.2/examples/LinuxTutorial/EdgeX-Foundry-tutorial-ver1.0.pdf" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="a8e6" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">用例</h2><p id="dbed" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">为了更好地理解 EdgeX，让我们以<strong class="ih hj">温度监控</strong>为例，使用<strong class="ih hj"> MQTT </strong>协议、InfluxDB 和 Grafana 来演示 EdgeX 的功能。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lo"><img src="../Images/d969c83761e78d36bab9e7ee7791a709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HSZmLu5IBOdkySvOh7y5sA.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">使用 EdgeX 进行温度监控</figcaption></figure><p id="b370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种简单的温度监控情况下，可以使用 DHT11 等温度传感器来读取读数，驱动应在边缘完成，无需应用层用户的干预，以实现快速响应时间。值得注意的是，传感器与廉价的支持 Wi-Fi 的微控制器接口，以通过 MQTT 传输数据。</p><p id="1ca8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微控制器被配置为连接到 MQTT 代理，该代理设置在云上的 VM 环境中。要了解更多信息，<a class="ae jm" rel="noopener" href="/@emqtt/upload-sensor-data-to-mqtt-cloud-service-via-nodemcu-esp8266-b31980b56308">这篇</a>文章可用作设置传感器节点的参考。为了调试 MQTT 消息，我推荐使用<a class="ae jm" href="https://chrome.google.com/webstore/detail/mqttlens/hemojaaeigabkbcookmlgmdigohjobjm?hl=en" rel="noopener ugc nofollow" target="_blank"> MQTTLens </a>，因为我觉得它可以完成任务。需要注意的是，用于发布数据的 MQTT 主题将在后面使用，所以要记下来。</p><h2 id="b344" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">配置 EDGEX</h2><p id="34c4" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">如前所述，每个 EdgeX 版本都只包含基本的微服务。为了使开发过程更容易，EdgeX 有一个控制台服务，它提供了一个 GUI 界面。</p><p id="2e1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要包含这个服务，将下面的代码粘贴到 docker-compose 文件的<em class="kz">服务</em>下。需要注意的是，该服务运行在端口 4000 上，可以通过在您的 web 浏览器上访问:<strong class="ih hj"> localhost:4000 </strong>来查看。</p><pre class="jo jp jq jr fd la lb lc ld aw le bi"><span id="fd8b" class="jz ka hi lb b fi lf lg l lh li">services: // COPY THE CODE BELOW <br/>    ui:    <br/>      container_name: edgex-ui-go    <br/>      hostname: edgex-ui-go    <br/>      image: edgexfoundry/docker-edgex-ui-go-arm64:1.3.0         <br/>      networks:      <br/>        edgex-network: null    <br/>      ports:    <br/>        - 127.0.0.1:4000:4000/tcp    <br/>      read_only: true</span></pre><p id="de27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，为了使 EdgeX 支持 MQTT 通信作为其“设备服务”的一部分，我们需要在“服务”下添加以下代码，以包含设备-mqtt 微服务。</p><pre class="jo jp jq jr fd la lb lc ld aw le bi"><span id="3e95" class="jz ka hi lb b fi lf lg l lh li">device-mqtt:<br/>  container_name: edgex-device-mqtt<br/>  depends_on:<br/>      - consul<br/>      - data<br/>      - metadata<br/>  environment: <br/>      CLIENTS_COMMAND_HOST: edgex-core-command<br/>      CLIENTS_COREDATA_HOST: edgex-core-data<br/>      CLIENTS_DATA_HOST: edgex-core-data<br/>      CLIENTS_METADATA_HOST: edgex-core-metadata<br/>      CLIENTS_NOTIFICATIONS_HOST: edgex-support-notifications<br/>      CLIENTS_RULESENGINE_HOST: edgex-kuiper<br/>      CLIENTS_SCHEDULER_HOST: edgex-support-scheduler<br/>      DATABASES_PRIMARY_HOST: edgex-redis<br/>      EDGEX_SECURITY_SECRET_STORE: "false"<br/>      REGISTRY_HOST: edgex-core-consul<br/>      SERVICE_HOST: edgex-device-mqtt<br/>  hostname: edgex-device-mqtt<br/>  image: edgexfoundry/docker-device-mqtt-go-arm64:1.2.1<br/>  volumes:<br/>    - ./mqtt:/custom-config<br/>  networks:<br/>    edgex-network: {}<br/>  ports:<br/>    - 127.0.0.1:49982:49982/tcp<br/>  read_only: true<br/>  entrypoint:<br/>    - /device-mqtt<br/>    - --confdir=/custom-config<br/>    - --registry=consul://edgex-core-consul:8500</span></pre><p id="ea7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里需要注意的一个要点是，在<em class="kz"> entrypoint、</em>下，我们有一个用于定制配置的配置目录，即在 docker-compose 文件所在的目录下，我们有一个包含<em class="kz"> configuration.toml </em>的文件夹(我只是将其命名为 mqtt)。该文件用于配置 device-mqtt 服务，以便与其他配置一起连接到 mqtt 代理。请注意，发布数据的主题将在此处配置。文件可以在<a class="ae jm" href="https://github.com/edgexfoundry/device-mqtt-go/blob/f040f91db28658e22aee59e3eddee7a4993b8cd8/cmd/res/configuration.toml" rel="noopener ugc nofollow" target="_blank">这里</a>找到。要修改的关键参数在[驱动程序]下。</p><pre class="jo jp jq jr fd la lb lc ld aw le bi"><span id="67d3" class="jz ka hi lb b fi lf lg l lh li"><em class="kz"># Driver configs<br/></em>[Driver]<br/>...<br/>IncomingHost = '<strong class="lb hj">&lt;ip address of server running the MQTT broker&gt;</strong>' IncomingTopic = '<strong class="lb hj">&lt;Sensor data topic&gt;</strong>' <br/>IncomingUser = '<strong class="lb hj">&lt;username for MQTT broker&gt;</strong>'<br/>IncomingPassword = '<strong class="lb hj">&lt;password for MQTT broker&gt;</strong>'<br/>ResponseHost = '<strong class="lb hj">&lt;ip address of server running the MQTT broker&gt;</strong>'<br/>ResponseUser = '<strong class="lb hj">&lt;username for MQTT broker&gt;</strong>'<br/>ResponsePassword = '<strong class="lb hj">&lt;password for MQTT broker&gt;</strong>'<br/>...</span></pre><p id="286a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">包含这个文件可以确保每次 device-mqtt 服务启动时，它都会自动连接到 TOML 文件中配置的 mqtt 代理。</p><p id="8eaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始注册我们的“MQTT 设备”之前，还有最后一个微服务要包括在内。在架构图中，我们看到传感器数据存储在云数据库中。为了实现这一点，EdgeX 有一个名为“app-service-mqtt”的导出服务，其中本地存储的传感器数据通过 mqtt 消息导出到云数据库。在这种情况下，我们将使用<strong class="ih hj"> InfluxDB </strong>来存储实时数据，以实现更好的可视化。不言而喻，InfluxDB 上的数据库是用来存储数据的。要包含这个微服务，请在<em class="kz">服务下添加以下代码。</em></p><pre class="jo jp jq jr fd la lb lc ld aw le bi"><span id="e5d4" class="jz ka hi lb b fi lf lg l lh li">app-service-mqtt:<br/>  container_name: edgex-app-service-configurable-mqtt<br/>  depends_on:<br/>    - consul<br/>    - data<br/>  environment:<br/>    BINDING_PUBLISHTOPIC: events<br/>    CLIENTS_COMMAND_HOST: edgex-core-command<br/>    CLIENTS_COREDATA_HOST: edgex-core-data<br/>    CLIENTS_DATA_HOST: edgex-core-data<br/>    CLIENTS_METADATA_HOST: edgex-core-metadata<br/>    CLIENTS_NOTIFICATIONS_HOST: edgex-support-notifications<br/>    CLIENTS_RULESENGINE_HOST: edgex-kuiper<br/>    CLIENTS_SCHEDULER_HOST: edgex-support-scheduler<br/>    DATABASES_PRIMARY_HOST: edgex-redis<br/>    EDGEX_PROFILE: mqtt-export<br/>    EDGEX_SECURITY_SECRET_STORE: "false"<br/>    MESSAGEBUS_SUBSCRIBEHOST_HOST: edgex-core-data<br/>    REGISTRY_HOST: edgex-core-consul<br/>    SERVICE_HOST: edgex-app-service-configurable-mqtt<br/>    SERVICE_PORT: 48101<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_ADDRESS: <strong class="lb hj">&lt;server ip address running MQTT broker&gt;<br/>    </strong>WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_PORT: 1883<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_PROTOCOL: tcp<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_TOPIC: "<strong class="lb hj">&lt;Topic name under which data is exported&gt;</strong>"<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_PARAMETERS_AUTORECONNECT: "true"<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_PARAMETERS_RETAIN: "true"<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_PARAMETERS_PERSISTONERROR: "false"<br/>    # WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_PUBLISHER:<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_USER: "<strong class="lb hj">&lt;MQTT broker username&gt;</strong>"<br/>    WRITABLE_PIPELINE_FUNCTIONS_MQTTSEND_ADDRESSABLE_PASSWORD: "<strong class="lb hj">&lt;MQTT broker password&gt;</strong>"<br/>  hostname: edgex-app-service-configurable-mqtt<br/>  image: edgexfoundry/docker-app-service-configurable-arm64:1.1.0<br/>  networks:<br/>    edgex-network: {}<br/>  ports:<br/>    - 127.0.0.1:48101:48101/tcp<br/>  read_only: true</span></pre><p id="920d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是运行脚本来订阅在 MQTT 主题下发布的数据，并将数据存储到数据库中。在这里可以找到<a class="ae jm" href="https://github.com/jonas-werner/EdgeX_Tutorial/blob/master/messenger/app.py" rel="noopener ugc nofollow" target="_blank">的示例脚本。</a></p><p id="7bab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唷！在所有这些步骤之后，我们可以<strong class="ih hj">最终</strong>注册我们的 MQTT 设备’。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div class="er es lp"><img src="../Images/9cd9e4a134e0e925b18bd27401723888.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/0*22UDR27eFcUlrfU5.gif"/></div></figure><p id="f2fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了存储温度、湿度、加速度等任何传感器数据，EdgeX 要求您创建'<strong class="ih hj">值描述符</strong>，让 EdgeX 知道它将处理哪种测量量。除此之外，每个传感器设备都有一个与之关联的“配置文件”。设备配置文件类似于一个类，设备是对象。设备配置文件包含值描述符以及核心命令。在这里可以找到一个样本设备配置文件。EdgeX 要求注册设备配置文件，这可以通过使用运行在端口 4000 上的 UI 微服务简单地添加设备配置文件来完成。</p><p id="25f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是添加设备，方法是单击“devices”下的图标，然后使用“+”按钮添加具有适当配置的设备。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lq"><img src="../Images/f8b8337c8396ac9a130ee18720fd0c88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSrzO6JYXYGdmUSkNR838Q.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">使用 UI 服务在 EdgeX 上注册 MQTT 设备</figcaption></figure><p id="651c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过这种设置，每次传感器模块发布数据时，EdgeX 都会获取数据并将其导出到云数据库。此外，为了可视化这些数据，我们可以使用 Grafana，添加 InfluxDB 数据库作为数据源。为了分析 Raspberry Pi 的实时状态，我们可以使用 Telegraf 收集数据并将其存储到另一个 InfluxDB 数据库中。为了画龙点睛，我们可以使用 Grafana <a class="ae jm" href="https://grafana.com/grafana/dashboards/10578" rel="noopener ugc nofollow" target="_blank">模板</a>来可视化来自 Telegraf 的数据以及传感器输出。因为我没有带温度传感器，所以我为传感器数据生成了随机值。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lr"><img src="../Images/977bebac6e9094a438414170656615c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zvy_NDsFZ3L6WfF5RTBJkg.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">用于数据可视化的 Grafana 仪表板</figcaption></figure><p id="ee16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，为了在混合中添加一些基于价值的驱动，我们将使用“规则引擎”微服务。EdgeX Foundry 与 EMQ·x·柯伊伯合作，将规则引擎集成到 EdgeX 中。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es lj"><img src="../Images/c70c329e58b1f3e3f0e3e273dec5b3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcp1HZvIEHs2TRKs3HmeEw.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">设置规则引擎</figcaption></figure><p id="cdd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要创建一个流，这可以通过<em class="kz"> UI </em>服务来完成，然后我们可以创建一个规则。需要注意的是，语法类似于 SQL。我们还可以配置满足条件时要执行的操作。范围从向设备发出核心命令到将结果发送到 HTTP 服务器。需要注意的是，下面定义的规则每 30 秒取一次值。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="lk ll di lm bf ln"><div class="er es ls"><img src="../Images/2e96ee435725326ba4ca2fc3a1a239a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IA0c27aShqwTlo0qlx0lBQ.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">在规则引擎中定义规则及其相应的操作</figcaption></figure><h2 id="7f5b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">结束注释</h2><p id="a41c" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">因此，在本文中，我们看到了 EdgeX 创建物联网解决方案的简单应用。我希望这篇文章能对鼓励开发人员尝试 EdgeX 有所帮助。如果你想让我在 EdgeX 中报道某个特定的部分，请在评论区告诉我:)</p></div></div>    
</body>
</html>