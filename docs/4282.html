<html>
<head>
<title>Create Custom Alert Dialogs in KOTLIN</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在KOTLIN中创建自定义提醒对话框</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/custom-alert-dialogs-in-kotlin-96d1b01a098d?source=collection_archive---------6-----------------------#2021-07-14">https://medium.com/nerd-for-tech/custom-alert-dialogs-in-kotlin-96d1b01a098d?source=collection_archive---------6-----------------------#2021-07-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e33f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以最近我遇到一个需求，我们需要一个定制的警告对话框，它看起来不像现有的对话框。</p><p id="491f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章只是为了帮助其他可能面临类似问题的人，并给你一些选择。</p><p id="0961" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我开始选项之前，让我给你看一下我们目前使用的现有材料设计警告。</p><p id="ea55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们有一个自定义标题，我们创建了一个标题和一个X按钮。除此之外，我们还有一个标准消息和一个正反按钮。</p><blockquote class="jd je jf"><p id="3936" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">自定义标题— <em class="hi">布局_提醒_对话框_标题</em> </strong></p></blockquote><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="f92e" class="jt ju hi jp b fi jv jw l jx jy">&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"&gt;<br/><br/>    &lt;androidx.appcompat.widget.AppCompatImageView<br/>        android:id="@+id/iv_close"<br/>        android:layout_width="40dp"<br/>        android:layout_height="40dp"<br/>        android:layout_marginTop="4dp"<br/>        android:layout_marginEnd="4dp"<br/>        android:padding="10dp"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent"<br/>        app:srcCompat="@drawable/ic_close"<br/>        app:tint="@color/neutral" /&gt;<br/><br/>    &lt;androidx.appcompat.widget.AppCompatTextView<br/>        android:id="@+id/tv_title"<br/>        android:ellipsize="end"<br/>        android:maxLines="2"<br/>        android:paddingStart="16dp"<br/>        android:paddingEnd="16dp"<br/>        android:visibility="visible"<br/>        android:text="Sample Header"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toBottomOf="@id/iv_close" /&gt;<br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span></pre><figure class="jk jl jm jn fd ka er es paragraph-image"><div class="er es jz"><img src="../Images/1e5023451ce61653cabd264ed5899652.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*NtJohc82BXY-m24bedBPCw.png"/></div></figure><h1 id="2639" class="kd ju hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">现有常规对话框(带自定义标题)</strong></h1><figure class="jk jl jm jn fd ka er es paragraph-image"><div class="er es la"><img src="../Images/5a768cfe96143aec4d5c87e2cdd625ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*EyPntN9qivzeOqmtDFqDHQ.png"/></div></figure><p id="3238" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">履行</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="852a" class="jt ju hi jp b fi jv jw l jx jy"><em class="jg">fun MaterialAlertDialogBuilder.showDialog(<br/>    context: Context,<br/>    title: String = "",<br/>    message: String = "",<br/>    positiveText: String? = null,<br/>    negativeText: String? = null,<br/>    positiveClick: DialogInterface.OnClickListener? = null,<br/>    negativeClick: DialogInterface.OnClickListener? = null,<br/>    isDialogCancelable: Boolean = false<br/>): AlertDialog {<br/>    val titleView = View.inflate(context, R.layout.layout_alert_dialog_title, null)<br/>    setCustomTitle(titleView)<br/><br/>    if (title.isNotBlank()) {<br/>        titleView.tv_title.visibility = View.VISIBLE<br/>        titleView.tv_title.text = title<br/>    }<br/><br/>    if (message.isNotBlank()) {<br/>        setMessage(message)<br/>    }<br/>    setCancelable(isDialogCancelable)<br/>    alertDialog.setCanceledOnTouchOutside(isDialogCancelable)  <br/>     positiveText?.let </em><strong class="jp hj"><em class="jg">{<br/>        </em></strong><em class="jg">if (</em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">.isNotBlank()) {<br/>            setPositiveButton(positiveText, positiveClick)<br/>        }<br/>    </em><strong class="jp hj"><em class="jg">}<br/>    </em></strong><em class="jg">negativeText?.let </em><strong class="jp hj"><em class="jg">{<br/>        </em></strong><em class="jg">if (</em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">.isNotBlank()) {<br/>            setNeutralButton(negativeText, negativeClick)<br/>        }<br/>    </em><strong class="jp hj"><em class="jg">}<br/>    </em></strong><em class="jg">val alertDialog = create()<br/><br/>    titleView.iv_close.setOnClickListener </em><strong class="jp hj"><em class="jg">{<br/>        </em></strong><em class="jg">alertDialog.dismiss()<br/>    </em><strong class="jp hj"><em class="jg">}<br/><br/>   </em></strong><em class="jg"><br/>    alertDialog.setOnShowListener </em><strong class="jp hj"><em class="jg">{<br/>    </em></strong><em class="jg">val neutralButton = alertDialog.getButton(AlertDialog.BUTTON_NEUTRAL)<br/>    neutralButton.paintFlags = neutralButton.paintFlags or Paint.UNDERLINE_TEXT_FLAG<br/>    </em><strong class="jp hj"><em class="jg">}<br/>    </em></strong><em class="jg">alertDialog.show()<br/>    return alertDialog<br/>}</em></span></pre><p id="9233" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，对于新的需求，我们需要一些不同类型的对话框。</p><h1 id="038e" class="kd ju hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">选项1 </strong> —两个/所有选项同等重要的对话框。</h1><figure class="jk jl jm jn fd ka er es paragraph-image"><div class="er es lb"><img src="../Images/f0c4ca9d5d341005a177710bbbdbd22c.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*-PYteCoi_FrB5WzjB3K8FA.png"/></div></figure><p id="b33e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，这是我们的一个选择，一个非标准外观的对话框。这背后的想法是不要突出显示肯定按钮，而是以同等的重要性显示两个选项，这样用户必须真正通读选项，然后决定<br/>所以我首先创建了一个自定义视图，它可以显示在选项的对话框内—<em class="jg">layout _ custom _ dialog _ View</em></p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="4a83" class="jt ju hi jp b fi jv jw l jx jy"><em class="jg">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.constraintlayout.widget.ConstraintLayout<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/option1"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:layout_marginLeft="15dp"<br/>        android:layout_marginRight="15dp"<br/>        android:background="#F1F1F2"<br/>        tools:text="Option 1"<br/>        android:padding="15dp"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toTopOf="parent" /&gt;<br/><br/>    &lt;TextView<br/>        android:id="@+id/option2"<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:layout_margin="15dp"<br/>        android:background="#F1F1F2"<br/>        android:padding="15dp"<br/>        tools:text="Option 2"<br/>        app:layout_constraintBottom_toBottomOf="parent"<br/>        app:layout_constraintEnd_toEndOf="parent"<br/>        app:layout_constraintStart_toStartOf="parent"<br/>        app:layout_constraintTop_toBottomOf="@+id/option1"<br/>        app:layout_constraintVertical_bias="0.0" /&gt;<br/>&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</em></span></pre><p id="1981" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建之后，我将这个视图添加到对话框的setView属性中。我重用了与常规对话框相同的函数签名，但是您也可以决定使用单独的语法来传递值。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a56a" class="jt ju hi jp b fi jv jw l jx jy">val customDialogOptions = View.inflate(context, R.layout.<em class="jg">layout_custom_dialog_view</em>, null)<br/>positiveText?.<em class="jg">let </em><strong class="jp hj">{<br/>    </strong>if (<strong class="jp hj">it</strong>.<em class="jg">isNotBlank</em>()) {<br/>        customDialogOptions.option1.<em class="jg">visibility </em>= View.<em class="jg">VISIBLE<br/>        </em>customDialogOptions.option1.<em class="jg">text </em>= positiveText<br/>        customDialogOptions.option1.setOnClickListener <strong class="jp hj">{<br/>            </strong>positiveClick<br/>        <strong class="jp hj">}<br/>    </strong>}<br/><strong class="jp hj">}<br/><br/></strong>negativeText?.<em class="jg">let </em><strong class="jp hj">{<br/>    </strong>if (<strong class="jp hj">it</strong>.<em class="jg">isNotBlank</em>()) {<br/>        customDialogOptions.option2.<em class="jg">visibility </em>= View.<em class="jg">VISIBLE<br/>        </em>customDialogOptions.option2.<em class="jg">text </em>= negativeText<br/>        customDialogOptions.option2.setOnClickListener <strong class="jp hj">{<br/>            </strong>negativeClick<br/>        <strong class="jp hj">}<br/>    </strong>}<br/><strong class="jp hj">}</strong></span></pre><blockquote class="jd je jf"><p id="e51b" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">限制——上面的实现对于2或3个选择可以很好地工作，但如果超过这个数目，你将面临一个问题，如何处理所有文本的传递以及每个选择的点击处理程序。</p></blockquote><p id="90c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是下一个选项出现的地方。</p><h1 id="6127" class="kd ju hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">选项2 </strong> —单选对话框</h1><p id="1fbe" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">现在，我们在这里利用了<em class="jg">setsinglectioneitems</em>，但是我们对它做了一点小小的改动。我们的期望是，当用户选择任何选项时，不要使用任何肯定/否定按钮。选择本身应该触发动作并关闭对话框。</p><blockquote class="jd je jf"><p id="049d" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">注意-:请记住，当您使用setSingleChoiceItems或setMultiChoiceItems时，您不能直接设置消息，因为选项会替换标题下的整个视图，因此它要么是消息，要么是选项。</p><p id="4e56" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">在这种情况下，你会希望你的标题更加自我解释，告诉用户需要做什么。</p></blockquote><figure class="jk jl jm jn fd ka er es paragraph-image"><div class="er es lh"><img src="../Images/e36b977951cdf5fce16bf20cb312777b.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*7qC3mUP39G8C3nm44EoIPg.png"/></div></figure><p id="ad4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我传递了选项列表和对选项的回调。您也可以选择用另一种方式来处理它，但是这种方法似乎更容易，并且将处理选择的部分留给了消费者。</p><blockquote class="jd je jf"><p id="8351" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">注意:默认情况下，在选择单个/多个项目时，对话框不会被关闭，所以我在下面对其进行了包装并明确将其关闭</p></blockquote><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="2921" class="jt ju hi jp b fi jv jw l jx jy"><em class="jg">fun MaterialAlertDialogBuilder.showCustomDialogWithSingleSelection(<br/>    context: Context,<br/>    title: String = "",<br/>    optionsList: ArrayList&lt;String&gt;,<br/>    handleOptionsSelectionCallback: DialogInterface.OnClickListener? = null,<br/>    isDialogCancelable: Boolean = false<br/>): AlertDialog {<br/>    val titleView = View.inflate(context, R.layout.layout_alert_dialog_title, null)<br/>    setCustomTitle(titleView)<br/>    if (title.isNotBlank()) {<br/>        titleView.tv_title.visibility = View.VISIBLE<br/>        titleView.tv_title.text = title<br/>    }<br/>    val options: Array&lt;CharSequence&gt; =<br/>        optionsList.toArray(arrayOfNulls&lt;CharSequence&gt;(optionsList.size))<br/>    </em>setSingleChoiceItems(options, -1) <strong class="jp hj">{ </strong>dialog, which <strong class="jp hj">-&gt;<br/>    </strong>handleOptionsSelectionCallback?.onClick(dialog,which)<br/>    dialog.dismiss()<br/><strong class="jp hj">}</strong><em class="jg"><br/>    val alertDialog = create()<br/>    titleView.iv_close.setOnClickListener </em><strong class="jp hj"><em class="jg">{<br/>        </em></strong><em class="jg">alertDialog.dismiss()<br/>   <br/>    setCancelable(isDialogCancelable)<br/>    alertDialog.setCanceledOnTouchOutside(isDialogCancelable)<br/>    alertDialog.show()<br/>    return alertDialog<br/>}</em></span></pre><p id="5615" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在这种情况下，回调返回所选选项的索引，我可以随心所欲地处理它。在下面的例子中，我只是显示了另一个对话框，其中有返回的索引和值，但是你可以选择对它做任何你想做的事情。可能会以祝酒词的形式出现，也可能根本不出现。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="5f3d" class="jt ju hi jp b fi jv jw l jx jy"><em class="jg">val optionsList  = arrayListOf("Sample Option 1", "Sample Option 2", "Sample Option 3")<br/>        fun MyClickListener() =<br/>            DialogInterface.OnClickListener </em><strong class="jp hj"><em class="jg">{ </em></strong><em class="jg">dialog: DialogInterface, i: Int </em><strong class="jp hj"><em class="jg">-&gt; </em></strong><em class="jg">context?.let </em><strong class="jp hj"><em class="jg">{<br/>                </em></strong><em class="jg">dialog.dismiss()<br/>                //showing the returned index<br/>                MaterialAlertDialogBuilder(</em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">).showDialog(<br/>                    context = </em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">,<br/>                    title = "Selected Value",<br/>                    message = "index = ${i.toString()} || value = ${optionsList[i]}",<br/>                    positiveText = "OK",<br/>                    positiveClick = DialogInterface.OnClickListener </em><strong class="jp hj"><em class="jg">{ </em></strong><em class="jg">_, _ </em><strong class="jp hj"><em class="jg">-&gt; }</em></strong><em class="jg">,<br/>                    isDialogCancelable = true<br/>                )<br/>            </em><strong class="jp hj"><em class="jg">} }<br/>        </em></strong><em class="jg">context?.let </em><strong class="jp hj"><em class="jg">{<br/>            </em></strong><em class="jg">MaterialAlertDialogBuilder(</em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">).showCustomDialogWithSingleSelection(<br/>                context = </em><strong class="jp hj"><em class="jg">it</em></strong><em class="jg">,<br/>                title = "Sample long title. This is a pretty long title indeed.! It just keeps going.!",<br/>                optionsList = optionsList,<br/>                handleOptionsSelectionCallback = MyClickListener(),<br/>                isDialogCancelable = true<br/>            )<br/>        </em><strong class="jp hj"><em class="jg">}</em></strong></span></pre><p id="2139" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有各种其他方式来处理这种情况。上面的场景与我在其他地方看到的标准用法略有不同，在这些地方，选项下面还有一个肯定和否定按钮，它们将触发处理方法。</p></div></div>    
</body>
</html>