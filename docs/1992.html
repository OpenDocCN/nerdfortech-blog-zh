<html>
<head>
<title>Implement sending documents to sign with DocuSign in a Laravel App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Laravel 应用程序中实现发送文档以使用 DocuSign 签名</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/implement-sending-documents-to-sign-with-docusign-in-a-laravel-app-92aa4203837f?source=collection_archive---------1-----------------------#2021-04-16">https://medium.com/nerd-for-tech/implement-sending-documents-to-sign-with-docusign-in-a-laravel-app-92aa4203837f?source=collection_archive---------1-----------------------#2021-04-16</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><div class=""/><p id="6418" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为了做到这一点，我们需要在文档中创建一个演示帐户使用创建一个集成密钥更多信息，您可以在<a class="ae je" href="https://www.docusign.com/blog/dsdev-dev-w-ds-integration-keys" rel="noopener ugc nofollow" target="_blank">此处</a>找到。</p><p id="e0fb" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">之后，我们需要创建我们自己的模板，我们将使用它们进行签名。</p><h1 id="6e2f" class="jf jg hj bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">要创建模板</h1><p id="9a8d" class="pw-post-body-paragraph ig ih hj ii b ij kd il im in ke ip iq ir kf it iu iv kg ix iy iz kh jb jc jd hc bi translated">此过程解决了您可以为模板添加或设置的所有问题，但所有步骤都是可选的，您可以选择想要如何设置模板。您可以保存任何完整级别的模板。</p><ol class=""><li id="aa39" class="ki kj hj ii b ij ik in io ir kk iv kl iz km jd kn ko kp kq bi translated">在模板页面，点击<strong class="ii hk">新建</strong>，选择<strong class="ii hk">创建模板</strong>。</li></ol><figure class="ks kt ku kv fe kw es et paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="es et kr"><img src="../Images/d06e3b8776a5b78c315d5cbad7d1b5d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XDCMyR8fwcm-wB1dvT2Yw.png"/></div></div></figure><p id="4dbc" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">将显示“准备”视图，您可以在其中添加文件、收件人角色和消息。</p><figure class="ks kt ku kv fe kw es et paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="es et ld"><img src="../Images/c6f0d06fffd5a7d05567d1d8015c3302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tY54tFnSIevIAoCKi7Ng_Q.png"/></div></div></figure><p id="f60e" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">2.输入模板的名称和描述。</p><p id="ae8c" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这些条目仅在模板本身上可见，从该模板生成的任何信封的签名者都看不到。</p><p id="f3bf" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们需要做的另一件重要的事情是为签约创建角色。在角色字段中定义收件人的角色。该角色有助于模板用户了解在使用模板发送文档时应该输入谁作为收件人。示例:申请人、客户、销售代表</p><p id="5da9" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">更多详细信息你可以在<a class="ae je" href="https://support.docusign.com/en/guides/ndse-user-guide-create-templates" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="8802" class="jf jg hj bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">步骤 1:安装 Laravel</h1><p id="8e84" class="pw-post-body-paragraph ig ih hj ii b ij kd il im in ke ip iq ir kf it iu iv kg ix iy iz kh jb jc jd hc bi translated">在第一步中，我们需要使用下面的命令获得新的 Laravel 应用程序，因此打开您的终端或命令提示符并运行下面的命令:</p><pre class="ks kt ku kv fe le lf lg lh aw li bi"><span id="a842" class="lj jg hj lf b fj lk ll l lm ln">composer create-project --prefer-dist laravel/laravel docusign-app</span></pre><h1 id="985d" class="jf jg hj bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated">步骤 2:安装 docusign php 客户端</h1><pre class="ks kt ku kv fe le lf lg lh aw li bi"><span id="b2ef" class="lj jg hj lf b fj lk ll l lm ln">composer require docusign/esign-clien</span></pre><p id="e450" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在我们安装了这个包之后，我们需要创建一个基本的客户端类来处理与 DocuSing Api 的连接。</p><p id="e1e2" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">首先，我们需要创建一个客户机实例，它将接受如下所示的配置实例作为参数:</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="688f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">我们将在<strong class="ii hk">中存储所有凭证。env </strong>文件。创建演示帐户后，您可以从 DocuSign platform 获取凭据。</p><p id="6149" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">得到所有这些信息后，我们将尝试在 DocuSign Api 中进行登录尝试，如下所示:</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="cc92" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这将向客户端返回我们未来请求的所有必要信息。</p><p id="9632" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为了推进我们的应用程序，我们需要添加一些东西。在我的例子中，我创建了一个<strong class="ii hk">模板</strong>表，其中存储了我在 DocuSign 中创建的所有模板，供我根据不同的客户选择发送哪一个模板。我做的第二件事是创建一个<strong class="ii hk"> envelope_requests </strong>表。在这里，我存储了我发送给客户的所有签名请求。</p><p id="b94f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">对于上面列出的表，我创建了模型和一些基本的存储库，以便更容易地与它们交互。</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="0c74" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">在第一部分中，我们创建了模板，定义了用于签名的角色，还定义了客户在签名前应该填写的一些基本字段(如名字和姓氏、公司详细信息等)。</p><p id="b6d6" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">首先，我们需要创建要发送到文档的角色，如下所示:</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="4e5b" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated"><strong class="ii hk"> textTabs </strong>键指的是我们在模板中声明的定制字段。</p><p id="1159" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">现在，让我们试着发送第一份要签署的文件:</p><p id="52c5" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">首先，我们验证我们的请求，以便获得客户端，然后我们用从 DocuSign 获得的模板 id 创建信封。</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="452f" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">通过创建信封得到的响应，我们将它存储到表<strong class="ii hk"> envelope_requests </strong>中。</p><pre class="ks kt ku kv fe le lf lg lh aw li bi"><span id="7c2d" class="lj jg hj lf b fj lk ll l lm ln">$this-&gt;envelopeRequestRepository-&gt;store([<br/>    'user_id' =&gt; $user-&gt;id,<br/>    'template_id' =&gt; $template-&gt;id,<br/>    'envelope_id' =&gt; $response-&gt;getEnvelopeId(),<br/>]);</span></pre><p id="d34d" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">比方说，我们希望当客户完成签署文件时，我们希望在我们的应用程序中对他的状态进行一些更新。为此，我们创建一个 EventNotification 对象，并在创建信封时将其传递给 DocuSign。处理这个问题的类如下所示:</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure><p id="9114" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">并且可以这样传递:</p><pre class="ks kt ku kv fe le lf lg lh aw li bi"><span id="6507" class="lj jg hj lf b fj lk ll l lm ln">$envelopDefinition-&gt;setEventNotification($this-&gt;eventNotification-&gt;build());</span></pre><p id="b6af" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">为此，我们可以创建一条路线:</p><pre class="ks kt ku kv fe le lf lg lh aw li bi"><span id="5231" class="lj jg hj lf b fj lk ll l lm ln">Route::any('docusign/webhook', SignWebhookController::class)-&gt;name('docusign.webhook');</span></pre><p id="5854" class="pw-post-body-paragraph ig ih hj ii b ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd hc bi translated">这个处理用户更新的方法如下所示:</p><figure class="ks kt ku kv fe kw"><div class="bz dz l di"><div class="lo lp l"/></div></figure></div></div>    
</body>
</html>