<html>
<head>
<title>Realtime Audio transcription with AWS Transcribe, Nodejs, and Gstreamer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS转录、Nodejs和Gstreamer进行实时音频转录</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/realtime-audio-transcription-with-aws-transcribe-nodejs-and-gstreamer-8e069f58f854?source=collection_archive---------0-----------------------#2022-01-30">https://medium.com/nerd-for-tech/realtime-audio-transcription-with-aws-transcribe-nodejs-and-gstreamer-8e069f58f854?source=collection_archive---------0-----------------------#2022-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/4bede4836159f1a454364616b4b2d963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbMHhjPsGUyLHVg_ApTdOw.jpeg"/></div></div></figure><div class=""/><p id="25e5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转录是AWS提供的一种机器学习服务，用于将语音转换为文本。这项服务建立在自动语音识别和自然语言处理技术的基础上。通过提供标点符号、数字标准化、时间间隔生成和多说话者识别等功能，转录提供了易于阅读的抄本。</p><p id="1502" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实时音频转录是最酷的功能之一，允许流式音频和从Websocket读取文本。在本文中，我将展示如何构建一个nodejs应用程序来传输音频文件并打印文本输出。</p><h2 id="a6ed" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">设计</h2><figure class="kl km kn ko fd hk er es paragraph-image"><div class="er es kk"><img src="../Images/7452d02ad6caf09b6515b0fd1358820e.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*xGDF6rWGPfQcI_3VBroFpw.jpeg"/></div></figure><p id="478d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Gstreamer pipeline模仿音频流服务，使用<em class="kp"> filesrc </em>加载一个样本mp3文件，并使用<em class="kp"> tcpclientsink </em>插件<em class="kp">将其流式传输到Nodejs TCP服务器。</em> Nodejs TCP服务器读取这些音频组块，转换成二进制消息，最后通过WebSocket转发给转录者。然后它读取结果并输出到shell。</p><h2 id="9c35" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">Gstreamer</h2><pre class="kl km kn ko fd kq kr ks kt aw ku bi"><span id="f964" class="jp jq ht kr b fi kv kw l kx ky">gst-launch-1.0 filesrc location="/home/ubuntu/NSC_.mp3" ! decodebin ! audioconvert ! audioresample ! audio/x-raw, rate=16000 ! flacenc ! tcpclientsink port=2225</span></pre><p id="3cf7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Gstreamer管道从源读取文件，转换成合适的音频格式，并将其传输到TCP端口。</p><h2 id="ced0" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">Nodejs应用</h2><p id="0f6d" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">AWS提供了一个内容丰富的<a class="ae jo" href="https://docs.aws.amazon.com/transcribe/latest/dg/streaming.html" rel="noopener ugc nofollow" target="_blank">指南</a>，解释了如何使用WebSocket接口访问转录功能的步骤。</p><p id="6fb9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要创建一个nodejs TCP服务器来监听端口2225并从Gstreamer读取音频流。为此，我们可以使用nodejs提供的“net”包。</p><figure class="kl km kn ko fd hk"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">TCP服务器</figcaption></figure><p id="9e9d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，我们需要创建一个方法来转换音频块，以转录流API友好的二进制消息。AWS Javascript SDK为此提供了一组实用方法。</p><figure class="kl km kn ko fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="d13b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，接收和转换音频块部分已经完成。接下来是最重要的部分，通过WebSocket将转换后的二进制消息转换成流。第一步是使用WebSocket连接转录，web socket受Amazon Signature第4版签名方法保护。网上有足够的代码示例来解释签名过程。我直接从这个<a class="ae jo" href="https://github.com/amazon-archives/amazon-transcribe-websocket-static/blob/master/lib/aws-signature-v4.js" rel="noopener ugc nofollow" target="_blank">链接</a>复制代码，一点点修改。</p><figure class="kl km kn ko fd hk"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">签名V4实用程序代码</figcaption></figure><p id="ff8e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们可以使用上面的代码来生成预签名的URL，以连接转录服务。</p><figure class="kl km kn ko fd hk"><div class="bz dy l di"><div class="le lf l"/></div><figcaption class="lg lh et er es li lj bd b be z dx translated">连接到转录Websocket</figcaption></figure><p id="9338" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，从WebSocket读取结果并输出到shell。结果是一个包含大量细节的JSON对象。其中最重要的一个是部分。因为这是一个流服务，所以套接字一开始流音频就开始返回结果。转录提供两种类型的结果集，部分和完整的。它返回递增的部分结果，直到它使用NLP引擎识别出音频的暂停。然后将生成并转发最终结果。</p><pre class="kl km kn ko fd kq kr ks kt aw ku bi"><span id="2d69" class="jp jq ht kr b fi kv kw l kx ky">{<br/>  "TranscriptResultStream": {<br/>    "TranscriptEvent": {<br/>      "Transcript": {<br/>        "Results": [<br/>          {<br/>            "Alternatives": [<br/>              {<br/>                "Items": [<br/>                  {<br/>                    "Content": "The",<br/>                    "EndTime": 0.3799375,<br/>                    "StartTime": 0.0299375,<br/>                    "Type": "pronunciation",<br/>                    "VocabularyFilterMatch": false<br/>                  },<br/>                  {<br/>                    "Content": "Amazon",<br/>                    "EndTime": 0.5899375,<br/>                    "StartTime": 0.3899375,<br/>                    "Type": "pronunciation",<br/>                    "VocabularyFilterMatch": false<br/>                  },<br/>                  {<br/>                    "Content": "is",<br/>                    "EndTime": 0.7899375,<br/>                    "StartTime": 0.5999375,<br/>                    "Type": "pronunciation",<br/>                    "VocabularyFilterMatch": false<br/>                  },<br/>                  {<br/>                    "Content": "the",<br/>                    "EndTime": 0.9199375,<br/>                    "StartTime": 0.7999375,<br/>                    "Type": "pronunciation",<br/>                    "VocabularyFilterMatch": false<br/>                  },<br/>                  {<br/>                    "Content": "largest",<br/>                    "EndTime": 1.0199375,<br/>                    "StartTime": 0.9299375,<br/>                    "Type": "pronunciation",<br/>                    "VocabularyFilterMatch": false<br/>                  }<br/>                ],<br/>                "Transcript": "The Amazon is the largest"<br/>              }<br/>            ],<br/>            "EndTime": 1.02,<br/>            "IsPartial": true,<br/>            "ResultId": "2db76dc8-d728-11e8-9f8b-f2801f1b9fd1",<br/>            "StartTime": 0.0199375<br/>          }<br/>        ]<br/>      }<br/>    }<br/>  }<br/>}</span></pre><figure class="kl km kn ko fd hk"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="bef1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们的代码准备好了。测试解决方案的时间到了。</p><figure class="kl km kn ko fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lk"><img src="../Images/a7b7d050afb57470f647c22e5725b0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*lce_5BZtD-IUhV2UbkCyQQ.gif"/></div></div></figure><h2 id="22e3" class="jp jq ht bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">结论</h2><p id="4327" class="pw-post-body-paragraph iq ir ht is b it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn hb bi translated">有各种各样的用例可用于实时转录。实时转录的一些用例是呼叫中心和广播服务。这些转录可以被输入到人工智能系统中，并识别可以触发下游行动的事件，例如向呼叫中心主管发送警报。此外，它们可以被输入搜索平台以建立知识库。有像AWS Comprehend这样的服务可以从抄本中提取有价值的信息以供进一步处理。</p></div></div>    
</body>
</html>