<html>
<head>
<title>Matt’s Tidbits #103 — Launching an app from a URL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Matt 的 103 号趣闻——从 URL 启动应用程序</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/matts-tidbits-103-launching-an-app-from-a-url-c27da66cd52c?source=collection_archive---------4-----------------------#2021-11-02">https://medium.com/nerd-for-tech/matts-tidbits-103-launching-an-app-from-a-url-c27da66cd52c?source=collection_archive---------4-----------------------#2021-11-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/38aac84142469fb3e19295382d341213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*emarK1xFUj42xdKh6D2nAA.jpeg"/></div></div></figure><p id="9139" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本周的花絮将向你展示当用户点击一个链接时如何启动一个应用程序。<a class="ae jo" rel="noopener" href="/nerd-for-tech/matts-tidbits-102-debugging-a-perplexing-view-binding-issue-69d2bb81999c">上一次，我写了关于调试 Android 中的一个视图绑定问题。</a></p><p id="22be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当你点击电子邮件、网页等中的链接时，你的移动设备上有应用程序启动吗？想知道如何为你的应用程序做同样的事情？不要再想了，因为在这个简单的指南中，我将向你展示如何做到这一点！</p><h1 id="240d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">机器人</h1><p id="c522" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在 Android 上，这可以通过在应用程序的<code class="du ks kt ku kv b">AndroidManifest.xml</code>中定义一个<code class="du ks kt ku kv b">&lt;intent-filter&gt;</code>来实现。</p><p id="6b81" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个简单的例子:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="ce4d" class="le jq hi kv b fi lf lg l lh li">&lt;intent-filter&gt;<br/>  &lt;action android:name="android.intent.action.VIEW" /&gt;<br/>  &lt;category android:name="android.intent.category.DEFAULT" /&gt;<br/>  &lt;category android:name="android.intent.category.BROWSABLE" /&gt;<br/>  &lt;data <br/>    android:scheme="https"<br/>    android:host="<a class="ae jo" href="https://matthew-b-groves.medium.com" rel="noopener">matthew-b-groves.medium.com</a>"<br/>  &gt;<br/>&lt;/intent-filter&gt;</span></pre><p id="c3e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样做会导致任何以<code class="du ks kt ku kv b">https://matthew-b-groves.medium.com</code>(我的媒体简介的 URL)开头的链接启动这个应用程序。</p><p id="2fd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您甚至可以定义多个<code class="du ks kt ku kv b">&lt;data&gt;</code>清单，以允许多个 URL 模式调用您的应用程序。<em class="lj">(请注意，您定义的任何可能的方案/主机组合都将匹配——甚至跨</em> <code class="du ks kt ku kv b"><em class="lj">&lt;data&gt;</em></code> <em class="lj">条目)</em></p><p id="32ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据您想要的行为，您甚至可以为<code class="du ks kt ku kv b">android:scheme</code>使用完全定制的东西，比如<code class="du ks kt ku kv b">mattstidbits</code>，并完全省略<code class="du ks kt ku kv b">android:host</code>属性。这将允许<em class="lj">任何以<code class="du ks kt ku kv b">mattstidbits://</code>开头的</em> URL 启动你的应用。但是，这只有在用户安装了您的应用程序的情况下才有效。如果用户没有安装你的应用程序，你想引导他们到 Play Store 列表，你需要使用一个<code class="du ks kt ku kv b">http</code>或<code class="du ks kt ku kv b">https</code>方案和一个你自己的主机/域。然后，你可以按照这些指令来创建一个 JSON 文件，你可以把它嵌入到你的网站上，它会指示浏览器把用户重定向到你的应用的 Play Store 列表页面。</p><p id="35ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您想让您的应用程序访问嵌入在 URL 中的信息(这样您就可以将它们带到应用程序中的特定屏幕)，您需要将类似下面的内容添加到您的应用程序的<code class="du ks kt ku kv b">onCreate</code>方法中:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="7b9c" class="le jq hi kv b fi lf lg l lh li">val action: String? = intent?.action<br/>val uri: Uri? = intent?.data</span></pre><p id="273f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以验证动作是<code class="du ks kt ku kv b">Intent.ACTION_VIEW</code>并获取传入的<code class="du ks kt ku kv b">uri</code>并使用<code class="du ks kt ku kv b">Uri</code>类的方法/属性从 URI 中提取信息来帮助您处理请求。</p><p id="d239" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">测试您的深度链接也是一个好主意，您可以使用<code class="du ks kt ku kv b">adb</code>命令在模拟器或物理设备上进行测试，如下所示:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="a247" class="le jq hi kv b fi lf lg l lh li">adb shell am start -d "<em class="lj">your-deep-link-url</em>" </span></pre><p id="ae1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实现深度链接的 Android 开发者文档确实很优秀，可以在这里找到:<a class="ae jo" href="https://developer.android.com/training/app-links/deep-linking" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/training/app-links/deep-linking</a></p><h1 id="057d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">ios</h1><p id="76f0" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated"><em class="lj">免责声明:我不是 iOS 开发人员，所以我无法提供我能为 Android 提供的细节。</em></p><p id="564b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">苹果似乎提供了两种不同的机制来从 URL 启动应用程序——URL 方案和通用链接。</p><ul class=""><li id="0bf0" class="lk ll hi is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls bi translated"><a class="ae jo" href="https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app" rel="noopener ugc nofollow" target="_blank"> URL 方案</a>实现起来更容易/更快，但是提示用户许可，如果应用没有安装就不起作用。</li><li id="6430" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated"><a class="ae jo" href="https://developer.apple.com/ios/universal-links/" rel="noopener ugc nofollow" target="_blank">通用链接</a>要求你控制域名(很像我上面描述的谷歌应用链接)，所以它们需要更多的工作来设置，但如果用户没有安装应用，它们不会提示用户并允许你提供一个备用 URL。</li></ul><p id="a25e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇文章很好地解释了其中的一些区别:<a class="ae jo" rel="noopener" href="/wolox/ios-deep-linking-url-scheme-vs-universal-links-50abd3802f97">https://medium . com/wolox/IOs-deep-linking-URL-scheme-vs-universal-links-50 Abd 3802 f97</a></p><p id="ffe0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们把重点放在 URL 方案上，因为这是我以前用过的方法。要设置一个，您只需通过项目设置中的“信息”标签在 Xcode 中指定方案。请注意，与 Android 不同，iOS 只允许您定义方案(URL 中位于<code class="du ks kt ku kv b">://</code>之前的部分)。因此，您可以在“URL Schemes”字段中输入<code class="du ks kt ku kv b">mattstidbits</code>，这样任何以<code class="du ks kt ku kv b">mattstidbits://</code>开头的链接都会启动您的应用程序(如果安装了的话)。</p><p id="7d4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在您的<code class="du ks kt ku kv b">Info.plist</code>文件中，这显示在<code class="du ks kt ku kv b">CFBundleURLSchemes</code>键下。</p><p id="c637" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想让你的应用程序访问存储在 URL 中的信息，那么你需要在你的应用程序委托的<code class="du ks kt ku kv b">application()</code>方法中处理它。有一个包含数据的<code class="du ks kt ku kv b">url</code>参数。</p><p id="7a4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与 Android 一样，您可以通过运行以下终端命令来测试这些深层链接:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="01ed" class="le jq hi kv b fi lf lg l lh li">xcrun simctl openurl booted "<em class="lj">your-deep-link-url</em>"</span></pre><p id="337a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">(还是那句话，我不是假装 iOS 开发者，具体怎么做请看<a class="ae jo" href="https://developer.apple.com/documentation/xcode/defining-a-custom-url-scheme-for-your-app" rel="noopener ugc nofollow" target="_blank">官方文档</a>。)</p><h1 id="1383" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">反应自然</h1><p id="c903" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果你已经关注我的花絮有一段时间了，你可能想知道我是否会触及这一点——以下是如何在 React Native 中做到这一点！</p><p id="af95" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">React Native 有两种不同的设置——如果你使用 Expo，按照这些指令指定你想在 Expo 的 JSON 配置中使用的方案。</p><p id="9504" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，如果你没有使用 Expo，你通常需要按照上面 iOS/Android 的相同步骤在你的<code class="du ks kt ku kv b">AndroidManifest.xml</code>和<code class="du ks kt ku kv b">Info.plist</code>中设置深度链接。要在 React Native CLI 项目中实现这一点，您应该按照这些说明<a class="ae jo" href="https://reactnavigation.org/docs/deep-linking/#set-up-with-bare-react-native-projects" rel="noopener ugc nofollow" target="_blank">来配置您的项目。请注意，对于 iOS，您需要向 AppDelegate 添加一些特殊代码来实现这一点。</a></p><p id="f9d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，这两个选项都假设您使用 React 导航来管理应用程序中的导航(我强烈建议您这样做！)</p><p id="1486" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想用这个 URL 做一些事情(而不仅仅是调用这个应用程序)，你需要配置一个<code class="du ks kt ku kv b">linking</code>对象并把它分配给你的<code class="du ks kt ku kv b">NavigationContainer</code>。</p><p id="47c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ks kt ku kv b">linking</code>对象有点古怪，因为它就像你的导航图的副本。它使您能够将 URL 参数映射到内部路线名称/路径，但要求您精确匹配应用程序的导航图。</p><p id="7457" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，您可以按如下方式进行设置:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="bd63" class="le jq hi kv b fi lf lg l lh li">const config = {<br/>  screens: {<br/>    Tidbit: 'post/:id',<br/>    Profile: 'user',<br/>  },<br/>};<br/><br/>const linking = {<br/>  prefixes: ['https://matthew-b-groves.medium.com'],<br/>  config,<br/>};<br/><br/>function App() {<br/>  return (<br/>    &lt;NavigationContainer linking={linking}&gt;<br/>      &lt;Stack.Navigator&gt;<br/>        &lt;Stack.Screen name="Tidbit" component={PostDetailScreen} /&gt;<br/>        &lt;Stack.Screen name="Profile" component={ProfileScreen} /&gt;<br/>      &lt;/Stack.Navigator&gt;<br/>    &lt;/NavigationContainer&gt;<br/>  );<br/>}</span></pre><p id="11ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你有嵌套的导航器(你很可能会这样做)，你的<code class="du ks kt ku kv b">linking</code>对象也需要匹配这个嵌套，这会变得有点乏味。</p><p id="7a2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多详情，见<a class="ae jo" href="https://reactnavigation.org/docs/configuring-links" rel="noopener ugc nofollow" target="_blank">本文</a>。</p><p id="96cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要测试 Expo 项目的链接，运行下面的命令(如果您想改变目标平台，请用下面的<code class="du ks kt ku kv b">ios</code>代替<code class="du ks kt ku kv b">android</code>):</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="8262" class="le jq hi kv b fi lf lg l lh li">npx uri-scheme open "<em class="lj">your-deep-link-url</em>://127.0.0.1:19000" --android</span></pre><p id="64ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于一个非 Expo 项目，您可以通过上面部分描述的本地 iOS/Android 命令来测试深度链接。</p><h1 id="636c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">总体战略</h1><p id="37c7" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我们能从中学到什么？</p><ul class=""><li id="d0db" class="lk ll hi is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls bi translated">iOS/Android/React Native 上的深度链接提供了复杂的功能。</li><li id="4ecf" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">几乎在所有情况下，出于一致性的考虑，您可能希望您的链接在 iOS/Android 上具有相同的格式(让链接在两个平台上无缝工作)</li><li id="34f6" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">我建议从最简单的方法开始，然后从那里开始——为了使用更复杂的应用程序链接(Android)或通用链接(iOS ),可能会有很多繁文缛节需要处理，以便在你公司/项目的网站上更改文件，所以如果你能够使用更基本的深度链接/URL 方案(不需要修改网站)，那么就从那里开始。</li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="465e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有兴趣和我一起在埃森哲出色的数字产品团队工作吗？我们有一个机会:</p><ul class=""><li id="dd95" class="lk ll hi is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls bi translated"><a class="ae jo" href="https://www.accenture.com/us-en/careers/jobdetails?id=00960583_en&amp;title=Mobile+Developer" rel="noopener ugc nofollow" target="_blank">移动开发者(东北地区)</a></li></ul></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="3155" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你还有其他深层链接的技巧想要分享吗？请在下面的评论中告诉我！</p></div></div>    
</body>
</html>