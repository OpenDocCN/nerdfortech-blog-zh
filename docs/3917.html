<html>
<head>
<title>Better Error Handling with Either type in Dart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dart中任一类型的错误处理更好</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/better-error-handling-with-either-type-in-dart-b91bef20d716?source=collection_archive---------0-----------------------#2021-06-29">https://medium.com/nerd-for-tech/better-error-handling-with-either-type-in-dart-b91bef20d716?source=collection_archive---------0-----------------------#2021-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9201" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您是否曾经想过“有没有任何包装类可以将好的响应和坏的响应都包装到一个类型中？”如果你从来没有想过这个问题，让我解释一下为什么它是一个方便的特性。</p><p id="dd7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们有这两个类，</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><ul class=""><li id="0ec7" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">失败类是一个当异常发生时我们返回的类。</li><li id="6380" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc jp jq jr js bi translated">Person类是当我们有一个有效的响应时想要返回的模型类。</li></ul><p id="70e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们想在一个类中包含这两个类，我们该怎么做呢？这里有一个非常幼稚的方法。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="344f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是我们如何使用它，</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="e10f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这门课很酷。这有什么问题🙄？让我们明白</p><ul class=""><li id="b69d" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">响应对象<strong class="ih hj">可以同时启动人员和失败属性</strong>。这肯定不是我们想要的行为。它应该容纳一个人或者一个失败者。两者不应该同时存在。</li></ul><pre class="jd je jf jg fd jy jz ka kb aw kc bi"><span id="d665" class="kd ke hi jz b fi kf kg l kh ki"> Response res = Response(failedReponse);</span><span id="d334" class="kd ke hi jz b fi kj kg l kh ki"> res.person = validResponse; //now 'res' has both person and failure</span></pre><ul class=""><li id="cc65" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc jp jq jr js bi translated">你可能忘了检查错误。</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kk"><img src="../Images/255c070b140076b8e5c57024516031a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*66MXwDHtXYUUr5DTllq7xw.jpeg"/></div></figure><pre class="jd je jf jg fd jy jz ka kb aw kc bi"><span id="9237" class="kd ke hi jz b fi kf kg l kh ki">void main(){<br/>    Failure failedReponse = Failure('something went wrong');  <br/>    Response res = Response(failedReponse);</span><span id="5850" class="kd ke hi jz b fi kj kg l kh ki">    //still valid, compiler doesn't complain, but prints 'null'<br/>    print('Response : ${res.person?.name}');<br/>}</span></pre><p id="0b3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们需要一些东西，</p><ol class=""><li id="b9b5" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kn jq jr js bi translated">以确保同一时间只有一种类型可用。</li><li id="10a3" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kn jq jr js bi translated">强制执行错误处理(向编译器投诉)。</li></ol></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h2 id="88cd" class="kd ke hi bd kv kw kx ky kz la lb lc ld iq le lf lg iu lh li lj iy lk ll lm ln bi translated">达姿套餐</h2><p id="5112" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">Dart没有任何内置类型来使这些发生，但是我们在dart中有<a class="ae lt" href="https://pub.dev/packages/dartz" rel="noopener ugc nofollow" target="_blank"><em class="lu">【dartz】</em></a><strong class="ih hj"><em class="lu"/></strong><em class="lu">一个</em> <strong class="ih hj"> <em class="lu"> </em> </strong> <em class="lu">函数编程</em>。它支持类型<strong class="ih hj">左&lt;，右&gt;T26，满足我们的确切用例。</strong></p><p id="8c77" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先将<a class="ae lt" href="https://pub.dev/packages/dartz/install" rel="noopener ugc nofollow" target="_blank">包</a>添加到你的<strong class="ih hj"> <em class="lu"> pubspec.yaml </em> </strong>文件中，</p><pre class="jd je jf jg fd jy jz ka kb aw kc bi"><span id="d846" class="kd ke hi jz b fi kf kg l kh ki">dependencies:<br/>  dartz: ^0.9.2</span></pre><h2 id="10a0" class="kd ke hi bd kv kw kx ky kz la lb lc ld iq le lf lg iu lh li lj iy lk ll lm ln bi translated">什么是任一类型？</h2><p id="14a1" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated"><code class="du lv lw lx jz b">Either</code>类型用于表示具有两种指定类型中任意一种的值。常见的是使用<code class="du lv lw lx jz b">Either</code>来表示成功值或失败值，尽管这并不是必须的。</p><pre class="jd je jf jg fd jy jz ka kb aw kc bi"><span id="4dbe" class="kd ke hi jz b fi kf kg l kh ki">Either&lt;int, String&gt; response = Right("Hello, im right");</span></pre><p id="9ffe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是使用任一()的简单之处，您在泛型类型参数中以各自的顺序声明左类型和右类型。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es ly"><img src="../Images/5c73f2fd43fc081385886eaabbe6a43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7KvjsWbh7omKd33qvjPABg.png"/></div></div></figure><p id="9e44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<code class="du lv lw lx jz b">Left(value)</code>或<code class="du lv lw lx jz b">Right(value)</code>来赋值。在上面的代码中，我指定<code class="du lv lw lx jz b"><em class="lu">Right(“Hello, im right”)</em></code>把字符串作为右边的值，在这种情况下，左边的值将为空(整数值为空)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="b405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的fold方法负责处理这两个值，如果左边的值可用，它将调用第一个回调方法<code class="du lv lw lx jz b">print(‘Integer : $integerValue’)</code>，否则，它将调用第二个回调方法<code class="du lv lw lx jz b"> print(‘String : $stringValue’)</code></p><p id="c865" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这正是我们想要的，我们想要的</p><ol class=""><li id="8d8e" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kn jq jr js bi translated">一次只有一个值可用。</li><li id="c3fb" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kn jq jr js bi translated">只有在评估左值和右值的可用性后，才应采取相应的措施。</li></ol><h2 id="030f" class="kd ke hi bd kv kw kx ky kz la lb lc ld iq le lf lg iu lh li lj iy lk ll lm ln bi translated"><strong class="ak">使用任一</strong>进行错误处理</h2><p id="5806" class="pw-post-body-paragraph if ig hi ih b ii lo ik il im lp io ip iq lq is it iu lr iw ix iy ls ja jb jc hb bi translated">现在让我们利用这两者的力量来重组我们的<strong class="ih hj">响应</strong>模型类。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="1ecd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们不再有两个独立的失败例子&amp;人。我们使用其中一个类将它们组合成一个实例<strong class="ih hj"> <em class="lu">【人】</em> </strong>。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ji jj l"/></div></figure><p id="c04f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们必须使用fold()处理两种失败的情况&amp; Person对象，否则我们的代码将无法编译。</p><p id="609c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们所做的是，</strong></p><ol class=""><li id="2c5f" class="jk jl hi ih b ii ij im in iq jm iu jn iy jo jc kn jq jr js bi translated">我们确保在任何时候只有一种类型可用。</li><li id="600c" class="jk jl hi ih b ii jt im ju iq jv iu jw iy jx jc kn jq jr js bi translated">我们确保错误总是被处理。</li></ol></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><p id="35de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用了非常简单的例子来解释这两种类型的概念，但是它非常强大💪来解决许多复杂的问题。dartz包中还有许多其他类型和功能，这使得flutter开发人员的工作变得更加容易🤗。我将在随后的文章中介绍它们。</p><p id="a6c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你喜欢这篇文章，请竖起大拇指👍我会带着另一篇Dart文章来见你。谢谢你🙏和快乐学习。</p></div></div>    
</body>
</html>