<html>
<head>
<title>How to Setup Headless Dev Environment with Django and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Django和Docker设置无头开发环境</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-setup-headless-dev-environment-with-django-and-docker-7495bd79b1cb?source=collection_archive---------0-----------------------#2021-07-13">https://medium.com/nerd-for-tech/how-to-setup-headless-dev-environment-with-django-and-docker-7495bd79b1cb?source=collection_archive---------0-----------------------#2021-07-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/adc045bb1ea8b89f0ed5730ccd63dff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q3tWc2vG2cNbMpviHiL2oA.png"/></div></div></figure><p id="0af6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本教程中，我将介绍如何用Django和Docker创建一个强大的开发环境。本教程的灵感来自于我和我朋友的一个项目，我们分工合作，我做后端服务，我朋友负责前端的所有工作。我的目标是为有效的后端开发创建一个开发环境，没有任何部署或其他方面的麻烦。我的设置相当简单，我使用Django作为后端框架，并选择PostgreSQL作为数据库。如果您想跳过教程部分，可以在底部找到样板模板的链接，直接跳到代码。</p><ol class=""><li id="7c94" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">确保您安装了Docker和git(如果您使用提供的模板)</strong></li></ol><p id="6051" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以从<a class="ae jx" href="https://www.docker.com/products/docker-desktop" rel="noopener ugc nofollow" target="_blank">官方Docker页面</a>获取Docker，从<a class="ae jx" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank">官方git页面</a>获取Git。</p><p id="194e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。首先创建一个python环境</strong></p><p id="16b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为您的项目创建新目录，并导航到该目录。之后，让我们创建新的python环境。使用python 3创建Python环境就像运行<code class="du jy jz ka kb b">python3 -m venv &lt;venv_name&gt;</code>命令一样简单。这将为我们的项目创建一个独立的环境，在这里我们可以安装我们的依赖项，而不会影响我们系统上的任何东西。</p><p id="1374" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。创建需求文件</strong></p><p id="0238" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建我们的<code class="du jy jz ka kb b">requirements.txt</code>文件来轻松安装我们的Python依赖项。在项目根目录下新建一个名为<code class="du jy jz ka kb b">requirements.txt</code>的文件，并添加以下内容:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="b78f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。激活python环境</strong></p><p id="c131" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要激活环境，在项目目录中运行以下命令:<br/> <code class="du jy jz ka kb b">source &lt;venv_name&gt;/bin/activate</code></p><p id="82b5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要关闭venv，你可以运行 <code class="du jy jz ka kb b"><em class="ki">deactivate</em></code> <em class="ki">，但是不要运行这个！</em></p><p id="4189" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 5。安装所有依赖项</strong></p><p id="ced3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du jy jz ka kb b">requirements.txt</code>所在的项目目录下运行<code class="du jy jz ka kb b">pip install -r requirements.txt</code>，安装<code class="du jy jz ka kb b">requirements.txt </code>文件中定义的所有依赖项</p><p id="d3b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6。创建Dockerfile </p><p id="3e78" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建我们的<code class="du jy jz ka kb b">Dockerfile </code>来配置我们的docker映像。在项目根目录下新建一个名为<code class="du jy jz ka kb b">Dockerfile</code>的文件，并添加以下内容:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="c4b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个文件中，我们定义了当一个映像被创建时，它将如何被构建。简而言之，我们安装依赖项，并将所有项目文件复制到容器中。</p><p id="1671" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 7。创建docker-compose.yml文件</strong></p><p id="702a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了保持项目易于扩展，让我们创建一个<code class="du jy jz ka kb b">docker-compose.yml</code>文件来处理我们所有的容器。在我们的项目目录的根目录下创建一个<code class="du jy jz ka kb b">docker-compose.yml</code>文件，并在那里添加以下内容:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="dc4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想在这里解释一下也无妨。在这个docker-compose文件中，我们定义了一个PostgreSQL容器，它是一个数据库容器，应该在其中存储它的卷。所有带有<code class="du jy jz ka kb b">${}</code>语法的地方都将被来自<code class="du jy jz ka kb b">.env</code>文件的env变量填充，我们将在第11步创建该文件。</p><p id="5aaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 8。开始一个新项目</strong></p><p id="2c83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们通过调用<code class="du jy jz ka kb b">django-admin startproject &lt;your_project_name&gt; .</code>来启动一个新的Django项目。这将在当前目录中用我们提供的名称创建新的Django项目。现在，您应该在工作目录中看到类似这样的内容:</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/9215bdda07f086d573224dcaa0110e50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*xhJ5y2ZK6k9sIALXb6plyw.png"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">项目目录的内容</figcaption></figure><p id="f048" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 9。通过添加PostgreSQL连接</strong>更改设置文件</p><p id="c095" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Django在创建新项目时默认使用SQLite数据库。这完全没问题，因为它可以处理一些测试和轻度开发，但我们想要更多的东西，所以让我们把我们新创建的PostgreSQL数据库投入使用。</p><p id="3fc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从导航到Django项目目录并编辑数据库设置开始。在<code class="du jy jz ka kb b">settings.py</code>文件中找到<code class="du jy jz ka kb b">DATABASES = ...</code>并用以下内容替换它:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">数据库连接设置</figcaption></figure><p id="1941" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要利用<code class="du jy jz ka kb b">.env</code>文件中的设置，将以下内容添加到第一次<code class="du jy jz ka kb b">Path</code>导入下的文件顶部:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">使用中的环境变量。环境文件</figcaption></figure><p id="2507" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 10。将django_secret移动到。环境文件</strong></p><p id="2df9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了保持我们的<code class="du jy jz ka kb b">settings.py</code>文件整洁，让我们将<code class="du jy jz ka kb b">SECRET_KEY</code>移动到<code class="du jy jz ka kb b">.env</code>文件中。但在此之前，我们需要创建一个这样的文件，在项目根目录中创建包含以下内容的<code class="du jy jz ka kb b">.env</code>命名文件:</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">的内容。环境文件</figcaption></figure><p id="1e82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在再次转到<code class="du jy jz ka kb b">settings.py</code>文件，将带有<code class="du jy jz ka kb b">SECRET_KEY = ...</code>的行复制到<code class="du jy jz ka kb b">.env</code>文件的末尾，并将<code class="du jy jz ka kb b">settings.py</code>中的行替换为<code class="du jy jz ka kb b">SECRET_KEY = env("SECRET_KEY")</code>。<strong class="is hj">注意添加</strong> <code class="du jy jz ka kb b"><strong class="is hj">SECRET_KEY</strong></code> <strong class="is hj">时，删除该行中的所有空格，尤其是等号周围的空格。</strong></p><p id="6e48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 11。恭喜，您的开发环境现在已经设置好了！🎉</strong></p><p id="e8da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们应该能够运行<code class="du jy jz ka kb b">docker-compose up -d</code>来启动PostgreSQL容器，并在等待它启动后运行<code class="du jy jz ka kb b">./manage.py runserver</code>来启动django服务器。在此之后，您应该能够导航到<code class="du jy jz ka kb b">http://localhost:8000</code>并看到以下页面:</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/2f19e0f96d02c22cfef02e048437cf99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*05FjOcaSNySm846JIHiJDg.png"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">成功启动Django项目</figcaption></figure></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><p id="eaa5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们已经在本地机器上实现了带有PostgreSQL数据库的完全工作的Django安装。确认一切正常后，请继续修改<code class="du jy jz ka kb b">.env</code>文件内容以更好地适应您的需要。</p><p id="105e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在教程的开始，我承诺提供一个模板来简化设置。你可以从<a class="ae jx" href="https://github.com/aaralh/django-project-template" rel="noopener ugc nofollow" target="_blank">django-project-template</a>仓库中找到它。有了这个模板，您可以通过运行<code class="du jy jz ka kb b">setup.sh</code>脚本来加速这个过程。git文件夹，并为您创建一个新文件夹，用给定的名称初始化新项目，并对初始设置进行所有必要的更改。现在，我只希望你快乐黑客，如果你有任何建议或变化，请随时打开一个公关🙂</p></div></div>    
</body>
</html>