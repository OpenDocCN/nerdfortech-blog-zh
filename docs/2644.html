<html>
<head>
<title>I M A Pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是管道</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/i-m-a-pipeline-571c49ab225b?source=collection_archive---------15-----------------------#2021-05-14">https://medium.com/nerd-for-tech/i-m-a-pipeline-571c49ab225b?source=collection_archive---------15-----------------------#2021-05-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="dfb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">S3的API</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d5d05f6a7b53d027eca40c8c0fe0b6b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aUmjaErpNi_qJxuF3ZtMWQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">没那么专业，汉！！😮</figcaption></figure><p id="aa0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为商业智能团队的软件开发人员，我必须编写管道来收集来自多个服务的数据，如内部产品、外部API、数据库，现在在AWS中还有API网关、Kinesis和事件总线流。</p><p id="584a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将解释我构建第一条端到端管道的旅程，即从API收集数据，进行处理，并将其存储在S3。</p><p id="3159" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，我们开始吧！！</p><h2 id="7ab4" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated"><strong class="ak">先说说</strong> * <strong class="ak">为什么* </strong>，因为…</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ko"><img src="../Images/f166f6c9564776fae155186904dcd891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wpon84S9eWKMHDonFUVFMw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">口头禅！！😍</figcaption></figure><p id="d75b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个管道之前，我们直接从数据库中挑选数据，然后用业务逻辑处理它，然后创建仪表板或报告。问题是我们必须与其他团队同步进行业务逻辑更新。多亏了其他团队，他们决定在他们的终端应用业务逻辑后发送过滤后的数据。我们对此感到非常兴奋，因为现在我们不必对数据进行任何过滤，但新的挑战是定期从他们提供的源中获取数据。</p><h2 id="1b11" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">现在，我们来谈谈**如何* *</h2><p id="ffc0" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">任务很简单，点击API并获取数据，如果需要的话格式化数据，然后存储到s3。所以我们计划根据AWS的规定，为此使用胶水——</p><blockquote class="ku kv kw"><p id="e0a8" class="if ig kx ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">AWS Glue是一种无服务器的数据集成服务，可以轻松发现、准备和组合用于分析、机器学习和应用程序开发的数据。</p></blockquote><p id="5388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以流程是—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lb"><img src="../Images/0c9bbac193bf956a4920ba0ab5a3bad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YGjNDaFZ6PQEFHvM2z_oQ.png"/></div></div></figure><p id="3dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是因为这不是基于事件的，所以我们必须安排这个管道定期运行。所以我们又增加了一个叫做step函数的服务。根据AWS —</p><blockquote class="ku kv kw"><p id="f5c6" class="if ig kx ih b ii ij ik il im in io ip ky ir is it kz iv iw ix la iz ja jb jc hb bi translated">AWS Step Functions是一个无服务器的函数orchestrator，它可以轻松地将AWS Lambda函数和多个AWS服务排序到业务关键型应用程序中。通过其可视化界面，您可以创建和运行一系列维护应用程序状态的检查点和事件驱动的工作流。一个步骤的输出作为下一个步骤的输入。应用程序中的每一步都按业务逻辑定义的顺序执行。</p></blockquote><p id="6d95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在水流看起来像这样—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/06f00ca3112ba3783cce20cfc984254a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZnenVhV6IEljUr7bcm6YHg.png"/></div></div></figure><p id="da2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用step函数，我们还实现了并行性，我们配置了step函数，使其可以同时并行触发多达5个粘合作业。我们安排它每天运行，并从API中提取数据。</p><h2 id="a5c3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">让我们来谈谈最重要的部分——挑战。😰</h2><ol class=""><li id="3c58" class="ld le hi ih b ii kp im kq iq lf iu lg iy lh jc li lj lk ll bi translated">重新触发已经运行的作业—由于步进功能可以并行触发粘合作业，如果有人使用相同的输入触发作业2-3次会怎样。这将导致在相同的S3路径下写入文件时出现问题，并且数据也会变得混乱。</li></ol><p id="dabe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我们想出了一个解决方案，每当step函数用一种类型的输入触发一个作业时，一个文件将被写入S3，当下一个作业被触发时，它将查询athena，如果作业还没有运行，则触发glue。迷茫？？？让我用流程图来解释一下。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/5b818a7c9cd63161743daa3c9f9afcd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*06rrK7qC6EtAPc8AtL_FCA.png"/></div></div></figure><p id="51e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们不得不引入一个lambda函数服务，它将作为驱动程序来触发粘合作业。这个lambda有以下一组工作-</p><p id="bd2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">I .检查由步骤功能触发的作业是否已经在进行中。</p><p id="4ead" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">二。如果正在进行，则退出并给出异常—具有相同输入的作业已经在进行中。</p><p id="5c99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">三。如果作业没有运行，则创建一个作业运行状态条目作为S3文件，并为该输入触发粘合作业。</p><p id="9035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后胶合工作将做它的工作并且重写S3文件标记工作为成功。我知道这是一个非常糟糕的方法，但是在那个时候很有效。😛。</p><p id="24f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法的问题是，如果粘合作业由于任何原因失败，那么它也无法将作业失败状态写入S3文件，并且当lambda在其下一个触发器中检查作业状态时，lambda认为作业已经在运行，并且它限制粘合针对该特定输入运行。因此，我们必须手动删除s3文件，这是一项任务，因为我们必须首先转到athena表，然后找到正在运行的作业id，然后转到S3，搜索具有该作业id的文件并将其删除。</p><p id="dc20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">后来，我们删除了所有这些额外的进程，并开始在红移表中为作业运行状态创建一个条目，我们做得很好。所以最后的流程是—</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/71804a37c88da7f2fba3860a8a92616c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9M9Nf7ejH_9MJVQorbimeA.png"/></div></div></figure><p id="bd07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我建立第一条数据管道的旅程。这是一个简单的任务，但鉴于我是AWS的新手，对我来说这是一个过山车。😅</p><p id="ae1a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我将会写更多关于我工作过的所有管道。所以，敬请期待！！</p></div></div>    
</body>
</html>