<html>
<head>
<title>Organize and auto back up your .zshrc files to Github</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">组织和自动备份您的。zshrc 文件到 Github</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/organize-and-auto-back-up-your-zshrc-files-to-github-364a262b3227?source=collection_archive---------2-----------------------#2021-07-24">https://medium.com/nerd-for-tech/organize-and-auto-back-up-your-zshrc-files-to-github-364a262b3227?source=collection_archive---------2-----------------------#2021-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7d424ea1189f8c2e0b91778799d838d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h5RNNIPiHYCh-83i4n94Sw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">github.com/imbaggaarm/zshrc-auto-sync</figcaption></figure><p id="1cd7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是一个非常好的周日晚上，当我试图安装 Flutter SDK 来开始一个新的项目时。我需要将 Flutter 二进制文件的路径添加到<strong class="iw hj"> $PATH </strong>中，而不是打开<code class="du js jt ju jv b">.zshrc</code>文件并添加下面一行:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="b55d" class="ke kf hi jv b fi kg kh l ki kj">export PATH<strong class="jv hj">=</strong>"$PATH:`pwd`/flutter/bin"</span></pre><p id="c2c8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我用了这个:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="cccb" class="ke kf hi jv b fi kg kh l ki kj">echo 'export PATH="$PATH:$HOME/development/flutter/bin"' &gt; ~/.zshrc</span></pre><p id="224f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你知道我的指挥有什么问题吗？如果没有，请备份文件，自己试试:)。</p><p id="37d2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">或者简单地说，你可以继续阅读我的文章😄。</p><p id="9338" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">事情是这样的。我应该在上面的命令中使用<code class="du js jt ju jv b">&gt;&gt;</code>而不是<code class="du js jt ju jv b">&gt;</code>。因为如果你使用<code class="du js jt ju jv b">&gt;&gt;</code>，它会把你的文本追加到文件的末尾，否则，用<code class="du js jt ju jv b">&gt;</code>，它会覆盖整个文件。我以前多次使用过这个命令，是的，它比打开文件并添加新行要快，我可能节省了 3 秒钟，但最终花了 3 个小时来修复它。</p><p id="8a90" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">运行完那个命令后，像往常一样，我使用<code class="du js jt ju jv b">cat ~/.zshrc</code>来查看<code class="du js jt ju jv b">.zshrc</code>的内容，我得到了这个:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="da7f" class="ke kf hi jv b fi kg kh l ki kj">export PATH="$PATH:$HOME/development/flutter/bin"</span></pre><p id="a32e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我又试着用了一次<code class="du js jt ju jv b">cat ~/.zshrc</code>，打开了<code class="du js jt ju jv b">.zshrc</code>文件，看看有没有什么不同，但是当我回头看我的 echo 命令的时候，你知道，我的脸就是这样的😐。我相信你能理解我当时的感受。因为如果你是一个软件工程师，你之前肯定至少犯过一次这样的错误，不小心删除了一些配置文件，甚至更糟糕的是，删除了整个生产数据库。</p><p id="a4fb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我开始在谷歌上寻找任何恢复我的<code class="du js jt ju jv b">.zshrc</code>的方法，并且尝试了一些我找到的建议，但是没有一个对我有效。然后，我开始在我的本地机器中搜索，看看我是否有备份，幸运的是，我找到了一个，文件的最后修改日期是 2021 年 5 月 26 日，但这就是我所需要的。</p><p id="cb67" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我也很幸运，因为我没有在<code class="du js jt ju jv b">~/.zshrc</code>中存储我所有的配置。我的机器中有一个<code class="du js jt ju jv b">.zsh</code>目录，其结构如下:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="7015" class="ke kf hi jv b fi kg kh l ki kj">.<br/>├── aliases.zsh<br/>├── cli.zsh<br/>├── fp_kube.zsh<br/>├── pablo.zsh<br/>├── pandora.zsh</span></pre><p id="3f45" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">而在<code class="du js jt ju jv b">~/.zshrc</code>中，我只需要加上这一行:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="aee1" class="ke kf hi jv b fi kg kh l ki kj">for config (~/.zsh/*.zsh) source $config</span></pre><p id="3ebc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了这个配置，我可以很容易地组织我的环境变量，并且我的<code class="du js jt ju jv b">~/.zshrc</code>文件不会在我需要添加更多配置时变得一团糟。请记住，不要把所有的鸡蛋放在一个篮子里。所以基本上，我的<code class="du js jt ju jv b">~/.zshrc</code>文件只包含<code class="du js jt ju jv b">oh-my-zsh</code> setup、$PATH 和一些通用的东西，但是丢失它仍然要花费我很多时间。</p><p id="e77e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了防止将来再次发生这种情况，我决定备份我的。云服务的 zsh 配置。但是我也不想每次修改的时候都手动上传。我需要它与远程存储库自动同步。最后我写了自己的解决方案，要求如下:</p><ul class=""><li id="06df" class="kk kl hi iw b ix iy jb jc jf km jj kn jn ko jr kp kq kr ks bi translated">云服务有我可以用来上传文件的 CLI = &gt; Git 是最好的选择。</li><li id="0bb5" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated">用 Mac 自动检测<code class="du js jt ju jv b">~/.zshrc</code>和<code class="du js jt ju jv b">~/.zsh/</code> = &gt;的变化，我发现<a class="ae ky" href="https://github.com/emcrisostomo/fswatch" rel="noopener ugc nofollow" target="_blank"> fswatch </a>是最合适的解决方案。</li><li id="30ec" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kp kq kr ks bi translated">检测更改的脚本需要在重启机器后自动在后台运行=&gt; <a class="ae ky" href="https://support.apple.com/en-vn/guide/terminal/apdc6c1077b-5d5d-4d35-9c19-60f2397b2369/mac" rel="noopener ugc nofollow" target="_blank"> launchd </a>。</li></ul><p id="1154" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在列出所有需求并了解我需要使用的所有工具和服务后，我开始开发我的解决方案，我将它分解成更小的任务:</p><ol class=""><li id="d14d" class="kk kl hi iw b ix iy jb jc jf km jj kn jn ko jr kz kq kr ks bi translated">在本地机器和 Github 中创建一个 git 存储库。</li><li id="f858" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kz kq kr ks bi translated">写一个可以检测到<code class="du js jt ju jv b">~/.zshrc</code>、<code class="du js jt ju jv b">~/.zsh/</code>变化的脚本。我把它命名为<code class="du js jt ju jv b">sync-zshrc.sh</code></li><li id="4a98" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kz kq kr ks bi translated">编写一个脚本，可以将修改后的<code class="du js jt ju jv b">~/.zshrc</code>和<code class="du js jt ju jv b">~/.zsh/</code>复制到本地存储库，然后提交，将更改推送到远程存储库。我把它命名为<code class="du js jt ju jv b">commit-changes.sh</code></li><li id="b132" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kz kq kr ks bi translated">当有新变化时，修改<code class="du js jt ju jv b">sync-zshrc.sh</code>以执行<code class="du js jt ju jv b">commit-changes.sh</code>。</li><li id="61ba" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kz kq kr ks bi translated">使用<code class="du js jt ju jv b">launchd</code>使<code class="du js jt ju jv b">sync-zshrc.sh</code>在后台模式下运行。</li></ol><p id="bd29" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">仅此而已。没什么大不了的，开始实施吧。</p><p id="2b9d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">…但是，如果你太懒或者没有足够的时间来读完这篇文章，我发布了一个资源库，可以帮助你更容易地做到这一点，自述文件中有一个简短的说明，只需不到 5 分钟即可完成。</p><p id="9d74" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Github 资源库:</strong><a class="ae ky" href="https://github.com/imbaggaarm/zshrc-auto-sync" rel="noopener ugc nofollow" target="_blank">github.com/imbaggaarm/zshrc-auto-sync</a></p><h1 id="c5ea" class="la kf hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">履行</h1><h2 id="54f2" class="ke kf hi bd lb lx ly lz lf ma mb mc lj jf md me ln jj mf mg lr jn mh mi lv mj bi translated">创建 git 存储库</h2><p id="465d" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">我将我的 ZSH 运行配置的所有脚本和备份文件放在以下路径的目录中:<code class="du js jt ju jv b">/Users/eastagile/code/zsh-backup</code>，因此如果您在任何文件中看到此文本，请用您自己的值替换它。</p><p id="28df" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，创建一个新目录并导航到它:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="2a41" class="ke kf hi jv b fi kg kh l ki kj"># Use this if you haven't had the `code` directory yet<br/>mkdir ~/code</span><span id="82fa" class="ke kf hi jv b fi mp kh l ki kj"># Then use this to create a new directory inside `code` directory<br/>mkdir ~/code/zsh-backup</span><span id="2415" class="ke kf hi jv b fi mp kh l ki kj"># Navigate to it<br/>cd ~/code/zsh-backup</span></pre><p id="b32f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，让我们初始化 git 存储库，您可以使用<a class="ae ky" href="https://github.com/cli/cli" rel="noopener ugc nofollow" target="_blank"> Github CLI </a>在命令行上创建一个远程存储库，请记住将 repo 的可见性设置为<strong class="iw hj"> Private。</strong></p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="e68f" class="ke kf hi jv b fi kg kh l ki kj">git init<br/>gh repo create</span></pre><h2 id="7af5" class="ke kf hi bd lb lx ly lz lf ma mb mc lj jf md me ln jj mf mg lr jn mh mi lv mj bi translated">写一个脚本来检测。zshrc 变化</h2><p id="b259" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">为了检测文件变化，我们将使用前面提到的<a class="ae ky" href="https://github.com/emcrisostomo/fswatch" rel="noopener ugc nofollow" target="_blank"> fswatch </a>。</p><p id="8a01" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以通过自制软件安装<code class="du js jt ju jv b">fswatch</code>:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="f565" class="ke kf hi jv b fi kg kh l ki kj">brew install fswatch</span></pre><p id="c4be" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，让我们试试<code class="du js jt ju jv b">fswatch</code>是否能检测到变化，在您的终端上键入以下命令:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="17f5" class="ke kf hi jv b fi kg kh l ki kj">fswatch -o $HOME/.zshrc $HOME/.zsh/ | xargs -n1 -I{} echo "file changed"</span></pre><p id="4f56" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">基本上，每当你改变<code class="du js jt ju jv b">.zshrc</code>或<code class="du js jt ju jv b">.zsh/</code>文件夹时，这个脚本会在你的终端上打印“文件已改变”。</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/9d7efe902c752a4d2d4146f29c10f777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZSAmafqYwMOeWRJvnMYoIA.png"/></div></div></figure><p id="d7d4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在验证这个脚本如预期的那样工作之后，让我们在<code class="du js jt ju jv b">zsh-backup</code>文件夹中创建一个名为<code class="du js jt ju jv b">sync_zshrc.sh</code>的新文件，并将上面的脚本复制到这个新文件中。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="3965" class="ke kf hi jv b fi kg kh l ki kj">touch sync_zshrc.sh</span></pre><p id="18a0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是该文件的内容:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="3dc7" class="ke kf hi jv b fi kg kh l ki kj">#!/bin/zsh</span><span id="0303" class="ke kf hi jv b fi mp kh l ki kj">fswatch -o $HOME/.zshrc $HOME/.zsh/ | xargs -n1 -I{} echo "file changed"</span></pre><p id="b821" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">使脚本可执行:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="fd26" class="ke kf hi jv b fi kg kh l ki kj">chmod +x sync_zshrc.sh</span></pre><p id="32dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">记得通过修改你的<code class="du js jt ju jv b">.zshrc</code>再次测试这个脚本，请注意这个脚本稍后会被修改，这不是它的最终版本。</p><p id="aba3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们将第一次提交推送到远程存储库，然后进入下一部分:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="546d" class="ke kf hi jv b fi kg kh l ki kj">git add .<br/>git commit -m "Add script that detects zshrc changes"<br/>git push</span></pre><p id="eb52" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">故障排除:</p><ol class=""><li id="cf1a" class="kk kl hi iw b ix iy jb jc jf km jj kn jn ko jr kz kq kr ks bi translated">请注意<strong class="iw hj"> fswatch </strong>的标志参数，例如<code class="du js jt ju jv b">-o</code>不是<code class="du js jt ju jv b">-0</code>、<code class="du js jt ju jv b">-n1</code>不是<code class="du js jt ju jv b">-n 1</code>、<code class="du js jt ju jv b">-I{}</code>不是<code class="du js jt ju jv b">-I {}</code>。</li><li id="9acc" class="kk kl hi iw b ix kt jb ku jf kv jj kw jn kx jr kz kq kr ks bi translated">如果您得到此错误:<code class="du js jt ju jv b">zsh: command not found: fswatch</code>，请检查<strong class="iw hj"> fswatch </strong>是否安装正确，如果需要，将其添加到<strong class="iw hj"> $PATH </strong>中。</li></ol><h2 id="b70a" class="ke kf hi bd lb lx ly lz lf ma mb mc lj jf md me ln jj mf mg lr jn mh mi lv mj bi translated">编写一个脚本，将新的更改推送到远程存储库</h2><p id="e83a" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">这个脚本基本上只是将<code class="du js jt ju jv b">.zshrc</code>和<code class="du js jt ju jv b">zsh/</code>的内容复制到<code class="du js jt ju jv b">zsh-backup</code>文件夹中，然后将它们推送到远程存储库。我把它命名为<code class="du js jt ju jv b">commit_changes.sh</code></p><p id="98ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是脚本:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="6947" class="ke kf hi jv b fi kg kh l ki kj">#!/bin/zsh</span><span id="7817" class="ke kf hi jv b fi mp kh l ki kj">cd `dirname "$0"`</span><span id="98e9" class="ke kf hi jv b fi mp kh l ki kj">cp $HOME/.zshrc .<br/>cp -R $HOME/.zsh .</span><span id="3169" class="ke kf hi jv b fi mp kh l ki kj">git add --all<br/>git commit -m "Sync zsh configs"<br/>git push origin</span></pre><p id="d236" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我需要使用<code class="du js jt ju jv b">cd `dirname "$0"`</code>的原因是我们可能会在<code class="du js jt ju jv b">zsh-backup</code>文件夹之外执行脚本，因此我们可能会将文件复制到错误的位置，使用<code class="du js jt ju jv b">dirname</code>将确保您将它们复制到与<code class="du js jt ju jv b">commit_changes.sh</code>脚本相同的目录。</p><p id="337d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">记住要使这个脚本可执行:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="c189" class="ke kf hi jv b fi kg kh l ki kj">chmod +x commit_changes.sh</span></pre><p id="1bff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请运行脚本来验证其功能:)。</p><h2 id="5fdb" class="ke kf hi bd lb lx ly lz lf ma mb mc lj jf md me ln jj mf mg lr jn mh mi lv mj bi translated">连接脚本</h2><p id="9e2f" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">现在，我们已经分离出可以正常工作的脚本。下一步是连接它们。</p><p id="50ed" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们修改<code class="du js jt ju jv b">sync_zshrc.sh</code>以在有新变化时执行<code class="du js jt ju jv b">commit_changes.sh</code>。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="75b0" class="ke kf hi jv b fi kg kh l ki kj">#!/bin/zsh</span><span id="6a1e" class="ke kf hi jv b fi mp kh l ki kj">DIR_PATH=`dirname "$0"`</span><span id="fe7b" class="ke kf hi jv b fi mp kh l ki kj">fswatch -o $HOME/.zshrc $HOME/.zsh/ | xargs -n1 zsh $DIR_PATH/commit_changes.sh</span></pre><p id="988d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因为我将两个脚本放在同一个目录中，所以我使用<code class="du js jt ju jv b">dirname "$0"</code>来获取包含<code class="du js jt ju jv b">commit_changes.sh</code>的目录的绝对路径。如果您将它们存储在不同的位置，您必须替换路径。</p><p id="f970" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我还删除了<code class="du js jt ju jv b">fswatch</code>脚本中的<code class="du js jt ju jv b">-I{}</code>参数，因为它已经没有必要了。</p><p id="208f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请再次使用<code class="du js jt ju jv b">./sync_zshrc.sh</code>启动脚本，更改<code class="du js jt ju jv b">.zshrc</code>文件的内容，并检查远程存储库，查看是否有新的提交。</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/8baa4278fcbc70369313343c058eb8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPEmvFkdj-n-YkVi9MPOFA.png"/></div></div></figure><h2 id="6826" class="ke kf hi bd lb lx ly lz lf ma mb mc lj jf md me ln jj mf mg lr jn mh mi lv mj bi translated">让脚本在 macOS 中作为服务运行</h2><p id="0c17" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">我们必须让脚本在后台模式下运行，并且它们必须在我们重启机器时自动启动。为了在 macOS 中实现这一点，我们必须使用<a class="ae ky" href="https://support.apple.com/en-vn/guide/terminal/apdc6c1077b-5d5d-4d35-9c19-60f2397b2369/mac" rel="noopener ugc nofollow" target="_blank"> launchd </a>。</p><p id="577f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以阅读<a class="ae ky" rel="noopener" href="/swlh/how-to-use-launchd-to-run-services-in-macos-b972ed1e352">这篇文章</a>来了解更多关于 launchd 以及如何使用它的信息，但总的来说，因为我们必须使用 git 命令，这些命令需要凭据才能推送到远程存储库，而 ZSH 运行配置是特定于每个用户的，所以我们应该使用用户代理来运行登录用户行为上的服务。</p><p id="e796" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Launchd 使用属性列表(<strong class="iw hj">)。plist </strong>)文件，这对于使用 macOS 定义服务/作业的开发人员来说是非常熟悉的(您可以随意调用它:)。所以让我们在我们的<code class="du js jt ju jv b">zsh-backup</code>目录中创建它。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="dd42" class="ke kf hi jv b fi kg kh l ki kj">touch com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist</span></pre><p id="68b9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你必须用当前用户名替换<code class="du js jt ju jv b">your-username</code>。实际上，你可以为文件使用任何名称，但是遵循苹果的命名惯例更好，因为我们是工程师，遵循惯例是我们工作的一部分，对吗？😅</p><p id="69ba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下面是我<strong class="iw hj">的内容。plist </strong>文件:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="56e3" class="ke kf hi jv b fi kg kh l ki kj">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "<a class="ae ky" href="http://www.apple.com/DTDs/PropertyList-1.0.dtd" rel="noopener ugc nofollow" target="_blank">http://www.apple.com/DTDs/PropertyList-1.0.dtd</a>"&gt;<br/>&lt;plist version="1.0"&gt;<br/>    &lt;dict&gt;<br/>        &lt;key&gt;Label&lt;/key&gt;<br/>        &lt;string&gt;<strong class="jv hj">com.imbaggaarm.auto-sync-zshrc</strong>&lt;/string&gt;<br/>        &lt;key&gt;ServiceDescription&lt;/key&gt;<br/>        &lt;string&gt;Auto sync zsh configs to git repository&lt;/string&gt;<br/>        &lt;key&gt;ProgramArguments&lt;/key&gt;<br/>        &lt;array&gt;<br/>            &lt;string&gt;zsh&lt;/string&gt;<br/>            &lt;string&gt;-c&lt;/string&gt;<br/>            &lt;string&gt;<strong class="jv hj">/Users/eastagile/code/zsh-backup/sync_zshrc.sh</strong>&lt;/string&gt;<br/>        &lt;/array&gt;<br/>        &lt;key&gt;StandardOutPath&lt;/key&gt;<br/>        &lt;string&gt;<strong class="jv hj">/Users/eastagile/tmp/com.imbaggaarm.sync-zshrc.stdout</strong>&lt;/string&gt;<br/>        &lt;key&gt;StandardErrorPath&lt;/key&gt;<br/>        &lt;string&gt;<strong class="jv hj">/Users/eastagile/tmp/com.imbaggaarm.sync-zshrc.stderr</strong>&lt;/string&gt;<br/>        &lt;key&gt;WorkingDirectory&lt;/key&gt;<br/>        &lt;string&gt;<strong class="jv hj">/Users/eastagile/code/zsh-backup</strong>&lt;/string&gt;<br/>        &lt;key&gt;KeepAlive&lt;/key&gt;<br/>        &lt;true/&gt;<br/>     &lt;/dict&gt;<br/>  &lt;/plist&gt;</span></pre><p id="01f2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以看到，我使用了<strong class="iw hj"> KeepAlive </strong>选项，因为我希望我们的脚本即使在结束或崩溃时也能继续运行。</p><p id="8956" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你必须在你的机器中用正确的值替换粗体文本。对于<strong class="iw hj">standardeoutpath</strong>和<strong class="iw hj">standardeerrorpath，</strong> Launchd 会将日志写入这些文件，稍后您可以在那里查看<code class="du js jt ju jv b">error</code>日志和<code class="du js jt ju jv b">info</code>日志。你可以使用任何你想要的位置，<strong class="iw hj">但是请记住</strong>来确保登录的用户<strong class="iw hj">有足够的权限</strong>来写那个位置。</p><p id="c283" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有了文件后，你必须把它复制到<code class="du js jt ju jv b">~/Library/LaunchAgents</code>，这个目录是我们存储所有服务配置的地方，这些服务将在登录用户的行为下运行。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="34e4" class="ke kf hi jv b fi kg kh l ki kj">cp com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist ~/Library/LaunchAgents</span></pre><p id="2836" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们导航到<code class="du js jt ju jv b">~/Library/LaunchAgents</code>，它现在应该包含我们的配置文件。</p><p id="7833" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们使用<code class="du js jt ju jv b">launchctl load</code>命令来启动我们的服务，请导航到<code class="du js jt ju jv b">~/Library/LaunchAgents</code>并运行:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="3452" class="ke kf hi jv b fi kg kh l ki kj">launchctl load com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist</span></pre><p id="eed4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果得到<code class="du js jt ju jv b">Load failed: 5: Input/output error</code>，请检查<strong class="iw hj">。plist </strong>文件格式正确，并且您位于正确的目录中。</p><p id="4a4b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">调用这个之后，您应该检查位于<strong class="iw hj"> StandardErrorPath </strong>的文件，看看是否有错误。您也可以使用<code class="du js jt ju jv b">launchctl list</code>来检查您的服务状态。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="d8da" class="ke kf hi jv b fi kg kh l ki kj">launchctl list | grep auto-sync-zshrc</span></pre><p id="2044" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果状态是<code class="du js jt ju jv b">0</code>并且 PID 值不为空，那么恭喜你，你的脚本现在运行正常了。但是如果你看到其他值，或者甚至没有结果，很可能是你的脚本有问题。</p><p id="5bfb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于我们的脚本，您可能会遇到这个错误: <code class="du js jt ju jv b">command not found: fswatch</code>。请用这个来查看错误:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="6378" class="ke kf hi jv b fi kg kh l ki kj">cat &lt;your-path&gt;/com.&lt;your-username&gt;.sync-zshrc.stderr</span></pre><p id="f7c8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你得到这个但是你已经安装了<code class="du js jt ju jv b">launchctl</code>，你必须修改<code class="du js jt ju jv b">sync_zshrc.sh</code>文件:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="631f" class="ke kf hi jv b fi kg kh l ki kj">#!/bin/zsh</span><span id="9315" class="ke kf hi jv b fi mp kh l ki kj">DIR_PATH=`dirname "$0"`</span><span id="4cf5" class="ke kf hi jv b fi mp kh l ki kj"><strong class="jv hj">/opt/homebrew/bin/fswatch</strong> -o $HOME/.zshrc $HOME/.zsh/ | xargs -n1 zsh $DIR_PATH/commit_changes.sh</span></pre><p id="a25f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我把<code class="du js jt ju jv b">fswatch</code> <strong class="iw hj"> </strong>改成了<code class="du js jt ju jv b">/opt/homebrew/bin/fswatch</code> <strong class="iw hj"> </strong>，因为<strong class="iw hj">launch</strong>找不到二进制，也许还有其他的解决方案，但这是我拥有的最简单的解决方案。你<strong class="iw hj">要用你机器里的值替换</strong>这个路径，你可以用<code class="du js jt ju jv b">which fswatch</code>得到它。</p><p id="f725" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">修改并保存属性列表后。您应该使用<code class="du js jt ju jv b">launchctl unload</code>来停止服务:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="b808" class="ke kf hi jv b fi kg kh l ki kj">launchctl unload com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist</span></pre><p id="327b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后重新启动它:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="f3ea" class="ke kf hi jv b fi kg kh l ki kj">launchctl load com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist</span></pre><p id="902d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有一个 GUI 应用程序用于检查 LaunchControl 的<strong class="iw hj"> launchd </strong>服务。要安装它，你可以使用家酿桶:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="507b" class="ke kf hi jv b fi kg kh l ki kj">brew --cask install launchcontrol</span></pre><p id="cd8c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下是该应用程序的截图:</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/1296d3c0b947fd080c9efbd6f555ea9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3580JiwnuCohyZCv3BG5fQ.png"/></div></div></figure><p id="6afe" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你遇到任何错误，我建议你使用这个应用程序。</p><p id="46c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">是的，如果你看到所有的字段都是绿色的，就像我的截图一样，那么你的脚本工作正常(记得选择 LaunchControl 应用程序左上角按钮中的<strong class="iw hj"> UserAgents </strong>)。</p><p id="daff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您应该更改您的<code class="du js jt ju jv b">~/.zshrc</code>或<code class="du js jt ju jv b">~/.zsh</code>并检查您的远程存储库，所有配置都已同步。</p><p id="b985" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">毕竟，你的<code class="du js jt ju jv b">zsh-backup</code>应该有这样的结构:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="b085" class="ke kf hi jv b fi kg kh l ki kj">➜  zsh-backup git:(master) tree -a -L 1<br/>.<br/>├── .git<br/>├── .zsh<br/>├── .zshrc<br/>├── com.<strong class="jv hj">&lt;your-username&gt;</strong>.auto-sync-zshrc.plist<br/>├── commit_changes.sh<br/>└── sync_zshrc.sh</span></pre><p id="a88f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可能需要用自制软件安装<code class="du js jt ju jv b">tree</code>:<code class="du js jt ju jv b">brew install tree</code>。</p><p id="f08f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您的提交历史如下所示:</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/8d92ff5a0bcdf730c1a9d3301cec8819.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WH9UOCVBDdG-zQMeGR_IMA.png"/></div></div></figure><h1 id="4015" class="la kf hi bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结局</h1><p id="9552" class="pw-post-body-paragraph iu iv hi iw b ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr hb bi translated">正如我上面提到的，我在 Github 上传了脚本和快速入门指南，你可以看看:<a class="ae ky" href="https://github.com/imbaggaarm/zshrc-auto-sync" rel="noopener ugc nofollow" target="_blank">https://github.com/imbaggaarm/zshrc-auto-sync</a></p><p id="6348" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我希望我的帖子能帮助你组织和备份你的 ZSH 运行配置，这样你就不用处理我遇到的情况了。您也可以使用相同的方法来同步您的 Vim 配置。我认为这将与<code class="du js jt ju jv b">bash</code>一起正常工作，你可能只需要改变文件名，但它可能需要更多的努力才能在其他操作系统上运行，但总的来说，方法是相同的。</p><p id="a4a7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于<strong class="iw hj">令牌、凭证、秘密</strong>，你应该把它们都放在其他文件中，比如<code class="du js jt ju jv b">secrets.zsh</code>(记得把<code class="du js jt ju jv b">source secrets.sh</code>添加到<code class="du js jt ju jv b">.zshrc</code>中)，并且<strong class="iw hj">不要在<code class="du js jt ju jv b">commit_changes.sh</code>脚本中复制它们</strong>或者简单地把那个文件添加到<code class="du js jt ju jv b">.gitignore</code>中。Github 库是私有的，但是我们可能会不小心发布它，或者万一 Github 被黑客攻击，我们的凭证不会被泄露。稍后我将更新脚本，用 Django 处理其秘密变量的相同方式通过<code class="du js jt ju jv b">*</code>屏蔽秘密。</p><p id="267f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后但同样重要的是，如果我将我所有的配置存储在<code class="du js jt ju jv b">~/.zsrhc</code>中，情况可能会更糟，我真的很幸运，但如果我没有仔细组织我的 ZSH 运行配置，这种运气就不会出现。我从公司的一项倡议中受到启发，我们试图通过让能自动运行的东西自动运行来减少工作量，等等。</p><p id="4ecb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望我以后能找到更多有价值的东西来分享，各位，请记住，<strong class="iw hj">管理你的机器就像管理你的代码</strong>一样。</p></div></div>    
</body>
</html>