<html>
<head>
<title>Symfony Form — JsonType</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Symfony表单— JsonType</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/symfony-form-jsontype-ddc7a086ff4e?source=collection_archive---------2-----------------------#2022-02-20">https://medium.com/nerd-for-tech/symfony-form-jsontype-ddc7a086ff4e?source=collection_archive---------2-----------------------#2022-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2278" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">处理Json输入</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/612adf302c483b25e74ddd6d5838ca6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*lNokD9CyGhJ4Lc6P.jpg"/></div></figure><p id="2ab4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jl translated"><span class="l jm jn jo bm jp jq jr js jt di">U</span>T9】se案例</p><p id="7f1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象通过表单(通过前端的编码数组)发送整个<strong class="ih hj"> JSON </strong>的用例:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ju"><img src="../Images/ba7f9bcab34d4aae90532e7f4679577f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/1*kZfawIQ0BkyBKa2Rr32-qg.png"/></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">数据发送和处理</figcaption></figure><p id="0fde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">相关文章</strong> : <a class="ae jz" rel="noopener" href="/nerd-for-tech/vue-js-and-symfony-forms-ba5139f77f5f">在Symfony中处理Vue.js表单</a></p><p id="72db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jl translated"><span class="l jm jn jo bm jp jq jr js jt di">T</span>T19】何一期</p><p id="6820" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Symfony </strong>表单处理程序允许使用不同的输入类型，如<code class="du ka kb kc kd b"><em class="ke">TextType</em></code>、<code class="du ka kb kc kd b"><em class="ke">ArrayChoiceList</em></code>、<code class="du ka kb kc kd b"><em class="ke">ChoiceType</em></code>等。当使用基于类型的<code class="du ka kb kc kd b"><em class="ke">Array</em></code>时，结果是一个空数组。唯一的一个工作案例是<code class="du ka kb kc kd b"><em class="ke">TextType</em></code>,但是它仍然只产生原始的JSON——但是这不是我们想要的结果。</p><p id="135e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jl translated"><span class="l jm jn jo bm jp jq jr js jt di"> J </span> <strong class="ih hj"> sonType </strong></p><p id="1a59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">经过一番努力，我找到的唯一可行的解决方案是提供新的输入类型(<code class="du ka kb kc kd b">JsonType</code>)和新的<code class="du ka kb kc kd b">DataTransformer</code>，就像这样:</p><p id="3fb1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据转换器</strong></p><pre class="je jf jg jh fd kf kd kg kh aw ki bi"><span id="3663" class="kj kk hi kd b fi kl km l kn ko"><em class="ke">&lt;?php<br/><br/>namespace </em>App\Form\DataTransformer;<br/><br/><em class="ke">use </em>Symfony\Component\Form\DataTransformerInterface;<br/><br/><em class="ke">/**<br/> * Handles transforming json to array and backward<br/> */<br/>class </em>JsonTransformer <em class="ke">implements </em>DataTransformerInterface<br/>{<br/><br/>    <em class="ke">/**<br/>     * </em><strong class="kd hj"><em class="ke">@inheritDoc<br/>     </em></strong><em class="ke">*/<br/>    public function </em>reverseTransform($value): <em class="ke">mixed<br/>    </em>{<br/>        <em class="ke">if </em>(<em class="ke">empty</em>($value)) {<br/>            <em class="ke">return </em>[];<br/>        }<br/><br/>        <em class="ke">return json_decode</em>($value);<br/>    }<br/><br/>    <em class="ke">/**<br/>     * </em><strong class="kd hj"><em class="ke">@ihneritdoc<br/>     </em></strong><em class="ke">*/<br/>    public function </em>transform($value): <em class="ke">mixed<br/>    </em>{<br/>        <em class="ke">if </em>(<em class="ke">empty</em>($value)) {<br/>            <em class="ke">return json_encode</em>([]);<br/>        }<br/><br/>        <em class="ke">return json_encode</em>($value);<br/>    }<br/>}</span></pre><p id="66b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> JsonType </strong></p><pre class="je jf jg jh fd kf kd kg kh aw ki bi"><span id="150e" class="kj kk hi kd b fi kl km l kn ko"><em class="ke">&lt;?php<br/><br/>namespace </em>App\Form\Type;<br/><br/><em class="ke">use </em>App\Form\DataTransformer\JsonTransformer;<br/><em class="ke">use </em>Symfony\Component\Form\AbstractType;<br/><em class="ke">use </em>Symfony\Component\Form\Extension\Core\Type\TextType;<br/><em class="ke">use </em>Symfony\Component\Form\FormBuilderInterface;<br/><em class="ke">use </em>Symfony\Component\Serializer\SerializerInterface;<br/><br/><em class="ke">/**<br/> * Handles json based input (for example multiselect tag)<br/> * Will only transform the json to array (and back),<br/> *<br/> * If necessary, could probably accept custom options (className) which would be used to<br/> * transform the data into given class via {</em><strong class="kd hj"><em class="ke">@see </em></strong><em class="ke">SerializerInterface}<br/> */<br/>class </em>JsonType <em class="ke">extends </em>AbstractType<br/>{<br/>    <em class="ke">/**<br/>     * </em><strong class="kd hj"><em class="ke">@inheritDoc<br/>     </em></strong><em class="ke">*/<br/>    public function </em>getParent(): <em class="ke">string<br/>    </em>{<br/>        <em class="ke">return </em>TextType::<em class="ke">class</em>;<br/>    }<br/><br/>    <em class="ke">/**<br/>     * </em><strong class="kd hj"><em class="ke">@inheritDoc<br/>     </em></strong><em class="ke">*/<br/>    public function </em>buildForm(FormBuilderInterface $builder, <em class="ke">array </em>$options): <em class="ke">void<br/>    </em>{<br/>        $builder-&gt;addModelTransformer(<em class="ke">new </em>JsonTransformer());<br/>    }<br/>}</span></pre><p id="68ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总结</strong></p><p id="ccbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最终结果是一个从json转换而来的数组。</p></div></div>    
</body>
</html>