<html>
<head>
<title>Nulls and null checks — How to work safely with nulls in any codebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">空值和空值检查——如何在任何代码库中安全地使用空值</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/nulls-and-null-checks-how-to-work-safely-with-nulls-in-any-codebase-de9ddc592efe?source=collection_archive---------17-----------------------#2021-07-26">https://medium.com/nerd-for-tech/nulls-and-null-checks-how-to-work-safely-with-nulls-in-any-codebase-de9ddc592efe?source=collection_archive---------17-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9320388ec9da982bf80251dea54c54dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TtV8pVtbdlUdbPtb-r2Fww.jpeg"/></div></div></figure><p id="819e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://programmingduck.com/articles/clean-code" rel="noopener ugc nofollow" target="_blank">干净代码</a>的一个重要部分是正确处理空值。</p><p id="7519" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几十年来，空值一直是编程中一个棘手的问题。</p><p id="5be9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">发明者东尼·霍尔甚至称之为一个十亿美元的错误。</p><p id="2ef5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从语义上讲，空值是必要的。它们代表了价值的缺失。例如，用户可以填写具有可选字段的表单。他们可以将可选字段留空。这是空值的一个原因。</p><p id="f2da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">问题是空值很难处理和跟踪。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><h1 id="3f76" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">空值的问题是</h1><p id="c0cd" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">在代码库中很难跟踪空值。有许多事情:</p><ul class=""><li id="6c6b" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">具有属性为<code class="du jp jq jr js b">null</code></li><li id="a624" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">可以返回<code class="du jp jq jr js b">null</code></li><li id="1f89" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">做某事前需要检查<code class="du jp jq jr js b">null</code></li></ul><p id="431c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你错过了一个“空检查”，你就有一个bug。你的程序可能会出错，甚至崩溃。</p><p id="dfff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，如果您忘记先检查<code class="du jp jq jr js b">null</code>，下面的代码会崩溃:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="d258" class="lu ka hi js b fi lv lw l lx ly">// this function crashes if the argument is null<br/>function foo(arrayOrNull) {<br/>  return arrayOrNull[0];<br/>}</span></pre><p id="8efb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码应该是这样的:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="8bdb" class="lu ka hi js b fi lv lw l lx ly">function foo(arrayOrNull) {<br/>  if (arrayOrNull === null) {<br/>    return null;<br/>  }<br/>  return arrayOrNull[0];<br/>}</span></pre><p id="5974" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">问题是100%彻底地检查你的空支票是非常困难的。跟踪每一个空值即使不是不可能，也是极其困难的。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/5c8941b658de2a8abad3395ba394953d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pDpQfTDjYQJprH4D.jpg"/></div></div></figure><h1 id="2f50" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">处理空值的解决方案</h1><p id="e4cd" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">使用空值很困难。为了使事情变得简单，这里有一些你可以使用的可能的解决方案。有些是坏的，有些是好的。我们会逐一检查。</p><p id="c929" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解决方案是:</p><ul class=""><li id="d56f" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">对周围的一切进行检查</li><li id="a658" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">使用try / catch代替空检查</li><li id="5cc7" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">返回默认值，而不是<code class="du jp jq jr js b">null</code></li><li id="1be3" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">使用空对象模式</li><li id="e1cc" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">记得检查每个空值</li><li id="3974" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">使用一个强制你检查每一个<code class="du jp jq jr js b">null</code>的类型系统</li><li id="1bae" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">使用类似选项类型的东西</li></ul><p id="01c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下是每一项的详细信息:</p><h1 id="4dcf" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">在每件事情周围放置一个空检查</h1><p id="3b5a" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">处理空值的一个解决方案是总是检查它们，即使在你不需要的时候。勾选“以防万一”。毕竟“拥有它而不需要它，总比需要它而不拥有它要好。”乔治·埃利斯。对吗？</p><p id="63d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果这是你确保不遗漏空支票的唯一方法，那么也许…</p><p id="4106" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，这不是最佳解决方案。问题是你的代码中的某些东西可能是不应该是<code class="du jp jq jr js b">null</code>的。换句话说，你有一个bug。</p><p id="88e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果您在不需要的地方使用了空检查，您将会默默地忽略这个bug。它将被一张空头支票吞噬。</p><p id="cb80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="a93e" class="lu ka hi js b fi lv lw l lx ly">// car is never supposed to be null<br/>if (car !== null) {<br/>  car.getWheels();<br/>}</span></pre><p id="bad2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中，<code class="du jp jq jr js b">car</code>可能在不应该的时候是<code class="du jp jq jr js b">null</code>。那是一个错误。然而，由于一个不必要的空检查，程序不会崩溃。该错误将被忽略。</p><p id="0a30" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果没有不必要的空检查，程序就会崩溃。</p><p id="ead8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="5df5" class="lu ka hi js b fi lv lw l lx ly">// car is null due to a bug<br/>// the program crashes<br/>car.getWheels();</span></pre><p id="ccde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个很好的场景。正如<a class="ae jo" href="https://programmingduck.com/articles/error-responses" rel="noopener ugc nofollow" target="_blank">如何应对错误</a>中所解释的，最起码，你要知道自己有bug。崩溃清楚地表明了这一点，但是默默忽略bug却没有。</p><p id="30e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">换句话说，您可能应该避免不必要的空检查。</p><p id="7830" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">否则，如果你想做<a class="ae jo" href="https://programmingduck.com/articles/defensive-programming" rel="noopener ugc nofollow" target="_blank">防御性编程</a>，你可以有额外的空检查。然而，如果事情实际上是<code class="du jp jq jr js b">null</code>的话，放入一些记录错误的代码。这样，您可以在以后调试问题。(有关更多信息，请参见<a class="ae jo" href="https://programmingduck.com/articles/error-recording" rel="noopener ugc nofollow" target="_blank">记录错误以便稍后调试</a>。)</p><h1 id="31b6" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使用try / catch代替空检查</h1><p id="6eaf" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">条件vs . try/catch是一场适用于所有可能无效的动作的辩论。为此，在<a class="ae jo" href="https://programmingduck.com/articles/control-flow-invalid-actions" rel="noopener ugc nofollow" target="_blank">无效动作控制流程</a>中有更详细的解释。</p><p id="bc09" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，试/抓解决不了问题。</p><p id="d17d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能会忘记添加try / catch块，就像您可能会忘记空检查一样。在这种情况下，您的程序可能会崩溃。</p><p id="3af6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更糟糕的是，不同的try / catch块可能会无意中捕获到异常。那是一只无声的虫子。无声的错误往往比崩溃更糟糕。</p><h1 id="d981" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">返回默认值而不是null</h1><p id="b067" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">另一种选择是避免返回<code class="du jp jq jr js b">null</code>。相反，返回相关类型的默认值。</p><p id="2c3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，您可能有一个通常返回字符串或空值的函数。返回空字符串，而不是null。或者，您可能有一个通常返回正数或null的函数。不返回null，而是返回0或-1(如果0不是合适的默认值)。</p><h2 id="96b5" class="lu ka hi bd kb ma mb mc kf md me mf kj jb mg mh kn jf mi mj kr jj mk ml kv mm bi translated">默认值的好处</h2><p id="a2ff" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">默认值减少了代码中的空值数量。</p><p id="7396" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在某些情况下，它们也减少了条件句的数量。当您可以以同样的方式对待默认值和“正常”值时，就会发生这种情况。</p><p id="b8be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，无论<code class="du jp jq jr js b">user.name</code>是一个普通的值还是空字符串，这段代码都有效。</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="9fd5" class="lu ka hi js b fi lv lw l lx ly">function printUserGreeting(user) {<br/>  const name = user.name;<br/>  const formattedName = name.toUppercase();<br/>  const greeting = `Hello ${formattedName}`;<br/>  document.body.append(greeting);<br/>}</span></pre><p id="a83e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，如果<code class="du jp jq jr js b">user.name</code>有时是<code class="du jp jq jr js b">null</code>，这个函数需要一个空值检查才能工作。</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="0cc3" class="lu ka hi js b fi lv lw l lx ly">function printUserGreeting(user) {<br/>  const name = user.name;<br/>  if (name === null) { // null check<br/>    document.body.append('Hello');<br/>  } else {<br/>    const formattedName = name.toUppercase();<br/>    const greeting = `Hello ${formattedName}`;<br/>    document.body.append(greeting);<br/>  }<br/>}</span></pre><p id="e312" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">返回默认值可能是好的。然而，也有不利的一面。</p><h2 id="148d" class="lu ka hi bd kb ma mb mc kf md me mf kj jb mg mh kn jf mi mj kr jj mk ml kv mm bi translated">默认值的缺点</h2><p id="19e6" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">一个不利之处是,<code class="du jp jq jr js b">null</code>的语义没有得到尊重。语义上，<code class="du jp jq jr js b">null</code>表示没有值。它并不意味着一个合法的值。相比之下，空字符串或数字0可能是合法的值。0或-1可能是数学计算的结果。空字符串可以是提供给函数的分隔符。它们并不意味着没有数据。</p><p id="1154" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与第一个缺点相关的另一个缺点是，您会丢失关于该值是表示空值还是合法值的信息。有时候区分这两者是很重要的。您不会总是能够以相同的方式使用默认值和正常值。</p><p id="cff3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，考虑JavaScript的<code class="du jp jq jr js b">Array.prototype.indexOf()</code>方法。它返回自然数(0或正整数)，或者-1作为默认值(而不是null)。但是，在大多数情况下，您永远不能使用值-1。您将需要一个条件来查看该方法是返回-1还是一个正常值。这就失去了意义。从您的代码的角度来看，它可能是空的。</p><p id="dfca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="6c56" class="lu ka hi js b fi lv lw l lx ly">function findUser(userArray, targetUser) {<br/>  const index = userArray.indexOf(targetUser);<br/>  if (index === -1) {<br/>    console.log('Sorry, the user could not be found');<br/>  } else {<br/>    console.log(`The target user is user number ${index + 1}`);<br/>  }<br/>}</span></pre><p id="3192" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个缺点是你可能有很多函数。每个可能需要不同的默认值。在这种情况下，您将拥有一个对其中一个有效的默认值，但对其他的无效。然后，其他函数将需要条件来检查默认值。这又一次证明了这一点。这实际上使得代码更难处理。检查<code class="du jp jq jr js b">null</code>比检查“魔力值”更容易。</p><p id="e344" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，还有其他一些缺点:</p><ul class=""><li id="6d6b" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">想出一个默认值可能很困难</li><li id="1232" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">追踪默认值的来源(在代码中)可能很困难</li></ul><h2 id="5959" class="lu ka hi bd kb ma mb mc kf md me mf kj jb mg mh kn jf mi mj kr jj mk ml kv mm bi translated">默认值的判定</h2><p id="ed5c" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">总结:这是一个有用的解决方案。然而，要小心它的缺点。你需要自己判断何时使用这个选项。</p><p id="38c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我个人不太常用。</p><p id="8c75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，一个经常使用的“缺省”值是一个空集合。例如，空数组或空哈希表。这往往有所有的好处，没有缺点。那是因为说“是的，这个东西<em class="mn">有一个集合</em>，它只是<em class="mn">恰好是空的</em>”在语义上是正确的。此外，大多数代码应该能够以与非空集合相同的方式处理空集合。</p><h1 id="a936" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使用空对象模式</h1><p id="6157" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">空对象模式类似于使用默认值(如上所述)。</p><p id="0d84" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不同之处在于，它处理的是类和对象，而不是字符串和数字之类的原始值。它为值(属性)和行为(方法)设置默认值。</p><p id="74fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过创建一个null / empty / default对象来使用null对象模式，该对象具有与普通对象相同的接口。这个对象的属性和方法将有默认值和行为。</p><p id="c669" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，下面是一个普通的<code class="du jp jq jr js b">User</code>类，它可能存在于您的代码库中:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="1e6f" class="lu ka hi js b fi lv lw l lx ly">class User {<br/>  constructor(name, id) {<br/>    this.name = name;<br/>    this.id = id;<br/>  }<br/><br/>  updateName(name) {<br/>    this.name = name;<br/>  }<br/><br/>  doSomething() {<br/>    // code to do something<br/>  }<br/>}</span></pre><p id="bf80" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个你可能拥有的<code class="du jp jq jr js b">NullUser</code>类的例子(一个空对象):</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="9b17" class="lu ka hi js b fi lv lw l lx ly">class NullUser {<br/>  constructor() {<br/>    this.name = 'Guest'; // default value<br/>    this.id = -1; // default value<br/>  }<br/><br/>  updateName() {} // do nothing (default behaviour)<br/><br/>  doSomething() {<br/>    // do nothing, or do some other default behaviour<br/>  }<br/>}</span></pre><p id="892a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">代码中的用法大概是这样的:你可能有一些代码通常会返回<code class="du jp jq jr js b">null</code>或者一个普通的对象。不返回<code class="du jp jq jr js b">null</code>，而是返回空对象。这类似于返回默认值。</p><p id="ae8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，下面的代码有时会返回<code class="du jp jq jr js b">null</code>:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="b2b0" class="lu ka hi js b fi lv lw l lx ly">function findUser(userId) {<br/>  const targetUser = users.find(user =&gt; user.id === userId);<br/>  if (!targetUser) {<br/>    return null;<br/>  }<br/>  return user;<br/>}</span></pre><p id="5f04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">相反，您可以使用以下代码，它返回一个空对象而不是<code class="du jp jq jr js b">null</code>:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="72a8" class="lu ka hi js b fi lv lw l lx ly">function findUser(userId) {<br/>  const targetUser = users.find(user =&gt; user.id === userId);<br/>  if (!targetUser) {<br/>    return new NullUser();<br/>  }<br/>  return user;<br/>}</span></pre><p id="cb34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，无论何时使用空对象或普通对象，都不需要空检查。</p><p id="9b2d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了说明这一点，这里有一些不带的空对象模式的示例代码<strong class="is hj">:</strong></p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="bde8" class="lu ka hi js b fi lv lw l lx ly">// class User is shown above<br/><br/>const users = [new User('Bob', 0), new User('Alice', 1)];<br/><br/>function findUser(userId) {<br/>  const targetUser = users.find(user =&gt; user.id === userId);<br/>  if (!targetUser) {<br/>    return null;<br/>  }<br/>  return user;<br/>}<br/><br/>function printName(user) {<br/>  if (user === null) { // null check here<br/>    document.body.append(`Hello Guest`);<br/>  } else {<br/>    document.body.append(`Hello ${user.name}`);<br/>  }<br/>}<br/><br/>function main() {<br/>  const user = findUser(123);<br/>  printName(user);<br/>}</span></pre><p id="aeb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是相同的代码，只是它使用了空对象模式:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="fc5a" class="lu ka hi js b fi lv lw l lx ly">// classes User and NullUser are shown above<br/><br/>const users = [new User('Bob', 0), new User('Alice', 1)];<br/><br/>function findUser(userId) {<br/>  const targetUser = users.find(user =&gt; user.id === userId);<br/>  if (!targetUser) {<br/>    return new NullUser(); // instead of returning null, return a null object<br/>  }<br/>  return user;<br/>}<br/><br/>function printName(user) {<br/>  // no null check<br/>  document.body.append(`Hello ${user.name}`);<br/>}<br/><br/>function main() {<br/>  const user = findUser(123);<br/>  printName(user);<br/>}</span></pre><p id="661d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">至于是否使用空对象模式，与默认值类似。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/3cc44543f5c0f52d495dd793077a5a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Gw3iSdZ2BMUNZf0P.jpg"/></div></div></figure><h1 id="ed41" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">记得检查每个空值</h1><p id="01ac" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">彻底检查你的所有检查的一个方法是…彻底检查你的所有检查…</p><p id="9f0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每次你写代码的时候，都要非常小心你的空检查。你应该明白<code class="du jp jq jr js b">null</code>可以出现在哪里，不应该出现在哪里(哪里会是bug)。</p><p id="43ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是非常困难的。有时候可能感觉不可能。但是，如果你不使用其他解决方案，这是你必须做的。</p><h1 id="fe96" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使用强制空检查的类型系统</h1><p id="04ae" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">拯救打字系统。一些编程语言，比如带有<code class="du jp jq jr js b">strictNullChecks</code>选项的TypeScript，能够理解什么时候某个东西可能是<code class="du jp jq jr js b">null</code>。然后，他们强迫你检查。</p><p id="234c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个例子是C#及其可空的引用类型。这些警告你检查(他们不强迫你)，但是那仍然是有帮助的。</p><p id="3e22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这意味着你永远不能忘记检查<code class="du jp jq jr js b">null</code>。</p><p id="6fee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我个人认为这是一个很好的选择。</p><h1 id="fb0d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使用选项类型</h1><p id="d209" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">最后一个选项(没有双关的意思)是使用类似选项类型的东西(也称为可能类型)。</p><p id="513f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这并没有完全消除空检查。但是，它减少了很多。此外，剩下的几个空检查位于易于使用的地方。很难忘记把它们放进去。</p><p id="1916" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用选项类型，您有两个空支票，而不是无数个空支票。</p><p id="3a4d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">空支票位于:</p><ol class=""><li id="a2d8" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn mo li lj lk bi translated">选项类型本身</li><li id="ac27" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn mo li lj lk bi translated">第一个返回选项类型的函数</li></ol><p id="3e10" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是选项类型的一个(非常)简化的实现:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="fcee" class="lu ka hi js b fi lv lw l lx ly">class Option {<br/>  constructor(nullOrNormalValue) {<br/>    this._value = nullOrNormalValue;<br/>  }<br/><br/>  map(fn) {<br/>    if (this._value === null) {<br/>      return this;<br/>    }<br/>    const newValue = fn(this._value);<br/>    return new Option(newValue);<br/>  }<br/>}</span></pre><p id="7d69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要对选项类型做些什么，您可以使用<code class="du jp jq jr js b">map</code>方法并传入一个函数。如果您曾经对数组等使用过<code class="du jp jq jr js b">map</code>函数，这应该很熟悉。</p><p id="0544" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里的关键点是空检查在选项类型内部。换句话说，每次你试图使用这个值时，你都会得到一张免费的空支票。这意味着，只要您使用选项类型，就永远不会忘记您的空检查。</p><p id="d301" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在你第一次返回一个选项的地方，你还需要一个空检查，或者其他一些条件。</p><p id="5b99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，下面是一个通常会返回null或正常值的普通函数:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="bef5" class="lu ka hi js b fi lv lw l lx ly">function getNextScheduledEvent(user) {<br/>  if (user.scheduledEvents.length === 0) {<br/>    return null;<br/>  }<br/>  return user.scheduledEvents[0];<br/>}</span></pre><p id="57be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是同一个函数，但是现在，它返回一个选项。</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="635e" class="lu ka hi js b fi lv lw l lx ly">function getNextScheduledEvent(user) {<br/>  if (user.scheduledEvents.length === 0) {<br/>    return new Option(null);<br/>  }<br/>  return new Option(user.scheduledEvents[0]);<br/>}</span></pre><p id="4358" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编写完这段代码后，您不再需要对返回值进行任何空检查。</p><p id="1f92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，下面是不带选项的代码:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="7758" class="lu ka hi js b fi lv lw l lx ly">function getNextScheduledEvent(user) {<br/>  if (user.scheduledEvents.length === 0) {<br/>    return null;<br/>  }<br/>  return user.scheduledEvents[0];<br/>}<br/><br/>function foo(nextScheduledEvent) {<br/>  if (nextSceduledEvent === null) { // null check<br/>    // do nothing<br/>  } else {<br/>    // stuff<br/>  }<br/>}<br/><br/>function bar(nextScheduledEvent) {<br/>  if (nextSceduledEvent === null) { // null check<br/>    // do nothing<br/>  } else {<br/>    // stuff<br/>  }<br/>}<br/><br/>function baz(nextScheduledEvent) {<br/>  if (nextSceduledEvent === null) { // null check<br/>    // do nothing<br/>  } else {<br/>    // stuff<br/>  }<br/>}<br/><br/>function main() {<br/>  const user = {scheduledEvents: []}<br/>  const nextEventOption = getNextScheduledEvent(user);<br/>  const a = foo(nextScheduledEvent);<br/>  const b = bar(nextScheduledEvent);<br/>  const c = baz(nextScheduledEvent);<br/>}</span></pre><p id="f4be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意，每个函数都需要一个空检查。</p><p id="c1ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是使用选项的相同代码:</p><pre class="jt ju jv jw fd lq js lr ls aw lt bi"><span id="ebf5" class="lu ka hi js b fi lv lw l lx ly">function getNextScheduledEvent(user) {<br/>  if (user.scheduledEvents.length === 0) {<br/>    return new Option();<br/>  }<br/>  return new Option(user.scheduledEvents[0]);<br/>}<br/><br/>function doubleEventPrice(event) {<br/>  // no null check<br/>  return {<br/>    ...event,<br/>    price: event * 2,<br/>  }<br/>}<br/><br/>function foo(event) {<br/>  // stuff, no null check<br/>}<br/><br/>function bar(event) {<br/>  // stuff, no null check<br/>}<br/><br/>function main() {<br/>  const user = {scheduledEvents: []}<br/>  const nextEventOption = getNextScheduledEvent(user);<br/>  const a = nextEventOption.map(doubleEventPrice);<br/>  const b = nextEventOption.map(foo);<br/>  const c = nextEventOption.map(bar);<br/>}</span></pre><p id="34d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意缺少空检查。</p><p id="ef59" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然，这是一个非常简化的解释。使用选项类型的意义远不止于此。选项的实际实现也将更加复杂。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/f93b366df1910c3b07249abd02344c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*TvtjbQVWy2yH10MZ.jpg"/></div></div></figure><h1 id="5fec" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">您应该使用哪个选项？</h1><p id="98d9" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">我们讨论了很多处理空值的方法。</p><p id="4693" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为您的代码库选择合适的代码取决于您。你需要权衡各自的利弊。你还需要考虑你的喜好。</p><p id="ae8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就个人而言，我喜欢类型系统强制空检查。除此之外，我有时可能会使用默认值或空对象模式。截至本文撰写之时，我还没怎么用过期权类型。然而，许多人对那一个充满热情。这似乎是一个很好的解决方案。</p><p id="6a61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你愿意，可以在下面留下你推荐的方法和原因的评论。</p><h1 id="b03a" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">最终注释</h1><p id="0c3d" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">所以这就是这篇文章。我希望你觉得有用。</p><p id="57bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一如既往，如果有任何遗漏，或者有任何异议，或者有任何意见或反馈，请在下面留下您的评论。</p><p id="558f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好的，谢谢，下次见。</p><h1 id="b3d4" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">信用</h1><p id="f035" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">图像制作者名单:</p><ul class=""><li id="db9b" class="lc ld hi is b it iu ix iy jb le jf lf jj lg jn lh li lj lk bi translated">单个盒子Christopher Bill在Unsplash上的照片</li><li id="0c72" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">两个盒子——照片由Pexels的Karolina Grabowska拍摄</li><li id="6c59" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">便笺——由AbsolutVision在Unsplash上拍摄的照片</li><li id="f1ff" class="lc ld hi is b it ll ix lm jb ln jf lo jj lp jn lh li lj lk bi translated">指向笔记本电脑——照片由约翰·施诺布里奇在Unsplash上拍摄</li></ul></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><p id="40ed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mn">原载于2021年7月26日</em><a class="ae jo" href="https://programmingduck.com/articles/nulls" rel="noopener ugc nofollow" target="_blank"><em class="mn">【https://programmingduck.com】</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>