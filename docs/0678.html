<html>
<head>
<title>Testing with UIKit — What is the right approach?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用UIKit测试——什么是正确的方法？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/testing-with-uikit-what-is-the-right-approach-5e9834f28d0c?source=collection_archive---------3-----------------------#2021-02-03">https://medium.com/nerd-for-tech/testing-with-uikit-what-is-the-right-approach-5e9834f28d0c?source=collection_archive---------3-----------------------#2021-02-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2c24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在进入正题之前，我想喝杯咖啡，回忆一下我们的老朋友:UIKit。SwiftUI的优势相当明显，性能更好，UI代码更干净，更容易理解但仍然不够可靠，不足以说服所有人。更不用说大多数项目通常从低于13的iOS版本开始，所以，不管喜欢与否，UIKit在未来几年内仍然会伴随着我们。所以今天，我将通过围绕这个旧框架讨论与测试相关的问题来回顾它</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c87de97de18929253b774bb043abec98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7PvxHkN3IS9IwsWVTQYUgg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">图片鸣谢:<a class="ae jt" href="https://unsplash.com/@timbennettcreative" rel="noopener ugc nofollow" target="_blank"> @timbennettcreative </a></figcaption></figure><h1 id="04a5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">困难和没有标准的方法</h1><p id="115e" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">UIKit是一种苹果的内置框架，我们无法控制它。我们几乎不知道它是如何工作的，不得不相信它。听起来熟悉吗？是的，听起来我在谈论第三方框架。对于这些类型的框架，我们通常会感到困惑，不知道如何测试这一点。</p><p id="8397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我见过最多的流行方法是快照测试。这意味着我们要确保UI如我们所期望的那样出现，或者检查流程是否正确。但这就足够了吗？另一个问题是，有时我们甚至会迷失在框架测试中——这不是我们的工作。</p><p id="63f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，网上还有很多关于应该用什么设计模式来代替MVC的文章、教程和争论。他们可能是MVVM，MVP，或者毒蛇等等。但他们中的大多数都缺少最重要的部分，测试，而且令人痛苦的是，没有人关心这个问题。显然，我们——iOS开发者，遗漏了一些东西。</p><h1 id="bd8d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">行为测试方法</h1><p id="d12c" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">以下是我在接近UIKit测试时的一些经验和知识。除了快照测试之外，我们可以在将实现注入这个框架时测试它们。那就是所谓的<strong class="ih hj"> <em class="kx">行为测试</em> </strong>。我们应该<strong class="ih hj"> <em class="kx">测试与框架</em> </strong>的交互，而不是测试框架如何工作。例如，<br/> -我们不测试:如果viewDidLoad实际上被调用❌ <br/> -我们应该测试:当框架告诉我们视图被加载✅时，我们要做什么</p><p id="5df5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种方法非常困难，需要花费大量的时间和精力。为什么？因为我们要比别人学得更多——不仅是它在生产上的API，还有测试阶段对应的交互方法。通常，这些方法是我们很少使用的。</p><p id="9dc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如:<br/> -我们希望在视图加载后向服务器发送一个请求- &gt; viewDidLoad() <br/> -我们需要一种方法在任务完成时获得这个信号——所以我们必须知道:loadViewIfNeeded()</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="413c" class="ld jv hi kz b fi le lf l lg lh">func test_doSomething_afterViewDidLoadGetsCalled() {<br/>  let myService = Service()  <br/>  let sut = MyViewController(service: myService)<br/>  sut.loadViewIfNeeded()<br/>  XCAssertEqual(myService.callCount, 1)<br/>}</span></pre><p id="e789" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个例子，当我想在拉至刷新后测试我的行为特性时，我需要了解更多信息，而不仅仅是产品代码。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="b184" class="ld jv hi kz b fi le lf l lg lh">refreshControl?.allTargets.forEach { target in<br/>  refreshControl?.actions(forTarget: target,<br/>                          forControlEvent: .valueChanged)?.forEach {<br/>                  (target as NSObject).perform(Selector($0))<br/>                 }<br/>  }</span></pre><h1 id="ddb0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">命名约定</h1><p id="59b5" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">最后但同样重要的是，命名惯例。有时候，你需要以一种通用的方式命名一个函数或者一段代码，或者它可以在更高的层次上显示用户的行为，而不是一个非常具体的名称。这将把测试部分与实现细节分开。</p><p id="e02a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，要知道用户的出生日期，我们有两个选项，<em class="kx">日期选择器</em>或<em class="kx">用户手动填写文本字段</em>。所以我们不应该像<br/>-<em class="kx">SUT . selectfromdatepicker</em>或者<em class="kx">SUT . getvaluefromtextfield</em>❌<br/>-我们应该命名:<strong class="ih hj"><em class="kx">SUT . simulateusergetsdateofbirthvalue</em></strong>✅</p><p id="d849" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而<strong class="ih hj"><em class="kx">simulateUserGetsDateOfBirthValue</em></strong>是我们组件的扩展。因此，如果客户端有变化，我们只需要改变扩展部分——不需要改变测试套件中的任何东西。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="adf3" class="ld jv hi kz b fi le lf l lg lh">private extension MyViewController {<br/> func simulateUserGetsDateOfBirthValue() {<br/>   textfield.getText()<br/> }</span></pre><h1 id="c07c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="2dfe" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">以上只是挡住我们UIKit测试路径的其中一块巨石。我们需要克服许多其他障碍。</p><p id="c959" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如你所见，这是不容易获得和学习的知识。我认为光靠我自己是不够的，在这一点上，我真的需要一个能向我展示这些东西的导师。幸运的是，我找到了一个叫做<a class="ae jt" href="https://www.essentialdeveloper.com/" rel="noopener ugc nofollow" target="_blank">基本iOS开发者</a>的团队，这两个人是:卡伊奥和迈克。我没有为任何人做广告，我只是说出事实。他们是我遇到过的最好的导师。它们极大地改变了我的心态。</p><p id="59e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，就这些。我希望你喜欢这篇文章，并分享给你的朋友。我总是公开讨论任何与iOS相关的问题。下一篇文章再见。</p></div></div>    
</body>
</html>