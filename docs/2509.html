<html>
<head>
<title>The Composable Architecture — Apply into actual projects — Part 2: The raw skeleton of the Login screen</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可组合架构——应用于实际项目——第 2 部分:登录屏幕的原始框架</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/the-composable-architecture-apply-into-actual-projects-part-2-the-raw-skeleton-of-the-login-acfe00783e95?source=collection_archive---------10-----------------------#2021-05-09">https://medium.com/nerd-for-tech/the-composable-architecture-apply-into-actual-projects-part-2-the-raw-skeleton-of-the-login-acfe00783e95?source=collection_archive---------10-----------------------#2021-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ca35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好，欢迎回到我的可组合架构教程系列。正如我在上一篇中所说的<a class="ae jd" href="https://passiondev.medium.com/the-composable-architecture-apply-into-actual-projects-part-1-the-common-structure-2762e844cbd" rel="noopener">，在这篇文章中，我将实现认证阶段，更具体地说，它是登录屏幕。但是等等，在开始之前，我想确保你不会错过任何与这个框架相关的</a><a class="ae jd" href="https://passiondev.medium.com/" rel="noopener">我以前的文章</a>——我相信它们对你非常有帮助。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/cca915b4063ec2f8c142fb98ed553f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Smng7pHLjGPj-nt95fjF8A.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图片来源:【https://unsplash.com/photos/fGkBx7hX9Ms T4】</figcaption></figure><p id="6afa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了真正有效，我建议重读我以前的帖子，尤其是结构部分，以便对我即将要做的事情有一个大致的了解。然后，你也会很容易地在我的一点点时间里掌握我将要写的知识。此外，本文的目的仅仅是建立一个结构，所以我不打算让 UI 吸引人或漂亮—(把有趣的部分留给我们)。好了，我们开始吧。</p><h2 id="f0b3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤 1:定义模型</h2><p id="dd66" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">首先，为了保持本系列的内容简单，这里的模型只是一个包含电子邮件和密码的对象。LoginView 依赖于两部分数据。当然，在现实世界中，模型必须更加复杂。</p><h2 id="2f22" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤 2:创建视图</h2><p id="aa66" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">其次，创建视图——在本例中，它是登录视图。所以在这个视图中，我们需要两个文本字段和一个登录按钮。</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="7d78" class="ju jv hi kv b fi kz la l lb lc">// MARK: - Propertiers<br/><a class="ae jd" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@State</a> private var email = ""<br/><a class="ae jd" href="http://twitter.com/State" rel="noopener ugc nofollow" target="_blank">@State</a> private var password = ""<br/>  <br/>// MARK: - View<br/>var body: some View {<br/>  VStack() {<br/>    Text("Duy Bui - iOS Developer")<br/>    TextField("Email", text: self.$email)<br/>    TextField("Password", text: self.$password)<br/>    Button("Sign In") {}<br/>  }<br/>}</span></pre><h2 id="a7d2" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤 3:定义核心</h2><p id="46a9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">这是这个架构中最重要的部分，<strong class="ih hj">核心</strong>——所以在登录视图中，我们将拥有 LoginCore。在这一部分，我们将有 4 个组件:</p><ul class=""><li id="2bfe" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm">逻辑状态</em> </strong>结构</li><li id="b990" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm">登录操作</em> </strong>枚举</li><li id="ab6c" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm">逻辑环境</em> </strong>结构</li><li id="5798" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm"> loginReducer </em> </strong>对象</li></ul><p id="7bb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们深入细节</p><ul class=""><li id="dda8" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm"> LoginState </em> </strong>包含你认为可以通过 LoginView 中的一些动作反映出来的数据。例如，在用户在电子邮件和密码字段中填写一些文本后，我们肯定需要考虑验证它们以相应地显示 UI。所以，我想除了`<strong class="ih hj"> <em class="lm"> email </em> </strong>和`<strong class="ih hj"> <em class="lm">密码</em> </strong>之外，我还需要一个名为`<strong class="ih hj"><em class="lm">is form validated</em></strong>的属性</li></ul><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="2b5f" class="ju jv hi kv b fi kz la l lb lc">public struct LoginState: Equatable {<br/>  public var email: String<br/>  public var password: String<br/>  public var isFormValidated: Bool {<br/>    return email.count &gt; 0 &amp;&amp; password.count &gt; 0<br/>  }<br/>}</span></pre><ul class=""><li id="c279" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm">登录动作</em> </strong> —这是我们定义视图中发生的动作的地方。目前，我在考虑 3 个主要的行动——更改电子邮件和密码文本字段，然后点击登录按钮。未来，如果我们有更多的行动，我们只需要在这次行动中增加新的案例。</li></ul><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="47e2" class="ju jv hi kv b fi kz la l lb lc">public enum LoginAction: Equatable {<br/>  case emailTextFieldChanged(text: String)<br/>  case passwordTextFieldChanged(text: String)<br/>  case loginButtonTap<br/>}</span></pre><ul class=""><li id="9ec4" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm">逻辑环境</em> </strong> —留空。你可以认为这个结构看起来像是协调器，它将拥有所有的依赖关系，比如网络或数据库机制</li></ul><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="e0fb" class="ju jv hi kv b fi kz la l lb lc">public struct LoginEnvironment {<br/>}</span></pre><ul class=""><li id="6436" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><strong class="ih hj"> <em class="lm"> LoginClient </em> </strong> —也留空—该类将处理网络调用。它发送主体请求并返回结果。</li></ul><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="5dfa" class="ju jv hi kv b fi kz la l lb lc">public struct LoginClient {<br/>}</span></pre><p id="8d6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，LoginClient 将具有:</p><ul class=""><li id="c25d" class="ld le hi ih b ii ij im in iq lf iu lg iy lh jc li lj lk ll bi translated"><em class="lm"> LoginRequest </em>:包含参数或头等</li><li id="1fa5" class="ld le hi ih b ii ln im lo iq lp iu lq iy lr jc li lj lk ll bi translated"><em class="lm"> LoginClient </em>包括`<em class="lm"> live </em>甚至`<em class="lm"> stub </em>版本用于测试目的</li></ul><h2 id="5b94" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">步骤 4:用状态映射视图状态</h2><p id="cde7" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">该视图状态将存在于 LoginView 中。它将处理视图中每个组件的状态。电子邮件和密码字段从视图状态映射到状态。这非常简单易懂。</p><p id="a98b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更上一层楼。按钮的颜色及其状态取决于`<em class="lm"> isFormValidated </em>`参数，因此它将被映射如下</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ls"><img src="../Images/dfe7655f1bb9399641e3324070eba2aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y11_3zg1gHZ1StZQWDwqjw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图片来源:Duy Bui</figcaption></figure><p id="b441" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，这段代码看起来像这样</p><pre class="jf jg jh ji fd ku kv kw kx aw ky bi"><span id="635b" class="ju jv hi kv b fi kz la l lb lc">struct ViewState: Equatable {<br/>    var email: String<br/>    var password: String<br/>    var loginButtonColor: Color<br/>    var isLoginButtonDisabled: Bool<br/>  }</span></pre><h1 id="af5c" class="lt jv hi bd jw lu lv lw ka lx ly lz ke ma mb mc kh md me mf kk mg mh mi kn mj bi translated">结论</h1><p id="b4f5" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">让我们看看本教程结束后登录文件夹中的所有文件。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mk"><img src="../Images/a61f782dd0fc444c5feb22858322049c.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*6o9HJbQYSjw-z_cXY5-N7g.png"/></div></figure><p id="0010" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好的，我认为这篇文章足够长来设置我们需要的所有东西。在下一部分中，我们将实现减速器部分的逻辑。我也把所有的部分连接在一起。敬请关注。别忘了把这篇文章分享给你的朋友。编码快乐！</p></div></div>    
</body>
</html>