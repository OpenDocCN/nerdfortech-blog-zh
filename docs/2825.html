<html>
<head>
<title>How to fetch data from the Anilist API (GraphQL) using Axios</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Axios 从 Anilist API (GraphQL)获取数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-fetch-data-from-the-anilist-api-graphql-using-axios-77527efc8a89?source=collection_archive---------7-----------------------#2021-05-21">https://medium.com/nerd-for-tech/how-to-fetch-data-from-the-anilist-api-graphql-using-axios-77527efc8a89?source=collection_archive---------7-----------------------#2021-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7a1dc29650858fdbc79159fc71ffabc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MJx14l2aeoXGy4BLLl9kw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Anilist GraphQL API</figcaption></figure><p id="1713" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我不会过多地谈论 graph QL<a class="ae js" href="https://graphql.org/" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj"/></a><em class="jt">到底是什么</em>，但是你应该知道的是，它是一种面向你的 API 的查询语言，与好的 ol RESTful API 有着本质的不同。在 GQL 中，我们向 API 发出一个<strong class="iw hj"> post 请求</strong>，而不是向不同的端点发出不同的请求。</p><p id="4013" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了获取不同的数据，我们可以向 API 的单个端点发出 post 请求，指定我们在传入的查询中需要什么数据。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="91c9" class="kd ke hi jz b fi kf kg l kh ki">https://graphql.anilist.co</span></pre><p id="e70c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">由于这将是一个非常简单的教程，我将只从 API 中获取少量数据，但是如果你想在你的项目中增加数据，你可以增加数据。</p></div><div class="ab cl kj kk gp kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="hb hc hd he hf"><p id="3124" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们首先安装<strong class="iw hj"> axios </strong>并在我们的代码中实例化它。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="524b" class="kd ke hi jz b fi kf kg l kh ki">const axios = require("axios");</span></pre><p id="bd61" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我们开始构建我们的查询，在这里我们指定<strong class="iw hj">我们想要什么</strong>和<strong class="iw hj">多少</strong>数据。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="6d34" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们来分解一下。<code class="du ks kt ku jz b">query</code>是我们查询的开始，在这里我们必须初始化我们想要使用的变量。默认情况下，API 返回单个结果对象，所以如果我们想要多个结果，我们必须将我们的<code class="du ks kt ku jz b">media</code>查询包装在一个<code class="du ks kt ku jz b">Page</code>查询中。页面查询还提供了<code class="du ks kt ku jz b">pageInfo</code>字段，该字段提供了关于当前页面和总结果计数的信息。</p><p id="f7ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du ks kt ku jz b">media</code>查询是奇迹发生的地方。在这里，我们只需传入在<code class="du ks kt ku jz b">parent query</code>中传递的变量，就可以得到由搜索字符串过滤的相应结果。在我的例子中，我只是根据用户评级和搜索查询(在撰写本文时)获取前 3 名动画的 id、标题、类型和流派，但是您可以获取不同类型的数据并应用多种类型的排序。这就是 GraphQL 提供的灵活性，它使得 API 调用变得更加容易。你可以在这里查看 Anilist GraphQL 参考指南<a class="ae js" href="https://anilist.github.io/ApiV2-GraphQL-Docs/" rel="noopener ugc nofollow" target="_blank"/></p><p id="c360" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们现在可以在一个单独的<code class="du ks kt ku jz b">variables</code>对象中传递我们在查询中初始化的变量值。在这里，我只是得到了只有 3 个项目的结果单页。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="1db9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们代码的主要部分已经完成。现在，我们可以将所有这些代码块与异步函数中的 axios api 调用结合起来，这样就完成了。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="c36c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果我搜索“shingeki ”,结果数据会是这样的。</p><figure class="ju jv jw jx fd ij"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="d237" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">那是…差不多了。现在你知道如何用几行代码获得你最喜欢的动漫的数据了。我在自己的项目中也用这个:<a class="ae js" href="https://ani-ko.netlify.app" rel="noopener ugc nofollow" target="_blank"> AniKo </a>。<br/>如果你喜欢这个教程，你可以鼓掌并分享这个帖子，甚至<a class="ae js" href="https://www.buymeacoffee.com/synxc" rel="noopener ugc nofollow" target="_blank">请我喝杯咖啡！</a>赞赏；)</p></div></div>    
</body>
</html>