<html>
<head>
<title>DataTables Server-side Processing in CodeIgniter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CodeIgniter 中的数据表服务器端处理</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/datatables-server-side-processing-in-codeigniter-6e0c88ef59e8?source=collection_archive---------2-----------------------#2021-05-30">https://medium.com/nerd-for-tech/datatables-server-side-processing-in-codeigniter-6e0c88ef59e8?source=collection_archive---------2-----------------------#2021-05-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/4418139b08558ff09c6eb5098a213c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*2FcD9qoJLuOI9xnCkP8wQg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">CodeIgniter 中的数据表服务器端处理</figcaption></figure><p id="40d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本教程将讨论在 Codeigniter 中实现带有远程服务器端处理的 DataTables jQuery 插件的最简单方法。在这里，我将看到如何在 Codeigniter 中通过 ajax 从远程 MySQL 数据库获取数据。</p><p id="ccce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> DataTables </strong>是 jQuery Javascript 库的一个表格增强插件，它可以帮助简单的 HTML 表格增加排序、分页和过滤功能。主要目标是增强普通 HTML 表中数据的可访问性。</p><p id="264b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于本教程，我们只需要查看 6 个 post 请求。</p><ol class=""><li id="455c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">长度</strong>:表格在本次绘制中可以显示的记录数。除非服务器返回的记录更少，否则返回的记录数应该等于这个数。</li><li id="85ae" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">开始</strong>:分页首录指示灯。这是当前数据集中的起始点(基于 0 索引，即 0 是第一条记录)。</li><li id="b824" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">order[0]Column</strong>:order 应该应用的列。这是对也提交给服务器的列的信息数组的索引引用。</li><li id="d8a4" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj"> order[0]dir </strong>:该列的排序方向。它将是 ASC 或 DESC，分别表示升序或降序。</li><li id="8f84" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">搜索【值】</strong>:全局搜索值。</li><li id="92cc" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated"><strong class="is hj">绘制</strong>:绘制计数器。数据表使用它来确保从服务器端处理请求返回的 Ajax 是由数据表按顺序绘制的(Ajax 请求是异步的，因此可以无序返回)</li></ol><h1 id="9c79" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">查看页面</h1><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="a67e" class="lj kd hi lf b fi lk ll l lm ln">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/><br/>&lt;head&gt;<br/>	&lt;meta charset="utf-8" /&gt;<br/>	&lt;title&gt;News - List&lt;/title&gt;<br/>	&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;<br/>	&lt;meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" /&gt;<br/>	&lt;meta content="Coderthemes" name="author" /&gt;<br/>	&lt;meta http-equiv="X-UA-Compatible" content="IE=edge" /&gt;<br/>	&lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"&gt;<br/>	&lt;link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.min.css"/&gt;<br/><br/>	&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"&gt;&lt;/script&gt;<br/>	&lt;script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"&gt;&lt;/script&gt;<br/>	&lt;script type="text/javascript" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"&gt;&lt;/script&gt;<br/>&lt;/head&gt;<br/><br/>&lt;body&gt;<br/>	&lt;!-- Begin page --&gt;<br/>	&lt;div id="wrapper"&gt;<br/>		<br/>		&lt;div class="content-page"&gt;<br/>			&lt;div class="content"&gt;<br/>				&lt;!-- Start Content--&gt;<br/>				&lt;div class="container-fluid"&gt;<br/>					&lt;!-- start page title --&gt;<br/>					&lt;div class="row"&gt;<br/>						&lt;div class="col-12"&gt;<br/>							&lt;div class="page-title-box"&gt;<br/>								&lt;div class="page-title-right"&gt;<br/>								&lt;/div&gt;<br/>								&lt;h4 class="page-title"&gt;News - List&lt;/h4&gt;<br/>							&lt;/div&gt;<br/>						&lt;/div&gt;<br/>					&lt;/div&gt;<br/>					&lt;!-- end page title --&gt;<br/>					&lt;div class="row"&gt;<br/>						&lt;div class="col-xl-12 col-lg-12"&gt;<br/>							&lt;div class="card-box"&gt;<br/>								&lt;table id="table-news" class="table table-bordered dt-responsive nowrap" width="100%"&gt;<br/>									&lt;thead&gt;<br/>										&lt;tr&gt;<br/>											&lt;th width="5%"&gt;No.&lt;/th&gt;<br/>											&lt;th width="10%"&gt;Date&lt;/th&gt;<br/>											&lt;th width="30%"&gt;Title&lt;/th&gt;<br/>											&lt;th width="25%"&gt;Description&lt;/th&gt;<br/>											&lt;th width="20%"&gt;Action&lt;/th&gt;<br/>										&lt;/tr&gt;<br/>									&lt;/thead&gt;<br/>									&lt;tbody&gt;<br/>									&lt;/tbody&gt;<br/>								&lt;/table&gt;<br/>							&lt;/div&gt;<br/>						&lt;/div&gt;<br/>					&lt;/div&gt;<br/>					&lt;!--- end row --&gt;	<br/>				&lt;/div&gt;<br/>				&lt;!-- end container-fluid --&gt;<br/>			&lt;/div&gt;<br/>			&lt;!-- end content --&gt;<br/>		&lt;/div&gt;<br/>	&lt;/div&gt;<br/>	&lt;script&gt;<br/>	$(function() {<br/>		var table_news = $('#table-news').DataTable({<br/>			"processing":true,<br/>			"serverSide":true,  <br/>			"order":[], <br/>			"ajax": {<br/>				url : '&lt;?php echo base_url("news/news_list"); ?&gt;',<br/>				type: "GET"  <br/>			},<br/>			"columnDefs":[  <br/>				{  <br/>					"targets":[0],  <br/>					"orderable":false,<br/>				},  <br/>			], <br/>		});<br/>		$("#table-news tbody").on('click', 'button', function() {<br/>			var id = $(this).attr('data-id');<br/>			if(this.name == "deleteButton") {<br/>				var is_delete = confirm("Are your sure?");<br/>				if(is_delete) {<br/>					$.post('news/delete', {id: id}, function(result) {<br/>						$(".result").html(result);<br/>						table_news.ajax.reload();<br/>					});<br/>				}<br/>			}<br/>		});<br/>	});<br/>	&lt;/script&gt;<br/>&lt;/body&gt;<br/><br/>&lt;/html&gt;</span></pre><h1 id="97c3" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">控制器</h1><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="b8ab" class="lj kd hi lf b fi lk ll l lm ln">&lt;?php<br/>defined('BASEPATH') OR exit('No direct script access allowed');<br/><br/>class News extends MY_Controller {<br/><br/>	public function __construct() {<br/>		parent::__construct();<br/>		$this-&gt;load-&gt;model('News_model', 'news');<br/>		//<br/>		$this-&gt;ip_address 	= $_SERVER['REMOTE_ADDR'];<br/>		$this-&gt;datetime 	= date('Y-m-d H:i:s');<br/>		$this-&gt;login_id 	= $this-&gt;session-&gt;userdata('login_id');<br/>		$this-&gt;login_name 	= $this-&gt;session-&gt;userdata('login_name');<br/>	}<br/><br/>	public function index() {<br/>		$this-&gt;list();<br/>	}<br/><br/>	public function list() {<br/>		$data 					= [];<br/>		$data['content_title'] 	= 'News - List'; <br/>		$data['status_list']	= $this-&gt;status-&gt;get_all(["status"=&gt;"1"]);<br/>		$this-&gt;load-&gt;view('list', $data);<br/>	}<br/><br/>	public function news_datatable() {<br/>		$arrayList = [];<br/>		$result 	= $this-&gt;news_defer-&gt;getRows($this-&gt;input-&gt;get()); <br/>		$i 			= $this-&gt;input-&gt;get('start');<br/>		foreach($result as $row) {<br/>			$action = '<br/>			&lt;a href="'.base_url('news/edit?id='.$row-&gt;id).'" class="btn btn-sm btn-primary"&gt;<br/>              &lt;i class="fe-edit"&gt;&lt;/i&gt; Edit&lt;/a&gt;<br/>			&lt;button name="deleteButton" data-id="'.$row-&gt;id.'" class="btn btn-sm btn-danger"&gt;<br/>              &lt;i class="fe-trash"&gt;&lt;/i&gt; Delete&lt;/button&gt;<br/>			';<br/>			$arrayList [] = [<br/>				++$i,<br/>				nice_date($row-&gt;created_at, 'd-m-Y H:i:s'),<br/>				$row-&gt;title,<br/>				$row-&gt;description,<br/>				$action<br/>			];<br/>		}<br/>		$output = array(<br/>			"draw" 				=&gt; $this-&gt;input-&gt;get('draw'),<br/>			"recordsTotal" 		=&gt; $this-&gt;news_defer-&gt;countAll(),<br/>			"recordsFiltered"	=&gt; $this-&gt;news_defer-&gt;countFiltered($this-&gt;input-&gt;get()),<br/>			"data" 				=&gt; $arrayList,<br/>		);<br/><br/>		echo json_encode($output);<br/>	}<br/><br/>	public function delete() {<br/>		$id 		= $this-&gt;input-&gt;post('id');<br/>		$where 		= ['id' =&gt; $id];<br/>		$result = $this-&gt;news-&gt;delete($where);<br/>		if($result) {<br/>			echo "deleted";<br/>		}<br/>	}<br/>}</span></pre><h1 id="2718" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">模型页面</h1><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="49fc" class="lj kd hi lf b fi lk ll l lm ln">&lt;?php<br/>defined('BASEPATH') OR exit('No direct script access allowed');<br/><br/>class News_defer_model extends CI_Model {<br/><br/>	public function __construct() {<br/>		parent::__construct();<br/><br/>    	$this-&gt;is_admin       = ($this-&gt;session-&gt;userdata('login_role') == "admin") ? true : false;<br/>    	$this-&gt;login_id       = $this-&gt;session-&gt;userdata('login_id');<br/>		//<br/>		$this-&gt;table          = 'news_info';<br/>		$fields               = $this-&gt;db-&gt;list_fields($this-&gt;table);<br/>		$this-&gt;column_order   = $this-&gt;getColumnOrder($fields);<br/>		$this-&gt;column_search  = $this-&gt;getColumnSearch($fields);<br/>	}<br/><br/>	public function getColumnOrder($fields) {<br/>		$list 		= [];<br/>		$list[0] 	= null;<br/>		foreach($fields as $field) {<br/>			$list[] = $field;<br/>		}<br/>		return $list;<br/>	}<br/><br/>	public function getColumnSearch($fields) {<br/>		$list 		= [];<br/>		foreach($fields as $field) {<br/>			$list[] = $field;<br/>		}<br/>		return $list;<br/>	}<br/><br/>	public function getRows($postData){<br/>        $this-&gt;_get_datatables_query($postData);<br/>        if($postData['length'] != -1){<br/>            $this-&gt;db-&gt;limit($postData['length'], $postData['start']);<br/>        }<br/>        $query = $this-&gt;db-&gt;get();<br/>        return $query-&gt;result();<br/>    }<br/><br/>    public function countAll(){<br/>        $this-&gt;db-&gt;from($this-&gt;table);<br/>        return $this-&gt;db-&gt;count_all_results();<br/>    }<br/>    <br/>    public function countFiltered($postData){<br/>        $this-&gt;_get_datatables_query($postData);<br/>        $query = $this-&gt;db-&gt;get();<br/>        return $query-&gt;num_rows();<br/>    }<br/><br/>    private function _get_datatables_query($postData){<br/>         <br/>        $this-&gt;db-&gt;from($this-&gt;table);<br/>        if($this-&gt;is_admin) {<br/>        	$this-&gt;db-&gt;where(["status"=&gt;$postData['status']]);<br/>        } else {<br/>        	$this-&gt;db-&gt;where(["status"=&gt;$postData['status'], "created_by"=&gt;$this-&gt;login_id]);<br/>        }<br/>        $this-&gt;db-&gt;order_by('created_at', 'DESC');<br/> <br/>        $i = 0;<br/>        // loop searchable columns <br/>        foreach($this-&gt;column_search as $item){<br/>            // if datatable send POST for search<br/>            if($postData['search']['value']){<br/>                // first loop<br/>                if($i===0){<br/>                    // open bracket<br/>                    $this-&gt;db-&gt;group_start();<br/>                    $this-&gt;db-&gt;like($item, $postData['search']['value']);<br/>                }else{<br/>                    $this-&gt;db-&gt;or_like($item, $postData['search']['value']);<br/>                }<br/>                // last loop<br/>                if(count($this-&gt;column_search) - 1 == $i){<br/>                    // close bracket<br/>                    $this-&gt;db-&gt;group_end();<br/>                }<br/>            }<br/>            $i++;<br/>        }<br/>         <br/>        if(isset($postData['order'])){<br/>            $this-&gt;db-&gt;order_by($this-&gt;column_order[$postData['order']['0']['column']], $postData['order']['0']['dir']);<br/>        }else if(isset($this-&gt;order)){<br/>            $order = $this-&gt;order;<br/>            $this-&gt;db-&gt;order_by(key($order), $order[key($order)]);<br/>        }<br/>    }<br/><br/>}</span></pre><p id="beec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更多信息请访问<a class="ae lo" href="https://infovistar.com/codeigniter/datatable-server-side-processing-in-codeigniter" rel="noopener ugc nofollow" target="_blank">https://infovistar . com/codeigniter/datatable-server-side-processing-in-codeigniter</a></p></div></div>    
</body>
</html>