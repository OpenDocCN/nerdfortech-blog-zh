<html>
<head>
<title>Managing Python dependencies using Virtual Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用虚拟环境管理Python依赖关系</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/managing-python-dependencies-using-virtual-environments-a89f7c54a570?source=collection_archive---------14-----------------------#2021-02-23">https://medium.com/nerd-for-tech/managing-python-dependencies-using-virtual-environments-a89f7c54a570?source=collection_archive---------14-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/83ca6615fced0b18bfe4d8cfa47b6512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T4VpXQchm1Vr05bL.jpg"/></div></div></figure><p id="dccd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们开始构建一个超越简单脚本的Python项目时，我们倾向于开始使用第三方依赖。当处理一个更大的项目时，我们需要考虑以一种有效的方式管理这些依赖关系。当安装依赖项时，我们总是希望在虚拟环境中。它有助于保持物品整洁。这也有助于避免搞乱我们的Python环境。</p><h1 id="06c8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">为什么我们需要Python虚拟环境？</h1><p id="7866" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们可以使用Pip将包安装到我们的Python项目中。在一个Python项目中安装多个包是很常见的。这可能会导致一些关于已安装的软件包版本及其依赖关系的问题。</p><p id="f8e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们在项目中使用<code class="du kr ks kt ku b">pip install &lt;package name&gt;</code>时，我们在全局Python名称空间中安装包及其依赖项。这将为我们配置python的特定Python版本安装软件包。我们可以通过使用</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="bf24" class="ld jp hi ku b fi le lf l lg lh">$ python3.7 -c "import sys; print('\n'.join(sys.path))"<br/><br/><br/>/usr/lib/python27.zip<br/>/usr/lib/python2.7<br/>/usr/lib/python2.7/lib-dynload<br/>/usr/lib/python2.7/site-packages</span></pre><p id="0d43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而如果用<code class="du kr ks kt ku b">pip3 install &lt;package name&gt;</code>安装同一个包，它会和Python 3版本一起安装在一个单独的目录下。我们可以通过使用以下命令来解决这个问题:</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="d6fa" class="ld jp hi ku b fi le lf l lg lh">python2.7 -m pip install &lt;package name&gt;</span></pre><p id="fb1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这仍然没有解决我们在系统范围内安装软件包的问题。这会导致以下问题:</p><ul class=""><li id="5c57" class="li lj hi is b it iu ix iy jb lk jf ll jj lm jn ln lo lp lq bi translated">拥有相同包的不同版本的不同项目将会相互冲突</li><li id="c96f" class="li lj hi is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq bi translated">项目的依赖项可能与系统级的依赖项冲突，这可能会彻底破坏系统</li><li id="aad1" class="li lj hi is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq bi translated">多用户项目是不可能的</li><li id="0d4d" class="li lj hi is b it lr ix ls jb lt jf lu jj lv jn ln lo lp lq bi translated">针对不同的python和库版本测试代码是一项具有挑战性的任务</li></ul><p id="e32f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了避免这些问题，Python开发人员使用虚拟环境。这些虚拟环境利用隔离的上下文(目录)来安装软件包和依赖项。</p><h1 id="5a43" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建虚拟环境</h1><p id="b29c" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我们需要一个工具来利用Python虚拟环境。用来制造这些的工具被称为<a class="ae lw" href="https://docs.python.org/3/library/venv.html" rel="noopener ugc nofollow" target="_blank"> venv </a>。它内置于Python 3.3+的标准Python库中。</p><p id="f7e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们使用python 2，我们将不得不手动安装它。这是我们希望在全球范围内安装的少数几个软件包之一。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="671e" class="ld jp hi ku b fi le lf l lg lh">python2 -m pip install virtualenv</span></pre><p id="e415" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意:我们将在这篇文章中更多地讨论venv和Python 3，因为它和virtualenv有一些不同。命令稍有不同，工具的工作方式也有所不同。</p><p id="2273" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将首先创建一个新的目录，我们希望在其中处理我们的项目。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="3926" class="ld jp hi ku b fi le lf l lg lh">$ mkdir my-python-project &amp;&amp; cd my-python-project</span></pre><p id="d771" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后我们将创建一个新的虚拟环境:</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="ecba" class="ld jp hi ku b fi le lf l lg lh">$ python3 -m venv virtualenv<br/><br/># creates a virtual environment called virtualenv, the name can be anything we want</span></pre><p id="4c52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将在我们刚刚创建的目录中创建一个名为virtualenv的目录。该目录将包含一个bin文件夹、一个lib文件夹、一个include文件夹和一个环境配置文件。所有这些文件确保所有Python代码都在当前环境的上下文中执行。这有助于实现与全球环境的隔离，并避免我们前面讨论的问题。</p><p id="80e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了开始使用这个环境，我们需要激活它。这样做还会将我们的命令提示符更改为当前上下文。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="0c42" class="ld jp hi ku b fi le lf l lg lh">$ source env/bin/activate<br/>(virtualenv) $</span></pre><p id="213c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该提示还指示虚拟环境是活动的，并且python代码在该环境下执行。</p><p id="4e2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的环境内部，系统范围的软件包是不可访问的，并且安装在环境内部的任何软件包在外部都是不可用的。</p><p id="0dbd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虚拟环境中默认只安装了<code class="du kr ks kt ku b">pip</code>和<code class="du kr ks kt ku b">setuptools</code>。</p><p id="d52f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">激活环境后，path变量被修改以实现虚拟环境的概念。</p><p id="2388" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们完成并希望切换到全局环境时，我们可以使用deactivate命令退出。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="a4bb" class="ld jp hi ku b fi le lf l lg lh">(virtualenv) $ deactivate <br/>$</span></pre><h1 id="0018" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">跨环境管理依赖关系</h1><p id="8a03" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">既然我们已经设置了虚拟环境，我们就不希望继续共享可以使用pip安装的包。我们希望排除我们的虚拟环境文件夹，并能够在不同的系统上重现我们的工作。我们可以通过利用项目根目录中的需求文件来做到这一点。</p><p id="834d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设我们在虚拟环境中安装了Flask。之后，如果我们运行<code class="du kr ks kt ku b">pip freeze</code>，它将列出我们已经安装的软件包及其版本号。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="7491" class="ld jp hi ku b fi le lf l lg lh">(virtualenv) $ pip freeze<br/>Flask==1.1.2</span></pre><p id="099a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以把这个写到requirements.txt文件中上传到git，或者以任何其他形式与他人分享。</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="7068" class="ld jp hi ku b fi le lf l lg lh">(virtualenv) $ pip freeze &gt; requirements.txt</span></pre><p id="ed87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个命令也可以用来更新文件。</p><p id="fa21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，每当有人想在他们的电脑上运行我们的项目，他们需要做的就是:</p><pre class="kv kw kx ky fd kz ku la lb aw lc bi"><span id="cd86" class="ld jp hi ku b fi le lf l lg lh">$ cd copied-project/<br/>$ python3 -m venv virtualenv/<br/>$ python3 -m pip install -r requirements.txt</span></pre><p id="896a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一切都会像在我们的系统上一样正常工作。现在，我们可以管理python虚拟环境，从而根据需要管理依赖项和包。如果你对此有任何问题，请在下面留言。</p></div><div class="ab cl lx ly gp lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hb hc hd he hf"><p id="4838" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="me">原载于2021年2月23日https://www.wisdomgeek.com</em><em class="me">的</em> <a class="ae lw" href="https://www.wisdomgeek.com/development/web-development/python/managing-python-dependencies-using-virtual-environments/" rel="noopener ugc nofollow" target="_blank"> <em class="me">。</em></a></p></div></div>    
</body>
</html>