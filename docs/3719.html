<html>
<head>
<title>Predicting customer churn for a telco</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测电信公司的客户流失</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/predicting-customer-churn-for-a-telco-70a821a84ce8?source=collection_archive---------1-----------------------#2021-06-21">https://medium.com/nerd-for-tech/predicting-customer-churn-for-a-telco-70a821a84ce8?source=collection_archive---------1-----------------------#2021-06-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e9e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">客户流失是一个与购买后流失的客户相关的术语。获得一个客户的成本是巨大的，足以让公司分析和理解客户流失背后的原因。</p><p id="cbe1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本练习中，我们将使用一家电信公司的数据集，该数据可在以下链接中找到。<a class="ae jd" href="https://www.kaggle.com/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/blastchar/telco-customer-churn</a>。</p><p id="f80e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该数据集有近21列，包含18个自变量、一个客户id变量和一个客户流失形式的因变量。代码的第一部分是分析数据并查看列的数据类型</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="4d9d" class="jn jo hi jj b fi jp jq l jr js">df=pd.read_csv('Customer Churn.csv')<br/>df.head(5)</span></pre><p id="405d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了总费用和每月费用，数据集中几乎所有的变量都是分类变量。我们可以首先检查是否有任何丢失的值</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="73fe" class="jn jo hi jj b fi jp jq l jr js">df.isnull().sum()</span></pre><p id="75a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在确认没有缺失值后，我们将执行EDA来识别数据中的任何关系或模式。让我们首先尝试找出电信客户的任期分布。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="bafe" class="jn jo hi jj b fi jp jq l jr js">sns.boxplot(y=df["tenure"],x=df["Churn"]</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es jt"><img src="../Images/12a426e61332b99cb719f8cf0665202f.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*IJ-d7Ky4drn9Bx4kkuFm8A.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">任期与流失</figcaption></figure><p id="2855" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们进一步分析电信客户可以利用的服务类型，以及它与客户流失率的关系。让我们先来看看互联网服务的类型和他们的流失率之间的关系。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="97b0" class="jn jo hi jj b fi jp jq l jr js">internet=pd.crosstab(df["InternetService"],df["Churn"],normalize="columns").plot(kind="bar")</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kb"><img src="../Images/e4734641e0d42ce2eee65024d5126610.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOiXa0mJK-KiR9hN_kFr2Q.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">互联网连接与流失率</figcaption></figure><p id="0421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从标题中可以看出，使用光纤连接的人比使用DSL连接的人更容易流失。更重要的是，我们还可以推断出，互联网服务的类型对客户流失率有着重要的影响。让我们看看接触的持续时间如何影响客户流失</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="cee4" class="jn jo hi jj b fi jp jq l jr js">internet=pd.crosstab(df["Contract"],df["Churn"],normalize="columns").plot(kind="bar")</span></pre><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es kg"><img src="../Images/97e0eb88f2c46645961e3abfbaff1d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:752/format:webp/1*RGzMCFHrB-hrhFwWo6iGCA.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx translated">合同期限与流失</figcaption></figure><p id="0fa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与签订月合同的人相比，接触时间长的人流失率更低。</p><h1 id="ac22" class="kh jo hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">特色工程</strong></h1><p id="14f2" class="pw-post-body-paragraph if ig hi ih b ii le ik il im lf io ip iq lg is it iu lh iw ix iy li ja jb jc hb bi translated">在本节中，我们将不得不为f形虚拟变量中的分类变量生成额外的列。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="27af" class="jn jo hi jj b fi jp jq l jr js">df['TotalCharges']=pd.to_numeric(df["TotalCharges"],downcast='float',errors='coerce')<br/>df=pd.get_dummies(df,columns=['gender','Partner','Dependents','PhoneService','MultipleLines','InternetService','OnlineSecurity','OnlineBackup','DeviceProtection','TechSupport','StreamingTV','StreamingMovies','Contract','PaperlessBilling','PaymentMethod','Churn'])<br/>df.drop([ 'Churn_No', 'gender_Female', 'Partner_No',<br/>        'Dependents_No', 'PhoneService_No', 'PaperlessBilling_No'],axis=1,inplace=<strong class="jj hj">True</strong>)</span></pre><p id="8579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的数据集中现在总共有41列。有多种方法可以处理如此多维度的数据。一种方法是通过主成分分析来降低数据集的维数。能否在分类数据集上进行主成分分析是另一个问题。Stack Exchannge上的这个链接提供了一个不同的替代方法，称为多重对应分析(MCA)。<a class="ae jd" href="https://stats.stackexchange.com/questions/5774/can-principal-component-analysis-be-applied-to-datasets-containing-a-mix-of-cont" rel="noopener ugc nofollow" target="_blank">https://stats . stack exchange . com/questions/5774/can-principal-component-analysis-be-applied-to-datasets-cont-cont-mix</a></p><p id="8cda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，对于这个项目的范围，我们将跳过这个过程，并着手建立我们的机器学习算法。该过程的第一部分是将数据分为测试集和训练集</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e017" class="jn jo hi jj b fi jp jq l jr js">X=df.iloc[:,:-1].values<br/>y=df['Churn_Yes'].values<br/><br/>X_train, X_test, y_train, y_test = train_test_split(X,y,test_size=0.2)</span></pre><p id="90cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦数据被分离，我们就可以对我们的数据进行逻辑回归。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9dac" class="jn jo hi jj b fi jp jq l jr js">lr=LogisticRegression()<br/>lr.fit(X_train,y_train)<br/>y_pred=lr.predict(X_test)<br/>print(classification_report(y_pred,y_test))</span></pre><p id="15ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">逻辑回归的结果如下所示</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d194" class="jn jo hi jj b fi jp jq l jr js">precision    recall  f1-score   support<br/><br/>           0       0.91      0.84      0.87      1107<br/>           1       0.54      0.70      0.61       302<br/><br/>    accuracy                           0.81      1409<br/>   macro avg       0.72      0.77      0.74      1409<br/>weighted avg       0.83      0.81      0.81      1409</span></pre><p id="d86e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模型的准确率为81%，精确度为54%，对正客户流失值的召回率为70%。让我们尝试使用决策树分类器，看看是否可以进一步改善结果</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="d633" class="jn jo hi jj b fi jp jq l jr js">dc=DecisionTreeClassifier()<br/>dc.fit(X_train,y_train)<br/>y_pred=dc.predict(X_test)<br/>Tree',accuracy_score(y_pred,y_test),'<strong class="jj hj">\n</strong>'<br/>        'Confusion Matrix with Decision Tree', confusion_matrix(y_pred,y_test))</span></pre><p id="cd6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果如下所示</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5030" class="jn jo hi jj b fi jp jq l jr js">Accuracy Score with Decision Tree 0.7381121362668559 <br/>Confusion Matrix with Decision Tree [[843 194]<br/> [175 197]]</span></pre><p id="beb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">准确率从81%下降到73%。我们现在将在随机森林分类器上使用GridSearchCV，看看模型的得分是否可以改进。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="12ec" class="jn jo hi jj b fi jp jq l jr js"><strong class="jj hj">from</strong> <strong class="jj hj">sklearn.model_selection</strong> <strong class="jj hj">import</strong> RandomizedSearchCV</span><span id="fcc9" class="jn jo hi jj b fi lj jq l jr js">estimators=range(50,100)<br/>max_features = ['auto', 'sqrt']<br/>max_depth = range(4,12)<br/>min_samples_split = range(2,8)<br/>min_samples_leaf = range(1,8)<br/>bootstrap = [<strong class="jj hj">True</strong>, <strong class="jj hj">False</strong>]<br/>criterion=['gini','entropy']</span><span id="e01b" class="jn jo hi jj b fi lj jq l jr js">random_grid = {'n_estimators':estimators,<br/>              'max_features':max_features,<br/>              'max_depth':max_depth,<br/>              'min_samples_split':min_samples_split,<br/>              'min_samples_leaf':min_samples_leaf,<br/>              'bootstrap':bootstrap,<br/>              'criterion':criterion}</span><span id="76a4" class="jn jo hi jj b fi lj jq l jr js">rf=RandomForestClassifier()<br/>rf=RandomizedSearchCV(estimator=rf,param_distributions=random_grid,cv=5,verbose=1)</span><span id="417d" class="jn jo hi jj b fi lj jq l jr js">rf.fit(X_train,y_train)<br/>best_estimate=rf.best_params_<br/>rf2=RandomForestClassifier(**best_estimate)<br/>rf2.fit(X_train,y_train)<br/>y_pred=rf2.predict(X_test)<br/>print(classification_report(y_pred,y_test))</span></pre><p id="dd6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用随机搜索CV来确定随机森林分类器的最佳估计，然后使用这些估计来构建随机森林分类器。让我们看看下面的结果</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="60aa" class="jn jo hi jj b fi jp jq l jr js">precision    recall  f1-score   support<br/><br/>           0       0.92      0.83      0.87      1122<br/>           1       0.51      0.70      0.59       287<br/><br/>    accuracy                           0.80      1409<br/>   macro avg       0.71      0.77      0.73      1409<br/>weighted avg       0.83      0.80      0.81      1409</span></pre><p id="6bfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">分数还是和logistic回归一样好。我们还可以使用特征重要性方法来找出影响客户流失的关键因素</p><figure class="je jf jg jh fd ju er es paragraph-image"><div class="er es lk"><img src="../Images/4fa979e54c5f454e107142be62617c70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*zjfLGV2YAXcBeypBnVGf_w.png"/></div></figure><p id="43d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">三个最重要的特性是</p><ol class=""><li id="399f" class="ll lm hi ih b ii ij im in iq ln iu lo iy lp jc lq lr ls lt bi translated">每月费用</li><li id="eeae" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">合同类型(按月、一年、两年)</li><li id="11d5" class="ll lm hi ih b ii lu im lv iq lw iu lx iy ly jc lq lr ls lt bi translated">网络安全</li></ol><p id="d3db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">战略家可以更好地关注这些因素，以减少客户流失，提高客户满意度。</p></div></div>    
</body>
</html>