<html>
<head>
<title>Implementing Action Mailer — Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实现动作邮件程序— Ruby on Rails</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/implementing-action-mailer-ruby-on-rails-1766f59c6f?source=collection_archive---------0-----------------------#2021-05-02">https://medium.com/nerd-for-tech/implementing-action-mailer-ruby-on-rails-1766f59c6f?source=collection_archive---------0-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/de162c794a21e79bfb7e5c3f7dd2f226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aWCwDvpokwZ3dT99ZEmAFg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@kukla_13" rel="noopener ugc nofollow" target="_blank">伊丽莎白·库什连科</a>经由<a class="ae iu" href="https://unsplash.com/photos/zKPBvFUwUMs" rel="noopener ugc nofollow" target="_blank">unsplash.com</a>拍摄</figcaption></figure><p id="156b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在现代网站和应用程序中，接收自动发送的电子邮件已经变得如此普遍，以至于以某种形式或方式收不到邮件都让人感觉怪怪的。这就是为什么作为开发人员，理解如何实现邮件程序很重要。幸运的是，对于任何正在学习Ruby on Rails的人，或者目前正在使用Rails的人来说，Action Mailer可以提供帮助。</p><h1 id="83cd" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">什么是动作邮件？</h1><p id="0d3a" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">根据<a class="ae iu" href="https://guides.rubyonrails.org/action_mailer_basics.html" rel="noopener ugc nofollow" target="_blank"> Ruby on Rails指南</a>，“动作邮件程序允许您使用邮件程序类和视图从应用程序发送电子邮件”。</p><p id="7b70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在继续之前，如果你不熟悉<strong class="ix hj">模型-视图-控制器</strong>模式，花点时间阅读一下可能会有帮助，因为动作邮件程序依赖于相同的设计模式。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><h1 id="6f4b" class="jt ju hi bd jv jw ld jy jz ka le kc kd ke lf kg kh ki lg kk kl km lh ko kp kq bi translated">在Rails项目中实现动作邮件程序</h1><p id="fc99" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">第一步:用<code class="du li lj lk ll b">rails g mailer &lt; YourMailerName &gt;</code>创建一个邮件</p><p id="5728" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行<code class="du li lj lk ll b">rails g mailer</code>将创建以下文件:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="5e5e" class="lu ju hi ll b fi lv lw l lx ly">% rails g mailer ShippingConfirmation<br/>      create  app/mailers/shipping_confirmation_mailer.rb<br/>      invoke  erb<br/>      create    app/views/shipping_confirmation_mailer<br/>      invoke  test_unit<br/>      create    test/mailers/shipping_confirmation_mailer_test.rb<br/>      create  test/mailers/previews/shipping_confirmation_mailer_preview.rb</span></pre><p id="653e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二步:在邮件中创建一个动作/方法</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/44058c72dd3b0a2f812c131874723087.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V2_eGnpPJRVrLSCMSKykKg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">邮件程序操作预览。</figcaption></figure><p id="bfce" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">邮件程序充当控制器，因此您在此电子邮件操作中定义的任何实例变量都可以在电子邮件视图中访问。这就是MVC模式发挥作用的地方！</p><p id="4b74" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不要忘记定义用于发送电子邮件的默认电子邮件地址。您可以在刚刚创建的邮件程序中定义它，也可以在Rails为我们创建的应用程序邮件程序中定义它，因为我们的邮件程序继承了应用程序邮件程序。如果你有多个邮件发送者，使用应用程序邮件存储默认邮件地址有助于保持我们的代码<strong class="ix hj">干燥</strong>。</p><p id="6497" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第三步:定制邮件视图</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/43b47de4ffa06280585cfa7b2027ddd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2ZhrJJryWoX1dgdcOANydA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">电子邮件HTML预览。</figcaption></figure><p id="d478" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了简洁明了，我就不展示了，但是Rails也生成了一个<code class="du li lj lk ll b">.text.erb</code>视图文件，如果您的用户不想接收html邮件，这是一个很好的做法。</p><p id="117e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第四步:从控制器调用邮件程序</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/be699cc9dc875843ca809307ed53bfdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dL6D9JxoAB54RXND8S_cQQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">控制器动作预览。</figcaption></figure><p id="82f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一步非常简单。您想在邮件程序中使用的任何变量都可以作为参数传递给<code class="du li lj lk ll b">.with</code>方法。我们想在邮件中使用的任何动作都可以在使用点符号的<code class="du li lj lk ll b">.with</code>方法之后调用。</p><p id="5c06" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">动作邮件程序允许现在或以后使用<code class="du li lj lk ll b">.deliver_now</code>或<code class="du li lj lk ll b">.deliver_later</code>发送电子邮件。后者利用了<a class="ae iu" href="https://guides.rubyonrails.org/active_job_basics.html" rel="noopener ugc nofollow" target="_blank">活动作业</a>，它允许在请求响应周期之外发送电子邮件，异步地考虑<em class="mc"/>，这可以让用户感觉你的应用程序更快。</p><p id="0167" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第五步:配置Rails应用程序使用Gmail</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="c323" class="lu ju hi ll b fi lv lw l lx ly"><em class="mc"># config/environments/development.rb</em></span><span id="689b" class="lu ju hi ll b fi md lw l lx ly">config.action_mailer.delivery_method = :smtp</span><span id="43a9" class="lu ju hi ll b fi md lw l lx ly">config.action_mailer.default_url_options = { <br/>:host =&gt; '&lt;your_url_here&gt;', <br/>:protocol =&gt; 'http'<br/>}</span><span id="1f78" class="lu ju hi ll b fi md lw l lx ly">config.action_mailer.smtp_settings = {<br/>:address =&gt; 'smtp.gmail.com',<br/>:port =&gt; 601,<br/>:user_name =&gt; &lt;gmail_username&gt;,<br/>:password =&gt; &lt;gmail_password&gt;,<br/>:authentication =&gt; 'plain',<br/>:enable_starttls_auto =&gt; true<br/>}</span></pre><p id="ebaf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您正在本地运行，您将使用localhost:3000或您正在运行的任何端口。</p><p id="e8da" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第六步:配置Gmail允许你的Rails应用程序</p><p id="6e03" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这最后一步可能有点棘手，所以我建议直接找到问题的根源。谷歌提供了一个很好的<a class="ae iu" href="https://support.google.com/accounts/answer/185833" rel="noopener ugc nofollow" target="_blank">演练</a>如何让第三方应用程序访问你的gmail。要做到这一点，需要启用双因素身份认证并生成应用程序密码。</p><p id="9fbf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是让动作邮件程序在你的Rails应用程序中运行所需要的一切。还有许多其他可用的特性和选项，所以我鼓励您花些时间阅读开头链接的Rails指南。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><p id="ba60" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">与大多数Rails一样，Action Mailer允许您在不编写太多代码的情况下完成大量工作。读完这篇文章后，我希望你现在已经知道实现这个基本特性的必要性。</p><p id="843c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">欢迎在下面留下您对实施行动邮件的想法或您对我的任何反馈！</p></div></div>    
</body>
</html>