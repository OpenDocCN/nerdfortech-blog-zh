<html>
<head>
<title>C# — Delegates, Actions, Events. Summary please!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C# —委托、动作、事件。请总结！</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/c-delegates-actions-events-summary-please-8fab0244a40a?source=collection_archive---------0-----------------------#2021-04-15">https://medium.com/nerd-for-tech/c-delegates-actions-events-summary-please-8fab0244a40a?source=collection_archive---------0-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1fc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不知道我是否是唯一的一个，但出于某种原因，我已经“明白”了很多次，也忘记了很多次，也困惑了很多次。我试着为自己写一些清晰的笔记，也许也能帮助别人。清楚是这里的关键词。我会试试看。</p><p id="38b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想提一下代表，然后。NET类型，我们可以在某些情况下将它们用作委托。我们走吧！</p><h1 id="0be0" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">普通代表</h1><p id="f4b7" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">C#中的委托是一种引用带有<strong class="ih hj">参数列表和返回类型</strong>的方法的类型。委托用于将<strong class="ih hj">方法作为参数</strong>传递给其他方法。</p><p id="c392" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，这是正确的，但我不能说回来，即使读完它。让我们先见一位代表。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/97f5834dceed02e619dca1ed8e0c8189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gmlPElANXkZfPpqpWfTOGg.png"/></div></div></figure><p id="bc0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">委托并不关心这些方法是否是静态的，所以这两种类型都能很好地工作。下面是一些适用于该委托的方法示例。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/bd92ab6942262baaf4be7df0ad208fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u5p903PNfvAJ24EV-F24mA.png"/></div></div></figure><p id="4f7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以设置一个或多个方法用一个委托来运行。在我们从方法中返回一个值的情况下(就像上面的Decimal ),根据某些情况将委托设置为一个特定的方法是有意义的(因为我们必须将返回值存储在某个地方),就像您在下面的代码中看到的那样:</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="7b3f" class="kx je hi kt b fi ky kz l la lb">Decimal result = 0;<br/>//Use the Calculation type of delegate<br/><strong class="kt hj">Calculation</strong> <strong class="kt hj">delegateCalcHandler </strong>= null;</span><span id="de6c" class="kx je hi kt b fi lc kz l la lb">var random = new Random();<br/>int x = random.Next(1, 5);// random number 1-4</span><span id="e71d" class="kx je hi kt b fi lc kz l la lb">//class just to indicate we can use static or instance methods<br/>SumSub sumSub = new SumSub();</span><span id="8d32" class="kx je hi kt b fi lc kz l la lb">//just to assigned some method at random<br/>switch (x)<br/>{<br/>     case 1:<br/>          <strong class="kt hj">delegateCalcHandler </strong>= sumSub.Sum;<br/>          break;<br/>     case 2:<br/>          delegateCalcHandler = sumSub.Sub;<br/>          break;<br/>     case 3:<br/>          delegateCalcHandler = Prod;<br/>          break;<br/>     case 4:<br/>          delegateCalcHandler = Div;<br/>          break;<br/>     default:<br/>          delegateCalcHandler = sumSub.Sum;<br/>          break;<br/>}<br/>//call the delegate, which will call whatever method was assigned at random<br/><strong class="kt hj">result = delegateCalcHandler(3, 4);</strong></span></pre><p id="1b72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们想用同一个委托调用不止一个方法，我们可以用类似这样的东西替换上面的随机赋值。</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="9d74" class="kx je hi kt b fi ky kz l la lb">//have the delegate handler call all the methods</span><span id="09d5" class="kx je hi kt b fi lc kz l la lb"><strong class="kt hj">delegateCalcHandler </strong>= sumSub.Sum;<br/>delegateCalcHandler <strong class="kt hj">+=</strong> sumSub.Sub;<br/>delegateCalcHandler += Prod;<br/>delegateCalcHandler += Div;</span><span id="9656" class="kx je hi kt b fi lc kz l la lb">delegateCalcHandler(2, 1);//will call all the methods.</span></pre><p id="54a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">方法不能保证按照它们被添加到委托的顺序被调用。委托是对象，因此它们也可以传递给其他方法。在那个例子中，一旦我们有了delegateCalcHandler，我们可以像这样把它传递给另一个方法:</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="6797" class="kx je hi kt b fi ky kz l la lb">//pass the delegate to UsePassedDelegate<br/><em class="ld">UsePassedDelegate</em>(<strong class="kt hj">delegateCalcHandler</strong>);</span><span id="8ef3" class="kx je hi kt b fi lc kz l la lb">private void <em class="ld">UsePassedDelegate</em>(<strong class="kt hj">Calculation </strong>calc)<br/>{<br/>     Decimal d = calc(3, 2);<br/>}</span></pre><p id="e26c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像可以用<strong class="ih hj"> += </strong>符号向委托添加方法一样，可以用<strong class="ih hj"> -= </strong>符号移除方法。</p><h1 id="fb1c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">行动</h1><p id="7eca" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当我们使用的方法返回void时，我们可以使用C#提供的动作类型。。NET提供了一组动作类型，从没有参数的动作到有16个参数的动作(Action，Action <t1>，Action <t1 t2=""> …)。</t1></t1></p><p id="3ac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">动作也可以用于静态和实例方法，但是为了简单起见，我不再使用静态方法。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es le"><img src="../Images/a871cbf1be7d991af0816425e7e3c0c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uf9iTylF7EfWPqBfV_EPfQ.png"/></div></div></figure><p id="042f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用于操作的参数可以是任何东西，它们不必都是相同的类型。</p><p id="25aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你在一个类中创建动作委托时(在我的例子中我把它放在方法中)，它们被创建为带有set和get方法的属性，所以类外的代码可以访问它们。您可以给它们添加关键字<code class="du lf lg lh kt b">event</code>，然后它们被创建为字段而不是属性。</p><h1 id="4af3" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">更新功能&lt; &gt; </strong>:</h1><p id="ebba" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">正如有人在评论中指出的，值得一提的是，与动作类似，你也有<strong class="ih hj">功能</strong>。当方法返回void时，使用动作，而使用Funcs，您将有一个返回值。但是，与上面的操作示例类似，如果我这样做，最后一个操作将会成功:</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="852b" class="kx je hi kt b fi ky kz l la lb">public string ReturnAdd(int x, int y)<br/>{<br/>   return (x + y).ToString();<br/>}<br/>public string ReturnMult(int x, int y)<br/>{<br/>   return (x * y).ToString();<br/>}<br/>//take 2 ints, return a string<br/>Func&lt;int, int, string&gt; myFunc = ReturnMult;<br/>myFunc += ReturnAdd;<br/>Console.WriteLine(myFunc(3,3));</span><span id="8147" class="kx je hi kt b fi lc kz l la lb">//the console will print 6, and if I change the order in which<br/>//they are assigned, 9. <strong class="kt hj">Last one in wins</strong></span></pre><p id="f68d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以这说不通，那还有什么意义呢？对于初学者来说，Func是一个委托对象，而不是一个方法，所以你可以传递它。你可以有这个，它会工作。</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="5063" class="kx je hi kt b fi ky kz l la lb">public void <strong class="kt hj">TakeAFunc( Func&lt;int,int,string&gt; arg)</strong><br/>{<br/>   Console.WriteLine(" in TakeAFunc");<br/>   Console.WriteLine(<strong class="kt hj">arg(3, 3)</strong>);<br/>}</span><span id="9f90" class="kx je hi kt b fi lc kz l la lb">Func&lt;int, int, string&gt; myFunc = ReturnMult;<br/>TakeAFunc(myFunc);</span></pre><p id="97ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就像你可以传递它一样，你也可以用对象做其他的事情。你也可以这样做。</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="ee67" class="kx je hi kt b fi ky kz l la lb">Func&lt;int, int, string&gt;? myFunc = null;<br/>var rand = new Random();<br/>int i = rand.Next(0, 10);<br/>if (i &lt; 5)<br/>{<br/>   myFunc = delegate (int x, int y)<br/>   {<br/>      return ((x * 10) * (y * 10)).ToString();<br/>   };<br/>}<br/>else<br/>{<br/>   myFunc = delegate (int x, int y)<br/>   {<br/>      return ((x + 10 + y).ToString());<br/>   };<br/>}<br/>Console.WriteLine(myFunc(3,3));</span></pre><p id="9341" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者更好，而不是在上面的赋值中使用委托方式:</p><pre class="kh ki kj kk fd ks kt ku kv aw kw bi"><span id="302d" class="kx je hi kt b fi ky kz l la lb">myFunc = (x, y) =&gt; { return ((x * 10) * (y * 10)).ToString(); };<br/>...<br/>myFunc = (x, y) =&gt; { return ((x + 10 + y).ToString()); };</span></pre><h1 id="75ff" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">带有事件关键字的操作</h1><p id="a8d5" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当您将动作创建为类中的事件时，它们被创建为字段，而不是具有get和set属性的属性。此外，它们在创建时被分配了一个委托，因此在调用它之前不需要检查是否为null。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/495403d5ab0ad1bd437b4abfbc424a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGHFmr6Vg7VViFhmpXGKAg.png"/></div></div></figure><h1 id="1d8e" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">如果要使用事件，请使用EventHandler而不是事件操作</h1><p id="16ea" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">处理事件的更好方法是使用EventHandler。它之所以更好，是因为它允许订阅者获得有关事件的数据。</p><p id="d20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们使用事件处理程序，我们可以使用的方法需要有参数<code class="du lf lg lh kt b">(Object sender, EventArgs e)</code></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es li"><img src="../Images/4ce150fa135746e5c480430b2bb121b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adYBW5Q3rHDzaJ8LvSDX7g.png"/></div></div></figure><p id="f5e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可能需要向这些方法传递一些定制的信息，我们可以通过创建一个从EventArgs继承的类来做到这一点。</p><p id="6faf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，事件是这样创建的:</p><p id="2411" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du lf lg lh kt b">private static event <strong class="ih hj">EventHandler&lt;MyEventArgs&gt;</strong> RaiseMyEvent=delegate{};</code></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es li"><img src="../Images/38e3dbc6c92dedf471d95112abd72914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kqdzr40r8rlc3eLt3ThutQ.png"/></div></div></figure><h1 id="d17d" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">处理异常</h1><p id="5f12" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">如果我们有不止一个订户，并且我们没有处理异常，会发生什么？</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lj"><img src="../Images/6beeffa2b28b756c84f6c7e447d60d89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F8OB95eQbmFh5dreG21gAA.png"/></div></div></figure><p id="dc3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以这样处理这个问题:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es le"><img src="../Images/d73965def4769b7fa2392287172382d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fOhGFPfuEo1QtcWXTTKQHQ.png"/></div></div></figure><p id="5f2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们不想在每个方法中都有try-catch块，我们也可以这样做:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es le"><img src="../Images/c984c036fdd4856406f8f5f49f78e50c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrHZ9SMbBYJtoiYII2mdNg.png"/></div></div></figure><p id="48d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些是我到目前为止对代表、行动和事件的笔记。</p><p id="96ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你读到这里，我希望这有所帮助。如果你认为有些事情不对劲或令人困惑，请告诉我。</p><p id="add9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>