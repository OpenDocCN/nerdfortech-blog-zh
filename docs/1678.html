<html>
<head>
<title>Image Classification using Lightning Flash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用闪电进行图像分类</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/image-classification-using-lightning-flash-e549b6c4285f?source=collection_archive---------6-----------------------#2021-04-01">https://medium.com/nerd-for-tech/image-classification-using-lightning-flash-e549b6c4285f?source=collection_archive---------6-----------------------#2021-04-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">问题陈述:</strong>生长在电线附近的树木可能会引起火灾，以及对在地面接触树木的任何人造成电击危险。树木并不一定要接触带电的电线才会有危险。在适当的条件下，电可以从电线传到附近的树上，比如附近雷击造成的电压浪涌。这种电流可以杀死任何靠近树的人，并可能引起火灾。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/76d56547ba6d05428c82f5edb25b28c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*yQLrDiMZrRs4LhIH8z7Zpg.png"/></div></figure><p id="398d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种电弧放电也会导致断电。与树有关的停电不仅仅是不便。这些不仅会中断对你家或企业的服务，还会中断对医院、应急中心和生命支持设备上的病人的供电。</p><p id="ff15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">目标</strong></p><p id="0a34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">建立一个机器学习模型，帮助电力部门检测电线和附近树木之间是否有任何交叉点，给定一个 spot 图像</p><p id="26a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">标签:</p><ul class=""><li id="911f" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated"><strong class="ih hj">交点</strong>值为<strong class="ih hj"> 1 </strong>，如果电线与附近的树木有交点</li><li id="74a6" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><strong class="ih hj">交点</strong>值为 0，如果如果电线和附近的树木之间没有交点</li></ul><p id="33bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong>:这里我们将使用闪电应用迁移学习来解决图像分类问题</p><h2 id="204b" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">闪电是什么？</h2><p id="bd29" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">Flash 是一个高级深度学习框架，用于快速原型化、基线化、微调和解决深度学习问题。它提供了一组任务供您进行推断和微调，并且提供了一个易于实现的 API 来定制该过程的每一步，以获得充分的灵活性。</p><p id="f4bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flash 是为初学者构建的，具有简单的 API，需要很少的深度学习背景，并且适合数据科学家、kagglers、应用 ML 实践者和深度学习研究人员，他们希望通过<a class="ae kz" href="https://github.com/PyTorchLightning/pytorch-lightning" rel="noopener ugc nofollow" target="_blank"> Pytorch Lightning </a>提供的高级功能快速获得深度学习基线。</p><p id="707e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flash 建立在<a class="ae kz" href="https://github.com/PyTorchLightning/pytorch-lightning" rel="noopener ugc nofollow" target="_blank"> Pytorch Lightning </a>之上，用于提取不必要的样板文件:</p><ul class=""><li id="6c42" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated">数据科学</li><li id="2177" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">卡格尔</li><li id="05e9" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">业务用例</li><li id="2b64" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">应用研究</li></ul><p id="4566" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Flash 是高级库，Lightning 是低级库。</p><ul class=""><li id="3d60" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated"><em class="la">闪光(高级)</em></li><li id="542b" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><em class="la">闪电(中级)</em></li><li id="da5e" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><em class="la"> PyTorch(低级)</em></li></ul><h2 id="28c1" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">为什么是 Flash？</h2><ul class=""><li id="95c8" class="jl jm hi ih b ii ku im kv iq lb iu lc iy ld jc jq jr js jt bi translated">易于学习、提升技能和扩展</li><li id="ab40" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">到达基线的最快方法</li></ul><p id="0881" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是与 Keras 最相似的抽象层次</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/792925bf05f1576bfd2f071a8f128e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bjmuFkb4lmNEqJ8rDBA7JA.png"/></div></div></figure><p id="662d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基本上，当使用一个几乎不需要深度学习和 PyTorch 知识的任务时，它是有帮助的。重点是尽快解决问题。这非常适合:</p><ul class=""><li id="238c" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated">数据科学</li><li id="e051" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">分析</li><li id="ee56" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">应用研究</li></ul><h2 id="3093" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">解决方法</h2><h2 id="34e3" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">安装 Pytorch 闪电和其他所需的软件包</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="bd5a" class="jz ka hi lk b fi lo lp l lq lr">%%capture<br/>!Pytorch Lightning Flash</span></pre><h1 id="e9e4" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">安装所需的库</h1><p id="267b" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在[22]中:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="09d7" class="jz ka hi lk b fi lo lp l lq lr">!pip install torchtext==0.8.0 torch==1.7.1 pytorch-lightning==1.2.6</span><span id="912a" class="jz ka hi lk b fi mj lp l lq lr">!pip install lightning-flash -U</span></pre><h2 id="9926" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">导入 Pytorch Lightning 包</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="412c" class="jz ka hi lk b fi lo lp l lq lr"><em class="la"># pytorch lightning</em><br/><strong class="lk hj">import</strong> <strong class="lk hj">pytorch_lightning</strong> <strong class="lk hj">as</strong> <strong class="lk hj">pl</strong><br/><strong class="lk hj">from</strong> <strong class="lk hj">pytorch_lightning.metrics.functional</strong> <strong class="lk hj">import</strong> accuracy<br/><strong class="lk hj">from</strong> <strong class="lk hj">pytorch_lightning.callbacks</strong> <strong class="lk hj">import</strong> ModelCheckpoint,EarlyStopping<br/><strong class="lk hj">from</strong> <strong class="lk hj">pl_bolts.models.self_supervised</strong> <strong class="lk hj">import</strong> SwAV<br/><em class="la">#pytorch</em><br/><strong class="lk hj">import</strong> <strong class="lk hj">torch</strong><br/><strong class="lk hj">from</strong> <strong class="lk hj">torch</strong> <strong class="lk hj">import</strong> nn<br/><strong class="lk hj">import</strong> <strong class="lk hj">torch.nn.functional</strong> <strong class="lk hj">as</strong> <strong class="lk hj">F</strong><br/><strong class="lk hj">from</strong> <strong class="lk hj">torch</strong> <strong class="lk hj">import</strong> optim<br/><strong class="lk hj">from</strong> <strong class="lk hj">torch.utils.data</strong> <strong class="lk hj">import</strong> DataLoader,random_split<br/><strong class="lk hj">from</strong> <strong class="lk hj">torchvision</strong> <strong class="lk hj">import</strong> models,transforms,datasets</span></pre><h1 id="2a73" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">导入所需的库</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="3aad" class="jz ka hi lk b fi lo lp l lq lr"><strong class="lk hj">import</strong> <strong class="lk hj">flash</strong><br/><strong class="lk hj">from</strong> <strong class="lk hj">flash</strong> <strong class="lk hj">import</strong> download_data<br/><strong class="lk hj">from</strong> <strong class="lk hj">flash.vision</strong> <strong class="lk hj">import</strong> ImageClassificationData, ImageClassifier<br/>print(flash.__version__)#0.2.1<br/><em class="la">#</em><br/><strong class="lk hj">from</strong> <strong class="lk hj">torch</strong> <strong class="lk hj">import</strong> nn, optim<br/><strong class="lk hj">from</strong> <strong class="lk hj">torch.utils.data</strong> <strong class="lk hj">import</strong> DataLoader, random_split<br/><strong class="lk hj">from</strong> <strong class="lk hj">torchvision</strong> <strong class="lk hj">import</strong> transforms, datasets<br/><strong class="lk hj">import</strong> <strong class="lk hj">pytorch_lightning</strong> <strong class="lk hj">as</strong> <strong class="lk hj">pl</strong><br/>print(pl.__version__)#1.2.0rc0</span></pre><h2 id="6dbd" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">下载图片</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="f9a2" class="jz ka hi lk b fi lo lp l lq lr"><strong class="lk hj">from</strong> <strong class="lk hj">google_drive_downloader</strong> <strong class="lk hj">import</strong> GoogleDriveDownloader <strong class="lk hj">as</strong> gdd<br/><br/>gdd.download_file_from_google_drive(file_id='1ahtCipPXsX9BVRWi6nDG13tr4b_rMY97',<br/>dest_path='content/detect_trees_near_electric_wires.zip',<br/>unzip=<strong class="lk hj">True</strong>)</span></pre><h2 id="bd12" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">导入 Python 和相应的数据处理库</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="deb0" class="jz ka hi lk b fi lo lp l lq lr"><strong class="lk hj">import</strong> <strong class="lk hj">pandas</strong> <strong class="lk hj">as</strong> <strong class="lk hj">pd</strong> <em class="la"># Data analysis and manipultion tool</em><br/><strong class="lk hj">import</strong> <strong class="lk hj">numpy</strong> <strong class="lk hj">as</strong> <strong class="lk hj">np</strong> <em class="la"># Fundamental package for linear algebra and multidimensional arrays</em><br/><strong class="lk hj">import</strong> <strong class="lk hj">os</strong> <em class="la"># OS module in Python provides a way of using operating system dependent functionality</em><br/><strong class="lk hj">import</strong> <strong class="lk hj">shutil</strong><br/><strong class="lk hj">import</strong> <strong class="lk hj">cv2</strong> <em class="la"># Library for image processing</em><br/><strong class="lk hj">from</strong> <strong class="lk hj">sklearn.model_selection</strong> <strong class="lk hj">import</strong> train_test_split <em class="la"># For splitting the data into train and validation set</em></span></pre><h2 id="233c" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">加载和准备培训数据</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="4825" class="jz ka hi lk b fi lo lp l lq lr">train = pd.read_csv("/content/content/detect_trees_near_electric_wires/train.csv") <em class="la"># loading the labels</em><br/>train.head() <em class="la"># will display the first five rows in labels dataframe</em></span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mk"><img src="../Images/ddf432fe7ab88c484694260c62f3536e.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*rAVClpReRg0bluaZsCzTiw.png"/></div></figure><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="2e2b" class="jz ka hi lk b fi lo lp l lq lr">test  = pd.read_csv("/content/content/detect_trees_near_electric_wires/Test.csv")<br/>test.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ml"><img src="../Images/c30a43333ac9f34937e48aa6b74c9642.png" data-original-src="https://miro.medium.com/v2/resize:fit:310/format:webp/1*FZWsj8ayRBpnALX7YPvuOA.png"/></div></figure><h2 id="a3fa" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">检查训练数据是否平衡</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mm"><img src="../Images/7b869774136d94aebe6e864c2755ed95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*_iZc9By9Kxq_r1_2V1Ivew.png"/></div></figure><h2 id="6fc9" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">数据可视化—训练图像</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es mn"><img src="../Images/f49ae2d773bde53ba41fce6960be22c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4edOH_4bOsgFzUHVZ5JchQ.png"/></div></div></figure><h2 id="8d6d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">数据可视化—验证图像</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es mo"><img src="../Images/0abb6d59568cfaf94d405ab879d1cfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lVTCu75RabSwVEqA6Jsteg.png"/></div></div></figure><h1 id="bf66" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">训练数据预处理步骤</h1><ul class=""><li id="13a2" class="jl jm hi ih b ii ku im kv iq lb iu lc iy ld jc jq jr js jt bi translated"><strong class="ih hj">列车试分裂</strong></li><li id="fd37" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><strong class="ih hj">将图像移动到各自的文件夹中</strong></li><li id="4d10" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><strong class="ih hj">文件夹号—无交集</strong></li><li id="5556" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><strong class="ih hj">文件夹是—存在交集</strong></li></ul><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="6622" class="jz ka hi lk b fi lo lp l lq lr">!mkdir "/content/content/detect_trees_near_electric_wires/train/No"<br/>!mkdir "/content/content/detect_trees_near_electric_wires/train/Yes"</span><span id="26c6" class="jz ka hi lk b fi mj lp l lq lr">!mkdir "/content/content/detect_trees_near_electric_wires/val"<br/>!mkdir "/content/content/detect_trees_near_electric_wires/val/No"<br/>!mkdir "/content/content/detect_trees_near_electric_wires/val/Yes"</span><span id="f109" class="jz ka hi lk b fi mj lp l lq lr">train_data,val_data= train_test_split(train,test_size=0.1,stratify=train['Intersection'],random_state=42)</span><span id="3b07" class="jz ka hi lk b fi mj lp l lq lr">print(train_data.shape,val_data.shape)</span><span id="9fdb" class="jz ka hi lk b fi mj lp l lq lr">train_data.Intersection.value_counts(normalize=<strong class="lk hj">True</strong>)</span></pre><p id="0993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="b093" class="jz ka hi lk b fi lo lp l lq lr">1    0.57286<br/>0    0.42714<br/>Name: Intersection, dtype: float64</span><span id="f94f" class="jz ka hi lk b fi mj lp l lq lr">val_data.Intersection.value_counts(normalize=<strong class="lk hj">True</strong>)</span></pre><p id="2238" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输出:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="0263" class="jz ka hi lk b fi lo lp l lq lr">1    0.572414<br/>0    0.427586<br/>Name: Intersection, dtype: float64</span></pre><h1 id="021f" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">加载数据并创建数据管道</h1><p id="88de" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><code class="du mp mq mr lk b"><a class="ae kz" href="https://lightning-flash.readthedocs.io/en/latest/reference/image_classification.html#flash.vision.ImageClassifier" rel="noopener ugc nofollow" target="_blank">ImageClassifier</a></code>已经在<a class="ae kz" href="http://www.image-net.org/" rel="noopener ugc nofollow" target="_blank"> ImageNet </a>上进行了预训练，这是一个超过 1400 万张图像的数据集。使用<code class="du mp mq mr lk b"><a class="ae kz" href="https://lightning-flash.readthedocs.io/en/latest/reference/image_classification.html#flash.vision.ImageClassifier" rel="noopener ugc nofollow" target="_blank">ImageClassifier</a></code>预训练模型，通过<code class="du mp mq mr lk b">predict()</code>对任何字符串序列进行推理</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="652d" class="jz ka hi lk b fi lo lp l lq lr">datamodule = ImageClassificationData.from_folders(<br/>    train_folder="/content/content/detect_trees_near_electric_wires/train/",<br/>    valid_folder="/content/content/detect_trees_near_electric_wires/val/",<br/>    predict_folder = "/content/content/detect_trees_near_electric_wires/test"</span><span id="32a6" class="jz ka hi lk b fi mj lp l lq lr">)</span></pre><h1 id="2dd2" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">确定类别/标签的数量</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="0d7a" class="jz ka hi lk b fi lo lp l lq lr">datamodule.num_classes #returns the number of unique labels or classes</span></pre><h1 id="5c1a" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">建立模型</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="63c9" class="jz ka hi lk b fi lo lp l lq lr"><em class="la">#model = ImageClassifier(backbone="densenet121", num_classes=datamodule.num_classes)</em><br/>model = ImageClassifier(backbone="resnet34", num_classes=datamodule.num_classes,learning_rate=0.001,optimizer=optim.Adam)</span></pre><h1 id="ccd7" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">创建培训师。对训练数据运行 25 个时期</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="ca94" class="jz ka hi lk b fi lo lp l lq lr">trainer = flash.Trainer(max_epochs=25,gpus=1)</span></pre><h1 id="a9b1" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">训练模型</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="7d76" class="jz ka hi lk b fi lo lp l lq lr">trainer.finetune(model, datamodule=datamodule, strategy="freeze_unfreeze")</span><span id="b5e4" class="jz ka hi lk b fi mj lp l lq lr">| Name     | Type       | Params<br/>----------------------------------------<br/>0 | metrics  | ModuleDict | 0     <br/>1 | backbone | Sequential | 21.3 M<br/>2 | head     | Sequential | 1.0 K <br/>----------------------------------------<br/>1.0 K     Trainable params<br/>21.3 M    Non-trainable params<br/>21.3 M    Total params<br/>85.143    Total estimated model params size (MB)</span></pre><h1 id="6fce" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">验证准确性</h1><ul class=""><li id="dc84" class="jl jm hi ih b ii ku im kv iq lb iu lc iy ld jc jq jr js jt bi translated">10 个时期值精度= 64.5% — Densenet121</li><li id="2a25" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">25 个历元值精度= 67.5% — Densenet121</li><li id="c119" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated">25 个历元值精度= 73.6% — resnet34</li></ul><h2 id="0c9d" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">训练模型</h2><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="a431" class="jz ka hi lk b fi lo lp l lq lr">trainer.fit(model,datamodule=datamodule,)</span></pre><h1 id="5d78" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">保存模型</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="b341" class="jz ka hi lk b fi lo lp l lq lr">trainer.save_checkpoint("image_classification_model.pt")</span></pre><h1 id="aef4" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">从检查点加载模型</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="d4b8" class="jz ka hi lk b fi lo lp l lq lr">model = ImageClassifier.load_from_checkpoint("/content/image_classification_model.pt")</span></pre><h1 id="88fd" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">对看不见的图像进行预测</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="48ac" class="jz ka hi lk b fi lo lp l lq lr">predictions = model.predict(test.file_name.values.tolist())</span><span id="d6ff" class="jz ka hi lk b fi mj lp l lq lr"><strong class="lk hj">import</strong> <strong class="lk hj">seaborn</strong> <strong class="lk hj">as</strong> <strong class="lk hj">sns</strong><br/>sns.countplot(predictions)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ms"><img src="../Images/be1690a0b6caa5d624a040d52ac19ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*Ae7jbokZ5dYeYpg0r90Fgg.png"/></div></figure><h1 id="dabe" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">下载预测以供提交</h1><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="2db5" class="jz ka hi lk b fi lo lp l lq lr">res = pd.DataFrame({'prediction': predictions}) <em class="la"># prediction is nothing but the final predictions of your model on input features of your new unseen test data</em><br/>res.to_csv("submission_flash.csv", index = <strong class="lk hj">False</strong>)</span><span id="3f70" class="jz ka hi lk b fi mj lp l lq lr"><em class="la"># To download the csv file locally</em><br/><strong class="lk hj">from</strong> <strong class="lk hj">google.colab</strong> <strong class="lk hj">import</strong> files<br/>files.download('submission_flash.csv')</span></pre><h1 id="e212" class="ls ka hi bd kb lt lu lv kf lw lx ly kj lz ma mb km mc md me kp mf mg mh ks mi bi translated">提交分数</h1><p id="2e21" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><strong class="ih hj">提交成功！你的分数是 69.57298201936。- Resnet34 </strong></p><h2 id="db34" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">参考资料:</h2><div class="mt mu ez fb mv mw"><a href="https://lightning-flash.readthedocs.io/en/latest/reference/image_classification.html#" rel="noopener  ugc nofollow" target="_blank"><div class="mx ab dw"><div class="my ab mz cl cj na"><h2 class="bd hj fi z dy nb ea eb nc ed ef hh bi translated">图像分类- Flash 文档</h2><div class="nd l"><h3 class="bd b fi z dy nb ea eb nc ed ef dx translated">识别图像中的内容的任务称为图像分类。通常，图像分类用于…</h3></div><div class="ne l"><p class="bd b fp z dy nb ea eb nc ed ef dx translated">闪电闪电. readthedocs.io</p></div></div></div></a></div><p id="ec8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">数据来源:</strong><a class="ae kz" href="https://dphi.tech/challenges/data-sprint-28-detect-trees-near-electric-wires/68/overview/about" rel="noopener ugc nofollow" target="_blank">https://dphi . tech/challenges/Data-sprint-28-detect-trees-near-electric-wires/68/overview/about</a></p></div></div>    
</body>
</html>