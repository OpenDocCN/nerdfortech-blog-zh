<html>
<head>
<title>Predicting Customer Churn for a Music Streaming Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">预测音乐流媒体服务的客户流失</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/predicting-customer-churn-for-music-streaming-service-sparkify-3e281a93273?source=collection_archive---------4-----------------------#2021-07-31">https://medium.com/nerd-for-tech/predicting-customer-churn-for-music-streaming-service-sparkify-3e281a93273?source=collection_archive---------4-----------------------#2021-07-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="1219" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">数据科学矿</h2><div class=""/><div class=""><h2 id="ca07" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">对于企业来说，客户流失可能很棘手——机器学习可以有所帮助！</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/d2d5853e16e9c6c9c14fe824864ab8e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0tHXjLSkE3rJoLPQW1oKw.jpeg"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">📷— <a class="ae jw" href="https://unsplash.com/@thefakebhogra?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">西达尔特·博格拉</a></figcaption></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jx"><img src="../Images/13598143669244a5be131c86a6e4d9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZvmmVqveS2XurbxMlLPUg.png"/></div></div></figure><h1 id="2645" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">项目概述</h1><p id="c0ec" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">这个项目涉及一个虚构的、以用户为中心的音乐流媒体服务“Sparkify”(类似于 Spotify)。目的是利用机器学习来预测<strong class="ks hs">客户流失</strong>，甚至在它实际发生之前，以便 Sparkify 可以采取措施来检查它。</p><blockquote class="lm ln lo"><p id="f70f" class="kq kr lp ks b kt lq is kv kw lr iv ky ls lt lb lc lu lv lf lg lw lx lj lk ll hb bi translated"><strong class="ks hs">什么是客户流失？— </strong>流失率(也称为“损耗率”)是客户停止与某个实体做生意的比率。</p></blockquote><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es ly"><img src="../Images/e33f7db7a32ec47cdc5add2e42fed318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9zeJ56Led1bV9C7rJwJ5mA.png"/></div></figure><p id="931e" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">这里记录了方法、手段和结论。要了解项目代码本身，请点击这里的<a class="ae jw" href="https://github.com/nazianafis/Sparkify-Churn-Prediction" rel="noopener ugc nofollow" target="_blank"/>。</p><h1 id="31a4" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">问题陈述</h1><p id="cb45" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">企业需要留住他们的客户才能兴旺发达。因此，流失(失去客户的过程)是一个重要的商业问题。</p><p id="8e3e" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">我们得到了 Sparkify 用户的数据集，以及一些属性。我们的目标是预测用户是否会流失。为此，我们将首先找到属性之间的相关性，以确定哪些因素会导致用户流失。接下来，我们将以一定的置信度对给定用户进行预测。</p><h1 id="1acf" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">韵律学</h1><p id="1a88" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated"><em class="lp">spark ify-Churn-prediction . ipynb</em>是包含所有代码的主要 ipython 笔记本。它从<em class="lp"> pyspark </em>和<em class="lp"> time </em>库中导入多个模块。随机种子被选为 42。对于我们的业务问题，客户流失被定义为拥有“取消确认”页面的用户。</p><p id="8c9f" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">在特征工程中，<strong class="ks hs">多重共线性</strong>(强相关特征)，特别是<strong class="ks hs">相关性&gt; = 0.8 </strong>被去除，这样我们就剩下 43 个特征。然后对特征进行变换，使其更接近正态分布。整个特征工程代码已经过编译，以便以后用于处理更大的数据集。</p><p id="5db7" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><strong class="ks hs"> F1 分数</strong>用作评估指标。基于朴素预测器、逻辑回归和随机森林分类器构建、训练和评估机器学习管道。记录模型在训练和测试数据集上的性能，并相应地调整超参数。</p><h1 id="2493" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">数据探索和可视化</h1><p id="5357" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">这个项目的数据集由 Udacity 提供。有 3 个数据集可用:</p><ul class=""><li id="c6b5" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">亚马逊 EMR 集群上提供完整的数据集(~12GB)，</li><li id="2429" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated"><strong class="ks hs">中型</strong>数据集在 IBM Watson 集群上可用，并且</li><li id="d794" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated"><strong class="ks hs">本地可用的迷你</strong>数据集(~128MB)。</li></ul><p id="5ed4" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">该项目使用迷你数据集来适应数据，并执行所有必要的准备工作。稍后，我们将针对整个数据集对其进行扩展，并将其部署在<strong class="ks hs"> Amazon EMR </strong>集群上。</p><p id="a041" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">我们使用<strong class="ks hs"> Apache Spark </strong>分析引擎来处理大型数据集。我们做了一些探索性的分析，并使用了两个机器学习模型，除了朴素预测:逻辑回归和随机森林。</p><h1 id="aac0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">步骤 1:探索性数据分析</h1><h2 id="02a4" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">1.1 数据集概述</h2><p id="913d" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">数据集包含用户人口统计信息(例如用户名、性别、位置)和活动(例如听的歌曲、事件类型、使用的设备)。</p><p id="7cd8" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">数据集中有 286000 行具有以下属性:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es na"><img src="../Images/8e04d6e137faba423770a021d2bd9f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*7F-i0YUoaLLZbqSu1__aHQ.png"/></div></figure><h2 id="314a" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">1.2 定义客户流失</h2><p id="6e72" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">对于我们的项目，我们将流失定义为拥有<strong class="ks hs">【取消确认】</strong>页面的用户。</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="5a6e" class="mn jz hi nc b fi ng nh l ni nj">flag_churn_event = udf(lambda x: 1 if x == <strong class="nc hs">"Cancellation Confirmation"</strong> else 0, IntegerType())</span></pre><p id="4e1c" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">我们发现<strong class="ks hs"> 23.1% </strong>的用户有过不愉快的经历。</p><h2 id="3d41" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">1.3 比较非流失用户和流失用户的行为</h2><p id="25c2" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated"><strong class="ks hs"> 1.3.1 按用户级别:</strong>有两个用户级别:<em class="lp">免费</em>和<em class="lp">付费</em>。探索性分析发现，免费用户比付费用户多，而且免费用户的流失率略高于付费用户。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nk"><img src="../Images/edc9500103a620671e9a577a7872a194.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*0jf1R5UHyIGwLZ6_azPGXw.png"/></div></figure><p id="d244" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">虽然免费用户有更多的人口，但他们贡献的页面访问量比付费用户少得多，这意味着付费用户更热衷于这项服务。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nl"><img src="../Images/343f6c66e2fe30749f7f2a0e35d63a8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*aB-tTQ1axotn5YgjDVhcHw.png"/></div></figure><p id="85e1" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><strong class="ks hs"> 1.3.2 按星期几:</strong>与周末相比，大多数用户在工作日登录。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nm"><img src="../Images/6acc542f3c5dbea5ed0c4621d5b3d0ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6SrxSZakFqsoHrhbelK7oQ.png"/></div></div></figure><p id="7db9" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><strong class="ks hs"> 1.3.3 按页面事件:</strong> <em class="lp"> NextSong </em>、<em class="lp">竖起大拇指</em>和<em class="lp">添加到播放列表</em>是三个最经常出现的页面事件，这表明 Sparkify <em class="lp"> </em>是一个很受欢迎的服务，具有很大程度上的积极互动。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nn"><img src="../Images/0760687dc75074b39995203223644ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmMuaniIZ0gO2nZ-qJGd_g.png"/></div></div></figure><p id="f92d" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><strong class="ks hs"> 1.3.4 按拇指向上/拇指向下:</strong>拇指向下多的用户比同行更有流失倾向，扩展了不满意的用户更容易流失的逻辑。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es no"><img src="../Images/f1626cbc48d15819cd07359df30a0151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*chUqbTuHTqXtHRduNzDmfQ.png"/></div></figure><h1 id="6671" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">步骤 2:特征工程</h1><h2 id="531e" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">步骤 2.1 创建用于训练模型的特征</h2><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es np"><img src="../Images/62a498e2aa6ed2800370a749a7b7706d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SQSp62o4Au7eeT5QXCxWLA.png"/></div></div></figure><ul class=""><li id="2cba" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">用户的最新级别(免费/付费)</li></ul><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="b24b" class="mn jz hi nc b fi ng nh l ni nj">func_levels = udf(lambda x: 1 if x=="paid" else 0, IntegerType())<br/>levels = df_sub2.select(['userId', 'level', 'ts'])\<br/>    .orderBy(desc('ts'))\<br/>    .dropDuplicates(['userId'])\<br/>    .select(['userId', 'level'])\<br/>    .withColumn('level', func_levels('level').cast(IntegerType()))</span></pre><ul class=""><li id="6bfa" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">用户参与的时间量、艺术家数量、歌曲数量和会话数量</li></ul><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="9d96" class="mn jz hi nc b fi ng nh l ni nj">engagement = df.groupBy('userId')\<br/>    .agg(<br/>         countDistinct('artist').alias('num_artists_dist'), <br/>         countDistinct('sessionId').alias('num_sessions'),<br/>         countDistinct('song').alias('num_songs_dist'),<br/>         count('song').alias('num_songs'),<br/>         count('page').alias('num_events'),<br/>         Fsum('length').alias('tot_length'))</span></pre><ul class=""><li id="bb06" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">每位艺术家所听歌曲数量的平均值和标准偏差</li></ul><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="6597" class="mn jz hi nc b fi ng nh l ni nj">per_artist = df.filter(~df['artist'].isNull())\<br/>    .groupBy(['userId', 'artist'])\<br/>    .agg(count('song').alias('num_songs'))\<br/>    .groupBy('userId')\<br/>    .agg(avg(col('num_songs')).alias('avg_songs_per_artist'),<br/>         stddev(col('num_songs')).alias('std_songs_per_artist')<br/>    ).fillna(0)</span></pre><ul class=""><li id="e169" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">每次听的歌曲数量的平均值和标准偏差，以及每次听的时间</li></ul><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="eef2" class="mn jz hi nc b fi ng nh l ni nj">per_session = df.groupBy(['userId', 'sessionId'])\<br/>    .agg(<br/>         max('ts'), <br/>         min('ts'), <br/>         count('song').alias('num_songs')<br/>    )\<br/>    .withColumn('time', (col('max(ts)')-col('min(ts)'))/lit(1000))\<br/>    .groupBy('userId')\<br/>    .agg(<br/>         stddev(col('time')).alias('std_time_per_session'), <br/>         avg(col('time')).alias('avg_time_per_session'),<br/>         stddev(col('num_songs')).alias('std_songs_per_session'),<br/>         avg(col('num_songs')).alias('avg_songs_per_session')<br/>    ).fillna(0)</span></pre><p id="ec2d" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><strong class="ks hs">将工程特征结合在一起:</strong></p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="f888" class="mn jz hi nc b fi ng nh l ni nj">dataset = churn.join(levels, ['userId'])\<br/>    .join(time_gender, ['userId'])\<br/>    .join(engagement, ['userId'])\<br/>    .join(per_artist, ['userId'])\<br/>    .join(per_session, ['userId'])\<br/>    .join(agents, ['userId'])\<br/>    .join(pages, ['userId'])\<br/>    .join(locations, ['userId'])</span></pre><h2 id="2bcc" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">步骤 2.2 检查多重共线性</h2><p id="ebf3" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们评估每对特征之间的相关性，并移除与任何其他特征的相关性大于 0.8 的任何特征。</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="b9ae" class="mn jz hi nc b fi ng nh l ni nj">corr = dataset_pd[correlated_cols].corr()<br/>cols_to_remove = []<br/>counter = 0<br/>for coln in corr.columns:<br/>    counter += 1<br/>    <strong class="nc hs">if corr[coln].iloc[counter:].max() &gt;= 0.8:</strong><br/>        cols_to_remove.append(coln)<br/>print(f"Highly correlated features that should be removed:\n\n{cols_to_remove}\n\n")<br/>cols_to_keep = dataset_pd.columns.drop(cols_to_remove).tolist()<br/>print(f"Features to keep:\n\n{cols_to_keep}")</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nq"><img src="../Images/365c1d797b28897dfc8d0cc5d4b32fd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9_fQQjbQAV3Xb3yBxtrDZQ.png"/></div></div></figure><h2 id="2eaf" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">步骤 2.3 特征转换</h2><p id="924c" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们对倾斜特征应用对数变换，以使它们的分布更接近正态分布。</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="6e0e" class="mn jz hi nc b fi ng nh l ni nj">for col_name in col_names:<br/>    if col_name in columns_to_transform:<br/>        dataset = dataset.withColumn(<br/>            col_name, log(dataset[col_name]+1)<br/>        )</span></pre><p id="33ec" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">这是我们得到的结果:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nr"><img src="../Images/fd7e2985a9a44fdc31eebb65d15b0229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9A7ru0SvilZ9Qlsl_OpY0A.png"/></div></div></figure><h1 id="2827" class="jy jz hi bd ka kb kc kd ke kf kg kh ki ix kj iy kk ja kl jb km jd kn je ko kp bi translated">第三步:机器学习</h1><p id="359a" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们的机器学习模型的目标是根据之前再造的特征来预测流失(<em class="lp"> label=1 </em>)对非流失(<em class="lp"> label=0 </em>)。</p><h2 id="ecec" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">3.1 列车测试分割</h2><p id="7bf2" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们将数据集按 80-20 的比例分割，用于训练和测试。</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="e351" class="mn jz hi nc b fi ng nh l ni nj">train, test = dataset.drop('userId').randomSplit([0.8, 0.2], seed=42)</span></pre><h2 id="2b50" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">3.2 评估指标</h2><p id="f746" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">被搅动的用户是一个很小的子集(23%)。如果我们试图建立一个简单预测“无流失”的模型，它将具有相当好的准确性(77%)，但性能非常差。</p><p id="f5a5" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">因此，我们使用 F1 分数作为评估标准，而不是准确性。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ns"><img src="../Images/97058641eb8e3bc9bb6eb74be755f826.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*moXhv-aLwqeVtkkbKsXWkA.png"/></div></div></figure><p id="906a" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">在预测客户流失时，<em class="lp"> precision </em>旨在确保它确实是一个客户流失，而<em class="lp"> recall </em>旨在不遗漏任何真正的客户流失。F1 在<em class="lp">精度</em>和<em class="lp">召回</em>之间取平均值，因此给出了一个平衡的前景。</p><h2 id="0bfa" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">3.3 火花管道和功能</h2><p id="de70" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">在训练-测试分离之后，我们创建一个 PySpark 机器学习管道，包括:</p><ul class=""><li id="b5d2" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">VectorAssembler，用于对输入要素进行矢量化</li><li id="8811" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">MaxAbsScaler，它将每个要素重新缩放到范围[-1，1]</li><li id="9263" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">选择的分类器，在这种情况下是多分类评估器</li></ul><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="9185" class="mn jz hi nc b fi ng nh l ni nj">def buildCV(classifier, paramGrid):<br/>    # Configure an ML pipeline<br/>    assembler = <strong class="nc hs">VectorAssembler</strong>(inputCols=feature_cols, outputCol="rawFeatures")<br/>    scaler = <strong class="nc hs">MaxAbsScaler</strong>(inputCol="rawFeatures", outputCol="scaledFeatures")<br/><br/>    # Cross validation<br/>    crossval = CrossValidator(<br/>        estimator=pipeline,<br/>        estimatorParamMaps=paramGrid,<br/>       evaluator=<strong class="nc hs">MulticlassClassificationEvaluator</strong>(metricName='f1'),<br/>        numFolds=3)</span><span id="f0a9" class="mn jz hi nc b fi nt nh l ni nj">    return crossval</span></pre><h2 id="ac0a" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">3.4 模型评估和验证</h2><p id="14c2" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们使用以下分类器的默认超参数来比较它们的模型性能。</p><ul class=""><li id="4dfe" class="lz ma hi ks b kt lq kw lr kz mb ld mc lh md ll me mf mg mh bi translated">朴素预测器，它总是预测无流失</li><li id="8ced" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">逻辑回归，以及</li><li id="825f" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">随机森林分类器。</li></ul><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nu"><img src="../Images/6e4c0dcebfe0b27a70ad13d2cc43b0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgHXwJSTef04AfXzbKVHuw.png"/></div></div></figure><p id="b020" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">朴素模型设置了模型性能的基线，F1 = 0.67，精度= 0.77。不出所料，这两个机器学习分类器的性能优于朴素模型。<strong class="ks hs">随机森林</strong>在训练集(F1 = 0.92，准确率= 0.93)和测试集(F1 = 0.74，准确率= 0.76)上取得了最好的性能。</p><h2 id="c9a0" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">超参数调整和优化</h2><p id="192e" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">我们在随机森林分类器上使用<strong class="ks hs">网格搜索</strong>来调整超参数。</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="19b4" class="mn jz hi nc b fi ng nh l ni nj">classifier = RandomForestClassifier(labelCol='label',\<br/>             featuresCol='scaledFeatures')</span><span id="3c41" class="mn jz hi nc b fi nt nh l ni nj">paramGrid = ParamGridBuilder()\<br/>            .addGrid(classifier.numTrees,[20,75])\<br/>            .addGrid(classifier.maxDepth,[10,20])\<br/>            .build()</span></pre><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nv"><img src="../Images/c696cf10b4597f86c5ade117a57f9e1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*a60j6mo8igLByO64j2I39w.png"/></div></figure><p id="7d88" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">在网格搜索之后，我们获得了改进的 F1 分数，对于训练数据集从 0.921 到 1.0，对于测试数据集从 0.744 到 0.796。准确度也有所提高，训练数据集的准确度从 0.927 提高到 1.0，测试数据集的准确度从 0.765 提高到 0.824。</p><p id="6a55" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">最佳参数:</p><pre class="jh ji jj jk fd nb nc nd ne aw nf bi"><span id="342d" class="mn jz hi nc b fi ng nh l ni nj">maxDepth:10<br/>numTrees:75</span></pre><h2 id="35e3" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated"><strong class="ak">识别最重要的特征</strong></h2><p id="75fc" class="pw-post-body-paragraph kq kr hi ks b kt ku is kv kw kx iv ky kz la lb lc ld le lf lg lh li lj lk ll hb bi translated">客户流失预测中最重要的特征是自用户注册以来的时间，用户遇到的广告数量，以及用户给出的赞成/反对的次数。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nw"><img src="../Images/28012a7c4d1a48037625384164f38cf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejmnSdkzQS5IcmlgEDsIpA.png"/></div></div></figure></div><div class="ab cl nx ny gp nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hb hc hd he hf"><h1 id="79aa" class="jy jz hi bd ka kb oe kd ke kf of kh ki ix og iy kk ja oh jb km jd oi je ko kp bi translated">结论</h1><ul class=""><li id="b8c1" class="lz ma hi ks b kt ku kw kx kz oj ld ok lh ol ll me mf mg mh bi translated">我们的机器学习模型能够相当好地预测客户流失(f1 得分为 0.74)。通过调整超参数或引入附加特征，可以进一步提高模型性能。</li><li id="055f" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">流失预测中最重要的特征是自用户注册以来的时间、用户遇到的广告数量以及用户给出的竖起大拇指/竖起大拇指的次数。</li><li id="6f78" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">Sparkify 可以利用这些信息来制定一个关于要采取什么行动的计划。减少广告数量可能是其中之一。另一个可能是弄清楚为什么相对较新的客户会有更多的搅动。</li><li id="71ed" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">Sparkify 也可以看看它的竞争对手——新客户被他们吸引了吗？他们觉得那里有什么吸引人的地方？是直观的界面，还是更好的音乐推荐，还是完全不同的东西？这些发现可以整合到现有的 Sparkify 服务中。将需要 A/B 测试来统计评估每个行动的成本效益分析。</li></ul><h2 id="fac6" class="mn jz hi bd ka mo mp mq ke mr ms mt ki kz mu mv kk ld mw mx km lh my mz ko ho bi translated">丰富</h2><ul class=""><li id="1b03" class="lz ma hi ks b kt ku kw kx kz oj ld ok lh ol ll me mf mg mh bi translated">我们在数据集上使用了逻辑回归和随机森林分类器模型。为了进一步改进，<strong class="ks hs"> XGBoost </strong>和<strong class="ks hs"> LightGBM </strong>模型在我们的场景中可能是一些很好的监督学习方法。</li><li id="a776" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">在将所有功能聚合到用户级别上时，我们还认识到一个关键问题——一些用户可能会冲动，如果他们在上次操作中有一点点不满意的体验，他们就会转到取消页面进行流失。</li><li id="1161" class="lz ma hi ks b kt mi kw mj kz mk ld ml lh mm ll me mf mg mh bi translated">在这种情况下，我们需要知道每个用户操作的时间顺序，以便更好地理解 Sparkify 的用户体验。因此，将数据视为一个<strong class="ks hs">时间序列</strong>可以提供更接近现实的结果。如果我们决定将数据视为时间序列，<strong class="ks hs">递归神经网络</strong>可能是一个很好的建模选择。</li></ul></div><div class="ab cl nx ny gp nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hb hc hd he hf"><p id="8218" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">仅此而已！我鼓励你深入研究完整的数据集，并从中得出更多的分析。你也可以在这里看看我的 GitHub <a class="ae jw" href="https://github.com/nazianafis/Sparkify-Churn-Prediction" rel="noopener ugc nofollow" target="_blank">里的代码。放心叉吧，踏上自己的数据探索之旅！</a></p></div><div class="ab cl nx ny gp nz" role="separator"><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc od"/><span class="oa bw bk ob oc"/></div><div class="hb hc hd he hf"><p id="959e" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated">我希望这篇文章对你有用。可以在 LinkedIn   <em class="lp">上联系我</em> <a class="ae jw" href="http://linkedin.com/in/nazianafis" rel="noopener ugc nofollow" target="_blank"> <em class="lp">，或者关注我的著作</em> </a><a class="ae jw" href="https://nazianafis.medium.com/" rel="noopener"> <em class="lp">这里</em> </a> <em class="lp">。</em></p><p id="da45" class="pw-post-body-paragraph kq kr hi ks b kt lq is kv kw lr iv ky kz lt lb lc ld lv lf lg lh lx lj lk ll hb bi translated"><em class="lp">下次见！</em>(∫･‿･)ﾉ゛</p></div></div>    
</body>
</html>