<html>
<head>
<title>Emoji Search 🔮 Creating, Deploying and Evaluating a Machine Learning Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">表情符号搜索🔮创建、部署和评估机器学习服务</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/emoji-search-creating-deploying-and-evaluating-a-machine-learning-service-f97c29976d6d?source=collection_archive---------8-----------------------#2021-07-13">https://medium.com/nerd-for-tech/emoji-search-creating-deploying-and-evaluating-a-machine-learning-service-f97c29976d6d?source=collection_archive---------8-----------------------#2021-07-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d4b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">计算机可以以这样一种方式模拟语言，即它们可以很好地执行诸如文本相似性之类的任务。在这篇文章中，我试图创建一个表情符号建议工具，它使用矢量单词嵌入来确定相关的表情符号推荐。我还将机器学习模型作为服务部署在 AWS 上，并进行成本估算。在<a class="ae jd" href="https://t3chflicks.org/Services/emoji-search" rel="noopener ugc nofollow" target="_blank"> T3chFlicks 网站</a>上可以找到这项服务的一个实例；<a class="ae jd" href="https://github.com/sk-t3ch/emoji-search" rel="noopener ugc nofollow" target="_blank">所有代码都是开源的</a>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/e5014e4890914310db9a07b1afb42a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-n5hxenupEa8IdmOxRwRQ.png"/></div></div></figure><blockquote class="jq"><p id="599f" class="jr js hi bd jt ju jv jw jx jy jz jc dx translated"><a class="ae jd" href="https://github.com/sk-t3ch/emoji-search/blob/master/Emoji_Text_Search_Notebook.ipynb" rel="noopener ugc nofollow" target="_blank">🔗在 Github 上找到所有表情符号搜索代码📔</a></p></blockquote><h1 id="abe2" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">表情符号😂 ❤️</h1><p id="3a8b" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">表情符号在互联网交流中很常见，微小复杂的象形文字为快速拇指敲击总结打开了大门。</p><p id="8a4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电脑使用 Unicode 标准<a class="ae jd" href="https://home.unicode.org/" rel="noopener ugc nofollow" target="_blank">表示表情符号</a>:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="0f30" class="li kb hi le b fi lj lk l ll lm">Code: U+1F600 (Unicode)<br/>      \xF0\x9F\x98\x83 (UTF-8 Bytes) <br/>Emoji: 😀           <br/>Description: grinning face</span></pre><p id="cad8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表情符号的受欢迎程度在不同的社会和文化中差异很大，但 Unicode 公布了一些关于它们的使用比例的统计数据:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ln"><img src="../Images/a52b6259da0ad851fee42940d4f97cac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N0_wL0A3CIm-qInu9ioU2Q.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated"><a class="ae jd" href="https://home.unicode.org/emoji/emoji-frequency/" rel="noopener ugc nofollow" target="_blank">https://home.unicode.org/emoji/emoji-frequency/</a></figcaption></figure><h1 id="8312" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl ls kn ko kp lt kr ks kt lu kv kw kx bi translated">我们想要什么？</h1><p id="e192" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">在项目构思过程中，我们决定要做到以下几点:</p><ul class=""><li id="af7c" class="lv lw hi ih b ii ij im in iq lx iu ly iy lz jc ma mb mc md bi translated">输入搜索文本，得到相似表情列表</li><li id="2684" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">在<a class="ae jd" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank"> AWS Lambda </a>中运行机器学习模型</li><li id="82e2" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">使用此服务来提高向我们的文章添加表情符号的效率。</li></ul><h1 id="10be" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl ls kn ko kp lt kr ks kt lu kv kw kx bi translated">构建-表情符号搜索</h1><p id="d5d9" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">为了能够搜索文本并得到最相似的表情符号，我们需要找到搜索文本与表情符号的相似性。</p><p id="d0eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们必须尝试比较苹果和苹果，幸运的是，Unicode 标准中的表情符号有一个简短的图像描述，使用这些我们可以比较两个字符串<code class="du mj mk ml le b">search_text vs. emoji_description</code>。</p><p id="8190" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一种当前的语言建模技术是使用单词嵌入——一种向量空间，其中维度和关系表示单词之间的意义。</p><p id="ffa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了理解嵌入的概念，我们强烈推荐以下视频:</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mm mn l"/></div></figure><h2 id="4cbb" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">使用单词嵌入搜索表情符号</h2><p id="2c7f" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们使用 2019 年的<a class="ae jd" href="https://code.google.com/archive/p/word2vec/" rel="noopener ugc nofollow" target="_blank">谷歌新闻向量</a>作为语言模型，这不一定是最佳选择(存在更新的模型，如<a class="ae jd" href="https://github.com/google-research/bert" rel="noopener ugc nofollow" target="_blank">伯特</a>)，但它肯定会完成任务。该模型的精简版可以在<a class="ae jd" href="https://github.com/eyaler/word2vec-slim" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><blockquote class="nb nc nd"><p id="1b92" class="if ig ne ih b ii ij ik il im in io ip nf ir is it ng iv iw ix nh iz ja jb jc hb bi translated">一种简单的研究学习表示的方法是找到与用户指定的单词最接近的单词。[ <a class="ae jd" href="https://code.google.com/archive/p/word2vec/" rel="noopener ugc nofollow" target="_blank">来源</a> ]</p></blockquote><p id="4033" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们首先以<a class="ae jd" href="https://en.wikipedia.org/wiki/Word2vec" rel="noopener ugc nofollow" target="_blank"> <em class="ne"> word2vec </em> </a>格式加载模型:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="0e21" class="li kb hi le b fi lj lk l ll lm">import os<br/>import gensim<br/>GOOGLE_NEWS = os.path.join(FIXTURES_FOLDER, "GoogleNews-vectors-negative300-SLIM.bin.gz")</span><span id="a2fe" class="li kb hi le b fi ni lk l ll lm">model = gensim.models.KeyedVectors.load_word2vec_format(GOOGLE_NEWS, binary=True)</span></pre><p id="7435" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个模型是用来处理表情数据的。幸运的是，我们需要的所有信息都可以在名为<a class="ae jd" href="https://pypi.org/project/emoji-data/" rel="noopener ugc nofollow" target="_blank"> emoji_data </a>的 Python 库中找到。我们首先将表情文字提取到一个<a class="ae jd" href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.html" rel="noopener ugc nofollow" target="_blank">熊猫数据帧</a>中。为了简单起见，我们只保留标准的黄色表情集合。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="7416" class="li kb hi le b fi lj lk l ll lm">from emoji_data import EmojiSequence<br/>d = {'emoji': [], 'description': []}<br/>for (emoji, emoji_meta) in EmojiSequence:<br/>    d['emoji'].append(emoji)<br/>    d['description'].append(emoji_meta.description)<br/>df = pd.DataFrame(d)<br/>df['description'] = df['description'].str.split(' skin tone').str[0].str.replace(':', '').str.replace(',', '')<br/>df = df.drop_duplicates(subset=['description'])</span><span id="4a6e" class="li kb hi le b fi ni lk l ll lm">---------------------------------</span><span id="df25" class="li kb hi le b fi ni lk l ll lm">emoji   description<br/>👨‍❤️‍👨      [couple with heart man man]</span></pre><p id="d535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">表情符号的描述文本中的每个单词的向量被平均为该表情符号的向量:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="740f" class="li kb hi le b fi lj lk l ll lm">def process_words(text):<br/>    words = text.split(" ")<br/>    word_vectors = [ model.syn0norm[model.vocab[word].index] for word in words if word in model.vocab]<br/>    if len(word_vectors) &gt; 0:<br/>        mean_vector = np.array(word_vectors).mean(axis=0)<br/>        unit_vector = gensim.matutils.unitvec(mean_vector).astype(np.float32).tolist()<br/>    else:<br/>        unit_vector = np.zeros(model.vector_size, ).tolist()<br/>    return unit_vector</span><span id="edcd" class="li kb hi le b fi ni lk l ll lm">df['vector'] = df['description'].apply(process_words)</span></pre><p id="002c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，使用搜索文本“狗”和<code class="du mj mk ml le b">emoji_vector vs. search_vector</code>的<a class="ae jd" href="https://en.wikipedia.org/wiki/Cosine_similarity" rel="noopener ugc nofollow" target="_blank">余弦相似度</a>，我们可以建立所有表情符号的相似度。然后我们可以选择前两个。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="e73e" class="li kb hi le b fi lj lk l ll lm">from sklearn.metrics.pairwise import cosine_similarity</span><span id="f335" class="li kb hi le b fi ni lk l ll lm">def find_similarity_to_search(search_vector):<br/>    def func(emoji_vector):<br/>        b_emoji = np.array(emoji_vector)<br/>        cos_sim = dot(search_vector, b_emoji) / (norm(search_vector) * norm(b_emoji))<br/>        return cos_sim<br/>    return func</span><span id="0bba" class="li kb hi le b fi ni lk l ll lm">search_text = "dog"<br/>search_vector = np.array(process_words(search_text))<br/>find_similarity_to_search = find_similarity_to_search(search_vector)<br/>df['similarity'] = df['vector'].apply(find_similarity_to_search)<br/>df.nlargest(2, 'similarity')</span><span id="2b7a" class="li kb hi le b fi ni lk l ll lm">--------------------<br/><br/>emoji similarity description<br/>🐕 1.000000 dog<br/>🌭 0.775372 hot dog</span></pre><p id="88db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这个例子相当简单，但还有一个例子让我们忍俊不禁，认为这项服务运行良好:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="a348" class="li kb hi le b fi lj lk l ll lm">search: "giant obstacle"</span><span id="23fc" class="li kb hi le b fi ni lk l ll lm">-------------------<br/>emoji similarity description<br/>🦣 0.416749 mammoth<br/>🤘🏽 0.352729 sign of the horns medium<br/>🧗🏽‍♂️ 0.351723 man climbing medium<br/>🐉 0.330775 dragon<br/>🗺️ 0.330681 world map</span></pre><h2 id="7371" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">表情搜索 API 的架构</h2><p id="d801" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">上面的 Python 脚本可以在云上运行，并作为 API 通过互联网访问。我们使用 AWS 作为我们的云提供商，使用<a class="ae jd" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank"> CloudFormation </a>来编写代码形式的基础设施。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es nj"><img src="../Images/36bea174de99dc4029bf69624c7f4be5.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*l6HnXwBZSu0ALFpoPFEaIA.png"/></div></figure><p id="4bab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该架构使用一个带有<a class="ae jd" href="https://aws.amazon.com/lambda/" rel="noopener ugc nofollow" target="_blank">λ</a>的<a class="ae jd" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" rel="noopener ugc nofollow" target="_blank">应用负载平衡器</a>作为 API，我们在之前的文章中已经讨论过这一点:</p><div class="nk nl ez fb nm nn"><a href="https://t3chflicks.medium.com/cheaper-than-api-gateway-alb-with-lambda-using-cloudformation-b32b126bbddc" rel="noopener follow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hj fi z dy ns ea eb nt ed ef hh bi translated">比 API 网关便宜— ALB 和 Lambda 使用 CloudFormation</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">API gateway 的替代产品是应用程序负载平衡器。ALB 可以和 Lambda 连接产生一个高度…</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">t3chflicks.medium.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob jo nn"/></div></div></a></div><p id="d232" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">AWS Lambda 支持使用<a class="ae jd" href="https://www.docker.com/resources/what-container" rel="noopener ugc nofollow" target="_blank"> docker 容器</a>，这允许我们在本地运行 Lambda 进行开发和测试。该脚本与谷歌新闻向量一起打包到 docker 容器中，因为这使得它可以在运行时访问，而不需要从<a class="ae jd" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>或<a class="ae jd" href="https://aws.amazon.com/efs/" rel="noopener ugc nofollow" target="_blank"> EFS </a>下载。Lambda 需要 1.5GB 内存来运行该模型。</p><h2 id="69d7" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">服务的部署</h2><p id="d6dd" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">可以使用<a class="ae jd" href="https://aws.amazon.com/codepipeline/" rel="noopener ugc nofollow" target="_blank"> CodePipeline </a>在 AWS 上创建部署管道。这个过程由 Github 存储库的提交触发。它遵循一系列已定义的步骤，从为服务提供基础设施开始，然后测试代码，构建 docker 容器，最后更新 Lambda:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oc"><img src="../Images/90db09a43bdab9eba722d314f71bb4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ntZRjPJ1pM97PgDr8sJ3mg.png"/></div></div></figure><p id="8c32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢超级开发者<a class="ae jd" href="https://james-turner.medium.com/" rel="noopener"> James Turner </a>向我们展示了如何在 AWS 上创建由 Github 提交触发的 CI/CD 管道:</p><div class="nk nl ez fb nm nn"><a href="https://aws.plainenglish.io/from-github-to-continuous-deployment-in-5-minutes-7f9c1c7702b1" rel="noopener  ugc nofollow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hj fi z dy ns ea eb nt ed ef hh bi translated">从 GitHub 到持续部署 5 分钟</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">如何从 Github 仓库到 AWS 中的 CD 管道，在那里你可以运行测试，并不断地…</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">aws .平原英语. io</p></div></div><div class="nw l"><div class="od l ny nz oa nw ob jo nn"/></div></div></a></div><h2 id="685e" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">界面</h2><p id="b0c5" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我们制作了一个小部件，允许用户轻松地使用 API 并查看定义输入和输出的<a class="ae jd" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON 模式</a>:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oe"><img src="../Images/42e5993169b0c5b9729e21031aeba44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UzyjbN5_1Xn7N4WUH9YzzA.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">这个小部件允许您与 API 交互。参观<a class="ae jd" href="https://t3chflicks.org/services/emoji-search" rel="noopener ugc nofollow" target="_blank">https://t3chflicks.org/services/emoji-search</a>游玩！</figcaption></figure><p id="d25a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API 的编程用法如下:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="9618" class="li kb hi le b fi lj lk l ll lm">url '<a class="ae jd" href="https://api.t3chflicks.org./emoji-search/recommendations'" rel="noopener ugc nofollow" target="_blank">https://api.t3chflicks.org./emoji-search/recommendations'</a> \<br/>  -H 'content-type: application/json' \<br/>  --data-raw '{"key":"4aac6db6d8dfc3fa7693b8b5918b3d548e3c92ebd70832447bab247a1c0b0b477d9107ecfe05f8153ef6d3d848614de3cb8bcf42e256aac1444eb828be1f4083","search":"Dog","quantity":5}' \<br/>  --compressed</span><span id="8dea" class="li kb hi le b fi ni lk l ll lm">&gt;&gt;&gt; {"most_similar": [{"score": 0.6978708999734073, "emoji": "\ud83d\udc15", "description": "dog"}, {"score": 0.5574100960192504, "emoji": "\ud83c\udf2d", "description": "hot dog"}, {"score": 0.5498123048808492, "emoji": "\ud83e\uddae", "description": "guide dog"}, {"score": 0.5273177453464898, "emoji": "\ud83d\udc08", "description": "cat"}, {"score": 0.4822364083781162, "emoji": "\ud83d\udc15\u200d\ud83e\uddba", "description": "service dog"}]}</span></pre><blockquote class="jq"><p id="6770" class="jr js hi bd jt ju jv jw jx jy jz jc dx translated"><a class="ae jd" href="https://t3chflicks.org/services/emoji-search" rel="noopener ugc nofollow" target="_blank"> <em class="of">🤖这个小工具可以在我们的网站上找到🤖</em> </a></p></blockquote><h1 id="ce16" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">成本估算</h1><p id="2f7d" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">确定运行表情符号搜索服务的成本与我们在上一篇文章中所做的类似:</p><div class="nk nl ez fb nm nn"><a href="https://t3chflicks.medium.com/giving-away-free-apis-without-going-broke-cd87a7dc78a5" rel="noopener follow" target="_blank"><div class="no ab dw"><div class="np ab nq cl cj nr"><h2 class="bd hj fi z dy ns ea eb nt ed ef hh bi translated">免费提供 API 而不会破产。</h2><div class="nu l"><h3 class="bd b fi z dy ns ea eb nt ed ef dx translated">我喜欢在媒体上写文章。我也想在我们自己的网站上分享相同的文章，而不必重写…</h3></div><div class="nv l"><p class="bd b fp z dy ns ea eb nt ed ef dx translated">t3chflicks.medium.com</p></div></div><div class="nw l"><div class="og l ny nz oa nw ob jo nn"/></div></div></a></div><p id="159b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于所描述的架构，成本等式为:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="07b4" class="li kb hi le b fi lj lk l ll lm"><strong class="le hj"><em class="ne">Total cost = Application Load Balancer cost + Lambda cost</em></strong></span></pre><p id="2fbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将继续假设 100 个用户使用他们的 100 个免费积分。</p><h2 id="e5fb" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">λ成本</h2><p id="e984" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">表情符号搜索 Lambda 有以下响应统计:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="4290" class="li kb hi le b fi lj lk l ll lm"><strong class="le hj"><em class="ne">542 ms on average @ 1536 MB memory (cold start 1362ms)</em></strong></span></pre><p id="7267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些数字可以插入<a class="ae jd" href="https://aws.amazon.com/lambda/pricing/" rel="noopener ugc nofollow" target="_blank">λ成本计算器</a>:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oh"><img src="../Images/9611364d051bc54e013c59b3098ca973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wCJI6Dk2_mm-IKcuoqtisQ.png"/></div></div></figure><p id="c625" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du mj mk ml le b"><strong class="ih hj"><em class="ne">$0.06 / Month</em></strong></code>几乎可以忽略不计的成本。然而，当扩展到数百万个请求时，服务确实开始变得相当昂贵:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oi"><img src="../Images/cbd5d642bcfac40c4dbae56645d3f3ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AwWnHTMvvUk2q4HKUL9yBw.png"/></div></div></figure><p id="0aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们确实收到这种请求率的情况下，我们无疑将不得不重新架构。</p><h2 id="c666" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">应用程序负载平衡器成本</h2><p id="5749" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">负载平衡器将处理以下大小的请求:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="2737" class="li kb hi le b fi lj lk l ll lm"><strong class="le hj"><em class="ne">Processed bytes = (167B request + 172B response) * 4350 requests = 1,474,650B</em></strong><em class="ne"> = </em><strong class="le hj"><em class="ne">1.475MB = 0.001475GB</em></strong></span></pre><p id="13ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些数字可以插入<a class="ae jd" href="https://aws.amazon.com/elasticloadbalancing/pricing/" rel="noopener ugc nofollow" target="_blank">应用负载平衡器成本计算器</a>:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es oj"><img src="../Images/4d7cd6bab4ba6dc1736deec29c400918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*azOH5F39zOTAdn1y6mA_vw.png"/></div></div></figure><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="a47d" class="li kb hi le b fi lj lk l ll lm"><strong class="le hj"><em class="ne">Total ALB Cost = (ALB/month) + (LCU/month)<br/>Total ALB Cost = $0.23 +(730hours/month * $0.0252/hour) = $18.63</em></strong></span></pre><h2 id="2d10" class="li kb hi bd kc mo mp mq kg mr ms mt kk iq mu mv ko iu mw mx ks iy my mz kw na bi translated">总成本</h2><p id="a0b9" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">以每月 4350 的请求率计算，该服务的成本估计为:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="7d9b" class="li kb hi le b fi lj lk l ll lm"><strong class="le hj"><em class="ne">Total Cost = Application Load Balancer cost + Lambda cost<br/>Total Cost = </em></strong><strong class="le hj"><em class="ne">$18.63 + $0.06 = $18.69</em></strong></span></pre><p id="f263" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于许多服务可以共享同一个 ALB，它们的成本将在项目间分摊。一个更便宜的选择是使用<a class="ae jd" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API 网关</a>。</p><p id="6765" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们并不期望有这么多的流量，只是为了好玩而公开服务。</p><p id="8f56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经创建了一个<a class="ae jd" href="https://aws.amazon.com/getting-started/hands-on/control-your-costs-free-tier-budgets/" rel="noopener ugc nofollow" target="_blank">成本预算</a>，当服务将超出预期成本时，就会触发警报。</p><h1 id="ebbf" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl ls kn ko kp lt kr ks kt lu kv kw kx bi translated">结论</h1><p id="2b35" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">在 T3chFlicks <strong class="ih hj">我们想要分享</strong>，这就是为什么你会发现创建这个项目的代码是开源的。我们很想听听有经验的开发商/企业主是如何成功经营 SaaS 的，请联系我们！</p><h1 id="e622" class="ka kb hi bd kc kd ke kf kg kh ki kj kk kl ls kn ko kp lt kr ks kt lu kv kw kx bi translated">感谢阅读</h1><p id="cbb2" class="pw-post-body-paragraph if ig hi ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc hb bi translated">我希望你喜欢这篇文章。如果你喜欢这种风格，可以去看看<a class="ae jd" href="https://t3chflicks.org/" rel="noopener ugc nofollow" target="_blank">T3chFlicks.org</a>了解更多科技教育内容(<a class="ae jd" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>、<a class="ae jd" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>、<a class="ae jd" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">脸书</a>、<a class="ae jd" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>、<a class="ae jd" href="https://www.patreon.com/bePatron?u=14761480" rel="noopener ugc nofollow" target="_blank"> Patreon </a>)。</p></div></div>    
</body>
</html>