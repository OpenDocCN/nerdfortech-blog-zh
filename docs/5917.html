<html>
<head>
<title>Local Deploy to Multiple Emulators and Simulators with Cake</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Cake本地部署到多个仿真器和模拟器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/local-deploy-to-multiple-emulators-and-simulators-with-cake-5d3258e7a4c?source=collection_archive---------4-----------------------#2021-12-05">https://medium.com/nerd-for-tech/local-deploy-to-multiple-emulators-and-simulators-with-cake-5d3258e7a4c?source=collection_archive---------4-----------------------#2021-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/3ab8e16274a836e51b568d626a6500a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RL9je0Iz6MUMyX00l3aXmw.png"/></div></div></figure><div class=""/><div class=""><h2 id="5ccd" class="pw-subtitle-paragraph iq hs ht bd b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh dx translated">如果您正在寻找一种简单的方法来测试Xamarin。同时在几个Android模拟器和iOS模拟器中运行表单或MAUI应用程序——使用Cake脚本完成所有日常工作🙃 😉</h2></div><p id="e4a9" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">嗨伙计们！！！🤪长话短说<a class="ae ke" href="https://gist.github.com/bbenetskyy/6fc8f9536bd39ad0faec5030748b53c0" rel="noopener ugc nofollow" target="_blank">这里是GitHub Gist </a>的完整脚本链接。</p><p id="f7f5" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我的故事开始了——一年前，我看到了来自<a class="ae ke" href="https://twitter.com/D_Antonowicz" rel="noopener ugc nofollow" target="_blank">达米安</a>的一个可爱的演讲，我只是觉得不用Bash和PowerShell来制作脚本非常有趣。之后我什么也没做😱。</p><p id="0be3" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">10月，我再次读到了一篇关于这一切的博文:</p><div class="hh hi ez fb hj kf"><a href="https://damianantonowicz.pl/2021/10/02/creating-cake-script-for-building-and-deploying-xamarin-app-part-3-deployment/" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hu fi z dy kk ea eb kl ed ef hs bi translated">为构建和部署Xamarin应用程序创建蛋糕脚本:第3部分部署| Damian Antonowicz</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">在这篇文章中，你将学习如何使用Cake脚本将Xamarin应用程序部署到应用程序中心、Google Play内部和测试…</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">damianantonowicz.pl</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt hp kf"/></div></div></a></div><p id="ec60" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我认为我们可以用Cake for Xamarin进行一些UI测试或部署。表单应用程序。11月底，我意识到我需要在两个Android模拟器(一个RTL)和两个iOS模拟器(一个RTL)上部署测试我开发的应用程序。别这样，骑马要花很多时间。我不需要调试它。我已经在我的主要iOS模拟器上测试过了。我只需要确保它在每个平台和设备上都好看。</p><p id="e81e" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">是的，是的，我们可以为此进行UI测试，但事实是——不是每个项目都有这些测试，也不是每个项目都需要。</p><p id="1b65" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">因此，我看看是否有可能建立，得到所有的仿真器和模拟器，部署和运行我的应用程序。该死的是啊🤩 🥳.</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="9b9c" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">在开始之前</h1><p id="f732" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">请你阅读<a class="ae ke" href="https://twitter.com/D_Antonowicz" rel="noopener ugc nofollow" target="_blank">达米安</a>博客，并在你的机器上安装<a class="ae ke" href="https://cakebuild.net/docs/running-builds/runners/dotnet-tool" rel="noopener ugc nofollow" target="_blank">蛋糕</a>好吗？我不会在这个博客里关注这个问题。我打算继续努力，展示我发现的对我自己有用的东西，希望对你也有用😇</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="841a" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">脚本所需的设置</h1><p id="3e1e" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">我现在只在一个项目中使用了它，而且我并没有把它作为一个完全模块化的脚本来完成，但是我会尽可能地让它变得灵活和易于修改。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="a024" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">只需用你的完整路径替换所有常量字符串，这就是你所需要的。我认为提供的评论解释了所有的深度😛。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="87f9" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">清理并重新构建项目</h1><p id="7d52" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">同样，构建和清理<code class="du me mf mg mh b">.Net</code>项目的代码非常简单，并且具有良好的代码可读性。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="dfcc" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">获取所有可用的Android设备</h1><p id="47fa" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">脚本的这一部分可以获得所有附加的调试Android设备(通过USB或WiFi)和所有启动的仿真器，并打印到输出(终端)</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="d4a2" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">获取所有iOS模拟器</h1><p id="bcf1" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">这里有点棘手，因为脚本的这一部分显示了所有模拟器。不管它们是否启动！根据官方文档，我们可以用返回对象中的<code class="du me mf mg mh b">Availability</code>和<code class="du me mf mg mh b">IsAvailable</code>属性来标识模拟器状态。但是终端的输出告诉我<code class="du me mf mg mh b">Availability</code>已经过时了，而<code class="du me mf mg mh b">IsAvailable</code>一直是<code class="du me mf mg mh b">True</code>(即使它没有启动)。但是这个脚本任务的输出仍然是有用的，因为它可以显示模拟器的正确名称，我们可以将这些名称放入<code class="du me mf mg mh b">iosSimulators</code>参数中(在我们脚本的顶部)。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><figure class="ly lz ma mb fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mi"><img src="../Images/3cb799c2d06e5366373db9bb6e060da7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spyntuICUUJ1XYEayqhbyQ.png"/></div></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="7260" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">构建和运行Android应用程序</h1><p id="52b1" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">脚本的这一部分稍微复杂一些，但是，我想你可以理解那里发生了什么。这里有几个有趣的时刻我想提一下。</p><p id="6448" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">默认情况下，脚本与<code class="du me mf mg mh b">BuildAndRunAndroid</code>和<code class="du me mf mg mh b">BuildAndRuniOS </code>一起工作，这就是为什么我们也在其中构建。是的，我们可以用<code class="du me mf mg mh b">IsDependentOn</code>提前完成，但我不想那样做(我很懒，想在单独的任务中完成)</p><pre class="ly lz ma mb fd mj mh mk ml aw mm bi"><span id="f87a" class="mn lc ht mh b fi mo mp l mq mr">if(!device.Serial.StartsWith("emulator"))</span><span id="ef3e" class="mn lc ht mh b fi ms mp l mq mr">{</span><span id="6686" class="mn lc ht mh b fi ms mp l mq mr">AdbUninstall(packageName: "you.com.YourBestProject", settings: settings);</span><span id="8f6f" class="mn lc ht mh b fi ms mp l mq mr">}</span></pre><p id="5525" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">我发现只有在真正的Android设备上才需要在安装前卸载。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="487b" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">构建和运行iOS</h1><p id="a21e" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">在我的脚本中，我只想构建Xamarin。表单app在<code class="du me mf mg mh b">Debug|iPhoneSimulators</code>模式下，这种情况并不常见🤨。经过不长时间的研究，我发现我们可以用<code class="du me mf mg mh b">XBuildSettings</code>做到这一点:</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="72de" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">但这并不适合我，因为我找不到输出iOS应用程序来部署到模拟器中😥。经过一些实验，我意识到我们可以使用标准的<code class="du me mf mg mh b">MSBuild</code>来构建并输出iOS应用程序🤗</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="25a1" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">脚本中关于此任务的几句话:</p><ul class=""><li id="ae99" class="mt mu ht jk b jl jm jo jp jr mv jv mw jz mx kd my mz na nb bi translated">我无法识别模拟器是否启动。</li><li id="de42" class="mt mu ht jk b jl nc jo nd jr ne jv nf jz ng kd my mz na nb bi translated">当我试图从脚本中启动模拟器时，它没有反应，无法启动。在开始一个脚本之前，我们需要开始所有自己需要的。</li><li id="65ed" class="mt mu ht jk b jl nc jo nd jr ne jv nf jz ng kd my mz na nb bi translated">脚本会等到Android应用程序安装完毕，但不会等到iOS应用程序安装完毕。这就是我们在发射前等待3s的原因。</li></ul></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="eb03" class="lb lc ht bd ld le lf lg lh li lj lk ll iz lm ja ln jc lo jd lp jf lq jg lr ls bi translated">脚本结束</h1><p id="36cc" class="pw-post-body-paragraph ji jj ht jk b jl lt iu jn jo lu ix jq jr lv jt ju jv lw jx jy jz lx kb kc kd hb bi translated">在脚本的最后，我们添加了一个<code class="du me mf mg mh b">Default</code>任务，并运行请求的<code class="du me mf mg mh b">Target</code>，其中out target是脚本顶部的一个参数，并预定义给<code class="du me mf mg mh b">Default</code>任务。</p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><p id="2a40" class="pw-post-body-paragraph ji jj ht jk b jl jm iu jn jo jp ix jq jr js jt ju jv jw jx jy jz ka kb kc kd hb bi translated">感谢你阅读这篇文章。<a class="ae ke" href="https://gist.github.com/bbenetskyy/6fc8f9536bd39ad0faec5030748b53c0" rel="noopener ugc nofollow" target="_blank">GitHub Gist上又出现了一个完整的脚本</a></p><figure class="ly lz ma mb fd hk"><div class="bz dy l di"><div class="mc md l"/></div></figure></div></div>    
</body>
</html>