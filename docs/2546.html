<html>
<head>
<title>Execution Context of JavaScript and ‘this’</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript和“this”的执行上下文</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/execution-context-of-javascript-and-this-e080e22f2245?source=collection_archive---------26-----------------------#2021-05-10">https://medium.com/nerd-for-tech/execution-context-of-javascript-and-this-e080e22f2245?source=collection_archive---------26-----------------------#2021-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1f00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文的主要目的是使用<code class="du jd je jf jg b">this</code> context setter关键字将执行上下文概念绘制到excel中。在进入细节之前，让我们通过简要解释执行上下文是如何创建的来画出轮廓。</p><p id="612c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的JS代码经历了两个阶段。</p><h2 id="2806" class="jh ji hi bd jj jk jl jm jn jo jp jq jr iq js jt ju iu jv jw jx iy jy jz ka kb bi translated">1.创建阶段</h2><p id="e68a" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">JS引擎从上到下浏览我们的代码(即忽略值),如果检查了<a class="ae kh" href="https://www.w3schools.com/js/js_hoisting.asp" rel="noopener ugc nofollow" target="_blank">提升</a>和<a class="ae kh" href="https://blog.bitsrc.io/understanding-scope-and-scope-chain-in-javascript-f6637978cf53" rel="noopener ugc nofollow" target="_blank">作用域</a>规则，它会制定一个关于何时以及如何使用给定变量和函数的计划。当这个计划准备好时，它看起来像一个<strong class="ih hj">有序的</strong>待办事项列表，并且为每个列表项创建一个<a class="ae kh" href="https://www.javascripttutorial.net/javascript-execution-context/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">执行上下文</strong> </a> <strong class="ih hj"> </strong>。最后我们会有一个<a class="ae kh" href="https://blog.bitsrc.io/understanding-execution-context-and-execution-stack-in-javascript-1c9ea8642dd0" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">执行上下文堆栈(ESC) </strong> </a>。本文创建阶段的重要部分是<code class="du jd je jf jg b">this</code>关键字值是在这个阶段确定的。</p><h2 id="f7e6" class="jh ji hi bd jj jk jl jm jn jo jp jq jr iq js jt ju iu jv jw jx iy jy jz ka kb bi translated">2.执行阶段</h2><p id="6458" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">执行阶段是JS引擎按顺序执行堆栈的时候。要记住的关键信息是JS是单线程语言，这意味着每个堆栈都要等待上一个堆栈的完成(同步执行)。同样在这个阶段，<code class="du jd je jf jg b">this</code>的值可以通过<a class="ae kh" rel="noopener" href="/@omergoldberg/javascript-call-apply-and-bind-e5c27301f7bb"> <strong class="ih hj">显式上下文设置器方法</strong> </a> ( <code class="du jd je jf jg b">call</code>、<code class="du jd je jf jg b">apply</code>、<code class="du jd je jf jg b">bind</code>)来改变。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/4925d62742aa6784f6f9e9c0a769b79a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_v8EUBEWzTzimu7dLQR9A.png"/></div></div></figure><p id="3888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行上下文1有两个函数调用，<code class="du jd je jf jg b">getStaticStar()</code>和<code class="du jd je jf jg b">console.log('furtherStar is reached')</code>。它们中哪个先被调用，哪个就先被执行。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div class="er es ku"><img src="../Images/f7d1dfa7473a8de8f7d85aff6326c90f.png" data-original-src="https://miro.medium.com/v2/resize:fit:242/format:webp/1*AUhtRu0gfa2zjkDyPJ4h2Q.png"/></div><figcaption class="kv kw et er es kx ky bd b be z dx translated">ESC是自下而上构建的，自上而下执行</figcaption></figure><h1 id="d7c9" class="kz ji hi bd jj la lb lc jn ld le lf jr lg lh li ju lj lk ll jx lm ln lo ka lp bi translated">这解释道</h1><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lq"><img src="../Images/2957061bbbfcdaa71a017cfb96086b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5M9tQZQgpTg9cfbMpWRbvw.png"/></div></div></figure><p id="b83b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面，<code class="du jd je jf jg b">this</code>被多次提到，正如你所看到的，在我们的星球物体没有做任何改变的情况下，我们看到了不同方法的不同结果。这意味着对于同一方法的每一个不同的结果，<code class="du jd je jf jg b">this</code>的执行上下文是不同的，这使得我们的执行上下文<strong class="ih hj">是动态的</strong>。</p><p id="4166" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">先开始说<code class="du jd je jf jg b">call</code>和<code class="du jd je jf jg b">bind</code>方法。这些方法显式设置执行上下文。换句话说，他们可能会改变<code class="du jd je jf jg b">this</code>的价值。在第23行和第24行，我们得到了不同的结果，因为<code class="du jd je jf jg b">.call(polaris)</code>将我们的上下文设置为<code class="du jd je jf jg b">polaris</code>对象，它的<code class="du jd je jf jg b">star</code>是“北极星”。在第25行，我们用<code class="du jd je jf jg b">bind</code>方法将我们的上下文设置为<code class="du jd je jf jg b">polaris</code>。<br/> <strong class="ih hj"> <em class="lr">注意:</em> </strong> <code class="du jd je jf jg b"><em class="lr">apply</em></code> <em class="lr">和</em> <code class="du jd je jf jg b"><em class="lr">call</em></code> <em class="lr">方法会立即触发它们所调用的方法，而</em> <code class="du jd je jf jg b"><em class="lr">bind</em></code> <em class="lr">方法只设置上下文。因此在第25行，调用符号被用在了末尾。</em></p><p id="54d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第26、27行的逻辑与第23和24行相同。然而，引起注意的另一点是第26行。我们得到<code class="du jd je jf jg b">undefined</code>结果的原因是<code class="du jd je jf jg b">this</code>的值是行星类，它没有<code class="du jd je jf jg b">star</code>属性。</p><p id="b4c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第21、22、28、29行调用<code class="du jd je jf jg b">getMyStar()</code>和<code class="du jd je jf jg b">getStaticPolarisStar()</code> <a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Arrow_functions" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">箭头功能</strong> </a>。正如你所看到的，执行上下文setter方法并没有改变arrow函数的上下文。原因是箭头函数受制于<a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">词法作用域</strong> </a>。简而言之，arrow函数的词法范围意味着定义函数的位置很重要，而不是调用它的位置。因此，箭头功能的执行上下文是在创建阶段确定的，不能更改。</p><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ls"><img src="../Images/200803577493b7ecd2e8671a80384f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FwItSZtAMbmiK5NWy6Q5gg.png"/></div></div></figure><p id="89f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个要点是你不能设置执行上下文<strong class="ih hj">超过1次。上面，<code class="du jd je jf jg b">goToNorthStar</code>函数被分配给一个已经通过<code class="du jd je jf jg b">bind</code>绑定到<code class="du jd je jf jg b">polaris</code>的函数。因此，调用任何其他上下文设置器方法都不会改变上下文。在第35行，<code class="du jd je jf jg b">call(Planet)</code>不影响我们的上下文。你可以认为这是一个附加的恒等式。如果你愿意，你可以认为箭头函数被绑定在它们已经声明的地方，所以对它们调用<code class="du jd je jf jg b">call</code>、<code class="du jd je jf jg b">apply</code>、<code class="du jd je jf jg b">bind</code>不起作用。</strong></p><p id="eadb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第26行和第28行的结果相同。然而下面的原因是不同的。正如我们上面提到的，<code class="du jd je jf jg b">this</code>代表<code class="du jd je jf jg b">getStaticStar()</code>是行星类天体。<code class="du jd je jf jg b">getStaticPolarisStar()</code>方法是一个箭头函数。因此，由于词法范围，它的<code class="du jd je jf jg b">this</code>值在我们的Planet类定义的地方是全局的，在本例中是<code class="du jd je jf jg b">undefined</code>。</p></div></div>    
</body>
</html>