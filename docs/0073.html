<html>
<head>
<title>Minimizing Power Consumption in Microcontrollers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">最小化微控制器的功耗</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/minimizing-power-consumption-in-microcontrollers-b3eb9593c893?source=collection_archive---------3-----------------------#2019-12-07">https://medium.com/nerd-for-tech/minimizing-power-consumption-in-microcontrollers-b3eb9593c893?source=collection_archive---------3-----------------------#2019-12-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7150" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如天然气(汽油/柴油)对于自行车、卡车和汽车的行驶很重要一样，电力对于电子设备也很重要，对于通常由电池(有限能量)供电的嵌入式设备更是如此。电池电源的有限性意味着这些设备的功耗率应该合理，以鼓励它们的采用和使用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a1d4f9cdeb2eebd92356ecd2a415a229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OxkTu5ADKUrVjYfQS_ZgFA.jpeg"/></div></div></figure><p id="848d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些趋势和要求使得<strong class="ih hj">在嵌入式系统设计中实现低功耗考虑变得非常重要</strong>，多年来，设计师、工程师和制造商已经开发出多种有效管理产品功耗的智能方法，以确保产品在一次充电后使用时间更长。</p><p id="dde9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些技术大多集中在微控制器上，微控制器是大多数器件的核心，在今天的文章中，我们将探讨其中一些技术，以及如何利用它们来最大限度地降低微控制器的功耗。</p><h1 id="6f6b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">微控制器的节能技术</h1><h1 id="e797" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.睡眠模式</h1><p id="d28a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">睡眠模式(通常称为低功耗模式)可以说是降低微控制器功耗的最流行的技术。<strong class="ih hj">它们通常涉及禁用驱动微控制器某些外设的某些电路或时钟</strong>。</p><p id="2c86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据架构和制造商的不同，微控制器通常有不同种类的睡眠模式，每种模式都有能力禁用更多的内部电路或外设。睡眠模式通常从深度睡眠或关闭到空闲和打盹模式。</p><p id="d1e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">下面的</strong>解释了一些可用的模式。应该注意的是，这些模式的特征以及名称可能因制造商而异。</p><h2 id="4b15" class="ks jq hi bd jr kt ku kv jv kw kx ky jz iq kz la kd iu lb lc kh iy ld le kl lf bi translated"><strong class="ak">一.空闲/睡眠模式</strong></h2><p id="4589" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">对于设计人员来说，这通常是最简单的低功耗模式。<strong class="ih hj">该模式允许微控制器以非常快的速度返回到全运行状态</strong>。因此，如果器件的电源周期要求它经常离开睡眠模式，这不是最佳模式，因为当微控制器退出睡眠模式时会消耗大量功率。从待机模式返回活动模式通常基于中断。<strong class="ih hj">该模式通过关闭驱动CPU电路的时钟树在微控制器上实现，同时MCU主高频时钟保持运行</strong>。这样，一旦唤醒触发器被激活，CPU就能够立即恢复运行。时钟门控已经被广泛用于在微控制器的低功率模式下切断信号，并且这种模式有效地门控CPU上的时钟信号。</p><h2 id="9bba" class="ks jq hi bd jr kt ku kv jv kw kx ky jz iq kz la kd iu lb lc kh iy ld le kl lf bi translated"><strong class="ak">二。待机模式</strong></h2><p id="28d4" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">待机模式是另一种低功耗模式，易于设计人员实施。它非常类似于空闲/睡眠模式，因为<strong class="ih hj">它也涉及使用CPU </strong>上的时钟门控，但一个主要区别是它允许改变ram的内容，这通常不是空闲/睡眠模式的情况。在待机模式下，DMA(直接存储器存取)、串行端口、ADC和AES外设等高速外设保持运行，以确保它们在CPU唤醒后立即可用。对于某些MCU，RAM也保持活动状态，可以由DMA访问，允许在没有CPU干预的情况下存储和接收数据。对于低功耗微控制器，此模式下的功耗可低至50uA/MHZ。</p><h2 id="a384" class="ks jq hi bd jr kt ku kv jv kw kx ky jz iq kz la kd iu lb lc kh iy ld le kl lf bi translated"><strong class="ak">三世。深度睡眠模式</strong></h2><p id="b6fe" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">深度睡眠模式通常涉及<strong class="ih hj">禁用高频时钟和微控制器内的其他电路，只留下时钟电路</strong>用于驱动关键元件，如看门狗定时器、掉电检测和上电复位电路。其他MCU可以添加其他元件来提高整体效率。这种模式下的功耗可以低至1uA，具体取决于具体的MCU。</p><h2 id="69aa" class="ks jq hi bd jr kt ku kv jv kw kx ky jz iq kz la kd iu lb lc kh iy ld le kl lf bi translated"><strong class="ak">四。停止/关闭模式</strong></h2><p id="d616" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">某些微控制器具有这种附加模式的不同变体。在这种模式下，<strong class="ih hj">高低振荡器通常都被禁用，只留下一些配置寄存器和其他关键元件开启。</strong></p><p id="fc41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述所有睡眠模式的特性因MCU而异，但一般经验法则是:睡眠越深，睡眠期间禁用的外设越多，消耗的电量越低，虽然，这通常也意味着；恢复系统所消耗的能量越多。因此，设计人员需要考虑这种变化，并为任务选择正确的MCU，而不影响系统规格。</p><h1 id="7498" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.处理器频率的动态修改</h1><p id="4abc" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是另一种广泛流行的有效降低微控制器功耗的技术。这是迄今为止最古老的技术，比睡眠模式稍微复杂一点。<strong class="ih hj">它涉及固件动态驱动处理器时钟，在高频和低频之间交替</strong>，因为处理器频率和功耗之间的关系是线性的(如下所示)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/5b46ea01e1644d5a9e48b307f0991561.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*A1NEGDOKcVu4MWcxYKY6qg.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx translated">电流与频率的关系图</figcaption></figure><p id="77e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种技术的实现通常遵循这种模式；当系统处于空闲状态时，固件会将时钟频率设置为较低的速度，以使设备节省一些功率，当系统需要进行繁重的计算时，时钟速度会恢复。</p><blockquote class="lm ln lo"><p id="f60d" class="if ig lp ih b ii ij ik il im in io ip lq ir is it lr iv iw ix ls iz ja jb jc hb bi translated">修改处理器频率会产生适得其反的效果，这通常是由于固件开发不当造成的。当系统执行繁重的计算时，时钟频率保持在较低水平，就会出现这种情况。在这种情况下，较低的频率意味着系统执行设定任务所需的时间会超过必要时间，因此累计消耗的功率与设计人员试图节省的功率相同。因此，在时间要求严格的应用中实现这一技术时，必须格外小心。</p></blockquote><h1 id="47c5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.中断处理程序固件结构</h1><p id="9423" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是微控制器中最极端的电源管理技术之一。它在少数微控制器上可用，如ARM cortex-M内核，其SCR寄存器中有一个退出时休眠位。该位使微控制器能够在运行中断程序后休眠。虽然以这种方式平稳运行的应用数量有限，但对于现场传感器和其他基于长期数据采集的应用而言，这可能是一种非常有用的技术。</p><p id="e779" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我看来，大多数<strong class="ih hj">其他技术都是上面提到的</strong>的变体。例如，选择性外设时钟技术本质上是睡眠模式的一种变体，在这种模式下，设计人员选择外设来开启或关闭。<strong class="ih hj">这项技术需要对目标微控制器</strong>有深入的了解，可能对初学者不太友好。</p><h1 id="7b40" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">4.功率优化固件</h1><p id="c960" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">降低微控制器功耗的最佳方式之一是编写<strong class="ih hj">高效且优化良好的固件</strong>。这直接影响CPU每次完成的工作量，并增加微控制器的功耗。在编写固件时，应努力确保减少代码大小和周期，因为每执行一条不必要的指令，都会浪费一部分存储在电池中的能量。</p><p id="543b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是一些常见的基于C的优化固件开发技巧；</p><ol class=""><li id="01c6" class="lt lu hi ih b ii ij im in iq lv iu lw iy lx jc ly lz ma mb bi translated">尽可能使用“Static Const”类来防止数组、结构等的运行时复制。消耗能量。</li><li id="f70c" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">使用指针。对于初学者来说，它们可能是C语言中最难理解的部分，但是对于有效地访问结构和联合来说，它们是最好的。</li><li id="02c6" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">避免模数！</li><li id="30e4" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">如果可能，局部变量优先于全局变量。局部变量包含在CPU中，而全局变量存储在RAM中，CPU访问局部变量的速度更快。</li><li id="e17c" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">在可能的情况下，无符号数据类型是您最好的朋友。</li><li id="c70c" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">在可能的情况下对循环采用“倒计时”。</li><li id="fdc8" class="lt lu hi ih b ii mc im md iq me iu mf iy mg jc ly lz ma mb bi translated">使用位掩码代替无符号整数的位字段。</li></ol><p id="012b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">降低微控制器功耗的方法不仅限于上面提到的基于软件的方法，<strong class="ih hj">基于硬件的方法，如核心电压控制技术</strong>也存在，但为了将本文的长度保持在一个合理的范围内，我们将把它们留到以后再说。</p><h1 id="c422" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="e51a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">实现低功耗产品从微控制器的<a class="ae lg" href="https://circuitdigest.com/article/how-to-select-the-right-microcontroller-for-your-embedded-application" rel="noopener ugc nofollow" target="_blank">选择开始，当你试图查看市场上可用的各种选项时，可能会相当混乱。浏览时，数据手册可能很适合获取MCU的一般性能，但对于功耗关键型应用，这可能是一种非常昂贵的方法。<strong class="ih hj">为了了解微控制器的真正功耗特性，开发人员必须考虑微控制器的电气规格和低功耗功能</strong>。设计人员不仅应该关注MCU数据手册中所宣传的每种功耗模式的电流消耗，还应该<strong class="ih hj">研究低功耗模式下可用的唤醒时间、唤醒源和外设</strong>。</a></p><p id="6292" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查您计划使用的微控制器的特性，以确定您对低功耗实施的选择，这一点很重要。微控制器是技术进步的最大受益者之一，现在有几种超低功耗微控制器可以确保您有资源帮助您保持在功耗预算之内。其中一些还提供了功耗分析软件工具，您可以利用这些工具进行有效的设计。个人最喜欢的是德州仪器的MSP430系列微控制器。<br/>我在这里的<a class="ae lg" href="https://circuitdigest.com/article/implementing-low-power-consumption-in-microcontrollers" rel="noopener ugc nofollow" target="_blank"> Circuit Digest上发表了这篇文章的副本。</a></p></div></div>    
</body>
</html>