<html>
<head>
<title>From Zero to Hero Django Admin: Advanced-Level ModelAdmin Class-2 (Part4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到英雄姜戈管理员:高级模型管理员 2(第 4 部分)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/from-zero-to-hero-django-admin-advanced-level-modeladmin-class-2-part4-75608978bd76?source=collection_archive---------2-----------------------#2021-12-09">https://medium.com/nerd-for-tech/from-zero-to-hero-django-admin-advanced-level-modeladmin-class-2-part4-75608978bd76?source=collection_archive---------2-----------------------#2021-12-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8d33" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在管理应用程序中使用模型属性，添加富文本编辑器</h2></div><p id="96c6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个故事中，我们将继续向 ModelAdmin 类添加新的属性。我们的目标是通过添加一些属性来扩展博客模型，并在本章的应用程序中实现 CK 编辑器。你可以从下面得到第四章的代码。</p><div class="jt ju ez fb jv jw"><a href="https://github.com/mebaysan/DjangoAdminForMedium/tree/chapter4" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">第 4 章 GitHub-mebaysan/djangodadminformedium</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">我开始准备这个 repo 来解释我们如何在 Django 中定制管理应用程序。本次回购依赖于一个媒介…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">github.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk kl jw"/></div></div></a></div><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es km"><img src="../Images/621589dae0758c3f0ab73e538a132334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o22fbIZ82oppUXc8jHfeDQ.jpeg"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">照片由<a class="ae lb" href="https://unsplash.com/@faisaldada?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Faisal </a>在<a class="ae lb" href="https://unsplash.com/@faisaldada?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="4b3e" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">扩展博客模型</h1><p id="1538" class="pw-post-body-paragraph ix iy hi iz b ja lu ij jc jd lv im jf jg lw ji jj jk lx jm jn jo ly jq jr js hb bi translated">我们将向模型添加一个属性。因此，我们将获得博客对象的创建时间。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="6005" class="me ld hi ma b fi mf mg l mh mi">from django.utils import timezone</span><span id="c53c" class="me ld hi ma b fi mj mg l mh mi">class Blog(models.Model):</span><span id="bad8" class="me ld hi ma b fi mj mg l mh mi">   @property<br/>   def get_when_was_created(self):<br/>      return (timezone.now() - self.added_date).days</span></pre><p id="e9d9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该属性将返回对象创建以来的天数。记住，我们需要导入<code class="du mk ml mm ma b">timezone</code>模块来计算这个。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es mn"><img src="../Images/e040d198e905a6d2ebc799c93d15aad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L82JTHud3J8ox_xu-Fz2pw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">作者图片</figcaption></figure><h1 id="501a" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">扩展 ModelAdmin 类</h1><h2 id="38e2" class="me ld hi bd le mo mp mq li mr ms mt lm jg mu mv lo jk mw mx lq jo my mz ls na bi translated">列表 _ 显示</h2><p id="6c59" class="pw-post-body-paragraph ix iy hi iz b ja lu ij jc jd lv im jf jg lw ji jj jk lx jm jn jo ly jq jr js hb bi translated">我们可以在这个领域使用模型属性。如果我们将之前创建的属性添加到 ModelAdmin 类的<code class="du mk ml mm ma b">list_display</code>字段中，我们可以在列表中看到它。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="3b62" class="me ld hi ma b fi mf mg l mh mi">class BlogAdmin(admin.ModelAdmin):<br/>   ...<br/>   list_display = ['title', 'added_date', 'updated_date', <br/>   'is_published',<br/>   'get_when_was_created' # the property we created<br/>   ]</span></pre><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es nb"><img src="../Images/3f70f0b92bb52b5873c9a97daa2b8e6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4vJp5HjR2OAOAp3ChPURHg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">作者图片</figcaption></figure><p id="65ad" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们可以在 ModelAdmin 类中使用稍微不同的方法做同样的事情。我将向 admin 类添加一个方法。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="48aa" class="me ld hi ma b fi mf mg l mh mi">from django.utils import timezone</span><span id="957f" class="me ld hi ma b fi mj mg l mh mi">class BlogAdmin(admin.ModelAdmin):<br/>   def get_when_was_created_from_admin(self, obj):<br/>      return (timezone.now() - obj.added_date).days<br/>   <br/>   get_when_was_created_from_admin.short_description = 'How Many Days Ago?'</span></pre><p id="b20c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实际上，代码看起来类似于我们上面的代码。我们刚刚添加了<code class="du mk ml mm ma b">obj</code>参数。因为，当 admin 类调用这个函数时，会传递一个对象给它。然后，我们可以通过使用传递给函数的对象来应用或计算一些东西。我再次在<code class="du mk ml mm ma b">list_display</code>字段中添加了方法名。正如我们所料，我们看到一个新的列:“多少天前？”。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es nb"><img src="../Images/4132a41a0dabbd01b07bd86ad349d34d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZpweWMlLOnhE5HtO4AjmbA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">作者图片</figcaption></figure><p id="36e3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有一点小小的不同，如果我们使用 admin 类添加列，我们可以使用<code class="du mk ml mm ma b">short_description</code>属性来更改列名。但是我们不能通过使用模型类属性来改变列名。</p><h1 id="911d" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">添加富文本编辑器:CK 编辑器</h1><p id="2539" class="pw-post-body-paragraph ix iy hi iz b ja lu ij jc jd lv im jf jg lw ji jj jk lx jm jn jo ly jq jr js hb bi translated"><a class="ae lb" href="https://blog.devgenius.io/best-free-wysiwyg-editor-python-django-admin-panel-integration-d9cb30da1dba" rel="noopener ugc nofollow" target="_blank">有一堆编辑器可以用</a>。我将使用<a class="ae lb" href="https://ckeditor.com/" rel="noopener ugc nofollow" target="_blank"> CK 编辑器</a>。</p><p id="f776" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">首先，我要通过<code class="du mk ml mm ma b">pip</code>安装<code class="du mk ml mm ma b">django-ckeditor</code>。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="a9a6" class="me ld hi ma b fi mf mg l mh mi">pip install django-ckeditor</span></pre><p id="98e0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后添加到<code class="du mk ml mm ma b">INSTALLED_APPS</code>中。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="f794" class="me ld hi ma b fi mf mg l mh mi">INSTALLED_APPS = [<br/>'django.contrib.admin',<br/>'django.contrib.auth',<br/>'django.contrib.contenttypes',<br/>'django.contrib.sessions',<br/>'django.contrib.messages',<br/>'django.contrib.staticfiles',<br/>'blog.apps.BlogConfig',<br/>'ckeditor'<br/>]</span></pre><p id="b7df" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们需要在博客模型中实现它。我将从<code class="du mk ml mm ma b">blog/models.py</code>文件中的<code class="du mk ml mm ma b">ckeditor.fields</code>导入<code class="du mk ml mm ma b">RichTextField</code>。然后，更改<code class="du mk ml mm ma b">content</code>字段。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="cfa9" class="me ld hi ma b fi mf mg l mh mi">from ckeditor.fields import RichTextField</span><span id="b38f" class="me ld hi ma b fi mj mg l mh mi">class Blog(models.Model):<br/>   ...<br/>   content = RichTextField()</span></pre><p id="51a6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我通过将更改迁移和推送到数据库来完成这个实现过程。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="d1be" class="me ld hi ma b fi mf mg l mh mi">python manage.py makemigrations <br/>python manage.py migrate</span></pre><p id="c975" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过任何博客对象的详细信息页面看到实现的 CK 编辑器。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es nb"><img src="../Images/42fc6859fa6fb742265ac5d6c6590925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bprgstEyR7lE7uMpnesrDg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">作者图片</figcaption></figure><p id="1cd3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们可以自定义编辑器。我打算给<code class="du mk ml mm ma b">settings.py</code>文件添加一本字典。</p><pre class="kn ko kp kq fd lz ma mb mc aw md bi"><span id="ed8a" class="me ld hi ma b fi mf mg l mh mi">CKEDITOR_CONFIGS = {<br/>   'default': {<br/>      'toolbar': 'full',<br/>      'height': 700,<br/>      'width': 1000<br/>      }<br/>   }</span></pre><p id="e0cc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以看到这个选项字典的完整工具栏。如果你想更多的定制，你可以查看文档。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es nb"><img src="../Images/0a07000d90a24240bb2f68a518e101fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-ZYs_r4BS6vnRBZvi2jnhA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">作者图片</figcaption></figure><h1 id="a590" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">最后</h1><p id="faa4" class="pw-post-body-paragraph ix iy hi iz b ja lu ij jc jd lv im jf jg lw ji jj jk lx jm jn jo ly jq jr js hb bi translated">我在写作和编码的时候喜欢这个故事。希望你在阅读的时候也喜欢它。如果你喜欢这个故事，你可以在下面看到更多。</p><div class="jt ju ez fb jv jw"><a href="https://github.com/mebaysan/DjangoAdminForMedium" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">GitHub-mebaysan/djangodadminformedium:为中型 Django 管理博客系列创建</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">我开始准备这个 repo 来解释我们如何在 Django 中定制管理应用程序。本次回购依赖于一个媒介…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">github.com</p></div></div><div class="kf l"><div class="nc l kh ki kj kf kk kl jw"/></div></div></a></div><p id="f302" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">亲切的问候。</p></div></div>    
</body>
</html>