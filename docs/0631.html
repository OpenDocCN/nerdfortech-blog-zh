<html>
<head>
<title>Boost App start up time with Jetpack StartUp Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jetpack启动库提高应用程序启动时间</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/boost-app-start-up-time-with-jetpack-startup-library-f1d61bdb640b?source=collection_archive---------1-----------------------#2021-01-30">https://medium.com/nerd-for-tech/boost-app-start-up-time-with-jetpack-startup-library-f1d61bdb640b?source=collection_archive---------1-----------------------#2021-01-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/16a937a97d86d739c215befb6ccb078d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zu6YCnh3_3tCoQ58y0dd6Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">文章标题</figcaption></figure></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><p id="78c2" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">应用程序启动库提供了一种在应用程序启动时初始化组件的简单、高效的方法。</p><p id="49d5" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">它可以被<strong class="jd hj">库开发人员</strong>以及<strong class="jd hj">应用程序开发人员</strong>用来简化启动序列并明确设置初始化的顺序。</p><p id="3894" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">不是<strong class="jd hj">为你想要<strong class="jd hj">初始化</strong>的每个组件</strong>定义单独的内容提供者，应用启动允许你<strong class="jd hj">定义共享单个内容提供者</strong>的组件初始化器。这可以显著改善应用程序的启动时间。</p></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><p id="9e62" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">如果你有一点在你的android应用中使用<strong class="jd hj"> Firebase/WorkManager </strong>的经验。您可能已经看到了如何通过调用👇</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="ac64" class="ki kj hi ke b fi kk kl l km kn">FirebaseAuth.<em class="ko">getInstance</em>()<br/>WorkManager.getInstance()</span></pre><p id="2da2" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">在大多数情况下，为了初始化库或任何其他组件，我们需要调用某种方法，如下所示:</p><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="8ae3" class="ki kj hi ke b fi kk kl l km kn">NotificationManager.init(applicationContext)</span></pre><p id="4f56" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">但是在firebase初始化的情况下，我们没有调用任何方法来初始化它。我们只是得到它的实例，并准备好去。如果你想知道它是如何工作的，那么答案是<code class="du kp kq kr ke b">ContentProvider</code>。</p><p id="4f8e" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">您可以通过检查项目的<strong class="jd hj">合并AndroidManifest文件</strong>来验证这一点。</p><ul class=""><li id="ae32" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">下面是<strong class="jd hj"> FirebaseAuthUI </strong>使用的<strong class="jd hj">提供者</strong>的样本:</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="ef53" class="ki kj hi ke b fi kk kl l km kn">&lt;provider<br/>    android:name="com.firebase.ui.auth.data.client.AuthUiInitProvider"<br/>    android:authorities="${applicationId}.authuiinitprovider"<br/>    android:exported="false"<br/>    android:initOrder="90" /&gt;</span></pre><p id="4353" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">当应用程序启动时，所有的内容提供者都被初始化，从那时起，我们就可以使用Firebase使用<code class="du kp kq kr ke b">FirebaseAuth.<em class="ko">getInstance</em>()</code></p><p id="c704" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">但是这种方法有一些缺点。比方说，如果我们的应用程序中有<code class="du kp kq kr ke b">n components</code>遵循ContentProvider方法进行初始化，那么<code class="du kp kq kr ke b">n ContentProviders</code>会导致应用程序启动过程变慢。</p></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><h1 id="4376" class="lb kj hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">解决办法</h1><p id="b5bb" class="pw-post-body-paragraph jb jc hi jd b je ly jg jh ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hb bi translated">🙏感谢AndroidTeam，他们在AndroidJetpack的保护伞下引入了新的<strong class="jd hj">库，名为App StartUp </strong></p><blockquote class="md me mf"><p id="d1a3" class="jb jc ko jd b je jf jg jh ji jj jk jl mg jn jo jp mh jr js jt mi jv jw jx jy hb bi translated">今天，我们将看到这个库如何使我们的生活比以往任何时候都更容易，当它涉及到应用程序启动时的组件初始化。</p></blockquote><ul class=""><li id="6c70" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">要在您的库或应用程序中使用Jetpack启动，<strong class="jd hj">将以下内容添加到您的Gradle文件:</strong></li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="0be6" class="ki kj hi ke b fi kk kl l km kn">dependencies {<br/>    implementation "androidx.startup:startup-runtime:1.0.0"<br/>}</span></pre><p id="a5d7" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">有两种方法可以使用这个库。</p><ol class=""><li id="8530" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy mj ky kz la bi translated">在应用程序启动时初始化任何组件</li><li id="2e7f" class="ks kt hi jd b je mk ji ml jm mm jq mn ju mo jy mj ky kz la bi translated">惰性/手动初始化</li></ol></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><h1 id="e2b8" class="lb kj hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">启动时初始化组件:</h1><blockquote class="md me mf"><p id="11c6" class="jb jc ko jd b je jf jg jh ji jj jk jl mg jn jo jp mh jr js jt mi jv jw jx jy hb bi translated">要在启动时自动初始化组件，您必须为应用程序需要初始化的每个组件定义一个<strong class="jd hj">组件初始化器。</strong></p></blockquote><h1 id="f105" class="lb kj hi bd lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt mt lv lw lx bi translated"><strong class="ak">实现组件初始化器:</strong></h1><p id="a37a" class="pw-post-body-paragraph jb jc hi jd b je ly jg jh ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hb bi translated">你需要实现<code class="du kp kq kr ke b">Initializer&lt;T&gt; interface</code>，它有2个方法:</p><ul class=""><li id="c152" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated"><code class="du kp kq kr ke b">create()</code>方法，包含初始化组件的所有必要操作，并返回一个<code class="du kp kq kr ke b">T</code>实例。这里的<code class="du kp kq kr ke b">T</code>指的是你想要初始化的组件类型。</li><li id="84b9" class="ks kt hi jd b je mk ji ml jm mm jq mn ju mo jy kx ky kz la bi translated"><code class="du kp kq kr ke b">dependencies()</code>方法，返回初始化器依赖的其他<code class="du kp kq kr ke b">Initializer&lt;T&gt;</code>对象的列表。你可以使用这个方法来控制应用程序在启动时运行初始化器的顺序。</li></ul><h1 id="a3fe" class="lb kj hi bd lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt mt lv lw lx bi translated">假设我们有一个<strong class="ak"> NotificationManager </strong>，我们希望在应用程序启动时初始化它。</h1><h2 id="d245" class="ki kj hi bd lc mu mv mw lg mx my mz lk jm na nb lo jq nc nd ls ju ne nf lw ng bi translated">初始化器的样本代码:</h2><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="b602" class="ki kj hi ke b fi kk kl l km kn">// Initializing  <strong class="ke hj">NotificationManager</strong>.<br/>class NotificationManagerInitializer : Initializer&lt;NotificationManager&gt; {<br/>    override fun create(context: Context): NotificationManager {<br/>        val configuration = Configuration.Builder().build()<br/>        return NotificationManager.initialize(context)<br/>    }<br/>    override fun dependencies(): List&lt;Class&lt;out Initializer&lt;*&gt;&gt;&gt; {<br/>        // No dependencies on other libraries.<br/>        return emptyList()<br/>    }<br/>}</span></pre><h1 id="2ccf" class="lb kj hi bd lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt mt lv lw lx bi translated"><strong class="ak">通知管理器</strong></h1><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="1424" class="ki kj hi ke b fi kk kl l km kn">public class <strong class="ke hj">NotificationManager</strong> private constructor(val context: Context) {</span><span id="9c7a" class="ki kj hi ke b fi nh kl l km kn"><strong class="ke hj"> ...... other code </strong></span><span id="ff29" class="ki kj hi ke b fi nh kl l km kn">   companion object {</span><span id="947d" class="ki kj hi ke b fi nh kl l km kn">      lateinit var context: Context<br/>      private lateinit var notificationManager: NotificationManager</span><span id="4f83" class="ki kj hi ke b fi nh kl l km kn">      fun initialize(ctx: Context): NotificationManager {</span><span id="4d45" class="ki kj hi ke b fi nh kl l km kn">           context = ctx.<em class="ko">applicationContext</em></span><span id="937a" class="ki kj hi ke b fi nh kl l km kn">           notificationManager = NotificationManager(ctx)</span><span id="0615" class="ki kj hi ke b fi nh kl l km kn">           return notificationManager</span><span id="4861" class="ki kj hi ke b fi nh kl l km kn">      }<br/></span><span id="1c3b" class="ki kj hi ke b fi nh kl l km kn">      fun getInstance(): NotificationManager {</span><span id="db10" class="ki kj hi ke b fi nh kl l km kn">           if (!(::notificationManager.<em class="ko">isInitialized</em>)) {</span><span id="b340" class="ki kj hi ke b fi nh kl l km kn">              throw Exception("Notification Manager not initialized.   You might forgot to call initialize(ctx: Context) ")</span><span id="df04" class="ki kj hi ke b fi nh kl l km kn">           }</span><span id="6e19" class="ki kj hi ke b fi nh kl l km kn">           Log.d("TAG", "getInstance:  $notificationManager]")</span><span id="9c43" class="ki kj hi ke b fi nh kl l km kn">           return notificationManager</span><span id="7d00" class="ki kj hi ke b fi nh kl l km kn">      }</span><span id="ff2c" class="ki kj hi ke b fi nh kl l km kn">   }</span><span id="e4f5" class="ki kj hi ke b fi nh kl l km kn">}</span></pre><ul class=""><li id="a2c1" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">现在一切就绪，<strong class="jd hj">接下来我们需要将提供者条目添加到AndroidManifest文件:</strong></li></ul><p id="2151" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">App Startup包括一个名为<code class="du kp kq kr ke b">InitializationProvider</code>的特殊内容提供者，它用来发现和调用你的组件初始化器。</p><p id="fa84" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">这意味着，为了使组件初始化器可被应用程序启动发现，必须满足以下条件之一:</p><ul class=""><li id="d77c" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">组件初始化器在<code class="du kp kq kr ke b">InitializationProvider</code>清单条目下有一个对应的<code class="du kp kq kr ke b">&lt;meta-data&gt;</code>条目。</li><li id="12d7" class="ks kt hi jd b je mk ji ml jm mm jq mn ju mo jy kx ky kz la bi translated">组件初始化器在<code class="du kp kq kr ke b">dependencies()</code>方法中列出，来自一个已经可以发现的初始化器。</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="e815" class="ki kj hi ke b fi kk kl l km kn">&lt;provider<br/>    android:name="androidx.startup.InitializationProvider"<br/>    android:authorities="${applicationId}.androidx-startup"<br/>    android:exported="false"<br/>    tools:node="merge"&gt;</span><span id="d845" class="ki kj hi ke b fi nh kl l km kn">&lt;!-- This entry makes <!-- -->NotificationManagerInitializer<!-- --> discoverable. --&gt;<br/>&lt;meta-data  android:name="com.example.<!-- -->NotificationManagerInitializer<!-- -->"<br/>          android:value="androidx.startup" /&gt;<br/>&lt;/provider&gt;</span></pre><ul class=""><li id="8673" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">仅此而已。现在，您可以随时随地在您的应用程序中使用<strong class="jd hj"> NotificationManager </strong>,只需调用:</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="00d4" class="ki kj hi ke b fi kk kl l km kn">NotificationManagerInitializer.getInstance()</span></pre></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><h1 id="3ab1" class="lb kj hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">惰性/手动组件初始化:</h1><p id="4956" class="pw-post-body-paragraph jb jc hi jd b je ly jg jh ji lz jk jl jm ma jo jp jq mb js jt ju mc jw jx jy hb bi translated">通常，当您使用应用程序启动时，<code class="du kp kq kr ke b">InitializationProvider</code>对象使用一个名为<code class="du kp kq kr ke b"><a class="ae ni" href="https://developer.android.com/reference/kotlin/androidx/startup/AppInitializer" rel="noopener ugc nofollow" target="_blank">AppInitializer</a></code>的实体在应用程序启动时自动发现并运行组件初始化器。</p><p id="4a88" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hb bi translated">但是，如果您想手动初始化组件，也可以直接使用<code class="du kp kq kr ke b">AppInitializer</code>。这被称为<strong class="jd hj"> <em class="ko">惰性初始化</em> </strong>，它可以帮助最小化启动成本。</p><ul class=""><li id="e321" class="ks kt hi jd b je jf ji jj jm ku jq kv ju kw jy kx ky kz la bi translated">您必须先<strong class="jd hj">禁用任何您想要手动初始化</strong>的<strong class="jd hj">组件的自动初始化</strong>。</li></ul><h2 id="e564" class="ki kj hi bd lc mu mv mw lg mx my mz lk jm na nb lo jq nc nd ls ju ne nf lw ng bi translated">禁用所有组件的自动初始化</h2><ul class=""><li id="81de" class="ks kt hi jd b je ly ji lz jm nj jq nk ju nl jy kx ky kz la bi translated">要禁用所有自动初始化，从清单中删除<code class="du kp kq kr ke b">InitializationProvider</code>的整个条目:</li></ul><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="7044" class="ki kj hi ke b fi kk kl l km kn">&lt;provider<br/>    android:name="androidx.startup.InitializationProvider"<br/>    android:authorities="${applicationId}.androidx-startup"<br/>    tools:node="remove" /&gt;</span></pre><h2 id="4a3e" class="ki kj hi bd lc mu mv mw lg mx my mz lk jm na nb lo jq nc nd ls ju ne nf lw ng bi translated">手动初始化NotificationManager:</h2><pre class="jz ka kb kc fd kd ke kf kg aw kh bi"><span id="9289" class="ki kj hi ke b fi kk kl l km kn">AppInitializer.getInstance(context)<br/>    .initializeComponent(NotificationManager::class.java)</span></pre></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><h1 id="8082" class="lb kj hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">👨‍💻👨‍💻👏👏快乐编码👏👏👨‍💻👨‍💻</h1><h1 id="ebd2" class="lb kj hi bd lc ld mp lf lg lh mq lj lk ll mr ln lo lp ms lr ls lt mt lv lw lx bi translated"><strong class="ak">保持联系</strong></h1><ul class=""><li id="d1da" class="ks kt hi jd b je ly ji lz jm nj jq nk ju nl jy kx ky kz la bi translated"><a class="ae ni" href="https://twitter.com/navczydev" rel="noopener ugc nofollow" target="_blank">推特</a></li><li id="bd4e" class="ks kt hi jd b je mk ji ml jm mm jq mn ju mo jy kx ky kz la bi translated"><a class="ae ni" href="https://www.linkedin.com/in/navczydev/" rel="noopener ugc nofollow" target="_blank">领英</a></li></ul></div><div class="ab cl iu iv gp iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="hb hc hd he hf"><h1 id="4fb9" class="lb kj hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">参考</h1><div class="nm nn ez fb no np"><a rel="noopener follow" target="_blank" href="/androiddevelopers/app-startup-part-1-34f57b65cacd"><div class="nq ab dw"><div class="nr ab ns cl cj nt"><h2 class="bd hj fi z dy nu ea eb nv ed ef hh bi translated">应用程序启动，第1部分</h2><div class="nw l"><h3 class="bd b fi z dy nu ea eb nv ed ef dx translated">内容提供商和自动初始化</h3></div><div class="nx l"><p class="bd b fp z dy nu ea eb nv ed ef dx translated">medium.com</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od io np"/></div></div></a></div><div class="nm nn ez fb no np"><a href="https://android-developers.googleblog.com/2020/07/decrease-startup-time-with-jetpack-app.html" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab dw"><div class="nr ab ns cl cj nt"><h2 class="bd hj fi z dy nu ea eb nv ed ef hh bi translated">通过Jetpack应用程序启动减少启动时间</h2><div class="nw l"><h3 class="bd b fi z dy nu ea eb nv ed ef dx translated">对于任何应用程序来说，应用程序启动时间都是一个关键指标。用户希望应用响应迅速，加载速度快…</h3></div><div class="nx l"><p class="bd b fp z dy nu ea eb nv ed ef dx translated">android-developers.googleblog.com</p></div></div><div class="ny l"><div class="oe l oa ob oc ny od io np"/></div></div></a></div></div></div>    
</body>
</html>