<html>
<head>
<title>Store File in MySQL Database and View using Vanilla JS and Node.JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将文件存储在MySQL数据库中，并使用普通JS和Node进行查看。射流研究…</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/store-files-binary-in-mysql-database-and-view-using-vanilla-js-and-node-js-95a227002b85?source=collection_archive---------4-----------------------#2021-05-13">https://medium.com/nerd-for-tech/store-files-binary-in-mysql-database-and-view-using-vanilla-js-and-node-js-95a227002b85?source=collection_archive---------4-----------------------#2021-05-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b8cd76c07a48a639bafb886a8a0ec175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EDmJC4QbV1c5GC195Cs2rQ.png"/></div></div></figure><p id="a791" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有几种方法可以上传文件并将其保存在服务器上。在本教程中，我们将实现如何使用<strong class="is hj">普通Javascript </strong>读取文件，使用Node将文件的二进制数据保存在<strong class="is hj"> MySQL DB中。JS </strong>，并查看它们。</p><p id="001d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有JS框架的JS代码实现都是一样的。我假设你有<strong class="is hj">和<em class="jo">节点。JS </em> </strong>基础开发知识和<strong class="is hj"> <em class="jo"> phpMyAdmin </em> </strong>安装在你的系统中。</p><p id="c0eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们深入实施。</p><blockquote class="jp jq jr"><p id="c394" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj">创建项目</strong></p></blockquote><p id="1249" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装以下模块。</p><p id="eb92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">npm i express ejs mysql</p><p id="4077" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">npm i -D节点</p><p id="1c7b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">项目结构应该如下所示。</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div class="er es jv"><img src="../Images/8d2b1267599f90244635d25668326aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*F21-5oV-B8b3QTAZ7UezZg.png"/></div></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><blockquote class="jp jq jr"><p id="c2d4" class="iq ir jo is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated"><strong class="is hj">实施</strong></p></blockquote><p id="6cc7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在phpMyAdmin中运行以下SQL命令来创建一个表。</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="54a0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用LONGBLOB数据类型来存储文件的二进制数据。LONGBLOB是一种BLOB(二进制大对象),最大长度为4294967295个字符。</p><p id="c001" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们设置API代码来渲染HTML页面并将文件数据保存在DB中；</p><p id="5fab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将下面的代码放在server.js文件中。</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="bfc2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在config对象中，放置您的MySQL用户、密码和相关的数据库名称。</p><ul class=""><li id="a64f" class="kj kk hi is b it iu ix iy jb kl jf km jj kn jn ko kp kq kr bi translated"><strong class="is hj">获取“/”:-</strong>将呈现上传文件的页面。</li><li id="207b" class="kj kk hi is b it ks ix kt jb ku jf kv jj kw jn ko kp kq kr bi translated"><strong class="is hj"> POST "/store":- </strong>它将从请求体中提取文件的数据，并将其存储在数据库中。</li><li id="2cac" class="kj kk hi is b it ks ix kt jb ku jf kv jj kw jn ko kp kq kr bi translated"><strong class="is hj"> GET "/image/:id":- </strong>它将使用参数中的id从数据库中获取文件数据，并发送到UI以显示。</li></ul><p id="6561" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们实现UI端代码。</p><p id="0bb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">放在index.ejs中的代码下方</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="45fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看上面的代码发生了什么。</p><p id="b516" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在文件输入域中附加了一个onchange事件，它在加载文件时触发。</p><p id="06ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> FileReader </strong>对象允许web应用程序从用户计算机异步读取文件或原始数据缓冲区，可从<strong class="is hj">文件</strong>或<strong class="is hj"> Blob </strong>对象中检索。</p><p id="b937" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">文件</strong>对象可以从输入元素选择文件返回的<strong class="is hj">文件列表</strong>对象中获取。</p><p id="521d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> FileReader </strong>只能访问用户通过输入栏或拖放加载的文件内容。它不能通过路径名访问文件。</p><p id="04ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它有几个事件处理程序和方法，这里我们使用其中的三个。</p><ul class=""><li id="9159" class="kj kk hi is b it iu ix iy jb kl jf km jj kn jn ko kp kq kr bi translated"><strong class="is hj"> FileReader.onload:- </strong>每次成功完成读取操作时都会触发此事件。</li><li id="05f1" class="kj kk hi is b it ks ix kt jb ku jf kv jj kw jn ko kp kq kr bi translated"><strong class="is hj"> FileReader.onerror:- </strong>每次读取操作遇到错误时，都会触发此事件。</li><li id="ae82" class="kj kk hi is b it ks ix kt jb ku jf kv jj kw jn ko kp kq kr bi translated"><strong class="is hj">filereader . readasdataurl():-</strong>开始读取指定的Blob或文件，一旦完成，结果属性data: URL表示文件的数据。</li></ul><p id="ab04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从服务器收到保存的文件id响应后，我们将删除输入字段，并将用户重定向到“/image/{fileid}”，用户将能够在这里查看加载的图像。</p><p id="e89c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">放在imageView.ejs中的代码下方</p><figure class="jw jx jy jz fd ij"><div class="bz dy l di"><div class="kh ki l"/></div></figure><p id="1e14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个文件中，我们从/ <strong class="is hj">图像<em class="jo"> / </em> :id </strong>路线接收<strong class="is hj"> &lt; %= name % &gt; </strong>数据。</p><p id="4e38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在做npm启动，去<a class="ae kx" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>。</p><p id="387a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上传一个文件，您将被重定向到另一个页面，在那里您将能够查看上传的图像。</p><p id="db5b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以打开<strong class="is hj"> <em class="jo"> phpMyAdmin </em> </strong>并检查存储的记录，如下所示。</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/878d40b031be94c6e1a6107d11a0a531.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*0Im5XRmTsc-or1-Q9SPaTw.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">phpMyAdmin</figcaption></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="8a8b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有任何问题，请留下您的评论。</p><p id="b330" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">查看Github仓库中的源代码。</p><div class="ld le ez fb lf lg"><a href="https://github.com/dev-sankhadip/Store-File-Database-and-View-in-Vanilla-JS-Node.JS-and-MySQL" rel="noopener  ugc nofollow" target="_blank"><div class="lh ab dw"><div class="li ab lj cl cj lk"><h2 class="bd hj fi z dy ll ea eb lm ed ef hh bi translated">dev-sankhadip/Store-File-Database-and-View-in-Vanilla-JS-Node。JS和MySQL</h2><div class="ln l"><h3 class="bd b fi z dy ll ea eb lm ed ef dx translated">贡献给dev-sankhadip/Store-File-Database-and-View-in-Vanilla-JS-Node。JS-and-MySQL开发通过创建一个…</h3></div><div class="lo l"><p class="bd b fp z dy ll ea eb lm ed ef dx translated">github.com</p></div></div><div class="lp l"><div class="lq l lr ls lt lp lu io lg"/></div></div></a></div><h1 id="0fa2" class="lv lw hi bd lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms bi translated">Sankhadip Samanta</h1><p id="f867" class="pw-post-body-paragraph iq ir hi is b it mt iv iw ix mu iz ja jb mv jd je jf mw jh ji jj mx jl jm jn hb bi translated"><em class="jo">软件开发人员、代码商|技术作家</em></p><p id="9693" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae kx" href="https://www.linkedin.com/in/sankhadip-samanta-7bb891180/" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到我😃和<a class="ae kx" href="https://github.com/dev-sankhadip" rel="noopener ugc nofollow" target="_blank"> Github </a>😅</p></div></div>    
</body>
</html>