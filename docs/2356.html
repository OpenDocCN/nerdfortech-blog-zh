<html>
<head>
<title>UX Policies — Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UX 政策—第 3 部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ux-policies-part-3-d6937e2dda57?source=collection_archive---------23-----------------------#2021-05-02">https://medium.com/nerd-for-tech/ux-policies-part-3-d6937e2dda57?source=collection_archive---------23-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f629" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">实施</h2></div><p id="59cc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是系列文章的一部分。目标、基础、项目结构、文章摘要见 <a class="ae ju" href="https://sites.google.com/view/migueltt/home_en" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> Android::简体</em> </a></p><p id="c917" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">务必先阅读文章</strong> <a class="ae ju" href="https://miguelt.medium.com/ux-policies-bbbb432dc5fc" rel="noopener"> <strong class="iz hj">第一部分:问题</strong> </a> <strong class="iz hj">和</strong> <a class="ae ju" href="https://miguelt.medium.com/ux-policies-5ce77bc26304" rel="noopener"> <strong class="iz hj">第二部分:UX 模式</strong> </a> <strong class="iz hj">！</strong></p><p id="7eb3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">储存库:<a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/migueltt/simpleandroid</a></p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="756b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文将关注于<a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid" rel="noopener ugc nofollow" target="_blank"> SimpleAndroid 应用</a>的实际 UX 策略实现，它包含了您可以在您的项目中使用的实用程序——因此，您可以随时查看<a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid" rel="noopener ugc nofollow" target="_blank">源代码</a>。为了让事情更清楚，我在每个地方都添加了注释。</p></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="af3b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae ju" href="https://miguelt.medium.com/single-activity-2659f6ac09e8" rel="noopener">单一活动原则</a>的意思就是:一个<code class="du kc kd ke kf b">Activity</code>来统治他们所有人！这样的<code class="du kc kd ke kf b">Activity</code>应该定义 main-UI 组件:</p><ul class=""><li id="400d" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated">工具栏→显示上下文“快捷方式”(如弹出菜单、图标)</li><li id="04e8" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">主模块的导航项目(例如在<code class="du kc kd ke kf b">Drawer</code>或<code class="du kc kd ke kf b">BottomNavigationView</code>内——甚至两者都有！)</li><li id="3924" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">需要时应该出现的上下文<code class="du kc kd ke kf b">FloatingActionButton</code></li></ul><blockquote class="ku kv kw"><p id="7e11" class="ix iy jt iz b ja jb ij jc jd je im jf kx jh ji jj ky jl jm jn kz jp jq jr js hb bi translated">为了简化事情，我定义了两种不同的变体:<br/> - <code class="du kc kd ke kf b">debug</code>:经典的一种，用于开发和测试——包括几个结构来试验应用程序，还包括一个 UX 风格的切换器。<br/> - <code class="du kc kd ke kf b">debugQA</code>:应该被认为是我们的<code class="du kc kd ke kf b">release</code>变体——只是为了简化而添加的，这样我们就可以使用仿真器执行这两种变体，而不必提供签名配置。这个变体使用了 BottomAppBar+Drawer UX 风格。</p></blockquote><p id="9b50" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了设置组件同步，我使用了扩展函数，可以在以下位置找到:</p><ul class=""><li id="9d13" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated">对于变体<code class="du kc kd ke kf b">debugQA</code> — <a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debugQA/java/com/simpleandroid/ui/UxPolicies.kt" rel="noopener ugc nofollow" target="_blank"> UxPolicies.kt </a>:管理我们简单的 BottomAppBar+Drawer UX 风格</li><li id="bb10" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">对于变体<code class="du kc kd ke kf b">debug</code> — <a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debug/java/com/simpleandroid/ui/UxPolicies.kt" rel="noopener ugc nofollow" target="_blank"> UxPolicies.kt </a>:更复杂的版本，因为它管理了<a class="ae ju" href="https://miguelt.medium.com/ux-policies-5ce77bc26304" rel="noopener">第 2 部分</a>中描述的所有以前的 UX 风格</li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="2ff8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了简单起见，我将解释一下<code class="du kc kd ke kf b">debugQA</code> ( <a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debugQA/java/com/simpleandroid/ui/UxPolicies.kt" rel="noopener ugc nofollow" target="_blank"> UxPolicies.kt </a>)的基本原理——请随意查看<a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debug/java/com/simpleandroid/ui/UxPolicies.kt" rel="noopener ugc nofollow" target="_blank">其他</a>更复杂的实现。</p><ol class=""><li id="b3a3" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js la km kn ko bi translated"><code class="du kc kd ke kf b">fun AppCompatActivity.getTopLevel(..)</code>返回导航图中定义的被视为顶级的所有模块 id——因此，如果选择了顶级模块,<code class="du kc kd ke kf b">Toolbar</code>将不会变为返回箭头。因为顶级 id 应该被认为是静态的，<code class="du kc kd ke kf b">getTopLevel(..)</code>从<code class="du kc kd ke kf b">integer-array</code>资源中检索那些 id。</li><li id="d721" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">fun AppCompatActivity.setupNavComponents(..)</code>使用几个 Material-Components 函数来同步所有 main-UI 组件。</li><li id="0e8a" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">interface UxPolicies</code>为每个<em class="jt">行为</em>定义了<code class="du kc kd ke kf b">UxRules</code>，一旦<code class="du kc kd ke kf b">Fragment</code>显示，我们希望在<code class="du kc kd ke kf b">Activity</code>上进行更改。</li><li id="f406" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">interface UxPoliciesLiveData</code>与<code class="du kc kd ke kf b">interface UxPolicies</code>类似，但提供了<code class="du kc kd ke kf b">LiveData</code>组件，因此<code class="du kc kd ke kf b">Fragment</code>可以交互修改<code class="du kc kd ke kf b">Activity</code>。</li><li id="2a97" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">setupUxPolicies(..)</code>是执行所有策略和规则的地方——在<code class="du kc kd ke kf b">navHostFragment</code>中添加一个<code class="du kc kd ke kf b">FragmentManager.FragmentLifecycleCallbaks</code>实例，每当创建一个<code class="du kc kd ke kf b">Fragment</code>时，执行 UX 策略，如果需要的话定义默认规则——注意，每当导航控制器切换<code class="du kc kd ke kf b">Fragment</code>时，这是您想要使用的回调。在我们的例子中，每当创建一个<code class="du kc kd ke kf b">Fragment</code>时，我们想要执行 UX 策略。</li><li id="e038" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">fun UxPolicies.enforceUxPolicies(..)</code>在<code class="du kc kd ke kf b">setupUxPolicies(..)</code>中使用，以便应用 UX 模式的所有规则。</li><li id="eb83" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated"><code class="du kc kd ke kf b">fun UxPoliciesLiveData.enforceUxPolicies(..)</code>与<code class="du kc kd ke kf b">UxPolicies.setupUxPolicies</code>相似，但应用基于<code class="du kc kd ke kf b">LiveData</code>组件的策略。</li><li id="374b" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js la km kn ko bi translated">其他不言自明的扩展功能(例如显示/隐藏工具栏)</li></ol><p id="9367" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">注意有两个额外的扩展功能(检查<code class="du kc kd ke kf b"><a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/main/java/com/simpleandroid/ui/NavigationUIHelper.kt" rel="noopener ugc nofollow" target="_blank">NavigationUIHelper.kt</a>)</code>:</p><ul class=""><li id="0b5d" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated"><code class="du kc kd ke kf b">fun NavigationView.setupWithNavControllerExt(NavController)</code>解决标准<code class="du kc kd ke kf b">NavigationUI.setupwithNavController(..)</code>的问题。Google 实现的问题在于，无论何时选择一个菜单项，它总是会创建一个<code class="du kc kd ke kf b">Fragment</code>，即使它当前正在显示。这将强制重新创建此类<code class="du kc kd ke kf b">Fragment</code>的所有状态，甚至是<code class="du kc kd ke kf b">Fragment</code>级别的视图模型。</li><li id="1aa5" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated"><code class="du kc kd ke kf b">fun BottomNavigationView.setupWithNavControllerExt(NavController)</code>，就像前一项一样，如果用户点击当前选择的菜单项，它将重新创建已经选择的<code class="du kc kd ke kf b">Fragment</code>，丢失所有之前的状态——这种实现避免了重新创建<code class="du kc kd ke kf b">Fragment</code>。</li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="b78f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那么，所有这些东西是怎么聚在一起的呢？</p><ul class=""><li id="2c13" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated">首先，您必须遵循 Google 关于 XML 布局和组件的指导方针</li><li id="56f9" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">第二，你应该遵循我关于如何去耦合绑定 T21 的建议，因为这将简化你的代码并为整个项目提供更多的结构</li></ul><p id="691a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于第一个要点(XML 布局)，我对变体<code class="du kc kd ke kf b">debugQA</code>中的<code class="du kc kd ke kf b">ActivityMain</code> XML 布局使用了 ViewBinding，其中所有主 UI 组件都被标识为<code class="du kc kd ke kf b">android:id="@+id/main_&lt;xxx&gt;</code>——这里没有什么新内容:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lb"><img src="../Images/7d760b5258db157d2dd4e0e14e871a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6jXhElETPq_dOJz8GNUCWQ.png"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx translated">变体调试 QA 中的 activity_main.xml</figcaption></figure><p id="c8ca" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于第二个要点(<a class="ae ju" href="https://miguelt.medium.com/decoupling-binding-57566dc7b17d" rel="noopener">解耦绑定</a>)，我已经将所有与 UI 相关的语句提取到<code class="du kc kd ke kf b"><a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debugQA/java/com/simpleandroid/modules/ActivityMainBindingExt.kt" rel="noopener ugc nofollow" target="_blank">ActivityMainBindingExt.kt</a></code>中，在本例中，它只包含一个扩展函数<code class="du kc kd ke kf b">fun ActivityMainBinding.setup(..)</code>:</p><pre class="lc ld le lf fd lr kf ls lt aw lu bi"><span id="8d02" class="lv lw hi kf b fi lx ly l lz ma">fun ActivityMainBinding.setup(activity: ActivityMain) {<br/>    activity.setContentView(<em class="jt">root</em>)<br/>    val topLevel = activity.<em class="jt">getTopLevel</em>(R.array.<em class="jt">modules_top</em>)<br/>    (activity.<em class="jt">supportFragmentManager</em>.findFragmentById(<br/>        R.id.<em class="jt">main_container<br/>    </em>) as NavHostFragment).<em class="jt">apply </em><strong class="kf hj">{<br/>        </strong>activity.<em class="jt">setupNavComponents</em>(<br/>            navController = <em class="jt">navController</em>,<br/>            primaryToolbar = mainBottomAppbar, <br/>            drawer = mainDrawer,<br/>            navigationView = mainNavigation,<br/>            topLevel = topLevel<br/>        )<br/>        <em class="jt">setupUxPolicies</em>(<br/>            navHostFragment = this,<br/>            primaryToolbar = mainBottomAppbar,<br/>            drawer = mainDrawer,<br/>            floatingActionButton = mainFab,<br/>            topLevel = topLevel<br/>        )<br/>    <strong class="kf hj">}<br/></strong>}</span></pre><p id="ed2f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是全部要求！</p><ul class=""><li id="afad" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated"><code class="du kc kd ke kf b">@+id/main_bottom_appbar</code>将根据在<code class="du kc kd ke kf b">@+id/main_container</code>内显示的每个<code class="du kc kd ke kf b">Fragment</code>上的 UX 政策显示/隐藏</li><li id="63c8" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated"><code class="du kc kd ke kf b">@+id/main_navigation</code>将与<code class="du kc kd ke kf b">@+id/main_container</code>同步——为此，<code class="du kc kd ke kf b">@menu/modules_main.xml</code>和<code class="du kc kd ke kf b">@navigation/modules_main</code>为每个<code class="du kc kd ke kf b">Fragment</code>定义相同的<code class="du kc kd ke kf b">@id’s</code></li><li id="e72c" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated"><code class="du kc kd ke kf b">@+id/main_drawer</code>应与<code class="du kc kd ke kf b">@+id/main_bottom_appbar</code>同步，如果<code class="du kc kd ke kf b">Fragment</code>是顶层图标，导航图标允许打开<code class="du kc kd ke kf b">Drawer</code>——否则，应显示一个返回箭头</li><li id="c6f2" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">根据 UX 政策，如果<code class="du kc kd ke kf b">Fragment</code>有要求，应显示<code class="du kc kd ke kf b">@+id/main_fab</code></li><li id="ee2b" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">如果一个<code class="du kc kd ke kf b">Fragment</code>需要隐藏一个 main-UI 组件，那么它应该实现<code class="du kc kd ke kf b">UXPolicies</code>并覆盖属性<code class="du kc kd ke kf b">uxRules</code>，提供您需要的规则</li><li id="2ced" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">如果<code class="du kc kd ke kf b">Fragment</code>需要显示或隐藏任何主界面组件，那么执行<code class="du kc kd ke kf b">UxPoliciesLiveData</code>并相应地更新<code class="du kc kd ke kf b">MutableLiveData</code>规则</li></ul></div><div class="ab cl jv jw gp jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="hb hc hd he hf"><p id="af5a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在所有这些设置之后，继续向<code class="du kc kd ke kf b">@menu/modules_main.xml</code>和<code class="du kc kd ke kf b">@navigation/modules_main.xml</code>中添加更多模块是非常容易的。</p><p id="2777" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">举个例子，</p><ul class=""><li id="a11d" class="kg kh hi iz b ja jb jd je jg ki jk kj jo kk js kl km kn ko bi translated">允许交互地切换几乎任何主界面组件——即使你改变了方向，因为这是我们的“测试”版本，你甚至可以在 UX 风格之间切换</li><li id="1a6d" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated">包括自己的工具栏，甚至自己的导航主机控制器，因此，它不需要任何主用户界面组件</li><li id="4cae" class="kg kh hi iz b ja kp jd kq jg kr jk ks jo kt js kl km kn ko bi translated"><code class="du kc kd ke kf b"><a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/main/java/com/simpleandroid/modules/notes/FragmentNotes.kt" rel="noopener ugc nofollow" target="_blank">FragmentNotes</a></code>指定浮动动作按钮的动作，依赖于默认的 UX 规则</li></ul><p id="d221" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你需要不同的 UX 风格(例如，顶部工具栏、底部导航视图等等)，请随意查看<code class="du kc kd ke kf b"><a class="ae ju" href="https://gitlab.com/migueltt/simpleandroid/-/blob/develop/app/src/debug/java/com/simpleandroid/modules/ActivityMain.kt" rel="noopener ugc nofollow" target="_blank">debug MainActivity</a></code>版本——但是要小心！这个版本允许在运行时切换不同的 UX 风格，这是你应该避免的——你的应用应该只使用一种 UX 风格，以简化用户的交互方式。</p></div></div>    
</body>
</html>