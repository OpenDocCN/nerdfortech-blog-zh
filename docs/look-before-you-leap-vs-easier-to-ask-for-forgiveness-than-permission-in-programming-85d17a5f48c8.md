# 在编程中，三思而后行比请求原谅更容易

> 原文：<https://medium.com/nerd-for-tech/look-before-you-leap-vs-easier-to-ask-for-forgiveness-than-permission-in-programming-85d17a5f48c8?source=collection_archive---------1----------------------->

让我们对这场辩论有不同的看法，并选择哪一个更好

![](img/81051b504a026d1a9fe5317183e3ff3b.png)

乔恩·泰森在 [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) 上的照片

好吧，这是个很拗口的标题。这场争论就像是程序员的终身战争(有点夸张😁).有些人喜欢用*三思而后行* (LBYL)，另一些人认为*请求原谅比* (EAFP)方式更好。然后，我们中有一部分人认为“嗯，那要看情况”。

在本文中，我们将讨论我们真的需要在这两者之间做出选择，还是最好根据实现细节两者都用？与严格遵循我们偏好的教条相比，习惯性编码更好吗？不管是哪种方式，我都会用 Python、Go 和 JavaScript 举一些例子作为补充。

# 介绍

在直接跳到代码示例之前，让我们简要描述一下这两种方法。

*三思而后行*意味着我们必须在代码进一步运行之前检查错误或边缘情况。例如，如果一个函数返回一个错误(或者意外的结果)，我们就停止代码的执行，然后过早地返回给调用者。

鉴于*请求原谅比请求许可容易，*当代码运行时出现错误，该错误被捕获并处理。

这就像在*三思而后行*中一样，您通过削减执行流程从一开始就限制了错误发生。但是在*中，请求原谅比请求允许更容易*，你让错误发生，然后如果有错误，你会处理它。

这么说，这两种方法其实各有千秋。在我个人看来，它们应该按照编程语言惯用的方式结合起来。为此，让我们看看使用它们的惯用方式。

# 计算机编程语言

在 Python 中，如果你想使用 *LBYL* ，你会得到一个类似这样的代码。

在这段代码中，我们需要检查字典中是否有 name 和 price 的键。如果没有，那么代码运行 else 语句。

现在，将它与 EAFP 的 T21 方法相比较。你认为哪一个更好？

如果删除 price 的键-值对，except 语句将运行。如果没有错误，那么 try 语句将照常工作。

一般来说，Python 社区更喜欢*请求原谅比请求许可更容易。*因为假设你的代码有很多可能出错的情况。如果你使用*三思而后行*，那么你会有很多 if-else 语句来检查边缘情况。请记住，与 try-except 处理相比，一堆 if-else 语句会使您的代码相对较慢，但与单个 if-else 语句相比，运行异常处理会花费您更多的成本(您可以使用`timeit`来比较它们)。除了看性能，EAFP 还有更好的语法。特别是，如果您想降低代码的复杂性。

好吧，但是我应该什么时候选择 EAFP，什么时候选择 LBYL 呢？

在大多数情况下，你应该使用 EAFP。这是 Python 中错误处理的惯用方式。但是如果你认为你的代码不会有太多的边缘情况，并且使用 LBYL 会更简单，那么使用它是一个好的迹象。记住异常处理是昂贵的，所以如果你的代码有机会抛出很多异常，那么最好使用 LBYL。

这是否意味着我将在 Python 中大量使用 EAFP？是的，更有可能。所以了解如何正确使用很重要。要记住的关键思想是不要使用一般的异常处理，而是要具体。

从上面的例子来看，当我们试图访问字典中未指定的键时，就会抛出异常。因此，您应该在 except 语句中指定 KeyError，而不是使用 Exception(甚至 BaseException)。

# 去

与 Python 相反，Go 中惯用的错误处理方式是*三思而后行。*事实上，围棋中并不存在试除或试捕。你只有旧的 if-else 语句。

是的，这是真的，我们可能会有一个冗长的代码，但这真的是 Go 的缺点吗？不完全是，围棋就是这么设计的。正如我在上一节提到的，异常处理是很昂贵的。如果我们需要处理很多异常，那么我们的代码会相对慢一些。此外，Go 的设计者更喜欢显式的错误处理。

看一下这个例子:

通常，Go 中的函数返回一个 pair/tuple；第一个是结果，第二个是误差。如果有错误，执行流将停止并返回到调用者。如果没有错误，流程继续。

但是有没有办法让我把 EAFP 写成围棋呢？嗯，可以(算是吧)。Peter Verhas 可以给你一个很好的片段来做到这一点！

即使你能在围棋中写出 EAFP，也不意味着你必须不明智地使用它。一般来说，你应该坚持使用 LBYL，因为这是惯用的方式。如果您有一些非常特殊的情况需要这种方法，您可以使用它。但是，还是要注意你的解决方案。

还有一点需要注意，虽然在大多数情况下您将使用 LBYL，就像在 Python 中一样，但是您需要知道如何正确地使用它(如果您想了解错误处理的最佳实践，我还在参考资料部分提供了额外的资源)。在围棋中，有一个著名的术语叫做*快乐之路*。结构应该是，你有一个函数调用，返回值和错误。在函数调用下面一行，你有错误处理，你需要优雅地处理这个错误，而不仅仅是检查是否有错误。此外，您总是需要首先处理错误。如果没有错误，让快乐的场景跟随它。

如果你仔细看，它有一个从上到下执行的模式。控制结构之间没有跳跃。这就是 Go 的代码冗长而明确的原因。

# Java Script 语言

就像 Python 一样，你可以在 JavaScript 中使用 EAFP 和 LBYL。但是主要的区别是您不能指定在 try-catch 块中发生了什么类型的错误。在 Python 中可以有 KeyError、ValueError、Exception 等，但是在 JavaScript 中有一般的错误。这意味着你必须把 EAFP 和 LBYL 结合起来，才能达到和 Python 一样的行为。

我们来举个例子。

根据上面的代码，我们使用 Axios 作为 HTTP 客户端。在这种情况下，如果`localhost:3000`返回不正常的 HTTP 状态(HTTP 代码 3xx、4xx 或 5xx)，异常处理就会运行。但是如果你想要和 Python 一样的行为，你必须使用 if-else 语句来处理异常。

知道了这一点，以及之前我们需要特别处理异常的知识，在大多数情况下，你需要结合 EAFP 和 LBYL。诚然，JavaScript 是一种众所周知的灵活语言。但是在我个人看来，我不赞成使用一般的异常处理。虽然它很容易使用，但并不完全健壮。

# 结论

我很确定这场争论只是个人喜好的问题(以及一些技术细节)。就像你必须决定哪件衬衫更适合你一样；因人而异。我认为进行这种辩论实际上会适得其反。与其将此带入宗教辩论，为什么我们不进行富有成效的讨论来决定使用哪一个，或者更好的是让我们基于实现细节来使用它们。

除此之外，当我们写代码时，我们应该坚持使用惯用法。为什么？我很确定，如果我们在学习一门语言，我们会努力让自己听起来像说母语的人。我们不仅要学习语言，还要学习他们的文化。为了更好地接受这种语言，我们应该像当地人一样思考。

你怎么想呢?

感谢您的阅读和快乐编码！

# 资源

*   [https://better programming . pub/in-python-dont-look-before-you-leap-CFF 250881930](https://betterprogramming.pub/in-python-dont-look-before-you-leap-cff250881930)
*   [https://switowski . com/blog/ask-for-permission or-look before-you-leap](https://switowski.com/blog/ask-for-permission-or-look-before-you-leap)
*   [https://www . Reddit . com/r/golang/comments/9t 7 con/why _ no _ try catch _ in _ golang _ whats _ the _ theory _ behind/](https://www.reddit.com/r/golang/comments/9t7con/why_no_trycatch_in_golang_whats_the_theory_behind/)
*   【https://dave.cheney.net/tag/error-handling 