<html>
<head>
<title>Practical Implementation — .NET Core Background Services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实际执行--。NET 核心后台服务</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/practical-implementation-net-core-background-services-1a4c9bf3b1c9?source=collection_archive---------1-----------------------#2021-04-19">https://medium.com/nerd-for-tech/practical-implementation-net-core-background-services-1a4c9bf3b1c9?source=collection_archive---------1-----------------------#2021-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b6ad45b9c343a8320e91d27a9b23a0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDUnceUjzeoDERiQZeUFdQ.jpeg"/></div></div></figure><p id="3480" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电脑和自动化给我们的生活带来了很多好处。在没有人工干预和监控的情况下处理任务对大多数人来说绝对是一个福音。</p><p id="7d45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里有一个假设的场景。您有一个通过云提供服务的系统。该系统是付费的，但提供 30 天的免费试用期。为了验证试用用户并在 30 天后限制他们的访问，您需要持续监控。此外，如果手动完成，则有可能出现错误，如提前结束试用期或延长试用软件的使用时间。</p><p id="db63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这可能会给顾客留下关于你的产品的负面印象。为了避免这种情况，您可以利用计算的能力，在适当的时候完全取消访问。</p><p id="aa9c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了实现这一点。Net core 提供后台服务选项。在这种情况下，逻辑写在。Net 代码，然后它可以在后台持续运行。它的优点是无需任何人工干预就能完成需求。我们来详细看看什么是后台服务，如何在点网核心实现</p><p id="d8ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="3420" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">IHostedService 简介</li><li id="aac9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">的实际实施。Net 托管\后台服务</li><li id="99d3" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">结论</li></ol><h1 id="5515" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">IHostedService 简介</h1><p id="304c" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">。Net core 提供了通过使用 IHostedServices 实现后台作业的选项。这是……Net 核心库。HostedServices 是实现 IHostedService 接口的类。</p><p id="c486" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">托管服务与 Windows 服务略有不同，Windows 服务是单独托管的，不托管任何网站。但是，当涉及到后台服务时，它可以被绑定并与网站项目一起运行。</p><h1 id="4246" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">点网核心托管/后台服务的实际实现</h1><p id="a140" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在这一节中，让我们看看如何实现后台服务。这将通过两种方式完成；第一，使用 IHostedServices，第二，使用 BackgroundService。</p><h2 id="84b7" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第一步</h2><p id="6ae7" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建一个新项目，并选择项目模板为“ASP。NET Core Web Application”并为项目提供有效的名称。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lt"><img src="../Images/9e7ca61ae520d78a6ac4c8270c67efac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*09hJrDE4x__blX5N"/></div></div></figure><h2 id="308b" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第二步</h2><p id="c199" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">选择 web 应用程序的类型作为 API。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/48fdd68f00aedc6da266c1b9f98a012b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BpA4JiJuE78D9j3W"/></div></div></figure><h2 id="f77c" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第三步</h2><p id="8b72" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建项目后，项目的文件夹结构如下所示</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/80dd5e31fe58c2822e823f38a2717a4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/0*lvx1nL_K95zEXZOz"/></div></figure><h2 id="b599" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第四步</h2><p id="d042" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">下一步是实现一个使用 IHostedService 接口的类。让我们创建一个新的类文件，并根据您的选择命名它。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/bf3147a2c130377024a273dbef73ffbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*anPpdz2gwLFefI9i"/></div></div></figure><h2 id="1670" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第五步</h2><p id="6b2b" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">从 Microsoft.Extensions.Hosting 继承 IHostedService 接口。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/18eab0348302b400c8627e3ae3df2036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2HIzGtpBWdu1TsET"/></div></div></figure><h2 id="dee5" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第六步</h2><p id="7de4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">IHostedService 接口有两个方法，要求它由继承它的类实现。一个是启动异步，另一个是停止异步。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/f6f7bec061e27c92819f6c35722be41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/0*-PJ3ydKXq68XKJxu"/></div></figure><h2 id="e390" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第七步</h2><p id="894c" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">现在在实现 IHostedService 的类中，让我们创建一个全局计时器并初始化计时器。我们会提供-</p><ul class=""><li id="c500" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn md ju jv jw bi translated">我们需要执行的方法</li><li id="74c3" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn md ju jv jw bi translated">必须执行该方法的频率或时间范围。</li></ul><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/e8697903f8befa95cf2c80b1d9b9292a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bVYhAH8HdexB-Ubj"/></div></div></figure><h2 id="2f81" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第八步</h2><p id="4d03" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在方法名中，插入需要在后台运行的逻辑。在我们的例子中，我们实现了一个简单的控制台。WriteLine，一个带有时间和消息的语句，用于通知方法被触发的时间间隔。</p><h2 id="c221" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第九步</h2><p id="a3cd" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在 startup.cs 文件中的 configure services 部分下，添加下面一行以将托管服务注入到应用程序中。</p><pre class="lu lv lw lx fd mf mg mh mi aw mj bi"><span id="c095" class="lf kd hi mg b fi mk ml l mm mn">services.AddHostedService&lt;PartechHostedService&gt;();</span></pre><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/cde2001269e57be4cfdd8b8a69dec11b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x3rfzPw6iAMltCIg"/></div></div></figure><p id="b332" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，“PartechHostedService”是使用了 IHostedService 的类名</p><h2 id="9d3f" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十步</h2><p id="6c00" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">页眉—使用 Microsoft。需要在 PartechHostedServices 和 Startup 类中添加 AspNetCore.Hosting 以使用 IHostedService</p><h2 id="7be4" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">步骤 11</h2><p id="5009" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">将项目运行设置更改为下拉列表中的项目名称，然后运行该项目。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/b065edae04317205469e82e8483505dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/0*gbYLBrQnhIdVoZt_"/></div></figure><h2 id="dc68" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">步骤 12</h2><p id="7a12" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">请注意控制台窗口中的结果。您将看到应用程序已经启动，并且端点数据在浏览器中可用。您还会注意到，打算并行运行的方法也在控制台窗口中提供数据。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/b26a0ffad16ad39df914018e27829ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FfTMTwtL7C3ya4bK"/></div></div></figure><p id="2688" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，使用 IHostedService 接口和方法实现来实现与 web 应用一起实现后台任务的过程。</p><p id="414d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们提供了一个定时器变量，并在 StartAsync 方法中初始化了它。这也适用于需要在特定时间间隔触发的方法。并且 StopAsync 方法在应用程序停止之前被触发。</p><p id="768d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看使用后台服务类而不是 IHostedService 来实现相同功能的另一种方法。在此方法中，正在创建的新类继承了 BackgroundService，并覆盖了 ExecuteAsync 方法。</p><p id="e752" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">后台服务相对于托管服务的优势在于，它是一个实现 IHostedService 接口的抽象类。默认情况下，它负责需要为 IHostedService 实现的启动和停止异步元素。</p><p id="d77f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在接下来的步骤中，让我们看看如何在同一个项目中实现后台服务。</p><h2 id="7c4b" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十三步</h2><p id="82a4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">让我们创建一个新的类，继承后台服务，并为它提供一个有效的头引用。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mq"><img src="../Images/669818332dc95eb83f7c129e6339d4ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SC2_XDOfq0smWhlU"/></div></div></figure><h2 id="a913" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">步骤 14</h2><p id="3750" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建覆盖方法 ExecuteAsync 方法，以及需要实现的必要功能。在这里，我们将打印* <strong class="is hj"> DateTime。现在. ToString() +"欢迎来到 PARTECH 世界！来自后台服务" * </strong></p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/a30264228cca000e58175d4c94ea03a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3u3z_pz_FMg3Nedx"/></div></div></figure><h2 id="6b5e" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十五步</h2><p id="d037" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在 startup.cs 文件中，注释正在为 IHostedService 实现的代码，并通过在启动的 Configureservices 方法中添加以下行来为新类创建新的依赖注入。</p><pre class="lu lv lw lx fd mf mg mh mi aw mj bi"><span id="2915" class="lf kd hi mg b fi mk ml l mm mn">services.AddTransient&lt;IHostedService, PartechBackgroundService&gt;();</span></pre><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/15de6c535d08f0478fe6ac221bbc5ead.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/0*p97EQo2zJ1EDC_DO"/></div></figure><h2 id="571a" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">第十六步</h2><p id="7ac3" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">现在运行解决方案并观察结果。有了新代码，新消息将打印在控制台窗口中，并按照提到的频率运行。</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/43f197107241ee93d017f011f30e7177.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DmbSKd_pA3TJTXwI"/></div></div></figure><h1 id="4160" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="c872" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">借助 IHosted 和后台服务，您可以轻松运行后台任务。最棒的是，你不需要任何基础设施支持。这种方法对于需要定期执行的短期和简单任务来说非常方便。</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><p id="b2aa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mz">原载于</em><a class="ae na" href="https://www.partech.nl/nl/publicaties/2021/04/practical-implementation---net-core-background-services" rel="noopener ugc nofollow" target="_blank"><em class="mz">https://www . partech . nl</em></a><em class="mz">。</em></p></div></div>    
</body>
</html>