<html>
<head>
<title>Getting Started with AWS CLI, Windows PowerShell &amp; JSON Parser</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS CLI、Windows PowerShell和JSON解析器入门</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/getting-started-with-aws-cli-windows-powershell-json-parser-9ff1fc1fc138?source=collection_archive---------0-----------------------#2020-10-13">https://medium.com/nerd-for-tech/getting-started-with-aws-cli-windows-powershell-json-parser-9ff1fc1fc138?source=collection_archive---------0-----------------------#2020-10-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/230a65640f930189f4408998c0997d2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*woKna2vh0a141OTnH6fQCQ.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">由Raktim创建</figcaption></figure><div class=""/><div class=""><h2 id="2cb0" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">让我们了解如何使用AWS CLI和Windows高级shell脚本(PowerShell和JSON解析)在AWS上工作。</h2></div><p id="0807" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi ki translated">他的文章将帮助你<strong class="jo hy">学习AWS命令行界面的基础知识。</strong>此外，我们将学习<strong class="jo hy">如何在Windows PowerShell和JSON解析器上工作。</strong>然后我们将<strong class="jo hy">整合这些东西来创建一个自动化脚本</strong>，它将帮助我们<strong class="jo hy">在AWS上提供一些资源。让我们一个一个地开始吧…</strong></p><h1 id="a0ca" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">AWS CLI:</h1><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lj"><img src="../Images/d534e5d3deeee05b4424bbf488d07640.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9mdP7WdhaveLTx65.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">来源:谷歌</figcaption></figure><p id="6745" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi ki translated">AWS命令行界面(CLI)是管理AWS服务的统一工具。只需下载和配置一个工具，我们就可以<strong class="jo hy">从命令行控制多个AWS服务</strong>并通过脚本实现自动化。</p><ul class=""><li id="8a74" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">我不想浪费你的时间来解释什么是AWS CLI，因为一旦我们开始练习，你就会很容易理解。简单地说，你可以认为它是一个程序，为我们提供了一个名为“aws”的命令。使用这个命令，我们作为AWS的用户可以与我们的AWS帐户通信，并且可以控制AWS帐户上的几乎所有东西。这个程序的伟大之处在于你可以在任何操作系统上运行它。</li><li id="9e5d" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated"><strong class="jo hy"> <em class="mc">了解更多AWS CLI:</em></strong><a class="ae md" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"><em class="mc">https://aws.amazon.com/cli/</em></strong></a></li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es me"><img src="../Images/96db451eb4b467732ad41e86d6e92bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k3GLX0Y400piYI7Qq6zVyA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">来源:谷歌</figcaption></figure><h2 id="bc54" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">安装AWS CLI:</h2><p id="5f1f" class="pw-post-body-paragraph jm jn hx jo b jp mt iy jr js mu jb ju jv mv jx jy jz mw kb kc kd mx kf kg kh hb bi translated"><strong class="jo hy">AWS CLI的安装就是这么简单。</strong>您只需从下面提到的链接下载该应用程序，就像我们安装任何其他应用程序一样，只需运行该应用程序并持续点击，它就会被安装。</p><ul class=""><li id="f1a0" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated"><strong class="jo hy"> <em class="mc">下载AWS CLI:</em></strong><a class="ae md" href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"><em class="mc">https://docs . AWS . Amazon . com/CLI/latest/user guide/install-CLI v2 . html</em></strong></a></li></ul><blockquote class="my mz na"><p id="4038" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated"><strong class="jo hy">安装完成后，打开命令提示符或终端，运行下面提到的命令，检查它是否工作… </strong></p></blockquote><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ne"><img src="../Images/1b44be8d3c4811d7e2ff210533da8451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5qqg8PN7LnMoWx-YSSKLVg.png"/></div></div></figure><h2 id="169a" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">配置AWS CLI:</h2><p id="bf4c" class="pw-post-body-paragraph jm jn hx jo b jp mt iy jr js mu jb ju jv mv jx jy jz mw kb kc kd mx kf kg kh hb bi translated">开始之前，<strong class="jo hy">我们需要aws访问密钥和密钥来进行配置。</strong>因为对于人类，我们使用用户名和密码进行身份验证。但是为了验证任何程序，我们使用访问密钥和秘密密钥。</p><ul class=""><li id="62f2" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">要获得您需要的东西，请从AWS Web控制台<strong class="jo hy">转到您的AWS帐户。然后转到“IAM”service =&gt;点击“Users”=&gt;然后点击“Add User”并创建一个用户。</strong></li><li id="d111" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">然后点击<strong class="jo hy">“程序化访问”</strong>，如果你阅读这个访问的描述，你可以看到，<strong class="jo hy">给了我们“访问密钥”和“秘密密钥”</strong>。参考下面提到的截图…</li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/47e3c67e94fdab4157b3f9fc67b23ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6oHSI_eB8iIbmghSyBCxw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">AWS IAM截图</figcaption></figure><ul class=""><li id="5ffe" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">接下来，转到<strong class="jo hy">“权限”</strong>，点击<strong class="jo hy">“附加现有策略”。如果你知道IAM，你可以选择你想要的政策。<strong class="jo hy">但是为了简单起见，我给了“管理员访问”权限。</strong>请参考下面提到的截图…</strong></li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/1eaa46d8914bf7d6a03f044cb220d0b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5OsxvJ9Pht6NncBjPRRoWA.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">AWS IAM截图</figcaption></figure><ul class=""><li id="d738" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">接下来，点击<strong class="jo hy">“标签”</strong>并给出任何想要的标签。然后点击<strong class="jo hy">“审核”，再点击“创建用户”。</strong>接下来，它将为您提供<strong class="jo hy">一个选项来查看您的访问密钥和秘密密钥。</strong>不要忘记点击下载按钮“下载”凭证以备将来参考。</li></ul><blockquote class="my mz na"><p id="c97c" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated"><strong class="jo hy"> <em class="hx">现在该用我们的AWS帐户验证我们的AWS CLI了。为此，请转到命令行，键入下面提到的命令。</em> </strong></p></blockquote><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="a0af" class="mf ks hx ng b fi nk nl l nm nn">aws configure</span></pre><ul class=""><li id="31c4" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">接下来，提供您的<strong class="jo hy">“访问密钥”</strong>和<strong class="jo hy">“密钥”</strong>，然后<strong class="jo hy">提供区域</strong>表示您想要在哪个区域上工作。<strong class="jo hy">最后在“输出格式”中不提供任何东西。为了便于参考，请查看下面提到的截图…</strong></li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es no"><img src="../Images/a6b250933754c5921b48bf5bd45b67c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UzFIptvV5_DlDg9IGjZyGA.png"/></div></div></figure><ul class=""><li id="b042" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated"><strong class="jo hy">接下来，确保您的AWS CLI能够与您的AWS帐户通信。运行下面提到的命令，如果您没有看到错误，则表示我们已经成功设置了我们的AWS CLI……</strong></li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es np"><img src="../Images/bdb30afeff93f5dcad4e938603c55890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dZv0r9rtiGx9VxPza5g1Hg.png"/></div></div></figure><h1 id="a593" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">AWS CLI基础:</h1><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nq"><img src="../Images/14511b6de11dac0cdfbc8c0a10112dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AcPc36C0Z6vYpPn1hfjqDw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">由Raktim创建</figcaption></figure><ul class=""><li id="c8e2" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">通常，<strong class="jo hy">在AWS CLI上运行任何命令之前，</strong>您应该有一些关于AWS的<strong class="jo hy">知识，</strong>您也应该知道<strong class="jo hy">您想要在哪个服务上工作。</strong></li><li id="9c1d" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">要找到基本的命令结构，你可以运行<strong class="jo hy">“AWS帮助”命令。坦率地说，AWS CLI的文档太多了，所以请尝试使用帮助来利用它。</strong></li><li id="1125" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">运行帮助后，你只需继续按<strong class="jo hy">空格键滚动和“q”退出。</strong>现在<strong class="jo hy">我的要求是在“EC2”服务上检查一些东西</strong>。因此，如果你稍微阅读一下帮助，你会看到有一个名为“ec2”的<strong class="jo hy">子命令。</strong></li><li id="c356" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">现在<strong class="jo hy">让我们来看看“ec2”的帮助。对于运行" aws ec2 help" </strong>来说，再次通过阅读这个输出，我们可以理解" aws ec2 "命令也有一些子命令。<strong class="jo hy">“AWS ec2”命令的子命令之一是“描述-实例”。</strong>这个子命令告诉我们实例的细节。<strong class="jo hy">现在回到我们刚刚运行的最后一个命令，你会明白，这一次我的帐户上没有任何实例，所以输出什么也没有显示。</strong></li><li id="ef47" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">现在，这里需要注意的一点是，默认情况下,<strong class="jo hy">AWS CLI以JSON格式向我们提供输出。</strong>因此，<strong class="jo hy">为了从这些输出中过滤数据，我们需要将它们传递给一个JSON解析器。</strong></li><li id="2f2a" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，我将讨论JSON parser，因为一旦我们学习了JSON parser，然后我们进入实际操作，就很容易理解如何使用AWS CLI配置资源。</li></ul><h1 id="586c" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">JSON解析器(JQ):</h1><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nr"><img src="../Images/cea6d26420f52714c89f76d6c7923fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iOM7Ik_EotoCsS21.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">来源:谷歌</figcaption></figure><p id="4bdd" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi ki translated">Q是一个程序，我们使用它进行JSON解析或者从JSON脚本中获取数据。 JQ就像是JSON数据的<strong class="jo hy">sed</strong>——你可以用它来<strong class="jo hy">切片、过滤、映射和转换结构化数据</strong>，就像sed、awk、grep和friends让你玩文本一样容易。jq是用可移植的C语言编写的，它没有运行时依赖性。</p><h2 id="1ef0" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">JQ的安装:</h2><p id="df33" class="pw-post-body-paragraph jm jn hx jo b jp mt iy jr js mu jb ju jv mv jx jy jz mw kb kc kd mx kf kg kh hb bi translated"><strong class="jo hy">安装JQ非常简单。我建议按照下面提到的YouTube链接安装JQ程序。</strong></p><ul class=""><li id="ef9a" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated"><strong class="jo hy">【https://youtu.be/rrjIVepRqPI】</strong>安装:  <a class="ae md" href="https://youtu.be/rrjIVepRqPI" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy"> <em class="mc">安装</em></strong></a></li></ul><h2 id="6152" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">JQ基础知识:</h2><p id="0565" class="pw-post-body-paragraph jm jn hx jo b jp mt iy jr js mu jb ju jv mv jx jy jz mw kb kc kd mx kf kg kh hb bi translated">这里我也不想谈论太多JSON解析，因为我认为一旦我们开始编写automaton脚本，你将能够很容易地理解JSON解析。但是我建议如果你不知道什么是JSON解析或者如何使用JQ，就看下面提到的YouTube视频。</p><ul class=""><li id="6fef" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated"><strong class="jo hy"><em class="mc">https://youtu.be/EvpwhGeiH0U</em></strong><a class="ae md" href="https://youtu.be/EvpwhGeiH0U" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"><em class="mc"/></strong></a></li></ul><h1 id="6b8e" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">Windows PowerShell:</h1><figure class="lk ll lm ln fd hk er es paragraph-image"><div class="er es ns"><img src="../Images/c8ab04aa49efc8facf2b9774d4dfc302.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/0*jjY-5dtd4DofkksN.png"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">来源:谷歌</figcaption></figure><p id="abcb" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi ki translated"><span class="l kj kk kl bm km kn ko kp kq di"> P </span> <strong class="jo hy"> owerShell是一种面向对象的自动化引擎和脚本语言，具有交互式命令行外壳，由微软开发，用于帮助IT专业人员配置系统和自动化管理任务。</strong> PowerShell，构建于。NET framework使用对象，而大多数命令行shells都是基于文本的。</p><ul class=""><li id="e79a" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">坦率地说，PowerShell是一个很大的学习课题，因为它有很多工具。但是要做我们实际的<strong class="jo hy">，我们只需要PowerShell的基本变量概念</strong>。这和我们在Linux上使用“Bash Shell”几乎是一样的。这里的<strong class="jo hy">要存储任何变量，首先使用“$”符号，然后是变量名，然后等于(=)我们想要存储在该变量上的值。</strong>例如，参见下面提到的截图……</li></ul><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es nt"><img src="../Images/2c3d553ef5b3fad08e72bc3e3a5c0672.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9OJr3ICWARSQ40JHG8OsBg.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">PowerShell截图</figcaption></figure><blockquote class="my mz na"><p id="7996" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated"><strong class="jo hy">现在，我将讲述更多概念，让我们开始构建自动化脚本，一旦我解释了脚本中的每一行，您将非常容易理解PowerShell和JQ的这些概念。</strong></p></blockquote><h1 id="d046" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">让我们看看问题陈述:</h1><ol class=""><li id="fccd" class="lo lp hx jo b jp mt js mu jv nu jz nv kd nw kh nx lu lv lw bi translated">创建一个密钥对。</li><li id="5176" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh nx lu lv lw bi translated">创建安全组。</li><li id="4a62" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh nx lu lv lw bi translated">使用上面创建的密钥对和安全组启动一个实例。</li><li id="fc74" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh nx lu lv lw bi translated">创建1 GB的EBS卷。</li><li id="83ab" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh nx lu lv lw bi translated">最后一步是将上面创建的EBS卷附加到您在前面步骤中创建的实例。</li></ol><h1 id="90ff" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">先决条件:</h1><ul class=""><li id="cfc3" class="lo lp hx jo b jp mt js mu jv nu jz nv kd nw kh lt lu lv lw bi translated">在本文中，我不会谈论这些AWS资源。我主要关注的是如何使用AWS CLI提供这些资源。所以，我在考虑你<strong class="jo hy">已经掌握了这些资源的知识。</strong></li><li id="bd73" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，我给出了我的文件名<strong class="jo hy">“AWS-CLI . PS1”</strong>。您可以给任何名称，但扩展名应为<strong class="jo hy">“PS1”</strong>。另外，<strong class="jo hy">我使用VSCode作为我的文本编辑器，但是你可以使用任何你想要的编辑器</strong>。</li></ul><blockquote class="my mz na"><p id="1b23" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated"><strong class="jo hy"> <em class="hx">和往常一样，我们会看到脚本的每个部分，最后我会提供GitHub链接，你可以从那里下载整个脚本。</em> </strong></p></blockquote><h2 id="518d" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">设置变量:</h2><figure class="lk ll lm ln fd hk"><div class="bz dy l di"><div class="ny nz l"/></div></figure><ul class=""><li id="5100" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">正如我们可以注意到的，我存储了一些变量，我们将在将来使用这些变量来传递AWS命令。在这里，<strong class="jo hy">我将我的密钥名给了“MyWebKey ”,将安全组名给了“WebSG”。</strong></li><li id="1e8f" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，<strong class="jo hy">我选择了亚马逊Linux 2 AMI ID，存储在一个名为“image_id”的变量中。</strong>接下来，我选择我的实例类型为<strong class="jo hy">“T2 . micro”</strong>，实例计数为1。</li><li id="8964" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，<strong class="jo hy">我选择了要在其中启动实例的子网，以及要在其中调配额外1GB EBS卷的可用性区域。</strong>需要注意的一件非常重要的事情是，确保您的子网属于您为额外EBS选择的同一可用性区域。因为EBS是分区服务。</li><li id="7f99" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">最后，我将<strong class="jo hy">卷大小选择为1表示1GB </strong>，并存储在一个名为“volume_size”的变量中。最后，我将<strong class="jo hy">的卷类型选择为“GP2”</strong>，并存储在一个变量中。</li></ul><h2 id="ff3d" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">创建AWS密钥对:</h2><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="ed0c" class="mf ks hx ng b fi nk nl l nm nn">aws ec2 create-key-pair --key-name "$key_name" --query 'KeyMaterial' --output text | out-file -encoding ascii -filepath "$key_name.pem"</span></pre><ul class=""><li id="0ff4" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">为了创建AWS密钥对，我使用了上面提到的命令。现在让我们来理解如何编写这个命令。</li><li id="2929" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">首先，你已经知道<strong class="jo hy">密钥对属于EC2，这就是我们使用“AWS ec2”作为主命令</strong>的原因，在此命令下，我们运行一个名为<strong class="jo hy">“创建密钥对”</strong>的子命令。这有助于我们创建一个AWS密钥对。</li><li id="28ce" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">现在这个命令有一个参数叫做<strong class="jo hy"> "- - key-name" </strong>。<strong class="jo hy">使用这个参数，我们传递想要设置的键名。接下来，我们调用我们的变量，由于这是shell脚本，所以这个变量将被它的值替换。</strong></li><li id="95a8" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，我们有一个选项叫做<strong class="jo hy">“--查询”。</strong> <strong class="jo hy">该选项作用于任何aws命令的输出，它获取我们想要获取的任何变量的值。</strong>一开始，我已经告诉过<strong class="jo hy"> AWS命令给我们JSON格式的输出，</strong>在这种格式中，我们通常<strong class="jo hy">以键值对的形式存储数据。</strong></li><li id="931e" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">所以，create key命令输出的键之一是<strong class="jo hy">“key material”</strong>。因此，我们获取它的值并使用<strong class="jo hy"> "- -输出"</strong>，我们将它转换成文本格式的数据。</li><li id="db0f" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，<strong class="jo hy">我们将传递包含aws私钥的文本格式数据，使用管道符号(|)将它传递给一个名为“-encoding”的选项以对其进行编码</strong>，最后使用<strong class="jo hy">-file path“我们以pem格式存储此密钥</strong>，在这里我们再次使用变量为我们的密钥赋予与创建时相同的名称。</li></ul><h2 id="ad6f" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">正在创建安全组:</h2><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="37b9" class="mf ks hx ng b fi nk nl l nm nn">$sg_id = aws ec2 create-security-group --group-name "$sg_name"       --description "Security group allowing SSH" |  jq ".GroupId"</span><span id="9652" class="mf ks hx ng b fi oa nl l nm nn">aws ec2 authorize-security-group-ingress --group-id "$sg_id"          --protocol tcp --port 22 --cidr 0.0.0.0/0</span></pre><ul class=""><li id="e509" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated"><strong class="jo hy">从这里开始实际的JSON解析，我们要用到。现在，每次我们在AWS Command上运行任何命令时，它都会以JSON格式给出输出。<strong class="jo hy">接下来，我们使用管道符号(|)将输出传递给下一个命令</strong>。在我们的例子中，<strong class="jo hy">我们将aws命令的输出传递给“jq”</strong>命令。</strong></li><li id="2f90" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">现在让我们来理解第一行。这里我们使用一个名为<strong class="jo hy">“AWS ec2 create-security-group”</strong>的命令，然后我们传递名称和描述等参数。<strong class="jo hy">这些是我们用来创建安全组的非常简单的参数。</strong>接下来，从该命令的<strong class="jo hy">输出，我们使用JSON解析过滤“GroupId”，并最终将其存储在一个名为“sg_id”的变量中。</strong></li></ul><blockquote class="my mz na"><p id="3e72" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated">我知道这有点棘手，但我会在创建实例时再次解释这个相同的概念。所以，不用担心… </p></blockquote><ul class=""><li id="65a7" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">接下来使用<strong class="jo hy">“AWS ec2 authorize-security-group-ingress”</strong>命令，我们正在<strong class="jo hy">向我们创建的安全组添加规则。</strong>现在，如果你注意到<strong class="jo hy">我们正在获取新创建的安全组的id，并且通过变量，我们在这个命令中传递它。</strong>将来，我想在互联网的任何位置使用SSH，这就是为什么允许使用“tcp 22号”端口和“cidr 0.0.0.0/0”。</li></ul><h2 id="f0ce" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">启动实例:</h2><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="ab75" class="mf ks hx ng b fi nk nl l nm nn">$instance_id = aws ec2 run-instances --image-id "$image_id"         --instance-type "$instance_type" --count "$instance_count"           --subnet-id "$subnet_id" --security-group-ids "$sg_id"               --key-name "$key_name" | jq ".Instances[0].InstanceId"</span></pre><ul class=""><li id="baab" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">现在使用<strong class="jo hy">“AWS ec2 run-instances”命令，我们正在启动一个实例。</strong>这里，我们从先前设置的变量中获取映像id、实例类型、计数、子网id、密钥名称。</li><li id="eb79" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来是<strong class="jo hy">“安全组id ”,我们从创建安全组时动态创建的变量中获取。</strong></li><li id="8650" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">最后，我们再次使用<strong class="jo hy">管道符号将这个“aws ec2 run-instances”命令的输出传递给“jq”命令</strong>，然后使用<strong class="jo hy">。Instances[0]"参数我们正在过滤输出，只获取第一个实例的详细信息。</strong></li><li id="cfb3" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">下一步<strong class="jo hy">在获取第一个实例的细节后，我们再次传递。InstanceId”来过滤实例Id。</strong>最后，我们<strong class="jo hy">将它存储在一个名为“instance _ id”</strong>的变量中，以备将来参考。</li></ul><h2 id="beca" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">创建EBS:</h2><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="c14a" class="mf ks hx ng b fi nk nl l nm nn">$volume_id = aws ec2 create-volume --availability-zone "$az" --size "$volume_size" --volume-type "$volume_type" | jq ".VolumeId"</span></pre><ul class=""><li id="8d9c" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">接下来使用<strong class="jo hy">“AWS ec2创建卷”,我们将创建一个1GB的EBS卷。</strong>在这里，我们从之前设置的变量中传递可用性区域的值、卷大小&amp;卷类型值。</li><li id="7ab6" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，我们传递来自“jq”的<strong class="jo hy">输出，解析卷Id并将其存储在一个名为“Volume _ Id”</strong>的变量中。</li></ul><blockquote class="my mz na"><p id="b1b6" class="jm jn mc jo b jp jq iy jr js jt jb ju nb jw jx jy nc ka kb kc nd ke kf kg kh hb bi translated">据你所知，我们在“jq”之后传递的参数完全依赖于前一个命令的输出。像前面的输出一样，我们需要在获取实例后获取实例id。但是这里我们直接获取卷Id。</p></blockquote><h2 id="c6c7" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">附加卷:</h2><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="38bb" class="mf ks hx ng b fi nk nl l nm nn">Start-Sleep 20</span><span id="abb6" class="mf ks hx ng b fi oa nl l nm nn">aws ec2 attach-volume --volume-id "$volume_id" --instance-id "$instance_id" --device /dev/xvdh</span></pre><ul class=""><li id="4424" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">我用这个“开始睡眠”来保持我的外壳20秒。因为通常在我们提供实例后，需要几秒钟才能运行。在它运行之前，我们无法附加EBS卷。这就是为什么我等了20秒，然后最终运行命令来连接EBS。</li><li id="0e90" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">接下来，<strong class="jo hy">我使用“aws ec2 attach-volume”命令，并从我们在启动它们时创建的变量中传递卷id和实例id。最后，我们需要提到一个挂载点，我选择了“/dev/xvdh”。</strong></li></ul><h1 id="9f9e" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">我们跑吧:</h1><h2 id="247a" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">你可以从下面提到的GitHub链接中找到完整的代码…</h2><div class="hh hi ez fb hj ob"><a href="https://github.com/raktim00/AWS-CLI-PowerShell" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab dw"><div class="od ab oe cl cj of"><h2 class="bd hy fi z dy og ea eb oh ed ef hw bi translated">raktim00/AWS-CLI-PowerShell</h2><div class="oi l"><h3 class="bd b fi z dy og ea eb oh ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oj l"><p class="bd b fp z dy og ea eb oh ed ef dx translated">github.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op hp ob"/></div></div></a></div><ul class=""><li id="ec53" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">运行任何PowerShell脚本都是如此简单。只需打开Windows PowerShell并导航到您拥有<strong class="jo hy">“PS1”</strong>文件的工作区。然后只需输入完整的文件名和扩展名，然后“回车”，它就会运行。</li><li id="db17" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">因为，<strong class="jo hy">我使用的是VSCode，所以在这里我们可以使用“f5”键轻松运行我们的脚本。</strong></li></ul><h2 id="06bb" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">让我们看看输出…</h2><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2656b1f84e662261a7322096088a9859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HCMP6s9Ng1LXzqR9RjV9Bw.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">VS代码截图</figcaption></figure><ul class=""><li id="17f2" class="lo lp hx jo b jp jq js jt jv lq jz lr kd ls kh lt lu lv lw bi translated">在左侧的<strong class="jo hy">终端，您可以看到我运行了脚本，最后，我们可以看到我们最后一个命令</strong>的输出，它是卷附加。这意味着我们之前的所有命令都成功运行。</li><li id="6865" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated"><strong class="jo hy">在右边的终端上，我们正在对实例执行ssh，我们可以看到我们成功地执行了SSH。</strong>最后，为了确保v <strong class="jo hy">卷已经连接，在EC2实例中运行下面提到的linux命令。</strong></li></ul><pre class="lk ll lm ln fd nf ng nh ni aw nj bi"><span id="4dfd" class="mf ks hx ng b fi nk nl l nm nn">sudo su - root<br/>fdisk -l </span></pre><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es oq"><img src="../Images/1d932bd0ef3c6b75d6c7ea3c435d6477.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0VXdUZPlSO5RTOq2ey1eug.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">VS代码截图</figcaption></figure><h2 id="63be" class="mf ks hx bd kt mg mh mi kx mj mk ml lb jv mm mn ld jz mo mp lf kd mq mr lh ms bi translated">恭喜…我们已经成功完成了我们的实践，还学习了如何使用AWS CLI、Windows PowerShell脚本和JQ解析器。</h2><h1 id="0e11" class="kr ks hx bd kt ku kv kw kx ky kz la lb jd lc je ld jg le jh lf jj lg jk lh li bi translated">最后的话:</h1><ul class=""><li id="cd77" class="lo lp hx jo b jp mt js mu jv nu jz nv kd nw kh lt lu lv lw bi translated"><strong class="jo hy">这是对这些工具的快速介绍。</strong>这些工具<strong class="jo hy">有无限的可能性</strong>比如我们可以<strong class="jo hy">通过添加更多aws命令来提供更多资源。</strong>如果我们愿意，我们还可以做更多的<strong class="jo hy">高级Shell脚本，因为它也是一种编程语言</strong>，我们可以做几乎所有我们在其他编程语言上做的操作。</li><li id="581b" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">JQ是一个非常有用的工具，我们每天都在使用它，因为在网络中我们总是需要使用JSON。</li><li id="4218" class="lo lp hx jo b jp lx js ly jv lz jz ma kd mb kh lt lu lv lw bi translated">我试图让它尽可能简单。希望你从这里学到了一些东西。请随意查看下面提到的我的LinkedIn个人资料，当然也可以随意发表评论。我写DevOps，云计算，机器学习等等。博客，所以请随时关注我的媒体。</li></ul><div class="hh hi ez fb hj ob"><a href="https://www.linkedin.com/in/raktim00/" rel="noopener  ugc nofollow" target="_blank"><div class="oc ab dw"><div class="od ab oe cl cj of"><h2 class="bd hy fi z dy og ea eb oh ed ef hw bi translated">微软学习学生大使(Alpha) -微软学习学生大使CEE |…</h2><div class="oi l"><h3 class="bd b fi z dy og ea eb oh ed ef dx translated">★我是一名技术爱好者，致力于更好地理解不同热门技术领域背后的核心概念…</h3></div><div class="oj l"><p class="bd b fp z dy og ea eb oh ed ef dx translated">www.linkedin.com</p></div></div><div class="ok l"><div class="or l om on oo ok op hp ob"/></div></div></a></div><p id="9865" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh hb bi translated">感谢大家的阅读。就这样…结束…😊</p><figure class="lk ll lm ln fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es os"><img src="../Images/8c7f1f8215dc1aaecd1e708e7650e726.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Piks8Tu6xUYpF4DU"/></div></div></figure></div></div>    
</body>
</html>