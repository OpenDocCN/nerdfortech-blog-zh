<html>
<head>
<title>Ansible Vault | Role | Conditions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可变保险库|角色|条件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ansible-vault-role-conditions-c8bf0806b772?source=collection_archive---------33-----------------------#2021-06-06">https://medium.com/nerd-for-tech/ansible-vault-role-conditions-c8bf0806b772?source=collection_archive---------33-----------------------#2021-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4aede22e4a1edaab54f02ac555e7fee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*F-CjQzK7LEdSumix.jpeg"/></div></div></figure><p id="86e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">先决条件:</p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/ansible-playbooks-loops-handlers-6abeca0bcac9"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">可翻译的剧本|循环|处理程序</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">先决条件:</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><h1 id="bb1b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">条件:</h1><p id="68f2" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">条件意味着处理不同的场景，执行这些条件需要不同的条件。</p><p id="6fda" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在YAML脚本中，我们使用“when”命令来给出条件。</p><p id="346b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们举一个脚本的例子:</p><p id="a80e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">脚本:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="cfd6" class="ls kh hi lo b fi lt lu l lv lw">--- # My Condition Playbook<br/>- hosts: developers<br/>  user: ansible<br/>  become: yes<br/>  connection: ssh<br/>  gather_facts: yes<br/>  tasks:<br/>          - name: installing apache2 on debian<br/>            command: apt-get -y install apache2<br/>            when: ansible_os_family == "Debian"<br/>          - name: installing httpd on linux<br/>            command: yum install httpd -y<br/>            when: ansible_os_family == "RedHat"</span></pre><p id="3393" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">命令:</strong></p><blockquote class="lx ly lz"><p id="81c6" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> vi conditions.yml //写上面的YAML剧本</em></p><p id="76e4" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook conditions . yml</em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/f1acfeaf86efebfbc4be5e98e1ac11d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*S41e7eJ6ZSNKJxv2.png"/></div></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/9b8e6afb30a98f827cd276f890b8216b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*yovST5GYFPtlnbhY.png"/></div></figure><p id="8fec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">节点1输出:</strong></p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/bb7ffca9f8c3cae0bef575907965c9d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*DsMquYXSmCsQ49Fn.png"/></div></figure><h1 id="7d5b" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">可旋转保险库= &gt;</h1><p id="2938" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">它以加密的方式保存剧本等敏感数据。</p><blockquote class="lx ly lz"><p id="46d2" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">ansi ble-vault create vault . yml//以加密模式创建脚本</em></p><p id="5c57" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> ansible-vault编辑vault.yml //在现有加密脚本中编辑</em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/df69ad10e3912cd8ef094f0c604bd8d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*xyfDOBzocEySTGeI.png"/></div></figure><p id="578c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用VI编辑器编辑加密文件</p><blockquote class="lx ly lz"><p id="92b2" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> vault.yml //脚本输出将处于加密模式</em></p></blockquote><p id="70bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将现有脚本添加到ansi ble-vault[即在加密模式下]</p><blockquote class="lx ly lz"><p id="7973" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> ansible-vault加密&lt;文件名. yml&gt;T15】</em></p><p id="8b39" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> ansible-vault加密target.yml </em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/018007e04de61105487965d6ac51c484.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*KC3peJyznvPGkcYj.png"/></div></div></figure><p id="dcbb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解密YAML脚本ansible-vault解密target.yml</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/56220859a28406d5f1a21e1390eef439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*lr6H5_5KraYZ_sNq.png"/></div></figure><h1 id="a340" class="kg kh hi bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">可变角色= &gt;</h1><p id="9650" class="pw-post-body-paragraph iq ir hi is b it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn hb bi translated">我们可以使用两种技术来重用一组任务:包含和角色。<br/>角色更适合组织任务和封装完成这些任务所需的数据。</p><p id="e824" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">角色类型:</strong></p><ul class=""><li id="dbc4" class="mf mg hi is b it iu ix iy jb mh jf mi jj mj jn mk ml mm mn bi translated">默认</li><li id="5622" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">文件</li><li id="1300" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">经理人</li><li id="f544" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">元</li><li id="20ba" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">模板</li><li id="c3eb" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">任务</li><li id="0a37" class="mf mg hi is b it mo ix mp jb mq jf mr jj ms jn mk ml mm mn bi translated">变量</li></ul><p id="d4c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在角色中，行动手册可以组织在一个目录结构中。<br/>角色很重要，因为给任何文件/脚本添加越来越多的功能会使其处理起来更加复杂。</p><p id="3d97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">角色类型:</strong> <br/> <strong class="is hj">默认:</strong>存储角色/应用默认变量的数据。示例:端口号。<br/> <strong class="is hj">文件:</strong>包含需要转移到远程虚拟机<br/> <strong class="is hj">处理程序的文件:</strong>由另一个任务触发。它们也是一项任务。<br/> <strong class="is hj"> Meta: </strong>该目录包含建立角色依赖关系的文件。例如:作者姓名、支持的平台等等。<br/> <strong class="is hj">任务:</strong>包含行动手册中出现的所有任务。<br/> <strong class="is hj"> Vars: </strong>存储在该目录中的变量，可进一步用于配置</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/d26d1ee0924003aaad3b702cc5be1102.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/0*W_SKO3bg9Wu9KhxE.png"/></div></figure><p id="6c98" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们了解一下角色的结构。<br/>这里剧本是目录，master.yml和roles是剧本目录里面的文件和目录。<br/>目标[主机名、连接类型、用户名]和角色在master.yml中定义，角色信息存储在角色目录中。master.yml和roles处于同一级别，或者说存在于同一目录中。<br/>在角色中，不同的流程，如任务、处理程序、变量等等，被逐一执行。</p><p id="5000" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Linux机器上呈现树结构:</p><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/53168c383ad17ae55ef8ae66b26f6eab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*GYm74W76JGsrcDsJ.png"/></div></figure><p id="71bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们根据YAML剧本创建一个角色并运行它。<br/>创建父目录是指目录内部的目录。-p '标志用于执行此类任务。</p><blockquote class="lx ly lz"><p id="575c" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> mkdir -p剧本/角色/网络服务器/任务</em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/2606341394a591c6e4b42efdc8632d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*nncXGEx_rKuYltGT.png"/></div></figure><p id="5182" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在tasks目录中创建一个main.yml文件，并在roles目录的同一级别创建master.yml文件。</p><p id="89f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">命令:</strong></p><blockquote class="lx ly lz"><p id="f812" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi"> cd剧本</em></p><p id="1308" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">轻触roles/web server/tasks/main . yml</em></p><p id="8d0f" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">触摸master.yml </em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/8813f9d14a44bc80f548da506adfa72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*lPIfFgvtNuhoKKRx.png"/></div></figure><p id="a5df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在剧本目录中创建master.yml与角色目录处于同一级别。</p><p id="35df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">master . yml的脚本:</strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="c371" class="ls kh hi lo b fi lt lu l lv lw">--- # The master script<br/>- hosts: developers<br/>  user: ansible<br/>  become: yes<br/>  connection: ssh<br/>  roles:<br/>          - webserver</span></pre><p id="7c33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经定义了一个角色名webserver。让我们在这个角色中创建一个流程/任务。</p><blockquote class="lx ly lz"><p id="103d" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">VI roles/web server/tasks/main . yml</em></p></blockquote><p id="11cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">main . yml的脚本:</strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="08bd" class="ls kh hi lo b fi lt lu l lv lw">- name: install apache on RedHat<br/>  yum: pkg=httpd state=latest</span></pre><blockquote class="lx ly lz"><p id="50ec" class="iq ir ma is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook master . yml</em></p></blockquote><figure class="lj lk ll lm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/bd7eee1d2e9691de4ae2487064080d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*UYExpnWAAekAkm58.png"/></div></div></figure><figure class="lj lk ll lm fd ij er es paragraph-image"><div class="er es me"><img src="../Images/ce7e1e64d490716fe665086153ac2086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*IhzYglemO685yzT2.png"/></div></figure></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><p id="187e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae nb" href="https://bansalkushagra.medium.com/" rel="noopener">https://bansalkushagra.medium.com/</a></p></div></div>    
</body>
</html>