<html>
<head>
<title>All you need to know about Pointers-Part-2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关于指针你需要知道的一切-第 2 部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/all-you-need-to-know-about-pointers-part-2-b6153ed93fe?source=collection_archive---------0-----------------------#2020-07-28">https://medium.com/nerd-for-tech/all-you-need-to-know-about-pointers-part-2-b6153ed93fe?source=collection_archive---------0-----------------------#2020-07-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/8d30b90192c151245438be911576680a.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*y5Mvda-3kKD_ei1gXOBc3g.png"/></div></figure><p id="06bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">本文是指针系列文章的第二部分。在上一篇文章中，我们讨论了指针的基本概念，并介绍了指针的应用。如果你没有看过第一部分，可以在这里找到<a class="ae jk" rel="noopener" href="/@vaidhyanathan.sm/all-you-need-to-know-about-pointers-part-1-1470d2d24d78">。在这篇文章中，我们将深入了解指针的应用。</a></p><p id="5199" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我想重申一下上一篇文章，我们有两个主要应用:</p><blockquote class="jl jm jn"><p id="2c1b" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">1.引用调用</p><p id="1296" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">2.动态存储分配</p></blockquote><p id="4371" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们先来看看关于<strong class="io hj">的引用调用</strong>。另一个经常看到的术语是<strong class="io hj">按值调用</strong>。考虑下面的例子<strong class="io hj">交换两个数字。</strong></p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="cf4e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从上面的代码可以推断出，<em class="jo">形式参数中的变化并没有反映回实际参数</em>。也就是说，由 swap()函数执行的交换是局部的，并不显示 num1 和 num2 的实际值的变化(大体上)。发生这种情况是因为<strong class="io hj">通过值</strong>调用。</p><p id="cd90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，如果我们真的想要将更改反映回实际的参数，那么我们需要通过引用进行<strong class="io hj">调用。在引用调用中，我们<strong class="io hj">将变量</strong>的地址传递给函数。请参见下图:</strong></p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="9627" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里，我们将变量的地址传递给 swap()函数，为了存储地址，函数 swap 的变量(参数)必须是指针。因为，我们知道<strong class="io hj">指针</strong>是一个变量，可以存储另一个变量的地址。现在，在这种情况下，<em class="jo">因为地址是作为参数传递给函数的，所以这些地址上的值被交换</em>。因此，现在<strong class="io hj">形式参数</strong>的变化反映回了<strong class="io hj">实际参数。</strong></p><p id="e14d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">接下来，我们探讨一下所谓的<strong class="io hj">双指针</strong>。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><p id="d675" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">能够保存<strong class="io hj">指针</strong>的<strong class="io hj">地址</strong>的<strong class="io hj">变量</strong>(其本身保存另一个变量的地址)是一个双指针。为清晰起见，请参见下图。</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="ffba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可以注意到，ptr 保存 a 的地址，dptr 保存 ptr 的地址。这意味着*dptr 指向存储在 ptr 中的值(即 a 的地址)。**dptr 表示 ptr 存储的地址值为 10。</p><p id="bbd7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从图表上看，它可以如下图所示:</p><figure class="js jt ju jv fd ij er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kf"><img src="../Images/e20f272995e9f0166eb9e89108a4bd35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JanwYw2M-gNpPSVHxWWZnA.png"/></div></div><figcaption class="kk kl et er es km kn bd b be z dx translated">内存中指针的表示</figcaption></figure><p id="ebe8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们该转向动态内存分配了。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="52ab" class="ko kp hi bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">对动态内存分配的需求</h1><p id="f70f" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">一般来说，要在内存中分配的<strong class="io hj">大小</strong>(比如一个数组)在编译时就已经知道了。在这种情况下，我们用已知的大小初始化数组。请参见下面的示例:</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="0c95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">当大小已知时，这就是我们处理普通数组的方式。</p><p id="c954" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有时，会出现这样的情况:数组的大小只有在执行时(运行时)才知道。实际上，这种情况可以在不使用<strong class="io hj">动态内存分配</strong>的情况下<strong class="io hj">处理。请参见下面的示例:</strong></p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="01a6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的代码中，我们在运行时获取数组的大小，并相应地分配内存。但是，这种方法的<strong class="io hj">缺点</strong>是<em class="jo">分配给数组的内存只有在其作用域结束后才会被释放，这是 main()函数</em>。动态内存分配(DMA)允许我们更有效地管理内存。主要的好处是我们可以防止<strong class="io hj">内存的浪费</strong>。此外，更重要的是，数据结构可以根据需求增长和收缩。我们可以根据需要分配、重新分配和取消分配空间。</p><p id="fac1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们探索一下在 c 中 DMA 是如何实现的。我们可以通过使用<strong class="io hj">内存管理函数</strong>来实现。让我们看看 C 程序的存储结构。</p><figure class="js jt ju jv fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/a97f4fd44805ef319b65811d2930dd91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*tfxCZD6MQL4_peCyfVlYgw.png"/></div><figcaption class="kk kl et er es km kn bd b be z dx translated">C 程序的存储</figcaption></figure><p id="2f00" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">内存管理功能包括:</p><blockquote class="jl jm jn"><p id="02bb" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">1.malloc()</p><p id="15bd" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">2.卡洛克()</p><p id="4d39" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">3.realloc()</p><p id="8aa8" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">4.免费()</p></blockquote><h2 id="f581" class="ls kp hi bd kq lt lu lv ku lw lx ly ky ix lz ma lc jb mb mc lg jf md me lk mf bi translated">分配一块内存:malloc</h2><p id="120d" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">可以使用 malloc()分配一块内存。malloc()函数保留一个指定大小的块，并返回一个 void 类型的指针。malloc()的语法如下:</p><blockquote class="jl jm jn"><p id="257b" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">ptr = (cast-type *) malloc(字节大小)</p></blockquote><p id="0695" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们看一个例子:</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="476d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在上面的程序中，内存是根据用户在运行时给定的大小来分配的。</p><h2 id="032d" class="ls kp hi bd kq lt lu lv ku lw lx ly ky ix lz ma lc jb mb mc lg jf md me lk mf bi translated">分配多个内存块</h2><p id="f4cb" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">calloc()是另一个内存分配函数，用于在运行时分配内存空间，以存储派生的数据类型，如数组或结构。malloc()分配单个存储空间块，calloc()分配多个存储空间块，每个块的大小相同，并将所有字节设置为零。calloc()的语法如下:</p><blockquote class="jl jm jn"><p id="cd79" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">ptr =(铸件类型*) calloc (n，elem-size)；</p></blockquote><p id="8b93" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请参见下面的示例:</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><blockquote class="jl jm jn"><p id="bf2d" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">注意:需要使用 free()函数来释放空间，正如您在上面的例子中所看到的。</p></blockquote><h2 id="649b" class="ls kp hi bd kq lt lu lv ku lw lx ly ky ix lz ma lc jb mb mc lg jf md me lk mf bi translated">改变块的大小:realloc()</h2><p id="2f29" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated">函数 realloc()用于改变已经使用 malloc()或 calloc()分配的内存空间。</p><p id="38e7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请参见下面的示例:</p><figure class="js jt ju jv fd ij"><div class="bz dy l di"><div class="jw jx l"/></div></figure><h2 id="3f22" class="ls kp hi bd kq lt lu lv ku lw lx ly ky ix lz ma lc jb mb mc lg jf md me lk mf bi translated">DMA 的优点和缺点</h2><p id="72e9" class="pw-post-body-paragraph im in hi io b ip lm ir is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj hb bi translated"><em class="jo">优点</em>:</p><blockquote class="jl jm jn"><p id="ed72" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">1.数据结构可以根据需求增长和收缩。</p><p id="7b44" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">2.我们可以根据需要分配、重新分配和取消分配内存空间。</p><p id="f744" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">3.DMA 在运行时发生。</p></blockquote><p id="ba93" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="jo">缺点</em>:</p><blockquote class="jl jm jn"><p id="c4e5" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">1.由于内存是在运行时分配的，因此需要更多的时间。</p><p id="2b0a" class="im in jo io b ip iq ir is it iu iv iw jp iy iz ja jq jc jd je jr jg jh ji jj hb bi translated">2.完成后，用户需要释放内存。否则，它可能会导致一些错误，这些错误以后会变得难以调试。</p></blockquote><p id="2bca" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以，这都是关于 DMA 的。希望你喜欢阅读这篇文章！</p><p id="16a8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果您有任何疑问，请在下面的<strong class="io hj">评论</strong>部分发帖。在<a class="ae jk" href="https://www.linkedin.com/in/vaidhyanathansm/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上与我联系。此外，如果你想看看我开发的惊人的应用程序集，别忘了查看<a class="ae jk" href="https://play.google.com/store/apps/developer?id=Programmers+Gateway" rel="noopener ugc nofollow" target="_blank">谷歌 Play 商店</a>。</p><p id="5933" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">更多了解我<a class="ae jk" href="https://vaidhyanathansm.tech/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="7ed0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">话虽如此，感谢阅读我的文章和<em class="jo">快乐编码！</em></p></div></div>    
</body>
</html>