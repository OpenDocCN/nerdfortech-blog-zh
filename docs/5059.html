<html>
<head>
<title>Working with animation states | Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用动画状态| Unity</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/working-with-animation-states-unity-ed82814c3fcd?source=collection_archive---------0-----------------------#2021-08-25">https://medium.com/nerd-for-tech/working-with-animation-states-unity-ed82814c3fcd?source=collection_archive---------0-----------------------#2021-08-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="2ad8" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">统一指南</h2><div class=""/><div class=""><h2 id="e124" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">关于如何在 Unity 中使用动画状态的快速指南</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/b9e824c57f064f312bb13349ea3e01b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ilgZsIGwph4edSTaGruKXA.gif"/></div></div></figure><p id="10c3" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated"><strong class="ju hs">目标</strong>:执行一个动画后，使用动画状态来处理玩家的位置。</p><p id="a59b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在上一篇文章中，我介绍了<a class="ae ko" href="https://fas444.medium.com/creating-a-ledge-grab-mechanic-unity-ec78c0c8fa40" rel="noopener">如何用 Unity </a>为我们的玩家创建一个抓岩架的机制。现在，是时候处理动画状态了，以便在我们的平台游戏中动画结束后处理玩家的位置。</p><h1 id="de01" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">当前动画状态</h1><p id="98f6" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">如果你没有看过我的上几篇帖子，我建议你去看看，以防你不知道如何用 Unity 添加新的动画:</p><div class="lm ln ez fb lo lp"><a href="https://fas444.medium.com/creating-a-ledge-grab-mechanic-unity-ec78c0c8fa40" rel="noopener follow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hs fi z dy lu ea eb lv ed ef hr bi translated">创建壁架抓取机制| Unity</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">关于如何在 Unity 中创建壁架抓取机制的快速指南</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">fas444.medium.com</p></div></div><div class="ly l"><div class="lz l ma mb mc ly md jq lp"/></div></div></a></div><div class="lm ln ez fb lo lp"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/animating-player-unity-5e04ba44fb19"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hs fi z dy lu ea eb lv ed ef hr bi translated">动画播放器| Unity</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">关于如何在 Unity 中制作 3D 播放器动画的快速指南</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">medium.com</p></div></div><div class="ly l"><div class="me l ma mb mc ly md jq lp"/></div></div></a></div><p id="bede" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在这些帖子中，我们为玩家实现了下一个动画状态:</p><div class="jh ji jj jk fd ab cb"><figure class="mf jl mg mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/c8ac19b4d454c6917a18c62d8460a873.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*4v3tpmnw1U6c5il8kSmEvQ.png"/></div></figure><figure class="mf jl ml mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/9ff522191ee24d262ab79d84ff1925b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*rODcNAdfMlo1153-aPYkQw.png"/></div></figure></div><h1 id="3d11" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">新动画</h1><p id="4d5e" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">因此，为了跟进上一篇文章(其中我们实现了一个抓取壁架的动画)，让我们实现一个新的动画来显示我们的玩家爬上壁架:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es mm"><img src="../Images/20742587b96c87ce364adc5f991a6efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/1*ZbNEURaIiX_5mPoQILVUFg.gif"/></div><figcaption class="mn mo et er es mp mq bd b be z dx translated">这部动画是从<a class="ae ko" href="https://www.mixamo.com/" rel="noopener ugc nofollow" target="_blank"> Mixamo </a>免费获得的。</figcaption></figure><p id="54bb" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后，为了在新状态下添加和处理动画，让我们:</p><ul class=""><li id="883d" class="mr ms hi ju b jv jw jy jz kb mt kf mu kj mv kn mw mx my mz bi translated">将文件拖到 Animator 窗口中。</li><li id="a8f6" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">从壁架抓取动画创建新的过渡。</li><li id="c93f" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">创建一个 Trigger 类型的新参数来触发动画。</li><li id="8f16" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">选择来自壁架抓取动画的新过渡。</li><li id="1814" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">禁用<strong class="ju hs"> <em class="nf">具有退出时间</em> </strong>属性，以避免在执行攀爬动画之前等待最后一个动画结束。</li><li id="1c13" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">添加新的触发参数作为转换到爬升状态的条件。</li></ul><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/8f2e9ef116d37aa754e71205646db0e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*F1L2zBVKb9Bh10E-jeeolQ.gif"/></div></div></figure><div class="jh ji jj jk fd ab cb"><figure class="mf jl ng mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/fd35e692b4b7cb1f0dd4e08ba4b37168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1448/1*aQEUBkPKmYQj23p5ofYVOQ.gif"/></div></figure><figure class="mf jl nh mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/414dbe7fbfe1558958be504e1ce35c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/1*zajT9zonIdpAZtf0gkfXeg.gif"/></div></figure></div><h2 id="9299" class="ni kq hi bd kr nj nk nl kv nm nn no kz kb np nq lb kf nr ns ld kj nt nu lf ho bi translated">触发动画</h2><p id="4dee" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">现在，为了表明玩家当前正在抓取一个壁架(来自上一篇文章)，让我们打开玩家脚本并使用一个新的 bool:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es nv"><img src="../Images/8cc6f0f87d3e9eae112363d3d5c9dcce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZU-9X41FsAUVw1SCOXHOqA.png"/></div></div></figure><p id="ead2" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后，为了在玩家向前移动时触发动画，让我们执行<strong class="ju hs">更新</strong>方法中的下一步:</p><ul class=""><li id="0c11" class="mr ms hi ju b jv jw jy jz kb mt kf mu kj mv kn mw mx my mz bi translated">检查玩家是否正在抓一个壁架。</li><li id="81d5" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">检查玩家是否试图向前移动。</li><li id="afb1" class="mr ms hi ju b jv na jy nb kb nc kf nd kj ne kn mw mx my mz bi translated">使用 animator 组件中的<strong class="ju hs"> SetTrigger </strong>方法触发动画。</li></ul><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es nw"><img src="../Images/024ff2c1f99318e82099d3960dc0d1d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*bIpFmFPskYoYXD2yLY1i1A.png"/></div></figure><p id="ed83" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">如果我们在 Unity 中运行游戏，我们会看到动画按预期执行，但是，在动画结束后还有一个细节。我们可以注意到玩家游戏对象(碰撞器)静止在壁架上，这是因为我们的动画被烘焙到该位置，因此它们不会影响根变换:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/953c607e1627f6bd2b9d37fd470e1699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*K1X-elwOa27YNOu64kpn4Q.gif"/></div></div></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/acbab01b262ad93062a78729c5d63f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*4dZUW2qnrblk_4rwbfdqGQ.gif"/></div></div></figure><h1 id="fb02" class="kp kq hi bd kr ks kt ku kv kw kx ky kz ix la iy lb ja lc jb ld jd le je lf lg bi translated">使用动画状态</h1><p id="30a0" class="pw-post-body-paragraph js jt hi ju b jv lh is jx jy li iv ka kb lj kd ke kf lk kh ki kj ll kl km kn hb bi translated">那么，我们能做些什么来改变这种情况呢？……我们可以用动画状态来处理它！</p><p id="4164" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">首先，让我们创建一个从攀爬状态到空闲状态的新过渡，以便玩家在攀爬壁架后执行空闲动画。不要忘记将<strong class="ju hs"> <em class="nf">已经退出</em> </strong>属性启用，因为动画需要在进入空闲状态之前完成:</p><div class="jh ji jj jk fd ab cb"><figure class="mf jl nx mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/5d91a9435d1ab2ecfde948cc2ab4ba8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1518/1*qqPx_3doriKPnQDe6OQO2g.gif"/></div></figure><figure class="mf jl ny mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/c9ed164415ecefa041cf50c9cd00ab25.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*0aWyvRH7Vh1a8NNe3bNntw.png"/></div></figure></div><p id="61ac" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后，为了在动画结束时改变玩家的位置，我们给攀爬状态添加一个<strong class="ju hs">statemachinehaviation</strong>script<strong class="ju hs"/>组件:</p><div class="jh ji jj jk fd ab cb"><figure class="mf jl nz mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/d64a5b58c75fc40978eec3d429998cdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/1*-R3GhFksq5kyjrl39bUG8w.gif"/></div></figure><figure class="mf jl oa mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/17c390a0bfff1d3780b2ce8a41af1cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/1*x5CN7t_hvjF04EIBg3BVpw.gif"/></div></figure></div><p id="93cb" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">接下来，让我们创建一个新的空游戏对象来指示攀爬动画结束时玩家模型的确切位置:</p><div class="jh ji jj jk fd ab cb"><figure class="mf jl ob mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/eef504ababca54450837bdc0c6a901a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/1*7xwznnd_KDvn8Fx9VL9j6Q.gif"/></div></figure><figure class="mf jl oc mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/3e55debca6f6e71054514d34c89d31a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/1*Y1sF70KPzTsOwezZYIIw9g.gif"/></div></figure><figure class="mf jl od mh mi mj mk paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><img src="../Images/502b32fb52aed39328fc85625bb22a76.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*Gf4qkCZECsL52crpZFcueA.png"/></div></figure></div><p id="91cf" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在，让我们打开玩家脚本并创建一个新变量(除了新的 bool)来保存我们刚刚创建的 gameobject 的<strong class="ju hs"> Vector3 </strong>位置:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div class="er es oe"><img src="../Images/49e131d4a61a5197501d624a5cd1b171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1304/format:webp/1*swNnnwOLCqRzLLwardGOsw.png"/></div></figure><p id="a85b" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">当我们执行每次玩家抓住壁架时被调用的公共函数时，我们将设置各自的位置:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es of"><img src="../Images/6c7149e0facd44fd64e51d871cd5ed0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e1uUwea8bMD3x_AMA6f2XA.png"/></div></div></figure><p id="ac37" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在，让我们创建一个新的公共函数，它将在玩家爬上当前壁架时改变玩家的位置，并重新启用角色控制器组件以保持在平台上移动:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es og"><img src="../Images/3ca8daf434b59ef73b17dc14dd393c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*rEf9WWRbkWJx-BtXCoSWfg.png"/></div></div></figure><p id="70a8" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">然后，让我们打开为攀爬动画状态创建的<strong class="ju hs">statemachinehaviation</strong>脚本:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es oh"><img src="../Images/a4814bc83c9a6d2028968e3c3405a9f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LB-7vVVWF_gGraPm9zIR3Q.png"/></div></div></figure><p id="d95f" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">在这里，我们可以利用<strong class="ju hs">onsteexit</strong>方法在玩家退出攀爬状态时执行代码:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es oi"><img src="../Images/beca7db55180b254a6ce7d21755e1dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TFTd--TcKoimUsB8Edc2xQ.png"/></div></div></figure><p id="c80c" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">最后，由于我们可以访问我们的播放器的 animator 组件(从参数中)，我们可以从其父级(播放器)获取<strong class="ju hs">播放器</strong>脚本引用，并调用相应的公共函数来更改播放器的位置:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es oj"><img src="../Images/f41821eb0e198fdd0abf1ac8a132ae66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s3EiTB_LJOUvjAbJ87qq2A.png"/></div></div></figure><p id="b2d5" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">如果您想了解更多关于<strong class="ju hs">状态机器行为</strong>组件的信息，您可以访问 Unity 文档:</p><div class="lm ln ez fb lo lp"><a href="https://docs.unity3d.com/ScriptReference/StateMachineBehaviour.html" rel="noopener  ugc nofollow" target="_blank"><div class="lq ab dw"><div class="lr ab ls cl cj lt"><h2 class="bd hs fi z dy lu ea eb lv ed ef hr bi translated">状态机行为</h2><div class="lw l"><h3 class="bd b fi z dy lu ea eb lv ed ef dx translated">unity engine/Inherits from:ScriptableObject/建议更改感谢您帮助我们提高质量…</h3></div><div class="lx l"><p class="bd b fp z dy lu ea eb lv ed ef dx translated">docs.unity3d.com</p></div></div><div class="ly l"><div class="ok l ma mb mc ly md jq lp"/></div></div></a></div><p id="de17" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">现在，如果我们在 Unity 中运行游戏，我们会看到在爬上壁架后动画状态按预期工作:</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/b998d62d8aa61b9d03f8edc604b2129a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*fDs8qsIrfUxOlasCEjAUvg.gif"/></div></div></figure><p id="cc18" class="pw-post-body-paragraph js jt hi ju b jv jw is jx jy jz iv ka kb kc kd ke kf kg kh ki kj kk kl km kn hb bi translated">就是这样，我们用动画状态来统一处理玩家的位置！:d .我会在下一篇文章中看到你，在那里我将展示 Unity 平台游戏的新内容。</p></div><div class="ab cl ol om gp on" role="separator"><span class="oo bw bk op oq or"/><span class="oo bw bk op oq or"/><span class="oo bw bk op oq"/></div><div class="hb hc hd he hf"><blockquote class="os ot ou"><p id="4311" class="js jt nf ju b jv jw is jx jy jz iv ka ov kc kd ke ow kg kh ki ox kk kl km kn hb bi translated"><em class="hi">如果你想了解我更多，欢迎登陆</em><a class="ae ko" href="https://www.linkedin.com/in/fas444/" rel="noopener ugc nofollow" target="_blank"><strong class="ju hs"><em class="hi">LinkedIn</em></strong></a><strong class="ju hs"><em class="hi"/></strong><em class="hi">或访问我的</em> <a class="ae ko" href="http://fernandoalcasan.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ju hs"> <em class="hi">网站</em> </strong> </a> <em class="hi"> :D </em></p></blockquote></div></div>    
</body>
</html>