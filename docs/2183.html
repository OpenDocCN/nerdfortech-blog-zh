<html>
<head>
<title>Steering Kubernetes Applications with Helm</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带舵的转向Kubernetes应用</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/steering-kubernetes-applications-with-helm-4527ddf12aa0?source=collection_archive---------12-----------------------#2021-04-25">https://medium.com/nerd-for-tech/steering-kubernetes-applications-with-helm-4527ddf12aa0?source=collection_archive---------12-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex if ig ih ii"><div class="bz dy l di"><div class="ij ik l"/></div></figure><p id="12b9" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">喂！你要享受Kubernetes的款待了。听我说完。你是一个伟大的集装箱化技术爱好者，正在Kubernetes上开发一个高度可扩展的产品。一切都很好，直到你被告知要包括更多的微服务，管理RBAC和重启所有服务。毫无疑问，你有能力完成所有的任务，但代价是什么。最有可能的是，您将运行多个YAML脚本，考虑它们的时序、依赖的pod、容器和服务的状态。如果您可以通过CLI上的一个命令轻松部署您的应用程序，岂不是更简单？</p><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es jj"><img src="../Images/87433ab0788af0b7b3aa88320093b69b.png" data-original-src="https://miro.medium.com/v2/resize:fit:580/format:webp/1*n_WsRPONfL2iYsal9QGoGw.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">库伯内特和赫尔姆</figcaption></figure><p id="ba36" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">这是我向你介绍赫尔姆的部分。Helm是一个Kubernetes管理工具。基于Kubernetes的Helm build将极大地帮助您管理和维护复杂的Kubernetes部署。此外，从集群管理员的开发人员的角度来看，对您的资源进行更改和更新是相当简单的。Helm甚至减轻了版本控制和回滚带来的潜在麻烦。</p><p id="ae80" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">我们将带着头盔和一条实用的战线潜入库伯内特斯。我们将使用Helm在Kubernetes集群上部署一个WordPress应用程序。</p><p id="a019" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">让我们为我们的项目创建一个工作空间:</p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="05cb" class="jz ka hi jv b fi kb kc l kd ke">$ mkdir -pv wp-helm/</span></pre><h2 id="4985" class="jz ka hi bd kf kg kh ki kj kk kl km kn iw ko kp kq ja kr ks kt je ku kv kw kx bi translated">舵建筑</h2><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/43255dea3d448e1b5c40c2502d28b550.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*1J-jyCKdZguBuCv0vAWM3Q.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">舵2</figcaption></figure><p id="b8df" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">头盔有2种结构，头盔2和头盔3。Helm 2采用客户端-服务器架构，客户端名为Helm，服务器名为Tiller。客户端与Tiller和图表存储库进行交互。Tiller与Kubernetes API服务器交互。它将Helm模板文件呈现到Kubernetes清单文件中，用于通过Kubernetes API对Kubernetes集群进行操作。</p><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/1f9eb04e0cd578647fa2da7edfae9331.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/1*B7Le0vmt4AaL6F3Jbig5jw.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Helm3</figcaption></figure><p id="e792" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">《圣盔3》于2019年上映。它建立在头盔2的顶部。这次更新中最有趣的更新是去掉了舵柄。因此，现在Helm客户端直接与Kubernetes API服务器通信。通过移除蒂勒，Helm 3支持现代Kubernetes的所有现代安全、身份和授权功能。</p><h1 id="b349" class="kz ka hi bd kf la lb lc kj ld le lf kn lg lh li kq lj lk ll kt lm ln lo kw lp bi translated">舵的基本结构</h1><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es lq"><img src="../Images/b258773d293f136d5209caaeee8942d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*7EL45fDS6CjKknvoYVBDaQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">Helm项目的董事成员</figcaption></figure><p id="69e9" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">helm的基本工作空间必须包括以下内容:</p><ul class=""><li id="bd76" class="lr ls hi in b io ip is it iw lt ja lu je lv ji lw lx ly lz bi translated">chart . YAML-Helm Charts是简单的Kubernetes YAML清单，组合成一个软件包，可以向您的Kubernetes集群发布。Chart.yaml描述了图表的基本信息，例如名称、描述或图表版本。</li><li id="88ec" class="lr ls hi in b io ma is mb iw mc ja md je me ji lw lx ly lz bi translated">values . YAML-values . YAML定义默认值，用于在部署Helm图表时解析模板/中定义的模板。</li><li id="cd8e" class="lr ls hi in b io ma is mb iw mc ja md je me ji lw lx ly lz bi translated">模板目录—模板/文件夹包含图表的所有模板。Helm将解析所有的。yaml文件，并将它们与values.yaml文件中定义的值一起解析为模板</li></ul><h1 id="3011" class="kz ka hi bd kf la lb lc kj ld le lf kn lg lh li kq lj lk ll kt lm ln lo kw lp bi translated">让我们构建我们的应用程序</h1><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es mf"><img src="../Images/ab72cdfc79dc8f3975a47883f11a4d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1070/format:webp/1*xmPucbEjPrsjpp4-CBex-A.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">我们应用程序的基本架构</figcaption></figure><p id="0342" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">我们将有2个部署，WordPress Pod和MySQL Pod运行在2个不同的节点，使用Helm的默认名称空间。</p><h2 id="4521" class="jz ka hi bd kf kg kh ki kj kk kl km kn iw ko kp kq ja kr ks kt je ku kv kw kx bi translated">创建图表文件:</h2><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="099d" class="jz ka hi jv b fi kb kc l kd ke">$ vim wp-helm/Charts.yaml</span><span id="ede2" class="jz ka hi jv b fi mg kc l kd ke">apiVersion: v1<br/>name: mywebversion: 0.1<br/>appVersion: 1.1<br/>description: This is my first chart</span></pre><p id="9caf" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">这个文件包含了我们发布的基本版本信息。</p><h2 id="3b94" class="jz ka hi bd kf kg kh ki kj kk kl km kn iw ko kp kq ja kr ks kt je ku kv kw kx bi translated">创造价值:</h2><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="0211" class="jz ka hi jv b fi kb kc l kd ke">$ vim wp-helm/values.yaml</span><span id="4997" class="jz ka hi jv b fi mg kc l kd ke">wordpress: mywp1<br/>data_base_root_pass: &lt;&lt;db_rootpass&gt;&gt;<br/>data_base_name: &lt;&lt;db_username&gt;&gt;<br/>user: &lt;&lt;db_username&gt;&gt;<br/>data_base_pass: &lt;&lt;db_userpass&gt;&gt;<br/>sql_image: mysql:5.7<br/>sql_db_name: &lt;&lt;db_name&gt;&gt;<br/>wordpress_image: wordpress:5.1.1-php7.3-apache</span></pre><p id="566b" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">价值观。YAML文件包含部署应用程序时所需的所有参数。</p><h2 id="f21b" class="jz ka hi bd kf kg kh ki kj kk kl km kn iw ko kp kq ja kr ks kt je ku kv kw kx bi translated">创建模板:</h2><p id="c4d0" class="pw-post-body-paragraph il im hi in b io mh iq ir is mi iu iv iw mj iy iz ja mk jc jd je ml jg jh ji hb bi translated">要运行一个WordPress应用程序，我们有一个基本的清单:</p><p id="492e" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">一个WordPress容器</p><p id="c999" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">SQL服务器</p><p id="fd82" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">暴露网络服务器端口，用于公共连接</p><p id="8d5f" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">因此，我们必须为每个资源创建3个YAML清单。</p><p id="b9c2" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated"><strong class="in hj"> wordpress.yml </strong></p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="b7cf" class="jz ka hi jv b fi kb kc l kd ke">$ vim wp-helm/templates/wordpress.yml</span><span id="d61a" class="jz ka hi jv b fi mg kc l kd ke">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    run: {{ .Values.wordpress }}<br/>  name: {{ .Values.wordpress }}<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      run: {{ .Values.wordpress }}<br/>  template:<br/>    metadata:<br/>      creationTimestamp: null<br/>      labels:<br/>        run: {{ .Values.wordpress }}<br/>      name: {{ .Values.wordpress }}<br/>    spec:    <br/>      containers:<br/>      - image: {{ .Values.wordpress_image }}<br/>        name: {{ .Values.wordpress }}<br/>        resources: {}<br/>      dnsPolicy: ClusterFirst<br/>      restartPolicy: Always<br/>status: {}</span></pre><p id="59a7" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated"><strong class="in hj"> mysql.yml </strong></p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="fdca" class="jz ka hi jv b fi kb kc l kd ke">$ vim wp-helm/templates/mysql.yml</span><span id="78c1" class="jz ka hi jv b fi mg kc l kd ke">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    run: mydb1<br/>  name: mydb1<br/>spec:<br/>  replicas: 2<br/>  selector:<br/>    matchLabels:<br/>      run: mydb1<br/>  template:<br/>    metadata:<br/>      creationTimestamp: null<br/>      labels:<br/>        run: mydb1<br/>      name: mydb1<br/>    spec:<br/>      containers:<br/>      - env:<br/>        - name: MYSQL_ROOT_PASSWORD<br/>          value: {{ .Values.data_base_root_pass }}<br/>        - name: MYSQL_DATABASE<br/>          value: {{ .Values.data_base_name }}<br/>        - name: MYSQL_USER<br/>          value: {{ .Values.user }}<br/>        - name: MYSQL_PASSWORD<br/>          value: {{ .Values.data_base_pass }}<br/>        image: {{ .Values.sql_image }}<br/>        name: {{ .Values.sql_db_name }}<br/>        resources: {}<br/>      dnsPolicy: ClusterFirst<br/>      restartPolicy: Always<br/>status: {}</span></pre><p id="d082" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated"><strong class="in hj"> service.yml </strong></p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="d4dc" class="jz ka hi jv b fi kb kc l kd ke">$ vim wp-helm/templates/service.yml</span><span id="2e62" class="jz ka hi jv b fi mg kc l kd ke">apiVersion: v1<br/>kind: Service}}<br/>metadata:<br/>  creationTimestamp: null<br/>  labels:<br/>    app.kubernetes.io/managed-by: Helm<br/>    run: mywp1<br/>  name: mywp1ss_image }}<br/>spec:<br/>  ports:s }}<br/>  - port: 80<br/>    protocol: TCP<br/>    targetPort: 80<br/>  selector:<br/>    run: mywp1<br/>  type: NodePort<br/>status:<br/>  loadBalancer: {}</span></pre><p id="6175" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">我们的目录树如下所示:</p><p id="4a2b" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">$ tree WP-helm/<br/>WP-helm/<br/>├──chart . YAML<br/>├──readme . MD<br/>├──模板<br/>│├──MySQL . yml<br/>│├──service . yml<br/>│└──WordPress . yml<br/>└──values . YAML</p><h1 id="c5a1" class="kz ka hi bd kf la lb lc kj ld le lf kn lg lh li kq lj lk ll kt lm ln lo kw lp bi translated">部署我们的应用程序</h1><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="7ae9" class="jz ka hi jv b fi kb kc l kd ke">$ helm install helmdemoapp /ws-helm </span></pre><p id="8dec" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">如果一切就绪，您会在终端上看到一条成功发布的消息。</p><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es mm"><img src="../Images/e9567dad8df9a50abdfd8d4454417a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1362/format:webp/1*M-2BWAEgq8sPOvfT-YQACA.png"/></div></figure><p id="a76a" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">让我们检查一下是否一切顺利，</p><p id="23bc" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">检查舵释放状态:</p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="e81f" class="jz ka hi jv b fi kb kc l kd ke">$ helm list</span></pre><figure class="jk jl jm jn fd ii er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mn"><img src="../Images/723acffc9096da95ea3a94a227a2255b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pA4pK-Fl6WMxHWeEbQsneQ.png"/></div></div></figure><p id="8b18" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">检查部署状态:</p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="2dc3" class="jz ka hi jv b fi kb kc l kd ke">$ kubectl get deployments</span></pre><figure class="jk jl jm jn fd ii er es paragraph-image"><div class="er es ms"><img src="../Images/709a8ac003a1e07a09e3c66ee7fe81a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*LGm9Z2lSu-pMlhVnsQ1xvQ.png"/></div></figure><p id="1ccf" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">检查带有暴露端口的WordPress Pod在哪里运行:</p><figure class="jk jl jm jn fd ii er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mt"><img src="../Images/f935aaa3431d4ce3a1862677f659bb0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clubC57WOJ_KOkEo5F8G0g.png"/></div></div></figure><p id="ef52" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">检查服务状态:</p><pre class="jk jl jm jn fd ju jv jw jx aw jy bi"><span id="2580" class="jz ka hi jv b fi kb kc l kd ke">$ kubectl get svc -o wide</span></pre><figure class="jk jl jm jn fd ii er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mu"><img src="../Images/381e81b90df6c97b843155d01d0d4439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NPu7MPDAN0jbc3bDzRzHUQ.png"/></div></div></figure><p id="bcb1" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">一切就绪。你的申请已经准备好了！</p><h1 id="5893" class="kz ka hi bd kf la lb lc kj ld le lf kn lg lh li kq lj lk ll kt lm ln lo kw lp bi translated">访问WordPress应用程序:</h1><figure class="jk jl jm jn fd ii er es paragraph-image"><div role="button" tabindex="0" class="mo mp di mq bf mr"><div class="er es mv"><img src="../Images/809716f5717bf6284e7f2be10e47c18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMJGhDYRKbiEzWrg37wVZA.png"/></div></div></figure><p id="ba24" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">我们的应用程序正在运行。类似地，如果您有自己的应用程序映像，您可以使用Helm很好地规划它在Kubernetes上的部署。</p><p id="4c7e" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">如果您遇到一些困难，可以在下面的链接中找到上面的代码:</p><div class="mw mx ez fb my mz"><a href="https://github.com/gitwit-mistry/Kubernetes-Wordpress-using-Helm" rel="noopener  ugc nofollow" target="_blank"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd hj fi z dy ne ea eb nf ed ef hh bi translated">git wit-Mistry/Kubernetes-Wordpress-using-Helm</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">通过在GitHub上创建一个帐户，为git wit-Mistry/Kubernetes-Wordpress-using-Helm开发做贡献。</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">github.com</p></div></div></div></a></div><p id="8ac2" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">在LinkedIn上找到我，了解更多有趣技术的应用！</p><div class="mw mx ez fb my mz"><a href="https://www.linkedin.com/in/prathamesh-mistry-a111071b4/" rel="noopener  ugc nofollow" target="_blank"><div class="na ab dw"><div class="nb ab nc cl cj nd"><h2 class="bd hj fi z dy ne ea eb nf ed ef hh bi translated">Prathamesh Mistry -数据科学家- Flip Robo Technologies | LinkedIn</h2><div class="ng l"><h3 class="bd b fi z dy ne ea eb nf ed ef dx translated">查看Prathamesh Mistry在世界上最大的职业社区LinkedIn上的个人资料。Prathamesh列出了3项工作…</h3></div><div class="nh l"><p class="bd b fp z dy ne ea eb nf ed ef dx translated">www.linkedin.com</p></div></div><div class="ni l"><div class="nj l nk nl nm ni nn jo mz"/></div></div></a></div><p id="a397" class="pw-post-body-paragraph il im hi in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji hb bi translated">谢谢，注意安全！</p></div></div>    
</body>
</html>