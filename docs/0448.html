<html>
<head>
<title>Echo messages from LINE chat to Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将来自在线聊天的消息回显到Slack</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/echo-messages-from-line-chat-to-slack-e12f5d929b81?source=collection_archive---------2-----------------------#2020-12-18">https://medium.com/nerd-for-tech/echo-messages-from-line-chat-to-slack-e12f5d929b81?source=collection_archive---------2-----------------------#2020-12-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="231a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的例子中，我们有一个线组和一个松弛通道。他们都在讨论类似的事情，但是讨论的对象不同。为了减少在两端发送相同消息的工作量，我们计划利用LINE的消息传递API，将其与Slack的传入webhook连接起来。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5041e7dce1943697a3a86a6f7ce0bf5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoCiw1hMEjXS9Cq1lC06dw.png"/></div></div></figure><p id="16a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">整个过程可以分为以下几个步骤:</p><ol class=""><li id="879a" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">在空闲时间创建一个传入的Webhook</li><li id="e3cc" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">创建一个线路回声机器人</li><li id="33fe" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">每当bot收到消息时，将消息传递到Slack通道</li></ol></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="a3f9" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">在空闲时间创建一个传入的Webhook</h1><p id="d122" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">Youtube上有很多很好的教程指导我们设置传入的网页钩子。这里的主要目标是导出一个<strong class="ih hj"> Webhook Url </strong>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="f9bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以稍后打开终端并使用curl来查看url是否有效:</p><pre class="je jf jg jh fd lp lq lr ls aw lt bi"><span id="1495" class="lu kl hi lq b fi lv lw l lx ly">$ curl -X POST -H 'Content-type: application/json' --data '{"text":"It is rainy today"}'  https://hooks.slack.com/your-webhook-url</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/20394d3aab6ec3d2c7d370132a881175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U-QFIghFkga_PZEvT0EEEA.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">slack截图</figcaption></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="8a9f" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">创建一个线路回声机器人</h1><p id="0919" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">为了使用LINE的消息传递API，需要将我们自己注册为LINE开发者并创建一个提供者。<a class="ae me" href="https://developers.line.biz/en/docs/messaging-api/getting-started/" rel="noopener ugc nofollow" target="_blank">下面是一步一步的说明。</a>最后我们可以通过二维码添加bot:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/bbb658f5c68666a2041d25067737c66f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HRQ4qK5kAp2z6a7IArJAYw.png"/></div></div></figure><p id="82a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">拥有一个机器人后，请编辑设置并<strong class="ih hj">邀请机器人到聊天室</strong>我们想让它❌间谍✅转发消息。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/af478a7bbf3a95db43f1dbca645489ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_wpcIWBn9crsp7ByFSdNQ.png"/></div></div></figure></div><div class="ab cl kd ke gp kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="hb hc hd he hf"><h1 id="3fa6" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">每当bot收到消息时，将消息传递到Slack通道</h1><p id="c53b" class="pw-post-body-paragraph if ig hi ih b ii li ik il im lj io ip iq lk is it iu ll iw ix iy lm ja jb jc hb bi translated">现在，我们将使用Node.js来编写消息传递部分。创建一个新文件夹，并从以下github链接下载index.js、package-lock.json和package.json:</p><div class="mh mi ez fb mj mk"><a href="https://github.com/line/line-bot-sdk-nodejs/tree/next/examples/echo-bot" rel="noopener  ugc nofollow" target="_blank"><div class="ml ab dw"><div class="mm ab mn cl cj mo"><h2 class="bd hj fi z dy mp ea eb mq ed ef hh bi translated">line/line-bot-sdk-nodejs</h2><div class="mr l"><h3 class="bd b fi z dy mp ea eb mq ed ef dx translated">LINE Messaging API SDK for Node.js。通过在……上创建帐户，为line/line-bot-sdk-nodejs开发做出贡献</h3></div><div class="ms l"><p class="bd b fp z dy mp ea eb mq ed ef dx translated">github.com</p></div></div><div class="mt l"><div class="mu l mv mw mx mt my jn mk"/></div></div></a></div><p id="2ba8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了方便设置配置，我们将在同一个文件夹中创建一个名为<code class="du mz na nb lq b">.env</code>的文件。然后，我们声明我们的channel_secret、channel_access_token和目标端口。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nc"><img src="../Images/f5d8ce614b6795c0fd91e9630f31a1ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7vSbXrrZmEiqmrF41v0tw.png"/></div></div></figure><p id="be5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要安装一些软件包。我们可以在终端中键入以下命令:</p><pre class="je jf jg jh fd lp lq lr ls aw lt bi"><span id="4cb6" class="lu kl hi lq b fi lv lw l lx ly">npm install              # download line-sdk listed in package.json<br/>npm install dotenv       # for enabling the file .env<br/>npm install node-fetch   # for posting api</span></pre><p id="e7dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">伟大的👊让我们在<code class="du mz na nb lq b">index.js</code>中重写代码，以便每当线路机器人接收到消息时向slack发布消息:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nd lo l"/></div></figure><p id="0d62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是在我们可以获得一个<strong class="ih hj">公共url </strong>的地方运行这个Node.js服务器(它必须使用<strong class="ih hj"> https </strong>)。LINE的webhook不接受<strong class="ih hj"> http </strong>😧)您可以选择:</p><ul class=""><li id="d7ec" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ne jv jw jx bi translated">使用<a class="ae me" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>导出您的本地主机ip。</li><li id="2fb6" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ne jv jw jx bi translated">使用firebase函数，强烈建议使用它，因为它可以轻松快速地为生产进行设置。</li></ul><p id="07db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我在Google云平台上运行它，在那里我已经设置了一个apache服务器来托管另一个网站。(是的，在同一台机器上运行node.js服务器和apache服务器是一项艰巨的工作🙀我在这篇文章中分享了我的经历👉<a class="ae me" href="https://wendeehsu.medium.com/run-node-js-application-on-apache-server-c79985014869" rel="noopener">在Apache服务器上运行Node.js应用程序</a></p><p id="434b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在任一方法中，您都可以通过在终端中键入以下命令来启动node.js服务器:</p><pre class="je jf jg jh fd lp lq lr ls aw lt bi"><span id="4aa3" class="lu kl hi lq b fi lv lw l lx ly">node .</span></pre><p id="8830" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后在LINE的开发者控制台中用你的公共url验证你的webhook(我的是GCP机器):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nf"><img src="../Images/8468832fd57ad38661908109e423e978.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DUIRf84e7501FV_ApLCP4w.png"/></div></div></figure><p id="f841" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TADA！就这样🎊🎊🎊现在，你的LINE bot收到的所有消息，无论是你直接发送给它的文本，还是它在群组聊天室窃听到的文本，都将被发送到我们的slack频道🙌</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ng"><img src="../Images/76e2ba896675361aad7885dc5083fbc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*le3sL0bR4e5vN1f1_RIT6g.png"/></div></div></figure></div></div>    
</body>
</html>