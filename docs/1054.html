<html>
<head>
<title>What is Forking in Postgresql? | Interview Q&amp;A</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Postgresql中的Forking是什么？|采访问答</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-is-forking-in-postgresql-58e23458f026?source=collection_archive---------27-----------------------#2021-03-02">https://medium.com/nerd-for-tech/what-is-forking-in-postgresql-58e23458f026?source=collection_archive---------27-----------------------#2021-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d20b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了理解Fork进程将使用相同的Postmaster ID运行不同的ID</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/673f437a1ba53554814d4085ee2ab963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cw5quTNCA1Fxo3TZ_H087A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Postgresql中的分叉过程</figcaption></figure><ul class=""><li id="fbdd" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">这是一个创建子进程的过程，该子进程看起来与创建它的父进程相似。子进程被称为“分叉”。</li><li id="2117" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">父进程和子进程都有相同的段代码，但地址空间不同。</li><li id="74fc" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">派生进程(a)子进程具有不同的进程ID。</li><li id="a95d" class="jt ju hi ih b ii kc im kd iq ke iu kf iy kg jc jy jz ka kb bi translated">根据PostgreSQL架构，postmaster是集群启动时启动的第一个后台进程。基于邮局主管ID，下面给出了其他后台实用程序进程的详细信息。</li></ul><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="ec14" class="km kn hi ki b fi ko kp l kq kr">*BG writer, <br/>*Check pointer, <br/>*WAL writer, <br/>*Archive WAL writer,<br/>*Logger,<br/>*Statistical collector,<br/>*Autovacuum launcher</span></pre><ul class=""><li id="2202" class="jt ju hi ih b ii ij im in iq jv iu jw iy jx jc jy jz ka kb bi translated">所有这些进程都是由postmaster创建或“派生”为子进程的，如果您看到下面每个子进程都有不同的ID，但具有相同的父ID(post master ID)</li></ul><p id="922a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">检查Postgres运行状态</strong>:</p><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="9a01" class="km kn hi ki b fi ko kp l kq kr">[postgres@Prime~]$ <strong class="ki hj">ps -ef|grep data</strong></span><span id="b5d6" class="km kn hi ki b fi ks kp l kq kr">postgres 818 1 0 Feb25 ? 00:00:06 /usr/pgsql-12/bin/postmaster -D /var/lib/pgsql/12/data/</span><span id="f159" class="km kn hi ki b fi ks kp l kq kr">postgres 29802 29777 0 06:21 pts/0 00:00:00 grep --color=auto data</span></pre><p id="0ec2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们的Postgres集群运行在postmaster ID 818上，基于postmaster ID，另一个后台进程运行在不同的ID上</p><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="4d9b" class="km kn hi ki b fi ko kp l kq kr">[postgres@Prime~]$ <strong class="ki hj">systemctl status postgresql-12</strong></span><span id="b80d" class="km kn hi ki b fi ks kp l kq kr">● postgresql-12.service - PostgreSQL 12 database server</span><span id="c659" class="km kn hi ki b fi ks kp l kq kr">Loaded: loaded (/usr/lib/systemd/system/postgresql-12.service; enabled; vendor preset: disabled)</span><span id="ca44" class="km kn hi ki b fi ks kp l kq kr">Active: active (running) since Thu 2021-02-25 00:53:07 UTC; 5 days ago</span><span id="2512" class="km kn hi ki b fi ks kp l kq kr">Docs: https://www.postgresql.org/docs/12/static/</span><span id="40f8" class="km kn hi ki b fi ks kp l kq kr">Process: 799 ExecStartPre=/usr/pgsql-12/bin/postgresql-12-check-db-dir ${PGDATA} (code=exited, status=0/SUCCESS)</span><span id="29a3" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">Main PID: 818 (postmaster)</strong></span><span id="3549" class="km kn hi ki b fi ks kp l kq kr">Tasks: 8 (limit: 4774)</span><span id="904e" class="km kn hi ki b fi ks kp l kq kr">Memory: 196.0M</span><span id="b508" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">CGroup: /system.slice/postgresql-12.service</strong></span><span id="15ff" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─ 818 /usr/pgsql-12/bin/postmaster -D /var/lib/pgsql/12/data/</strong></span><span id="8485" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─ 826 postgres: logger</strong></span><span id="ec35" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─1036 postgres: checkpointer</strong></span><span id="8ffe" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─1037 postgres: background writer</strong></span><span id="5bca" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─1038 postgres: walwriter</strong></span><span id="e318" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─1039 postgres: autovacuum launcher</strong></span><span id="eac9" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">├─1040 postgres: stats collector</strong></span><span id="babc" class="km kn hi ki b fi ks kp l kq kr"><strong class="ki hj">└─1041 postgres: logical replication launcher</strong></span></pre><p id="ed2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">查看分叉过程:</strong></p><pre class="je jf jg jh fd kh ki kj kk aw kl bi"><span id="97f8" class="km kn hi ki b fi ko kp l kq kr">[postgres@Prime~]$ <strong class="ki hj">ps -ef|grep postgres</strong></span><span id="d4cb" class="km kn hi ki b fi ks kp l kq kr">postgres 818 1 0 Feb25 ? 00:00:06 /usr/pgsql-12/bin/postmaster -D /var/lib/pgsql/12/data/</span><span id="4bbd" class="km kn hi ki b fi ks kp l kq kr">postgres 826 818 0 Feb25 ? 00:00:00 postgres: logger</span><span id="c1f4" class="km kn hi ki b fi ks kp l kq kr">postgres 1036 818 0 Feb25 ? 00:00:00 postgres: checkpointer</span><span id="7587" class="km kn hi ki b fi ks kp l kq kr">postgres 1037 818 0 Feb25 ? 00:00:04 postgres: background writer</span><span id="9a19" class="km kn hi ki b fi ks kp l kq kr">postgres 1038 818 0 Feb25 ? 00:00:04 postgres: walwriter</span><span id="f250" class="km kn hi ki b fi ks kp l kq kr">postgres 1039 818 0 Feb25 ? 00:00:04 postgres: autovacuum launcher</span><span id="9963" class="km kn hi ki b fi ks kp l kq kr">postgres 1040 818 0 Feb25 ? 00:00:08 postgres: stats collector</span><span id="2a49" class="km kn hi ki b fi ks kp l kq kr">postgres 1041 818 0 Feb25 ? 00:00:00 postgres: logical replication launcher</span><span id="799c" class="km kn hi ki b fi ks kp l kq kr">root 29776 29754 0 06:21 pts/0 00:00:00 su - postgres</span><span id="56e7" class="km kn hi ki b fi ks kp l kq kr">postgres 29777 29776 0 06:21 pts/0 00:00:00 -bash</span><span id="513b" class="km kn hi ki b fi ks kp l kq kr">postgres 29852 29777 0 06:28 pts/0 00:00:00 ps -ef</span><span id="a499" class="km kn hi ki b fi ks kp l kq kr">postgres 29853 29777 0 06:28 pts/0 00:00:00 grep --color=auto postgres</span></pre><p id="a3c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总结:</strong></p><p id="0b4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦群集基于此ID启动，将分配邮局主管ID。其他后台进程将启动并在具有相同父ID的不同ID上运行。此邮局主管ID将在群集停止和启动时更改。</p></div></div>    
</body>
</html>