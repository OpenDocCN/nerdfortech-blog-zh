<html>
<head>
<title>Code Explanation (for Noobs to Pros): Phone Controlled Robot Car.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码解释(新手到专业人士):电话控制的机器人汽车。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/code-explanation-for-noobs-to-pros-phone-controlled-robot-car-4a3d3588f544?source=collection_archive---------1-----------------------#2020-08-24">https://medium.com/nerd-for-tech/code-explanation-for-noobs-to-pros-phone-controlled-robot-car-4a3d3588f544?source=collection_archive---------1-----------------------#2020-08-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c20a46f5b2b87b384616c880b89915bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60INcVBfmtL2lQFKyQKKvA.jpeg"/></div></div></figure><h1 id="6c1d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">嘿，我带着另一篇文章回来了…</h1><p id="5bdb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi km translated">这一次我想尝试一些新的东西，我想让人们在阅读时从基础开始学习。这篇文章不会让你成为<em class="kv">物联网</em>的专家，但它会确保如果你正试图了解<em class="kv">物联网</em>或想自己做这个项目，那么你不必为了让几行代码正常工作而浏览大量文章。</p><blockquote class="kw"><p id="bc85" class="kx ky hi bd kz la lb lc ld le lf kl dx translated">虽然我不能保证什么，但也许你在读完这篇文章后会想了解更多，然后你最终会浏览大量的文章，所以…😅</p></blockquote><p id="9aa5" class="pw-post-body-paragraph jo jp hi jq b jr lg jt ju jv lh jx jy jz li kb kc kd lj kf kg kh lk kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">不过，我希望你觉得这很容易理解……</em></strong></p><figure class="ll lm ln lo fd ij"><div class="bz dy l di"><div class="lp lq l"/></div></figure><h1 id="64e5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">所以，让我们开始吧:</h1><p id="43de" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">在我们开始学习代码本身之前，我想请你熟悉一下如何使用Arduino IDE在微控制器上上传代码。我在之前的文章里已经解释过了，你可以看看这里的</em></strong><a class="ae lr" rel="noopener" href="/@singhgunpreet0802/i-made-a-phone-controlled-robot-car-without-the-need-to-install-the-application-7405c103c731"><strong class="jq hj"><em class="kv"/></strong></a><strong class="jq hj"><em class="kv">。</em> </strong></p><p id="dffd" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">所以做好准备，巨大的(实际上不是这样)代码在这里:</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/1062644a4436d825a6760bef3973e0c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiBQcHraMc4Q9dHn16-UHg.png"/></div></div></figure><h1 id="51ca" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><span class="l kn ko kp bm kq kr ks kt ku di">W</span>T26】oah Woah Woah…</h1><p id="4b87" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">别急</em> </strong>，没有看起来那么难。上面的代码有两部分，一部分是用户应用程序(<em class="kv">网页</em>)，另一部分是实际的Arduino代码本身。</p><p id="6c8d" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">让我们把事情分成小片段:</em> </strong></p><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="4ac0" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">#include &lt;ESP8266WebServer.h&gt;  //Library for WebServer<br/>#include &lt;ESP8266WiFi.h&gt;  //Library for WiFi Connection of the Board<br/>#include &lt;ESP8266mDNS.h&gt;  // Library for mDNS (Explained Later)<br/>#include &lt;Servo.h&gt;  // Library for Servo Motor (for Another Project)<br/></strong></span></pre><p id="2005" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated"><span class="l kn ko kp bm kq kr ks kt ku di"> S </span>从一开始，熟悉<strong class="jq hj"> C编程</strong>的人就已经知道这些了。这些是库文件，需要包含在一开始。</p><blockquote class="mi mj mk"><p id="b912" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated"><strong class="jq hj"> <em class="hi">注意:</em> </strong> <em class="hi">这里有几个东西不是这个项目所需要的，但却是这个项目的升级(也即将推出)，比如这个伺服库。</em></p></blockquote><p id="0fb2" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><em class="kv">这些包括:</em></p><ul class=""><li id="34bc" class="mo mp hi jq b jr ls jv lt jz mq kd mr kh ms kl mt mu mv mw bi translated"><em class="kv">esp8266 web server . h</em><strong class="jq hj">:</strong>这个库是在板上启动web服务器所必需的，它将帮助我们在没有任何预先存在的WiFi连接的情况下连接到它。换句话说，它将帮助我们创建一个接入点(WiFi热点)。</li><li id="a510" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><em class="kv">esp8266 WiFi . h</em><strong class="jq hj">:</strong>这个库需要连接到预先存在的WiFi接入点(通常是路由器或移动热点)。</li><li id="f839" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><em class="kv"> ESP8266mDNS.h </em> <strong class="jq hj"> : </strong>这是一个相当有趣的库，记得在视频中我通过在浏览器中输入地址连接到汽车机器人。我输入的是“car.local”而不是任何IP地址。正是因为有了这个库，才在NodeMCU上启用了一个<a class="ae lr" href="https://en.wikipedia.org/wiki/Multicast_DNS#:~:text=In%20computer%20networking%2C%20the%20multicast,include%20a%20local%20name%20server." rel="noopener ugc nofollow" target="_blank">组播DNS (mDNS) </a>。要连接到它，需要一个侦听器或DNS服务发现(DNS-SD)。</li></ul><blockquote class="kw"><p id="d081" class="kx ky hi bd kz la nc nd ne nf ng kl dx translated"><em class="nh">对于那些不熟悉此类项目的人来说，当我们制作一个本地网页或web项目，并将其托管在任何一台本地服务器(如笔记本电脑，或本例中的MCU)上时，我们通常需要键入IP地址，而不是像“www.linkedin.com”或“www.medium.com”这样的域名。这些都是域名，为此需要有一个</em> <a class="ae lr" href="https://en.wikipedia.org/wiki/Domain_Name_System" rel="noopener ugc nofollow" target="_blank"> <em class="nh">【域名系统】</em> </a> <em class="nh">将域名解析回IP，这样我们就不必记住我们访问的每个网页的8-12位数。(点击链接了解更多)。</em></p></blockquote><p id="ff93" class="pw-post-body-paragraph jo jp hi jq b jr lg jt ju jv lh jx jy jz li kb kc kd lj kf kg kh lk kj kk kl hb bi translated"><strong class="jq hj">不幸的是，</strong> Android手机不支持这个，windows也不支持(至少不是原生的)，但是iOS和macOS支持原生的。</p><p id="acbb" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><em class="kv">它的意思是</em>我们无法通过在android手机或Windows上输入“car.local”来连接它，但我们可以使用iPhone或Mac轻松地做到这一点(因此，视频中的iPhone)。虽然在Windows上有一个解决方法，但是它需要安装iTunes(或者至少是它的Bonjour服务)。完成后，它也可以使用“car.local”在Windows上工作。</p><blockquote class="mi mj mk"><p id="08d1" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated">但是对于我们的Android朋友，我们必须回到老学校，手动输入IP地址(使用Arduino IDE的串行监视器或使用WiFi路由器的管理面板，如果你熟悉它，可以很容易地找到它。</p><p id="92d8" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated"><strong class="jq hj">附言</strong>如果您在接入点(热点)模式下使用汽车，后者将不起作用。</p></blockquote><h1 id="4f91" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">进一步发展:</h1><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="d3f3" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">char webpage[] PROGMEM = R"=====(<br/><br/>//Your HTML Code Goes here <br/><br/>)=====";</strong></span></pre><p id="2f16" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated">这是在微控制器中声明字符数组的另一种方式。这种方式确保我们在MCU的闪存而不是ram中编程，这样我们可以减少RAM的消耗，因为Char数组只会在需要时被调用。为此，我们使用<strong class="jq hj"> <em class="kv"> PROGMEM </em> </strong>确保它存储在<strong class="jq hj">内部闪存</strong>中，而不是<strong class="jq hj"> RAM </strong>中。我稍后会解释HTML代码。</p><blockquote class="kw"><p id="be8c" class="kx ky hi bd kz la lb lc ld le lf kl dx translated"><em class="nh">对于那些搞不清楚</em> <strong class="ak"> <em class="nh">闪存</em> </strong> <em class="nh">和</em> <strong class="ak"> <em class="nh"> RAM </em> </strong> <em class="nh">的人来说，就把它当成平常电脑/笔记本电脑中的</em> <strong class="ak"> <em class="nh">硬盘</em> </strong> <em class="nh">和</em><strong class="ak"><em class="nh">RAM</em></strong><em class="nh">。</em></p></blockquote><pre class="ni nj nk nl nm ly lz ma mb aw mc bi"><span id="e488" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">int motor1_1 = 5;//(D1)<br/>int motor1_2 = 4;//(D2)<br/><br/>int motor2_1 = 0;//(D3)<br/>int motor2_2 = 2;//(D4)<br/><br/>int motor3_1 = 14;//(D5)<br/>int motor3_2 = 12;//(D6)<br/><br/>int motor4_1 = 13;//(D7)<br/>int motor4_2 = 15;//(D8)<br/><br/>int servopin = 16;<br/>int Trig = 10;<br/>int Echo = 9;<br/>int MaxDist = 100;</strong></span></pre><p id="d51f" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">以上是定义和绑定管脚的声明，实际硬件，即传感器或执行器(在这种情况下是电机)连接在这些管脚上。</p><figure class="ll lm ln lo fd ij er es paragraph-image"><div class="er es nn"><img src="../Images/d1e10cea9b649b7ea4167f9ce0da06dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*SEtocyyqFAFRj8TKxKd3iA.png"/></div></figure><blockquote class="kw"><p id="4dbc" class="kx ky hi bd kz la nc nd ne nf ng kl dx translated">这里需要注意的重要一点是，板上显示的管脚并不是实际的<a class="ae lr" href="https://en.wikipedia.org/wiki/General-purpose_input/output" rel="noopener ugc nofollow" target="_blank"> GPIO </a>管脚号，实际的GPIO管脚号请参考下图。</p></blockquote><p id="d1f0" class="pw-post-body-paragraph jo jp hi jq b jr lg jt ju jv lh jx jy jz li kb kc kd lj kf kg kh lk kj kk kl hb bi translated">在这里，我们创建整数类型的变量(仅用于存储整数值)，并将它们分配给电机连接的管脚号。我们已经将电机的两个引脚连接到两个不同的引脚，以实现<strong class="jq hj">双运动控制</strong>(即后面解释的正向和反向)。</p><p id="8e0d" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><strong class="jq hj"> </strong></p><h1 id="e691" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">同样，您可以在这里看到一些用于未来升级的其他引脚分配，因此我将在另一篇文章中对此进行解释。</h1><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="2a8f" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">ESP8266WebServer server(80);<br/><br/><br/>char* ssid = "CAR";<br/>char* pass = "123456789";<br/><br/><br/>IPAddress ip(192, 168, 1, 125);<br/>IPAddress gateway(192, 168, 1, 1);<br/>IPAddress subnet(255, 255, 0, 0);<br/><br/><br/>Servo myservo;</strong></span></pre><p id="5008" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated"><span class="l kn ko kp bm kq kr ks kt ku di">在</span>上面的代码片段中，我们创建了一个名为<em class="kv"> ESP8266WebServer </em>类的服务器的对象，它监听端口号80。如果我得到细节，它将需要另外几篇文章。</p><p id="d4da" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">接下来的两行定义了连接到接入点的SSID(热点名称)和pass(密码)。如果您想使用现有的wifi网络，请确保您的SSID是您的WiFi名称，pass是您的WiFi密码。接下来的三行对Android用户很有帮助，因为它们让我们为连接设置固定/静态IP地址。<em class="kv">另外，如果您正在连接到预先存在的WiFi网络，这可能会起作用，也可能不起作用，因为IP可能已被另一个设备占用。因此，您必须使用串行监视器或路由器的管理面板来检查它。</em></p><p id="0c2e" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">现在函数都设置好了，只是调用方式不正确的问题，按照用户调用。</em> </strong></p><blockquote class="mi mj mk"><p id="cf10" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated">再次伺服和我的伺服是未来的项目。</p></blockquote><p id="2f20" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><strong class="jq hj">程序通常由四部分组成:</strong></p><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="77d4" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">void back(){<br/>    digitalWrite(motor1_1, LOW);<br/>    digitalWrite(motor1_2, HIGH);<br/>    <br/>    digitalWrite(motor2_1, LOW);<br/>    digitalWrite(motor2_2, HIGH);<br/><br/><br/>    digitalWrite(motor3_1, LOW);<br/>    digitalWrite(motor3_2, HIGH);<br/>    <br/>    digitalWrite(motor4_1, LOW);<br/>    digitalWrite(motor4_2, HIGH);<br/>    <br/>    Serial.println("BACK");<br/>}<br/><br/><br/>void front(){<br/>    digitalWrite(motor1_1, HIGH);<br/>    digitalWrite(motor1_2, LOW);<br/> <br/>    digitalWrite(motor2_1, HIGH);<br/>    digitalWrite(motor2_2, LOW);<br/><br/><br/>    digitalWrite(motor3_1, HIGH);<br/>    digitalWrite(motor3_2, LOW);<br/> <br/>    digitalWrite(motor4_1, HIGH);<br/>    digitalWrite(motor4_2, LOW);<br/>    <br/>    Serial.println("FRONT");<br/>}<br/><br/><br/>void right(){<br/>    digitalWrite(motor1_1, HIGH);<br/>    digitalWrite(motor1_2, LOW);<br/> <br/>    digitalWrite(motor2_1, LOW);<br/>    digitalWrite(motor2_2, HIGH);<br/><br/><br/>    digitalWrite(motor3_1, HIGH);<br/>    digitalWrite(motor3_2, LOW);<br/> <br/>    digitalWrite(motor4_1, LOW);<br/>    digitalWrite(motor4_2, HIGH);<br/>    <br/>    Serial.println("RIGHT");<br/>}<br/><br/><br/>void left(){<br/>    digitalWrite(motor1_1, LOW);<br/>    digitalWrite(motor1_2, HIGH);<br/> <br/>    digitalWrite(motor2_1, HIGH);<br/>    digitalWrite(motor2_2, LOW);<br/>    <br/>    digitalWrite(motor3_1, LOW);<br/>    digitalWrite(motor3_2, HIGH);<br/> <br/>    digitalWrite(motor4_1, HIGH);<br/>    digitalWrite(motor4_2, LOW);<br/>    <br/>    Serial.println("LEFT");<br/>}<br/><br/><br/>void halt(){<br/>    digitalWrite(motor1_1, LOW);<br/>    digitalWrite(motor1_2, LOW);<br/> <br/>    digitalWrite(motor2_1, LOW);<br/>    digitalWrite(motor2_2, LOW);<br/><br/><br/>    digitalWrite(motor3_1, LOW);<br/>    digitalWrite(motor3_2, LOW);<br/> <br/>    digitalWrite(motor4_1, LOW);<br/>    digitalWrite(motor4_2, LOW);<br/>    <br/>    Serial.println("STOP!");<br/>}</strong></span></pre><p id="a62e" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated"><span class="l kn ko kp bm kq kr ks kt ku di">在</span>上面的代码块中，有五个函数分别是<strong class="jq hj"> front()、back()、left()、right()和halt() </strong>。顾名思义，它们执行这些功能。解释如下。</p><ul class=""><li id="d84c" class="mo mp hi jq b jr ls jv lt jz mq kd mr kh ms kl mt mu mv mw bi translated"><strong class="jq hj"> Front() </strong>:在此功能中，通过使电机的第一个引脚为高电平，电机的第二个引脚为低电平，电机被设置为向前移动，这意味着电流将从电机的第一个引脚流出，第二个引脚将接地。这确保了所有四个电机都在同一个方向上运动，即向前运动。</li><li id="e36b" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><strong class="jq hj"> Back() </strong>:在此功能中，通过使电机的第二个引脚为高电平，电机的第一个引脚为低电平，电机被设置为反向移动，这意味着电流将从电机的第二个引脚流出，第一个引脚将接地。这确保了所有四个电机都向同一方向移动，即反向移动。</li><li id="2411" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><strong class="jq hj"> Left() </strong>:在此功能中，通过保持第一针低电平和第二针高电平，电机1和3被设置为反向移动，通过保持第二针低电平和第一针高电平，电机2和4被设置为正向移动。确保轿厢向左移动。</li><li id="e9a3" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated"><strong class="jq hj"> Right() </strong>:类似地，在该功能中，通过保持第一引脚为低电平和第二引脚为高电平，电机2和4被设置为反向移动，通过保持第二引脚为低电平和第一引脚为高电平，电机1和3被设置为正向移动。确保轿厢向右移动。</li><li id="b5a1" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">Halt() :这个函数是最简单但最重要的一个，(我最初忘记写这个函数了…😅).无论如何，这个函数的作用是将每个引脚变为低电平，并停止所有电机。</li></ul><h1 id="7493" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><span class="l kn ko kp bm kq kr ks kt ku di"> B </span>在我们继续深入之前，对于不熟悉Arduino编程的人来说，有必要了解一下程序的流程。</h1><ol class=""><li id="cd2e" class="mo mp hi jq b jr js jv jw jz no kd np kh nq kl nr mu mv mw bi translated"><strong class="jq hj"> <em class="kv">包括库</em> : </strong>这是我们已经完成的第一步，这确保了如果需要从库中调用任何函数或类，那么它们可以在代码中的任何地方被调用。</li><li id="88f5" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl nr mu mv mw bi translated"><strong class="jq hj"> <em class="kv">声明变量</em> </strong> <strong class="jq hj"> : </strong>在开头声明变量也保证了当我们在代码内部需要它们的时候，它们可以被调用。<em class="kv">在开始声明的变量称为</em> <strong class="jq hj"> <em class="kv">全局变量</em> </strong> <em class="kv">，可以在代码的任何地方使用，而在函数内部声明的变量称为</em> <strong class="jq hj"> <em class="kv">局部变量</em> </strong> <em class="kv">，只能在函数内部使用。</em></li><li id="3624" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl nr mu mv mw bi translated"><strong class="jq hj"> <em class="kv">“设置”功能</em> : </strong>设置功能是两个主要功能之一。当MCU板通电或复位时，它会自动执行。因此，我们需要声明只需要执行一次的东西，但是我们也可以再次访问它们。我们不需要在某个时间间隔后连续执行的东西都在这个函数中。</li><li id="cff2" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl nr mu mv mw bi translated"><strong class="jq hj"> <em class="kv">【循环】功能</em> </strong> <strong class="jq hj"> : </strong>这是Arduino的第二个主要功能范围。该函数会自动连续调用，直到MCU停止。这个函数在设置函数之后被调用，因此需要在循环函数中调用的东西应该在设置函数之前或者在设置函数中被声明和实例化。任何预配置都应在设置功能中完成。实际的工作将在循环函数中完成。</li></ol><h1 id="d068" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">以下代码用于设置功能:</h1><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="1584" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">void setup() {<br/>  Serial.begin(115200);<br/>    // Set the pin modes of the above IO pins to OUTPUT<br/>    pinMode(motor1_1, OUTPUT);<br/>    pinMode(motor1_2, OUTPUT);<br/>    pinMode(motor2_1, OUTPUT);<br/>    pinMode(motor2_2, OUTPUT);<br/>    pinMode(motor3_1, OUTPUT);<br/>    pinMode(motor3_2, OUTPUT);<br/>    pinMode(motor4_1, OUTPUT);<br/>    pinMode(motor4_2, OUTPUT);</strong></span></pre><p id="8dfc" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated"><span class="l kn ko kp bm kq kr ks kt ku di">我们</span>已经启动了设置功能，这段代码将只执行一次。</p><p id="3506" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">第一行以115200的波特率启动串行监视器，串行监视器只不过是Arduino IDE的内置接口，当它直接连接到系统(PC/Laptop)时显示来自MCU的信息。这是我之前说过要检查你的ip地址的地方。波特率是通信的速度，通常的(最常用的)有115200和9600。确保在串行监视器中选择正确的波特率。</p><p id="d3cb" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">之后，我们将所有电机引脚声明为输出引脚，这里是<strong class="jq hj"> pinMode(pin，io mode)；</strong>函数用于声明我们是否将从指定的引脚获得一个<strong class="jq hj">输入</strong>或者我们必须给相同的引脚一个<strong class="jq hj">输出</strong>。此处<strong class="jq hj"> pin </strong>参数(括号内的一个)用于定义pin，<strong class="jq hj"> IOmode </strong>参数用于定义是<strong class="jq hj">输入</strong>还是<strong class="jq hj">输出</strong>(如本例)。</p><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="1747" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">WiFi.softAP(ssid, pass); //Access Point<br/><br/><br/>//    WiFi.begin(ssid,pass); // uncomment the following code for Wifi mode. <br/><br/>//   while(WiFi.status()!=WL_CONNECTED)<br/>//  {<br/>//      Serial.print(".");<br/>//      delay(500);<br/>//  }<br/><br/><br/>     Serial.println("");<br/>     Serial.print("IP Address: ");<br/>     Serial.println(WiFi.localIP());</strong></span></pre><p id="3d8b" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">下一行以之前给出的ssid和密码开始访问点(热点)。此外，如果您想使用WiFi模式，只需取消以下6行的注释，并注释前面的行。确保如果您使用的是WiFi模式，ssid应该是您的WiFi名称，pass应该是您的WiFi密码。</p><blockquote class="kw"><p id="f4cf" class="kx ky hi bd kz la lb lc ld le lf kl dx translated"><em class="nh">你可能会看到“//”前的一些代码，这是注释。任何注释都不会被视为实际代码，MCU会跳过它。</em></p></blockquote><p id="33f3" class="pw-post-body-paragraph jo jp hi jq b jr lg jt ju jv lh jx jy jz li kb kc kd lj kf kg kh lk kj kk kl hb bi translated">接下来的3行打印出IP地址，Android用户可以用它来连接网页。</p><p id="30d5" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">我们在这里做的是当用户点击一个按钮时，一个打开新页面的请求从那个页面发出。现在，该服务器正在处理该请求，并调用与该页面请求相关的函数，然后用户被重定向到同一页面。因此，运动是由点击按钮触发的。 </p><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="92e7" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">//======Server Response=====<br/>    server.on("/", []()<br/>  {  <br/>    server.send_P(200, "text/html", webpage);<br/>  });<br/><br/><br/><br/><br/>   server.on("/up", HTTP_GET, []()<br/>  { <br/>    front();<br/>  server.send_P(200, "text/html", webpage);<br/>  });<br/><br/><br/><br/><br/>    server.on("/left", HTTP_GET, []()<br/>  { <br/>    left();<br/>  server.send_P(200, "text/html", webpage);<br/>  });<br/><br/><br/><br/><br/>    server.on("/right", HTTP_GET, []()<br/>  { <br/>    right();<br/>  server.send_P(200, "text/html", webpage);<br/>  });<br/><br/><br/><br/><br/>    server.on("/down", HTTP_GET, []()<br/>  { <br/>    back();<br/>  server.send_P(200, "text/html", webpage);<br/>  });<br/><br/><br/>  <br/>    server.on("/stop", HTTP_GET, []()<br/>  { <br/>    halt();<br/>  server.send_P(200, "text/html", webpage);<br/>  });</strong></span><span id="9788" class="md ir hi lz b fi ns mf l mg mh"><strong class="lz hj">server.begin();// it will start webserver<br/><br/>  MDNS.addService("http", "tcp", 80);<br/><br/><br/>}</strong></span></pre><p id="62e2" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated">上面的代码实际上会捕捉来自网页的输入，并执行指定的动作。现在我们所要做的就是听取用户的正确输入，并从上面定义的函数中调用相应的函数。</p><p id="5d87" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">这里的<strong class="jq hj"> server.on() </strong>是我们用来监听网页变化的函数。</p><p id="6093" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><em class="kv">最后两行负责启动服务器和mDNS服务。</em></p><h2 id="ab8d" class="md ir hi bd is nt nu nv iw nw nx ny ja jz nz oa je kd ob oc ji kh od oe jm of bi translated">这是设置功能的结束。</h2><h1 id="9cef" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">循环功能:</h1><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="7137" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">void loop() {<br/>    server.handleClient();</strong></span><span id="adaf" class="md ir hi lz b fi ns mf l mg mh"><strong class="lz hj">}</strong></span></pre><p id="bfbf" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">循环内部函数<strong class="jq hj">server . handle client()；</strong>调用函数，监听网页中的路径变化。换句话说，当点击按钮后，它监视网页发送的新请求，然后将请求传递给前面描述的<strong class="jq hj"> server.on() </strong>函数。</p><h1 id="4614" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Arduino代码已经完成，现在让我们来看看HTML代码:</h1><figure class="ll lm ln lo fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/5ef0ca1a0dd55758e925377e0dc4c047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjgSF6uyDUg0sngj70Dazg.png"/></div></div></figure><p id="0184" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi km translated"><span class="l kn ko kp bm kq kr ks kt ku di">到</span>老实说，这里只有一个部分需要解释，那就是按钮，其余的只是普通的Html和CSS。如果你愿意，你可以通过添加不同的CSS并替换它来制作你自己更好看的控件应用程序。所以我将在这里解释这些按钮。</p><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="6033" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">&lt;pre&gt;<br/><br/>&lt;button  class="button" onclick="window.location = 'http://'+location.hostname+'/up'"&gt;↑&lt;/button&gt;</strong></span><span id="6bd5" class="md ir hi lz b fi ns mf l mg mh"><strong class="lz hj">&lt;button class="button" onclick="window.location = 'http://'+location.hostname+'/left'"&gt;←&lt;/button&gt;   &lt;button class="button" onclick="window.location = 'http://'+location.hostname+'/stop'"&gt;!&lt;/button&gt;   &lt;button class="button" onclick="window.location = 'http://'+location.hostname+'/right'"&gt;→&lt;/button&gt;<br/><br/>&lt;pre&gt;</strong></span></pre><blockquote class="mi mj mk"><p id="bdd5" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated">这里我使用了<strong class="jq hj"> &lt; pre &gt; </strong>标签来确保按钮的显示顺序与它们被写入的顺序相同，你可以使用CSS grid属性来代替，这是正确的方法。无论如何，这也是可行的。</p></blockquote><pre class="ll lm ln lo fd ly lz ma mb aw mc bi"><span id="97e0" class="md ir hi lz b fi me mf l mg mh"><strong class="lz hj">&lt;button  class="button" onclick="window.location = 'http://'+location.hostname+'/up'"&gt;↑&lt;/button&gt;</strong></span></pre><p id="b31a" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated"><strong class="jq hj">我们只拿一个按钮来说明:</strong></p><ul class=""><li id="b24a" class="mo mp hi jq b jr ls jv lt jz mq kd mr kh ms kl mt mu mv mw bi translated">这里它被赋予了一个类来应用CSS样式。</li><li id="e178" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">设置<strong class="jq hj"> onclick </strong>事件监听器，将<strong class="jq hj"> window.location </strong>更改为当前页面的<strong class="jq hj"> IP </strong>。</li><li id="a08e" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">这是一个简单的<strong class="jq hj"> Javascript </strong>代码，它将用户导航到服务器上的<strong class="jq hj"> "/up" </strong>页面。</li><li id="279f" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">然后由<strong class="jq hj"> server.on () </strong>函数进行处理。</li><li id="95b2" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">在它的内部(如我们之前所见)调用一个函数(在本例中为<strong class="jq hj"> Front () </strong>)。</li><li id="9ef3" class="mo mp hi jq b jr mx jv my jz mz kd na kh nb kl mt mu mv mw bi translated">然后用户被重定向到同一个页面。</li></ul><p id="2c7d" class="pw-post-body-paragraph jo jp hi jq b jr ls jt ju jv lt jx jy jz lu kb kc kd lv kf kg kh lw kj kk kl hb bi translated">类似地，其他按钮触发相应的功能，汽车开始运动。</p><blockquote class="mi mj mk"><p id="8a9c" class="jo jp kv jq b jr ls jt ju jv lt jx jy ml lu kb kc mm lv kf kg mn lw kj kk kl hb bi translated">这就是“<strong class="jq hj">电话控制的机器人小车</strong>”的完整功能。</p></blockquote><blockquote class="kw"><p id="0598" class="kx ky hi bd kz la nc nd ne nf ng kl dx translated">如果你还在这里，<strong class="ak">感谢你</strong>阅读这篇文章，祝贺你成功地学会了如何自己制作一个类似的项目。我希望你能从我这里得到一些新的东西。</p></blockquote><p id="f9b2" class="pw-post-body-paragraph jo jp hi jq b jr lg jt ju jv lh jx jy jz li kb kc kd lj kf kg kh lk kj kk kl hb bi translated"><strong class="jq hj"> <em class="kv">如有任何疑问，随时联系我</em>😊<em class="kv">。</em>T41】</strong></p><h1 id="dadb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">现在继续做类似的项目。用我们自己的方式定制它，把它贴在某个地方，如果你做了一个(或者没有，你的愿望)，别忘了给我贴上标签。</h1></div><div class="ab cl og oh gp oi" role="separator"><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol om"/><span class="oj bw bk ok ol"/></div><div class="hb hc hd he hf"><h2 id="d000" class="md ir hi bd is nt nu nv iw nw nx ny ja jz nz oa je kd ob oc ji kh od oe jm of bi translated"><strong class="ak">作者:</strong> <a class="ae lr" href="http://www.linkedin.com/in/singhgunpreet82" rel="noopener ugc nofollow" target="_blank"> <strong class="ak">冈普雷特·辛格</strong> </a></h2></div></div>    
</body>
</html>