# 编写多阶段 Boss 战 II:多阶段 Boss 战的回归

> 原文：<https://medium.com/nerd-for-tech/scripting-a-multi-stage-boss-battle-ii-return-of-multi-stage-boss-battle-17ff1ac3564f?source=collection_archive---------6----------------------->

## 有些老板真让人讨厌

![](img/960d8944dbc2bdb22c7a576f7179d00d.png)

多少个炮塔才算多？

我之前做过一个[多段 boss 战](/nerd-for-tech/scripting-a-multi-stage-boss-battle-86fb1c3b984d)，为首款银河爆能枪。我想这次会容易得多。事实上，y [昨天](/nerd-for-tech/building-a-minimum-viable-product-with-unity-and-c-pt-3-a22c5e04ec02)，我自信地报告说，我离完成我的[最小可行产品](/nerd-for-tech/building-a-minimum-viable-product-with-unity-and-c-fbe724c09d72)只差 3%。让我们花点时间嘲笑一下我的过度自信。

![](img/aff8b44b92b828df259e0ada8e1cc8fa.png)

我想，这孩子得到了我文章的硬拷贝。

好吧，但是说真的。当我试图完成最后的 boss 战时，我遇到了一些重大的意外。

**旋转炮塔**

在我制作老板的动作动画之前，我先制作了一个敌人。炮塔类可以追踪玩家的移动并向他们面对的方向发射炸弹。于是，我去找我们的好老朋友[四元数。LookRotation(矢量 3 向前，矢量 3 向上)](https://docs.unity3d.com/ScriptReference/Quaternion.LookRotation.html)。我需要做的就是找到玩家和炮塔之间的相对向量，然后将该向量与所需的上向量一起传递。

现在，老板是在它的侧面飞行，所以我不能使用全局向上矢量，而是我将使用炮塔自己的变换。向上

这给我们留下了这样的线索:

![](img/6941bd3c99110b96158b44672cbcda29.png)

很简单，对吧？号码

![](img/6e892dedf1673f4ac02ab544b0326090.png)

LookRotation 将炮塔的 Z 向量指向玩家的方向，但我不知道，炮塔模型的 Z 轴从模型的顶部出来。

![](img/93be8bf9ffcbaac993a831a7d103a1bb.png)

为了好玩，这位艺术家把向前变成向上，向上变成向右，再向右变成向前。哇哦！

也就是说所有的爆炸源都指向了。好的，没问题。我只是将这个结果乘以 Y 轴上调整后的 90 度旋转…

![](img/d0bc327cc3f3193b43238cf0c34038b0.png)

我们好了吗？

![](img/a69571bfdd3efdc87494eed17f6e6860.png)

太棒了。

下一个问题来自我添加到老板的额外炮塔模型。仔细看看炮塔的变形箭头，注意到什么不同了吗？

![](img/639af70bc485c55ae54ee68da1200517.png)

…真的吗？

*这个*时间，炮塔的前进矢量指向炮塔的右侧，右侧矢量指向炮塔的后部！我的角度修正会让所有这些炮塔指向远离玩家的方向。

由于我不想创建一个完整的代码来处理这些炮塔模型，我采取了简单的方法，旋转枪的上部接收器面向另一个方向。

![](img/527935bfa64f8bbce316c14648995c51.png)

那里。没人会注意到。

最后，所有的炮塔都会跟踪玩家，并朝正确的方向射击。我知道我把这些作为要解决的简单问题来展示，但是我花了很长时间才弄明白我的模型不能在基本层面上就“上升”的含义达成一致。这占用了我太多的时间。

动画时间到了。那应该很容易，对吗？

![](img/3d59dac691e8661de4b02ab325a0c03a.png)

等着吧…

## 编排老板的动作

计划很简单。

第一阶段:敌人悬浮在屏幕外，起初只显示三座炮塔。大约每 8 秒钟，敌人就会从右边撤退，并在左边移动以反映他们的姿态。当敌人在左侧时，玩家几乎不可能用他们的基本武器射击炮塔——所以他们所能做的就是试图躲避射击。又过了 8 秒，敌人飞回到右边，循环又开始了。

![](img/6c53e61c069d1b35a97f1e5f38d1f380.png)

第二阶段:一旦前三个炮塔被处理，敌人飞到屏幕的对面，这一次进一步推进，露出另外七个炮塔。敌人也开始从屏幕的顶部到底部来回追踪。四个炮塔是追踪型的，可以被摧毁。剩下的三个是坚不可摧的，固定的。其中两个发射自动制导炮弹，第三个偶尔发射四股稳定的冲击波直接穿过屏幕。

![](img/770abfa35a776fefec27e06b084578b4.png)

第三阶段:当四个跟踪炮塔被摧毁时，敌人再次向对面猛扑，这一次完全进入视野并在屏幕中心疯狂旋转，从三个炮塔发射跟踪射击，并继续从其他炮塔发射寻的射弹和爆炸流。一旦最后三个追踪炮塔被摧毁，游戏就结束了。

![](img/7553b723520b455ffa47d6b756a2d0e2.png)

这一切都进行得很顺利，对吗？

其实没有。

![](img/021eb6a2b0ecb22badcbd96e61a77fb6.png)

又是角楼！？

是啊。我不知道它是如何或为什么或什么引起的，但每次老板飞到屏幕的另一边，炮塔上的旋转变得越来越混乱。正如你从我上面的 gif 例子中看到的，我最终确实解决了这个问题。但是，这又一次花了我太长的时间来解决，因为我不知道是什么导致了这个问题。我还是不知道。我刚刚找到了一个防止这种事情发生的方法。

![](img/be496f7911d66f9c40e66e245b6e40ec.png)

你听到了吗？在我对敌人进行任何轮换之前，我会完全关闭炮塔。如果我让它们的父母轮换时它们不活跃，它们永远不会感到困惑。

再说一次，我不知道为什么会发生这种情况，但我可以看到，每当老板改变态度时，情况就会变得更糟。所以，我让他们睡觉，这样他们就不会在旅途中变得神经兮兮的，当我们在祖母家的时候叫醒他们。问题解决了。

呃。

不用说，这花了我一整天的时间。我没有完成用户界面或最后的特效，更不用说添加任何我梦寐以求的功能了。不过没关系！我还有一天就要截稿了，我确信我可以在明天早上完成并发布它。

尽管这令人沮丧，但当我宣布我只剩下很少的工作来完成某件事时，我学会了检查我的信心。在古怪的游戏开发艺术中，总会有意想不到的问题。记住这一点很重要。

明天我将展示完成的项目。我很激动，希望你也是！