<html>
<head>
<title>Android Export and Import Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android导出和导入数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/android-export-and-import-data-9223c6bce8da?source=collection_archive---------0-----------------------#2022-01-08">https://medium.com/nerd-for-tech/android-export-and-import-data-9223c6bce8da?source=collection_archive---------0-----------------------#2022-01-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8f6ebfab0c38a0d432bea823ad2b85b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*URWznSWRVfSyR_nmPnQq8g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">以JSON格式导出/导入数据</figcaption></figure><p id="c60b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">关于数据，占据我们头脑的一件非常重要的事情就是不要丢失它。我们必须备份数据，以便在需要时进行恢复。因此，我们需要知道如何将数据推送到设备的SD内存中。在本文中，我们将了解如何在JSON文件中导入和导出数据。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h1 id="c99a" class="jz ka hi bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">我们开始吧</h1><p id="e25d" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">为了导出和导入数据，我们将使用<a class="ae lc" href="https://github.com/google/gson" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> Gson </strong> </a>库。它是一个Java库，将Java对象转换成它们的JSON表示。此外，它将JSON字符串转换为等效的Java对象。</p><p id="c4b2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要设置它:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="5389" class="lm ka hi li b fi ln lo l lp lq">implementation 'com.google.code.gson:gson:2.8.9'</span></pre><h1 id="5ca6" class="jz ka hi bd kb kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw bi translated">首先，以学习为目的，创建一个简单的UI。</h1><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="ed76" class="lm ka hi li b fi ln lo l lp lq"><em class="lw">&lt;?</em><strong class="li hj">xml version="1.0" encoding="utf-8"</strong><em class="lw">?&gt;<br/></em>&lt;<strong class="li hj">RelativeLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"</strong>&gt;<br/><br/>    &lt;<strong class="li hj">Button<br/>        android:id="@+id/btnExport"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:layout_centerInParent="true"<br/>        android:layout_marginStart="-6dp"<br/>        android:layout_marginTop="65dp"<br/>        android:layout_marginBottom="20dp"<br/>        android:text="Export"<br/>        android:textSize="20sp" </strong>/&gt;<br/><br/>    &lt;<strong class="li hj">Button<br/>        android:id="@+id/btnImport"<br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:layout_below="@id/btnExport"<br/>        android:layout_centerInParent="true"<br/>        android:text="Import"<br/>        android:textSize="20sp" </strong>/&gt;<br/>&lt;/<strong class="li hj">RelativeLayout</strong>&gt;</span></pre><h1 id="48b6" class="jz ka hi bd kb kc lr ke kf kg ls ki kj kk lt km kn ko lu kq kr ks lv ku kv kw bi translated">然后，让我们回到代码。</h1><h2 id="07a2" class="lm ka hi bd kb lx ly lz kf ma mb mc kj jf md me kn jj mf mg kr jn mh mi kv mj bi translated"><strong class="ak"> 1。将数据导出到</strong> JSON <strong class="ak">文件</strong></h2><p id="d2b6" class="pw-post-body-paragraph iu iv hi iw b ix kx iz ja jb ky jd je jf kz jh ji jj la jl jm jn lb jp jq jr hb bi translated">通常，我们从某个数据源获取数据，如房间、领域、火焰基地或任何其他数据源。</p><p id="f349" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们的例子中，我们将创建假数据。这将是客户和员工的两个列表。</p><ul class=""><li id="871d" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">创建客户类别</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="7bf3" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">class </strong>Customer(<strong class="li hj">var name</strong>: String, <strong class="li hj">var job</strong>: String, <strong class="li hj">var overDue</strong>: Float)</span></pre><ul class=""><li id="ad1b" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">创建员工类别</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="bfee" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">class </strong>Employee(<strong class="li hj">var nameEmployee</strong>: String, <strong class="li hj">var jobEmployee</strong>: String)</span></pre><ul class=""><li id="d0a0" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">创建用于存储这两个列表的数据类</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="8a1a" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">class </strong>Data(<strong class="li hj">val customers</strong>: List&lt;Customer&gt;, <strong class="li hj">val employees</strong>: List&lt;Employee&gt;)</span></pre><ul class=""><li id="c6a0" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">用虚拟数据创建两个列表</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="36b5" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">val </strong>customers = ArrayList&lt;Customer&gt;()<br/>customers.add(Customer(<strong class="li hj">"Hala"</strong>, <strong class="li hj">"developer"</strong>, 34.5f))<br/>customers.add(Customer(<strong class="li hj">"Nora"</strong>, <strong class="li hj">"teacher"</strong>, 43.5f))<br/>customers.add(Customer(<strong class="li hj">"Rana"</strong>, <strong class="li hj">"doctor"</strong>, 56.5f))<br/><br/><strong class="li hj">val </strong>employees = ArrayList&lt;Employee&gt;()<br/>employees.add(Employee(<strong class="li hj">"ALi"</strong>, <strong class="li hj">"carpenter"</strong>))<br/>employees.add(Employee(<strong class="li hj">"Yaser"</strong>, <strong class="li hj">"mechanic"</strong>))</span></pre><ul class=""><li id="8fa2" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">初始化Gson对象，并使其全局化，以便能够访问它</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="53b0" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private var gson</strong>: Gson? = <strong class="li hj">null</strong></span><span id="2c79" class="lm ka hi li b fi mt lo l lp lq"><strong class="li hj">gson </strong>= GsonBuilder().serializeNulls().setPrettyPrinting().create()</span></pre><ul class=""><li id="0cea" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">将类转换为JSON格式</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="997c" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>convertClassToJson(customers: List&lt;Customer&gt;, employees: List&lt;Employee&gt;): String? {<br/>    <strong class="li hj">val </strong>allData = Data(customers, employees)<br/>    <strong class="li hj">return gson</strong>?.toJson(allData)<br/>}</span></pre><ul class=""><li id="8f21" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">添加写入和读取数据的权限</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d832" class="lm ka hi li b fi ln lo l lp lq">&lt;<strong class="li hj">uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" </strong>/&gt;<br/>&lt;<strong class="li hj">uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" </strong>/&gt;</span></pre><ul class=""><li id="5e55" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">检查是否授予了存储权限。</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="868e" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>isStoragePermissionGranted(): Boolean {<br/>    <strong class="li hj">return if </strong>(Build.VERSION.<em class="lw">SDK_INT </em>&gt;= Build.VERSION_CODES.<em class="lw">M</em>) {<br/>        <strong class="li hj">if </strong>(checkSelfPermission(Manifest.permission.<em class="lw">WRITE_EXTERNAL_STORAGE</em>) == PackageManager.<em class="lw">PERMISSION_GRANTED</em>) {<br/>            <em class="lw">//Permission is granted<br/>            </em><strong class="li hj">true<br/>        </strong>} <strong class="li hj">else </strong>{<br/>            <em class="lw">//Permission is revoked<br/>            </em>ActivityCompat.requestPermissions(<strong class="li hj">this</strong>, <em class="lw">arrayOf</em>(Manifest.permission.<em class="lw">WRITE_EXTERNAL_STORAGE</em>), 1)<br/>            <strong class="li hj">false<br/>        </strong>}<br/>    } <strong class="li hj">else </strong>{<br/>        <em class="lw">// Permission is automatically granted on sdk&lt;23 upon installation<br/>        </em><strong class="li hj">true<br/>    </strong>}<br/>}</span></pre><ul class=""><li id="0314" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">获取一个随机的文件名，而不是覆盖同一个文件名</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="b583" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>getRandomFileName(): String {<br/>    <strong class="li hj">return </strong>Calendar.getInstance().<em class="lw">timeInMillis</em>.toString() + <strong class="li hj">".json"<br/></strong>}</span></pre><ul class=""><li id="b84e" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">将数据写入JSON文件</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="d480" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>writeTextToFile(jsonResponse: String?) {<br/>    <strong class="li hj">if </strong>(jsonResponse != <strong class="li hj">""</strong>) {<br/>        <em class="lw">// Create a File object like this.<br/>        </em><strong class="li hj">val </strong>dir = File(<strong class="li hj">"//sdcard//Download//"</strong>)<br/>        <strong class="li hj">val </strong>myExternalFile = File(dir, getRandomFileName())<br/>        <em class="lw">// Create an object of FileOutputStream for writing data to myFile.txt<br/>        </em><strong class="li hj">var </strong>fos: FileOutputStream? = <strong class="li hj">null<br/>        try </strong>{<br/>            <em class="lw">// Instantiate the FileOutputStream object and pass myExternalFile in constructor<br/>            </em>fos = FileOutputStream(myExternalFile)<br/>            <em class="lw">// Write to the file<br/>            </em>fos.write(jsonResponse?.<em class="lw">toByteArray</em>())<br/>            <em class="lw">// Close the stream<br/>            </em>fos.close()<br/>        } <strong class="li hj">catch </strong>(e: IOException) {<br/>            e.printStackTrace()<br/>        }<br/>        Toast.makeText(<strong class="li hj">this</strong>@MainActivity, <strong class="li hj">"Information saved to SD card. $</strong>myExternalFile<strong class="li hj">"</strong>, Toast.<em class="lw">LENGTH_SHORT</em>).show()<br/>    }<br/>}</span></pre><ul class=""><li id="7cfc" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">使用导出按钮备份您的数据</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="4815" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">binding</strong>.<strong class="li hj">btnExport</strong>.setOnClickListener <strong class="li hj">{</strong><em class="lw"><br/>    </em><strong class="li hj">if </strong>(isStoragePermissionGranted()) {<br/>        writeTextToFile(<strong class="li hj">allJsonResponse</strong>)<br/>    }<br/><strong class="li hj">}</strong></span></pre><p id="0711" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，您的数据被导出到手机下载文件夹中的JSON文件中。</p><h2 id="d02b" class="lm ka hi bd kb lx ly lz kf ma mb mc kj jf md me kn jj mf mg kr jn mh mi kv mj bi translated">2.从JSON文件导入数据</h2><ul class=""><li id="81cf" class="mk ml hi iw b ix kx jb ky jf mu jj mv jn mw jr mp mq mr ms bi translated">打开文件管理器，选择要导入的JSON文件</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="e36a" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>openFileManager() {<br/>    <strong class="li hj">val </strong>intent = Intent(Intent.<em class="lw">ACTION_OPEN_DOCUMENT</em>)<br/>    intent.addCategory(Intent.<em class="lw">CATEGORY_OPENABLE</em>)<br/>    intent.<em class="lw">type </em>= <strong class="li hj">"*/*"<br/>    getDataFromFile</strong>.launch(intent)<em class="lw"><br/></em>}</span></pre><ul class=""><li id="6493" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">从JSON文件中读取数据</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="7ee7" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private fun </strong>readTextFromUri(uri: Uri): String {<br/>    <strong class="li hj">var </strong>inputStream: InputStream? = <strong class="li hj">null<br/>    val </strong>stringBuilder = StringBuilder()<br/>    <strong class="li hj">try </strong>{<br/>        inputStream = <em class="lw">contentResolver</em>.openInputStream(uri)<br/>        <strong class="li hj">val </strong>reader = BufferedReader(InputStreamReader(inputStream))<br/><br/>        <em class="lw">// Read a line of text.<br/>        </em><strong class="li hj">var </strong>line = reader.readLine()<br/>        <em class="lw">// Read the entire file<br/>        </em><strong class="li hj">while </strong>(line != <strong class="li hj">null</strong>) {<br/>            <em class="lw">// Append the line read to StringBuilder object. Also, append a new-line<br/>            </em>stringBuilder.append(line).append(<strong class="li hj">'</strong>\n<strong class="li hj">'</strong>)<br/>            <em class="lw">// Again read the next line and store in variable line<br/>            </em>line = reader.readLine()<br/>        }<br/>    } <strong class="li hj">catch </strong>(e: IOException) {<br/>        e.printStackTrace()<br/>    }<br/>    <strong class="li hj">return </strong>stringBuilder.toString()<br/>}</span></pre><ul class=""><li id="6ce4" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">在活动中获取JSON数据</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="55b7" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">private var getDataFromFile </strong>=<br/>registerForActivityResult(ActivityResultContracts.StartActivityForResult()) <strong class="li hj">{ </strong>result: ActivityResult <strong class="li hj">-&gt;<br/>        if </strong>(result.<em class="lw">resultCode </em>== <em class="lw">RESULT_OK</em>) {<br/>            <strong class="li hj">val </strong>uri = result.<em class="lw">data</em>?.<em class="lw">data<br/>            </em><strong class="li hj">val </strong>fileContents = readTextFromUri(uri!!)<br/>            Toast.makeText(<strong class="li hj">this</strong>@MainActivity, fileContents, Toast.<em class="lw">LENGTH_SHORT</em>).show()<br/>        }<br/>    <strong class="li hj">}</strong></span></pre><ul class=""><li id="5853" class="mk ml hi iw b ix iy jb jc jf mm jj mn jn mo jr mp mq mr ms bi translated">使用导入按钮恢复您的数据</li></ul><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="88ef" class="lm ka hi li b fi ln lo l lp lq"><strong class="li hj">binding</strong>.<strong class="li hj">btnImport</strong>.setOnClickListener <strong class="li hj">{<br/>    </strong>openFileManager()<br/><strong class="li hj">}</strong></span></pre><p id="7ace" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">恭喜，您的数据是从一个JSON文件导入的，现在您可以将它插入到您的数据库中，或者以任何适合您的应用程序的方式使用它。</p><p id="a42e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于GitHub上的样例App，点击<a class="ae lc" href="https://github.com/Marwa-Eltayeb/Android-Features/tree/master/BackupData" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">backup data</strong></a><strong class="iw hj">。</strong>还有，这个功能在我的app <strong class="iw hj"> Wordi里实现了。</strong>获取<em class="lw">它</em>通过<a class="ae lc" href="https://play.google.com/store/apps/details?id=com.marwaeltayeb.wordi" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> Google Play </strong> </a></p><p id="53f2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">更多文章:点击<a class="ae lc" href="https://marwa-eltayeb.medium.com/" rel="noopener"> <strong class="iw hj">此处</strong> </a></p><p id="777b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">找到我这里:</strong><a class="ae lc" href="https://github.com/Marwa-Eltayeb" rel="noopener ugc nofollow" target="_blank">GitHub</a>|<a class="ae lc" href="https://www.linkedin.com/in/marwa-eltayeb/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae lc" href="https://twitter.com/Marwa_Eltayeb1" rel="noopener ugc nofollow" target="_blank">Twitter</a></p></div></div>    
</body>
</html>