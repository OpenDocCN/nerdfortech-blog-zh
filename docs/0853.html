<html>
<head>
<title>Building Github Actions With the Vonage Messages API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Vonage消息API构建Github动作</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/building-github-actions-with-the-vonage-messages-api-c92f9cd5d04a?source=collection_archive---------14-----------------------#2021-02-18">https://medium.com/nerd-for-tech/building-github-actions-with-the-vonage-messages-api-c92f9cd5d04a?source=collection_archive---------14-----------------------#2021-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3e482e6e261dbc37701d05b214e27244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nr33Mle9iRz8bPT6wAVcEw.png"/></div></div></figure><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es iq"><img src="../Images/0f79c8487b0d62a75cc85ed59daf39bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FdPeT2xGcj9NEHn6op0Rdw.png"/></div></div></figure><p id="c155" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于团队和个人来说，沟通对于项目的成长非常重要。不仅仅是成员之间的交流，还包括与项目的直接交流。手动检查应用程序的状态可能很费力，而这正是使用通信API的自动化所能提供的好处。当应用程序中发生事件时，您可以通过文本、语音通话、社交媒体或任何其他方式(取决于API的功能)轻松获得通知。</p><p id="828d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GitHub Actions是GitHub中一个漂亮的集成，它允许你根据发生的特定事件触发动作。这对于许多目的都是有用的，这取决于开发人员的创造力。用例之一是通过通信API发送消息。</p><p id="3c6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将学习如何使用WhatsApp通道将GitHub动作与Vonage Messages API结合起来。当特定事件发生时，我们会向WhatsApp号码发送消息。您还可以使用API的其他支持通道进行练习。</p><p id="1deb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">所需知识:</strong>为了从本文中获得最大收益，需要对Node.js应用程序是如何创建的以及GitHub操作是如何工作的有一定的了解。这里有一篇<a class="ae jt" href="https://docs.github.com/en/free-pro-team@latest/actions/learn-github-actions/introduction-to-github-actions" rel="noopener ugc nofollow" target="_blank">介绍GitHub Actions </a>的文章，你可能想先看看。</p><h1 id="5dcf" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">什么是Github动作</h1><p id="eec7" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">GitHub动作允许你在事件发生时执行特定的命令；例如，当有人发出拉请求时，推送到一个分支，以及<a class="ae jt" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows" rel="noopener ugc nofollow" target="_blank">更多的事件</a>。</p><p id="a457" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">GitHub操作可以以多种方式使用，其中包括:</p><ul class=""><li id="43bf" class="kx ky hi ix b iy iz jc jd jg kz jk la jo lb js lc ld le lf bi translated">对拉请求运行测试</li><li id="2d60" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">更新分支后自动部署</li><li id="1213" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">与开发者交流应用状态、问题或请求</li><li id="acd8" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">更多的</li></ul><h1 id="cdaa" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Vonage消息API — WhatsApp频道</h1><p id="94d2" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">Messages API允许您通过WhatsApp频道向WhatsApp号码发送消息。要访问API，您需要在Vonage开发人员仪表板上创建一个帐户。之后，您将获得免费积分来开始测试API。要使用WhatsApp频道，你需要设置一个沙箱。</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/f12765672fa9f04fbeca9f1aebc272f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qkUaQR4FPUSA53s9CvElbg.png"/></div></div></figure><p id="698a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，将WhatsApp频道添加到沙盒中。您将获得一个导航到WhatsApp应用程序的链接，在输入字段中有一条默认消息准备发送到Vonage。默认消息各不相同。对于本教程，生成的消息是<strong class="ix hj">“加入山药片”</strong>。对于WhatsApp网络应用，这里有一个截图:</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/505c582df510855d8a28610da6a1e08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mj8Dihu5x2cJUburvLE1Eg.png"/></div></div></figure><p id="8e70" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">发送该消息时，您会收到一条消息，通知您您的号码已被列入沙箱的白名单。这意味着您现在可以向该号码发送消息。</p><p id="a32c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你想添加更多号码，只需使用你想添加的WhatsApp号码向同一收件人发送相同的文本即可。</p><p id="3c9e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在同一个页面上，您会发现类似这样的内容:</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/a8797d3c326636953ebd2aea27c201ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySnBOCvChG68k9DstbtxZQ.png"/></div></div></figure><p id="4c28" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这展示了如何调用API向白名单中的号码发送消息。此发布请求显示:</p><ul class=""><li id="2dd6" class="kx ky hi ix b iy iz jc jd jg kz jk la jo lb js lc ld le lf bi translated">网址:<a class="ae jt" href="https://messages-sandbox.nexmo.com/v0.1/messages" rel="noopener ugc nofollow" target="_blank">https://messages-sandbox.nexmo.com/v0.1/messages</a></li><li id="6e4f" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated"><code class="du lm ln lo lp b">-u</code>标志中的用户名和密码(有意隐藏在截图中)。冒号前的第一组是API密钥，第二组是Vonage生成的密码。</li><li id="0776" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">一些标题</li><li id="05a2" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">数据，包含<code class="du lm ln lo lp b">from</code>(Vonage给你发消息的WhatsApp号)<code class="du lm ln lo lp b">to</code>(收件人，白名单号)，和<code class="du lm ln lo lp b">message</code>属性。</li></ul><p id="711a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我们将在GitHub操作中用来发送消息的。</p><p id="751c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，让我们设置一个示例应用程序来查看使用中的GitHub操作和Vonage消息API。</p><h1 id="d54c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">将Github动作与WhatsApp API相结合</h1><p id="72e5" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">对于这个例子，我们将创建一个npm库，它在执行时返回“我是一个库”。这是一个非常简单的应用程序，所以我们可以专注于GitHub操作如何与WhatsApp API配合工作。</p><h2 id="97c3" class="lq jv hi bd jw lr ls lt ka lu lv lw ke jg lx ly ki jk lz ma km jo mb mc kq md bi translated">设置环境</h2><p id="aacb" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">使用终端，导航到您希望项目所在的目录，然后执行以下操作:</p><ul class=""><li id="30e1" class="kx ky hi ix b iy iz jc jd jg kz jk la jo lb js lc ld le lf bi translated"><code class="du lm ln lo lp b">mkdir simple-lib</code>:创建一个名为“简单库”的目录</li><li id="2b60" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated"><code class="du lm ln lo lp b">cd simple-lib</code>:导航至该目录</li><li id="dae4" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated"><code class="du lm ln lo lp b">npm init -y</code>:设置<code class="du lm ln lo lp b">package.json</code></li><li id="3220" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated"><code class="du lm ln lo lp b">touch index.js</code>:创建一个index.js文件，我们将在其中放置库的执行代码</li></ul><p id="5f82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将以下代码添加到<code class="du lm ln lo lp b">index.js</code>:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="fa0e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设我们想为我们的库建立一个测试套件。在您的终端上运行以下命令:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="57f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是JavaScript应用程序的测试框架。我们将在<code class="du lm ln lo lp b">test.js</code>中使用以下代码进行测试:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="6e89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du lm ln lo lp b">package.json</code>中，将<code class="du lm ln lo lp b">test</code>属性编辑为以下值:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="b910" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，当您在终端上运行<code class="du lm ln lo lp b">npm run test</code>时，您将得到:</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/f40ed5cee9371f901835efdcb88f74cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_C-GAsAIuqBCGyyFuNeftw.png"/></div></div></figure><p id="8f36" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用<code class="du lm ln lo lp b">git init</code>初始化Git repo，提交更改，并推送到您为此示例创建的新GitHub存储库。</p><h2 id="fb91" class="lq jv hi bd jw lr ls lt ka lu lv lw ke jg lx ly ki jk lz ma km jo mb mc kq md bi translated">实现WhatsApp消息传递</h2><p id="0b4f" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">运行GitHub动作时，需要一个<a class="ae jt" href="https://github.com/actions/runner" rel="noopener ugc nofollow" target="_blank"> <strong class="ix hj">动作运行器</strong> </a>。action runner为我们想要使用的消息API提供了实现。动作跑者需要两个文件:</p><ul class=""><li id="6bc8" class="kx ky hi ix b iy iz jc jd jg kz jk la jo lb js lc ld le lf bi translated">它为运行者提供了模式，比如要接收的输入、输出的变量等等。</li><li id="8e89" class="kx ky hi ix b iy lg jc lh jg li jk lj jo lk js lc ld le lf bi translated">主文件(可以是<code class="du lm ln lo lp b">dist/index.js</code>)提供了<code class="du lm ln lo lp b">action.yml</code>所引用的实际实现。</li></ul><p id="84b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于本例，创建一个具有以下配置的<code class="du lm ln lo lp b">action.yml</code>文件:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="6c32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们创建一个将被编译成<code class="du lm ln lo lp b">dist/index.js</code>的<code class="du lm ln lo lp b">whatsapp.js</code>文件。该文件包含使用WhatsApp频道发送消息所需的代码。</p><p id="cab1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是<code class="du lm ln lo lp b">whatsapp.js</code>文件的内容:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="c070" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lm ln lo lp b"><a class="ae jt" href="https://www.npmjs.com/package/@actions/core" rel="noopener ugc nofollow" target="_blank">@actions/core</a></code>是一个包含几个函数的库，用于接受输入、导出变量和跨动作做许多其他事情。这一点的重要性在于从GitHub上的行动跑步者那里接收输入。需要安装它，所以运行:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="252e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是一个基于承诺的HTTP客户端，用于发出网络请求。这用于发出POST请求。它也需要安装，所以运行:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="9ac4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lm ln lo lp b">process.env</code>允许访问包含GitHub在工作流执行期间公开的变量的环境变量。例如，GitHub公开了可以通过<code class="du lm ln lo lp b">process.env.GITHUB_REPOSITORY</code>访问的<code class="du lm ln lo lp b">GITHUB_REPOSITORY</code>变量。<a class="ae jt" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/environment-variables#default-environment-variables" rel="noopener ugc nofollow" target="_blank">你可以在这里找到更多默认的GitHub环境变量</a>。</p><p id="2cb3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将接收到一个<code class="du lm ln lo lp b">message</code>输入(我们将在GitHub Actions配置部分看到如何设置)，这将是我们将发送给WhatsApp number的相同消息。你可以使用任何白名单上的号码，但是Vonage明确指出:</p><blockquote class="mh mi mj"><p id="090f" class="iv iw mk ix b iy iz ja jb jc jd je jf ml jh ji jj mm jl jm jn mn jp jq jr js hb bi translated">不要使用+或00，只需以国家代码开头，例如447700900000</p></blockquote><p id="9dcc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后进行post请求，将WhatsApp消息发送到该号码。</p><p id="4296" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如在Vonage的示例代码中所看到的，我们为服务器认证指定了用户名和密码。对于Axios，这是通过包含 <code class="du lm ln lo lp b"><a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">username</a></code> <a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">和</a> <code class="du lm ln lo lp b"><a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">password</a></code> <a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">属性</a>的<code class="du lm ln lo lp b"><a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">auth</a></code> <a class="ae jt" href="https://stackoverflow.com/questions/62730511/axios-equivalent-of-curl-u-flag" rel="noopener ugc nofollow" target="_blank">对象来完成的。</a></p><p id="e789" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如上所示，WhatsApp消息以如下形式发送:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="74f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还需要再安装一个包:。这个包用于将Node.js文件捆绑到一个文件中。我们将使用它将<code class="du lm ln lo lp b">whatsapp.js</code>和所有使用的依赖项捆绑到一个文件中。</p><p id="4d72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在<code class="du lm ln lo lp b">package.json</code>中增加以下内容:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="4e65" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在推送之前，我们需要运行<code class="du lm ln lo lp b">npm run build</code>，这样whatsapp.js中的所有内容都将被导出到<code class="du lm ln lo lp b">dist/index.js</code>。</p><h1 id="04aa" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">Github操作的配置</h1><p id="3efc" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">首先，在项目根目录下的<code class="du lm ln lo lp b">.github</code>目录中创建一个<code class="du lm ln lo lp b">workflows</code>目录。这个目录将包含我们的应用程序所需的所有工作流。</p><p id="4649" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在workflows下，创建一个名为“whatsapp-actions.yml”的文件。GitHub动作使用<a class="ae jt" href="https://yaml.org/" rel="noopener ugc nofollow" target="_blank"> YAML </a>语法来描述工作流。</p><p id="266c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个例子，当一个新的提交被推送到存储库并且测试脚本失败时，我们想要发送一个WhatsApp消息。工作流程的内容如下:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="4424" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们继续下一步之前，让我们对上面的配置有一个清楚的了解。</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="b9c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">属性指定了工作流的名称。这是你在GitHub的actions标签中看到的。</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="913b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lm ln lo lp b">on</code>属性指定触发工作流的事件。对于我们的例子，<code class="du lm ln lo lp b">push</code>事件就是这样做的。这意味着当有人将变更提交到存储库中的一个分支时，工作流就会运行。这里有更多你可以使用的事件。你也可以指定<a class="ae jt" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/events-that-trigger-workflows#example-using-a-list-of-events" rel="noopener ugc nofollow" target="_blank">多个事件</a>。</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="48df" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lm ln lo lp b">jobs</code>属性指定将为该工作流运行的作业。我将第一份工作命名为<code class="du lm ln lo lp b">run-tests</code>。GitHub在actions选项卡下显示工作流中运行的每个任务，方法是将它们按各自的作业名称分组。</p><p id="69a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一行(<code class="du lm ln lo lp b">runs-on</code>)指定应该用于执行工作流的操作系统类型和版本。</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="89c7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在“工作”部分下面是要采取的“步骤”。<code class="du lm ln lo lp b">steps</code>块描述了组成作业的任务的执行。</p><p id="5d64" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在前两步中，动作“使用”<code class="du lm ln lo lp b"><a class="ae jt" href="https://github.com/marketplace/actions/checkout" rel="noopener ugc nofollow" target="_blank">actions/checkout@v2</a></code>和<code class="du lm ln lo lp b"><a class="ae jt" href="https://github.com/marketplace/actions/setup-node-js-environment" rel="noopener ugc nofollow" target="_blank">actions/setup-node@v1</a></code>。<code class="du lm ln lo lp b">actions/checkout@v2</code>是一个动作运行器，用于检查存储库。这是让您的工作环境能够访问存储库中的代码所必需的。<code class="du lm ln lo lp b">actions/setup-node@v1</code>是下载节点的动作运行器。这提供了对第三和第四步中需要的<code class="du lm ln lo lp b">npm</code>的访问。</p><p id="6a67" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用于创建GitHub动作的样板文件可以在<a class="ae jt" href="https://github.com/actions/starter-workflows/blob/c59b62dee0eae1f9f368b7011cf05c2fc42cf084/ci/node.js.yml" rel="noopener ugc nofollow" target="_blank"> starter workflows存储库</a>中找到。如图所示，<code class="du lm ln lo lp b">uses: actions/checkout@v2</code>和<code class="du lm ln lo lp b">actions/setup-node@v1</code>也用于步骤部分。这是两个至关重要的步骤，因为它们使得使用<code class="du lm ln lo lp b">npm</code>执行您的存储库中的代码成为可能。</p><p id="3d18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">运行<code class="du lm ln lo lp b">npm i</code>会安装<code class="du lm ln lo lp b">package.json</code>中的所有依赖项，而<code class="du lm ln lo lp b">npm test</code>会运行<code class="du lm ln lo lp b">test</code>脚本。</p><p id="2cda" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">工作流中的下一步是名为“WhatsApp Message”的一组步骤。这些行使用我们在<code class="du lm ln lo lp b">action.yml</code>中的动作配置触发WhatsApp消息。该步骤在下一行有一个条件(<code class="du lm ln lo lp b">if: ${{ failure() }}</code>)，表明只有当作业中前面的步骤失败时，剩余的测试才会执行。您可以查看更多<a class="ae jt" href="https://docs.github.com/en/free-pro-team@latest/actions/reference/context-and-expression-syntax-for-github-actions#job-status-check-functions" rel="noopener ugc nofollow" target="_blank">工作状态检查</a>。</p><p id="2a4e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在WhatsApp消息步骤中，操作“使用”<code class="du lm ln lo lp b">dillionmegida/github-actions@master</code>(同一个存储库的主分支)作为消息API代码实现的操作运行器。GitHub此时会在这个存储库的根目录中搜索<code class="du lm ln lo lp b">action.yml</code>，我们已经配置好了。</p><p id="bb59" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该动作使用<code class="du lm ln lo lp b">with</code>属性向动作运行器(whatsapp.js)发送输入。输入带有一个键<code class="du lm ln lo lp b">message</code>和值<code class="du lm ln lo lp b">*TEST FAILED*</code>。添加星号是为了让WhatsApp可以将文本加粗。</p><h2 id="a706" class="lq jv hi bd jw lr ls lt ka lu lv lw ke jg lx ly ki jk lz ma km jo mb mc kq md bi translated">测试Github动作</h2><p id="1ca7" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">现在我们已经设置好了一切，我们可以通过推送到存储库来触发工作流。在此之前，我们需要确保测试失败，这样WhatsApp消息实现就会被执行。</p><p id="fbaf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编辑<code class="du lm ln lo lp b">test.js</code>如下:</p><figure class="ir is it iu fd ij"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="2de3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以捆绑我们的应用程序(使用<code class="du lm ln lo lp b">npm run build</code>)，提交更改，并将其推送到存储库。</p><p id="bb29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">推送时，工作流被触发，我们得到如下所示的错误:</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/d3f097c6996ddfe6d0fb28f84af28f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqL0norsH6fkaA9cFjWuBQ.png"/></div></div></figure><p id="17ac" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出错后，我们会得到如下WhatsApp消息:</p><figure class="ir is it iu fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/1789cc6d3579adb5f446aef9119851e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDzwoFlLgho2K20xXNQm6Q.jpeg"/></div></div></figure><h1 id="3ae3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">结论</h1><p id="ce0d" class="pw-post-body-paragraph iv iw hi ix b iy ks ja jb jc kt je jf jg ku ji jj jk kv jm jn jo kw jq jr js hb bi translated">使用GitHub动作可以做很多事情，使用Vonage通信API甚至可以做更多事情。你也可以在Viber和Facebook Messenger上发送消息。</p><p id="a089" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们了解了什么是GitHub动作，一些使GitHub动作强大的实用程序，以及如何集成Vonage Messages API，以便在将提交推送到存储库后测试脚本失败时发送WhatsApp消息。</p></div><div class="ab cl mq mr gp ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hb hc hd he hf"><p id="f4ba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="mk">最初发布于</em><a class="ae jt" href="https://learn.vonage.com/blog/2021/02/04/building-github-actions-with-the-vonage-messages-api/" rel="noopener ugc nofollow" target="_blank"><em class="mk">https://learn . vonage . com/blog/2021/02/04/building-github-actions-with-the-vonage-messages-API/</em></a></p></div></div>    
</body>
</html>