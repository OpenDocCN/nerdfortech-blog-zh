<html>
<head>
<title>What happens when you type any URL in the browser and press enter?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当你在浏览器中输入任何URL并按下回车键时会发生什么？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-happens-when-you-type-any-url-in-the-browser-and-press-enter-f3f930c732bb?source=collection_archive---------1-----------------------#2020-12-05">https://medium.com/nerd-for-tech/what-happens-when-you-type-any-url-in-the-browser-and-press-enter-f3f930c732bb?source=collection_archive---------1-----------------------#2020-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="69cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗯，我们中的许多人一定很想知道“当我们在浏览器中键入任何URL并按enter键时会发生什么？”。事实上，这确实是一个非常大的问题，需要几个月甚至几年的时间来理解其中涉及的每个概念。本文向您介绍了如何处理请求和接收响应的基本概念。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3b615081d0b8c07ac27e9a1bfa958b80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3OlvBnMWjjhjlGC76sbOJQ.png"/></div></div></figure><p id="0f98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们正在访问“<a class="ae jp" href="https://www.google.com" rel="noopener ugc nofollow" target="_blank">http://www.google.com</a>”，下面是我们如何得到响应:</p><ol class=""><li id="4967" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">在不同级别的缓存中查找网站的IP地址(URL)。</li><li id="d103" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">创建与目标Google服务器的TCP/UDP连接。</li><li id="ed56" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">通过TCP/UDP向google服务器发送GET|www.google.com请求。</li><li id="b902" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">Google server处理收到的请求并发回响应。</li><li id="1929" class="jq jr hi ih b ii jz im ka iq kb iu kc iy kd jc jv jw jx jy bi translated">浏览器理解并显示响应。</li></ol><h1 id="7024" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">1.查找网站的IP地址(URL)</h1><p id="5bfc" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">总的来说，域名是人类可读的，也更容易记忆。但是我们需要目的地IP地址(这将有助于包转发)而不是人类可读的域名来处理请求。<a class="ae jp" href="https://www.namecheap.com/dns/what-is-dns-domain-name-system-definition/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="lh"> DNS </em> </strong> </a>为我们工作，即<a class="ae jp" href="https://www.namecheap.com/dns/what-is-dns-domain-name-system-definition/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="lh"> DNS </em> </strong> </a>通过存储每个域名及其关联的IP地址来帮助我们。在我们直接从DNS服务器获取IP地址之前，我们可以从多个地方(缓存级别)快速获取IP地址。这就是IP路由。</p><ol class=""><li id="ae37" class="jq jr hi ih b ii ij im in iq js iu jt iy ju jc jv jw jx jy bi translated">首先，浏览器将检查自己的DNS缓存。大多数浏览器，如Chrome、Firefox等，都有自己的DNS缓存级别，这样可以提供更快的响应。我们可以使用这些命令检查浏览器DNS缓存:Firefox browser - <em class="lh">关于:联网#dns &amp; </em> Chrome浏览器-<em class="lh">Chrome://net-internals/# DNS。</em></li></ol><p id="cfeb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下图显示了Firefox浏览器存储的DNS缓存。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/fddc8796b9f6859af713a61504f7e3f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVreY4sYwA5XW5cBrx8b-Q.png"/></div></div></figure><p id="4964" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.如果IP地址没有缓存在浏览器中，它继续到下一个级别，即检查操作系统缓存。如果操作系统缓存了返回的IP地址，浏览器将使用<code class="du lj lk ll lm b">getaddrinfo().</code>进行<a class="ae jp" href="https://en.wikipedia.org/wiki/System_call" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="lh">系统调用</em> </strong> </a>，否则将继续。</p><p id="a1bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.下一个级别是检查WiFi路由器缓存(WiFi路由器确实有自己的内存缓存，但大小有限)。如果没有找到，请求继续。</p><p id="e392" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.下一步是检查电缆调制解调器缓存。如果没有找到，请求继续。</p><p id="29cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.下一步是检查ISP的DNS缓存。如果直到这一级都没有找到IP地址，ISP将执行DNS递归搜索，直到找到IP地址，如果没有找到则返回一个错误。如果一个域名有多个IP地址，DNS循环算法会选择一个并返回。</p><p id="b546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DNS路由的所有上述步骤的图示如下所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/057180cf3da80ef08ff9c93a3661f449.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhWPchc3Tw1oGT6Lt3TceA.png"/></div></div></figure><p id="c80b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们得到了www.google.com的IP地址为172.217.14.196</p><h2 id="c932" class="lo kf hi bd kg lp lq lr kk ls lt lu ko iq lv lw ks iu lx ly kw iy lz ma la mb bi translated">2.创建与目标Google服务器的TCP/UDP连接</h2><p id="9482" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">一旦我们找到了IP地址，我们需要一个通信媒介将我们的请求数据传送到目的服务器。TCP/IP的作用来了。客户端(浏览器)将与目的服务器执行<a class="ae jp" href="https://en.wikipedia.org/wiki/Handshaking#TCP_three-way_handshake" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> TCP三次握手</strong> </a> <strong class="ih hj"> </strong>以检查服务器是否准备好接受请求&amp;以同意正在使用的协议等。一旦握手完成并且TCP通信通道打开，客户端或服务器就可以通过同一连接发送和接收应用程序数据，直到客户端或服务器关闭该连接。</p><h2 id="7e0e" class="lo kf hi bd kg lp lq lr kk ls lt lu ko iq lv lw ks iu lx ly kw iy lz ma la mb bi translated">3.通过TCP向google服务器发送GET|www.google.com请求。</h2><p id="69a5" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">一旦与目的服务器建立了TCP连接，我们需要发送实际的请求，即GET |<a class="ae jp" href="http://www.google.com." rel="noopener ugc nofollow" target="_blank">http://www.google.com</a>。</p><p id="f877" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们假设你想给你的朋友写一封信。你要用一种你们都能理解的语言写这封信。你可以通过添加发件人和收件人地址来寄信给你的朋友。</p><p id="dbca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同样的事情也会在客户端(浏览器)<a class="ae jp" href="https://en.wikipedia.org/wiki/Internet_protocol_suite" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="lh"> TCP层</em> </strong> </a>完成。请求<em class="lh">GET |</em><a class="ae jp" href="http://www.google.com." rel="noopener ugc nofollow" target="_blank"><em class="lh">http://www.google.com</em></a>需要被翻译成特定的格式，以便目的服务器能够读取并理解&amp;的响应。TCP协议4层，即应用层、传输层、网络层&amp;数据链路层将通过在每层添加源和目的端口、地址、报头、mac地址、请求数据类型、响应类型等，将请求转换为有意义的二进制数据。翻译后的二进制数据将被分成小单元，并作为数据包在网络上传输。</p><p id="0a98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们应该注意到，每个数据包都有源端口和目的端口、地址、报头、mac地址、请求数据类型、响应类型等。这些细节将帮助接收者转换成原始请求。</p><p id="47b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简单地说，客户端将把<em class="lh">GET |</em><a class="ae jp" href="http://www.google.com." rel="noopener ugc nofollow" target="_blank"><em class="lh"/></a><em class="lh"/>请求通过TCP通信通道作为网络数据包发送到目的服务器。</p><h2 id="3a60" class="lo kf hi bd kg lp lq lr kk ls lt lu ko iq lv lw ks iu lx ly kw iy lz ma la mb bi translated"><strong class="ak"> 4。目标Google服务器接收、处理请求，并发回响应。</strong></h2><p id="fa3b" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">一旦服务器接收到数据包，服务器的TCP层会帮助重新组织这些数据包，并将其转换为客户端发送的实际请求。服务器处理请求，并以客户端请求的格式(即HTML、JSON、XML等)准备响应，并添加其他细节，如响应状态等。一旦服务器准备好响应，它将被发送回客户端。</p><p id="8dea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。浏览器理解&amp;显示响应。</strong></p><p id="6c04" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦客户端收到服务器的响应，浏览器检查<a class="ae jp" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="lh">响应状态码</em> </strong> </a>即2xx(成功响应)、3xx(重定向请求)、4xx(客户端错误)5xx(服务器错误)等。</p><p id="5f53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浏览器将根据收到的响应类型尝试翻译响应。在我们的例子中，它是html，所以它将显示HTML页面。如果响应是可缓存的，它会将响应存储在浏览器缓存中。</p></div></div>    
</body>
</html>