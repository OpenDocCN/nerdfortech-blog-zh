<html>
<head>
<title>Building Spring Boot Microservices , Monitoring with prometheus and grafana and log aggregation using ELK stack: Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Spring Boot微服务，使用prometheus和grafana进行监控，使用ELK stack进行日志聚合:第一部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/creating-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-ba4f20496942?source=collection_archive---------0-----------------------#2021-01-15">https://medium.com/nerd-for-tech/creating-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-ba4f20496942?source=collection_archive---------0-----------------------#2021-01-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b75cba00d15d23111ab143bb479acad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BicliTTLme6W9DBVjj8CjA.png"/></div></div></figure><p id="9c14" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">简介</strong></p><p id="3d31" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在开发大量复杂的应用程序(电子商务、流式视频、银行……)时，大多数开发人员都面临着许多挑战，例如:</p><p id="287e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">-可用性:</strong>无论用户的行为如何，我们如何确保我们的应用程序始终可用？</p><p id="7bae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">-可维护性:</strong>我们的应用程序必须经常进化，并且在不关闭整个应用程序的情况下快速响应新的特性。</p><p id="04e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">-进化:</strong>每天都有技术用于开发应用程序进化，因此我们必须确保我们的应用程序有能力适应这种进化</p><p id="9e0e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当然还有我们将要面临的许多其他问题和挑战。</p><p id="4af9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章的第一部分，我们将了解微服务架构是如何解决这个问题并应对挑战的。</p><h1 id="876a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">什么是微服务架构？</strong></h1><p id="fc21" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">微服务架构提供了一个简单的解决方案:将应用程序拆分成称为微服务的小服务，这些服务是完全自治的，并公开其他微服务可以使用的REST API。</p><p id="e5b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下图简要概述了微服务架构:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/970a87b5e5c8c03c95a681f1e969328a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*RIQEqTXOBs91fQM_qXiauw.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">全球建筑</figcaption></figure><h1 id="8464" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">微服务架构如何应对上述问题？</h1><p id="5e57" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">正如我们在上一张图中看到的，每个微服务都是完全自主的，可以部署在各种服务器和不同的实例上，这使得我们的微服务可用且可扩展。在这种情况下，负责UI的微服务将调用其中一个实例，并接收相同的响应，而不管选择哪个实例。</p><p id="7e06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们不必再担心可维护性，每个微服务都独立于其他微服务工作，所以每当我们想要在微服务上工作时，我们不必停止整个应用程序(monolothic应用程序的情况),我们只需访问有问题的微服务。</p><p id="6725" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于提供的各种技术，每个微服务可以使用不同的技术，微服务A可以在java中，微服务B可以在php中……主要是每个微服务都公开了一个rest API。这一优势将使我们能够关注应用程序的业务逻辑，而不用担心技术。</p><p id="2b99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们快速了解了微服务架构及其优势之后，我们将把所有这些付诸实践，以便涵盖大多数主题。</p><p id="f091" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用著名的<strong class="is hj"> Spring boot框架</strong>创建一个简单的电子商务应用，它有三个微服务(ProductMicroservice、OrderMicroservice和clientMicroservices)。</p><h1 id="379a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">创建微服务</strong></h1><p id="92d3" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">第一步包括创建三个spring initializer项目，它们将代表我们的微服务。</p><p id="679f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这些项目每个都有一个类(产品、订单和客户),现在还有这些依赖项:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/d554a799fc991e4f76acf60f2e890d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7tYxeGMFxUtojklL_jFpFA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">属国</figcaption></figure><p id="48bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">产品微服务会有两个简单的操作:通过id找到一个产品，获取所有产品。</p><p id="8153" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">order微服务:添加一个新订单，并按其id查找和订购。</p><p id="7433" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">客户端将使用微服务。</p><p id="656e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建微服务及其方法后，我们必须在每个微服务中看到这个包树:</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/c0954ce3c582c78fe003f23e154da6de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*Gv4sEzv1ATv2NOlbd0Gzsg.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">包裹</figcaption></figure><p id="82f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要担心源代码，在本课程结束时，您会找到整个代码的链接，现在我们只需了解每个步骤。</p><p id="5e70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有两个独立运行的spring boot应用程序，到目前为止一切都很熟悉。</p><h1 id="66af" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">尤里卡服务器</h1><p id="7304" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">正如我们所说的，现在一切都很熟悉，每个微服务及其实例都是独立运行的。但是我们需要一些东西来注册所有这些实例。</p><p id="b093" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">网飞拥有的尤里卡服务响应这一需求，尤里卡将注册每一个微服务。</p><p id="99e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在eureka server中注册的每个微服务都称为eureka client。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/2bfe96b435b93c9c5e57b2019158829b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*fRhh9GzAD404swvSBbtwZA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">尤里卡</figcaption></figure><p id="ca8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上图显示了我们的微服务如何与eureka服务器交互。</p><p id="d5f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要设置eureka服务器，我们需要创建一个Eureka微服务并添加其配置。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/c5ecb888a7e5c0370589d3e95858fbe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*4pyJ7s9VO6cupQS0u55yZA.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx translated">尤里卡服务</figcaption></figure><p id="e85a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加依赖项后，转到application.properties并添加此配置</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="d45a" class="lj jp hi lf b fi lk ll l lm ln">server.port:9102<br/><br/>spring.application.name=eureka-server<br/><br/>eureka.client.serviceUrl.defaultZone:http://localhost:9102/eureka/<br/><br/>eureka.client.registerWithEureka:false</span><span id="bdb7" class="lj jp hi lf b fi lo ll l lm ln">#set to false because we're not in cluster mode<br/>eureka.client.fetchRegistry:false<br/>#set to false because we're not in cluster mode</span></pre><p id="8a35" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启用Eureka服务器:</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="6c8a" class="lj jp hi lf b fi lk ll l lm ln">@SpringBootApplication<br/>@EnableEurekaServer<br/>public class EurekaServerApplication {<br/>   public static void main(String[] args) {<br/><br/>      SpringApplication.run(EurekaServerApplication.class, args);<br/><br/>   }<br/><br/>}</span></pre><p id="7901" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后去http: // localhost: 9102 /。然后你将进入一个页面，该页面提供了一定数量的关于你的尤里卡服务器的信息。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/f1aa98d58ab03d7d4dfff061f25f5065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*aLOC3QC2hkTQ93knDLK_PA.png"/></div></figure><p id="737b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，您将看到将要注册的微服务实例列表。</p><h1 id="45fa" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">尤里卡客户</h1><p id="6283" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">为了让不同的微服务开始在我们的Eureka服务器中注册，我们需要为每个微服务添加Eureka客户端。</p><p id="fcfe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到pom.xml并添加这个依赖项:</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="f767" class="lj jp hi lf b fi lk ll l lm ln"><strong class="lf hj">&lt;dependency&gt;</strong></span><span id="add6" class="lj jp hi lf b fi lo ll l lm ln"><strong class="lf hj">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</strong></span><span id="0776" class="lj jp hi lf b fi lo ll l lm ln"><strong class="lf hj">&lt;artifactId&gt;spring-cloud-starter-netflix-eureka-server&lt;/artifactId&gt;</strong></span><span id="70a9" class="lj jp hi lf b fi lo ll l lm ln"><strong class="lf hj">&lt;/dependency&gt;</strong></span></pre><p id="8bef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后是应用程序。属性:</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="6314" class="lj jp hi lf b fi lk ll l lm ln"><strong class="lf hj">eureka.client.serviceUrl.defaultZone: </strong><a class="ae lq" href="http://localhost:9102/eureka/" rel="noopener ugc nofollow" target="_blank"><strong class="lf hj">http://localhost:9102/eureka/</strong></a></span></pre><p id="9707" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这一行表示要注册的Eureka的URL。</p><p id="f3c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后转到每个微服务和注释@EnableDiscoveryClient:</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="7e99" class="lj jp hi lf b fi lk ll l lm ln">@SpringBootApplication<br/><br/>@EnableDiscoveryClient<br/><br/>public class ProductApplication {<br/><br/>    public static void main(String[] args) {<br/><br/>        SpringApplication.<em class="kr">run</em>(ProductApplication.class, args);<br/><br/>    }<br/><br/><br/><br/>}</span></pre><p id="2585" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的微服务现在受益于Eureka客户端，它将在每次启动时注册您的实例。</p><p id="8f24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动您的服务并转到http: // localhost: 9102</p><h1 id="2e4e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">与Feign </strong>交流您的微服务</h1><p id="fbe5" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">目前，两个微服务产品和订单以及一个客户端独立运行，并在Eureka上注册。但是如果我们需要其中一个和另一个交流呢。这就是为什么我们需要一种服务或协议来保证这一点。</p><p id="f8e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> Feign </strong>是一个HTTP客户端，它极大地方便了不同微服务所公开的API的调用。因此，它能够基于所提供的注释和信息创建和执行HTTP请求</p><p id="32cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的例子中，我们需要客户端微服务来与产品通信并订购微服务。</p><p id="0ced" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从在客户端微服务中向我们的<em class="kr"> pom.xml </em>添加Feign开始</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="bfee" class="lj jp hi lf b fi lk ll l lm ln">&lt;dependency&gt;</span><span id="c1aa" class="lj jp hi lf b fi lo ll l lm ln">&lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><span id="9c9a" class="lj jp hi lf b fi lo ll l lm ln">&lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><span id="b997" class="lj jp hi lf b fi lo ll l lm ln">&lt;/dependency&gt;</span></pre><p id="e5f3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了在这个微服务中激活Feign，请转到<em class="kr"> ClientUiApplication </em>并添加<strong class="is hj"><em class="kr">@ EnableFeignClients</em></strong>注释<strong class="is hj"> <em class="kr"> : </em> </strong></p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="0fc3" class="lj jp hi lf b fi lk ll l lm ln">@SpringBootApplication</span><span id="40a5" class="lj jp hi lf b fi lo ll l lm ln">@EnableFeignClients("com.ecommerce.clientui")</span><span id="5e45" class="lj jp hi lf b fi lo ll l lm ln">public class ClientUiApplication {</span><span id="e23b" class="lj jp hi lf b fi lo ll l lm ln">public static void main(String[] args) {</span><span id="7601" class="lj jp hi lf b fi lo ll l lm ln">SpringApplication.run(ClientUiApplication.class, args);</span><span id="8b39" class="lj jp hi lf b fi lo ll l lm ln">}</span><span id="2263" class="lj jp hi lf b fi lo ll l lm ln">}</span></pre><p id="2950" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注释<code class="du lr ls lt lf b">@EnableFeignClients</code>要求假装扫描<em class="kr">com。</em>电子商务<em class="kr">。clientui" </em>打包以查找声明自己为假扮客户端的类。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/15339520b088a059945c66b4c34e303a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kIaxLBrsqZqNVsECTuwWuw.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">FeignClient</figcaption></figure><p id="60a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然客户端mis将使用feign来检索产品列表，但是我们必须在客户端mis中创建一个类似于产品微服务中的产品类，以便存储对象:</p><p id="60ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在包DTO下创建一个类产品。</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="eb27" class="lj jp hi lf b fi lk ll l lm ln">@Data<br/>public class ProductDTO {<br/><br/>    private int id;<br/><br/>    private String titre;<br/><br/>    private String description;<br/><br/>    private String image;<br/><br/>    private Double prix;<br/>}</span></pre><p id="e618" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将创建一个<strong class="is hj">接口，它将把我们想要传递给ProductMicroservice <em class="kr">的请求</em></strong>组合在一起。这个接口就是我们所说的<strong class="is hj">代理，</strong>因为它被定位为一个中间类，使得与外部微服务的链接被调用。</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="f83c" class="lj jp hi lf b fi lk ll l lm ln">@FeignClient(name = "microservice-product", url = "localhost:9001")<br/>public interface ProductMicroserviceProxy{<br/><br/>    @GetMapping(value = "/Products")<br/>    List&lt;ProductDTO&gt; findAll();<br/><br/>    @GetMapping( value = "/products/{id}")<br/>    ProductDTO findById(@PathVariable("id") int id);<br/><br/><br/>}</span></pre><p id="da20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-Feign将使用所提供的信息发出适当的HTTP请求来调用ProductMicroservice <em class="kr">。</em></p><p id="f621" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kr"> - </em>第一个参数是将要调用的微服务的名称。此名称已在application.properties中设置</p><p id="918f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">-第二个参数是微服务的URL(localhost:9001)</p><p id="ba27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">剩下的就是使用这个代理。回到控制器:</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="7090" class="lj jp hi lf b fi lk ll l lm ln">@RestController<br/>@CrossOrigin("*")<br/>@RequestMapping("/client")<br/>public class ClientController {<br/><br/>    @Autowired<br/>    private ProductMicroserviceProxy ProductProxy;<br/><br/>   <br/>    @GetMapping("/products")<br/>    public List&lt;ProductDTO&gt; findAll(){<br/><br/>        List&lt;ProductDTO&gt; list=  ProducstsProxy.findAll();<br/>        return LIST;<br/><br/>    }<br/><br/>   <br/>    @GetMapping("/findById/{id}")<br/>    public ProductDTO findByd(@PathVariable int id){<br/><br/>        ProductBean prod = ProductsProxy.findById(id);<br/><br/>        return prod;<br/>    }</span></pre><p id="b079" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们简单介绍一下，到目前为止，我们已经创建了3个微服务(产品、订单和客户端),每个微服务都在Eureka服务器上注册，并与FeignClient通信。</p><p id="2be0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在取得了很大的进步，但是正如我们所看到的，我们仍然缺少一些东西。</p><h1 id="15ee" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak"> ZULL API网关</strong></h1><p id="4c58" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">ZUUL将成为我们应用程序的一个独特入口。例如，当客户端微服务想要调用其中一个微服务时，它将通过<strong class="is hj"> ZUUL </strong>。它将负责分派、修改和应用过滤器和规则到这些请求。</p><p id="57a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祖尔原生地与尤里卡合作。它检索Eureka中所有可用微服务的列表，并通过URL:localhost:9004/microservice-name公开它们。</p><p id="7c76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，要检索产品列表，只需调用:localhost:9004/microservice-Products/Products。</p><p id="5e3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以像直接调用微服务产品一样检索产品列表。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/5eab403925212af8c4110a3539544329.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WFW6okrMvd4UG5XiDXLZcg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx translated">祖尔语</figcaption></figure><p id="1852" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们必须创建另一个微服务(Zuul)并在eureka注册。</p><p id="fff9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将以下属性添加到zuul微服务属性中</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="4602" class="lj jp hi lf b fi lk ll l lm ln">server.port 9004<br/>#Eureka<br/>eureka.client.serviceUrl.defaultZone:http://localhost:9102/eureka/</span></pre><p id="c4a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">激活尤利卡和祖尔</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="cc2b" class="lj jp hi lf b fi lk ll l lm ln">@SpringBootApplication<br/>@EnableZuulProxy<br/>@EnableDiscoveryClient<br/>public class ZuulServerApplication {<br/><br/>   public static void main(String[] args) {<br/>      SpringApplication.run(ZuulServerApplication.class, args);<br/>   }<br/>}</span></pre><p id="9dc2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">启动zuul并验证Eureka您会在其他微服务中找到zuul微服务。</p><p id="3514" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了让我们的客户通过ZUUL，我们需要告诉虚拟代理联系ZUUL，而不是直接联系微服务。</p><p id="1d54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后用ZUUL替换目标微服务的名称</p><p id="833b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们把<em class="kr"> / </em>微服务产品<em class="kr"> /加在</em>全URIs前面。然后，Feign将通过URI“/微服务产品/产品”联系ZUUL。然后，当ZUUL从“微服务-产品”URL中提取相关微服务的名称时，它可以将请求重定向到所需的目的地。</p><pre class="kt ku kv kw fd le lf lg lh aw li bi"><span id="6294" class="lj jp hi lf b fi lk ll l lm ln">@FeignClient(name = "zuul-server")<br/>public interface ProductMicroserviceProxy{<br/><br/>    @GetMapping(value = "microservice-product/Products")<br/>    List&lt;ProductDTO&gt; findAll();<br/><br/>    @GetMapping( value = "microservice-product/products/{id}")<br/>    ProductDTO findById(@PathVariable("id") int id);<br/><br/><br/>}</span></pre><h1 id="2668" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="0c33" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这篇文章的第一部分已经介绍了我们如何创建一个微服务，在Eureka中注册它，与其他微服务通信，以及如何创建一个API网关。</p><p id="bfa1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<a class="ae lq" href="https://firas-messaoudi.medium.com/building-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-5ed9ca7dda36" rel="noopener">的下一部分</a>中，我们将了解如何使用Prometheus和Grafana监控我们的微服务。</p><p id="3afc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如所承诺的，这是本部分github资源库的链接</p><div class="lw lx ez fb ly lz"><a href="https://github.com/FirasMessaoudi/ecommerce" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">FirasMessaoudi/电子商务</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">在GitHub上创建一个帐户，为FirasMessaoudi/电子商务发展做出贡献。</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn io lz"/></div></div></a></div></div></div>    
</body>
</html>