<html>
<head>
<title>Navigating HTTP Status Codes for REST APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为REST APIs导航HTTP状态代码</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/navigating-http-status-codes-for-rest-apis-39f25fcd8cc6?source=collection_archive---------5-----------------------#2021-03-15">https://medium.com/nerd-for-tech/navigating-http-status-codes-for-rest-apis-39f25fcd8cc6?source=collection_archive---------5-----------------------#2021-03-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/99ced877ab410f090fa8c7524be85ce4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ce7_jv8XF1Jj2K-Yk5xJUg.jpeg"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">埃里克·麦克林在<a class="ae hv" rel="noopener ugc nofollow" target="_blank" href="/s/photos/404?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Unsplash </a>上的照片</figcaption></figure><div class=""/><p id="5681" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我喜欢身份代码。我总是觉得，如果我能开状态代码的玩笑，我将最终成为一名真正的API专家。虽然我最喜欢的状态代码肯定是418，但404在我心中有一个特殊的位置。在我之前的一家公司，404是我的员工号，当它出现在文件上时，我总是觉得很有趣。我半期望我的记录消失，没有人会注意到。对不起，乔伊没找到。</p><p id="8b89" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不过，找出某个情况下的正确状态代码并记住它们的所有含义可能有点棘手。类似于<a class="ae hv" rel="noopener" href="/dev-genius/common-http-method-problems-in-rest-apis-3a485db1d635"> HTTP方法</a>，在构建REST APIs时，HTTP状态代码通常会带来挑战。从表面上看，<a class="ae hv" href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes" rel="noopener ugc nofollow" target="_blank">的状态代码列表</a>似乎非常简单，只有当你开始深入研究它们时，才容易发现在很多情况下不清楚应该使用哪一个。多种代码有时似乎适用，而其他时候似乎没有什么是完全合适的。那么我们如何导航状态代码呢？我们如何选择哪一个适用于特定的场景？</p><p id="a1bf" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于所有这些，我将假设有某个客户端向服务器发送API调用，而服务器用一个状态代码进行响应。</p><h1 id="8a6a" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在4xx和5xx之间抉择</h1><p id="ae38" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">通常，4xx(400中的任何代码)是“客户端错误”，5xx(500中的任何代码)是“服务器错误”。棘手的是如何准确解读这一点。一般的经验法则是:如果请求失败是客户端的错(例如参数无效)，则返回4xx，如果是服务器的错，则返回5xx。另一种思考方式是，如果客户获得5xx，他们应该能够预期在未来进行完全相同的呼叫，并获得不同的响应。同时，如果客户端得到一个4xx，他们需要修改请求中的某些内容，如果他们想要得到的不是相同的4xx。</p><figure class="kx ky kz la fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kw"><img src="../Images/c6bc7b582aefaf87eff53c6a0b3cf9ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ud2T6QG9t-xA2XV0wmtVog.png"/></div></div></figure><p id="48e3" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于微服务架构，这开始变得棘手。如果您从一个下游服务得到一个错误，那么很容易忽略这个错误。但是，举个例子，我让客户端调用服务A，服务A调用服务B。如果服务B因为服务A损坏了对它的请求而返回4xx，这可能根本不是客户端的错，因此服务A应该向客户端返回5xx，而不是4xx。但是，如果服务B返回相同的4xx，因为客户端输入到原始请求中的数据无效，那么服务A应该返回4xx。理想情况下，对于第二种情况，服务A中应该有足够的数据验证，这样我们就可以在调用服务B之前返回一个错误。但是，很容易错过一些数据验证，所以在决定服务A应该返回什么时，仔细查看服务B的错误是很重要的。</p><h1 id="3d9e" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">在400、401、405、403和404之间做出决定</h1><p id="d65c" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">所有的4xx响应有时听起来都一样。为了让它们保持直线，我经历了下面的决策过程。</p><p id="dd0e" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果客户端发送了一个乱码请求，(无效的JSON，无效的URI格式，等等)，那么他们应该得到一个<strong class="ix hz"> 400 </strong>。</p><p id="f390" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果请求格式是有效的，但是他们没有提供有效的认证(过期或无效的API密钥)，那么他们应该得到一个<strong class="ix hz"> 401 </strong>。401意味着拥有这些凭证的客户端无法成功调用<em class="lb">任何</em>端点(需要认证)。</p><p id="f3f0" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果认证凭证是有效的，但是他们试图到达的端点不存在(我们不支持/unicorns)或者他们试图访问的特定id不存在(当他们调用/animals/456时，没有ID为456的动物)，那么他们应该得到一个<strong class="ix hz"> 404 </strong>。考虑404的另一种方式是，它表示无效的URI路径(即查询或#片段)。在一些授权错误的情况下，API也返回404是很常见的。404适用的授权情况是不允许客户端知道资源的存在。返回一个不同的错误代码，比如403，会告诉客户端他们刚刚尝试的id是有效的，如果他们不知道这个ID的存在，他们就不应该知道。因此，如果从客户端的角度来看，ID不存在，无论服务器或其他任何人可能会怎么想或知道什么，通常都会返回404。</p><p id="96ae" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果资源存在，并且调用者有权限查看有问题的资源，但是那个特定的HTTP方法还没有实现，他们应该得到一个<strong class="ix hz"> 405 </strong>。这是服务器允许客户端获取资源，但不允许发送到该资源的情况(例如)。</p><p id="5c49" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，如果一些用户可以访问该特定方法，而不是具有当前凭证的用户，那么我们应该返回一个<strong class="ix hz"> 403 </strong>。例如，如果我试图编辑一个我只能查看的资源，我应该得到一个403。403的其他例子是，如果我试图访问我的企业尚未购买的功能的端点，或者如果我使用的API密钥不在我调用的端点的范围内。403和401的最大区别是，对于401，我无法成功访问任何端点。有了403，我就不能访问这个特定的。</p><p id="af71" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们已经解决了所有这些问题，但是请求中的一些数据仍然无效。例如，我为一个枚举字段发送了一个无效选项，或者我传入了两个不能同时被接受的不同参数，那么我应该返回一个<strong class="ix hz"> 400 </strong>。</p><p id="b0f8" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们已经解决了所有这些问题，那么应该会返回另一个响应代码。</p><h1 id="5cca" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">404对204</h1><p id="1e45" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><strong class="ix hz"> 404 </strong>和<strong class="ix hz"> 204 </strong>可能会有点混乱，因为乍看起来，如果一个对象不存在，那么我可能会得到一个204(有效的调用，但那里什么也没有，因此是空体的成功)。但是，这应该不是204。204是为引用的资源存在，但作为响应返回资源没有意义的情况保留的。这可能是因为调用是一个成功的删除调用，所以响应<em class="lb">应该为空，因为资源不再存在(尽管资源在调用之前就存在，所以不是404 ),也可能是因为执行了标准CRUD之外的操作——就像在controller-resource的情况下，我们可能希望指示某个函数的成功执行，但实际上没有合适的响应主体或资源。</em></p><h1 id="e051" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">空列表:404还是200？</h1><p id="d63b" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">从表面上看，这听起来非常类似于404 vs 204的情况，但实际上略有不同。如果客户端调用GET /users/{userId}，则客户端将该特定的userId指定为URI的一部分。如果从客户端的角度来看这个用户Id不存在，那么客户端应该得到一个404(无效的URI)。然而。如果客户端调用GET /users？name=joy，那么客户端将请求一个包含所有名为joy的用户的列表。在这种情况下，URI/users确实存在并且有效。如果没有人的名字是joy，那么我们就把这个列表过滤掉，客户端应该会得到一个200的空列表。URI是有效的，但是客户端过滤掉了所有内容，所以返回一个空列表。</p><h1 id="0bd7" class="jt ju hy bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">400对422(和其他WebDAV代码)</h1><p id="a42f" class="pw-post-body-paragraph iv iw hy ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">这里的基本答案是，如果你没有实现一个<a class="ae hv" href="https://en.wikipedia.org/wiki/WebDAV" rel="noopener ugc nofollow" target="_blank"> WebDAV </a> API，你不应该返回任何WebDAV错误代码。有些情况下，WebDAV错误代码听起来可能比其他任何代码都更适用。然而，如果你不是WebDAV，返回这些通常被认为是不正确的。这同样适用于许多非官方的或服务特定的代码。如果您选择尝试实现其中的任何一个，只需知道您的客户端可能使用的任何标准响应处理程序都无法处理响应或者会错误地处理它。</p><p id="de0b" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是我最近遇到的棘手案例的总结，但我肯定我漏掉了一些。如果你还有其他难以破译的，请告诉我。此外，就像任何边缘有点灰色的东西一样，不同的团队和公司对其中一些东西的解释与我略有不同。这突出了一件事，我认为它比任何一件事情都更重要——你自己的API内部的一致性和你的API的清晰文档。在您自己的API中清楚地说明错误代码的含义是很重要的。更好的是，提供定制的错误消息和文档比获得任何给定的错误代码都要准确得多。</p></div><div class="ab cl lc ld gp le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="hb hc hd he hf"><p id="d985" class="pw-post-body-paragraph iv iw hy ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要进一步阅读REST APIs，请查看我在<a class="ae hv" rel="noopener" href="/dev-genius/common-http-method-problems-in-rest-apis-3a485db1d635"> HTTP方法</a>上的帖子。</p></div></div>    
</body>
</html>