<html>
<head>
<title>How to store an image to a database with React using Base 64.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Base 64将图像存储到数据库中？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-store-an-image-to-a-database-with-react-using-base-64-9d53147f6c4f?source=collection_archive---------0-----------------------#2021-05-12">https://medium.com/nerd-for-tech/how-to-store-an-image-to-a-database-with-react-using-base-64-9d53147f6c4f?source=collection_archive---------0-----------------------#2021-05-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d7c7" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">使用base64编码和解码图像的最简单指南。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/43305f6daf207b9e94508e85b81f15ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EJovOyEX1hSv7fJS5ckFNA.jpeg"/></div></div></figure><h1 id="88ef" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated"><strong class="ak">简介</strong></h1><p id="6b8b" class="pw-post-body-paragraph kb kc hi kd b ke kf ij kg kh ki im kj kk kl km kn ko kp kq kr ks kt ku kv kw hb bi translated">向前端应用程序添加图像时，通常只需输入该图像的URL，或者创建一个本地目录，从中可以添加应用程序要使用的任何图像。但是如果你正在创建一个要求用户上传自己照片的应用程序呢？这需要一种不同的方法来解决这一挑战。<br/>许多可用的教程专注于在服务器端使用multer或cloudinary将图像存储到数据库，但本文将教你如何使用base64实现相同的目标。</p><p id="08dd" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><strong class="kd hj">Base64是什么？</strong></p><p id="dae5" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><em class="lc"> Base64也称为Base64 Content-Transfer-Encoding，是一种编码和解码技术，用于将二进制数据转换为美国信息交换标准(ASCII)文本格式，反之亦然。——</em><a class="ae ld" href="https://www.techopedia.com/definition/27209/base64" rel="noopener ugc nofollow" target="_blank"><strong class="kd hj"><em class="lc"/></strong></a></p><p id="d12e" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">任何二进制数据(比如本例中的图像)都可以用base64编码，编码后的数据通常由64个不可读的英文字符组成。当使用base64将图像存储到数据库(如MongoDB)时，图像将作为字符串存储在数据库中。需要时，可以将该字符串解码回其原始形式。</p><p id="4ac4" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><strong class="kd hj">创建您的服务器</strong></p><p id="346c" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">由于我们的应用程序有前端和后端分离，我们将从创建我们的服务器开始。首先，我们将使用下面的命令创建一个名为服务器的目录。</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="5bee" class="lj jk hi lf b fi lk ll l lm ln">mkdir server<br/>cd server</span></pre><p id="32e6" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">接下来，我们将使用下面的命令初始化项目。该命令将<strong class="kd hj"> package.json </strong>集成到您的应用程序中。json帮助跟踪我们所有的包和依赖项。</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="5ee5" class="lj jk hi lf b fi lk ll l lm ln">npm init -y</span></pre><p id="376a" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">接下来，我们将安装所有必要的依赖项。我们将使用下面的代码在一行中安装它们；</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="de37" class="lj jk hi lf b fi lk ll l lm ln">npm i express mongoose cors </span></pre><ul class=""><li id="d5b1" class="lo lp hi kd b ke kx kh ky kk lq ko lr ks ls kw lt lu lv lw bi translated">Cors:这是“跨源资源共享”的简称，用于保护一个web服务器不被另一个网站访问。</li><li id="aa2f" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">Express:这是一个node.js框架，有助于快速创建基于节点的应用程序。</li><li id="88ab" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">Mongoose:这是一个对象数据建模(ODM)库，使得对MongoDB的访问、通信和利用更加容易。</li></ul><p id="82ab" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">在服务器中，我们需要创建另一个目录来存放模型和模式。</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="a4d4" class="lj jk hi lf b fi lk ll l lm ln">mkdir models<br/>touch models/post.js</span></pre><p id="72a2" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">我们的模式将如下所示:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="6b57" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">您会注意到我在模式中只创建了一个对象键，即<strong class="kd hj"> myFile </strong>。这个键有一个值为<strong class="kd hj">的字符串</strong>，它将保存来自图像的编码数据。<br/>接下来，我们将在服务器目录中创建一个名为“index.js”的文件，它将存放我们剩余的代码。</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="7a96" class="lj jk hi lf b fi lk ll l lm ln">touch index.js</span></pre><p id="85e4" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">我们的index.js文件将包含以下内容:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="225e" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">至此，我们已经完成了服务器的工作。因此，我们将使用下面的命令启动我们的服务器:</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="eb70" class="lj jk hi lf b fi lk ll l lm ln">node index.js</span></pre><p id="76f7" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><strong class="kd hj">创建我们的React应用</strong></p><p id="04ed" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">现在是时候进入我们应用程序的客户端了。我们将首先创建一个react应用程序，并将其更改为应用程序目录。之后，我们将创建一个名为“components”的新目录，然后创建一个名为“ImageUploader”的jsx文件。</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="a0e6" class="lj jk hi lf b fi lk ll l lm ln">npx create-react-app client<br/>cd client<br/>mkdir components<br/>touch components/ImageUploader.jsx</span></pre><p id="d00c" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">我们需要的唯一依赖项是<strong class="kd hj"> axios </strong>，它是一个基于promise的HTTP客户端，用于发出HTTP请求。可以使用以下命令安装它；</p><pre class="iy iz ja jb fd le lf lg lh aw li bi"><span id="a5c1" class="lj jk hi lf b fi lk ll l lm ln">npm i axios</span></pre><p id="1501" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">在ImageUploader.jsx文件中，将添加以下代码行:</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mc md l"/></div></figure><p id="bc21" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">上面的代码看起来很像一个函数的蜂巢，分解如下:</p><ul class=""><li id="8f61" class="lo lp hi kd b ke kx kh ky kk lq ko lr ks ls kw lt lu lv lw bi translated">createImage函数使用axios通过服务器向数据库发送数据。</li><li id="bc92" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">createPost函数异步创建一个新图像或返回一个错误，这取决于服务器中声明的参数。</li><li id="b90c" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">convertToBase64函数使用JavaScript FileReader，它有一个readAsDataURL方法，<strong class="kd hj"> </strong>读取二进制数据并将其编码为Base64数据URL。顾名思义，它的工作就是将文件转换成base64。</li><li id="a6c0" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">handleFileUpload函数以要上传的文件为目标，该文件由convertToBase64函数异步转换为base64。然后，编码数据用于更新后图像状态。</li><li id="1e5b" class="lo lp hi kd b ke lx kh ly kk lz ko ma ks mb kw lt lu lv lw bi translated">然后，当单击Submit按钮时，handleSubmit函数将编码后的数据作为字符串提交给数据库。</li></ul><p id="9c19" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">我们的应用程序的客户端可以通过在终端中使用<strong class="kd hj"> npm start </strong>命令来启动。一旦客户端和服务器端并发运行，您可以上传任何图像，它将被保存在数据库中。为了清楚起见，我上传了一张图片，通过MongoDB Compass，我们可以访问如下所示的数据:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es me"><img src="../Images/6e324022bde82b5a8b0e065dbe6fcae8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_glsErJIcN1j0WmgEaJbQ.png"/></div></div></figure><p id="0c83" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">从上面的图像中，您可以看到上传的图像被存储为一个字符串。必要时，可以对该字符串进行解码和利用。</p><p id="98bc" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated"><strong class="kd hj">结论</strong></p><p id="6fc7" class="pw-post-body-paragraph kb kc hi kd b ke kx ij kg kh ky im kj kk kz km kn ko la kq kr ks lb ku kv kw hb bi translated">如果你已经做到了这一步，那么恭喜你。您已经成功地学习了如何使用base64在数据库中存储图像。如果你喜欢这个教程，请和我击掌。如需评论、投稿或提问，请在Twitter上关注我。谢谢。</p></div></div>    
</body>
</html>