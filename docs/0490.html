<html>
<head>
<title>TRANSACTIONS, SAVE POINTS AND LOCKS IN SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 中的事务、保存点和锁</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/transactions-save-points-and-lock-in-sql-bb438b6e8787?source=collection_archive---------2-----------------------#2020-12-30">https://medium.com/nerd-for-tech/transactions-save-points-and-lock-in-sql-bb438b6e8787?source=collection_archive---------2-----------------------#2020-12-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8a76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">________________________________________________________________</p><p id="5eb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">酸:</strong>原子量一致性隔离耐久性</p><p id="2dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">原子性:</strong>要么完成事务，要么在出现任何问题的情况下，回滚整个事务。</p><p id="bf91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">一致性:</strong>完成交易前后总金额必须相等。</p><p id="496d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a 交易到 B 1000/-,如果假设。</p><p id="3476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">A = 2000/-</p><p id="95a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一步是读取 A，看它是否有足够的交易金额。如果它实现了，那么用 ALU 数学上 1000/-将被减去，并且值将被存储在 RAM 中。</p><p id="97d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">B=3000/-以 b 为单位的当前数量(本地存储器)</p><p id="c350" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在完整的数据将从本地存储器转移到主存储器。</p><p id="da13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在 A= 1000/-(借记 1000/-和 B=4000/-(贷记 1000/-这意味着总额是 5000/-正如我们所预料的。这是完整的交易。</p><p id="aea6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">隔离:</strong>不允许并行事务。简而言之，并行计划被转换为串行计划。那么事务现在<strong class="ih hj">一致</strong>。</p><p id="5573" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">持久性:</strong>数据库中的每一个变化都应该永久保存在硬盘中。和前面一样，如果事务完成，数据集中的更改必须是永久的。</p><p id="6041" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对他人的交易，一个简单的代码:</strong></p><p id="92e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置 SQL _ SAFE _ UPDATES = 0；</p><p id="14b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="fcee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">UPDATE account _ details SET balance = balance—1000 其中 FIRST _ name = ' MONICA</p><p id="f15e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">UPDATE account _ details SET balance = balance+1000 其中 FIRST _ name = ' JOSEPH</p><p id="1482" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="abde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">1000/——从莫妮卡账户转到约瑟夫账户。</strong></p><p id="02b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="65c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查银行余额:</p><p id="6e79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT Balance _ amount FROM BANK _ ACCOUNT WHERE ACCOUNT _ Number = ' 4000–1956–2001 '；</p><p id="431d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从 ATM 机取款:</p><p id="b4af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">插入到 BANK_ACCOUNT_Transaction 值(' 4000–1956–2001 '，-2300.00，' ATM 取款'，' CA '，NOW())；</p><p id="c1a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 BANK _ Account SET balance _ amount = balance _ amount-2300，其中 Account _ Number = ' 4000–1956–2001 '；</p><p id="eceb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">银行对取款收取 0.2%的费用:</p><p id="3dad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">插入到 BANK_ACCOUNT_Transaction 值(' 4000–1956–2001 '，-2300.00 * 0.02，' ATM 取款'，' CA '，NOW())；</p><p id="99f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用新余额更新旧余额:</p><p id="04fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 BANK _ ACCOUNT SET balance _ amount = balance _ amount-2300 * 0.02，其中 ACCOUNT _ Number = ' 4000–1956–2001 '；</p><p id="0ac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="74c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">保存点:</strong></p><p id="23b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初的表格是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/a857adbeb8235a0239a8fba1f31e011a.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*8lZxIyyEBoa1hpsVW9d_zg.png"/></div></figure><p id="8c1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置 SQL _ SAFE _ UPDATES = 0；</p><p id="6144" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="4e1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 1；</p><p id="fb6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从银行客户中删除，其中客户标识= 123004；</p><p id="b149" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 2；</p><p id="1008" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从银行客户中删除，其中客户标识= 123001；</p><p id="19bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 3；</p><p id="50ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从银行客户中删除，其中客户标识= 123002；</p><p id="c509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 customer _ 2；</p><p id="cfc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="34e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点之后，该表如下所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jl"><img src="../Images/afeab0fe81cc280a668861ab039a2abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*Z-SfMFS5S3qwnrjwoQjNxQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">123004 删除。</figcaption></figure><p id="c5ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除保存点:</p><p id="a552" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最初，这张桌子是这样的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jq"><img src="../Images/e6d30606670d6140de3bb5560f5bcea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*6PKSlFoygIyzxGD9DNKAUA.png"/></div></figure><p id="ba7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="690c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 1；</p><p id="123b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除</p><p id="2b4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自银行 _ 客户</p><p id="df05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 CUSTomer _ ID = 123001</p><p id="4b6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 2；</p><p id="1be6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除</p><p id="a50f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自银行 _ 客户</p><p id="6f7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 CUSTomer _ ID = 123002</p><p id="67fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 3；</p><p id="4797" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除</p><p id="6173" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自银行 _ 客户</p><p id="baa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Customer _ Id = 123007</p><p id="dd17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">保存点 customer _ 4；</p><p id="a2fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除</p><p id="0bee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">来自银行 _ 客户</p><p id="e3f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Customer _ Id = 123008</p><p id="a809" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">释放保存点 customer _ 3；</p><p id="0a69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">角色返回前的输出:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jr"><img src="../Images/4f7743a24b615ba36eafe1a69a11c7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*zWFjrWv_JTx9byfRDWR0WQ.png"/></div></figure><p id="5ea5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 customer _ 2；</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es js"><img src="../Images/9bbafb72969f7dc0d2338caa8f1603c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*UH5eyWg0Qv4ezt2LMfnimg.png"/></div></figure><p id="5cec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚后，我们希望保存 customer_3 的数据，除此之外将是安全的。但在此之前，所有交易都被删除了。因此，如果我们想要回滚被删除的内容，只会给出输出，而不是每个语法都会给出一个错误。</p><p id="a455" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 customer _ 4；<strong class="ih hj"> <em class="jt">错误</em> </strong></p><p id="184f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 customer _ 3；<strong class="ih hj"> <em class="jt">错误</em> </strong></p><p id="9684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 customer _ 2；<strong class="ih hj"> <em class="jt">执行</em> </strong></p><p id="db61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们发布了保存点 customer_3，这意味着在 customer_3 之前，所有(保存点中提到的)数据都已被删除。如果我们想回忆起来，我们必须使用那个被删除的保存点上唯一的回滚。</p><p id="3c20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 Customer _ 1；</p><p id="d38a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回滚到 Customer _ 2；</p><p id="b3c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">以上两项均已删除，因此他们中的任何人都可以回忆起我们已删除的数据。</strong></p><p id="e56e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">回滚到客户 _1 </strong>将保护<strong class="ih hj">客户 _1 </strong>以及<strong class="ih hj">客户 _2 </strong>，其中<strong class="ih hj">回滚到客户 _ 2</strong>将仅保护<strong class="ih hj">客户 _2 </strong>。</p><p id="7703" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">更新为已读:</strong></p><p id="4f6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置交易读写</strong>；</p><p id="da7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新银行账户</p><p id="ed06" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SET balance _ amount = balance _ amount-2300</p><p id="b94e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Account _ Number = ' 4000–1956–2001 '；</p><p id="5bc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将更新该特定帐户中的当前金额。</p><p id="eb53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">设置交易只读</strong>；</p><p id="ab1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将只允许读取事务，我们不能向数据集中写入任何内容。</p><p id="a46d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">会话交易:</strong></p><p id="b744" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置会话事务读写；</p><p id="4ac4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在读写模式下:</p><p id="af25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="ddea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将会话事务设置为只读；<strong class="ih hj"> <em class="jt">从下一笔交易开始生效</em> </strong></p><p id="6fd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新银行账户</p><p id="d22e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置</p><p id="8e95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">balance _ amount = balance _ amount-2300</p><p id="c59b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Account _ Number = ' 4000–1956–2001 '；</p><p id="d27e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只有一个事务将被写入会话，其余的将只遵循另一个读取条件。</p><p id="67a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">隔离读写:</strong></p><p id="338f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这使一个事务保持等待状态，直到它没有完成同一帐户的另一个事务是不允许的。以下几种隔离转换:</p><p id="4430" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可重复读</p><p id="6f78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">已提交读取</p><p id="65ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可序列化</p><p id="cac4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="1d07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">可重复读取</strong></p><p id="abfd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置会话事务读写；</p><p id="841b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置事务隔离级别可重复读取；</p><p id="1ca4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如下所示，多个事务在一次提交中是可读的:</p><p id="d777" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT Balance _ amount FROM bank _ ACCOUNT WHERE ACCOUNT _ Number = ' 4000–1956–2001 '；</p><p id="63f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT Balance _ amount FROM bank _ ACCOUNT WHERE ACCOUNT _ Number = ' 4000–1956–3456 '；</p><p id="88cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果写更新在一个平台上以不同的方式进行，那么另一个事务就不可能在同一个实例上进行。</p><p id="1522" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ ACCOUNT SET balance _ amount = balance _ amount+2300，其中 ACCOUNT _ Number = ' 5000–1700–6091 '；</p><p id="57b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果尚未提交；</p><p id="b0eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ ACCOUNT SET balance _ amount = balance _ amount+2300，其中 ACCOUNT _ Number = ' 4000–1956–5102 '；</p><p id="d2d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将一直等待，直到我们不提交之前的事务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ju"><img src="../Images/2d33f87c69a25928549c16dfedffa1ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*Km-ZWOZl6tEy0EvCcGPZ5A.png"/></div></figure><p id="c522" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只要我们提交上一个事务，这个事务就会自动完成。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es jv"><img src="../Images/3455eee32f22e1f01b56b7b60ad923d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*Z0K5ggAJwbMY8RwIlLv2tA.png"/></div></div></figure><p id="89b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">读取已提交的</strong></p><p id="39c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这与前一个相同，<strong class="ih hj"> REPEATABLE READ </strong>，因为它一次只允许一个事务，但肯定表是完全锁定的，我们可以将数据插入数据库。这里，这两种操作在两个平台上都是允许的，不需要回滚或提交。但是在前面的<strong class="ih hj">可重复读取中，</strong>在两个平台上只允许一个操作。这是两种情况下最简单的区别。</p><p id="76da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ ACCOUNT SET balance _ amount = balance _ amount+2300，其中 ACCOUNT _ Number = ' 5000–1700–6091 '；</p><p id="54f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">插入到 bank_ACCOUNT 值(123002，' 4000–1956–9999 '，'储蓄'，69000，'活动'，' P ')；</p><p id="575b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最重要的一点:</strong>这里只允许使用 insert 进行更新，因为表当前是锁定的。我们不能在两个平台上同时更新。</p><p id="981e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在数据库管理系统中锁定:</strong></p><p id="7c9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库à表à页à行(这些可以为 DML 进程锁定。为了保持数据完整性和酸性)</p><p id="bb92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">共享/读锁:</strong>这是可以提供给多个用户读取的事务。</p><p id="7405" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">独占/写锁:</strong>这是用来写事务的锁，只有一个用户可以访问，这根本不是共享模式。我们不能向多个用户提供此服务。如果初始共享锁定模式对任何事务都是激活的，默认情况下，如果我们使用 UPDATE 函数，就会激活排他锁。</p><p id="69cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果有任何事务以独占锁处于活动状态，则任何其他事务都不能获取任何类型的锁，除非它没有被提交。</p><p id="4b78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="5489" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT * FROM 银行账户</p><p id="20d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Account _ Number = ' 4000–1956–2001 '</p><p id="3210" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在共享模式下锁定；</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ka"><img src="../Images/e98b67148d01cd0321330c4dc14f5140.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*AroJhL3KhFno6UIJJOoTOQ.png"/></div></figure><p id="abc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在另一个实例中，类似的事务读取是可能的。比如多个用户可以读取事务。如果共享锁被提升为独占锁，则只允许一方事务。这个锁不会被完成，除非并且直到提交没有被排序，仍然有另一个事务不能占用任何锁。它必须等到提交。</p><p id="3d3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置 SQL _ SAFE _ UPDATES = 0；</p><p id="0715" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新银行账户</p><p id="4acf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置余额 _ 金额=余额 _ 金额+ 0.04 *余额 _ 金额</p><p id="6df9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中 Account _ Number = ' 4000–1956–2001 '；<strong class="ih hj"> <em class="jt">执行</em> </strong></p><p id="8122" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是在另一个平台上，读事务处于等待状态，直到上面的写进程没有提交。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kb"><img src="../Images/e0db2747d117971e3f190f24bba4bf62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*eLvbHgAI_YSqNYVDy_KGew.png"/></div></figure><p id="3956" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如何为更新应用独占锁？</strong></p><p id="b175" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="6844" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT * FROM bank _ customer WHERE customer _ id = 123002 进行更新；</p><p id="ce57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ customer SET Address = ' 2999 New Brighton ' WHERE customer _ id = 123002；</p><p id="31fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="c829" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">如果您不想允许任何来源使用该表，该怎么办？我们来看看题型。</strong></p><p id="26f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编写一个查询来确保没有其他 MySQL 会话能够插入任何用户 id 或密码</p><p id="6d68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">锁表 id _ 密码写；</p><p id="e14a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此时，不会执行任何操作。要重新使用桌子，只需发出解锁桌子的命令。</p><p id="1333" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要一些锁定表上的 DML:</p><p id="e3fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ customer SET Address = ' 2999 New Brighton ' WHERE customer _ id = 123002；</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kc"><img src="../Images/e3b0d2e35c3ba148cc01428964482476.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*9ZBt7xF7SO2MsDt5Vxxetw.png"/></div></figure><p id="a602" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们即将面临的错误。现在要解除锁定:</p><p id="a06d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解锁表格；</p><p id="f51d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">你现在在一个简单的条件下申请锁。</strong></p><p id="92e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">死锁:不工作也不让其他人工作是一种固执或自我。</p><p id="6644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">互斥:</strong>事务的来源必须一次对一个进程有效。所有交易都应该持续进行。</p><p id="1782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">无抢占:</strong>如果一个事务正在处理，不要允许另一个事务处理，直到前一个事务没有得到提交。</p><p id="4a63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">暂停并等待:</strong>暂停一个流程，直到它没有完成，然后等待另一个流程。</p><p id="5720" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">循环等待:</strong>如果一个流程 P1 尚未完成并等待另一个来源 S1，同时另一个流程 P2 尚未完成并等待来源 S1，那么任何一个事务都不会发生。因此，这是一个循环等待。</p><p id="8c53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，通过查看 4 个条件，我们可以假装我们是否正遭受<strong class="ih hj">死锁</strong>情况。为了避免这种情况，我们必须至少完成一个事务，以允许另一个进程进入下一个进程。您可以回滚或提交任何一个进程。这是唯一的解决办法。</p><p id="2898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">死锁的典型例子:</p><p id="1225" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编写一个查询，以便用户可以对 bank_customer 中的同一个 customer_id = 123002 执行并发 DML 操作。</p><p id="7e69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个用户使用“2999 New Brighton”更新 customer_id 的住宅地址</p><p id="6c6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个用户使用 189891899 更新电话号码。</p><p id="8af8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方案:</p><p id="cbc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第 1 节:</strong></p><p id="a4f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开始交易；</p><p id="fe05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SELECT * FROM bank _ customer WHERE customer _ id = 123002 进行更新；</p><p id="fc68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ customer SET Address = ' 2999 New Brighton ' WHERE customer _ id = 123002；</p><p id="58e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="b426" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二场会议:</strong></p><p id="ccb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新 bank _ customer SET phone = 189891899 其中 customer _ id = 123002</p><p id="df82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">提交；</p><p id="af55" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们同时激活上述两个事务，就会发生死锁，这使得任何事务(流程)都无法完成。因此，第一次提交完成了第一个事务，然后第二个进程非常准确地完成。如果事务中的任何地方超时，任何一个事务都会自动中止，因为编译器认为可能会出现死锁的情况。</p><p id="cfc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> FOR UPDATE 只是一个独占锁的演示。</strong></p></div></div>    
</body>
</html>