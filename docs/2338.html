<html>
<head>
<title>Android CI/CD with GitLab — Slack bot that can build Apks on the fly.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有 GitLab 的 Android CI/CD——可以动态构建 apk 的 Slack bot。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/android-ci-cd-with-gitlab-slack-bot-that-can-build-apks-on-the-fly-a877e26307db?source=collection_archive---------5-----------------------#2021-05-02">https://medium.com/nerd-for-tech/android-ci-cd-with-gitlab-slack-bot-that-can-build-apks-on-the-fly-a877e26307db?source=collection_archive---------5-----------------------#2021-05-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fb56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最近意识到，我们工作场所的大多数工程师都陷入了构建 apk 并将其交给 Slack 上的 QA 团队的循环中。我们每次所做的就是，从我们正在工作的特性分支手动构建 Apk，并将其上传到 Slack 供 QA 团队测试。如果在此期间或之后出现任何变化，循环将再次继续。你说对了！所以，当你能让它自动化的时候，为什么要手动去做呢？🤷‍♂️</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0d8e9fc6eeb987ec4f63b542f2b086f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r-YCy6is_BXIjwC14Ah9Hg.jpeg"/></div></div></figure><p id="2e5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，让我们使用 GitLab CI 的强大功能，并将其与 Slack API 结合起来，构建一个 bot，它将为您提供我们的回购上所有可用分支的列表，在 select 上，将构建相应的回购，并将 Apk 上传到 Slack。</p><h1 id="8764" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">目标</h1><ol class=""><li id="c852" class="kn ko hi ih b ii kp im kq iq kr iu ks iy kt jc ku kv kw kx bi translated">交互式 Slack-bot 显示回购上所有可用的分支。(我们将使用 Slack API 中的<a class="ae ky" href="https://api.slack.com/legacy/message-menus" rel="noopener ugc nofollow" target="_blank">消息菜单</a></li><li id="f96f" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">设置一个 GitLab 配置项，该配置项具有一个仅在我们的 Slack-bot 触发<a class="ae ky" href="https://docs.gitlab.com/ee/ci/triggers/" rel="noopener ugc nofollow" target="_blank">时运行的作业。</a></li><li id="c181" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">为 slack 上的所选 repo 在 CI 上自动构建应用程序变体，并将其上传回 slack。</li><li id="8ee2" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">此外，让我们再添加一些功能，如检查 CI 作业状态的选项。提供如何使用 bot 的说明的 Help 命令。(我们将使用 Slack API 中的<a class="ae ky" href="https://api.slack.com/interactivity/slash-commands" rel="noopener ugc nofollow" target="_blank">斜线命令</a>)。</li><li id="fa16" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">最后，让我们确保当 Apk 构建成功完成时，会 pinged 请求 Apk 的特定用户。</li></ol><h1 id="fe07" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="4911" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">如果你对深入研究代码感兴趣。下面是剧透。你也可以直接到底部去检查最终的功能。</p><div class="lh li ez fb lj lk"><a href="https://github.com/NitishGadangi/apk-dispatcher-slack-bot" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">NitishGadangi/apk-调度员-松弛-机器人</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">🤖Slack Bot 使用 GitlabCI 的能力来构建并从 Gitlab 为您指定的分支提供 APKs</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">github.com</p></div></div><div class="lt l"><div class="lu l lv lw lx lt ly jn lk"/></div></div></a></div><h1 id="a179" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">所需成分</h1><ol class=""><li id="21e1" class="kn ko hi ih b ii kp im kq iq kr iu ks iy kt jc ku kv kw kx bi translated">为此，我们需要一个 CI/CD 实例。幸运的是，GitLab 有一个简单且免费的 CI/CD 系统，可以在私有存储库中找到。</li><li id="0c24" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">您必须拥有创建新 Slack 应用程序并在您的工作区中启动它的权限。</li><li id="8afd" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">因为我们将对 Slack-bot 使用 Slash 命令，所以我们需要一个 HTTP 实例来响应来自 Slack 的调用。(我们将使用一个部署在 Heroku 上的简单 Node.js 应用程序)</li><li id="77ce" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">显然，我对 CI/CD 的工作原理有一些基本的了解，对 Node 也有一些了解。</li></ol><h1 id="17e9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">让我们开始做饭吧…</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/f909a391dd021ebc1dbe38b6a773ce05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uoIFZUYSi680yq4-BQBmA.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">实施流程</figcaption></figure><h2 id="6f00" class="me jq hi bd jr mf mg mh jv mi mj mk jz iq ml mm kd iu mn mo kh iy mp mq kl mr bi translated">GitLab 设置</h2><p id="571d" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">您需要将 CI/CD 配置文件添加到 GitLab repo 中。这可以通过将<code class="du ms mt mu mv b"><strong class="ih hj">.gitlab-ci.yml</strong></code> <strong class="ih hj"> </strong>文件添加到 Android 项目根目录来完成。如需更详细的演练，您可以在这里浏览文档<a class="ae ky" href="https://gitlab.com/help/ci/quick_start/README" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/466c59998e4aaf69bb609316bc10c73d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VbZsz12NQkBYrYZjqHe_EQ.png"/></div></div></figure><p id="57d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CI 配置 yml 文件基本包含运行 CI 管道所需的所有指令。对于环境设置，我们可以运行标准的 Android SDK 实例。但是，我们可以使用为 Android 预配置的<a class="ae ky" href="https://github.com/jangrewe/gitlab-ci-android" rel="noopener ugc nofollow" target="_blank"> Jangrewe </a>的<a class="ae ky" href="https://docs.docker.com/get-started/part2" rel="noopener ugc nofollow" target="_blank"> Docker 图像</a>。稍后我们需要添加剩余的指令来帮助构建 Apk 并上传到 slack。这是它最终的样子。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mx my l"/></div><figcaption class="ma mb et er es mc md bd b be z dx translated">CI 配置 YML 文件</figcaption></figure><p id="0d9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在继续之前，让我们看看上面的配置文件，了解关键字及其用法:</p><ol class=""><li id="cb40" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">image: </strong></code>该标签用于指定一个用于执行的 Docker 图像。Gitlab 运行程序将使用这个 Docker 映像来运行管道。</li><li id="c413" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">cache: </strong></code>在生成多个构建时，缓存 gradle 文件夹可以显著减少构建时间。缓存将在开始时下载和提取，并在每个作业结束时上传。<code class="du ms mt mu mv b">${CI_PROJECT_ID}</code>是 Gitlab 中唯一的项目 ID。</li></ol><p id="28e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们定义一个<strong class="ih hj">作业</strong>来构建一个调试 APK，其内容解释如下。</p><ol class=""><li id="bc9f" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">stages: </strong></code>这表示工作属于哪个阶段。</li><li id="725a" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">before_script: </strong></code>这用于在实际工作开始前设置材料。在我们的例子中，我们设置<code class="du ms mt mu mv b">GRADLE_USER_HOME</code>来避免使用 gradle 的完整路径，并使 gradlew 可执行。</li><li id="c84a" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">rules: </strong></code>在这里，我们可以定义各种条件，使得作业仅在基于这些指定的<a class="ae ky" href="https://docs.gitlab.com/ee/ci/yaml/#rules" rel="noopener ugc nofollow" target="_blank">规则</a>时运行。由于我们需要我们的作业仅在手动触发时运行，我们添加了一个 if 条件，指定<code class="du ms mt mu mv b">$CI_PIPELINE_SOURCE</code>必须是一个<a class="ae ky" href="https://docs.gitlab.com/ee/ci/triggers/" rel="noopener ugc nofollow" target="_blank">触发器</a>。</li><li id="64f8" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">script: </strong></code>git lab 运行程序执行的 shell 脚本。这是作业运行的唯一强制关键字。</li></ol><ul class=""><li id="145d" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc nc kv kw kx bi translated">首先，我们运行命令来组装调试版本</li><li id="3b47" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc nc kv kw kx bi translated">在构建生成之后，我们使用<strong class="ih hj"> curl，</strong>一个命令行工具来传输数据。</li><li id="1072" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc nc kv kw kx bi translated">此外，<code class="du ms mt mu mv b">${SLACK_CHANNEL_ID}</code>和<code class="du ms mt mu mv b">${SLACK_REFERRER_ID}</code>用于表示用户触发管道的通道和相应的用户 id，用于表示用户发出通知。这两个变量将由我们的 Node.js 应用程序发送，而 node . js 应用程序又由 Slack-bot 触发。</li><li id="1785" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc nc kv kw kx bi translated">类似地，我们也使用了<code class="du ms mt mu mv b">${CI_COMMIT_REF_NAME}</code>和<code class="du ms mt mu mv b">${CI_PIPELINE_ID}</code>以及 Apk 向消息中添加更多信息。</li><li id="ef16" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc nc kv kw kx bi translated">最后对于文件上传，Slack 定义了一个非常易用的 API<a class="ae ky" href="https://api.slack.com/methods/files.upload" rel="noopener ugc nofollow" target="_blank"/>。放置生成的 APK 的文件名(例如<em class="nd"> app-debug.apk </em>)。如果您的 gradle 根据构建版本/类型生成不同的构建名称，那么使用 find 命令和文件的初始字符，如上所示。</li></ul><p id="9cf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Node.js App 设置</strong></p><p id="4b3f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于我们将为 slack bot 使用<a class="ae ky" href="https://api.slack.com/interactivity/slash-commands" rel="noopener ugc nofollow" target="_blank">斜杠命令</a>，我们需要一个服务器应用程序来响应来自 slack-api 的请求。我想让事情尽可能简短。开始了。</p><ol class=""><li id="dfdf" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc ku kv kw kx bi translated">克隆这个回购协议(<a class="ae ky" href="https://github.com/NitishGadangi/apk-dispatcher-slack-bot" rel="noopener ugc nofollow" target="_blank">apk-dispatcher-slack-bot</a></li><li id="dc10" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">在这里，我们可以看到我们将拥有基本路由<code class="du ms mt mu mv b">/android</code>，在此基础上还有 4 个 post 路由器可用。</li></ol><ul class=""><li id="b6a3" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc nc kv kw kx bi translated"><code class="du ms mt mu mv b">/android/actions</code>用作 slack 中交互操作的请求 URL。任何交互交互组件(如按钮、选择菜单和日期选择器)都将被发送到这个端点。</li><li id="3b8e" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc nc kv kw kx bi translated"><code class="du ms mt mu mv b">/android/get_apk</code>、<code class="du ms mt mu mv b">/android/help</code>、<code class="du ms mt mu mv b">/android/get_status</code>由 slash 命令触发，每个命令都会做相应的动作，并将响应回传给 slack-api。</li></ul><p id="631a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要通过将环境变量放入。env 文件或放置在配置变量中(如果您使用 heroku)。我们稍后将回到这一部分，因为现在您可以直接部署项目。</p><p id="c777" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也就是说，您可以随时查看完整的代码库，以更清楚地了解后面实际发生了什么。不管怎样，让我们继续前进。</p><p id="2f44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">松弛应用设置</strong></p><p id="158c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们需要为我们的工作空间创建自己的 slack 应用程序，并将其链接到 node.js 应用程序。</p><ol class=""><li id="e594" class="kn ko hi ih b ii ij im in iq mz iu na iy nb jc ku kv kw kx bi translated">登录您的空闲工作区，或者在<a class="ae ky" href="https://slack.com/create#email" rel="noopener ugc nofollow" target="_blank">空闲工作区</a>创建一个。</li><li id="3758" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">转到<a class="ae ky" href="https://api.slack.com/apps" rel="noopener ugc nofollow" target="_blank">应用程序</a>部分，创建一个新的应用程序。您只需要输入应用程序名称，并从下拉列表中选择工作区。在应用程序设置的第一页，在显示信息部分添加应用程序的基本信息。</li><li id="2eed" class="kn ko hi ih b ii kz im la iq lb iu lc iy ld jc ku kv kw kx bi translated">在 Features 下转至<strong class="ih hj"> OAuth &amp; Permissions，</strong>首先将应用程序安装到您的工作空间，并复制和保护<strong class="ih hj"> Scopes </strong>部分下的<code class="du ms mt mu mv b">Bot User OAuth Token.</code>及以下内容，添加以下<strong class="ih hj"> OAuth Scopes、</strong> <a class="ae ky" href="https://api.slack.com/scopes/commands" rel="noopener ugc nofollow" target="_blank">命令</a>和<a class="ae ky" href="https://api.slack.com/scopes/files:write" rel="noopener ugc nofollow" target="_blank">文件:write </a>。</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ne"><img src="../Images/c10e67ab52adf94f89d6a9bbf1b0b5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YSOMyGqiqeZqc6j74QXP4g.png"/></div></div></figure><p id="8b21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.接下来转到<strong class="ih hj">功能</strong>下的<strong class="ih hj">交互性&amp;快捷方式</strong>部分。打开<strong class="ih hj">交互</strong>并在部署后粘贴 Node.js 应用的<code class="du ms mt mu mv b">/actions</code>端点。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ne"><img src="../Images/8c036c3d7d24e2e1e78a479d36d948ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tiuO6FhNkJjw_Gt-WIzi1w.png"/></div></div></figure><p id="2f25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.最后，转到特性下的<strong class="ih hj">斜线命令</strong>部分和<strong class="ih hj">创建新命令。这里我们计划有 3 个斜杠命令，因此我们在后端有 3 个相应的端点。根据需要添加斜杠命令、其请求 URL 和描述。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nf"><img src="../Images/274eca17eed39a9ddba9367972f4cb07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GamNQraj9PoTAyyEcC8GEw.png"/></div></div></figure><p id="cc14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Slack 应用程序已经准备好了，我们可以开始了。然而，我们必须将所有的部分结合在一起，以便使它们一起工作。</p><p id="a07f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们把他们都绑起来……</strong></p><p id="b079" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们之前所讨论的，我们需要在节点应用程序中指定环境变量，以使其正常工作。让我们看看如何获取这些环境变量，稍后我们可以将它们放入 Heroku 设置中的<a class="ae ky" href="https://devcenter.heroku.com/articles/config-vars" rel="noopener ugc nofollow" target="_blank">配置变量</a>。</p><p id="94c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">SLACK_CHANNEL_ACCESS_TOKEN:</strong></code>这可以从你的 Slack 应用设置的<strong class="ih hj"> OAuth &amp; Permissions </strong>部分获取。这已经在 Slack 应用设置的步骤 3 中讨论过了。</p><p id="adc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">AUTH_TOKEN:</strong></code> <strong class="ih hj"> </strong>这基本上就是你的 GitLab 个人访问令牌。您可以从您的<a class="ae ky" href="https://gitlab.com/-/profile/personal_access_tokens" rel="noopener ugc nofollow" target="_blank"> GitLab 配置文件首选项→访问令牌</a>中获取它并为您创建一个。(范围<code class="du ms mt mu mv b">read_repository</code>对于我们的用例来说足够了)。</p><p id="2ab6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">TRIGGER_TOKEN:</strong></code> <strong class="ih hj"> </strong>进入你的 GitLab repo 设置→ CI/CD，在<strong class="ih hj">管道触发器</strong>下，添加触发器。复制代币，那就是你的<code class="du ms mt mu mv b">TRIGGER_TOKEN</code>。你可以从<a class="ae ky" href="https://docs.gitlab.com/ee/ci/triggers/" rel="noopener ugc nofollow" target="_blank">这里</a>阅读更多关于触发器的内容。</p><p id="776d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ms mt mu mv b"><strong class="ih hj">PROJECT_ID:</strong></code> <strong class="ih hj"> </strong>下同一个<strong class="ih hj">管道触发器</strong>从收拢段复制项目 id。你可以参考下图。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ng"><img src="../Images/89048835cb52777aaf5f20233411d1c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUF7O2_Oj_WsmiN5HoQXTQ.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">带下划线的数字是项目标识</figcaption></figure><p id="3c6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们得到了所有需要的变量，让我们把它放在 Heroku 的<a class="ae ky" href="https://devcenter.heroku.com/articles/config-vars" rel="noopener ugc nofollow" target="_blank"> Config Vars </a>部分，最终的状态看起来像这样。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nh"><img src="../Images/ddef844ddf7fb042eb320413e79297c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HdjvLhHSkEXq7vyF-2EmzA.png"/></div></div></figure><p id="f1a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">最后，让我们测试功能……</strong></p><p id="121c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跳到你的 slack workspace 上，邀请我们所有的新 Slack bot 到任何你想使用它的频道。通过键入<code class="du ms mt mu mv b"><strong class="ih hj">/</strong></code> <strong class="ih hj"> </strong>后跟命令，开始键入任何松弛命令。Slack 将自动开始建议所有可用的斜杠命令。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ni"><img src="../Images/55ca7df5a71e2baf03c5ac809c6a2e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*yDSvBriB-_iOvfjx4mxmxw.png"/></div><figcaption class="ma mb et er es mc md bd b be z dx translated">我们之前添加的所有三个斜杠命令都已列出。</figcaption></figure><p id="1f87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们有 3 个斜杠命令，让我们测试它们。</p><p id="0dfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">做<code class="du ms mt mu mv b"><strong class="ih hj">/help</strong></code>将会给我们以下关于如何使用机器人的指导。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nj"><img src="../Images/7f1b2e4b6f8c7b055727bc84bd5f5fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z_F2whjrfH1dhpPstClQqg.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">/帮助</figcaption></figure><p id="9b26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行<code class="du ms mt mu mv b"><strong class="ih hj"> /get_apk</strong></code> <strong class="ih hj"> </strong>将会用一个下拉菜单提示您，要求您选择一个您想要构建并获取 apk 的分支。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nk"><img src="../Images/5f2ae01a9e160b5a745c2a27e01999f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3OsguD_Bdi8EleEwkqS4A.png"/></div></div></figure><p id="8029" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你选择了任何一个分支，它会给你所选择的分支的详细信息和预计的构建时间。此外，还提供了 ticked_id，如果需要，以后可以使用它来了解管道的状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nj"><img src="../Images/b7d8fd4d576bc7995deecd06eb220291.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nzl1EmrJk6gT_kaMktdbAg.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">在选择分支时</figcaption></figure><p id="47a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给定的 ticked_id 可以与<code class="du ms mt mu mv b"><strong class="ih hj">/get_status</strong></code> <strong class="ih hj"> </strong>结合使用，以了解构建过程的状态。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nl"><img src="../Images/b93187048301959c9b5e01dd018d228c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DnFGT5a3NQoVo9P9K4eu9w.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx translated">/get_status [ticket_id]</figcaption></figure><p id="e612" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，一旦构建完成，机器人会用最终的 Apk ping 你。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nm"><img src="../Images/7dbe9d3d5714c6459dbbf043addbd090.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eedzaHYr-yKBzUif5wHwaQ.png"/></div></div></figure><p id="aab3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">耶！这就是我们构建的整个应用程序。您总是可以通过添加更多斜杠命令或向 CI 配置添加更多指令来进一步扩展它。无论如何，我想说这已经足够了。</p><p id="e6ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">也就是说，我希望你已经理解了整个构建，并希望你喜欢这个实现。如有任何疑问，请在下面评论。</p></div><div class="ab cl nn no gp np" role="separator"><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns nt"/><span class="nq bw bk nr ns"/></div><div class="hb hc hd he hf"><p id="b294" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我想附上另外两篇在整个过程中对我有很大帮助的媒体文章。也要归功于他们。🎉</p><div class="lh li ez fb lj lk"><a href="https://proandroiddev.com/a-quick-guide-to-setup-gitlab-ci-cd-for-android-6bb5faec1491" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">为 Android 设置 Gitlab CI/CD 的快速指南</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">频繁构建 apk 并上传到 Slack 进行测试？遵循这个简短的指南来节省您的大量时间！</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">proandroiddev.com</p></div></div><div class="lt l"><div class="nu l lv lw lx lt ly jn lk"/></div></div></a></div><div class="lh li ez fb lj lk"><a rel="noopener follow" target="_blank" href="/@pallavtrivedi03/slack-app-bot-users-interactive-components-slash-commands-and-more-6b34d58c4d11"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hj fi z dy lp ea eb lq ed ef hh bi translated">Slack App : Bot 用户、交互组件、Slash 命令等等</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">Slack(“所有对话和知识的可搜索日志”)是团队协作最常用的工具之一，它…</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">medium.com</p></div></div><div class="lt l"><div class="nv l lv lw lx lt ly jn lk"/></div></div></a></div></div></div>    
</body>
</html>