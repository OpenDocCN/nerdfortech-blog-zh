<html>
<head>
<title>How to Ask For Permissions in android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在android中请求权限</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-ask-for-permissions-in-android-f806cc17eebf?source=collection_archive---------11-----------------------#2021-05-10">https://medium.com/nerd-for-tech/how-to-ask-for-permissions-in-android-f806cc17eebf?source=collection_archive---------11-----------------------#2021-05-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="b34b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请求权限有一些简单的步骤。我们在本文中讨论它们，我们也在代码中使用android最佳实践。如果你对安卓权限一窍不通，就去查查<a class="ae jd" href="https://errorcrasher.in/things-about-android-permissions/" rel="noopener ugc nofollow" target="_blank"> </a>上的东西<a class="ae jd" href="https://errorcrasher.in/things-about-android-permissions/" rel="noopener ugc nofollow" target="_blank">安卓权限</a>的文章。</p><p id="c9aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以没有任何日常，我们开始编码。</p><p id="9bf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们创建了一个需要相机和位置许可的应用程序。如果你愿意，你可以要求一些小小的改变。</p><h1 id="22c3" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤1:向应用程序清单添加权限</h1><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es kc"><img src="../Images/e1d6125797ed6645cf6247940104bf7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/0*rY52A2lKO0V9DRZ9.png"/></div></figure><p id="a33a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kk"> &lt;用途-权限&gt; </em>标签用于声明不同的权限。</p><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="fc8c" class="kq jf hi km b fi kr ks l kt ku">&lt;manifest ...&gt;<br/>    &lt;uses-permission android:name="android.permission.CAMERA"/&gt;<br/>    &lt;uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/&gt;<br/>    &lt;application ...&gt;<br/>        ...<br/>    &lt;/application&gt;<br/>&lt;/manifest&gt;</span></pre><h1 id="208e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤2: XML设计</h1><p id="843c" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我把它设计的很简单，如果你想的话，你可以按照你的风格来设计。</p><figure class="kd ke kf kg fd kh er es paragraph-image"><div class="er es la"><img src="../Images/81480523ce2cc128f22b9d7eb20cb984.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/0*Cv-cbdTu4NzU3LIv.png"/></div></figure><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="d967" class="kq jf hi km b fi kr ks l kt ku">&lt;<strong class="km hj">RelativeLayout</strong> xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"&gt;</span><span id="5752" class="kq jf hi km b fi lb ks l kt ku">    &lt;<strong class="km hj">Button</strong><br/>        android:<strong class="km hj">id="@+id/btn_Cam"</strong><br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:text="@string/camera"<br/>        android:layout_centerInParent="true"/&gt;<br/>    &lt;<strong class="km hj">Button</strong><br/>        android:<strong class="km hj">id="@+id/btn_Loc"</strong><br/>        android:layout_width="wrap_content"<br/>        android:layout_height="wrap_content"<br/>        android:text="@string/location"<br/>        android:layout_below="@+id/btn_Cam"<br/>        android:layout_centerHorizontal="true"<br/>        /&gt;<br/>&lt;/<strong class="km hj">RelativeLayout</strong>&gt;</span></pre><h1 id="ef03" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤3:在Kotlin中请求许可代码</h1><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="7a8a" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">private fun CheckForPermissions(Permission:String,Name:String,RequestCode:Int)</strong><br/>    {<br/>        if(Build.VERSION.SDK_INT&gt;= Build.VERSION_CODES.M)<br/>        {<br/>            when{<br/>                ContextCompat.checkSelfPermission(applicationContext,Permission)== PackageManager.PERMISSION_GRANTED-&gt;{<br/>                    Toast.makeText(applicationContext,"$Name permission is granted",Toast.LENGTH_SHORT).show()<br/>                }<br/>                shouldShowRequestPermissionRationale(Permission) -&gt; showDialog(Permission,Name,RequestCode)</span><span id="d3d3" class="kq jf hi km b fi lb ks l kt ku">                else-&gt; ActivityCompat.requestPermissions(this, arrayOf(Permission),RequestCode)<br/>            }<br/>        }<br/>    }</span><span id="e3e1" class="kq jf hi km b fi lb ks l kt ku"> <strong class="km hj">private fun showDialog(permission: String, name: String, requestCode: Int) </strong>{<br/>        val builder = AlertDialog.Builder(this)</span><span id="9f4d" class="kq jf hi km b fi lb ks l kt ku">        builder.apply {<br/>            setMessage("Permission to access your $name is required to use this app")<br/>            setTitle("Permission Required")<br/>            setPositiveButton("ok"){dialog,which -&gt;<br/>                ActivityCompat.requestPermissions(this@MainActivity, arrayOf(permission),requestCode)<br/>            }<br/>        }<br/>        val dialog =builder.create()<br/>        dialog.show()</span><span id="9647" class="kq jf hi km b fi lb ks l kt ku">    }</span></pre><h2 id="8a3e" class="kq jf hi bd jg lc ld le jk lf lg lh jo iq li lj js iu lk ll jw iy lm ln ka lo bi translated">代码解释</h2><ul class=""><li id="04b7" class="lp lq hi ih b ii kv im kw iq lr iu ls iy lt jc lu lv lw lx bi translated">在这里，我们创建了一个名为<strong class="ih hj"> CheckForPermissions </strong>()的方法，它有3个参数</li></ul><p id="59df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(1) <strong class="ih hj">权限</strong>:即<strong class="ih hj"> <em class="kk">字符串</em> </strong>，(2) <strong class="ih hj">名称</strong>:即<strong class="ih hj"> <em class="kk">字符串</em> </strong>，(3) <strong class="ih hj">请求码</strong>:即<strong class="ih hj"> <em class="kk">整数</em> </strong>)</p><ul class=""><li id="1e32" class="lp lq hi ih b ii ij im in iq ly iu lz iy ma jc lu lv lw lx bi translated">现在，我们必须检查设备的版本，它应该比棉花糖更大</li></ul><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="3ca5" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">if(Build.VERSION.SDK_INT&gt;= Build.VERSION_CODES.M)</strong>{}</span></pre><ul class=""><li id="bfd0" class="lp lq hi ih b ii ij im in iq ly iu lz iy ma jc lu lv lw lx bi translated">现在，在<strong class="ih hj">中，当</strong>条件出现时，我们检查是否已经授予许可，如果是，则显示授予的祝酒按摩许可</li></ul><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="639e" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">when{ ContextCompat.checkSelfPermission(applicationContext,Permission)== PackageManager.PERMISSION_GRANTED-&gt;{<br/>Toast.makeText(applicationContext,"$Name permission is granted",Toast.LENGTH_SHORT).show()<br/>}</strong></span></pre><ul class=""><li id="1451" class="lp lq hi ih b ii ij im in iq ly iu lz iy ma jc lu lv lw lx bi translated"><strong class="ih hj">shouldshowrequestpermissionrational()—</strong>该方法用于检查用户是否被拒绝权限，该方法只调用一次，在这里您可以显示一个教育用户界面，以便用户可以理解为什么需要该权限。这里我们显示一个对话框让用户了解流程。如果用户再次没有授予权限，那么下次系统便不会显示任何提示</li></ul><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="1412" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">shouldShowRequestPermissionRationale(Permission) -&gt; showDialog(Permission,Name,RequestCode)</strong></span></pre><ul class=""><li id="07ff" class="lp lq hi ih b ii ij im in iq ly iu lz iy ma jc lu lv lw lx bi translated">现在我们只向用户显示接受许可的提示</li></ul><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="c1dd" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">else-&gt; ActivityCompat.requestPermissions(this, arrayOf(Permission),RequestCode)</strong></span></pre><ul class=""><li id="75bd" class="lp lq hi ih b ii ij im in iq ly iu lz iy ma jc lu lv lw lx bi translated">现在代码的下一部分只是为了创建一个对话框，如果你想做别的事情，你可以试试别的</li></ul><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="0f39" class="kq jf hi km b fi kr ks l kt ku"><strong class="km hj">private fun showDialog(permission: String, name: String, requestCode: Int) {</strong> <strong class="km hj">}</strong></span></pre><h1 id="be54" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">步骤4:创建ButtonClick方法和请求代码变量</h1><p id="cf5c" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">这里我们为请求代码创建2个变量</p><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="a650" class="kq jf hi km b fi kr ks l kt ku">val <strong class="km hj">Find_Location_RQ</strong> =101 // Request code Can be anything But<br/>val <strong class="km hj">Camera_RQ</strong> =102        // Deffrent to each other.</span><span id="3436" class="kq jf hi km b fi lb ks l kt ku">_______________________________________________________________</span><span id="1046" class="kq jf hi km b fi lb ks l kt ku"><strong class="km hj">private fun  buttonTaps()</strong><br/>    {<br/>        <strong class="km hj">btn_Cam.setOnClickListener </strong>{<br/>            <em class="kk">CheckForPermissions</em>(android.Manifest.permission.CAMERA,"Camera",Camera_RQ)<br/>        }<br/>        <strong class="km hj">btn_Loc.setOnClickListener</strong> {<br/>            <em class="kk">CheckForPermissions</em>(android.Manifest.permission.ACCESS_FINE_LOCATION,"Location",Find_Location_RQ)<br/>        }<br/>    }</span></pre><p id="1cb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj"> onCreate( ) </strong>方法中调用<strong class="ih hj"> buttonTaps( ) </strong>方法，以便每当有人点击按钮时我们检查权限。</p><pre class="kd ke kf kg fd kl km kn ko aw kp bi"><span id="fee0" class="kq jf hi km b fi kr ks l kt ku">override fun <strong class="km hj">onCreate</strong>(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        setContentView(R.layout.activity_main)</span><span id="8e07" class="kq jf hi km b fi lb ks l kt ku">        <strong class="km hj">buttonTaps()</strong><br/>        <br/>    }</span></pre><h1 id="4d32" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">最终输出:-</h1><p id="3259" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">检查此链接的结果:-</p><p id="4f81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://errorcrasher.in/wp-content/uploads/2021/05/Screenrecorder-2021-05-09-13-55-11-1780.mp4" rel="noopener ugc nofollow" target="_blank"><em class="kk">https://error crasher . in/WP-content/uploads/2021/05/screen recorder-2021-05-09-13-55-11-1780 . MP4</em></a></p></div></div>    
</body>
</html>