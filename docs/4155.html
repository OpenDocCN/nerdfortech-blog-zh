<html>
<head>
<title>Debezium Server to Cloud PubSub: A Kafka-less way to stream changes from databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从 Debezium 服务器到 Cloud PubSub:一种无 Kafka 的方式来从数据库中传输更改</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/debezium-server-to-cloud-pubsub-a-kafka-less-way-to-stream-changes-from-databases-1d6edc97da40?source=collection_archive---------2-----------------------#2021-07-09">https://medium.com/nerd-for-tech/debezium-server-to-cloud-pubsub-a-kafka-less-way-to-stream-changes-from-databases-1d6edc97da40?source=collection_archive---------2-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8174" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di">正如</span>根据<a class="ae jm" href="https://hbr.org/2017/05/whats-your-data-strategy" rel="noopener ugc nofollow" target="_blank">《哈佛商业评论》(HBR) </a> <strong class="ih hj">所言，只有不到 1%的非结构化数据和 50%的结构化数据被用于决策制定</strong>，因为组织不知道如何有效地集成、管理数据并从中提取价值。此外，为了在市场中保持竞争力，组织需要实时处理和分析数据以获得洞察力。这就是数据流的用武之地，最受欢迎的开源工具之一是<a class="ae jm" href="http://www.debezium.io" rel="noopener ugc nofollow" target="_blank"> Debezium </a>。它是一个用于变更数据捕获的开源分布式平台。</p><p id="d1e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">唯一的限制是，您需要通过 Apache Kafka Connect 作为源连接器来部署 Debezium，因此，所有捕获的记录都必须通过 Kafka 消息队列传播到 Sink 连接器，进而传播到其他系统，甚至像 Cloud PubSub 这样的消息队列。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es jn"><img src="../Images/d360f5336c681de9d6998cfad7cf603f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HdDUW_XeHd9wagZUfFmE6w.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd">作者使用 Debezium Kafka 连接器进行云 PubSub 集成</strong></figcaption></figure><p id="1aaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，该团队已经引入了 Debezium Server，这是一个现成的应用程序，可以将变更事件从源数据库直接传输到消息传递基础架构，如 Google cloud managed Cloud Pub/Sub，而不需要 Apache Kafka，因此减少了相关的操作开销和额外的跳跃。</p><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es ke"><img src="../Images/56bcd86cd3f4b4c331c827443865270c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q6F-wF-yVF18bnufgum67Q.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd">使用 Debezium 服务器的云发布订阅集成</strong>，作者</figcaption></figure><h1 id="c6f9" class="kf kg hi bd kd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">Debezium 服务器设置</h1><p id="9d28" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">让我们配置 Debezium 服务器，source 为企业数据库引擎“SQL Server”，sink 为 Google Cloud PubSub，不需要 Kafka 组件。</p><h2 id="3e8d" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">为 CDC 配置 SQL Server</h2><ul class=""><li id="2db5" class="lv lw hi ih b ii lc im ld iq lx iu ly iy lz jc ma mb mc md bi translated">请确保您是 sysadmin 固定服务器角色的成员。</li><li id="71b6" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">您是数据库的 db_owner。</li><li id="a297" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">SQL Server 代理正在运行。</li><li id="dd7b" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">要为数据库“demodb”启用 CDC，请执行以下操作:</li></ul><pre class="jo jp jq jr fd mj mk ml mm aw mn bi"><span id="ac17" class="lh kg hi mk b fi mo mp l mq mr">USE demodb<br/>GO<br/>EXEC sys.sp_cdc_enable_db <br/>GO</span></pre><ul class=""><li id="97a5" class="lv lw hi ih b ii ij im in iq ms iu mt iy mu jc ma mb mc md bi translated">在感兴趣的源表上启用数据捕获。</li></ul><pre class="jo jp jq jr fd mj mk ml mm aw mn bi"><span id="9490" class="lh kg hi mk b fi mo mp l mq mr">USE demodb<br/>GO<br/>EXEC sys.sp_cdc_enable_table <br/>@source_schema = N'dbo', <br/>@source_name   = N'Inventory',  <br/>@role_name     = NULL,   <br/>@supports_net_changes = 0<br/>GO</span></pre><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es mv"><img src="../Images/6db9c386c201fd8ecce7faa55fd0715d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7ZHPNtDMB_mmuCmc2fmvQ.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated">来源表定义:<strong class="bd kd">存货</strong>，按作者</figcaption></figure><ul class=""><li id="ab8f" class="lv lw hi ih b ii ij im in iq ms iu mt iy mu jc ma mb mc md bi translated">验证对 CDC 表的访问。</li></ul><pre class="jo jp jq jr fd mj mk ml mm aw mn bi"><span id="cb63" class="lh kg hi mk b fi mo mp l mq mr">USE demodb<br/>GO<br/>EXEC sys.sp_cdc_help_change_data_capture<br/>GO</span></pre><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es mw"><img src="../Images/75302a2dee745905d18a0dc5f2c5fb78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LL0lyUtQfyLmTqR6U7sxMw.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd"> CDC 表 dbo_Inventory </strong>已由作者创建并可用</figcaption></figure><h2 id="1afd" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">配置 Debezium 服务器</h2><ul class=""><li id="1171" class="lv lw hi ih b ii lc im ld iq lx iu ly iy lz jc ma mb mc md bi translated">下载并安装<a class="ae jm" href="https://repo1.maven.org/maven2/io/debezium/debezium-server-dist/1.6.0.Final/debezium-server-dist-1.6.0.Final.tar.gz" rel="noopener ugc nofollow" target="_blank"> Debezium 服务器发行版</a>。</li><li id="a98d" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">创建配置文件“conf/application.properties ”,该文件将包含与源、接收器、格式和适用转换相关的所有配置。</li><li id="107d" class="lv lw hi ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">以 SQL Server 数据库作为源，以 Google Cloud PubSub 作为消息传递基础设施的配置文件将如下所示:</li></ul><pre class="jo jp jq jr fd mj mk ml mm aw mn bi"><span id="3179" class="lh kg hi mk b fi mo mp l mq mr">debezium.sink.type=pubsub<br/>debezium.sink.pubsub.project.id= <strong class="mk hj">&lt;&lt;PUT YOUR PROJECT_ID&gt;&gt;</strong><br/>debezium.source.connector.class=io.debezium.connector.sqlserver.SqlServerConnector<br/>debezium.source.offset.storage.file.filename=/tmp/offsets.dat<br/>debezium.source.offset.flush.interval.ms=0<br/>debezium.source.database.hostname=<strong class="mk hj">&lt;&lt;SQL-Server HOSTNAME/IP_ADDRESS&gt;&gt;</strong><br/>debezium.source.database.port=1433<br/>debezium.source.database.user=sa<br/>debezium.source.database.password= <strong class="mk hj">&lt;&lt;PASSWORD&gt;&gt;</strong><br/>debezium.source.database.dbname=demodb<br/>debezium.source.database.server.name=demodb<br/>debezium.sink.pravega.scope=empty<br/>debezium.source.table.whitelist=dbo.Inventory<br/>debezium.source.database.history.file.filename=/tmp/FileDatabaseHistory.dat<br/>debezium.source.database.history=io.debezium.relational.history.FileDatabaseHistory</span></pre><h2 id="1b97" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">配置云发布订阅</h2><ul class=""><li id="cffc" class="lv lw hi ih b ii lc im ld iq lx iu ly iy lz jc ma mb mc md bi translated">使用以下名称创建 PubSub 主题<strong class="ih hj">&lt;&lt;db _ name . schema . table _ name&gt;&gt;</strong></li></ul><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es mx"><img src="../Images/3624faf289e68ce4b2f4fca55376b46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tvued6mT28thynhyVCmZDA.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated">发布主题:<strong class="bd kd"> demodb.dbo.Inventory </strong>，作者</figcaption></figure><ul class=""><li id="d793" class="lv lw hi ih b ii ij im in iq ms iu mt iy mu jc ma mb mc md bi translated">创建 PubSub 订阅以查看推送到 PubSub 主题的消息。</li></ul><h2 id="f830" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">启动 Debezium 服务器</h2><ul class=""><li id="2c6a" class="lv lw hi ih b ii lc im ld iq lx iu ly iy lz jc ma mb mc md bi translated">通过执行<strong class="ih hj">&lt;&lt;Debezium _ Server _ Path/run . sh&gt;&gt;</strong>启动 Debezium 服务器</li></ul><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es my"><img src="../Images/1887f7429e4d2a19e4f5bf79ef86b7c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hoY8G6WuZq5YGFwinw4C_w.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd">。/run.sh 输出</strong>，作者</figcaption></figure><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es mz"><img src="../Images/bfe4b3f2eb09aecccc1a9303b6567247.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OlJBdEd8ZC-v0izBanbLgg.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd">。/run.sh 输出</strong>，作者</figcaption></figure><ul class=""><li id="1ef4" class="lv lw hi ih b ii ij im in iq ms iu mt iy mu jc ma mb mc md bi translated">让我们将数据添加到<strong class="ih hj"> <em class="na">库存</em> </strong>表，并检查 PubSub 订阅</li></ul><figure class="jo jp jq jr fd js er es paragraph-image"><div role="button" tabindex="0" class="jt ju di jv bf jw"><div class="er es nb"><img src="../Images/8f853e7047f786b28ce749cc7c68a159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGvzfVJB2Gkn8Muv-SSjhQ.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx translated"><strong class="bd kd">来自 SQL Server 的 CDC 数据在作者的发布订阅</strong>中可见</figcaption></figure><h2 id="0a8f" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">摘要</h2><p id="3eee" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">Debezium Server 减轻了对 Kafka Connect 的依赖，因此用户可以将其与所选的托管产品集成，从而不再需要对采用 Debezium 带来的额外运营开销进行任何规划。但是，需要注意的是，该功能仍处于酝酿阶段，即确切的语义、配置选项等。在未来的版本中可能会有所变化。因此，在将其用于生产系统之前，请确保在您的非生产环境中对其进行了彻底的测试。</p></div><div class="ab cl nc nd gp ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="hb hc hd he hf"><h2 id="6f28" class="lh kg hi bd kd li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">参考</h2><p id="1698" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated"><a class="ae jm" href="https://cloud.google.com/pubsub" rel="noopener ugc nofollow" target="_blank">谷歌云发布订阅</a></p><p id="49b4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jm" href="http://www.debezium.io" rel="noopener ugc nofollow" target="_blank"> Debezium </a></p><p id="7a8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软 SQL Server CDC </p></div></div>    
</body>
</html>