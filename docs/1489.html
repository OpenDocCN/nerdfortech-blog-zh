<html>
<head>
<title>Android Continuous Integration and Coverage visualization on Gitlab.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Gitlab 上的 Android 持续集成和覆盖可视化。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/android-continuous-integration-and-coverage-visualization-on-gitlab-4a15d58f624c?source=collection_archive---------5-----------------------#2021-03-22">https://medium.com/nerd-for-tech/android-continuous-integration-and-coverage-visualization-on-gitlab-4a15d58f624c?source=collection_archive---------5-----------------------#2021-03-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9891bacc883b1162ca9592c6b81f4ab7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TfD3poEec2_BbeWDxiDF4g.png"/></div></div></figure><h1 id="cea5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">引言。</strong></h1><p id="704b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">你的新代码打破了以前的代码？您的热修复程序引入了新的错误？放心吧！你并不孤单，老实说，DevOps 不能 100%保证这种问题不会再次发生，但你可以肯定，有了良好的质量测试和 CI/CD，这种情况会在较小的程度上发生。</p><p id="79c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们不会谈论所有的 DevOps 过程或者如何编写高质量的仪器测试。我们将关注一个 Android 应用程序中的 CI(代表持续集成)和覆盖率(测试覆盖了你的代码库的多少%),以及你的团队如何使用 Gitlab 在合并请求上可视化这个覆盖率(不要担心这个过程，Github 几乎是一样的)！</p><p id="8570" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">所以我在寻找一个教程，让我们的团队实现代码覆盖可视化，并在“本地”物理设备上运行插装测试，我已经尝试在一个 docker 上用 Android 映像运行插装测试，但至少在我们的情况下是真的，不是所有的测试都通过了，Docker 映像错误。</p><p id="51b7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，我们通常会尝试在具有高度个性化 UI 层的设备上进行测试，因为这种智能手机的错误率最高，而不是那些具有更干净的 Android UI 的设备。这个想法是便宜地失败并且尽可能快地抓住错误。</p><p id="5905" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们的目标是让你的团队在那套设备上运行 CI-Pipelines 测试，你不能用 docker 上运行的 Android 映像轻松做到这一点，至少据我所知是这样。因此，我们要将设备连接到远程 Gitlab Runner 服务器。</p><p id="70b0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">传统上，对于合并请求，您必须下载覆盖报告，并手动检查新代码是否被覆盖，如果您是进行代码审查的人，这是一个令人疲惫的过程。我们将自动执行，并在 Gitlab 上的合并请求上直接显示代码行是否被覆盖。</p><p id="cdae" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们开始吧！</p><h1 id="4c9a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">概念。</strong></h1><p id="deaf" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">根据 Android，<a class="ae kr" href="https://developer.android.com/training/testing/fundamentals" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj">插装测试</strong> </a> <strong class="jq hj"> </strong>是在物理设备和仿真器上运行的测试，它们可以利用 Android 框架 API 和支持 API，如 AndroidX 测试。例如，如果您需要应用程序上下文，您应该编写一个工具测试。</p><p id="99eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Gitlab 介绍了 CI: <em class="ks"> </em> <a class="ae kr" href="https://docs.gitlab.com/13.8/ee/ci/README.html" rel="noopener ugc nofollow" target="_blank"> <strong class="jq hj"> <em class="ks">持续集成</em> </strong> </a> <em class="ks">的工作原理是将小代码块推送到 Git 存储库中托管的应用程序的代码库，并在将它们合并到主分支之前，运行脚本管道来构建、测试和验证代码更改。</em>举例来说，你正在工作，一个全新的功能。使用 CI +高质量的仪器测试，您的团队可以在管道运行的早期阶段发现新的错误/不当行为，而不是在您的 QA 团队或客户使用您的应用程序时。</p><p id="c3d6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae kr" href="https://docs.docker.com/get-started/overview/" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj"><em class="ks">Docker</em></strong></a><em class="ks">提供了在松散隔离的环境(称为容器)中打包和运行应用程序的能力。隔离和安全性允许您在给定的主机上同时运行许多容器。容器是轻量级的，包含运行应用程序所需的一切，因此您不需要依赖主机上当前安装的内容。您可以在工作时轻松共享容器，并确保与您共享的每个人都获得以相同方式工作的相同容器。</em></p><h1 id="fe39" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">建筑。</strong></h1><p id="6fea" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">默认情况下，您在 Gitlab 服务器上推送的每个提交都会触发一个<a class="ae kr" href="http://A quick guide to GitLab CI/CD pipelines | GitLababout.gitlab.com › blog › 2019/07/12 › guide-to-ci-cd-pi..." rel="noopener ugc nofollow" target="_blank"> <em class="ks">管道</em> </a> <em class="ks"> </em>，这是一系列阶段，告诉 Gitlab 要检查什么，即 CI:</p><ul class=""><li id="eee8" class="kt ku hi jq b jr km jv kn jz kv kd kw kh kx kl ky kz la lb bi translated">建设</li><li id="853e" class="kt ku hi jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb bi translated">试验</li><li id="d37c" class="kt ku hi jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb bi translated">显示覆盖范围</li></ul><p id="4702" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果一个阶段失败了，您可以检查发生了什么并修复它。<em class="ks"> GitLab Runner 是一个与 GitLab CI/CD 协同工作的应用程序，用于在管道中运行作业</em>。每个步骤可以有不同的容器。</p><p id="cf3d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你的跑步者在你的本地机器上，跳过这一章。</p><p id="9b6e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这是 Android 管道的常见架构，Gitlab 存储库服务器与 Gitlab-Runner 服务器在不同的机器上，当管道运行时，在测试阶段，Gitlab-Runer 必须部署在 docker 容器上运行的 Android 操作系统映像，以便可以运行插装测试。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/7c244d196dc54d583afa1405edefec7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4Wbgvl51D1IDQVc9sy-dQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">标准架构</figcaption></figure><p id="dc9a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">优点是可扩展性。这个有什么问题？有些映像需要对 gradle 进行大量额外的依赖，另一个需要修改大量的测试代码才能运行，并且您没有在物理设备上运行测试的高保真度。</p><p id="c28e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是<strong class="jq hj"> <em class="ks">提出的架构。我们试图给我们的 Gitlab-Runner 一个尽可能接近我们作为开发者所拥有的环境。</em></strong></p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lh"><img src="../Images/db2ae636e72a01224a5bdc14fb80b732.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPuUNx-bClqjHtNVstkQPA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">提议的架构</figcaption></figure><p id="0f47" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当你把你的 android 设备连接到你的笔记本电脑上时，你可以通过 ADB(Android 设备桥)调试/安装/摆弄它。我尽量保持简短，ADB 与一个监听本地端口 5037 的守护程序一起工作。这个想法是将该端口上的通信发送到 Gitlab-Runner 服务器，这很有用，因为这就像您将您的设备连接到您的服务器。缺点是什么？您的手机必须始终连接到 Gitlab-Runner-Server，或者至少在管道运行时。</p><p id="d631" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">引用《硅谷- HBO》系列中的 Gilfoyle 的话，免责声明:通知你公司的安全团队你将要做这个端口的事情，一个关键组件的错误配置会导致安全问题。 ]</p><p id="601d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们不需要修改任何测试代码或者你的 gradle，因为你的仪器测试将会在你的本地设备上运行。</p><h1 id="ff0f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">实施——基础设施。</strong></h1><p id="d318" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">如果你的公司把 gitlab.com 作为一个存储库而不是一个自我管理的实例，并且 Runners 运行在每个开发者的本地机器上，你可以跳过下一段。</p><p id="b9f5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，如果可能的话，我们需要两台运行 Linux 的服务器，我们不关心这些服务器在哪里，您可以使用您的笔记本电脑在 virtual box 上运行两台虚拟机，事情是这些服务器中的一台(gitlab-runner-server)必须有 Docker，您可以从您的笔记本电脑访问端口 5037(ADB 守护程序正在运行),另一台必须有 gitlab 存储库(gitlab-repository-server，您可以在 gitlab-repository 的同一台机器上部署 Docker ),并且您可以访问 Gitlab 这里是<a class="ae kr" rel="noopener" href="/@andresmaca/deploying-a-gitlab-repository-and-runner-server-on-google-cloud-57b9d490c975">在谷歌云基础设施上实现这一目标的分步指南</a>。在本教程中，我们将使用 Ubuntu 20.04 作为服务器的操作系统。</p><p id="0ac0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们必须在 Gitlab 资源库上注册我们的跑步者，在 Gitlab 上打开您的 Repo，然后进入设置&gt; CI/CD &gt;跑步者:扩展。复制 URL 和注册令牌。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/e1a7b307ccd3530c4d7b8fe7900d05bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wceD0dvNQFMOV8NvSq41Ww.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">Gitlab CI/CD 设置</figcaption></figure><p id="64eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在通过 SSH 与您的<em class="ks"> gitlab-runner-instance </em>连接，启动一个 docker 卷并将其安装到 gitlab-runner:</p><pre class="li lj lk ll fd lr ls lt lu aw lv bi"><span id="7277" class="lw ir hi ls b fi lx ly l lz ma">sudo docker volume create gitlab-runner-config</span><span id="7272" class="lw ir hi ls b fi mb ly l lz ma">sudo docker run -d --name gitlab-runner --restart always     -v /var/run/docker.sock:/var/run/docker.sock     -v gitlab-runner-config:/etc/gitlab-runner     gitlab/gitlab-runner:latest</span><span id="7f35" class="lw ir hi ls b fi mb ly l lz ma">sudo docker run --rm -it -v gitlab-runner-config:/etc/gitlab-runner gitlab/gitlab-runner:latest register</span></pre><p id="3c15" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它会要求您提供一些数据，您已经有了注册令牌和 url:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/0c6e417c7d615d7b557da0126f9743a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8blU0XYD-0TMP8Nv5MQahQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">注册跑步者</figcaption></figure><p id="5aae" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，我们必须在<em class="ks"> gitlab-runner-server: </em>上添加一个有效的网络模式</p><pre class="li lj lk ll fd lr ls lt lu aw lv bi"><span id="5290" class="lw ir hi ls b fi lx ly l lz ma">sudo su<br/>cd /var/lib/docker/volumes/gitlab-runner-config/_data<br/>vim config.toml</span></pre><p id="b329" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">添加 network_mode = "host "</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="ab fe cl md"><img src="../Images/cfa88d13d6c8915a8aee9eb1f2dc822d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vXGSRMCwL8xeqXziqlw6Jw.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">跑步者网络模式</figcaption></figure><pre class="li lj lk ll fd lr ls lt lu aw lv bi"><span id="983c" class="lw ir hi ls b fi lx ly l lz ma">docker restart gitlab-runner</span></pre><p id="921e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以在注册令牌和 url 的同一站点上查看状态或删除已注册的跑步者:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/b16fb968ef7feaf3243dcca95ae707c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TIuMAVpGpmqGrEpPrM6KQQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">可用跑步者</figcaption></figure><p id="e6cb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，在本地机器上打开一个终端，键入:</p><pre class="li lj lk ll fd lr ls lt lu aw lv bi"><span id="fe9c" class="lw ir hi ls b fi lx ly l lz ma">adb devices</span><span id="63a2" class="lw ir hi ls b fi mb ly l lz ma">ssh -XC -v -R 5037:localhost:5037 username_on_gitlab_runner_server@ip_address_gitlab_runner_server</span></pre><p id="5793" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最小化终端。在这一点上，您能够从您的 CI/CD 中运行插装测试，让合并请求上的覆盖可视化一起移动。</p><h1 id="6d35" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">实现—代码覆盖可视化。</h1><p id="8446" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们有一个<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor" rel="noopener ugc nofollow" target="_blank">非常简单的应用</a>你可以点击一个按钮在面板上显示想要的颜色。作为开发人员，我们应该确保每个按钮都显示 seek 颜色。我们公司和客户不希望当你点击蓝色按钮时看到红色面板。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/4a95c144173a81a1ad46f305c71cd11d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/1*j3mGAbVPl40nv87Mbs__Xw.gif"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">ChangeMyColor 演示</figcaption></figure><p id="cdb3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们的客户需要添加<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor/-/tree/feature/green_color" rel="noopener ugc nofollow" target="_blank">绿色，</a>我们应该确保当绿色按钮被按下时，绿色面板显示。在我们编写了所需的测试之后，我们将代码推送到 Gitlab，然后<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor/-/pipelines/274054315" rel="noopener ugc nofollow" target="_blank">流水线应该开始</a>。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/044de94984dec195739c39339147b074.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*563Ji1G1qcdkB_wnulQmPA.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">App 的渠道</figcaption></figure><p id="a36c" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">当<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor/-/jobs/1115844479" rel="noopener ugc nofollow" target="_blank"> <em class="ks"> instrumentationTest </em>作业</a>正在进行时，我们可以看到 Espresso 正在我们的本地设备上执行测试:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/f16773fecee08c870c5e14bf7958eeed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/1*MvUyIRO0Mn3wRe6EtW_Y_Q.gif"/></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">从 Gitlab Runner 运行仪器测试</figcaption></figure><p id="dbf0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">打开合并请求后，代码审查者可以<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor/-/merge_requests/2/diffs" rel="noopener ugc nofollow" target="_blank">在 Gitlab </a>平台上检查绿色按钮特性的新代码是否被覆盖(代码左侧的绿色线条)并按预期工作，而无需下载任何内容。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/b4585cc44dde5ffbcaf71198bf3da2ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f72VTUEOm83wlTJuzkGblw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">覆盖可视化</figcaption></figure><p id="730d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要做到以上，你要有一个<strong class="jq hj">。</strong><a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/ChangeMyColor/-/blob/master/.gitlab-ci.yml" rel="noopener ugc nofollow" target="_blank"><strong class="jq hj">git lab-ci . yml</strong>文件</a>，你可以在这里找到我正在使用的<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/android_build_container" rel="noopener ugc nofollow" target="_blank">(Android _ build _ container)</a>和<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/jacoco2cobertura" rel="noopener ugc nofollow" target="_blank">(jacoco 2 cobertura)</a>Docker 容器的源代码。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/7be9c9e5bc6773566bb53e4d4a17b1be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RA8prsnfOFd23XllDOt7Qw.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx translated">管道作业</figcaption></figure><p id="086a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">流水线很简单，执行 3 个任务:</p><ul class=""><li id="7911" class="kt ku hi jq b jr km jv kn jz kv kd kw kh kx kl ky kz la lb bi translated">构建:<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/android_build_container" rel="noopener ugc nofollow" target="_blank">用 gradle assembleDebug 构建项目</a>。我们确保我们的代码至少可以编译。</li><li id="3f45" class="kt ku hi jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb bi translated">测试:在本地设备上运行工具测试，并将 jacoco 报告作为工件上传。不要忘记在您的本地机器和 gitlab-runner-server 之间创建 ssh 连接，否则这项工作将会失败。</li><li id="89b5" class="kt ku hi jq b jr lc jv ld jz le kd lf kh lg kl ky kz la lb bi translated">可视化:解析从 Jacoco 到 Cobertura 的<a class="ae kr" href="https://gitlab.com/ciandroidinstrumentationtest/jacoco2cobertura" rel="noopener ugc nofollow" target="_blank">输出，并将 cobertura.xml 作为报告上传。</a></li></ul><p id="d7e9" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您可以添加一些额外的规则，例如:如果覆盖率低于限制，则使管道失败<a class="ae kr" href="https://www.raywenderlich.com/10562143-continuous-integration-for-android#toc-anchor-014" rel="noopener ugc nofollow" target="_blank">。或者仅当是标记或特定分支或操作时才运行管道。</a></p><p id="3fd7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这就是全部！</p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="5893" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你对你的开源/ONG 项目有任何疑问或需要帮助，请随时在<a class="ae kr" href="https://www.linkedin.com/in/andresmaca" rel="noopener ugc nofollow" target="_blank"> linkedIn </a>上点击我的 DM。</p><p id="5c32" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">感谢 Gitlab 的 James Heimbuck 先生帮助设置覆盖可视化特性。</p><p id="12fe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果有用的话，别忘了按拍手按钮！</p></div></div>    
</body>
</html>