<html>
<head>
<title>One to many database relationship(+CRUD) with PostgreSQL and Flask Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与 PostgreSQL 和 Flask 的一对多数据库关系(+CRUD)第 1 部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-1-6f87fb574b7c?source=collection_archive---------5-----------------------#2021-05-18">https://medium.com/nerd-for-tech/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-1-6f87fb574b7c?source=collection_archive---------5-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/88667bf020bc1d95cbc9d83c869ca684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*__XQ_RD8COJn4_BP.jpeg"/></div></figure></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><p id="2862" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">一对多关系是您必须掌握的东西(多对多也是一样)。我将使用我自己的项目作为一个例子<a class="ae jr" href="https://github.com/Mozes721/Flask_Blog_App" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hj">博客应用</strong> </a> <strong class="iv hj"> </strong>和一个关系数据库<strong class="iv hj"> PostgreSQL </strong>和一个常见的实时暗示<strong class="iv hj"> Flask </strong> web 框架(最好你有 HTML/CSS 的知识和一些 Flask 经验)，在那里登录的用户可以发表自己的帖子并做</p><h1 id="35fe" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">连接到 PosgreSQL 并创建模型</h1><p id="ebbf" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">我们将从导入相应的包开始，连接到我们的 Flask 实例，连接到我们的 PosgreSQL 数据库，创建将连接到特定的<strong class="iv hj"> __tablename__ </strong>的模型，并创建特定的变量。</p><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="ffd9" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">显而易见，首先我们连接到 Flask 应用程序实例，并通过提供 PosgreSQL URI 来配置 Flask。</p><p id="9997" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">然后，我们用<strong class="iv hj"> SQLAlchemy </strong>创建一个 db 变量，以连接到您的数据库并使用模型创建表。</p><p id="8cbc" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">类通常有关系<strong class="iv hj"/>,正如这里讨论的那样。</p><blockquote class="lb lc ld"><p id="7ee8" class="it iu le iv b iw ix iy iz ja jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp jq hb bi translated"><em class="hi">Flask-</em><strong class="iv hj"><em class="hi">SQLAlchemy</em></strong><em class="hi">，relationship 方法中的</em><strong class="iv hj"><em class="hi">backref</em></strong><em class="hi">参数允许你在指定的类下声明一个新的属性，这里将其指定为‘list’</em></p><p id="bac0" class="it iu le iv b iw ix iy iz ja jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp jq hb bi translated"><strong class="iv hj"><em class="hi"/></strong><em class="hi">参数决定了通过关系查询时，相关对象如何加载。lazy = 'select '(或 True) </em></p></blockquote><h2 id="4d8b" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">烧瓶形</h2><p id="1c1e" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">这个<strong class="iv hj"> PostForm(FlaskForm) </strong>类是作为一个附加来更新或修改一个用户已经发表的文章的。简而言之就是一个 CRUD 操作。你可以在这里阅读更多关于它的<a class="ae jr" href="https://hackersandslackers.com/flask-wtforms-forms/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="a146" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">注册/登录/注销逻辑</h1><p id="bb27" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">这一部分非常简单，与我之前的文章相似:</p><div class="lw lx ez fb ly lz"><a rel="noopener follow" target="_blank" href="/codex/simple-registration-login-system-with-flask-mongodb-and-bootstrap-8872b16ef915"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">带有 Flask、MongoDB 和 BootStrap 的简单注册/登录系统</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Flask，Bootstrap，MongoDB 简介</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">medium.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ik lz"/></div></div></a></div><p id="fbfb" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">主要区别是我们使用关系数据库(+CRUD 操作)并在前端添加了更多功能。</p><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="76bf" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi mo translated"><span class="l mp mq mr bm ms mt mu mv mw di">B</span>ear with me index()是运行<strong class="iv hj"> app.py </strong>时默认运行的，重定向到首页。</p><blockquote class="lb lc ld"><p id="e6fd" class="it iu le iv b iw ix iy iz ja jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp jq hb bi translated"><em class="hi">注意:大部分解释将在 gist 文件中提供。</em></p></blockquote><p id="aea3" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在这个项目的主页上已经列出了所有的用户帖子。</p><p id="6a32" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">Flask <strong class="iv hj">分页</strong>的例子也实现了，这样一个页面就不会有超过 3 篇文章！更多信息请点击查看<a class="ae jr" href="https://pythonhosted.org/Flask-paginate/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="5fac" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">通过传递用户名、电子邮件和密码来注册用户(显然，我们为了安全起见对其进行了哈希处理！)</p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><h1 id="9fe6" class="js jt hi bd ju jv mx jx jy jz my kb kc kd mz kf kg kh na kj kk kl nb kn ko kp bi translated">前端模板</h1><p id="1c8f" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">既然逻辑部分已经解决了(至少目前❤是这样)，让我们把注意力放在 UI 上。</p><blockquote class="lb lc ld"><p id="89ad" class="it iu le iv b iw ix iy iz ja jb jc jd lf jf jg jh lg jj jk jl lh jn jo jp jq hb bi translated"><strong class="iv hj"> <em class="hi"> Sidenote </em> </strong> <em class="hi">:由于我们的主要焦点是 CRUD 操作和数据库关系功能，因此我们不会深入设计前端。</em></p></blockquote><h2 id="6661" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">基础</h2><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="4c33" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">显然，由于我对前端/造型不够精通或没有足够的耐心(目前)，我使用<a class="ae jr" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>进行快速定制和设计。</p><p id="7ad5" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated"><strong class="iv hj">base.html</strong>是一个导航条，在所有其他模板中都有扩展</p><h2 id="7be1" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">主页</h2><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="31ce" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我知道，我知道造型应该在 styles.css 告我！</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es nc"><img src="../Images/2fd5c319965b575c71872e24ed255106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*CKjYvi2UxPK6JWld.png"/></div></div></figure><p id="02e5" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">搜索表单是所有用户<strong class="iv hj">帖子</strong>的<strong class="iv hj"> CRUD </strong>操作的一部分，我将在本文的第 2 部分介绍这些用户<strong class="iv hj">帖子</strong>。</p><p id="399a" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在 div“容器”中有</p><pre class="kv kw kx ky fd nh ni nj nk aw nl bi"><span id="4190" class="li jt hi ni b fi nm nn l no np">{% for post in posts.items %}</span></pre><p id="ac7d" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">它将遍历所有用户传入的所有 posts.items。在其中，我们有“卡头”、“卡体”等等及其对应的 post 项目值，如</p><pre class="kv kw kx ky fd nh ni nj nk aw nl bi"><span id="37fc" class="li jt hi ni b fi nm nn l no np">{{ post.title }}</span></pre><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es nq"><img src="../Images/e5bd7e13109714b0aea468650bdc3dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PJpHmm3x79y14rb5gvX4HA.png"/></div></div></figure><h2 id="a084" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">注册模板</h2><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="3b15" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">我想指出的一点是<strong class="iv hj">get _ flash _ messages()</strong>从会话中提取所有 flash 消息并返回它们。默认情况下，只返回消息，但是当<em class="le"> with_categories </em>设置为<code class="du nr ns nt ni b">True</code>时，返回值将是一个格式为<code class="du nr ns nt ni b">(category, message)</code>的元组列表。其余的应该像白天一样清楚🌞如果你对<strong class="iv hj"> HTML </strong>和<strong class="iv hj">表单</strong>的工作原理有基本的了解。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es nq"><img src="../Images/98dd4af06a7268445deb450d185822d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pnH2DB2SFPZLQ4IMgzxJyg.png"/></div></div><figcaption class="nu nv et er es nw nx bd b be z dx translated">此处用户已经登录，因此 Flash 消息显示为“您已经登录”</figcaption></figure><h2 id="5a0b" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">登录模板</h2><figure class="kv kw kx ky fd ij"><div class="bz dy l di"><div class="kz la l"/></div></figure><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es nq"><img src="../Images/bb93dce16737e10e9c56514b87b4e689.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cok8Ureo-Go3wLA3ROekaw.png"/></div></div></figure><p id="600d" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">一个我想让你注意的是在“<strong class="iv hj">你的帖子</strong>”、“<strong class="iv hj">注销</strong>”你可以看到文本颜色变暗了，就像我们之前在<strong class="iv hj">base.html 中谈到的那样。</strong></p></div><div class="ab cl im in gp io" role="separator"><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir is"/><span class="ip bw bk iq ir"/></div><div class="hb hc hd he hf"><pre class="kv kw kx ky fd nh ni nj nk aw nl bi"><span id="3024" class="li jt hi ni b fi nm nn l no np">&lt;li class="nav-item"&gt;            <br/>&lt;a class="nav-link {{status}}" href="{{ url_for('members')}}" tabindex="-1" &gt;Your Posts&lt;/a&gt;<br/>&lt;/li&gt;    <br/>&lt;li class="nav-item"&gt;<br/>&lt;a class="nav-link {{status}}" href="{{ url_for('logout')}}" tabindex="-1" &gt;Logout&lt;/a&gt;<br/>&lt;/li&gt;</span></pre><p id="475a" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在 app . py<strong class="iv hj">status = " disabled "</strong>中，直到有人注册或登录(并且用户会话处于活动状态)！所以这些列表项将不能被点击，因为为什么未注册的用户可以注销或查看自己的帖子呢？</p><h2 id="851e" class="li jt hi bd ju lj lk ll jy lm ln lo kc je lp lq kg ji lr ls kk jm lt lu ko lv bi translated">注销模板</h2><p id="5d5d" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">没有注销模板！在这个小博客应用项目中，没有理由创建一个 logout.html 模板。在<strong class="iv hj"> app.py </strong>注销路径<em class="le">/注销</em>将被重定向到<strong class="iv hj">登录</strong>页面，显示您已注销，同时禁用“您的帖子”和“注销”。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es nc"><img src="../Images/71260c51664dc11dfe93f0b435a1c95a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kSkNvfavk2mntgL4.png"/></div></div></figure><h1 id="6524" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">PosgreSQL 用户表单</h1><p id="e82e" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">如果您已经成功设置了一个<strong class="iv hj"> PostgreSQL </strong>数据库和<strong class="iv hj"> SQLAlchemy </strong>，并添加到您的 Flask 应用程序实例中。</p><pre class="kv kw kx ky fd nh ni nj nk aw nl bi"><span id="5d01" class="li jt hi ni b fi nm nn l no np">app.config['SQLALCHEMY_DATABASE_URI'] = 'postgresql://postgres:Password@localhost/Database'</span></pre><p id="febd" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">所以你应该在你的 PostgreSQL 服务器上看到类似的东西。</p><figure class="kv kw kx ky fd ij er es paragraph-image"><div role="button" tabindex="0" class="nd ne di nf bf ng"><div class="er es ny"><img src="../Images/971095e09595043ca71cfaa08dfcafc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/0*EEdbcEWHpZRcUifs.png"/></div></div><figcaption class="nu nv et er es nw nx bd b be z dx translated">密码被“<strong class="bd ju">哈希化</strong>”，因此它已经变成了自身的一个乱码表示。</figcaption></figure><figure class="kv kw kx ky fd ij er es paragraph-image"><div class="er es nz"><img src="../Images/bb4d16e099ef138e9e1daa73f30a9ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/0*Ohm-TqKTeA74bcl0.png"/></div></figure><p id="82f9" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">由于<strong class="iv hj"> __tablename__ </strong>是由“<strong class="iv hj"> users </strong>”和“<strong class="iv hj"> posts </strong>”的名称创建的，所以它也应该在数据库的 Tables 部分中。</p><h1 id="d17c" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">结论</h1><p id="e058" class="pw-post-body-paragraph it iu hi iv b iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ku jo jp jq hb bi translated">在这个 Flask 博客应用项目中，我们已经介绍了很多使用<strong class="iv hj"> PostgreSQL </strong>作为存储用户的关系数据库的内容。</p><p id="5eb8" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">在下一部分中，我们将深入探讨如何在用户和帖子表之间建立一对多的数据库关系，并为用户帖子提供全功能的 CRUD 操作。您可以在下面找到它:</p><div class="lw lx ez fb ly lz"><a href="https://richard-taujenis.medium.com/one-to-many-database-relationship-crud-with-postgresql-and-flask-part-2-3e3e78255ef2" rel="noopener follow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">与 PostgreSQL 和 Flask 的一对多数据库关系(+CRUD)第 2 部分</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">在第 2 部分中，我们将讨论数据库关系(一对多)。过账、编辑、删除和搜索(CRUD 操作)</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">richard-taujenis.medium.com</p></div></div><div class="mi l"><div class="oa l mk ml mm mi mn ik lz"/></div></div></a></div><p id="3b2c" class="pw-post-body-paragraph it iu hi iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq hb bi translated">以下你可以找到 Github 回购❤:</p><div class="lw lx ez fb ly lz"><a href="https://github.com/Mozes721/Flask_Blog_App" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">Mozes721/Flask_Blog_App</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="ob l mk ml mm mi mn ik lz"/></div></div></a></div></div></div>    
</body>
</html>