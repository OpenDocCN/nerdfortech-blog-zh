<html>
<head>
<title>Approaching Infrastructure As Code With Terraform As Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初学者使用 Terraform 将基础设施视为代码</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/approaching-infrastructure-as-code-with-terraform-part-1-86a62f63a00e?source=collection_archive---------13-----------------------#2021-07-23">https://medium.com/nerd-for-tech/approaching-infrastructure-as-code-with-terraform-part-1-86a62f63a00e?source=collection_archive---------13-----------------------#2021-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7cf8a201a58396458bd0cc3ce3b4b517.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TDU7fO7lv4ew6_j1"/></div></div></figure><p id="9084" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform 是一个很棒的配置管理工具，在云世界中用来提供云中的资源。当涉及到管理和编排云中的架构时，它是最棒的自动化工具之一。它有能力吸收数据库、CI/Cd 和许多其他很酷的东西，使应用程序架构更容易处理和管理。Terraform 的声明性很强，只是刷新状态；不重复资源。</p><h1 id="d80d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">核心概念</h1><h2 id="7a6c" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">供应者</h2><p id="6b69" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在将 terraform 连接到任何云提供商、数据库、管道或任何其他外部服务时，有必要拥有提供商文件。它直接负责对平台 API 的理解。通俗地说，它知道如何与任何外部技术交流，你可以查看<a class="ae lf" href="https://registry.terraform.io/browse/providers" rel="noopener ugc nofollow" target="_blank">文档</a>了解不同技术及其提供商的一些细节。更像是将 terraform 代码翻译成第三方提供商能够理解的东西。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e416" class="km jp hi ll b fi lp lq l lr ls">Example:</span><span id="4499" class="km jp hi ll b fi lt lq l lr ls">provider “aws” {</span><span id="df04" class="km jp hi ll b fi lt lq l lr ls">region = “us-west-2”</span><span id="9dff" class="km jp hi ll b fi lt lq l lr ls">access_key = “my-access-key”</span><span id="3d55" class="km jp hi ll b fi lt lq l lr ls">secret_key = “my-secret-key”</span><span id="c933" class="km jp hi ll b fi lt lq l lr ls">}</span></pre><h2 id="2ad5" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">资源</h2><p id="506d" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">要在云上使用和编排的服务和资源需要在 terraform 文件的代码块中正确定义。您可以在这里描述 vpc、子网和其他类型的资源。语法为“资源名称”“内部变量名”；第一部分由 AWS 给出，而第二部分由工程师定义。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="35fa" class="km jp hi ll b fi lp lq l lr ls">Example:</span><span id="cf56" class="km jp hi ll b fi lt lq l lr ls">resource “provider-prefix_name-of-resources” “internal-preffered-name” {</span><span id="f362" class="km jp hi ll b fi lt lq l lr ls">count = 3</span><span id="9412" class="km jp hi ll b fi lt lq l lr ls">vpc = true</span><span id="1940" class="km jp hi ll b fi lt lq l lr ls">}</span></pre><h2 id="8c7d" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">数据</h2><p id="5aec" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在创建资源时，需要过滤一些查询来为特殊的后续操作指定某些资源，这就是数据发挥作用的地方。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="64c7" class="km jp hi ll b fi lp lq l lr ls">Example:</span><span id="31cb" class="km jp hi ll b fi lt lq l lr ls">data “provider-prefix_name-of-resources” “internal-preffered-name” {</span><span id="2fed" class="km jp hi ll b fi lt lq l lr ls">default = true</span><span id="da99" class="km jp hi ll b fi lt lq l lr ls">}</span></pre><p id="bca0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以立即创建一个资源块来执行任何所需的操作。</p><h2 id="d63a" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">输出</h2><p id="c6d1" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">这用于显示 terraform 应用命令执行完毕且基础设施/资源已经运行后的特定结果；它可以用来显示子网 ID，VPC ID 和其他。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="198d" class="km jp hi ll b fi lp lq l lr ls">Example</span><span id="d047" class="km jp hi ll b fi lt lq l lr ls">output “reource-id” {</span><span id="e671" class="km jp hi ll b fi lt lq l lr ls">value = “”</span><span id="7204" class="km jp hi ll b fi lt lq l lr ls">}</span></pre><h2 id="b006" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">可变的</h2><p id="fb24" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">用于声明可以在语法的所有部分引用的某些值。通过使用 terraform apply 并手动插入值，可以为变量赋值。此外，您可以通过使用 terraform apply 命令将该值作为参数传递来分配该值。最后，您可以通过用变量文件赋值来实现这一点，这是最佳实践</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="4253" class="km jp hi ll b fi lp lq l lr ls">Example:</span><span id="b770" class="km jp hi ll b fi lt lq l lr ls">variable “image_id” {</span><span id="3774" class="km jp hi ll b fi lt lq l lr ls">type <strong class="ll hj">=</strong> string</span><span id="4489" class="km jp hi ll b fi lt lq l lr ls">}</span></pre><h2 id="8031" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">Terraform 命令</h2><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="220b" class="km jp hi ll b fi lp lq l lr ls"><strong class="ll hj">Terraform init</strong></span></pre><p id="39a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是为了初始化工作目录，并且在模块化地形配置时非常有用。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="a2b4" class="km jp hi ll b fi lp lq l lr ls"><strong class="ll hj">Terraform plan</strong></span></pre><p id="80a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该命令将比较所需状态和当前状态，并给出将要删除、更改、创建或替换的内容的草稿。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="6f71" class="km jp hi ll b fi lp lq l lr ls"><strong class="ll hj">Terraform apply</strong></span></pre><p id="f7ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个命令只是创建必要的资源，并确保完成所需的状态。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="b22c" class="km jp hi ll b fi lp lq l lr ls"><strong class="ll hj">Terraform destroy</strong></span></pre><p id="3f44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您必须清除云提供商或其他地方的所有资源，这个命令可以帮助您安全地删除它们。</p><h2 id="cd5d" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated"><strong class="ak">不适用</strong></h2><p id="bf5f" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">使用 terraform plan 查看参考资料，用于从配置文件中检查当前状态和期望状态之间的差异。您可以为 apply 命令传递 in -auto-approve 标志，让它自动应用。对于 destroy 命令，如果你想指定某个资源，那么你可以添加一个标志</p><h2 id="e2a2" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated"><strong class="ak">设置凭证</strong></h2><p id="0884" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">设置凭证与配置过程一样重要，因为它提供了对相关平台的基本访问。在 AWS 上设置时，有两种主要方法可用于实现这一点，它们包括:</p><ul class=""><li id="57c7" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn lz ma mb mc bi translated">通过以下格式导出所有凭据:</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="6da4" class="km jp hi ll b fi lp lq l lr ls">access_secret_key=”XXXX” </span></pre><p id="b69c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以毫无问题地应用 terraform 资源。</p><ul class=""><li id="eb79" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn lz ma mb mc bi translated">在中配置凭据。/aws 目录，然后运行:</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="d9c8" class="km jp hi ll b fi lp lq l lr ls">aws configure</span></pre><p id="5f1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并按照列出的步骤进行。</p><h2 id="0508" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated"><strong class="ak">版本控制</strong></h2><p id="131e" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">这用于跟踪存储库中的代码，对于维护代码基础设施的真实性非常重要。打开一个库并根据需要推送代码是很好的，如果你不知道如何推送，那么检查这个<a class="ae lf" href="https://docs.github.com/en" rel="noopener ugc nofollow" target="_blank">文档</a>。此外，有些文件不必放在存储库中，而是放在。gitignore 文件如。terrform/provider、状态文件、tf 变量文件和其他。VCS 的一些原因包括:</p><ul class=""><li id="08ae" class="lu lv hi is b it iu ix iy jb lw jf lx jj ly jn lz ma mb mc bi translated"><em class="md">妥善保管。</em></li><li id="1f82" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn lz ma mb mc bi translated"><em class="md">历史变迁。</em></li><li id="49ab" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn lz ma mb mc bi translated"><em class="md">团队协作。</em></li><li id="2da1" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn lz ma mb mc bi translated"><em class="md">审查有合并请求的基础设施。</em></li></ul><h2 id="375c" class="km jp hi bd jq kn ko kp ju kq kr ks jy jb kt ku kc jf kv kw kg jj kx ky kk kz bi translated">使用 Terraform 的十大最佳实践</h2><ol class=""><li id="3b7e" class="lu lv hi is b it la ix lb jb mj jf mk jj ml jn mm ma mb mc bi translated"><em class="md">对配置进行参数化，使代码可与输入变量一起重用，这样就可以在代码库的不同部分调用它</em></li><li id="3605" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">对于变量，可以通过用变量文件赋值来实现；</em><strong class="is hj"><em class="md">terraform . tfvars .</em></strong><em class="md">这有助于在不同环境下复制基础设施。</em></li><li id="5a3d" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">在变量块中分配变量时，使用等号。</em></li><li id="7252" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">不要在主文件中硬编码凭证和秘密，而是使用</em><strong class="is hj"><em class="md">terraform . TF vars</em></strong><em class="md">来存储它们。</em></li><li id="f3eb" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">申请前先学会使用 terraform 计划，了解各州的区别。</em></li><li id="4ce4" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">不要把秘密文件推送给 git。</em></li><li id="ae70" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated">模块化你的地形配置。</li><li id="0c89" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">将远程文件存储在像 S3 这样的存储单元和其他可用的对象存储选项中。</em></li><li id="3455" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">为每个有输入输出变量的模块生成</em> <strong class="is hj"> <em class="md">自述</em> </strong> <em class="md">。</em></li><li id="aeaf" class="lu lv hi is b it me ix mf jb mg jf mh jj mi jn mm ma mb mc bi translated"><em class="md">在地形状态文件桶上启用版本控制。</em></li></ol><blockquote class="mn"><p id="f557" class="mo mp hi bd mq mr ms mt mu mv mw jn dx translated">总的来说，Terraform 给你一个机会去了解什么可行，什么不可行，然后把它应用到你的下一个基础设施中，并重复使用。</p></blockquote><p id="5b68" class="pw-post-body-paragraph iq ir hi is b it mx iv iw ix my iz ja jb mz jd je jf na jh ji jj nb jl jm jn hb bi translated">还有，会有更多关于 Terraform 的文章，留在身边。现在，请记住，这篇文章不仅仅是为软件领域的专家准备的，即使是新手也可以加入并学到很多东西，这就是为什么我试图用外行和专业术语将一切都讲清楚，所以如果你有任何问题，可以通过 <a class="ae lf" href="https://twitter.com/SamuelArogbonlo" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Twitter </strong> </a> <strong class="is hj">联系我，或者通过</strong><a class="ae lf" href="https://github.com/samuelarogbonlo" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">GitHub</strong></a><strong class="is hj">找到我。</strong></p><p id="d0dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">感谢阅读❤️ </strong></p><p id="a1b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对这个话题有任何想法，请留下评论——我乐于学习和探索知识。</p><h1 id="c952" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">我可以想象这个帖子有多有用，请留下掌声👏下面几次以示对作者的支持！此外，如果你需要一个咨询和自由职业的 DevOps 工程师，我就是你要找的人；雇用我，让我们完成这个项目。</h1></div></div>    
</body>
</html>