<html>
<head>
<title>How to Launch an EC2 Instance with Apache Server using AWS CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 AWS CLI 通过 Apache 服务器启动 EC2 实例</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-launch-an-ec2-instance-with-apache-server-using-aws-cli-d75b23bb909e?source=collection_archive---------1-----------------------#2022-03-27">https://medium.com/nerd-for-tech/how-to-launch-an-ec2-instance-with-apache-server-using-aws-cli-d75b23bb909e?source=collection_archive---------1-----------------------#2022-03-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b987ddc39d2badecda5d1e814c59519d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sWVdOK-GpuvRqdGRxSsKqg.jpeg"/></div></div></figure><h1 id="dcea" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated"><strong class="ak">简介</strong></h1><p id="9197" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">AWS 是云计算领域的市场领导者和顶级创新者。它帮助公司处理各种各样的工作负载，如游戏开发、数据处理、仓储、存档、开发等。但是，AWS 不仅仅是引人注目的浏览器控制台。</p><p id="b1d6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在本项目中，将向您介绍 AWS CLI(命令行界面)。AWS CLI 使您能够通过脚本自动化控制和管理 AWS 服务的整个过程。这些脚本使得用户可以轻松地完全自动化云基础架构。</p><h1 id="b5ac" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">目标</h1><p id="1d45" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在这个项目中，您将使用 AWS CLI 通过 Apache Webserver 创建一个 EC2 实例。实例类型应该是 t2.micro .并且您最终需要验证 Apache Webserver 是使用公共 IP 地址下载和安装的。</p><h1 id="d44e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">先决条件</h1><ul class=""><li id="c9a9" class="kr ks hi jq b jr js jv jw jz kt kd ku kh kv kl kw kx ky kz bi translated">有权允许 AWS EC2 访问的 AWS IAM 用户帐户</li><li id="3380" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">AWS CLI 已安装和配置(参见<a class="ae lf" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank">本</a>文档获取帮助)</li><li id="fc01" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">Vim 文本编辑器已安装</li></ul></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="449c" class="iq ir hi bd is it ln iv iw ix lo iz ja jb lp jd je jf lq jh ji jj lr jl jm jn bi translated">现在让我们开始吧！</h1><h2 id="87a3" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated"><strong class="ak">创建 AWS EC2 密钥对</strong></h2><p id="8f90" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">EC2 密钥对用于在连接到实例时进行身份验证。首次创建实例时，必须向 AWS EC2 提供密钥对。使用以下命令创建密钥对。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="1773" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 create-key-pair --key-name MyKeyPair --query 'KeyMaterial' --output text &gt; MyKeyPair.pem</span></pre><p id="2269" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要验证是否已经创建了密钥对，请使用以下命令。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="47e3" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 describe-key-pairs --key-name MyKeyPair</span></pre><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/ea1568d863f82ebfc93654d3849190f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QOwaJnOkSh0BKKZS5XGhww.jpeg"/></div></div></figure><h2 id="369f" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">为 AWS EC2 创建安全组</h2><p id="dd0b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">AWS 安全组作为防火墙运行，其规则决定哪些网络流量可以进出。</p><p id="3feb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要创建一个安全组，首先你需要知道 VPC(虚拟私有云)ID 号。使用以下命令找出默认的 VPC。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="c595" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 describe-vpcs</span></pre><p id="6052" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这将显示 VPC 信息，如下所示:</p><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/2929a972000669269675a1703713d56e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EcYT0YuZSHR9SqlkujV1ww.jpeg"/></div></div></figure><p id="1ee0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">请记下这个 VPC 身份证号码。您需要该 ID 来创建安全组。</p><p id="4f75" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在使用下面的命令创建一个安全组。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="1a37" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 create-security-group --group-name &lt;Enter a group name&gt; --description "Enter a description" --vpc-id vpc-0bac2b161de3f6b8a</span></pre><p id="5663" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将创建一个安全组，如下所示:</p><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/9d4bcfa0512248d7082682f59bcd7d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3soUUUkDJQgaYM_x97p3Ow.jpeg"/></div></div></figure><p id="c539" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">请记下 GroupId 号。你以后会需要它的。</p><h2 id="ca58" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">向安全组添加规则</h2><p id="defb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">安全组中添加了规则，以允许通过您的方式连接到映像的传入网络流量。</p><p id="ac4f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">例如，如果您想要启动一个 Linux 实例，您通常会添加一个规则来允许 TCP 端口 22 上的入站流量支持 SSH 连接。</p><p id="334b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，您可能希望人们能够通过端口 80(即 HTTP)访问您的 web 服务器。</p><p id="f0dd" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">第一步是找到你的 IP 地址。使用以下命令启动:</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="2526" class="ls ir hi ml b fi mp mq l mr ms">curl <a class="ae lf" href="https://checkip.amazonaws.com" rel="noopener ugc nofollow" target="_blank">https://checkip.amazonaws.com</a></span></pre><p id="a3e2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，输入以下命令来添加规则，以便对同一安全组中的实例启用 SSH:</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="c184" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 authorize-security-group-ingress --group-id &lt;group id&gt; --protocol tcp --port 22 --cidr &lt;ip address&gt;</span></pre><p id="720f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，对于端口 80，输入以下命令:</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="d06a" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 authorize-security-group-ingress --group-id &lt;group id&gt; --protocol tcp --port 80--cidr <em class="mw">0.0.0.0/0</em></span></pre><h2 id="96d7" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">创建用于引导 EC2 实例的脚本</h2><p id="1434" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了确保 AWS 在 EC2 实例上安装 Apache，编写一个 bash 脚本，该脚本将在安装实例时执行。使用 vim 编辑器，通过以下命令打开一个脚本文件:</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="2bc3" class="ls ir hi ml b fi mp mq l mr ms">vim userscripts.sh</span></pre><p id="3d3b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦打开一个空文件，按“I”键进入插入模式。在脚本中输入以下代码。完成后，点击“Esc”并按下“:wq”保存并退出。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="1bb2" class="ls ir hi ml b fi mp mq l mr ms">#!/bin/bash<br/>sudo yum update -y<br/>sudo yum install httpd -y<br/>systemctl enable httpd<br/>systemctl start httpd</span></pre><p id="538d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这段代码将首先更新所有的包，然后安装 apache。最后两个命令将启动并启用该服务。</p><h2 id="d01e" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">AWS EC2 设置先决条件</h2><p id="d32f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">您还需要选择一个 Amazon 机器映像(AMI)来创建 EC2 实例。为此，请转到<a class="ae lf" href="https://us-east-1.console.aws.amazon.com/ec2/v2/home?region=us-east-1#LaunchInstanceWizard" rel="noopener ugc nofollow" target="_blank">这个</a>链接，查找您想要创建的机器，并记下 AMI ID 号。您将需要它来从 CLI 创建 EC2 实例。</p><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/e35591055006290458f0eccf976e681f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lgC2WnXvBxA9nAb2Kh2ZbA.jpeg"/></div></div></figure><h2 id="f157" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">启动 AWS EC2 实例</h2><p id="c1c1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在您已经具备了创建 EC2 实例的一切，所以让我们开始吧。使用以下命令启动 EC2 实例:</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="eff3" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 run-instances --image-id ami-0c02fb55956c7d316 --count 1 --instance-type t2.micro --key-name MyKeyPair --security-group-ids &lt;security group id&gt; --user-data file://userscripts.sh</span></pre><p id="75b5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">成功完成后，使用以下命令验证并获取公共 IP 地址。</p><pre class="mg mh mi mj fd mk ml mm mn aw mo bi"><span id="d48c" class="ls ir hi ml b fi mp mq l mr ms">aws ec2 describe-instances --filter "Name=instance.group-name,Values='week7project-sg'"</span></pre><h2 id="8330" class="ls ir hi bd is lt lu lv iw lw lx ly ja jz lz ma je kd mb mc ji kh md me jm mf bi translated">验证 Apache</h2><p id="2003" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">下一步是测试公共 IP 地址。要做到这一点，请使用 web 浏览器并粘贴 IP 地址。您应该会看到如下所示的页面:</p><figure class="mg mh mi mj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/8b7c1f8c02be6ab719a8daf3d5a14a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xTwMFvr2WnrgAt3mTXYPAw.png"/></div></div></figure><p id="759b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">注意:</strong>在“http”而不是“https”中打开公共 IP 地址。</p><p id="2973" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">祝贺你！！你已经成功地完成了这个项目的目标。</strong></p></div></div>    
</body>
</html>