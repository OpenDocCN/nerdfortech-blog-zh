<html>
<head>
<title>How to Add Light and Temperature Sensors to Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何给树莓派添加光线和温度传感器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-add-light-and-temperature-sensors-to-raspberry-pi-a1e0c7d6d37f?source=collection_archive---------2-----------------------#2021-04-22">https://medium.com/nerd-for-tech/how-to-add-light-and-temperature-sensors-to-raspberry-pi-a1e0c7d6d37f?source=collection_archive---------2-----------------------#2021-04-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c63168d757e7746b4b13fad607b43d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVbISW7xYcONdOQkSHqYyg.png"/></div></div></figure><p id="7fa5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最近我正在用Raspberry Pi做一个小的硬件项目。我想用树莓Pi 3 B+做室内监听。它应该能检测亮度，在天快黑的时候开灯；它还应该能够在室温过低时提醒我关窗。因此，需要光传感器和温度传感器。</p><h1 id="4c34" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">选择传感器</h1><p id="2c7b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">一般来说，添加传感器有两种方式:购买预建的传感器模块或用零件自己构建传感器。</p><p id="ffea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">预建传感器非常容易使用，如果您只是想添加传感器而不考虑太多，这是更好的选择。但就我而言，我更愿意用零件制造自己的传感器，因为我可以学到一些电子学知识，并获得一些经验，以利于我未来的项目。所以我决定制造自己的传感器。</p><p id="99ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">传感器其实很简单。首先，我们需要一个组件根据环境输出电压。这个电压是模拟的，所以我们需要一个ADC将模拟信号转换成数字信号。就是这样。</p><h2 id="9f2d" class="kr jp hi bd jq ks kt ku ju kv kw kx jy jb ky kz kc jf la lb kg jj lc ld kk le bi translated">光敏感元件</h2><p id="58c1" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">对于光传感器，我选择了<a class="ae lf" href="https://www.adafruit.com/product/161" rel="noopener ugc nofollow" target="_blank"> Adafruit 161光电池</a>。这是一个非常便宜的光敏电阻(0.95美元)，Adafruit提供了一个<a class="ae lf" href="http://learn.adafruit.com/photocells" rel="noopener ugc nofollow" target="_blank">的伟大教程</a>。还有，<a class="ae lf" href="https://maker.pro/raspberry-pi/tutorial/how-to-read-an-ldr-sensor-with-raspberry-pi-using-mcp3008" rel="noopener ugc nofollow" target="_blank">有一篇很棒的文章是关于如何搭配树莓派</a>使用的。</p><p id="4049" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">亮度(照度)的单位是<a class="ae lf" href="https://en.wikipedia.org/wiki/Lux" rel="noopener ugc nofollow" target="_blank">勒克斯</a>。维基百科有一个很棒的表格解释了照度和勒克斯。根据该表，我的用例属于20-100勒克斯之间的范围，因此161光电池完全没问题。此外，由于我不关心准确的照度值，并且我没有办法测量它，所以我不需要传感器来提供准确的值。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lg"><img src="../Images/a81a1fbd6853c4ba840f9df7bc3af58b.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*qBkXk9m2oOwFq6brsCha1w.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">对勒克司的直观解释</figcaption></figure><p id="9321" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">光电池需要一个<strong class="is hj">下拉</strong>电阻。典型的连接是这样的:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="ab fe cl lp"><img src="../Images/03f871d8cfe6b58cb8808313ca7f6b93.png" data-original-src="https://miro.medium.com/v2/0*HbzhOnoa_dLj9gRS"/></div></figure><p id="53ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lf" href="https://cdn-learn.adafruit.com/downloads/pdf/photocells.pdf" rel="noopener ugc nofollow" target="_blank">数据手册</a>还演示了如何计算下拉电阻。在我的使用案例中，环境光为10~100勒克斯，光电池电阻在10kω~ 1.5kω之间，因此10kω下拉电阻完全合适。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/a25b3ba294b7a674cd60471e18810032.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*Wx7pY-8uS55Qmwy9kN5luA.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">采用5V电源和10kΩ下拉电阻时光电池电阻与光的关系。来源:<a class="ae lf" href="https://cdn-learn.adafruit.com/downloads/pdf/photocells.pdf" rel="noopener ugc nofollow" target="_blank">数据表</a></figcaption></figure><h2 id="c265" class="kr jp hi bd jq ks kt ku ju kv kw kx jy jb ky kz kc jf la lb kg jj lc ld kk le bi translated">温度传感器</h2><p id="4143" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">对于温度传感器，我选择了德州仪器的<a class="ae lf" href="https://www.ti.com/product/LMT86" rel="noopener ugc nofollow" target="_blank"> LMT86 </a>。这种传感器也很便宜(不到1美元)。</p><p id="96b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我没有选择著名的LM35，因为我不知道什么时候买的零件。但是从<a class="ae lf" href="https://www.ti.com/lit/ds/symlink/lmt86.pdf" rel="noopener ugc nofollow" target="_blank">数据表</a>来看，LMT86似乎完全符合我的需求:</p><ul class=""><li id="40d8" class="lr ls hi is b it iu ix iy jb lt jf lu jj lv jn lw lx ly lz bi translated">快速热时间常数，典型值10s</li><li id="17eb" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">非常精确:典型值0.4℃</li><li id="aff5" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">宽温度范围:-50℃至150℃</li></ul><p id="ee3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从数据手册中的图9可以看出，只要大于2.7V，输出电压几乎与电源电压无关，由于树莓Pi提供的是3.3V，这意味着我们不需要考虑电压差，用常数公式就可以得到温度。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/929402138f603d28bf31099185982124.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*gmWpM7W_DK9lhtLLBWIrfA.png"/></div></figure><p id="c3d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">LMT86响应“几乎”是线性的，它确实有轻微的伞抛物线形状。数据手册在表3中提供了精确的查找表。它还提供了一个<strong class="is hj">不太精确的</strong>抛物线方程</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/bf04c24006f11d1cbce02b6379e7e8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*aiRAFi0rLNlPUc4BF0bTiw.png"/></div></figure><p id="4b28" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，这个等式需要平方根运算。虽然对我的应用程序来说没问题，因为Raspberry Pi是USB驱动的，但这在低功耗设备上可能会有问题。<a class="ae lf" rel="noopener" href="/@tarlanahad/obtaining-better-accuracy-for-lmt87-temperature-sensor-by-using-polynomial-regression-b753b8cc9cc9">另一个公式适合消耗更少功率的线性回归</a>，这在某些情况下可能是有用的。</p><p id="a3d1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于我用的是Raspberry Pi，使用查找表不是问题，所以我选择了最准确的表方法。我创建了一个包<code class="du mh mi mj mk b">lmt8x</code> ( <a class="ae lf" href="https://github.com/charlee/python-lmt8x" rel="noopener ugc nofollow" target="_blank"> GitHub </a>)来使查找更容易。您可以使用以下命令在Raspberry Pi上安装此软件包:</p><pre class="lh li lj lk fd ml mk mm mn aw mo bi"><span id="0847" class="kr jp hi mk b fi mp mq l mr ms">pip install lmt8x</span></pre><p id="eb99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据手册中有一些重要信息需要了解。</p><p id="4dce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，不同封装的引脚配置不同。在低压/LPM组件(LMT86LP、LMT86LPM)中，中心销在外面，而在液化石油气组件(LMT86LPG)中，左销在外面。连接时要小心——错误的连接可能会损坏您的传感器！</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/91656328ffb3647c6135aa4cb2ba39ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*kiTxF2-9L-KFwPDigJxYpw.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">液化石油气，低压，LPM有不同的引脚配置</figcaption></figure><p id="4195" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一件事是“热时间常数”。这是一个衡量温度传感器对真实温度响应速度的指标。尽管LMT86具有快速热时间常数，但它仍然需要大约40秒才能响应正确的温度。实验时请记住这一点——不要在系统启动后立即使用数据！</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/6754b16a8674945f42199ddb13b7d364.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*SCZqDU-w2bb6xPmFDWIlEQ.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">LMT8x系列具有快速的热时间常数，但仍需要大约40秒才能返回正确的温度。</figcaption></figure><h1 id="e0f2" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">模数转换</h1><p id="2a3a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">由于161和LMT86都有模拟输出，而Raspberry PI GPIO只能处理数字输入，因此我们需要一个ADC(模数转换器)将信号转换为数字数据。一种常用的ADC是<a class="ae lf" href="https://www.adafruit.com/product/856" rel="noopener ugc nofollow" target="_blank"> MCP3008 </a> ( <a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank">数据表</a>)，它具有10位分辨率(输出范围从0~1024)和8个输入通道。</p><p id="6311" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">MCP3008支持两种模式:单端模式和差分模式(参见<a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank">数据表</a>表5–2)。在这个应用中，我只需要从传感器读取数据，所以单端模式已经足够好了。</p><p id="e920" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">数据手册还在“5.0串行通信”部分解释了如何从MCP3008读取数据。但幸运的是，Adafruit提供了一个驱动程序<code class="du mh mi mj mk b">adafruit-circuitpython-mcp3xxx</code>，所以我们不必遵循时钟序列。</p><p id="b57b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Adafruit还有一个很棒的<a class="ae lf" href="https://learn.adafruit.com/reading-a-analog-in-and-controlling-audio-volume-with-the-raspberry-pi/overview?view=all" rel="noopener ugc nofollow" target="_blank">教程</a>以及关于如何使用MCP3008的Python代码，所以我在这里省略了细节，只展示了一些图表供参考。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es mv"><img src="../Images/cae10ec08c0710a49c33db8c11f11368.png" data-original-src="https://miro.medium.com/v2/resize:fit:566/format:webp/1*p17qlR98fvpZ9KP5n5L22Q.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">MCP3008引脚配置</figcaption></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/7f209710fd2c8e89d418cd91a705b12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_byT5iJH-iw5sGOgYAqzg.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">树莓Pi 3 B+ GPIO定义</figcaption></figure><p id="d9cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，连接应该是(从MCP3008到Raspberry Pi):</p><ul class=""><li id="be15" class="lr ls hi is b it iu ix iy jb lt jf lu jj lv jn lw lx ly lz bi translated">VDD → 3V3(引脚1)</li><li id="d0c2" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">VREF → 3V3(引脚1)</li><li id="499a" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">AGND → GND(针脚9、25、39)</li><li id="e8d6" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">CLK → SCLK(引脚23)</li><li id="ea04" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">DOUT → MISO(引脚21)</li><li id="fe14" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">德国→ MOSI(引脚19)</li><li id="7a9d" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">CS/SHDN →任何GPIO引脚</li><li id="ff5d" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">DGND → GND(针脚9、25、39)</li></ul><h1 id="d8d4" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">组装原型</h1><p id="4451" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">现在，我们只需将光电池和温度传感器连接到MCP3008的CH0、CH1引脚，然后将MCP3008连接到Raspberry Pi。这是一个简单的示意图:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/c6f0ebba0089813395cea192dfb8ce0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PVKnQl-5m4sZW3slFzu33A.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">MCP3008使用光电池和温度传感器的原理图</figcaption></figure><p id="f59e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我将CS引脚连接到Raspberry Pi上的<code class="du mh mi mj mk b">GPIO22</code>引脚。因此，我必须在代码中使用<code class="du mh mi mj mk b">board.D22</code>。此外，Raspberry Pi有许多冗余引脚(例如，引脚6、9、14、20、25…都是GND)，您可以使用任何方便的引脚。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/86d07cc8fbe96b067cd4fc9dc95eb731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKLr0I3DsnpPmLoplZTVog.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">带Raspberry Pi的试验板连接</figcaption></figure><p id="2a79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的实际实验中，我添加了另一个温度传感器LMT87LPG，以比较两个不同模型的结果。因此，光电池连接到CH0，而LMT87连接到CH1，LMT86连接到CH2。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c63168d757e7746b4b13fad607b43d8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVbISW7xYcONdOQkSHqYyg.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">实际的联系。注意，我还添加了另一个温度LMT87(在第3、4、5列)。</figcaption></figure><p id="014f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在仔细检查了连接之后，我创建了以下代码来测试传感器(我使用的是Python 3):</p><pre class="lh li lj lk fd ml mk mm mn aw mo bi"><span id="6147" class="kr jp hi mk b fi mp mq l mr ms">import os<br/>import math<br/>import time<br/>import busio<br/>import digitalio<br/>import board<br/>import adafruit_mcp3xxx.mcp3008 as MCP<br/>from adafruit_mcp3xxx.analog_in import AnalogIn<br/>from lmt8x import lmt87_v2t, lmt86_v2t</span><span id="fb4f" class="kr jp hi mk b fi mz mq l mr ms"># create the spi bus<br/>spi = busio.SPI(clock=board.SCK, MISO=board.MISO, MOSI=board.MOSI)</span><span id="68af" class="kr jp hi mk b fi mz mq l mr ms"># create the cs (chip select)<br/>cs = digitalio.DigitalInOut(board.D22)</span><span id="90a9" class="kr jp hi mk b fi mz mq l mr ms"># create the mcp object<br/>mcp = MCP.MCP3008(spi, cs)</span><span id="52d0" class="kr jp hi mk b fi mz mq l mr ms"># create an analog input channel on pin 0<br/>chan0 = AnalogIn(mcp, MCP.P0)</span><span id="293c" class="kr jp hi mk b fi mz mq l mr ms"># create an analog input channel on pin 0<br/>chan1 = AnalogIn(mcp, MCP.P1)<br/>time.sleep(0.01)<br/>chan1 = AnalogIn(mcp, MCP.P1)</span><span id="6c71" class="kr jp hi mk b fi mz mq l mr ms">chan2 = AnalogIn(mcp, MCP.P2)<br/>time.sleep(0.01)<br/>chan2 = AnalogIn(mcp, MCP.P2)</span><span id="e0a5" class="kr jp hi mk b fi mz mq l mr ms">while True:<br/>    print('light: %d, %.3fV\t\tlmt87: %d, %.3fC\t\tlmt86: %d, %.3fC' % (<br/>        chan0.value, chan0.voltage,<br/>        chan1.value, lmt87_v2t(chan1.voltage * 1000),<br/>        chan2.value, lmt86_v2t(chan2.voltage * 1000),<br/>    ))<br/>    time.sleep(1)</span></pre><p id="3f65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装依赖项:</p><pre class="lh li lj lk fd ml mk mm mn aw mo bi"><span id="d6ed" class="kr jp hi mk b fi mp mq l mr ms">pip install adafruit-blinka adafruit-circuitpython-mcp3xxx lmt8x</span></pre><p id="330a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行此脚本:</p><pre class="lh li lj lk fd ml mk mm mn aw mo bi"><span id="2cdf" class="kr jp hi mk b fi mp mq l mr ms">python mcp3008-test.py</span></pre><p id="997e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以看到，LMT87和LMT86的结果确实有一点差异(约0.3℃)，但这是可以接受的，我打算使用两者的平均值。我还试图盖住光传感器，并用手指触摸温度传感器。明显的电压/温度变化</p><p id="1d3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">可以从结果中观察到(下面截图中的红框)，表明传感器工作正常。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es na"><img src="../Images/b73443aa5277b9334a395d3e766c4fbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*XOG30Hv5rWdMIXqQ4eAbPQ.png"/></div></figure><h1 id="0ede" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">焊接PCB</h1><p id="893d" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我购买了一些性能板，以便创建一个可用的产品超越试验板。我费了很大劲才把PCB放进我的树莓皮盒子里。perf板不是完美的尺寸，所以我不能简单地使用树莓Pi上的螺丝孔来固定PCB。最简单的方法是将40引脚接头焊接到PCB上，然后简单地将接头插入GPIO引脚。不是很稳定，但已经足够好了。但如果我这样做，PCB将离外壳边缘太远，并且不可能将传感器放置在外壳外部来拾取正确的数字！</p><p id="3ff1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最终采用的解决方案是制作一个独立的ADC板和一个传感器板——ADC板有一个40引脚接头，将插入GPIO引脚并留在外壳内，而传感器板有所有三个传感器，将放在外壳外，并通过跳线连接到ADC板。这不是一个完美的解决方案，但至少对我有效。</p><p id="10b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我为ADC板设计了一个新的设计。PCB看起来像这样:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es nb"><img src="../Images/d155cdd3afb4625da7fea80eef44d2a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*4MovrWLuRVQa17fMgsvSkw.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">我的ADC板的PCB设计。黄色痕迹在顶层，橙色痕迹在底层。</figcaption></figure><p id="89f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一些注意事项:</p><ul class=""><li id="dafd" class="lr ls hi is b it iu ix iy jb lt jf lu jj lv jn lw lx ly lz bi translated">40引脚接头(顶部)焊接到底层，因此所有走线必须从顶层连接。同样，JP1~JP5和MCP3008芯片焊接到顶层，因此走线必须从底层连接。</li><li id="1520" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">在原理图中，我使用GPIO0(引脚27)而不是GPIO22，只是为了使布线更容易。代码需要相应更改:<code class="du mh mi mj mk b">cs = digitalio.DigitalInOUt(board.D0)</code></li><li id="466b" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">MCP3008支持8个通道，但只使用了5个通道。没有足够的空间容纳8个3引脚接头。</li><li id="b030" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">我把一个VCC和一个GND的每个连接器，这使得焊接更加困难。<a class="ae lf" href="https://www.tindie.com/products/cburgess129/10-bit-adcvms-board-hat-for-raspberry-pi-v21/" rel="noopener ugc nofollow" target="_blank">部分产品</a>使用普通VCC和GND引脚。后来，我觉得可能没有必要有多个VCC和GND，共同的VCC会容易得多。</li></ul><p id="cc52" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">传感器板非常简单，我没有创建PCB设计。</p><p id="b4ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最终产品看起来是这样的(<a class="ae lf" href="https://www.reddit.com/r/raspberry_pi/comments/mlt2wa/after_the_adc_i_made_the_sensors_today/" rel="noopener ugc nofollow" target="_blank"> Reddit线程</a>):</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/6b3ef81f11195f6c70cbc14ec7f29eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pnR93J8CGx0ISeop"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">安装在Raspberry Pi上的ADC板(左)和传感器板(右)。请忽略电容器——它们没有被正确使用。有关详细信息，请参见“可能的改进”部分。</figcaption></figure><h1 id="ca0e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">可能的改进</h1><p id="7e3b" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">事实上，我的实验有一些缺陷，可以进一步改进。因为我手里没有必要的零件，而且我对目前的结果很满意，所以我会保持目前的设置，等我拿到所有的零件后再回来。</p><h2 id="eb11" class="kr jp hi bd jq ks kt ku ju kv kw kx jy jb ky kz kc jf la lb kg jj lc ld kk le bi translated">MCP3008的旁路电容</h2><p id="1da4" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在<a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank"> MCP3008数据表</a>的第6.4节“布局考虑”中:</p><blockquote class="nd ne nf"><p id="c51d" class="iq ir ng is b it iu iv iw ix iy iz ja nh jc jd je ni jg jh ji nj jk jl jm jn hb bi translated">该器件应始终使用一个<!-- -->旁路电容，并应尽可能靠近器件引脚放置。建议旁路电容值为1μF。</p></blockquote><p id="7218" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">看起来我需要两个1μF电容用于MCP3008的VCC和VREF引脚。</p><h2 id="0af1" class="kr jp hi bd jq ks kt ku ju kv kw kx jy jb ky kz kc jf la lb kg jj lc ld kk le bi translated">温度传感器的滤波电容器</h2><p id="057f" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><a class="ae lf" href="https://www.ti.com/lit/ds/symlink/lmt86.pdf" rel="noopener ugc nofollow" target="_blank"> LMT86数据表</a>9.2.1.1“设计要求”中提到</p><blockquote class="nd ne nf"><p id="53c0" class="iq ir ng is b it iu iv iw ix iy iz ja nh jc jd je ni jg jh ji nj jk jl jm jn hb bi translated">当ADC对采样电容充电时，它需要来自LMT86温度传感器和许多运算放大器等模拟源输出的瞬时电荷。增加一个电容C_FILTER就可以轻松满足这一要求。</p></blockquote><p id="00c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是数据手册中的数字:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nk"><img src="../Images/fb966dd893984dda0945c7ba818cd35d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmwEw6cTF8KnW1WcNtXPKQ.png"/></div></div></figure><p id="e35a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">于是我查了一下<a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank"> MCP3008数据表</a>发现了以下数据。</p><ul class=""><li id="b969" class="lr ls hi is b it iu ix iy jb lt jf lu jj lv jn lw lx ly lz bi translated">开关电阻:1000ω(<a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank">第4页</a></li><li id="a389" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">样本电容:20pF ( <a class="ae lf" href="https://cdn-shop.adafruit.com/datasheets/MCP3008.pdf" rel="noopener ugc nofollow" target="_blank">第4页</a>)</li><li id="c59e" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">分辨率:10位</li><li id="ef98" class="lr ls hi is b it ma ix mb jb mc jf md jj me jn lw lx ly lz bi translated">采样时间:1 / 100000Hz ( <code class="du mh mi mj mk b">adafruit_blinka</code>驱动<a class="ae lf" href="https://github.com/adafruit/Adafruit_Blinka/blob/master/src/adafruit_blinka/microcontroller/generic_linux/spi.py#L14" rel="noopener ugc nofollow" target="_blank">源</a></li></ul><p id="a754" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基于<a class="ae lf" href="https://www.maximintegrated.com/en/design/technical-documents/app-notes/5/571.html" rel="noopener ugc nofollow" target="_blank">这一页的公式</a>，取<code class="du mh mi mj mk b">R_out = 1kΩ</code>，我们有<code class="du mh mi mj mk b">(R_on + R_out) * C_sample = (1000 + 1000) * 20e-12 = 4e-8</code>，和<code class="du mh mi mj mk b">1 / resolution * T_sample = 0.1 * (1 / 100000) = 1e-6</code>，公式成立。所以很可能我的设计中不需要使用C_FILTER。但无论如何，我给每个温度传感器增加了一个100nF的电容。</p><p id="62e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不幸的是，我的设计可能是错误的:基于<a class="ae lf" href="https://www.reddit.com/r/raspberry_pi/comments/mlt2wa/after_the_adc_i_made_the_sensors_today/gtp7wla?utm_source=share&amp;utm_medium=web2x&amp;context=3" rel="noopener ugc nofollow" target="_blank"> Reddit线程</a>，电容应该尽可能靠近ADC引脚。在我的例子中，我应该为每个输入引脚放置一个电容，即使是光传感器。这个电容还可以滤除走线和电线拾取的噪声。</p><h2 id="914e" class="kr jp hi bd jq ks kt ku ju kv kw kx jy jb ky kz kc jf la lb kg jj lc ld kk le bi translated">使用帽子延伸套件</h2><p id="bfe5" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">从<a class="ae lf" href="https://www.reddit.com/r/raspberry_pi/comments/mknr9m/i_created_an_adc_for_raspberry_pi_w_mcp3008_can/" rel="noopener ugc nofollow" target="_blank">的一个Reddit帖子</a>中，我了解到Adafruit有一个“<a class="ae lf" href="https://www.adafruit.com/product/2310" rel="noopener ugc nofollow" target="_blank"> Perma-Proto HAT </a>工具包，非常适合这样的项目。我肯定会在我的下一个项目中尝试这样做。大声呼喊<a class="ae lf" href="https://www.reddit.com/r/raspberry_pi/comments/mknr9m/i_created_an_adc_for_raspberry_pi_w_mcp3008_can/gthv0ct?utm_source=share&amp;utm_medium=web2x&amp;context=3" rel="noopener ugc nofollow" target="_blank"> Antal_z </a>提供这个！</p><h1 id="6f8a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="fab7" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">基本上，这就是如何使用模拟传感器与树莓派。与预先构建的传感器相比，我更喜欢这种方式，因为我可以完全控制传感器的工作方式。在亚马逊上很难找到模拟传感器。</p><p id="6ffc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个非常基础的项目，来自一个对电容器知之甚少的电子爱好者。我希望这个帖子可以为想做类似项目的人提供一些信息，并请评论任何建议。</p><p id="67b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>