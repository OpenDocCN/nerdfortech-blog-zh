<html>
<head>
<title>React Native: Two Important Lessons I Learned The Hard Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">反应本土:我从惨痛的教训中学到了两个重要的教训</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/react-native-two-important-lessons-i-learned-the-hard-way-3a524bbcef48?source=collection_archive---------0-----------------------#2021-11-17">https://medium.com/nerd-for-tech/react-native-two-important-lessons-i-learned-the-hard-way-3a524bbcef48?source=collection_archive---------0-----------------------#2021-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="ff70" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在构建跨平台应用程序时，注意并防止事情朝着错误的方向发展。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/2f8462ce0cf8708130a80002c537e9cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8-ORnL3mTyS-DJHX"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/@sigmund?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">西格蒙德</a>在<a class="ae jn" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="d39f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi kk translated">发展的头几个月就像跑马拉松的前一百米。构建很简单，代码库很小，没有生产问题或技术债务:生活很美好。一旦我们开始接纳新用户，我们的日常工作就会发生变化。</p><p id="249c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在生产中使用React原生应用程序就像在公海上航行一样。有许多重要的决策需要分析和做出。任何事情都没有标准的解决方案，这可能是最难的一点。你必须聪明，选择最适合你需要的选项。您必须做出的最初决定:</p><ul class=""><li id="cf94" class="kt ku hi jq b jr js ju jv jx kv kb kw kf kx kj ky kz la lb bi translated">Expo或RN CLI</li><li id="f728" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">Redux、Apollo、MobX或上下文API</li><li id="c6ff" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">样式表或样式组件</li><li id="36ca" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">类型脚本或Javascript</li></ul><p id="26dd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">尽管您需要自己决定什么最适合您，但在跨平台开发方面，React Native仍然占据首要位置。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lh"><img src="../Images/30ab501baf3cda571d810a08e32cdc85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nf3Y-IoVKZW2Znb37YHe3g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">统计学家:跨平台框架</figcaption></figure><p id="4c03" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">无论你准备得多么充分，认为你做出了正确的决定，事情都会出错。大多数移动应用程序都超出了应用程序商店的评级，生产中的一次崩溃可能代价高昂。然而，关注重要因素将降低灾难风险(崩溃或性能问题)。</p><h1 id="ca33" class="li lj hi bd lk ll lm ln lo lp lq lr ls io lt ip lu ir lv is lw iu lx iv ly lz bi translated">1.航行</h1><p id="3f69" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">React Native的两个常见问题是屏幕之间的缓慢转换或过时的数据，这两个问题都与导航有关。react-navigation可能会出现各种问题，但最重要的问题之一是我们如何在屏幕之间传递数据。</p><p id="fd82" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">危险信号:导航时传递大量数据会使屏幕依赖于这些数据。</p><p id="1f81" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">每个组件都应该被视为一个独立的视图，我们应该考虑如何用尽可能少的信息导航到那个视图。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="9590" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">您也可以将route对象想象成一个URL。如果档案屏幕有一个网址，那里应该有什么？理解不是所有的数据都应该在参数中是很重要的。参数就像是屏幕的一个选项，它们应该只包含配置显示内容的信息。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="4205" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">像用户对象这样的数据应该在全局存储中，而不是在导航状态中。否则，您会在多个地方复制相同的数据。这可能会导致错误，如显示过时数据的个人资料屏幕。</p><p id="c2cd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">红旗:嵌套导航器</strong></p><p id="cac0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">建议尽量减少嵌套导航器。总是试图用尽可能少的嵌套来实现您想要的行为。嵌套有许多缺点:</p><ul class=""><li id="920f" class="kt ku hi jq b jr js ju jv jx kv kb kw kf kx kj ky kz la lb bi translated">嵌套相同类型的导航器(抽屉内的抽屉，标签内的标签)可能会导致混淆UX。</li><li id="dcbf" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">深度嵌套的视图层次结构会导致低端设备出现内存和性能问题。</li><li id="b310" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated">有了嵌套，当导航到嵌套屏幕时，代码会变得难以理解，配置深层链接会变成一场噩梦。</li></ul><blockquote class="mh mi mj"><p id="c028" class="jo jp mk jq b jr js ij jt ju jv im jw ml jy jz ka mm kc kd ke mn kg kh ki kj hb bi translated">让你的导航器保持水平，在屏幕间导航时传递尽可能少的信息。</p></blockquote><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mo mg l"/></div></figure><h1 id="605b" class="li lj hi bd lk ll lm ln lo lp lq lr ls io lt ip lu ir lv is lw iu lx iv ly lz bi translated">2.动画片</h1><p id="c2ee" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">动画对于创造良好的用户体验是必要的。要使用它们，您应该首先了解React本机架构。它由线程和进程组成，理解它们之间的区别非常重要。</p><h2 id="eb6d" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">什么是线程？</h2><p id="3500" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">这是一条执行的线索。你可以把它想象成一组由CPU执行的指令。</p><h2 id="a5cc" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">什么是过程？</h2><p id="3bfc" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">进程是正在运行的程序，例如浏览器(Chrome、Safari)。通过打开任务管理器，您可以看到计算机上运行的所有进程。</p><h2 id="7d17" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">什么是单线程？</h2><p id="b7e0" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">单线程意味着一个进程只有一个执行线程。这意味着一次只能执行一组指令。</p><h2 id="3384" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">什么是多线程？</h2><p id="af81" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">多线程意味着一个进程有两个或多个线程，它可以同时执行多个指令。</p><h2 id="4613" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">React Native是单线程的</h2><p id="1d4a" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">这意味着对于每个过程；只有一个单线程。因此，如果您有一个具有多种用途的进程，您可能会遇到性能问题。想象一下，有一个进程负责直播，并在视频下方显示评论列表。由于React Native的单线程特性，直播流可能会阻塞评论，反之亦然。</p><h2 id="d22a" class="mp lj hi bd lk mq mr ms lo mt mu mv ls jx mw mx lu kb my mz lw kf na nb ly nc bi translated">React Native是多进程的。</h2><p id="273e" class="pw-post-body-paragraph jo jp hi jq b jr ma ij jt ju mb im jw jx mc jz ka kb md kd ke kf me kh ki kj hb bi translated">RN不是多线程，而是多进程。React Native中运行着三个主要的进程。每个进程都有一个线程与之相连，这就是所有混乱的来源。</p><ul class=""><li id="e49d" class="kt ku hi jq b jr js ju jv jx kv kb kw kf kx kj ky kz la lb bi translated"><strong class="jq hj"> UI线程— </strong>负责渲染IOS和Android视图。</li><li id="2da5" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated"><strong class="jq hj"> JS线程— </strong>负责处理react本地应用的所有逻辑。</li><li id="9b33" class="kt ku hi jq b jr lc ju ld jx le kb lf kf lg kj ky kz la lb bi translated"><strong class="jq hj">React Native Modules Thread—</strong>当应用程序需要访问本机组件时，就会出现这种情况。例如，如果您正在处理动画，您可以使用本机驱动程序来处理您的动画。</li></ul><blockquote class="mh mi mj"><p id="fa0a" class="jo jp mk jq b jr js ij jt ju jv im jw ml jy jz ka mm kc kd ke mn kg kh ki kj hb bi translated">如果您想创建额外的进程，可以通过使用npm模块<a class="ae jn" href="https://github.com/joltup/react-native-threads" rel="noopener ugc nofollow" target="_blank"> react-native-threads </a>来实现。</p></blockquote><p id="8062" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">红旗</strong>:JS线程上运行的动画</p><p id="8d4a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">大多数事情都发生在JS线程上。虽然它在大多数时候都工作得很好，但它可能会被应用程序中正在进行的事情阻塞，导致它缓慢而无响应。这就是<code class="du nd ne nf ng b">useNativeDriver</code>可能会提供帮助的地方。它告诉应用程序在UI而不是JS线程上运行动画。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="af07" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">换句话说，这在Native的世界中运行动画，提供了更高的性能，您不必担心Javascript线程被其他东西阻塞。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="74d7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">或者，您可以使用<a class="ae jn" href="https://reactnative.dev/docs/interactionmanager" rel="noopener ugc nofollow" target="_blank">交互管理器</a>，它允许在动画完成后安排长时间运行的任务。这使得JS动画可以流畅运行。</p></div><div class="ab cl nh ni gp nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hb hc hd he hf"><p id="ede2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">👋快乐编码。</p></div></div>    
</body>
</html>