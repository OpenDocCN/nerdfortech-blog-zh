<html>
<head>
<title>How to handle errors when you mixed up synchronous and async code — Dart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当您混淆同步和异步代码时如何处理错误— Dart</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-handle-errors-when-you-mixed-up-synchronous-and-async-code-dart-2e60d55a037f?source=collection_archive---------10-----------------------#2021-07-02">https://medium.com/nerd-for-tech/how-to-handle-errors-when-you-mixed-up-synchronous-and-async-code-dart-2e60d55a037f?source=collection_archive---------10-----------------------#2021-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4aef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Future 是 dart 中使用最广泛的数据类型之一。我们到处都在使用它们来返回网络响应、进行繁重的计算或任何其他异步任务。</p><p id="c7cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">同步代码中的错误处理是通过<strong class="ih hj"> try-catch </strong>块完成的，而在异步代码中，我们借助<strong class="ih hj"> catchError() </strong>来处理错误</p><p id="c01e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是当我们混淆了同步和异步代码时会发生什么，我们该如何处理呢？同时使用 try-catch 和 catchError()？是的，我们可以用那种方式来做，但是它会立刻使我们的代码变得混乱。</p><p id="7c95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将告诉您我们如何准确地处理由这种混合代码引起的错误。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2a82523462427b7b8e182cd7d8732780.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6GbsJphJPydyuvDX_Tvfmg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="ae jt" href="https://unsplash.com/@universaleye?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Munro 工作室</a>在<a class="ae jt" href="https://unsplash.com/s/photos/tangled?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h2 id="195c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">混在一起的代码是什么样的？</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="4e54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您查看上面的代码，该函数同步抛出一个错误，同时异步调用一个函数(第 5 行)</p><p id="caa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您试图只使用 catchError()来捕捉错误，您很快就会陷入陷阱。</p><p id="1a98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看主要的。镖</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">错误未被捕获😱</figcaption></figure><p id="899e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请看这段 youtube 短片，了解控制流程，</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr kq l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">我听起来确实很滑稽🤣😥</figcaption></figure><p id="abdb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使我们有 catchError()，从<code class="du ks kt ku kv b"><em class="kw">getPersonNameWithId()</em></code> <strong class="ih hj"> <em class="kw"> </em> </strong>引发的错误仍然没有被捕获，因为错误是从同步代码而不是异步代码<strong class="ih hj">引发的。我们知道 catchError()只能捕获异步调用引发的错误。</strong></p><h2 id="f987" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">我们该如何应对？</h2><h2 id="ac89" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated"><strong class="ak"> 1。使用异步关键字(最首选)</strong></h2><p id="5531" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">只要在函数中使用<strong class="ih hj"> async </strong>关键字(即使它并不需要),你就会觉得它与同步和异步代码混淆了。这将把代码中的所有内容包装成一个异步调用。所以里面所有的错误都可以用 catchError()来处理。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">这个函数不一定是“异步”函数，但可以处理它需要的同步错误。</figcaption></figure><h2 id="84e3" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">2.用 Future.sync()包装代码</h2><p id="9e19" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">这类似于使用<strong class="ih hj"> async </strong>关键字<strong class="ih hj">。但是比起 Future.sync()，我更喜欢 async 关键字。</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">这是老东西了(我觉得)。使用 async 关键字。</figcaption></figure><h2 id="0799" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">3.使用区域。</h2><p id="468a" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">根据<a class="ae jt" href="https://api.flutter.dev/flutter/dart-async/Zone-class.html" rel="noopener ugc nofollow" target="_blank">文件</a>，</p><blockquote class="lc ld le"><p id="d47c" class="if ig kw ih b ii ij ik il im in io ip lf ir is it lg iv iw ix lh iz ja jb jc hb bi translated">区域表示在异步调用中保持稳定的环境。</p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated"><strong class="ak">目前不常用的</strong></figcaption></figure><p id="0aab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，一个区域用于捕捉代码(你无法控制的，某个第三方库的源代码)抛出的任何<strong class="ih hj">未被接受的错误</strong>(非致命的)，并在不中断其他区域工作的情况下处理它。</p><p id="45fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">未来在幕后使用区域，我们并不总是明确地使用区域，我给出这个例子是为了让你知道我们也可以使用区域来处理异步错误。</p><h2 id="8e08" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated"><strong class="ak"> 4。使用 await 和 try-catch 块</strong></h2><p id="45d1" class="pw-post-body-paragraph if ig hi ih b ii kx ik il im ky io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">如果您希望您的代码是阻塞的(同步的)，那么您可以使用 await 并将其放入 try-catch 块中来处理这些错误。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kp kq l"/></div></figure></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="5a03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过有意识地编写<strong class="ih hj"/>(这一点很难)并清楚地理解未来和异步函数是如何工作的，我们可以很容易地避免同步和异步代码中未处理的错误。我只想分享当我混淆了同步和异步代码时发生了什么，以及我是如何纠正的。感谢你阅读这篇文章，希望你对这个话题有所了解。</p></div></div>    
</body>
</html>