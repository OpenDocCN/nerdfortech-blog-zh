<html>
<head>
<title>SQL 102: Joins and Join Tables</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 102:连接和连接表</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/sql-102-joins-and-join-tables-d71d0dfc2f4?source=collection_archive---------11-----------------------#2021-07-16">https://medium.com/nerd-for-tech/sql-102-joins-and-join-tables-d71d0dfc2f4?source=collection_archive---------11-----------------------#2021-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/528c526fb72a7dd6f31744c40171d241.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDd6O_AAI2pALJvTGxYLAw.jpeg"/></div></div></figure><p id="47cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我上一篇<a class="ae jo" href="https://kylefarmer85.medium.com/sql-101-create-a-table-insert-data-and-perform-queries-83368766b9fd" rel="noopener">博客</a>中，我们学习了如何创建一个表，插入数据，以及使用 SQL 查询表中的数据。现在，让我们看看如何使用 SQL 进行更复杂的查询，通过连接从两个表中获取数据，以及如何创建单独的连接表！</p><p id="5ca8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上一篇博客中，我们使用了一个<code class="du jp jq jr js b">students</code>表作为例子。让我们来看看如何使用 SQL 再次创建该表:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="eb1c" class="kb kc hi js b fi kd ke l kf kg">CREATE TABLE students(<br/> id INTEGER PRIMARY KEY,<br/> name TEXT,<br/> grade INTEGER,<br/> gpa FLOAT,<br/> tardies INTEGER);</span></pre><p id="b704" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们为老师做一张新桌子。</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="bb8a" class="kb kc hi js b fi kd ke l kf kg">CREATE TABLE teachers(<br/> id INTEGER PRIMARY KEY,<br/> name TEXT,<br/> subject TEXT,<br/> grade INTEGER);</span></pre><p id="1d9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设每个学生都有一个老师。我们怎样才能把学生和他们的老师联系起来？很简单，我们只需要在包含他们老师的<code class="du jp jq jr js b">id</code>的<code class="du jp jq jr js b">students</code>表中添加一列！每个教师的<code class="du jp jq jr js b">id</code>将与<code class="du jp jq jr js b">teachers</code>表上教师的主键相同。<code class="du jp jq jr js b">students</code>表上的<code class="du jp jq jr js b">teacher_id</code>称为<strong class="is hj">外键</strong>。让我们看看如何用<code class="du jp jq jr js b">ALTER TABLE</code>语句添加它:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="dfb5" class="kb kc hi js b fi kd ke l kf kg">ALTER TABLE Orders<br/>  ADD FOREIGN KEY (teacher_id) REFERENCES teachers(id)</span></pre><p id="4b8c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们将一些数据插入到表格中:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="d0e4" class="kb kc hi js b fi kd ke l kf kg">INSERT INTO students (name, grade, gpa, tardies, teacher_id)<br/>  VALUES ("Jake", 12, 3.5, 4, 2);<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Emily", 10, 3.7, 2, 4);<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Sam", 11, 3.5, 3, 1);<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Jordan", 10, 3.6, 2, null);<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Victoria", 9, 3.2, 3, 3);</span><span id="518c" class="kb kc hi js b fi kh ke l kf kg">INSERT INTO teachers (name, grade, subject)<br/>  VALUES ("Mr. Smith", 12, "Math");<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Mrs. Brown", 10, "Science");<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Mrs. Reed", 11, "English");<br/>INSERT INTO students (name, grade, gpa, tardies)<br/>  VALUES ("Mr. Jones", 10, "Music");</span></pre><h2 id="3463" class="kb kc hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">使用内部联接</h2><p id="2aa8" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">我们如何能看到所有学生的名字以及每个学生的老师的名字？我们可以使用<code class="du jp jq jr js b">INNER JOIN</code>将<code class="du jp jq jr js b">teacher_id</code>上的桌子连接起来。</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="017d" class="kb kc hi js b fi kd ke l kf kg">SELECT student.name, teacher.name<br/>FROM students<br/>INNER JOIN teachers<br/>ON students.teacher_id = teacher.id</span></pre><p id="227b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将返回包含学生姓名和每个学生的老师姓名的列的数据行。您可能还注意到，我们现在在写列名时使用了点符号，当 SQL 语句中引用了多个表时，这是必要的。当我们使用一个<code class="du jp jq jr js b">INNER JOIN</code>时，只有在我们连接的列上<em class="lg">没有</em>空数据的行才会被返回。如果我们想要包含没有被分配教师的学生的记录，我们可以使用<code class="du jp jq jr js b">LEFT JOIN</code>。</p><p id="249f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种<code class="du jp jq jr js b">students</code>和<code class="du jp jq jr js b">teachers</code>的关系被称为“具有多个/属于”关系。每个学生“属于”一个老师，每个老师“有许多”学生。当您有这种关系时，外键将足以连接表。</p><h2 id="1749" class="kb kc hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">错认假频伪信号</h2><p id="12d1" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">如果我们选择了很多列，我们的代码会有点冗长。让我们看看如何使用<code class="du jp jq jr js b">AS</code>来别名。首先，让我们看一个选择几个列的例子，然后看看我们如何通过别名表名来清理它:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="5a57" class="kb kc hi js b fi kd ke l kf kg">SELECT student.name, student.grade, student.gpa, teacher.name, teacher.subject<br/>FROM students<br/>INNER JOIN teachers<br/>ON students.teacher_id = teacher.id</span></pre><p id="ce1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让别名<code class="du jp jq jr js b">students</code>和<code class="du jp jq jr js b">teachers</code>:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="565f" class="kb kc hi js b fi kd ke l kf kg">SELECT s.name, s.grade, s.gpa, t.name, t.subject<br/>FROM students AS s<br/>INNER JOIN teachers AS t<br/>ON s.teacher_id = t.id</span></pre><p id="592b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">啊，好多了！我们还可以给列起别名:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="8e16" class="kb kc hi js b fi kd ke l kf kg">SELECT s.name AS student_name, t.name AS teacher_name<br/>FROM students AS s<br/>INNER JOIN teachers AS t<br/>ON s.teacher_id = t.id</span></pre><p id="fa61" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续，我们已经看到了如何用外键引用另一个表，但是如果每个学生都有多个老师，我们该怎么办呢？每行只能有一个<code class="du jp jq jr js b">teacher_id</code>，所以如果每个学生有多个<code class="du jp jq jr js b">teacher_id</code>就不行了。我们需要创建一个连接表！</p><h2 id="3af9" class="kb kc hi bd ki kj kk kl km kn ko kp kq jb kr ks kt jf ku kv kw jj kx ky kz la bi translated">创建连接表</h2><p id="c904" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">由于现在每个学生有很多老师，每个老师又有很多学生，我们称之为多对多关系。每当我们有多对多的关系时，就需要一个连接表。可以查询每个学生有哪些老师，每个老师有哪些学生。所以表中的每一行都包含一个<code class="du jp jq jr js b">teacher_id</code>和一个<code class="du jp jq jr js b">student_id</code>。让我们称之为<code class="du jp jq jr js b">class_assignments</code>，现在创建表格:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="8af2" class="kb kc hi js b fi kd ke l kf kg">CREATE TABLE class_assignments(<br/> student_id INTEGER,<br/> teacher_id INTEGER);</span></pre><p id="c8ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们插入一些数据:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="6de6" class="kb kc hi js b fi kd ke l kf kg">INSERT INTO <!-- -->class_assignments<!-- --> (student_id, teacher_id) VALUES (3, 2)<br/>INSERT INTO <!-- -->class_assignments<!-- --> (student_id, teacher_id) VALUES (1, 2)<br/>INSERT INTO <!-- -->class_assignments<!-- --> (student_id, teacher_id) VALUES (3, 4)<br/>INSERT INTO <!-- -->class_assignments<!-- --> (student_id, teacher_id) VALUES (1, 3)</span></pre><p id="bb7a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们如何创建一个查询来获取学生的教师姓名？让我们以我们的学生“Sam”为例，他的<code class="du jp jq jr js b">id</code>为 3:</p><pre class="jt ju jv jw fd jx js jy jz aw ka bi"><span id="5384" class="kb kc hi js b fi kd ke l kf kg">SELECT teacher.name <br/>FROM teacher<br/>INNER JOIN class_assignments <br/>ON teacher.id <strong class="js hj">=</strong> class_assignments.teacher_id WHERE student.id <strong class="js hj">=</strong> 3;</span></pre><p id="c265" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过将<code class="du jp jq jr js b">teachers</code>表与我们的<code class="du jp jq jr js b">class_assignments</code>连接表连接起来，我们得到了 Sam 所有老师的名字。很整洁，对吧！？</p></div></div>    
</body>
</html>