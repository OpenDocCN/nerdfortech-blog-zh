<html>
<head>
<title>AlphaStar implementation series — Supervised Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AlphaStar 实施系列—监督学习</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/alphastar-implementation-series-part7-d28468c07739?source=collection_archive---------3-----------------------#2021-09-04">https://medium.com/nerd-for-tech/alphastar-implementation-series-part7-d28468c07739?source=collection_archive---------3-----------------------#2021-09-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e06d61f87c8d11d7623bd2ee4434f149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iWmqkHCaEi4djYljh7g5Gw.jpeg"/></div></div></figure><p id="a77c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在过去的帖子中，我展示了如何使用演员-评论家强化学习算法解决 PySC2 的一个小游戏。在具有简单结构的迷你游戏的情况下，代理不需要人类专家数据来进行行为克隆。然而，在实际的 1 对 1 游戏中，由于过多的状态和动作，训练时间呈指数增长。在这篇文章中，我将检查阿尔法星模型实际上可以使用人类重放数据模拟人类的游戏。</p><h1 id="f98d" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">热身</h1><p id="d31a" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">行为克隆最简单的方法是用网络在重放状态下的输出动作和重放动作的差值作为损失值。首先尝试用 OpenAI Gym 的 LunarLander-v2 环境做一个实验，这是一个简单的环境，看看这种方法对演员-评论家强化学习是否真的有效。</p><p id="4444" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解释的<a class="ae kr" href="https://drive.google.com/file/d/1h7qF1LjuICvMrownSnfTuaKUxkoFFUPD/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">代码</a>和<a class="ae kr" href="https://drive.google.com/drive/folders/1oBBGCApt2TzpEC8mSZYrZgrZGaSD2CFt?usp=sharing" rel="noopener ugc nofollow" target="_blank">数据集</a>可以从 Google Drive 下载。</p><p id="740f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我改变 Tensorflow 的<a class="ae kr" href="https://www.tensorflow.org/tutorials/reinforcement_learning/actor_critic" rel="noopener ugc nofollow" target="_blank">影评人官方代码</a>的环境、网络大小，训练它直到奖励达到 200。我用这个<a class="ae kr" href="https://drive.google.com/drive/folders/14PyeXlKr2vKTxm5zctajYBjMLvbZl7sB?usp=sharing" rel="noopener ugc nofollow" target="_blank">训练过的模型</a>用下面的代码创建专家数据。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">收集 A2C 专家数据进行行为克隆的代码</figcaption></figure><p id="8a97" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请尝试理解原代码的每一部分，因为我重用它的代码，使监督学习的一部分。接下来，根据专家数据的作用和网络的作用之间的差异来计算损失。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">A2C 的监督损失</figcaption></figure><p id="d2e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与强化学习的损失不同，对于按奖励计算的批评家网络来说，没有损失。您可以通过运行共享 Jupyter 笔记本文件的下方单元格来开始监督学习。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">A2C 行为克隆的主循环</figcaption></figure><p id="0aa7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">train_supervised_step 是与原始代码的 train_step 函数相对应的函数。完成行为克隆后，您可以使用强化学习方法训练代理。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">行为克隆的 A2C 训练监督步长函数</figcaption></figure><p id="9a4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">run_supervised_episode 函数对应于从实际环境中收集数据的 run_episode 函数。这个函数从我们之前制作的 npy 类型文件中收集用于监督学习的专家数据。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">A2C 的行为克隆运行监督集功能</figcaption></figure><p id="ef76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们可以使用新创建的监督学习来训练强化学习。首先，将我们要训练的模型的动作逻辑和监督模型保存在一起。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">使用监督学习模型运行强化情节</figcaption></figure><p id="ba1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Kl 散度方法可用于计算行动逻辑之间的差异，因为它们是概率分布。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">计算 KL 损失</figcaption></figure><p id="c384" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将计算出的 KL 损耗加到 RL 损耗上来训练模型。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">有 KL 损失的训练强化学习</figcaption></figure><p id="c095" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，代理可以比单独使用强化学习更快地学习，如下图所示。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/19651e74fb8e96ab0e57389f87e25072.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VXFo9Q98jcnRq6wE2GCVJQ.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">监督 A2C 的报酬图</figcaption></figure><h1 id="84b3" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">星际争霸 2 的监督学习</h1><p id="aeed" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在 LunarLander-v2 环境中，仅使用强化学习就可以充分解决这个问题。但像《星际争霸 2》这种有复杂观察和动作空间的情况下，共同使用监督学习来缩短训练时间是很常见的。在 LunarLander-v2 环境中，可以使用通过强化学习训练的模型来生成数据，并且仅针对一个动作计算损失。但是对于星际争霸 2 的情况，人类需要直接玩游戏来收集数据，动作类型和全部 13 个动作参数都需要考虑损耗。</p><ol class=""><li id="a574" class="ld le hi is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated">使用两个兵营陆战队 rush 在 Simple64 地图回放人族 vs 人族的文件:<a class="ae kr" href="https://drive.google.com/drive/folders/1lqb__ubLKLfw4Jiig6KsO-D0e_wrnGWk" rel="noopener ugc nofollow" target="_blank">https://drive . Google . com/drive/folders/1 lqb _ _ ublklfw 4 jiig 6 kso-D0e _ wrng wk</a></li><li id="6cfb" class="ld le hi is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated">PySC2 的监督培训代码:【https://github.com/kimbring2/AlphaStar_Implementation T2】</li></ol><p id="e744" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载重放文件后，需要将其转换为 hkl 文件格式。详见<a class="ae kr" href="https://github.com/kimbring2/AlphaStar_Implementation#supervised-training" rel="noopener ugc nofollow" target="_blank">https://github . com/Kim bring 2/alpha star _ Implementation # supervised-training</a>。</p><p id="f6e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面的代码基本上使用一键编码、分类交叉熵和 L2 正则化来计算 Pysc2 中监督学习的损失，类似于 LunarLander-v2 环境。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="kw kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">PySC2 监督学习的损失函数</figcaption></figure><p id="fcc6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但在《星际争霸 2》中，即使人类执行了特定的动作类型，也可能无法体现，这取决于当前游戏中是否可用。因此，它通过 available_actions 特性进行过滤。此外，即使在 action 参数的情况下，它也会被过滤，因为特定的操作类型只需要有限的 action 参数。</p><p id="a889" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下图是《星际争霸 2》监督学习的损失。由于动作和观察空间的复杂性，训练需要非常长的时间。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/b8605873063f63a30f9aa10a5438777d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cmFn2ckF5_G4_gFJeBk1EA.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">星际争霸 2 的训练损耗图</figcaption></figure><p id="d7e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以下视频是训练好的模型在 5 天左右，使用 1000 左右的专家数据的评估结果。我们可以确认智能体在某种程度上模仿了人类的行为。</p><figure class="ks kt ku kv fd ij"><div class="bz dy l di"><div class="ls kx l"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">星际争霸 2 的监督学习评估</figcaption></figure><h1 id="c173" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="d747" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">在这篇文章中，我们以星际争霸 2 为例，研究了在演员-评论家强化学习中使用专家数据的监督学习方法。考虑到几乎所有实验室外的实际环境都很复杂。人的数据和多种行动方法的损失计算应该被认为是高性能的代理开发的基本要素。</p></div></div>    
</body>
</html>