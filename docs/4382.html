<html>
<head>
<title>Load Testing Using Locust.io</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Locust.io进行负载测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/load-testing-using-locust-io-f3e6e247c74e?source=collection_archive---------0-----------------------#2021-07-19">https://medium.com/nerd-for-tech/load-testing-using-locust-io-f3e6e247c74e?source=collection_archive---------0-----------------------#2021-07-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ec142ae0f7a7e43dfc3e55acaeda3ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JE_p3exLnHyuF13S"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@tingeyinjurylawfirm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">廷杰伤害律师事务所</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3837" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的应用程序或服务运行之后，有一段时间我们想知道我们的服务可以处理的性能和负载。在一定数量的用户尝试访问我们的服务后，服务的性能会下降吗？我们的服务会变得不稳定吗？使用负载测试可以回答所有这些问题。因此，作为开发人员，了解负载测试对我们来说很方便，我们将在这里学习。</p><p id="4006" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是我们必须记住的重要一点是，性能调整通常应该在系统启动并运行之后进行。就像唐纳德·克努特说的:</p><blockquote class="jt ju jv"><p id="bb43" class="iv iw jw ix b iy iz ja jb jc jd je jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated">“过早优化是万恶之源”</p></blockquote><p id="655c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以请确保您没有过早地优化您的应用程序。</p><p id="f288" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将学习如何在Python中使用Locust.io进行负载测试。我们开始吧。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="dc8f" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">Locust.io简介</h1><p id="779b" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">直接取自官方文件。</p><p id="069b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Locust是一个易于使用、可脚本化和可扩展的性能测试工具。</p><h2 id="78d9" class="lk ki hi bd kj ll lm ln kn lo lp lq kr jg lr ls kv jk lt lu kz jo lv lw ld lx bi translated">特征</h2><ul class=""><li id="7492" class="ly lz hi ix b iy lf jc lg jg ma jk mb jo mc js md me mf mg bi translated">用普通的Python编写测试场景</li><li id="9ed9" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">分布式和可扩展—支持成千上万的并发用户</li><li id="e8eb" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">基于网络的用户界面</li><li id="fabe" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">可以测试任何系统</li><li id="22f0" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">可破解的</li></ul><p id="2af8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这些特性，Locust给了我们一些自由来编写测试。我们可以通过编写自定义用户/客户端来对HTTP、XLM-RPC和gRPC服务进行负载测试。此外，最棒的是我们可以直接在web UI上看到测试的统计数据。如果我们必须向非技术人员展示我们的发现，这可能会很方便。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="aecd" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">装置</h1><p id="0efc" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">注意:我们需要Python 3.6或更高版本才能使用Locust.io</p><p id="f7b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">很可能，您需要首先在本地机器上设置一个虚拟环境。隔离我们的工作空间并且不使用全局环境是一个很好的实践。</p><p id="0a18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">使用pip安装Locust。</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="5bb9" class="lk ki hi mr b fi mv mw l mx my">pip install locust</span></pre><p id="79d0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">(或<code class="du mz na nb mr b">pip3 install locust</code>)</p><p id="8487" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过在终端上运行命令<code class="du mz na nb mr b">locust -v</code>来验证我们已经正确安装了Locust。它会给我们成功安装的蝗虫版本号。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="0378" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">从一个简单的例子开始</h1><p id="38e2" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">对于我们要测试的API，我是用FastAPI写的。不过不懂FastAPI也没关系。我将解释API是做什么的。</p><p id="be63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们从一个hello world的例子开始。FastAPI应用程序和蝗虫测试脚本都是如此。</p><figure class="mm mn mo mp fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="63e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面的代码所做的基本上是当我们到达终点<code class="du mz na nb mr b">/hello</code>时给我们<code class="du mz na nb mr b">Hello World</code>响应。短小精悍！</p><p id="964d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，蝗虫测试脚本。</p><figure class="mm mn mo mp fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="d79d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用<code class="du mz na nb mr b">locustfile.py</code>编写上面的代码，你可以在你的终端上运行<code class="du mz na nb mr b">locust</code>命令来运行测试。</p><p id="ed62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">可以在<a class="ae iu" href="http://0.0.0.0:8089/" rel="noopener ugc nofollow" target="_blank"> http://0.0.0.0:8089/ </a>上打开web UI(默认)。然后，你会看到这个。</p><figure class="mm mn mo mp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/c79d809fd7b95b200f3a077cee6350f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*we7UGeVcToB0XvvoXMeGPg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">作者形象</figcaption></figure><p id="a0c5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，您必须指定要模拟的用户数量、其生成率和您的服务API主机URL(因为我使用的是FastAPI，所以默认为<a class="ae iu" href="http://localhost:8000/." rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>)。测试运行一段时间后，您将会看到类似这样的内容。</p><figure class="mm mn mo mp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/54b6b35f30d0eb626a8ef1d188f8f7d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dmmZKE5sRSuSxpqUTAHYJA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">作者形象</figcaption></figure><figure class="mm mn mo mp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ne"><img src="../Images/9380ad4b335ff27c2b4f24a94c3426bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AFzelEYkZL-XHYewvj1kGA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">作者形象</figcaption></figure><p id="5249" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">看起来很整洁，对吗？现在，对测试脚本的解释。</p><p id="7ba0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的测试脚本也非常简单。我们在上面有进口声明。然后，我们定义测试运行时将被模拟的用户类。<code class="du mz na nb mr b">HelloWorldUser</code>类扩展了<code class="du mz na nb mr b">HttpUser</code>类，因为我们的应用程序使用HTTP调用进行交互。<code class="du mz na nb mr b">wait_time</code>用于指定模拟用户在执行任务之间应该等待多长时间，装饰器<code class="du mz na nb mr b">task</code>用于指定<code class="du mz na nb mr b">hello_world</code>方法是一个应该由模拟用户执行的任务。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="b000" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">一个有点超前的例子</h1><p id="5878" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">在这一节中，我们将修改FastAPI应用程序和蝗虫测试脚本。让我们来看看Locust.io更高级的用法。</p><p id="5333" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">FastAPI应用程序:</p><figure class="mm mn mo mp fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="b2b6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然比我们之前的11行代码要长。这段代码是做什么的？</p><ul class=""><li id="02c4" class="ly lz hi ix b iy iz jc jd jg nf jk ng jo nh js md me mf mg bi translated"><code class="du mz na nb mr b">/login</code>:用户必须指定他的用户名和密码来获得令牌(这里我使用了一个虚拟的例子)，因为所有的端点都受到验证过程的保护(不包括<code class="du mz na nb mr b">/hello</code>端点)。因此，要访问所有其他端点，用户必须在其请求头中指定<code class="du mz na nb mr b">login_token</code>。</li><li id="8d68" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated"><code class="du mz na nb mr b">/logout</code>:这里我们基本上通过给出一些虚拟响应让用户注销。</li><li id="a05b" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated"><code class="du mz na nb mr b">/fast</code>和<code class="du mz na nb mr b"> /slow</code>:我放<code class="du mz na nb mr b">time.sleep</code>是为了模拟一些昂贵的工艺。</li><li id="3891" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated"><code class="du mz na nb mr b">/double-me</code>:该端点获取路径参数<code class="du mz na nb mr b">num</code>，然后返回<code class="du mz na nb mr b">num</code>的双精度值。</li><li id="4e6b" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated"><code class="du mz na nb mr b">/square-me</code>:这是一个后方法请求。用户必须指定<code class="du mz na nb mr b">num</code>和<code class="du mz na nb mr b">nums</code>。<code class="du mz na nb mr b">num</code>是数字，<code class="du mz na nb mr b">nums</code>是数字列表。这个端点返回<code class="du mz na nb mr b">num</code>和<code class="du mz na nb mr b">nums</code>的平方值。</li></ul><p id="4e1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">蝗虫测试脚本:</p><figure class="mm mn mo mp fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="6c07" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">哇！这是一段相当长的代码。让我们一点一点地分析这段代码。</p><ul class=""><li id="dc41" class="ly lz hi ix b iy iz jc jd jg nf jk ng jo nh js md me mf mg bi translated"><code class="du mz na nb mr b">TestUser</code>是在测试运行时运行的一类模拟用户。像这个简单的例子一样，它扩展了<code class="du mz na nb mr b">HttpUser</code>。而且，它拥有<code class="du mz na nb mr b">wait_time</code>的财产。</li><li id="1566" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">在这个简单的例子中，我们使用<code class="du mz na nb mr b">task</code> decorator定义了任务。上面的代码为我们提供了一种不同的方式来定义模拟用户必须完成的任务。我们可以像<code class="du mz na nb mr b">fast_task</code>和<code class="du mz na nb mr b">slow_task</code>一样定义函数。注意，这两个函数都可以访问模拟用户(包括属性<code class="du mz na nb mr b">TestUser</code>拥有的属性)。</li><li id="26c6" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">除了将功能定义为任务。我们也可以使用一个类来编写任务。<code class="du mz na nb mr b">ProcessNumberTask</code>扩展了<code class="du mz na nb mr b">TaskSet</code>，然后我们可以像往常一样使用<code class="du mz na nb mr b">task</code>装饰器编写任务。区别在于我们不能直接从<code class="du mz na nb mr b">self</code>访问<code class="du mz na nb mr b">client</code>或模拟用户的属性。我们通过<code class="du mz na nb mr b">self.user</code>访问它们。然后我们可以把<code class="du mz na nb mr b">ProcessNumberTask</code>类放到<code class="du mz na nb mr b">TestUser</code>类的<code class="du mz na nb mr b">tasks</code>属性中。</li><li id="8165" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">就像任何其他常见的应用程序一样，在我们可以访问应用程序提供的功能之前，我们需要登录。请看<code class="du mz na nb mr b">on_start</code>函数定义的第36行。这个函数为每个模拟用户运行。通过提供用户名和密码来请求登录令牌。然后，如果请求成功，我们保存登录令牌，供以后访问其他端点使用。</li><li id="e246" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">在<code class="du mz na nb mr b">on_start</code>函数定义中，我们称端点<code class="du mz na nb mr b">/login</code>为上下文管理器。但是您可以将它用作普通的函数调用。</li><li id="998e" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">在<code class="du mz na nb mr b">on_stop</code>功能定义中，当测试停止时，我们可以为每个模拟用户做一些事情。例如，注销或清除一些会话。</li><li id="b1e6" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">蝗虫为我们提供了事件挂钩。在上面的代码中，我们使用了几个事件挂钩，但是让我们从<code class="du mz na nb mr b">init</code>事件挂钩开始。<code class="du mz na nb mr b">init</code>事件是在每个蝗虫过程开始时触发的。这在分布式模式下尤其有用，在这种模式下，每个工作进程(而不是每个用户)都需要一个机会来进行一些初始化。我们可以生成一个检查器，检查请求的数量是否超过5000，如果超过，测试就停止。注意，我们可以通过<code class="du mz na nb mr b">environment</code>变量访问测试的统计数据。</li><li id="4ec5" class="ly lz hi ix b iy mh jc mi jg mj jk mk jo ml js md me mf mg bi translated">其他事件挂钩是<code class="du mz na nb mr b">test_start</code>和<code class="du mz na nb mr b">test_stop</code>。<code class="du mz na nb mr b">test_start</code>当新的负载测试开始时触发。如果用户数量在测试过程中发生变化，它不会再次触发。同时，<code class="du mz na nb mr b">test_stop</code>在负载测试停止时触发。</li></ul></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="29e1" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">跑步蝗虫分布</h1><p id="dcdc" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">一旦应用程序变大，测试也要变大。一段时间后，单机无法模拟出你期望的使用你app的用户数量。因此，我们需要将负载测试分布在多台机器上。</p><p id="b91a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设您已经有了您的测试脚本。您可以用这个命令在主节点上启动Locust(Locust文件名是<code class="du mz na nb mr b">my_locustfile.py</code>)。</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="b5d7" class="lk ki hi mr b fi mv mw l mx my">locust -f my_locustfile.py --master</span></pre><p id="b646" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后使用以下命令启动工作节点:</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="f86b" class="lk ki hi mr b fi mv mw l mx my">locust -f my_locustfile.py --worker --master-host=192.168.0.14</span></pre><p id="8eea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">用主节点的IP地址替换<code class="du mz na nb mr b">192.168.0.14</code>。</p><p id="410d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另一种分发Locust进程的方法是使用docker。</p><p id="6827" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以使用这个命令来运行使用docker(非分布式)的测试。</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="d05f" class="lk ki hi mr b fi mv mw l mx my">docker run -p 8089:8089 -v $PWD:/mnt/locust locustio/locust -f /mnt/locust/locustfile.py</span></pre><p id="e32c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，您可以使用docker-compose。这是一个如何使用它的例子。</p><figure class="mm mn mo mp fd ij"><div class="bz dy l di"><div class="nc nd l"/></div></figure><p id="2497" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要运行多个worker，您可以使用这个命令(在本例中是4个worker节点)。</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="68c1" class="lk ki hi mr b fi mv mw l mx my">docker-compose up --scale worker=4</span></pre></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="44ac" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated"><strong class="ak">检索CSV格式的测试统计数据</strong></h1><p id="21f7" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">以CSV格式检索我们测试的测试统计数据非常容易。我们要做的就是执行这个命令(假设我们在<code class="du mz na nb mr b">locustfile.py</code>中有我们的负载测试脚本)</p><pre class="mm mn mo mp fd mq mr ms mt aw mu bi"><span id="dbac" class="lk ki hi mr b fi mv mw l mx my">locust --csv=result</span></pre><p id="6406" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将有4个CSV文件:<code class="du mz na nb mr b"> result_exceptions.csv</code>、<code class="du mz na nb mr b">result_failures.csv</code>、<code class="du mz na nb mr b">result_stats.csv</code>和<code class="du mz na nb mr b">result_stats_history.csv</code>。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="de95" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h1><p id="ac63" class="pw-post-body-paragraph iv iw hi ix b iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">在本文中，我们讨论了几个基本的蝗虫用例，从简单的到稍微高级一点的。Locust给了我们一些灵活性，让我们可以根据自己的用例编写自己的测试。不仅为我们提供了我们需要的统计数据，还为我们提供了一个好看的web UI来监控负载测试。尽管我们已经涵盖了相当多的方面，但仍有一些东西被忽略了。例如其他命令行选项、使用配置文件配置、自定义客户端等。所以，你可以在<a class="ae iu" href="https://locust.io/" rel="noopener ugc nofollow" target="_blank">官方文档</a>中找到其余部分。我认为文档写得很好，易于浏览。</p><p id="0586" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以在这里获得本文使用的完整代码:<a class="ae iu" href="https://github.com/agusrichard/python-workbook/tree/master/locust-article-material" rel="noopener ugc nofollow" target="_blank">https://github . com/agusrichard/python-workbook/tree/master/locust-article-material</a></p><p id="dcaa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为补充知识，我还有一个蝗虫负载测试的例子:<a class="ae iu" href="https://github.com/agusrichard/python-workbook/tree/master/load-test-locust" rel="noopener ugc nofollow" target="_blank">https://github . com/agusrichard/python-workbook/tree/master/load-test-Locust</a>。这个测试的API服务的代码在这里:<a class="ae iu" href="https://github.com/agusrichard/go-workbook/tree/master/load-test-experiment" rel="noopener ugc nofollow" target="_blank">https://github . com/agusrichard/go-workbook/tree/master/load-test-experiment</a></p><p id="583d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">感谢您的阅读，如果您认为这篇文章对您有所帮助，请不要犹豫，给这篇文章一些掌声。下次见！</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="8407" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">参考资料:</h1><ul class=""><li id="13f3" class="ly lz hi ix b iy lf jc lg jg ma jk mb jo mc js md me mf mg bi translated">【https://docs.locust.io/en/stable/ T4】</li></ul></div></div>    
</body>
</html>