<html>
<head>
<title>Image Classification using Convolutional Neural Networks (CNN)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用卷积神经网络(CNN)的图像分类</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/image-classification-using-convolutional-neural-networks-cnn-eef587ed0c1?source=collection_archive---------4-----------------------#2021-05-22">https://medium.com/nerd-for-tech/image-classification-using-convolutional-neural-networks-cnn-eef587ed0c1?source=collection_archive---------4-----------------------#2021-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fdd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">众所周知，目前图像分类正变得越来越流行，其应用也在迅速增加。在这篇博客中，我们将使用卷积神经网络对皮肤癌数据进行图像分类。</p><blockquote class="jd je jf"><p id="02a4" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">“我们将从google colab开始，因为python库、它们的依赖关系以及它的云环境都没有问题，所以我们不需要太多配置。”</p></blockquote><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/c45ac37be62335530d55b83a77234821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-JkRVbwr0fd5UOH7K1Ky0Q.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">影像分类工作流程</figcaption></figure><p id="1324" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong> : <em class="jg"> </em>让我们开始实现吧，如果你按照教程一步一步来做，最后就不会出错了。</p><p id="c238" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步</strong>:我们需要在google drive中创建一个名为“<strong class="ih hj"> <em class="jg">【图片分类】</em> </strong>的文件夹。这不是必需的名称，您也可以用另一个名称创建文件夹。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ka"><img src="../Images/62fb6a348e8e06f1226d1fb8802058c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*47gszLQyTpr89v_r1hj9HA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">文件夹创建视图</figcaption></figure><p id="121e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-2 </strong>:现在，我们需要在图像分类文件夹中创建一个文件夹，里面是“<strong class="ih hj"><em class="jg">dataset”</em></strong>，我们将在其中存储我们的训练和测试数据。这不是必需的名称，您也可以用另一个名称创建文件夹。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ka"><img src="../Images/fd5fe5ae661826dd12c292a4db2ed5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CFbHpV79zXVZ23hjOO8x4g.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">文件夹创建视图。</figcaption></figure><blockquote class="jd je jf"><p id="9631" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">您可以使用任何数据集，但在本文中，我将重点关注二元分类，这意味着我将使用的数据集有两个类。对于多类分类，程序将是相同的，但在一些步骤需要很少的变化，我会在下面提到的每一步。</p></blockquote><p id="b96e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong>现在我们需要在<strong class="ih hj"> <em class="jg">【数据集】</em> </strong>文件夹内添加数据，可以使用任何数据集，而我用过的数据集是来自Kaggle，数据是关于<strong class="ih hj"> <em class="jg">【皮肤癌二级分类】</em> </strong>。可以从<a class="ae kb" href="https://drive.google.com/drive/folders/1Aid67MXI7ks0l3y3CsLv4om4n_5zG9dG?usp=sharing" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jg">链接</em> </strong> </a>下载数据集。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kc"><img src="../Images/01d885a38bc0a8bce5be8d1fe59b49f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o6NbLUJGI4I_PRulrRxyFA.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">数据集子文件夹</figcaption></figure><p id="8942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤4: </strong>现在，我们需要在<strong class="ih hj"> <em class="jg">【图像分类】</em> </strong>文件夹中制作一个笔记本，因为我们将在该文件中编写代码，并且还将能够从google drive访问数据集。</p><p id="8ce6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以打开<strong class="ih hj"> <em class="jg">【图像分类】</em> </strong>文件夹然后点击</p><p id="ae83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jg">新- &gt;更多- &gt;谷歌实验室(在文件夹中制作谷歌实验室文件的过程)</em></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kd"><img src="../Images/279f353b0b8365a8a52a5b57a34b9f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tA4WyBI3gnUM1QEId_MluQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">Google-Colab文件创建</figcaption></figure><blockquote class="jd je jf"><p id="20f5" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">现在，我们已经设置了数据集路径和创建的笔记本文件。让我们从皮肤癌症的分类代码开始。</p></blockquote><p id="e734" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第五步:</strong>打开Google-Colab文件，这里我们首先需要挂载google drive来访问<strong class="ih hj"> <em class="jg">【图像分类】</em> </strong>文件夹中存储的数据集。您可以使用下面编写的代码来安装google drive。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="57a7" class="kj kk hi kf b fi kl km l kn ko">from google.colab import drive</span><span id="6e50" class="kj kk hi kf b fi kp km l kn ko">drive.mount(‘/content/drive’)</span></pre><p id="3da9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你运行了上面的代码。它会要求您输入授权码，一旦您添加了授权码，您的google drive就会被安装。</p><blockquote class="jd je jf"><p id="f041" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong> google drive和google colab账号必须相同才能授权。如果google帐户更改，google drive将无法安装。</p></blockquote><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kq"><img src="../Images/875f15bb573a669380a3d6c7c22cb6df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*SqeUY0v5EJi-2CLPufEC3A.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">Google drive已安装</figcaption></figure><p id="cae1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-6: </strong>现在，我们需要导入库，用于数据集读取和CNN(卷积神经网络)模型创建。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="8618" class="kj kk hi kf b fi kl km l kn ko">import os</span><span id="a043" class="kj kk hi kf b fi kp km l kn ko">import cv2</span><span id="828c" class="kj kk hi kf b fi kp km l kn ko">from PIL import Image</span><span id="a21c" class="kj kk hi kf b fi kp km l kn ko">import tensorflow as tf</span><span id="3909" class="kj kk hi kf b fi kp km l kn ko">from keras import backend as K</span><span id="dd2c" class="kj kk hi kf b fi kp km l kn ko">from keras.models import load_model</span><span id="2cde" class="kj kk hi kf b fi kp km l kn ko">from keras.preprocessing.image import img_to_array</span><span id="eb6c" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.optimizers import Adam, RMSprop</span><span id="8eeb" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.callbacks import ReduceLROnPlateau</span><span id="9814" class="kj kk hi kf b fi kp km l kn ko">from tensorflow.keras.preprocessing.image import ImageDataGenerator</span></pre><p id="d088" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤7: </strong>现在，我们需要设置训练、测试和验证目录的路径。您可以只使用(测试和训练文件夹)，不需要使用验证文件夹。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="1f35" class="kj kk hi kf b fi kl km l kn ko">base_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset'</span><span id="c5ff" class="kj kk hi kf b fi kp km l kn ko">train_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train'</span><span id="ef31" class="kj kk hi kf b fi kp km l kn ko">train_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train/benign'</span><span id="7ae4" class="kj kk hi kf b fi kp km l kn ko">train_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/train/malignant'</span><span id="dc0b" class="kj kk hi kf b fi kp km l kn ko">test_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test'</span><span id="42b8" class="kj kk hi kf b fi kp km l kn ko">test_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test/benign'</span><span id="9d8d" class="kj kk hi kf b fi kp km l kn ko">test_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/test/malignant'</span><span id="b821" class="kj kk hi kf b fi kp km l kn ko">valid_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation'</span><span id="fd22" class="kj kk hi kf b fi kp km l kn ko">valid_benign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation/benign'</span><span id="0e10" class="kj kk hi kf b fi kp km l kn ko">valid_malign_dir = '/content/drive/MyDrive/Image Classification/dataset/Skin cancer dataset/validation/malignant'</span></pre><blockquote class="jd je jf"><p id="60d4" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">注意</strong>:点击左侧垂直标签<strong class="ih hj"> - &gt;驱动- &gt;我的驱动- &gt;文件夹路径</strong>中的文件夹，可以选择路径</p></blockquote><p id="487c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤8: </strong>现在，我们需要在操作系统库的帮助下从这些文件夹中获取数据。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="1eb2" class="kj kk hi kf b fi kl km l kn ko">num_benign_train = len(os.listdir(train_benign_dir))</span><span id="cfa9" class="kj kk hi kf b fi kp km l kn ko">num_malignant_train = len(os.listdir(train_malign_dir))</span><span id="2c9b" class="kj kk hi kf b fi kp km l kn ko">num_benign_validaition = len(os.listdir(valid_benign_dir))</span><span id="434f" class="kj kk hi kf b fi kp km l kn ko">num_malignant_validation= len(os.listdir(valid_malign_dir))</span><span id="fd57" class="kj kk hi kf b fi kp km l kn ko">num_benign_test = len(os.listdir(test_benign_dir))</span><span id="c1bd" class="kj kk hi kf b fi kp km l kn ko">num_malignant_test= len(os.listdir(test_malign_dir))</span></pre><p id="dc45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们的Google-Colab有四个包含代码的单元格，如下图所示。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kr"><img src="../Images/f230681e5e5eb9cd2312b02acc008f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RrnyHNqgNOUEA5oVFn7gZQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">前两个单元格</figcaption></figure><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ks"><img src="../Images/6a97e2b275fc8eca3a9da33a9d0c6adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vo31r8zBIR7PH2_ze1ISqQ.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">最后两个单元格</figcaption></figure><p id="142f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤9: </strong>现在，让我们看看，我们的数据集中有多少训练和测试图像？</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="6820" class="kj kk hi kf b fi kl km l kn ko">print("Total Training Benign Images",num_benign_train)</span><span id="49de" class="kj kk hi kf b fi kp km l kn ko">print("Total Training Malignant Images",num_malignant_train)</span><span id="3274" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="4ef9" class="kj kk hi kf b fi kp km l kn ko">print("Total validation Benign Images",num_benign_validaition)</span><span id="9ba0" class="kj kk hi kf b fi kp km l kn ko">print("Total validation Malignant Images",num_malignant_validation)</span><span id="816d" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="50da" class="kj kk hi kf b fi kp km l kn ko">print("Total Test Benign Images", num_benign_test)</span><span id="4194" class="kj kk hi kf b fi kp km l kn ko">print("Total Test Malignant Images",num_malignant_test)</span><span id="e6ec" class="kj kk hi kf b fi kp km l kn ko">total_train = num_benign_train+num_malignant_train</span><span id="9403" class="kj kk hi kf b fi kp km l kn ko">total_validation = num_benign_validaition+num_malignant_validation</span><span id="c388" class="kj kk hi kf b fi kp km l kn ko">total_test = num_benign_test+num_malignant_test</span><span id="dbab" class="kj kk hi kf b fi kp km l kn ko">print("Total Training Images",total_train)</span><span id="a40e" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="3f8c" class="kj kk hi kf b fi kp km l kn ko">print("Total Validation Images",total_validation)</span><span id="02d8" class="kj kk hi kf b fi kp km l kn ko">print("--")</span><span id="8449" class="kj kk hi kf b fi kp km l kn ko">print("Total Testing Images",total_test)</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kt"><img src="../Images/eeb0f49f5345a3871a00e20b11030f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lIgJdDhzhdj-oFyyQi0rVw.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">数据集信息</figcaption></figure><p id="4f59" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">步骤10: 现在，我们需要设置图片的尺寸(高度，宽度)。当数据集图像具有不同大小时，最需要这一步骤，而如果所有数据具有相同的大小时，则我们不需要设置图像大小，但是最好使用小的图像大小，这将加快训练过程。我使用了(240，240)的图像形状。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="5802" class="kj kk hi kf b fi kl km l kn ko">IMG_SHAPE  = 240</span><span id="0af7" class="kj kk hi kf b fi kp km l kn ko">batch_size = 32</span></pre><p id="d421" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤-11: </strong>现在，我们需要对数据进行预处理(训练、测试、验证)，这包括，重缩放和洗牌。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="5e4d" class="kj kk hi kf b fi kl km l kn ko">image_gen_train = ImageDataGenerator(rescale = 1./255)</span><span id="ff93" class="kj kk hi kf b fi kp km l kn ko">train_data_gen = image_gen_train.flow_from_directory(batch_size = batch_size,</span><span id="e442" class="kj kk hi kf b fi kp km l kn ko">directory = train_dir,</span><span id="6fff" class="kj kk hi kf b fi kp km l kn ko">shuffle= True,</span><span id="14ab" class="kj kk hi kf b fi kp km l kn ko">target_size = (IMG_SHAPE,IMG_SHAPE),</span><span id="9c2b" class="kj kk hi kf b fi kp km l kn ko">class_mode = 'binary')</span><span id="af4e" class="kj kk hi kf b fi kp km l kn ko">image_generator_validation = ImageDataGenerator(rescale=1./255)</span><span id="4938" class="kj kk hi kf b fi kp km l kn ko">val_data_gen = image_generator_validation.flow_from_directory(batch_size=batch_size,</span><span id="58c3" class="kj kk hi kf b fi kp km l kn ko">directory=valid_dir,</span><span id="7ec1" class="kj kk hi kf b fi kp km l kn ko">target_size=(IMG_SHAPE, IMG_SHAPE),</span><span id="4675" class="kj kk hi kf b fi kp km l kn ko">class_mode='binary')</span><span id="d869" class="kj kk hi kf b fi kp km l kn ko">image_gen_test = ImageDataGenerator(rescale=1./255)</span><span id="3418" class="kj kk hi kf b fi kp km l kn ko">test_data_gen = image_gen_test.flow_from_directory(batch_size=batch_size,</span><span id="7a4d" class="kj kk hi kf b fi kp km l kn ko">directory=test_dir,</span><span id="be3d" class="kj kk hi kf b fi kp km l kn ko">target_size=(IMG_SHAPE, IMG_SHAPE),</span><span id="dc6f" class="kj kk hi kf b fi kp km l kn ko">class_mode='binary')</span></pre><p id="1b45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Step-12: </strong>在训练之前，我们先检查一下类名，图像数据生成器会使用文件夹名作为类名。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="ab5c" class="kj kk hi kf b fi kl km l kn ko">train_data_gen.class_indices</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ku"><img src="../Images/79360fc479aaa7d7c13fe93911b69d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*4T63PB7FTkPpXFAfkmOe_A.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">类别名称</figcaption></figure><p id="eaf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第13步:</strong>现在，我们需要构建我们定制的CNN(卷积神经网络)架构，它将包括不同的(CNN，dropout，polling，flatten，dense)层。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="b8f8" class="kj kk hi kf b fi kl km l kn ko">skin_classifier = tf.keras.Sequential([</span><span id="049e" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Conv2D(16,(3,3),activation = tf.nn.relu,input_shape=(IMG_SHAPE,IMG_SHAPE, 3)),</span><span id="d031" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.MaxPooling2D(2,2),</span><span id="4e37" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Conv2D(32,(3,3),activation = tf.nn.relu),</span><span id="651b" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.MaxPooling2D(2,2),</span><span id="acbf" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Conv2D(64,(3,3),activation = tf.nn.relu),</span><span id="531e" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.MaxPooling2D(2,2),</span><span id="94e1" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Conv2D(128,(3,3),activation = tf.nn.relu),</span><span id="9537" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.MaxPooling2D(2,2),</span><span id="3787" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Flatten(),</span><span id="ac3f" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Dropout(0.5),</span><span id="35e9" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Dense(512,kernel_regularizer = tf.keras.regularizers.l2(0.001), activation = tf.nn.relu),</span><span id="1750" class="kj kk hi kf b fi kp km l kn ko">tf.keras.layers.Dense(2,activation = tf.nn.sigmoid)</span><span id="e31a" class="kj kk hi kf b fi kp km l kn ko">])</span></pre><blockquote class="jd je jf"><p id="d328" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注:</em> </strong> <em class="hi">以上架构并非取自任何预先训练好的模型，你可以根据自己的需求改变这个架构。</em></p></blockquote><p id="32ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要编译我们定制的CNN(卷积神经网络)模型。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="1890" class="kj kk hi kf b fi kl km l kn ko">skin_classifier.compile(optimizer='adam', loss=tf.keras.losses.sparse_categorical_crossentropy, metrics=['acc'])</span></pre><p id="af28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第15步:</strong>在开始我们的训练过程之前，让我们检查一下编译模型的概要。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="4188" class="kj kk hi kf b fi kl km l kn ko">skin_classifier.summary()</span></pre><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kv"><img src="../Images/97d6c929717f40db1466c4afe48ae910.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*EaMr85qFPyGngjdp4bEFfQ.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">模型架构视图</figcaption></figure><p id="ae5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第16步:</strong>最后，我们需要开始我们的训练过程。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="a735" class="kj kk hi kf b fi kl km l kn ko">history_skin_classifier = skin_classifier.fit(train_data_gen,</span><span id="262e" class="kj kk hi kf b fi kp km l kn ko">steps_per_epoch=(total_train//batch_size),</span><span id="b6b7" class="kj kk hi kf b fi kp km l kn ko">epochs = 5,</span><span id="8171" class="kj kk hi kf b fi kp km l kn ko">validation_data=val_data_gen,</span><span id="9f46" class="kj kk hi kf b fi kp km l kn ko">validation_steps=(total_validation//batch_size),</span><span id="4064" class="kj kk hi kf b fi kp km l kn ko">batch_size = batch_size,</span><span id="1cf1" class="kj kk hi kf b fi kp km l kn ko">verbose = 1)</span></pre><blockquote class="jd je jf"><p id="9a58" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注:</em> </strong> <em class="hi">我在五个历元上训练模型。为了获得更好的结果，可以测试50-60个时期，以达到85%的测试数据准确性。</em></p></blockquote><p id="e1e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jg">如果，你遵循了以上所有步骤，那么现在，你可以看到epochs运行后的第16步代码也显示在下图中。</em>T9】</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kw"><img src="../Images/f9a60878d65a48a4d7a46d118e0a3bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*awVFf1zWjj-aubMSl1gN8g.png"/></div></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">纪元运行视图</figcaption></figure><p id="2831" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤17: </strong>现在，我们可以在测试数据上测试我们的模型了。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="4951" class="kj kk hi kf b fi kl km l kn ko">results = skin_classifier.evaluate(test_data_gen,batch_size=batch_size)</span><span id="669f" class="kj kk hi kf b fi kp km l kn ko">print("test_loss, test accuracy",results)</span></pre><blockquote class="jd je jf"><p id="b517" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注意:</em> </strong> <em class="hi"> </em>在训练和测试数据上的精度，在5个历元上不会很好，但是如果在大历元上训练的话精度会更好。我只训练模型为您提供了一个途径来建立和训练您自己的定制CNN(卷积神经网络)架构。</p></blockquote><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es kx"><img src="../Images/096a414a8828168b1298ef65d1f0cf83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*Cf8bGmFPDmrhusNGLE4cAA.png"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">测试准确度</figcaption></figure><p id="c063" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">步骤-18: </strong>现在，我们可以将我们的模型文件(weights，JSON)保存在google drive中，以备将来对图像数据进行分类。</p><pre class="jl jm jn jo fd ke kf kg kh aw ki bi"><span id="46ce" class="kj kk hi kf b fi kl km l kn ko">model_json = skin_classifier.to_json()</span><span id="a521" class="kj kk hi kf b fi kp km l kn ko">with open("/content/drive/MyDrive/Image Classification/Skin_cancer_classification.json", "w") as json_file:</span><span id="fc1d" class="kj kk hi kf b fi kp km l kn ko">json_file.write(model_json)</span><span id="57f9" class="kj kk hi kf b fi kp km l kn ko">skin_classifier.save("/content/drive/MyDrive/Image Classification/Skin_cancer_classification.h5")</span><span id="26c7" class="kj kk hi kf b fi kp km l kn ko">print("Saved model to disk")</span><span id="152a" class="kj kk hi kf b fi kp km l kn ko">skin_classifier.save_weights("/content/drive/MyDrive/Image Classification/SCC-Weights.h5")</span></pre><blockquote class="jd je jf"><p id="8b9f" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><strong class="ih hj">注:</strong>恭喜你，你已经构建了你定制的CNN(卷积神经网络)架构。本文只关注二进制分类，而您可以在自己的数据上进行测试(二进制或多类分类)。</p></blockquote><p id="2762" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有视频，并想从这些视频中开发一个数据集，请阅读我关于这些的文章，</p><ul class=""><li id="0e4d" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated"><a class="ae kb" rel="noopener" href="/nerd-for-tech/extraction-of-frames-from-a-single-video-2b9fdd901208"> <strong class="ih hj"> <em class="jg">从单个视频中提取帧</em> </strong> </a></li><li id="edcb" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><a class="ae kb" rel="noopener" href="/nerd-for-tech/extraction-of-frames-from-multiple-videos-3ddbced6f3c2"> <strong class="ih hj"> <em class="jg">从多个视频中提取帧</em> </strong> </a></li></ul><p id="1982" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有数据，并想标记为对象检测，对象跟踪等，请阅读我的文章，</p><ul class=""><li id="5bb0" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated"><a class="ae kb" rel="noopener" href="/nerd-for-tech/labeling-data-for-object-detection-yolo-5a4fa4f05844"> <strong class="ih hj"> <em class="jg">为对象检测标注数据</em> </strong> </a></li></ul><p id="ffbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于我:</strong></p><p id="352a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jg">我有一年多的软件开发工作经验。目前，我是一名软件工程师，通过使用零售分析、建立大数据分析工具、创建和维护模型以及加入引人注目的新数据集，为我们的客户改进产品和服务。之前，我是Spark基金会的计算机视觉实习生，在那里我体验了来自不同开源平台(如kaggle、google images、open images等)的视觉数据分析。)，并在该数据上训练不同的深度学习模型。</em></p><ul class=""><li id="4805" class="ky kz hi ih b ii ij im in iq la iu lb iy lc jc ld le lf lg bi translated"><a class="ae kb" href="https://www.linkedin.com/in/muhammadrizwanmunawar/" rel="noopener ugc nofollow" target="_blank"> <em class="jg">在LinkedIn上联系我</em> </a></li><li id="4715" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><a class="ae kb" href="https://www.upwork.com/services/product/consultation-1477666319161577472?ref=project_share" rel="noopener ugc nofollow" target="_blank"> <em class="jg">与我协商</em> </a></li><li id="96bd" class="ky kz hi ih b ii lh im li iq lj iu lk iy ll jc ld le lf lg bi translated"><a class="ae kb" href="https://www.upwork.com/services/product/you-will-get-image-classification-projects-using-machine-learning-with-python-1323963101029052416?ref=project_share" rel="noopener ugc nofollow" target="_blank">T5】我的yolov5服务T7】</a></li></ul><p id="1dab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jg">如有任何问题请在下方随意评论</em> </strong></p></div></div>    
</body>
</html>