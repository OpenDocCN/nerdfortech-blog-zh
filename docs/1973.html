<html>
<head>
<title>Retrieving files from FTP server using Spring Integration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Spring Integration 从 FTP 服务器检索文件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/retrieving-files-from-ftp-server-using-spring-integration-5ccc4a972eaf?source=collection_archive---------1-----------------------#2021-04-15">https://medium.com/nerd-for-tech/retrieving-files-from-ftp-server-using-spring-integration-5ccc4a972eaf?source=collection_archive---------1-----------------------#2021-04-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/099ae9b79d4ea577a114571f49bfe5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UGHSdgfKvsHfGFm2aZ-m6Q.png"/></div></div></figure><p id="6e55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我将向您展示如何使用 Spring Integration 将文件从 FTP 服务器检索到本地目录。</p><p id="2c1c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我使用 Apache FTP 服务器。你可以从这个链接下载最新版本。<strong class="is hj">(</strong><a class="ae jo" href="https://mina.apache.org/ftpserver-project/downloads.html" rel="noopener ugc nofollow" target="_blank"><strong class="is hj"><em class="jp"/></strong></a><strong class="is hj"><em class="jp"/>)</strong>下载并解压文件。</p><p id="964e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如我在标题中提到的，我们需要在 pom.xml 中包含以下 maven 依赖项。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jq"><img src="../Images/9b7c8469252d51195e0dbe94abb33cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTyDnCWiNSrIviAjikj3Ng.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">maven 依赖性</figcaption></figure><p id="8653" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们实现代码。</p><p id="b408" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是 FTP 配置的代码。我创建了一个 FTPConfiguration.java 档案。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jz"><img src="../Images/a4a6215197f87ad3693cd147c36e63d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UccUF2L9e7WyaRi-VhWyaQ.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">FTPConfiguration.java</figcaption></figure><p id="30c9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们看看我们在这里做了什么。</p><p id="bf0d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> sf() </strong></p><p id="1135" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法实例化一个 DefaultFtpSessionFactory 来访问 FTP 服务器，并将 localhost 设置为主机，2121 设置为端口，anonymous 设置为用户名，空字符串设置为密码。</p><p id="d99a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> getFile() </strong></p><p id="45e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法定义并构造了一个 FTPOutboundGateway，绕过了<strong class="is hj"> <em class="jp"> sf() </em> </strong>方法、<strong class="is hj"> <em class="jp"> mget </em> </strong>命令(mget 是用于从 FTP 服务器检索多个文件的 spring FTP 适配器命令)和<strong class="is hj"> <em class="jp">有效负载</em> </strong>参数。这里 ServiceActivator 表示网关是一个 spring 管理的 bean。这个方法的输出是一组文件。我把它命名为<strong class="is hj"><em class="jp">【file results】</em></strong>。它将检索到的文件保存在下载文件夹中。</p><p id="7751" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，FTPOutboundGateway 用于执行远程文件操作，而 Payload 是一组可以执行 get、ls、put 等功能的数据。</p><p id="e96b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">文件结果()</strong></p><p id="f540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该方法创建一个 DirectChannel，并添加一个 wireTap bean 作为拦截器。</p><p id="99ac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，wireTap 方法在将原始消息发送到主通道的同时，将消息的副本创建到次要目标。</p><p id="399e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">记录器()</strong></p><p id="6a1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此方法创建一个日志处理程序对象，并将消息发送到日志通道。这里，窃听通道连接到日志处理程序。</p><p id="6223" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> GateFile 接口</strong></p><p id="6844" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，我向该接口声明了一个 MessagingGateway，FTP mget 作为请求通道，fileResults 作为回复通道。然后，结果被发送给 main 方法一个字符串对象列表</p><p id="cfb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们必须创建一个 runner 方法，将它作为 spring 应用程序运行。</p><p id="578e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是应该包含在 springApplication.java 中的代码</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/019e6d334da950c079fb9f641c76423b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u-QHdAw-4TqbJxVqSIRAOA.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">springApplication.java</figcaption></figure><p id="ca67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，runner()方法将 GateFile 接口作为参数，并获取输出。</p><p id="62f4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是编码部分的全部内容。现在让我们看看如何运行这个应用程序。</p><p id="0fc7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第一步</strong> -启动 FTP 服务器。</p><p id="fc36" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">转到 apache FTP 服务器文件夹中的 bin 文件夹。打开命令提示符并执行以下命令。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/104e5c8f2706eecd8b41a19756d8a30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*01CcTgKbka-gy0szDYEJ8w.png"/></div></div></figure><p id="4914" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个 apache FTP 服务器将文件存储在主文件夹中。<strong class="is hj"><em class="jp">(C:\ Apache-FTP server-1 . 1 . 1 \ Apache-FTP server-1 . 1 . 1 \ RES \ home)</em>T5】</strong></p><p id="1e51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第二步</strong>——运行 spring-boot 应用。</p><h2 id="2ac8" class="kc kd hi bd ke kf kg kh ki kj kk kl km jb kn ko kp jf kq kr ks jj kt ku kv kw bi translated">输出</h2><p id="980d" class="pw-post-body-paragraph iq ir hi is b it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn hb bi translated">它打印存储在下载文件夹中的每个文件的路径。</p></div></div>    
</body>
</html>