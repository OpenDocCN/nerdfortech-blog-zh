<html>
<head>
<title>Introducing Lottie Animations to SwiftUI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI 动画简介</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/introducing-lottie-animations-to-swiftui-7f298e324c23?source=collection_archive---------11-----------------------#2021-06-11">https://medium.com/nerd-for-tech/introducing-lottie-animations-to-swiftui-7f298e324c23?source=collection_archive---------11-----------------------#2021-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6e9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何让 Lottie 动画在 SwiftUI 中很好的播放…之类的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6e07c0f3f7915453f1e8b1f926fb80dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tKQw5rqWYrei0DkXXpwvoA.png"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="b406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">动画是每个应用程序用户体验的一部分。<a class="ae jw" href="https://github.com/zcash/zcash-ios-wallet" rel="noopener ugc nofollow" target="_blank"> Zcash ECC 钱包</a>也不例外。不要误会，SwiftUI 是一个非常强大的制作动画的工具。但是让我们面对现实吧，如果你不是一个专家，你最好使用那些为你做所有繁重工作的工具。</p><h1 id="fe27" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">第一步:谷歌搜索…</h1><p id="1153" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我在 2020 年初没有得到太多，老实说，在发表这篇文章之前也没有得到太多。这里有一些基本的方法，我从这篇文章中的<a class="ae jw" rel="noopener" href="/swlh/how-to-use-lottie-animations-in-swiftui-caaf19944d96">开始。但这有很多问题。</a></p><p id="02e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jw" href="https://gist.githubusercontent.com/spencerfeng/a59106419f0593560dedf88fc39b7662/raw/3233d0b1e46c939648b17379a164290543903dca/LottieView.swift" rel="noopener ugc nofollow" target="_blank">https://gist . githubusercontent . com/Spencer feng/a 59106419 f 0593560 EDF 88 fc 39 b 7662/raw/3233 d0b 1 e 46 c 939648 b 17379 a 164290543903 DCA/loti view . swift</a></p><p id="1312" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，你不会得到比“播放一次”动画更多的东西。此外，任何更新都会被忽略。那很可能不是作者的错。最初的 SwiftUI 文档基本上描述了这种代码。</p><h1 id="af88" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">第二步:了解 UIRepresentable 是如何工作的</h1><p id="5e61" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">也许你正在谷歌搜索摆脱一些紧急情况，你到了这里。但是让我告诉你，如果你能抽出几分钟的时间，阅读这篇来自瓦迪姆·布拉文的非常好的文章，它会给你所需要的知识来理解正在发生的事情，甚至改进我将要描述的代码。</p><p id="039a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">UIViewRepresentable 是一种告诉 SwiftUI 视图结构必须管理 UIKit 视图的方式。您应该知道，视图结构一直被 SwiftUI 渲染引擎重新创建和刷新，出于很好的原因，您不应该知道、假设甚至关心用于在屏幕上表示视图的具体实现是什么。</p><p id="6ea9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这与 UIKit 视图的情况不同。你确实关心这些。这就是为什么 UIViewRepresentable 让你在<em class="lc"> makeUIView </em>和<em class="lc"> updateUIView </em>函数上定义你的 UIView。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="3db2" class="li jy hi le b fi lj lk l ll lm"><strong class="le hj">func</strong> makeUIView(context: UIViewRepresentableContext&lt;LottieAnimation&gt;) -&gt; AnimationView {<br/>  // your instantiation code<br/>}</span><span id="1c1c" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">func</strong> updateUIView(<strong class="le hj">_</strong> uiView: AnimationView, context: UIViewRepresentableContext&lt;LottieAnimation&gt;) { <br/>//leaving this empty is probably a bad idea.<br/>}</span></pre><p id="eed9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你真正想做的是告诉 SwiftUI 如何让 UIKit Lottie 动画视图有家的感觉。为此，有一个协调器关联类型，UIRepresentable 使用它来委托主机/主人角色，以使内容在视图结构和 UIView 子类之间流动。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="a136" class="li jy hi le b fi lj lk l ll lm"><strong class="le hj">func</strong> makeCoordinator() -&gt; Coordinator {<br/>    Coordinator(parent: <strong class="le hj">self</strong>)<br/>}</span></pre><h1 id="5c3c" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">第三步:粘合代码</h1><p id="b3b0" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">我们要做的，是制作一个可再现的视图结构，称为 LottieAnimation，它将带来 Lottie UIView，并将其与可再现的期望进行混合和匹配，这样我们就可以做这些事情:<br/> -在循环中播放动画<br/> -播放动画的一部分<br/> -通过动画进行播放</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="b5e0" class="li jy hi le b fi lj lk l ll lm"><strong class="le hj">enum</strong> AnimationType {</span><span id="5fcf" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">case</strong> progress(progress: Float)</span><span id="5fb4" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">case</strong> frameProgress(startFrame: Float, endFrame: Float, progress: Float, loop: Bool)</span><span id="fd8c" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">case</strong> circularLoop</span><span id="b0c3" class="li jy hi le b fi ln lk l ll lm">}</span></pre><p id="2ad3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的例子中，我有一个单一的动画文件，其中有许多部分，我可能想循环或前进通过。因此，我将创建一个暂停，并恢复洛蒂的动画</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="4e66" class="li jy hi le b fi lj lk l ll lm"><strong class="le hj">func</strong> makeUIView(context: UIViewRepresentableContext&lt;LottieAnimation&gt;) -&gt; AnimationView {</span><span id="1501" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">let</strong> animationView = AnimationView()</span><span id="8afd" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">let</strong> animation = Lottie.Animation.named(filename)</span><span id="f678" class="li jy hi le b fi ln lk l ll lm">animationView.backgroundBehavior = .pauseAndRestore</span><span id="1b4a" class="li jy hi le b fi ln lk l ll lm">animationView.animation = animation</span><span id="4852" class="li jy hi le b fi ln lk l ll lm">animationView.contentMode = .scaleAspectFit</span><span id="430e" class="li jy hi le b fi ln lk l ll lm"><strong class="le hj">return</strong> animationView</span><span id="e635" class="li jy hi le b fi ln lk l ll lm">}</span></pre><p id="aa38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更流畅的动画，我需要得到最后一步的进度。所以我的协调员会知道的</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="0612" class="li jy hi le b fi lj lk l ll lm">class Coordinator: NSObject {<br/>        var lastProgress: Float<br/>        var parent: LottieAnimation<br/>        <br/>        init(parent: LottieAnimation) {<br/>            self.parent = parent<br/>            <br/>            if case AnimationType.frameProgress(let startFrame,_,_,_) = self.parent.animationType {<br/>                self.lastProgress = startFrame<br/>            } else {<br/>                self.lastProgress = 0<br/>            }<br/>        }<br/>    }</span></pre><p id="4064" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后 updateUIView 将完成剩下的工作。这段代码很奇怪，<strong class="ih hj">还好它是</strong>，因为它是 UIKit 的命令海洋与 SwiftUI 的声明河流相遇的地方</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="84cf" class="li jy hi le b fi lj lk l ll lm">func updateUIView(_ uiView: AnimationView, context: UIViewRepresentableContext&lt;LottieAnimation&gt;) {<br/>        guard isPlaying else {<br/>            uiView.stop()<br/>            return<br/>        }<br/>        <br/>        switch self.animationType {<br/>        <br/>        case .circularLoop:<br/>            if !uiView.isAnimationPlaying {<br/>                uiView.play(fromProgress: 0, toProgress: 1, loopMode: .loop, completion: nil)<br/>            }<br/>        case .progress(let progress):<br/>            uiView.currentProgress = AnimationProgressTime(progress)<br/>            if !uiView.isAnimationPlaying {<br/>                uiView.play(fromProgress: 0, toProgress: 1, loopMode: .loop, completion: nil)<br/>            }<br/>        case .frameProgress(let startFrame, let endFrame, let progress, let loop):<br/>            let progressTimeFrame = AnimationFrameTime(startFrame + (progress * (endFrame - startFrame)))</span><span id="5bdc" class="li jy hi le b fi ln lk l ll lm">uiView.play(fromFrame: context.coordinator.lastProgress, toFrame: progressTimeFrame, loopMode: loop ? .loop : .none, completion: nil)<br/>            context.coordinator.lastProgress = progress<br/>        }<br/>    }</span></pre><p id="a02c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要查看完整的代码，请点击项目上的<a class="ae jw" href="https://github.com/zcash/zcash-ios-wallet/blob/0.3.7-112/wallet/wallet/Components/LottieAnimation.swift" rel="noopener ugc nofollow" target="_blank">链接</a></p><h1 id="3b2b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">最后一件事:使用 LottieAnimation 视图</h1><p id="dc14" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">现在我们实际上可以利用它了，就像我用我的应用程序的同步按钮一样！</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="0688" class="li jy hi le b fi lj lk l ll lm">struct SyncingButton&lt;Content: View&gt;: View {<br/>    <br/>    var label: Content<br/>    var animationType: LottieAnimation.AnimationType<br/>    init(animationType: LottieAnimation.AnimationType, <a class="ae jw" href="http://twitter.com/ViewBuilder" rel="noopener ugc nofollow" target="_blank">@ViewBuilder</a> content: () -&gt; Content) {<br/>        self.label = content()<br/>        self.animationType = animationType<br/>    }<br/>    <br/>    var body: some View {<br/>        ZStack {<br/>            LottieAnimation(isPlaying: true, filename: "lottie_button_loading_new", animationType: self.animationType)<br/>            label<br/>        }<br/>    }<br/>}</span></pre><p id="fa61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的 SyncingButton 视图只是创建了一个 ZStack 层，这样我就可以用父视图想要传达的状态来覆盖文本。像这样</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="8454" class="li jy hi le b fi lj lk l ll lm">case .downloading(let progress):<br/>            SyncingButton(animationType: .frameProgress(startFrame: 0, endFrame: 100, progress: 1.0, loop: true)) {<br/>                Text("Downloading \(Int(progress.progress * 100))%")<br/>                    .foregroundColor(.white)<br/>            }</span></pre><p id="2721" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你正在寻找一个使用 SwiftUI 的开源项目，不要这个美妙的 SwiftUI 项目<a class="ae jw" href="https://github.com/zcash/zcash-ios-wallet" rel="noopener ugc nofollow" target="_blank">https://github.com/zcash/zcash-ios-wallet</a></p><p id="7b4a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢阅读！</p></div></div>    
</body>
</html>