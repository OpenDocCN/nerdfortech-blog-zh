<html>
<head>
<title>JavaScript Promises. Part 4 — Promise.all, Promise.any and Promise.race</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript 承诺。第 4 部分— Promise.all、Promise.any 和 Promise.race</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/javascript-promises-part-4-promise-all-promise-any-and-promise-race-eeeceb3ee94e?source=collection_archive---------10-----------------------#2021-05-27">https://medium.com/nerd-for-tech/javascript-promises-part-4-promise-all-promise-any-and-promise-race-eeeceb3ee94e?source=collection_archive---------10-----------------------#2021-05-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经了解到</p><ol class=""><li id="2bc5" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/nerd-for-tech/javascript-promises-part-1-why-promises-d54ed05bdc9f">为什么要推出承诺？</a></li><li id="0106" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/nerd-for-tech/javascript-promises-part-2-fundamentals-e51e36c42fac">承诺基本面。如何创造和消费承诺？</a></li><li id="4778" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated"><a class="ae jm" rel="noopener" href="/nerd-for-tech/javascript-promises-part-3-promise-chaining-707ab6f1bbfc">承诺链</a></li></ol><p id="6ce1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将研究 Promise API 中的一些其他方法以及何时使用它们。</p></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h2 id="ef19" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">承诺。所有</h2><p id="b511" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><code class="du kz la lb lc b"><strong class="ih hj">Promise.all()</strong></code>方法接受一个可迭代的承诺作为输入，并返回一个<code class="du kz la lb lc b">Promise</code></p><p id="e35e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个返回的承诺只有在所有输入承诺都已解析时才会解析，其值将是输入承诺结果的数组。</p><p id="bd52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果任何输入承诺拒绝或抛出错误，返回的承诺将立即拒绝该错误/消息。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/bb8dcd4b82aab9162fd056bf089269f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tX1o27A53ilrj7zldWKRDw.png"/></div></div></figure><p id="059e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，我们将 3 个变量传递给了<code class="du kz la lb lc b">Promise.all</code>方法。</p><ol class=""><li id="7800" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">将立即以值 3 解决的承诺</li><li id="816c" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">这不是承诺。这意味着我们也可以将非承诺值传递给<code class="du kz la lb lc b">Promise.all</code>方法。</li><li id="86d8" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">承诺 1 秒钟后用值<code class="du kz la lb lc b">foo</code>解决。</li></ol><p id="ec1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果执行上面的代码，1 秒后会得到一个响应— <code class="du kz la lb lc b"> <em class="lp">[3, 42, "foo"]</em></code> <em class="lp"> </em>。</p><p id="9732" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么是 1 秒？</p><p id="dce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为<code class="du kz la lb lc b">Promise.all</code>只有在所有输入承诺都解决后才会解决。这里，第三个承诺(使用<code class="du kz la lb lc b">setTimeout</code>)需要 1 秒来解决。这是最后的承诺。所以<code class="du kz la lb lc b">Promise.all</code>1s 后解析。</p><p id="5207" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从示例中可以理解，响应是输入承诺的结果数组。</p><blockquote class="lq lr ls"><p id="9516" class="if ig lp ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated"><strong class="ih hj"> Promise.all </strong>用于当你有多个异步操作需要并行运行，并且一旦<strong class="ih hj">这些操作的所有</strong>完成，你想要执行一些操作。</p></blockquote></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><h2 id="8fc1" class="jz ka hi bd kb kc kd ke kf kg kh ki kj iq kk kl km iu kn ko kp iy kq kr ks kt bi translated">承诺。任何</h2><p id="68aa" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated"><strong class="ih hj"> Promise.any </strong>可以认为是<strong class="ih hj"> Promise.all </strong>的功能反义词。</p><p id="8ec9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也将一个可迭代的承诺作为输入，并返回一个<code class="du kz la lb lc b">Promise</code></p><p id="017f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦其中一个输入承诺实现(解析)，返回的承诺就会解析。</p><p id="cf70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果任何输入承诺拒绝，返回的承诺<strong class="ih hj">不会拒绝</strong>。</p><p id="66cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，如果没有一个输入承诺被解析，那么返回的承诺将被拒绝，并带有一个<code class="du kz la lb lc b"><a class="ae jm" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AggregateError" rel="noopener ugc nofollow" target="_blank">AggregateError</a></code></p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lw"><img src="../Images/e518f3ad3e15894b4343ed0e631aa5c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q8AGeW3EcV30LKQY9vhmjw.png"/></div></div></figure><p id="12a4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，我们有 3 个承诺</p><ol class=""><li id="b94d" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">用值 3 立即拒绝的承诺</li><li id="9bab" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">承诺将在 2 秒后以值'【T1]'解决</li><li id="3249" class="jd je hi ih b ii jn im jo iq jp iu jq iy jr jc ji jj jk jl bi translated">承诺将在 1 秒后解决，值为'【T2 ' '</li></ol><p id="e311" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您执行上面的代码时，您将在 1 秒钟后得到输出'<code class="du kz la lb lc b">resolved first</code>'(第一个解决的承诺)，即使第一个输入的承诺立即拒绝。</p><blockquote class="lq lr ls"><p id="8964" class="if ig lp ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated"><strong class="ih hj"> Promise.any </strong>用于当你有多个异步操作需要并行运行，并且一旦<strong class="ih hj">任何一个</strong>输入承诺解决，你必须执行某个操作，而不考虑其他输入承诺的状态。</p></blockquote></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><p id="2f16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">无极.竞</strong></p><p id="f23c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">诺言.竞赛</strong>类似于<strong class="ih hj">诺言.任何</strong></p><p id="66ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与 Promise.any 等待任何输入承诺解析不同，这个方法<code class="du kz la lb lc b">resolves/rejects</code>在一个输入承诺解析/拒绝后立即执行。</p><p id="249c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你愿意的话，这是一场承诺的竞赛，第一个解决/拒绝的人就是赢家。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lx"><img src="../Images/171ed314c088123b01f27992824f0387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qpQJKo_judjK-58VSxzfkw.png"/></div></div></figure><p id="00c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您从示例中可以理解的，输出将是— <code class="du kz la lb lc b">second Promise</code>，因为它比第一个承诺解决得更快。</p><p id="a0f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将第二个承诺中的<code class="du kz la lb lc b">resolve</code>改为<code class="du kz la lb lc b">reject</code>，则<code class="du kz la lb lc b">catch</code>块将被执行。</p><blockquote class="lq lr ls"><p id="2b8f" class="if ig lp ih b ii ij ik il im in io ip lt ir is it lu iv iw ix lv iz ja jb jc hb bi translated"><strong class="ih hj"> Promise.race </strong>当您有多个异步操作需要并行运行，并且您需要在任何一个输入解析/拒绝后立即执行操作时使用。</p></blockquote></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><p id="06ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">摘要</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ly"><img src="../Images/4f194f0ad0e6c9a4bc4d88131b428c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khRHoOHGCxXuTydnKUUYPA.png"/></div></div></figure></div><div class="ab cl js jt gp ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="hb hc hd he hf"><p id="a1e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们了解了不同的 promise APIs。具体来说，<strong class="ih hj">无极</strong>、<strong class="ih hj">无极</strong>和<strong class="ih hj">无极.竞</strong>。</p><p id="0c34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要阅读该系列的最后一篇文章，关于<strong class="ih hj">异步/等待</strong>，点击<a class="ae jm" rel="noopener" href="/nerd-for-tech/javascript-promises-final-part-async-await-5500fbf4d336">此处</a>。</p><p id="9c3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你觉得这篇文章很有帮助，请鼓掌并分享给你的朋友。如果你有任何建议/意见，请告诉我。一定要关注我，这样才不会错过任何文章。</p></div></div>    
</body>
</html>