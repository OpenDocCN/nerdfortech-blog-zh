<html>
<head>
<title>Basic Setup Of Terraform to Create EC2 Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建EC2实例的Terraform的基本设置</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/basic-setup-of-terraform-to-create-ec2-instance-1dcd51bdcca6?source=collection_archive---------4-----------------------#2022-01-16">https://medium.com/nerd-for-tech/basic-setup-of-terraform-to-create-ec2-instance-1dcd51bdcca6?source=collection_archive---------4-----------------------#2022-01-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f9c0e830a3ad230c2b14b16accf24a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xANKY4zxIHzO_2y4gJsp-w.png"/></div></div></figure><p id="b9bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在本文中讨论的主题。</p><ul class=""><li id="88b4" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">aws_vpc</li><li id="82da" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">aws _子网</li><li id="5212" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">aws _互联网_网关</li><li id="d76f" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">aws _ route _表</li><li id="903a" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">aws _ route _ table _关联</li><li id="008c" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">aws _实例</li></ul><h1 id="cd35" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">什么是Terraform，为什么？</h1><p id="bcbc" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">Terraform是<strong class="is hj">一款开源的基础设施代码软件工具，用于</strong>在AWS、Azure、DigitalOcean、GoogleCloud等云平台上提供基础设施代码。</p><p id="1034" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform是一种工具，可帮助管理基础设施的整个生命周期，将基础设施作为代码使用。这意味着在XXX.tf文件中声明基础设施组件，然后Terraform使用这些组件在各种云提供商中提供、调整和维护基础设施。</p><h2 id="17fb" class="lg ke hi bd kf lh li lj kj lk ll lm kn jb ln lo kr jf lp lq kv jj lr ls kz lt bi translated">如何连接云提供商(AWS)？</h2><p id="3300" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated"><strong class="is hj">第一步</strong> :-在你的系统中安装Terraform。使用下面的脚本并在你的ubuntu系统中执行或者参考<a class="ae lu" href="https://learn.hashicorp.com/tutorials/terraform/install-cli" rel="noopener ugc nofollow" target="_blank">https://learn.hashicorp.com/tutorials/terraform/install-cli</a></p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="3175" class="lg ke hi ma b fi me mf l mg mh">#!bin/bash<br/>sudo apt-get update</span><span id="6c83" class="lg ke hi ma b fi mi mf l mg mh">sudo apt-get update &amp;&amp; sudo apt-get install -y gnupg software-properties-common curl</span><span id="6afa" class="lg ke hi ma b fi mi mf l mg mh">curl -fsSL https://apt.releases.hashicorp.com/gpg | sudo apt-key add -</span><span id="3e8b" class="lg ke hi ma b fi mi mf l mg mh">sudo apt-add-repository "deb [arch=amd64] https://apt.releases.hashicorp.com $(lsb_release -cs) main"</span><span id="e809" class="lg ke hi ma b fi mi mf l mg mh">sudo apt-get update &amp;&amp; sudo apt-get install terraform</span></pre><p id="c0b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">地形命令:-</p><p id="c9f7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">terraform init-back end-config = " ACCESS _ KEY = $ AWS _ ACCESS _ KEY _ ID "-back end-config = " SECRET _ KEY = $ AWS _ SECRET _ ACCESS _ KEY ":-将terra form与您的云提供商连接。</p><p id="1a5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">地形初始化:-初始化特定项目的地形。</p><p id="c2bb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">地形图:-显示所有组件部署图。</p><p id="60df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">terraform应用/ terraform应用-自动批准:-开始在您的云提供商中部署您的组件。</p><p id="37cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">terraform destroy/terra form destroy-auto-approve:-开始销毁您的云提供商中保存在您的terra form状态中的组件，而不是全部。</p><p id="7f45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">步骤2 </strong> :-创建一个S3桶来保存地形的状态。</p><p id="e228" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">第3步</strong> :-我们有多种方式向云提供商进行认证，我们使用最推荐的方式。</p><p id="e00f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在/添加您的凭据。AWS/凭据位置。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="2d73" class="lg ke hi ma b fi me mf l mg mh">[default]<br/>aws_access_key_id = XXXXXX<br/>aws_secret_access_key = XXXXXX</span></pre><p id="093d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里我们使用main.tf文件来配置后端并连接到云提供商。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="f4be" class="lg ke hi ma b fi me mf l mg mh">terraform {</span><span id="3143" class="lg ke hi ma b fi mi mf l mg mh">    backend "s3" {</span><span id="e9c5" class="lg ke hi ma b fi mi mf l mg mh">        bucket = "XXXX" // provide created s3 bucket name</span><span id="337c" class="lg ke hi ma b fi mi mf l mg mh">        key = "state/main/key" // path of saved state</span><span id="315e" class="lg ke hi ma b fi mi mf l mg mh">        region = "us-east-2" // </span><span id="3752" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="25de" class="lg ke hi ma b fi mi mf l mg mh">}</span><span id="9356" class="lg ke hi ma b fi mi mf l mg mh">provider "aws" {</span><span id="a69f" class="lg ke hi ma b fi mi mf l mg mh">    region = "us-east-2"</span><span id="e997" class="lg ke hi ma b fi mi mf l mg mh">    shared_credentials_file = "$HOME/.aws/credentials"</span><span id="6949" class="lg ke hi ma b fi mi mf l mg mh">    profile = "XXX"<br/>}</span></pre><p id="71a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们运行terraform计划或在内部应用terraform时，创建一个部署或依赖流，所有tf文件将在计划或应用时合并。</p><h1 id="17b3" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">aws_vpc</h1><p id="2b1a" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">虚拟私有云，vpc是亚马逊网络服务云的一个逻辑隔离部分。我们可以根据需要创建多个子网，公共或私有，私有子网的机器不能通过公共互联网访问。</p><p id="5d04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们通过terraform创建vpc</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="dee8" class="lg ke hi ma b fi me mf l mg mh">resource "aws_vpc" "aws-vpc" {</span><span id="883d" class="lg ke hi ma b fi mi mf l mg mh">    cidr_block       = "10.0.0.0/16"</span><span id="d930" class="lg ke hi ma b fi mi mf l mg mh">    instance_tenancy = "default"</span><span id="980d" class="lg ke hi ma b fi mi mf l mg mh">    enable_dns_support = "true"</span><span id="7dfe" class="lg ke hi ma b fi mi mf l mg mh">    enable_dns_hostnames = "true"</span><span id="c1dc" class="lg ke hi ma b fi mi mf l mg mh">    enable_classiclink = "false"</span><span id="c48c" class="lg ke hi ma b fi mi mf l mg mh">    tags = {</span><span id="0040" class="lg ke hi ma b fi mi mf l mg mh">        Name = "XXX"</span><span id="deb1" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="7570" class="lg ke hi ma b fi mi mf l mg mh">}<br/>resource "aws_internet_gateway" "vpc-internet-gateway" {</span><span id="2c99" class="lg ke hi ma b fi mi mf l mg mh">    vpc_id = aws_vpc.aws-vpc.id</span><span id="b72f" class="lg ke hi ma b fi mi mf l mg mh">}</span></pre><h1 id="7af0" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">aws _子网</h1><p id="7734" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">子网或子网络，每个子网必须属于一个vpc。子网是IP网络的逻辑划分，分为多个更小的网段。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="a2ee" class="lg ke hi ma b fi me mf l mg mh">resource "aws_subnet" "aws-subnet" {</span><span id="3fb1" class="lg ke hi ma b fi mi mf l mg mh">    vpc_id = aws_vpc.aws-vpc.id</span><span id="74df" class="lg ke hi ma b fi mi mf l mg mh">    cidr_block = "10.0.0.0/24"</span><span id="ab10" class="lg ke hi ma b fi mi mf l mg mh">    map_public_ip_on_launch = "true"</span><span id="b3fd" class="lg ke hi ma b fi mi mf l mg mh">    availability_zone = "us-east-2a"</span><span id="9a2e" class="lg ke hi ma b fi mi mf l mg mh">    tags = {</span><span id="6602" class="lg ke hi ma b fi mi mf l mg mh">        Name = "subnet-private-1"</span><span id="95e0" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="c5ee" class="lg ke hi ma b fi mi mf l mg mh">}</span></pre><h1 id="d10a" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">aws _ route _表</h1><p id="b4f9" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">路由表包含一组称为路由的关系，用于解析来自子网或网关的网络流量的定向位置。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="2d14" class="lg ke hi ma b fi me mf l mg mh">resource "aws_route_table" "route-table" {</span><span id="b495" class="lg ke hi ma b fi mi mf l mg mh">    vpc_id = aws_vpc.aws-vpc.id</span><span id="0662" class="lg ke hi ma b fi mi mf l mg mh">    route {</span><span id="fe8f" class="lg ke hi ma b fi mi mf l mg mh">        cidr_block = "0.0.0.0/0"</span><span id="4b97" class="lg ke hi ma b fi mi mf l mg mh">        gateway_id = aws_internet_gateway.vpc-internet-gateway.id</span><span id="d39c" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="2580" class="lg ke hi ma b fi mi mf l mg mh">    tags = {</span><span id="950f" class="lg ke hi ma b fi mi mf l mg mh">        Name = "route-table"</span><span id="ba66" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="2d52" class="lg ke hi ma b fi mi mf l mg mh">}<br/>resource "aws_route_table_association" "route-table-association" {</span><span id="61d3" class="lg ke hi ma b fi mi mf l mg mh">    subnet_id      = aws_subnet.aws-subnet.id</span><span id="ca37" class="lg ke hi ma b fi mi mf l mg mh">    route_table_id = aws_route_table.route-table.id</span><span id="8751" class="lg ke hi ma b fi mi mf l mg mh">}</span></pre><h1 id="aa9b" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">aws _实例</h1><p id="4a31" class="pw-post-body-paragraph iq ir hi is b it lb iv iw ix lc iz ja jb ld jd je jf le jh ji jj lf jl jm jn hb bi translated">aws_instance为<strong class="is hj">提供了一个EC2实例资源</strong>。它授权创建、更新和删除实例。实例也支持资源调配。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="5c60" class="lg ke hi ma b fi me mf l mg mh">resource "aws_instance" "aws-instance" {</span><span id="970e" class="lg ke hi ma b fi mi mf l mg mh">    ami           = "ami-00399ec92321828f5"</span><span id="6ce9" class="lg ke hi ma b fi mi mf l mg mh">    instance_type = "t3.medium"</span><span id="a6b9" class="lg ke hi ma b fi mi mf l mg mh">    key_name = "XXX"</span><span id="a3c8" class="lg ke hi ma b fi mi mf l mg mh">    availability_zone = "us-east-2a"</span><span id="945c" class="lg ke hi ma b fi mi mf l mg mh">    vpc_security_group_ids = [ aws_security_group.XXX.id ]</span><span id="3ede" class="lg ke hi ma b fi mi mf l mg mh">    tags = {</span><span id="4807" class="lg ke hi ma b fi mi mf l mg mh">        Name = "aws-EC2-instance"</span><span id="5157" class="lg ke hi ma b fi mi mf l mg mh">    }</span><span id="de3c" class="lg ke hi ma b fi mi mf l mg mh">    private_ip = "10.0.0.60"</span><span id="77de" class="lg ke hi ma b fi mi mf l mg mh">    subnet_id  = data.aws_subnet.aws-subnet.id</span><span id="a09a" class="lg ke hi ma b fi mi mf l mg mh">}</span></pre><p id="76de" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我希望你在这里学到了新东西。</p><p id="1ed9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢你的time☺️</p></div><div class="ab cl mj mk gp ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="hb hc hd he hf"><p id="ad94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有任何与JS/Terraform相关的疑问，请随时联系社交媒体</p><p id="b36a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae lu" href="https://instagram.com/rkstarji?igshid=j6twh39s09n9" rel="noopener ugc nofollow" target="_blank">https://instagram.com/rkstarji</a></p><p id="d6ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">https://twitter.com/RkStarJi<a class="ae lu" href="https://twitter.com/RkStarJi/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>