<html>
<head>
<title>Jenkins and Jib | Build and upload images to private Docker Repo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jenkins和Jib |构建图像并上传到私人Docker Repo</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/jenkins-and-jib-build-and-upload-images-to-private-docker-repo-ecba60696f84?source=collection_archive---------5-----------------------#2021-03-16">https://medium.com/nerd-for-tech/jenkins-and-jib-build-and-upload-images-to-private-docker-repo-ecba60696f84?source=collection_archive---------5-----------------------#2021-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9d44db4ea417c25aa78319bfd1378a1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2LRe1Y3qCj5_cB1G"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@jjying?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> JJ英</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="1db9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几天前，我需要从头开始创建一个没有任何模板的新项目，该项目应该能够将Micronaut用作无服务器框架。我的申请是用科特林语写的。最后，它应该像网络服务器一样工作，部署在Kubernetes上。首先，有三个关键组件。第一个是应用程序本身。此应用程序需要转换为docker图像。下一部分是管道。它需要运行一些自动化测试，如果测试成功，就构建整个映像。它还应该将图像推送到artifactory或任何其他私有docker repo。最后一部分是Kubernetes集群，它部署了舵图。在本教程中，我将只看前两步。稍后我将创建一篇关于此主题的文章。</p><h1 id="7630" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">从应用程序创建docker图像</h1><p id="de99" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">首先，我们需要有一个经过测试并正在运行的应用程序。下一步是将<a class="ae iu" href="https://github.com/GoogleContainerTools/jib/tree/master/jib-gradle-plugin#build-your-image" rel="noopener ugc nofollow" target="_blank"> google jib </a>插件添加到你的插件中。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="4228" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我还添加了来自网飞的<a class="ae iu" href="https://github.com/nebula-plugins/nebula-release-plugin" rel="noopener ugc nofollow" target="_blank">星云发布插件</a>，用于这些图像的语义发布。</p><p id="9e1d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在充分发挥jib插件的潜力之前，您需要对它进行配置。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="1fb8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一部分与Dockerfile文件中的相同。您还可以从<a class="ae iu" href="https://hub.docker.com/_/openjdk" rel="noopener ugc nofollow" target="_blank"> openjdk:14-alpine </a>构建它，这是一个超轻量级的java映像。第二部分是为了出版。它将您的图像上传到您定义的目的地，并用项目版本对其进行标记。对于私人回购，您需要用用户名和密码定义auth部分。</p><p id="e4cb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，您可以运行jib命令来创建新图像。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="4449" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您在这里看到的，有两种方法可以释放并构建这样一个映像。第一行创建一个名为的图像，格式为:</p><p id="4b75" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lc"> &lt;专业&gt;。&lt;小调&gt;。&lt;补丁&gt; -dev。#+ &lt;哈希&gt;T14】</em></p><p id="41e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第二行使用nebula插件的final关键字。看起来是这样的。</p><p id="a6ca" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="lc"> v &lt;专业&gt;。&lt;小调&gt;。&lt;贴片&gt; -rc。# </em></p><p id="9c79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">其中<code class="du ld le lf lg b">#</code>是到目前为止该版本的候选发布版本的数量。</p><h1 id="abe3" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建您的构建管道</h1><p id="c1a9" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我创建了一个新的詹金斯管道，但你也可以使用任何其他管道系统。重要的部分在詹金斯的档案里。让我们来看看吧。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="c493" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实际上，这个文件最重要的部分是发布-发布阶段。它使用私有docker repo的凭据。这些凭证需要在Jenkins中定义。如果您想了解如何在Jenkins中创建新凭证，请点击<a class="ae iu" href="https://www.jenkins.io/doc/book/using/using-credentials/" rel="noopener ugc nofollow" target="_blank">此处</a>。如果我们仔细看看这几行，我们可以看到我们有一个If子句，它要么在git commit上没有以“v”开头的标记时创建一个devSnapshot，要么用最后一个git标记创建一个最终版本。</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="a67b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，如果一切正常，您现在应该能够在您的私有docker repo中看到一些映像，无论是devSnapshots还是最终版本。如果是这样，…恭喜你！你刚刚把你的第一张照片推给了码头工人。</p><h1 id="12ec" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">反射</h1><h2 id="1736" class="lh ju hi bd jv li lj lk jz ll lm ln kd jg lo lp kh jk lq lr kl jo ls lt kp lu bi translated">什么进展顺利？</h2><p id="4923" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">码头工人形象的建立非常成功。Google Jib插件在创建这些图像方面做得非常好。这些图像比预期的要快，并且易于创建。</p><h2 id="9e42" class="lh ju hi bd jv li lj lk jz ll lm ln kd jg lo lp kh jk lq lr kl jo ls lt kp lu bi translated">有哪些需要改进的地方？</h2><p id="def1" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">首先，我在docker图像的语义版本方面遇到了一些问题。读了一段时间的文件后，我发现我做错了什么。我漏掉了release.useLastTag前面的-P。我遇到的第二个问题是，我忘记在Jib插件的配置中添加一个认证条款。我想知道为什么我的图像不能被推送到回购，但这是清楚的，因为它需要认证。</p><p id="85e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你能学到一些东西。😊</p></div></div>    
</body>
</html>