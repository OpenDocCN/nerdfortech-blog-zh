<html>
<head>
<title>An investigative guide to React JS[DOM, Virtual DOM and JSX] Part-IV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">调查指南反应JS[DOM，虚拟DOM和JSX]第四部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/an-investigative-guide-to-react-js-dom-virtual-dom-and-jsx-part-iv-9c8220340a06?source=collection_archive---------3-----------------------#2022-03-10">https://medium.com/nerd-for-tech/an-investigative-guide-to-react-js-dom-virtual-dom-and-jsx-part-iv-9c8220340a06?source=collection_archive---------3-----------------------#2022-03-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="95c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第三部分<a class="ae jd" href="https://www.pansofarjun.com/post/an-investigative-guide-to-react-js-dom-virtual-dom-and-jsx-part-iii" rel="noopener ugc nofollow" target="_blank">的亮点</a></p><ul class=""><li id="a610" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">JS的真正目的是增加网页的动态性</li><li id="c0e4" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">大多数情况下，这是通过用户与页面的交互来实现的。这些被称为<strong class="ih hj">事件</strong>。</li><li id="7d28" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">我们创建JS函数来增加动态性。这些被称为<strong class="ih hj">事件监听器。</strong></li><li id="9535" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">我们通过DOM查询来访问DOM。</li><li id="b257" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated"><em class="js">事件检测(点击、选择、调整页面大小等)→触发JS函数(包含DOM查询)→ DOM和事件监听器连接。</em></li><li id="622a" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">当您构建像脸书这样的大型交互式应用程序时，这个过程会变得复杂</li></ul><h1 id="8477" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">是什么让DOM操作变得缓慢？</h1><p id="4e83" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">DOM基本上是一个<strong class="ih hj">树形数据结构</strong>。树形数据结构使得DOM的改变和更新更快。那是什么让它慢了？每当我们更新一个节点(父节点)时，即使子节点没有变化，它的子节点也会被重新渲染(即更新)。如果应用程序包含许多节点和子节点，这种不必要的重新渲染会使速度变慢。<em class="js">记住，由于树形数据结构，更新速度很快，但在屏幕上绘画会使更新速度变慢(即显示)。</em> <strong class="ih hj"> <em class="js">这是因为与</em> </strong> <strong class="ih hj"> <em class="js">关联的整个子节点被重新绘制在屏幕上。</em> </strong></p><blockquote class="kw kx ky"><p id="ae98" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">在一个</em> </strong> <em class="hi"> </em> <strong class="ih hj"> <em class="hi">浏览器上下文中，DOM对象是javascript对象</em> </strong></p></blockquote><h1 id="78ab" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">React只是在原始DOM之前添加了另一个层</h1><p id="a07a" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">到目前为止，我们已经看到了HTML/CSS/JS在浏览器中是如何工作的。浏览器总是使用DOM。在大型应用程序中频繁操作DOM会降低性能。所以我们需要找到一种在浏览器中操作DOM的有效方法。此外，这种方式不应该改变浏览器的DOM模型。这让我们想到下一件事，无论我们创建什么样的库/框架，都应该是在浏览器DOM工作之前额外添加的一层。</p><blockquote class="kw kx ky"><p id="d773" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated">不同的javascript库采用不同的方法来解决这个问题。最终，更快的DOM更新和在屏幕上的显示才是最重要的</p></blockquote><h1 id="802c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">额外的一层反应是什么？</h1><p id="c26b" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">嗯！React创建真实世界的副本。这叫做<strong class="ih hj">虚拟DOM </strong>。这和真实世界一样，但是没有在屏幕上反映出来。由于没有体现在屏幕上(屏幕上没有绘画)，虚拟DOM更新更快。</p><h1 id="34d6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">虚拟DOM是如何工作的？</h1><p id="0894" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">虚拟DOM是具有<strong class="ih hj">键</strong>和<strong class="ih hj">值</strong>对的javascript对象。每次发生更新时，都会创建一个新的虚拟DOM。这实质上意味着JS对象中的一些<strong class="ih hj">键</strong>已经改变。新的虚拟DOM将所有的键与旧的虚拟DOM进行比较。它记录所有已经改变的<strong class="ih hj">键</strong>，并且任何已经改变的<strong class="ih hj">键</strong>将被发送到队列。这个过程叫做<strong class="ih hj">差分</strong>。如果队列中有<strong class="ih hj">键</strong>，将<strong class="ih hj">批量更新</strong>到真实DOM。这个过程使它更快。</p><blockquote class="kw kx ky"><p id="3e59" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">批量更新是指将虚拟DOM中的所有更新合并到一个更新中，同时发送到真实DOM </em></p></blockquote><p id="8b78" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">注:</em> <em class="js">这些东西都是</em>为了更好理解而对<em class="js">事物的超级简化</em></p><h1 id="1836" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">将这些点连接起来</h1><p id="6614" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">嗯！react实际上会带来什么？简单！这让事情变得更容易</p><blockquote class="kw kx ky"><p id="d02a" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">做出反应不会让事情变得更快更容易</em></p></blockquote><p id="7946" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一开始可能看起来很奇怪，但很快就会明白了。浏览器、DOM、虚拟DOM、DOM操作、javascript等这些东西同时发生。因此，我们不时需要回到我们之前在新视角中讨论过的主题。</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lc"><img src="../Images/38e672aeac14f971ac97f9a3756fdc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uN0M05AWfk8I4BQe.jpg"/></div></div></figure><p id="308d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们知道<strong class="ih hj">布局</strong>和<strong class="ih hj">绘制(显示)</strong>是浏览器处理网页的阶段。</p><h2 id="eea4" class="lo ju hi bd jv lp lq lr jz ls lt lu kd iq lv lw kh iu lx ly kl iy lz ma kp mb bi translated">即使一个元素节点改变，Real-DOM是否重新渲染整个页面？</h2><p id="841d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">从逻辑上来说不应该，因为从浏览器的角度来看这些都是简单的事情，他们可以改进，当然他们也确实改进了。对DOM的任何更改都可以分为两部分——一部分影响布局(元素和位置),另一部分影响外观(颜色、背景等)。</p><blockquote class="kw kx ky"><p id="73ce" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">影响位置的一个——回流</em></p><p id="967c" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">影响外观的一种——重涂</em></p></blockquote><h2 id="9c4a" class="lo ju hi bd jv lp lq lr jz ls lt lu kd iq lv lw kh iu lx ly kl iy lz ma kp mb bi translated">哪一个触发了重新渲染？</h2><p id="3fa4" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">触发重新渲染的是<strong class="ih hj">回流</strong>。这很直观，因为如果任何元素的位置发生变化，整个网页流都会发生变化(即其他元素的相对位置)。因此，每个元素的位置从零开始重新计算，最终输出再次被<strong class="ih hj">重绘</strong>。这是一个过于简单的解释。</p><p id="d872" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj">重画</strong>的情况——例如，改变元素字体颜色——只有需要改变颜色的元素被重新渲染，而不是所有的元素。</p><blockquote class="kw kx ky"><p id="603a" class="if ig js ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">计算越多，性能越差——因此回流使得DOM更新缓慢</em></p></blockquote><p id="5d00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">React不会取代这一点，因为React通过相同的DOM API与DOM通信。如果发生回流，react也会进行相同的整体重新渲染。</p><p id="ac91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">记住:React只是在原来的DOM之前多加了一层。所以它不会改变浏览器的工作方式。因此，如果有人说反应使过程更快，这是不正确的。这让事情变得简单。</em></p><p id="31e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我知道我没有把这些点完美地连接起来。我们将在下一篇文章中完成它。</p></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><p id="8a28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="js">原载于2022年3月10日</em><a class="ae jd" href="https://www.pansofarjun.com/post/an-investigative-guide-to-react-js-dom-virtual-dom-and-jsx-part-iv" rel="noopener ugc nofollow" target="_blank"><em class="js">【https://www.pansofarjun.com】</em></a><em class="js">。</em></p></div></div>    
</body>
</html>