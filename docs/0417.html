<html>
<head>
<title>ActivityResult API Android…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">活动结果API Android…</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/activityresult-api-android-87308971c277?source=collection_archive---------0-----------------------#2020-12-05">https://medium.com/nerd-for-tech/activityresult-api-android-87308971c277?source=collection_archive---------0-----------------------#2020-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e4e8c2c31937a3b44f4a5d43650fd8a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GN-IA_pdjhvfKPSfpk_u9A.png"/></div></div></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="3351" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">今天我们将学习<strong class="iz hj"> ActivityResult API </strong>，它让Android开发人员更容易管理权限和活动间通信。</p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><ul class=""><li id="6e9b" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">目前，如果我们需要来自<strong class="iz hj">子活动或由主机活动</strong> y启动的另一个活动 <strong class="iz hj">的数据，我们使用<strong class="iz hj"> startActivityForResult </strong>和<strong class="iz hj"> onActivityResult </strong></strong></li></ul><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="a3c6" class="kn ko hi kj b fi kp kq l kr ks">// start activity <br/>startActivityForResult(intent,requestCode)</span><span id="90f8" class="kn ko hi kj b fi kt kq l kr ks">// get the result<br/>override fun onActivityResult(<em class="ku">requestCode</em>: Int, <em class="ku">resultCode</em>: Int, <em class="ku">data</em>: Intent?) {<br/>    super.onActivityResult(<em class="ku">requestCode</em>, <em class="ku">resultCode</em>, <em class="ku">data</em>)<br/>}</span></pre><ul class=""><li id="0864" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">第二个用例是<strong class="iz hj">权限</strong>，如果你曾经实现过请求权限ex。访问媒体文件等。你猜对了。</li></ul><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="b856" class="kn ko hi kj b fi kp kq l kr ks">// request for permisison<br/>requestPermissions(<em class="ku">arrayOf</em>(android.Manifest.permission.<em class="ku">READ_CALENDAR</em>))</span><span id="4a51" class="kn ko hi kj b fi kt kq l kr ks">// manage the result <br/>override fun onRequestPermissionsResult(<br/>    <em class="ku">requestCode</em>: Int,<br/>    <em class="ku">permissions</em>: Array&lt;out String&gt;,<br/>    <em class="ku">grantResults</em>: IntArray<br/>) {<br/>    super.onRequestPermissionsResult(<em class="ku">requestCode</em>, <em class="ku">permissions</em>, <em class="ku">grantResults</em>)<br/>}</span></pre></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="6b25" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">现在我们将了解上述用例是如何👆使用ActivityResult API </strong>实现变得更加容易</p><p id="49af" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">首先要做的事情:</strong></p><ul class=""><li id="c597" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated"><strong class="iz hj">依赖关系:</strong>添加👇在你的<strong class="iz hj">应用级build.gradle文件</strong>中的<strong class="iz hj"> 2依赖关系</strong>之后</li></ul><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="eccc" class="kn ko hi kj b fi kp kq l kr ks">// check the latest version @Android released notes<br/>implementation "androidx.activity:activity-ktx:1.2.0-beta02"<br/>implementation 'androidx.fragment:fragment-ktx:1.3.0-beta02'</span></pre><blockquote class="kv kw kx"><p id="89bf" class="ix iy ku iz b ja jb jc jd je jf jg jh ky jj jk jl kz jn jo jp la jr js jt ju hb bi translated"><strong class="iz hj">请求权限</strong>:该API提供了<strong class="iz hj"> 2种方式</strong>请求权限。</p></blockquote><p id="be21" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">活动结果合同。RequestPermission()) : </strong>如果你想请求单个权限，这个<strong class="iz hj">契约</strong>会为你做<strong class="iz hj">的工作</strong>。</p><ul class=""><li id="659c" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">使用<strong class="iz hj">请求许可合同</strong>创建<strong class="iz hj">activity request launcher</strong></li></ul><p id="af53" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">Lambda在下面的代码中👇将在请求完成时执行，您可以调用它<strong class="iz hj"> onRequestPermissionsResult。</strong></p><blockquote class="kv kw kx"><p id="fb69" class="ix iy ku iz b ja jb jc jd je jf jg jh ky jj jk jl kz jn jo jp la jr js jt ju hb bi translated">在这种情况下，根据是否授予权限，它返回布尔值<strong class="iz hj"/></p></blockquote><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/3ba4119047be5eef7c9b7d9ef28bd922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uXGUkqgG4wxV3M3Z6bftuQ.png"/></div></div></figure><ul class=""><li id="2dec" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">好了，你可以去申请任何许可了，它会为你完成工作</li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/52c1ecbbd750ee0c042247b81d5315a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wbto_v66_hHyuScGACG1Kw.png"/></div></div></figure><ul class=""><li id="6998" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">API提供了许多其他预构建的契约，您可以像<strong class="iz hj">requestpermission一样直接使用。</strong>查看参考资料部分，了解更多信息。</li></ul><p id="1860" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">如果你想请求多个权限使用下面的契约:</strong></p><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lb"><img src="../Images/046a7e3aad2352010197ae2c8738325a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUovfPgyxYwzL3ZBqVleZw.png"/></div></div></figure><p id="aa96" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">此处<strong class="iz hj">结果</strong>👆属于类型<strong class="iz hj">映射&lt;字符串、布尔&gt;、</strong>，其具有作为关键字的<strong class="iz hj">权限名称和基于是否授予权限的<strong class="iz hj">值</strong></strong></p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="4670" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">现在我们将了解如何使用该API从子活动中获取数据。</strong></p><ul class=""><li id="b9b8" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">我们将创建<strong class="iz hj">自定义契约</strong>，该契约<strong class="iz hj">扩展</strong>活动<strong class="iz hj">结果契约&lt;输入、输出&gt; () </strong></li></ul><p id="681b" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">输入</strong>:如果需要发送一些数据</p><p id="4234" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><strong class="iz hj">输出</strong> : <strong class="iz hj">结果</strong>您期望从您为结果而开始的活动中得到的结果</p><ul class=""><li id="30c9" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated">这里👇我们已经创建了自定义契约，它将<strong class="iz hj"> Int作为输入</strong>，并给我们<strong class="iz hj">字符串</strong>类型的<strong class="iz hj">结果</strong></li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/f42edd6ffba47481245998af25123b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3b4-fFWTjtXoZPo0nUH2Q.png"/></div></div></figure><ul class=""><li id="bd79" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated"><strong class="iz hj">我们需要覆盖两个方法:</strong></li></ul><pre class="ke kf kg kh fd ki kj kk kl aw km bi"><span id="1053" class="kn ko hi kj b fi kp kq l kr ks">// here we handle the result</span><span id="91d3" class="kn ko hi kj b fi kt kq l kr ks">parseResult(<em class="ku">resultCode</em>: Int, <em class="ku">intent</em>: Intent?): String?  // it's the Output type that we have defined for our contract<br/></span><span id="2917" class="kn ko hi kj b fi kt kq l kr ks">// this method creates the Intent that we defined, input:Int? It's the input type that we have defined for our contract</span><span id="2998" class="kn ko hi kj b fi kt kq l kr ks">createIntent(<em class="ku">context</em>: Context, <em class="ku">input</em>: Int?): Intent</span></pre><ul class=""><li id="249c" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated"><strong class="iz hj">让我们用这个契约:</strong></li></ul><figure class="ke kf kg kh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/70dfddf78192a6361b93b840f35985c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hWZXZ0QnQROmnGPy0tf-tg.png"/></div></div></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><ul class=""><li id="d6a0" class="jv jw hi iz b ja jb je jf ji jx jm jy jq jz ju ka kb kc kd bi translated"><strong class="iz hj">这是本文的Github回购:</strong></li></ul><div class="lf lg ez fb lh li"><a href="https://github.com/navczydev/ActivityContractsSample" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">navczydev/ActivityContractsSample</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">ActivityResult API sample GitHub是5000多万开发人员的家园，他们共同工作来托管和审查代码、管理…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">github.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw io li"/></div></div></a></div></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h2 id="de0c" class="kn ko hi bd lx ly lz ma mb mc md me mf ji mg mh mi jm mj mk ml jq mm mn mo mp bi translated"><strong class="ak">👏👏快乐编码我希望你今天学到一些新东西👏👏</strong></h2></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="e0b0" class="mq ko hi bd lx mr ms mt mb mu mv mw mf mx my mz mi na nb nc ml nd ne nf mo ng bi translated">保持联系</h1><div class="lf lg ez fb lh li"><a href="https://www.linkedin.com/in/navczydev/" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">Nav Singh -中级移动软件工程师-宏利| LinkedIn</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">在世界上最大的职业社区LinkedIn上查看Nav Singh的个人资料。Nav列出了6个职位…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">www.linkedin.com</p></div></div></div></a></div><p id="7331" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated"><a class="ae nh" href="https://twitter.com/navczydev" rel="noopener ugc nofollow" target="_blank"> <strong class="iz hj">推特</strong> </a></p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="c292" class="mq ko hi bd lx mr ms mt mb mu mv mw mf mx my mz mi na nb nc ml nd ne nf mo ng bi translated">参考</h1><ul class=""><li id="5a68" class="jv jw hi iz b ja ni je nj ji nk jm nl jq nm ju ka kb kc kd bi translated"><a class="ae nh" href="https://developer.android.com/reference/androidx/activity/result/ActivityResult" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/reference/androidx/activity/result/activity result</a></li><li id="a7d1" class="jv jw hi iz b ja nn je no ji np jm nq jq nr ju ka kb kc kd bi translated"><a class="ae nh" href="https://developer.android.com/reference/androidx/activity/result/contract/ActivityResultContracts" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/reference/androidx/activity/result/contract/ActivityResultContracts</a></li></ul><div class="lf lg ez fb lh li"><a href="https://android-developers.googleblog.com/2020/07/jetpack-activityresult.html" rel="noopener  ugc nofollow" target="_blank"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hj fi z dy ln ea eb lo ed ef hh bi translated">使用Jetpack ActivityResult改善活动间的交流</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">无论您是请求许可，从系统文件管理器中选择文件，还是期望从第三方获得数据…</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">android-developers.googleblog.com</p></div></div><div class="lr l"><div class="ns l lt lu lv lr lw io li"/></div></div></a></div></div></div>    
</body>
</html>