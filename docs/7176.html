<html>
<head>
<title>Upload file feature in SpringBoot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SpringBoot 中的上传文件功能</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/upload-file-feature-in-springboot-9e4ed8474b82?source=collection_archive---------0-----------------------#2022-08-17">https://medium.com/nerd-for-tech/upload-file-feature-in-springboot-9e4ed8474b82?source=collection_archive---------0-----------------------#2022-08-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div class="er es im"><img src="../Images/9afe5be0e3c51590358bcf0dee80fbd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*j3nfI0byx3HRaFpbw5ESbQ.png"/></div><figcaption class="iu iv et er es iw ix bd b be z dx translated">来源:<a class="ae iy" href="https://unsplash.com/photos/gGFyi5h79uE" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/gGFyi5h79uE</a></figcaption></figure></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><p id="b46d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在本文中，我们将实现文件上传功能。我们将创建两个端点，分别上传和获取文件。post 请求将上传文件。Post 请求也可以用作 put 请求。<br/>get 请求将获取文件。</p><p id="8bef" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><a class="ae iy" href="https://github.com/Viveksingh1313/uploadImage" rel="noopener ugc nofollow" target="_blank"> GitHub 代码可用</a>。检查自述文件以启动应用程序。</p><p id="940d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">发布端点:</strong></p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="9f69" class="kc kd hi jy b fi ke kf l kg kh">@PostMapping(<strong class="jy hj">"/upload/post"</strong>)<br/><strong class="jy hj">public </strong>ResponseEntity&lt;String&gt; uploadProfilePic(@ModelAttribute User user) <strong class="jy hj">throws </strong>Exception {<br/>   <strong class="jy hj">userService</strong>.updateProfilePicture(user.getUserId(), user.getProfilePicImageFile());<br/>    <strong class="jy hj">return new </strong>ResponseEntity&lt;&gt;( <strong class="jy hj">"Upload Successful"</strong>, HttpStatus.<strong class="jy hj"><em class="ki">OK</em></strong>);<br/>}</span></pre><p id="06dd" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">获取端点:</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="b6c4" class="kc kd hi jy b fi ke kf l kg kh">@GetMapping(value = { <strong class="jy hj">"/upload/get" </strong>}, produces = MediaType.<strong class="jy hj"><em class="ki">ALL_VALUE</em></strong>)<br/><strong class="jy hj">public </strong>ResponseEntity&lt;<strong class="jy hj">byte</strong>[]&gt; getProfilePic(@RequestParam String emailId)  {<br/>    <strong class="jy hj"><em class="ki">log</em></strong>.debug(<strong class="jy hj">"Inside {} controller"</strong>, <strong class="jy hj">"/user/profile/picture"</strong>);<br/>    User user = <strong class="jy hj">userService</strong>.getUserDetailsByEmailId(emailId);<br/>    <strong class="jy hj">byte</strong>[] profilePicBytes = user.getProfilePicBytes();<br/>    <strong class="jy hj">return new </strong>ResponseEntity&lt;&gt;(profilePicBytes, HttpStatus.<strong class="jy hj"><em class="ki">OK</em></strong>);<br/>}</span></pre><p id="374c" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">用户实体:</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="8a00" class="kc kd hi jy b fi ke kf l kg kh"><strong class="jy hj">import </strong>org.springframework.web.multipart.MultipartFile;</span><span id="f119" class="kc kd hi jy b fi kj kf l kg kh">class User {<br/> String userId;<br/> String emailId;<br/> byte[] profilePicBytes;<br/> @Transient<br/> private MultipartFile profilePicImageFile;</span><span id="360c" class="kc kd hi jy b fi kj kf l kg kh">}</span></pre><p id="48c2" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">用户服务 Impl:</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="2c87" class="kc kd hi jy b fi ke kf l kg kh">@Override<br/><strong class="jy hj">public void </strong>updateProfilePicture(String userId, MultipartFile multipartFile) <strong class="jy hj">throws </strong>Exception {<br/>    User user = <strong class="jy hj">userRepository</strong>.findByUserId(userId);<br/>    <strong class="jy hj">if</strong>(user!= <strong class="jy hj">null </strong>&amp;&amp; multipartFile!=<strong class="jy hj">null</strong>) {<br/>        user.setProfilePicBytes(multipartFile.getBytes());<br/>        <strong class="jy hj">userRepository</strong>.save(user);<br/>    } <strong class="jy hj">else </strong>{<br/>        <strong class="jy hj"><em class="ki">log</em></strong>.debug(<strong class="jy hj">"User not found for userId : {}"</strong>, userId);<br/>        <strong class="jy hj">throw new </strong>Exception(<strong class="jy hj">"User not found for { userId = " </strong>+ userId + <strong class="jy hj">"}"</strong>);<br/>    }<br/>}</span></pre><p id="df3f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">如何从 postman 调用这些端点？</strong></p><p id="16c7" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">发布请求:/用户/上传/发布</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kk"><img src="../Images/4bc1ecbe9971813edf6167e714ad55a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mE4FAFWDNCtwW7ft9YmzQ.png"/></div></div></figure><p id="f9b5" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">获取请求:/users/upload/get</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kp"><img src="../Images/a6140b695c46531b12e93b2603c4fbae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oHclNgMyDvPLd7lH8Gtm5A.png"/></div></div></figure><p id="7e7d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">代码说明:</strong></p><p id="58cf" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在用户实体中，我们有 userId、emailId、profilePicBytes <strong class="jb hj">、</strong> profilePicImageFile。profilePicImageFile 仅用于读取调用 post 请求时传递的文件。我们将这个文件转换成一个字节类型变量，并将这个字节数组存储在我们的 db 中。</p><p id="43b5" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在 get 调用期间，我们读取这些字节数组并将其传递给前端，以便将字节转换为图像。对于转换，我们使用:</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="c58f" class="kc kd hi jy b fi ke kf l kg kh">produces = MediaType.<em class="ki">ALL_VALUE</em></span></pre><p id="1b27" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">定义“<strong class="jb hj">/上传/获取</strong>”控制器时。如果我们知道 get 端点产生的媒体类型，那么我们可以使用特定的媒体类型。比如:</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="0c6f" class="kc kd hi jy b fi ke kf l kg kh">produces = MediaType.<strong class="jy hj"><em class="ki">IMAGE_JPEG_VALUE</em></strong></span></pre><p id="5896" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">图像的字节转换:</strong></p><p id="3a38" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj"> MultipartFile </strong>对象有一个名为“getBytes()”的方法。此方法用于将文件转换为字节，然后可以存储在 DB 中。在下面的代码中，我们只是以字节为单位读取文件，然后将其设置为用户实体的 profilePicBytes(byte[]type object)列/变量。</p><pre class="in io ip iq fd jx jy jz ka aw kb bi"><span id="f65c" class="kc kd hi jy b fi ke kf l kg kh">user.setProfilePicBytes(multipartFile.getBytes());</span></pre><p id="f2ea" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">@模型属性:</strong></p><p id="8787" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在 post 请求“/users/upload/post”中，我们使用@ModelAttribute 而不是@ request body—<code class="du kq kr ks jy b">@ModelAttribute</code>将接受一个查询字符串。因此，所有数据都通过 url 传递到服务器。至于<code class="du kq kr ks jy b">@RequestBody</code>，所有的数据都会通过一个完整的 JSON 体传递给服务器。使用<code class="du kq kr ks jy b">@RequestBody.</code>无法上传图片</p><p id="734a" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">多部分:</strong></p><p id="bbc4" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">多部分请求将一个或多个数据集组合成一个整体，由边界分隔。您通常将这些请求用于文件上传和在单个请求中传输多种类型的数据(例如，一个文件和一个 JSON 对象)。</p><p id="7357" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hj">结论</strong></p><p id="3884" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">希望这篇文章是有帮助的。<br/> Git 代码可以用一个自述文件进行解释:<a class="ae iy" href="https://github.com/Viveksingh1313/uploadImage" rel="noopener ugc nofollow" target="_blank">https://github.com/Viveksingh1313/uploadImage</a></p><p id="812b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">如果这篇文章对你有帮助，请鼓掌并关注我以获取更多这样的文章。你可以找到我的<a class="ae iy" href="https://www.linkedin.com/in/vivek-singh-a109b511a/" rel="noopener ugc nofollow" target="_blank"> LinkedIn 简介</a>和电子邮件 Id:vivek.sinless@gmail.com</p><p id="d52e" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">快乐学习！干杯:)</p></div></div>    
</body>
</html>