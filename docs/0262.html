<html>
<head>
<title>Saga pattern?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">佐贺模式？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/saga-pattern-971d59be3722?source=collection_archive---------0-----------------------#2020-08-24">https://medium.com/nerd-for-tech/saga-pattern-971d59be3722?source=collection_archive---------0-----------------------#2020-08-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redux-saga是什么，我们为什么要用它？</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="0cc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Sagas是由埃克托·加西亚-魔线和肯尼思·塞勒姆于1987年从普林斯顿大学引进的，所以还是比较近的概念。在讨论redux-saga之前，我想介绍一下术语“saga模式”本身及其诞生的背景。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="757b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们试图让你登录我们的系统。首先，我们会为您在数据库中找到用户名，并检查密码。如果都匹配，那么返回前面请求中请求的信息。我刚才解释的需要数据库事务，这种类型的事务被称为<a class="ae jk" href="https://en.wikipedia.org/wiki/Long-lived_transaction" rel="noopener ugc nofollow" target="_blank">长寿命事务</a>。但是，问题出现了！</p><p id="ca15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们的服务规模很大，并且有多个应用服务器在运行，那会怎么样？当第一个服务器正在工作时，其他服务器可能会进来并尝试使用当前正在处理的数据，这将导致问题。我们在操作系统中遇到过类似的术语信号量或锁，但基本上，问题是<a class="ae jk" href="https://en.wikipedia.org/wiki/Concurrency_control" rel="noopener ugc nofollow" target="_blank">并发控制</a>。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es jl"><img src="../Images/efc2571893978b8929021843502bff48.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*9Al8fr94JFbuW8cCU-3YqQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">关于佐贺的图像</figcaption></figure><p id="7860" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该模式用于处理数据库中的活事务，以便在MSA中处理分布式事务。基本上，saga是一系列本地事务。</p><p id="d806" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如您在图中看到的，使用saga模式的服务请求可以防止副作用，并使用saga模式完成其工作。因此，<strong class="ih hj"> saga模式</strong>是<strong class="ih hj">更新每个服务并发布消息或事件以触发下一个事务步骤的事务序列。</strong></p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="a41a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在回来才反应过来。redux-saga 是一个库，它可以轻松管理应用程序的副作用(异步数据请求、浏览器缓存、任何不纯的请求),并通过简单的测试有效地执行精确的失败日志。为此，saga使用了javascript中的生成器函数。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es jx"><img src="../Images/b81210d14ee5940de7b992dff8cc8159.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*LMIPRZvZmoga-HpeMAAdOw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">react中的传奇</figcaption></figure><p id="8ced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Saga从生成器接收产量并执行另一个功能。Saga产生纯对象，称为包含命令的效果，中间件翻译这些命令并执行它们，将结果返回给saga。</p><p id="57ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们更深入地探讨一下术语。Saga产生称为效果的纯对象。Effect是一个简单的javascript对象，包含将由中间件执行的命令。这些命令是什么？命令包括调用异步函数、向存储分派动作等动作。Redux-saga提供了一些帮助器效果，包装内部函数，以便在一些特定的动作被分派到商店时产生任务。这就是所谓的效果创建者，使用调用，上传，我们可以创建效果。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kc"><img src="../Images/2d9b9d989760ae14e79618d651466479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*wApFrDg-zqZlRFL3aYfnmQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">效果创建器功能</figcaption></figure></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="056f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仍然理解整个redux-saga是非常困难的，所以让我们看看代码和它是如何被使用的！</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="be0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使用redux-saga，我们只需创建一个saga中间件，并创建一个包含该中间件的商店。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kd"><img src="../Images/4bd9e5f6bec72d5500c12317b86c819b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IZXSWpd0y9kc4xyRI5ZK_Q.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">带有Redux的App.js</figcaption></figure><p id="9f68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们创建一个根传奇，它将等待采取行动。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ke"><img src="../Images/f0baf03eb90e8f9f32d00b4b27d8f945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*da_-Rr9pzTjbLKkj--_XCQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">rootsaga.js</figcaption></figure><p id="1c94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个根传奇将通过从生成器获取动作并与商店通信来控制传奇模式。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es kf"><img src="../Images/4faa0cffa99199656a3be6107731b3e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*EkQ64tQaaRh4WdmErgFkQA.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">todos/saga.js</figcaption></figure><p id="21a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是如何行动被派遣到根佐贺。首先，对于让步调用，我们基本上是在等待一个承诺或一个功能完成。然后我们有一个put，它基本上将一个动作分派给一个根传奇。很简单。</p></div><div class="ab cl jd je gp jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="hb hc hd he hf"><p id="2fa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Saga通过倾听动作，让开发者看到统一的结果，限制副作用。Redux-thunk也非常有用，它允许异步调度操作，但是它们不会返回统一的结果。有时，结果是简单的物体，有时是其他的动作。佐贺作为一个倾听者，将通过限制副作用来解决这个问题。</p></div></div>    
</body>
</html>