<html>
<head>
<title>Let’s run cron jobs using Github Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们使用 Github 操作来运行 cron 作业</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/lets-run-cron-jobs-using-github-actions-df64496ffc4a?source=collection_archive---------0-----------------------#2022-02-22">https://medium.com/nerd-for-tech/lets-run-cron-jobs-using-github-actions-df64496ffc4a?source=collection_archive---------0-----------------------#2022-02-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/35b8a50ee1afd4219b827989e64598f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBPtzcpTW9zgWy3HDRytow.png"/></div></div></figure><p id="d3ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大约两年前，我写了一篇关于 cron 作业以及我如何实现一个简单的 cron 作业来备份数据库的文章。你可以在这里找到那篇文章。在本文中，我们将使用<a class="ae jo" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> Github Actions </a>来运行 cron 作业，并将备份提交给一个存储库。</p><p id="c90d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">什么是 Github 动作？</strong></p><blockquote class="jp jq jr"><p id="6b52" class="iq ir js is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated">GitHub Actions 现在拥有世界一流的 CI/CD，可以轻松实现所有软件工作流程的自动化。直接从 GitHub 构建、测试和部署您的代码。</p></blockquote><p id="34b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Github Actions 提供了各种各样的功能，让我们的生活更加轻松。比如，</p><ul class=""><li id="5963" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kb kc kd ke bi translated">对任何 GitHub 事件运行工作流(推送、问题创建、拉取请求)</li><li id="9a34" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">可以使用任何语言(支持 Node.js，Python，Java，Ruby，PHP，Go，Rust，。NET 等)</li><li id="2fed" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">Linux、macOS、Windows、ARM 和容器</li><li id="b078" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kb kc kd ke bi translated">实时日志</li></ul><p id="fd02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">让我们创建我们的工作流</strong></p><ol class=""><li id="0d9d" class="jw jx hi is b it iu ix iy jb jy jf jz jj ka jn kk kc kd ke bi translated">在 GitHub 的存储库中创建一个<code class="du kl km kn ko b">.github/workflows</code>目录，如果这个目录还不存在的话。</li><li id="c42b" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kk kc kd ke bi translated">在<code class="du kl km kn ko b">.github/workflows</code>目录下，创建一个名为<code class="du kl km kn ko b">github-actions.yml</code>的文件。更多信息，请参见“<a class="ae jo" href="https://docs.github.com/en/github/managing-files-in-a-repository/creating-new-files" rel="noopener ugc nofollow" target="_blank">创建新文件</a>”</li><li id="db1d" class="jw jx hi is b it kf ix kg jb kh jf ki jj kj jn kk kc kd ke bi translated">将以下 YAML 内容复制到<code class="du kl km kn ko b">github-actions.yml</code>文件中</li></ol><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/46f1f00e65447be4f1d636a01503f66b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tNxMjAay5aR4HukaQd8waA.png"/></div></div></figure><p id="34fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.将工作流文件提交到存储库中的一个分支会触发<code class="du kl km kn ko b">push</code>事件并运行您的工作流。</p><p id="9306" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.转至“活动”标签以查看工作流信息</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/6ab054ede4480b7b9d20f73d9a7fd922.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*paicnrms8trvVKmB.png"/></div></div></figure><p id="f452" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们根据我们的需要改变我们的工作流程</p><p id="25c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要将事件触发器更改为 cron 作业。安排 cron 作业很容易。您可以使用<a class="ae jo" href="https://crontab.guru/" rel="noopener ugc nofollow" target="_blank"> crontab guru </a>来创建您的 cron 计划表达式。根据这个示例，作业将在每天午夜执行。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/e8ca11e4c8014ff15a4fdfebe649d462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vR9XAX6M7CPTT3hGEYT1Kg.png"/></div></div></figure><p id="a1b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们考虑一个 MySQL 数据库来创建一个转储，在这种情况下，命令是，</p><p id="1fe7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kl km kn ko b">mysqldump -h hostname-of-the-server -u mysql_user -p database_name &gt; file.sql</code></p><p id="c6a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如你所见，它包含一些敏感数据。所以硬编码不会做得很好。那解决办法是什么？</p><p id="2e9c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">行动秘密</strong></p><blockquote class="jp jq jr"><p id="30aa" class="iq ir js is b it iu iv iw ix iy iz ja jt jc jd je ju jg jh ji jv jk jl jm jn hb bi translated">机密是加密的环境变量。任何拥有此存储库的协作者访问权限的人都可以使用这些机密来执行操作。</p></blockquote><p id="a3da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以通过进入 Repo 设置-&gt;机密-&gt;操作来添加您的环境变量。</p><p id="fd2e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们的工作流程是这样的，</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/3c49b9bc2537fa5d470978ebdfcc3e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CdK6beTKGnNIeby4yoZ0vA.png"/></div></div></figure><p id="b9c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们有了<code class="du kl km kn ko b">backup.sql</code>文件，我们需要将它提交给回购。让我们添加它来结束我们的工作流程。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/11442e5d837b6670f9ea0aeccc5c6ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BRsFxnlG43XQXqCRUvNGhA.png"/></div></div></figure><p id="eb3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">提交更改后。您将能够看到您的工作流按照给定的时间表执行。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kx"><img src="../Images/c798cbf7b3539765298d3bc2256d73c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZBCbj7279pyMPGapwNE9w.png"/></div></div></figure></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="c0b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样，我们来到了本文的结尾。你可以通过<a class="ae jo" href="https://docs.github.com/en/actions/learn-github-actions/understanding-github-actions" rel="noopener ugc nofollow" target="_blank">文档</a>获得更多信息。别忘了看看我的其他文章。下次再见了。在那之前保持安全！✌️</p><h1 id="c89f" class="lf lg hi bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">参考资料:</h1><p id="18e2" class="pw-post-body-paragraph iq ir hi is b it md iv iw ix me iz ja jb mf jd je jf mg jh ji jj mh jl jm jn hb bi translated">[1].GitHub 动作快速入门。[2022]文档[在线]。可在 https://docs.github.com/en/actions/quickstart<a class="ae jo" href="https://docs.github.com/en/actions/quickstart" rel="noopener ugc nofollow" target="_blank">获得</a>【2022 年 2 月 22 日获得】</p><p id="332c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">[2] GitHub 预定动作。可在:【https://jasonet.co/posts/scheduled-actions/ T4】【2022 年 2 月 22 日访问】</p></div></div>    
</body>
</html>