# C++库—第一部分:设计

> 原文：<https://medium.com/nerd-for-tech/c-libraries-part-i-design-9ed997dca8f3?source=collection_archive---------2----------------------->

这篇博客文章讲述了创建 C++库的基础知识。

它最初是由于一些人的提问而创建的，所以我决定为希望扩展他们对库的一般知识，特别是 C++库的知识的开发人员创建这个简短的介绍。

这是两篇博文的第一部分，第二部分可以在这里找到。

如果你有兴趣让你的图书馆创作更上一层楼，这篇博文是为你准备的:)

# 0.什么是图书馆？

*“图书馆是信息源和类似资源的精选集合”*

每个软件工程师都熟悉“库”这个术语。

在 C++中(尤其是在基于 OOP 设计的项目中)，几乎每个类都定义了一个 API(应用编程接口)。但并不是每个 API 都是一个库。

虽然上面的引用是指物理库，但这实际上也适用于软件库。

你可以想象一个包含不同主题出版物的实体图书馆。出版物一个接一个地出现在目录中，但是您也可以将几个组合成一个集合。一个软件库可以有一个单一的功能区域(文本解析器),也可以由多个功能区域组成——就像标准的 C++库一样。

一个软件库意味着通过一个定义好的 API 来提供功能，但是还有更多——写一个库听起来很容易，但是它隐藏了*一个非常复杂的问题*。

在我们开始之前，让我们定义这些基本术语:

*   **库**:库代码，为了使用，用户必须在她的代码中添加`#include "mylib.hpp " '。
*   **用户代码:**导入库并调用实用程序的程序部分。

在下面的博客中，我们将使用下面的(过于简化，*不工作*)代码示例:

## 库(“仅标题”版本)

## 用户代码

注意，该库可以写成“仅头文件”-仅`. hpp `文件，或者`. hpp & .cpp `(通过从定义中分离声明，并将定义移动到`. cpp `文件中)。

在头文件中编写代码会产生一些小的技术差异(这里不做解释)，但是当模板被用作编写库代码的技术时，通常会用到“仅头文件库”这个术语。

在头文件中使用“开放”模板的主要区别在于模板能够“按需”创建实现**，这只能在。hpp 源代码是提供给用户的代码。**

**(模板库将在本博客的后面出现，但是关于模板技术的详细解释将在另一个博客中发表)。**

# **一、如何设计图书馆？**

**当你计划写一个库的时候，有一些事情需要考虑。**

## **库的 API 是什么？**

**这是你需要做的最重要的决定。**

**当您定义 API 时，您定义了用户将如何使用库，更重要的是，您定义了在库的不同版本之间不应该改变什么。**

**如果你改变 API——你在你的库中创建了一个突破性的改变，所以在定义它之前要仔细考虑。**

**最佳实践(来自 OOP 设计)是封装所有的实现细节，只暴露用户需要调用的部分。**

## **对图书馆有什么要求？**

**这里你需要考虑一下用法。**

**你的库是供系统开发人员使用，还是供其他库作者使用，或者介于两者之间？它是一个本地工具(由程序的特定部分使用，例如写入文件系统)，还是一个与整个程序相关的全局工具？(例如，日志或通用包装)**

## **对指定用户来说什么是重要的？**

**这可能是下面的一个或多个:小代码大小、快速运行时性能、可读性、简单性、向后兼容性等。
请注意，其中一些与另一些相互矛盾。**

## **用户将如何使用它？**

**这一部分被分成两个不同的部分。尽管它们可能是相关的，但重要的是要注意这两者并不相互关联:**

1.  **设计构图。**
2.  **代码组合。**

****设计构图****

**如何在导入代码中使用库工具。两个主要的例子是:**

1.  **用户代码继承自库中定义的类。**

**2.用户代码创建一个在库中定义的对象，并使用其方法来获得功能(它可以按原样创建，也可以由不同的对象持有。这里我展示第二个选项)。**

**当然，在这两个选项之间进行选择取决于所需的设计。**

**(*)还有第三种选择，它不是面向 OOP 的。这个选项在 C 或标准库中更常见(仅在某些用例中)。你应该在使用它之前仔细考虑，因为它会影响你的名字空间。**

**3.用户代码导入包含自由函数/自由模板函数的库**

****代码组成****

**这定义了将库添加到代码中的技术方法。**

**添加库有多种方式，它们取决于您打包库的方式。**

**注意:在下面的部分中，我提到了基于 Linux 的操作系统的文件扩展名，基于 Windows 的操作系统有不同的文件扩展名。(其余的技术细节是相同的)**

**一般来说，存在两种主要方式:**

1.  **将库作为附加源添加到项目中(例如在“仅头文件”库中)**
2.  **将库作为工件添加，并与用户代码链接。(.o /。a /。所以)
    这个选项本身拆分成:
    1。将库编译成静态库(。o，。a)，用它链接到**在用户代码中嵌入**库代码(**会被添加到 main.out 二进制**)。
    2。将库编译成动态库(。所以)。**

**编译成动态库本身包含两个选项:**

1.  **链接用户代码(。o)与。所以在**动态联动** :
    这个选项的意思是:
    -既有用户代码(main.out)又有库代码(。所以)需要复制到目标环境中。
    - main.out 在没有。所以在环境上。**
2.  **链接用户代码(。o)与。所以在**动态插件联动上:**
    这个选项的意思是:
    -既有用户代码(main.out)又有库代码(。所以)需要复制到目标环境中。
    -main . out 文件可以运行，我们可以更改库(。so)版本**而不重启 main.out 进程**。(仅调用 **`reload `功能** )
    该选项将要求` main.cpp `程序**具有特殊代码(dlopen)以支持该选项**。(通过添加一些特殊函数来加载库)**

**选择使用这些选项中的哪一个取决于需求。第五部分(C++库-第二部分:实现)介绍了每种形式的优缺点。**

## **版本控制—库多久更新一次？**

**这里你需要考虑你的用户，并相应地计划版本管理。**

**他们在离线系统上工作吗？他们是保留多个版本还是只有一个版本？**

**需要考虑的事情很少:**

1.  **用户群越大，就越有可能需要维护多个版本。**
2.  **根据您的用户组，您应该决定是否“允许”您的库在版本之间中断 API。**

**如今描述图书馆版本的一种常见方式是:[https://semver.org/](https://semver.org/)**

**正如您所看到的，设计一个新的库绝非易事。请记住，这只是一个预览。在实现您的库之前，建议您更深入地了解所提到的主题。在 API 部分，我还推荐阅读关于 CPO(定制点)的内容。**

**在 [C++库-第二部分:实现](https://inballevi.medium.com/c-libraries-part-ii-implementation-44dab21e50ae)中，我们将深入到创建、打包和链接库的技术部分。**