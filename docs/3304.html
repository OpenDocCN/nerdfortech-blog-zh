<html>
<head>
<title>Ansible Playbooks | Loops | Handlers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可翻译的剧本|循环|处理程序</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ansible-playbooks-loops-handlers-6abeca0bcac9?source=collection_archive---------18-----------------------#2021-06-05">https://medium.com/nerd-for-tech/ansible-playbooks-loops-handlers-6abeca0bcac9?source=collection_archive---------18-----------------------#2021-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d7d6700146bf4ca3687d4da6736b6a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lN9t98Hbwwmx1Isk.png"/></div></div></figure><p id="2f43" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">先决条件:</strong></p><div class="jo jp ez fb jq jr"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/ansible-ad-hoc-modules-host-patterns-52c156405145"><div class="js ab dw"><div class="jt ab ju cl cj jv"><h2 class="bd hj fi z dy jw ea eb jx ed ef hh bi translated">可变-专用|模块|主机模式</h2><div class="jy l"><h3 class="bd b fi z dy jw ea eb jx ed ef dx translated">先决条件:</h3></div><div class="jz l"><p class="bd b fp z dy jw ea eb jx ed ef dx translated">medium.com</p></div></div><div class="ka l"><div class="kb l kc kd ke ka kf io jr"/></div></div></a></div><p id="6fbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Ansible的剧本是用YAML格式写的。它是一种人类可读的数据序列化语言，用于配置文件。<br/>在剧本中，我们可以编写由Var、任务、处理程序、文件、模板和角色组成的代码。<br/>每个行动手册由列表中的一个或多个模块组成。</p><p id="bcf5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">剧本被分成多个部分，例如:<br/> <strong class="is hj">目标部分:</strong>定义主机代理。<br/> <strong class="is hj">变量部分:</strong>定义变量<br/> <strong class="is hj">任务部分:</strong>我们要按顺序运行的模块列表</p><p id="5b1d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建一个行动手册:</p><p id="1cb1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">A.转到Ansible服务器并执行下面的命令。</p><blockquote class="kg kh ki"><p id="70c3" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi"> vi target.yml </em></p></blockquote><p id="0ad1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">代码:</strong></p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="e2d2" class="kw kx hi ks b fi ky kz l la lb">---# Target Playbook<br/>- hosts: developers<br/>- user: ansible<br/>- become: yes<br/>- connection: ssh<br/>- gather_facts: yes</span></pre><p id="5cc4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要执行本行动手册，请使用以下命令:</p><blockquote class="kg kh ki"><p id="d702" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook&lt;name-of-script . yml&gt;</em></p><p id="98c1" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook kushtarget . yml</em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/3d373bafe8e7db5b2c90de12add7fd55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*hDLeCoQiyNnbCpSy.png"/></div></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/fccb53ee15c18a97ac6c373d17af6e32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*cd7SZOBbve-yz9sI.png"/></div></figure><p id="49ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">B.</p><blockquote class="kg kh ki"><p id="0f7c" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi"> vi kushTask.yml </em></p><p id="9a2c" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook kushtask . yml</em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/8ed12a7c257d489b16bca2976b94bc6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*6rzC8n35PAa-uVS-.png"/></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/1516cc1dc7635b027032c2e546349310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*R_ZpkXrYme4BM59w.png"/></div></figure><p id="aa45" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">节点输出:</strong></p><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/9742c3660272b8c926909729be06251f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*xlpij6ZMej1RNWMl.png"/></div></figure><h1 id="eada" class="ld kx hi bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">变量:</h1><p id="bf04" class="pw-post-body-paragraph iq ir hi is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hb bi translated">它用于遍历一组给定值。变量是在任务之前定义的，以便我们以后使用。</p><blockquote class="kg kh ki"><p id="b983" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook vars . yml</em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/084628188013f1f396da092a1bf6375e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*ShFxgdV_z4t3fpzS.png"/></div></div></figure><h1 id="79ee" class="ld kx hi bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">处理程序部分:</h1><p id="069a" class="pw-post-body-paragraph iq ir hi is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hb bi translated">处理程序与任务相同，但是它们在被另一个任务调用时执行。该任务包含一个名为notify的命令，该命令指示在当前任务执行之后，另一个任务准备好被执行。</p><p id="d7f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，从节点中删除httpd服务器</p><blockquote class="kg kh ki"><p id="a87e" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi"> sudo yum删除httpd </em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/01b20375c428027ddc770f8a6df35935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*UzPifQK3CGnX-bQc.png"/></div></figure><p id="94f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第二，用于处理程序的脚本:</p><blockquote class="kg kh ki"><p id="f1a9" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi"> vi handlers.yml </em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/17133db55d7d5b7855f10b333ebc713a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*YJcXtSKibeGHd8bt.png"/></div></div></figure><p id="c2d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">试运行:这意味着我们可以在不执行脚本的情况下检查我们的脚本。</p><blockquote class="kg kh ki"><p id="c4b8" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook handlers . yml-check</em></p></blockquote><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/4b79598acd069d353f1a59497f490811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*uoUFZPw2eRiOcBb5.png"/></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/a3d27a63c0b0e917acda5fcdfd67e9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*2WE1iD_oe2AQVUNB.png"/></div></figure><p id="01b9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行剧本，但不进行预演:</p><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/bfde3e8b4ccdba2305f10b5560cd065c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*FFnR8fFHgHKv6Fav.png"/></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/fa42a2e9e4e33a3b1f1313bc3d0b3cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*0WpLV0WS8VCiI2of.png"/></div></figure><h1 id="adcf" class="ld kx hi bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">循环部分:</h1><p id="7259" class="pw-post-body-paragraph iq ir hi is b it ma iv iw ix mb iz ja jb mc jd je jf md jh ji jj me jl jm jn hb bi translated">众所周知，循环意味着多次重复一项任务。Ansible循环包括使用文件模块更改几个文件或目录的所有权，使用用户模块创建多个用户，以及重复轮询步骤，直到达到某个结果。</p><p id="5b27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">命令:</p><blockquote class="kg kh ki"><p id="d2f6" class="iq ir kj is b it iu iv iw ix iy iz ja kk jc jd je kl jg jh ji km jk jl jm jn hb bi translated"><em class="hi">ansi ble-playbook loop . yml</em></p></blockquote><p id="9db5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">脚本:</strong></p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="8c10" class="kw kx hi ks b fi ky kz l la lb">--- # My loop Playbook<br/>- hosts: developers<br/>  user: ansible<br/>  become: yes<br/>  connection: ssh<br/>  gather_facts: yes<br/>  tasks:<br/>          - name: add a list of user<br/>            user: name='{{item}}' state=present<br/>            with_items:<br/>                    - kushagra<br/>                    - shivani<br/>                    - devashish<br/>                    - abhishek</span></pre><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/9486d4dbe74d1899f7ed3efe683cdc26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*S8pPVbP7GfmOeqbr.png"/></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/fef10a0c9d647a383cf2519fa2ecc94a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*Xs1DvhYjf7m9Kq1_.png"/></div></figure><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lc"><img src="../Images/4049b0e4741b4797ae30f2f47df77f9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*1NS4dn8Ks7Jer7oU.png"/></div></div></figure><p id="b8d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">节点输出:</strong></p><figure class="kn ko kp kq fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/1410ab205ac16cf640e8404fd5242161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/0*byskL8qrTYWJiPdV.png"/></div></figure><p id="a19a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae mf" href="https://bansalkushagra.medium.com/" rel="noopener">https://bansalkushagra.medium.com/</a></p></div></div>    
</body>
</html>