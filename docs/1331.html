<html>
<head>
<title>Mocking APIs for frontend developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模仿前端开发人员的API</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/mocking-apis-for-frontend-developers-e8c1fadc8f58?source=collection_archive---------6-----------------------#2021-03-14">https://medium.com/nerd-for-tech/mocking-apis-for-frontend-developers-e8c1fadc8f58?source=collection_archive---------6-----------------------#2021-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/144bb224dc0e26822a250a75bc377b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*_PFBxoOCSN9DDzNFeHHBcA.jpeg"/></div></figure><p id="4a78" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">考虑到如今的web开发是多么的松散耦合，导致我们的应用程序的前端(主要是SPA)和后端(API驱动)的分离，并且经常由不同的团队处理，需要考虑的一个主要问题是<strong class="io hj"> <em class="jk">“阻塞因素”</em>T3】</strong></p><p id="ec23" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">阻碍因素是开发人员花费多长时间等待外部API依赖，从而阻止前端功能开发或整个项目。</p><p id="9027" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嘲讽是摆脱这种受阻因素的一种方式。它们易于编写、灵活且无状态(因此重复测试场景更容易)，并最终提供了一种摆脱外部API依赖的方法。</p><p id="a30f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">模拟允许我们通过指定端点和它给出的响应来模拟后端API。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><h2 id="2647" class="js jt hi bd ju jv jw jx jy jz ka kb kc ix kd ke kf jb kg kh ki jf kj kk kl km bi translated">嘲弄的框架</h2><p id="ff32" class="pw-post-body-paragraph im in hi io b ip kn ir is it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj hb bi translated">在本文中，我将演示如何使用<a class="ae ks" href="https://mswjs.io/" rel="noopener ugc nofollow" target="_blank"> MSW </a>(模拟服务器工作器)来模拟todo react应用程序的API。</p><blockquote class="kt"><p id="cdf2" class="ku kv hi bd kw kx ky kz la lb lc jj dx translated">模拟服务工作器是一个API模拟库，它使用服务工作器API来拦截实际的请求。— mswjs.io</p></blockquote><p id="d40b" class="pw-post-body-paragraph im in hi io b ip ld ir is it le iv iw ix lf iz ja jb lg jd je jf lh jh ji jj hb bi translated">注意: MSW是完全框架不可知的，也支持GraphQL。你应该去看看！</p><p id="b281" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们开始吧！</p><p id="4b81" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们需要安装城市生活垃圾。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="0bb9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">下一步将是建立模拟。为了方便起见，我将API操作(如创建、读取等)与模拟服务器本身分开。</p><p id="9c53" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就这么办吧。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="96d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们现在可以创建我们的模拟。</p><p id="206f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你熟悉node.js的express框架，用MSW写REST API Mock的方式也差不多。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">用于客户端模拟所有rest端点的服务器工作进程</figcaption></figure><p id="60d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">上面，我们已经定义了所有的REST APIs及其响应，如果您注意到，我们的REST端点都指向一个HTTPS服务器<em class="jk">(API URL前缀)</em>。这是因为服务人员将通过HTTPS而不是HTTP接受服务(请始终注意这一点)。</p><p id="21ee" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以附加响应状态，JSON，e.t.c，这很好，类似于我们的API的正常行为。</p><p id="ed65" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">setupWorker或处理程序尚未启动；因此，服务工作器API不会拦截任何请求。我们将在开发模式下启动worker，因为我们不想在生产甚至是登台时遇到模拟。</p><p id="46a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">就这么办吧。</p><figure class="li lj lk ll fd ij"><div class="bz dy l di"><div class="lm ln l"/></div></figure><p id="cd58" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们需要做的就是将上面的文件导入到应用程序的入口点。</p><pre class="li lj lk ll fd ls lt lu lv aw lw bi"><span id="b425" class="js jt hi lt b fi lx ly l lz ma">//index.ts</span><span id="3220" class="js jt hi lt b fi mb ly l lz ma">import './server'</span></pre><p id="76d9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，当我们启动react应用程序时，我们应该在浏览器控制台中看到以下内容。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/139c3fa3aad7241d7b34d773c9c04463.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cvk3WyZvzHGqWRNY_dN-Zw.png"/></div></div></figure><p id="922b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">太棒了。</p><p id="3d23" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们向<strong class="io hj"> <em class="jk"> "/todo/all" </em> </strong>端点发出一个API请求，并查看Network选项卡，我们将看到一个实际的请求和由服务工作器API提供的相应响应。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mh"><img src="../Images/9367f369fca5b41830572c24995c45a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ysJlhPgiZT9-EmMUjxYstQ.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">请求检索todosDB.json中的所有todo，并从服务工作器API获得响应</figcaption></figure><p id="043c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将从todoDB.json中检索todos数据。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mh"><img src="../Images/243493cfe7b0b587fa7d3a7347960d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F12xveHEn5cchuQLmEk-Hw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx translated">todoDB.json的响应</figcaption></figure><p id="aeab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这是伟大的，因为我们没有我们的后端准备好，等等；作为前端开发人员，我们在开发过程中没有遇到任何阻碍。</p><p id="d4e4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">关于使用模拟的一个主要问题是维护，因为后端行为可能会快速变化，我们必须维护模拟。这是一个有效的观点，但是如果我们要在前端为这个API消费编写测试(我们将在本文的第二部分中做),我们仍然需要维护我们的模拟，考虑到我们的用户不会模拟fetch或Axios，因此我们的测试也不应该这样，如果有一种方法可以在开发服务器和测试服务器之间共享处理程序，从而只维护一个处理程序和API操作呢？</p><p id="e6a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将在下一篇文章中更深入地探讨MSW的威力。</p><p id="23ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>