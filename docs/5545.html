<html>
<head>
<title>Leveraging Salesforce Using a Client Written In Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Vue.js 编写的客户端利用 Salesforce</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/leveraging-salesforce-using-a-client-written-in-vue-js-e94dc0e19057?source=collection_archive---------9-----------------------#2021-10-14">https://medium.com/nerd-for-tech/leveraging-salesforce-using-a-client-written-in-vue-js-e94dc0e19057?source=collection_archive---------9-----------------------#2021-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dcbcd5c8a4604f61fffa60a354523a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ps7Kq9pvBUMSsRqHDMdpAw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://www.pexels.com/@picjumbo-com-55570?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">picjumbo.com</a>从<a class="ae iu" href="https://www.pexels.com/photo/woman-on-rock-platform-viewing-city-196667/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">派克斯</a>拍摄</figcaption></figure><p id="2f26" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在“<a class="ae iu" rel="noopener" href="/nerd-for-tech/leveraging-salesforce-without-using-salesforce-8ed8c2556926">利用 Spring Boot 的 sales force</a>”文章中，我介绍了引入 Spring Boot 服务的过程，该服务将利用成熟的 Salesforce RESTful API。该服务的目标是作为一个中间件层，允许未在 Salesforce 中编写的客户端检索和更新存储在 Salesforce 中的联系人数据。该后端服务实现了自己的缓存层，以提供更快的响应时间，并减少了调用 Salesforce 的次数。</p><p id="3905" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在“<a class="ae iu" rel="noopener" href="/nerd-for-tech/leveraging-salesforce-using-a-client-written-in-svelte-93b431a15bf4">使用用 Svelte 编写的客户端利用 Salesforce</a>”一文中，我介绍了一个用 Svelte 编写的简单客户端，它提供了使用内嵌编辑器更新 sales force 数据的能力。同样，无需实际使用 Salesforce 客户端。</p><p id="0a6f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我将介绍一个使用 Vue.js 框架的客户端应用程序，以进一步与 Spring Boot 服务交互，不仅从 Salesforce 读取数据，还通过服务器发送事件(SSE)实现处理和显示对 Salesforce 数据的更新。</p><h1 id="0f4d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么是 Vue.js？</h1><p id="c444" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">除了继续成为三大 JavaScript 客户端框架之一，Vue.js 还提供了以下优势:</p><ol class=""><li id="6f38" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">专注的公司(阿里巴巴和百度)和在中国的高采用率，帮助推动了持续的开发和采用，尽管没有得到任何大公司的资助。</li><li id="883e" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">Vue.js 的架构培养了一个较小的学习曲线，同时还提供了创建灵活组件的能力。</li><li id="8c39" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">由于运行时较小(约 20 KB)，Vue.js 无疑是一个比大多数竞争框架执行速度都快得多的框架。</li></ol><h1 id="e1ed" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">重温示例用例</h1><p id="ea40" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">回顾一下我们的示例用例，业务呼叫中心即将发起一场大型营销活动。然而，他们最近发现联系人列表中的标题大约 90%都是不正确的。</p><p id="6c1f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在“利用 Salesforce 使用苗条的客户端”一文中，我介绍了一个简单的客户端，允许一组实习生对联系人视图进行内联更新。虽然在 Vue.js 中重新引入这个逻辑很容易，但是让我们考虑一个额外的用例，在这个用例中，一个集中的团队需要知道何时应用标题更改。</p><p id="99c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，Vue.js 客户端应用程序将需要以下功能:</p><ol class=""><li id="5dd4" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">检索 Salesforce 中所有联系人的列表。</li><li id="f853" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">每当 RESTful API(和瘦客户端)中的标题改变时，收听广播的服务器发送事件(SSEs)。</li><li id="be79" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">标题更改时自动更新联系人列表。</li><li id="760a" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">显示一条简单的 toast 消息来总结标题更改事件。</li><li id="a513" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">在客户端确认之前，toast 消息将一直显示在屏幕上。</li></ol><p id="22f9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">出于本文的目的，下面是一个 toast 消息内容的示例:</p><blockquote class="lk ll lm"><p id="1c46" class="iv iw ln ix b iy iz ja jb jc jd je jf lo jh ji jj lp jl jm jn lq jp jq jr js hb bi translated">John Doe 的职位从销售经理更新为销售总监</p></blockquote><h1 id="968d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">Vue.js 入门</h1><p id="e869" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">类似于 Svelte 框架，Vue.js 入门相当简单。在本例中，我通过<code class="du lr ls lt lu b">npm</code>安装了 Vue.js 命令行界面(CLI ),但也可以使用<code class="du lr ls lt lu b">yarn</code>:</p><p id="b76e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">npm install -g @vue/cli</code></p><p id="5839" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Vue.js CLI 提供了以下选项:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="33b1" class="md ju hi lu b fi me mf l mg mh">Vue CLI v4.5.13<br/>? Please pick a preset:<br/>❯ Default ([Vue 2] babel, eslint)<br/>  Default (Vue 3) ([Vue 3] babel, eslint)<br/>  Manually select features</span></pre><p id="b38b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这个例子，我决定继续使用版本 2，因为此时我对版本 3 不太熟悉。</p><p id="8133" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">完成后，我只需要切换到新创建的文件夹并启动客户端:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="217c" class="md ju hi lu b fi me mf l mg mh">cd salesforce-integration-vue<br/>npm run serve</span></pre><p id="1a99" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">几秒钟后，我的终端会话中显示了以下输出:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="ba52" class="md ju hi lu b fi me mf l mg mh">DONE  Compiled successfully in 2288ms                                                                                                    1:43:50 PM</span><span id="f6cf" class="md ju hi lu b fi mi mf l mg mh">App running at:<br/> - Local:   <a class="ae iu" href="http://localhost:8080/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/</a><br/> - Network: <a class="ae iu" href="http://192.168.1.212:8080/" rel="noopener ugc nofollow" target="_blank">http://192.168.1.212:8080/</a></span><span id="e9d4" class="md ju hi lu b fi mi mf l mg mh">Note that the development build is not optimized.<br/> To create a production build, run npm run build.</span></pre><p id="facd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">导航到 localhost:8080 显示了 Vue.js 应用程序:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/5f234bf29e3ba51dcdb0e669b51d9f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xtc5ZoYxfPUfMurCAcqVA.png"/></div></div></figure><h1 id="5c15" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">添加一些依赖项</h1><p id="5e24" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">为了使 Vue.js 客户机满足示例用例的需求，我想定位现有的插件，以使我的工作更容易。我想在以下方面寻求帮助:</p><ul class=""><li id="0156" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js mk lc ld le bi translated">类似引导程序的样式(因为我不是 UI/UX 专家)</li><li id="4dd3" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js mk lc ld le bi translated">HTTP 客户端功能</li><li id="a9a8" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js mk lc ld le bi translated">SSE 处理</li><li id="661c" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js mk lc ld le bi translated">Toast 消息处理</li></ul><h2 id="1faf" class="md ju hi bd jv ml mm mn jz mo mp mq kd jg mr ms kh jk mt mu kl jo mv mw kp mx bi translated">自举 vue</h2><p id="2908" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">几分钟后，我找到了<a class="ae iu" href="https://bootstrap-vue.org/" rel="noopener ugc nofollow" target="_blank"> bootstrap-vue </a>依赖项，然后使用以下命令将其添加到我的项目中:</p><p id="7246" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">npm install vue bootstrap bootstrap-vue</code></p><p id="dbb7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我更新了<code class="du lr ls lt lu b">main.js</code>文件以包含以下内容:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="f1b4" class="md ju hi lu b fi me mf l mg mh">import BootstrapVue from 'bootstrap-vue'</span><span id="b77b" class="md ju hi lu b fi mi mf l mg mh">import 'bootstrap/dist/css/bootstrap.css'<br/>import 'bootstrap-vue/dist/bootstrap-vue.css'</span><span id="f876" class="md ju hi lu b fi mi mf l mg mh">Vue.use(BootstrapVue)</span></pre><p id="379a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，标准的引导类，如下所示，将使我的应用程序看起来更好:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="2361" class="md ju hi lu b fi me mf l mg mh">&lt;table class="table"&gt;<br/>      &lt;thead class="thead-dark"&gt;</span></pre><h2 id="502f" class="md ju hi bd jv ml mm mn jz mo mp mq kd jg mr ms kh jk mt mu kl jo mv mw kp mx bi translated">axios</h2><p id="b50b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">找到一个可靠的 HTTP 客户端也很快很容易。我简单地添加了<a class="ae iu" href="https://www.npmjs.com/package/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>依赖关系:</p><p id="72f3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">npm install --save axios</code></p><p id="af87" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">安装完成后，我在下面定义的<code class="du lr ls lt lu b">./src</code>文件夹中创建了一个简单的联系人服务，从 Spring Boot RESTful 服务中检索联系人列表:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="3e3d" class="md ju hi lu b fi me mf l mg mh">import axios from 'axios'</span><span id="4131" class="md ju hi lu b fi mi mf l mg mh">const SERVER_URL = '<a class="ae iu" href="http://localhost:9999'" rel="noopener ugc nofollow" target="_blank">http://localhost:9999'</a>;</span><span id="96f9" class="md ju hi lu b fi mi mf l mg mh">const instance = axios.create({<br/>    baseURL: SERVER_URL,<br/>    timeout: 1000<br/>});</span><span id="c50c" class="md ju hi lu b fi mi mf l mg mh">export default {<br/>    getContacts: () =&gt; instance.get('/contacts', {<br/>        transformResponse: [function (data) {<br/>            return data ? JSON.parse(data) : data;<br/>        }]<br/>    })<br/>}</span></pre><h2 id="a993" class="md ju hi bd jv ml mm mn jz mo mp mq kd jg mr ms kh jk mt mu kl jo mv mw kp mx bi translated">vue-sse</h2><p id="3437" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://www.npmjs.com/package/vue-sse" rel="noopener ugc nofollow" target="_blank"> vue-sse </a>依赖项将处理 SSEs 的处理，并使用以下 CLI 命令添加到应用程序中:</p><p id="c8f0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">npm install --save vue-sse</code></p><p id="817e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，<code class="du lr ls lt lu b">main.js</code>文件被更新为包括以下项目:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="df5d" class="md ju hi lu b fi me mf l mg mh">import VueSSE from 'vue-sse';</span><span id="70ca" class="md ju hi lu b fi mi mf l mg mh">Vue.use(VueSSE)</span></pre><p id="22ed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">vue-sse 依赖项现在已经可以使用了，将在本文的后面进一步记录。</p><h2 id="4276" class="md ju hi bd jv ml mm mn jz mo mp mq kd jg mr ms kh jk mt mu kl jo mv mw kp mx bi translated">提示提示通知</h2><p id="0fbe" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated"><a class="ae iu" href="https://www.npmjs.com/package/vue-toast-notification" rel="noopener ugc nofollow" target="_blank"> vue-toast-notification </a>依赖项将用于示例用例中提到的所需 toast 消息。向应用程序添加 toast 通知功能需要以下 CLI 命令:</p><p id="dddf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><code class="du lr ls lt lu b">npm install vue-toast-notification</code></p><p id="b2e1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，<code class="du lr ls lt lu b">main.js</code>文件被更新为包括以下项目:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="0f48" class="md ju hi lu b fi me mf l mg mh">import VueToast from 'vue-toast-notification';</span><span id="a65e" class="md ju hi lu b fi mi mf l mg mh">import 'vue-toast-notification/dist/theme-sugar.css';</span><span id="cf62" class="md ju hi lu b fi mi mf l mg mh">Vue.use(VueToast);</span></pre><p id="4e40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此时，toast 通知逻辑已经就绪，可以使用了。</p><h1 id="08aa" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">更新 Spring Boot RESTful 服务</h1><p id="28a3" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">最初在“<a class="ae iu" href="https://dzone.com/articles/leveraging-salesforce-without-using-salesforce" rel="noopener ugc nofollow" target="_blank">利用 Salesforce 而不使用 Salesforce </a>”文章中创建的 Spring Boot RESTful 服务需要进行修改，以便为 Vue.js 客户端提供一个 URI 来进行 SSE 处理。当然，Spring Boot RESTful 服务也需要更新，以实际创建和广播存储在 Salesforce 中的联系人的标题更改。</p><p id="771f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这一节将讨论 Spring Boot 存储库所需的 Java 更新。如果您对所需的服务层更新不感兴趣，并计划简单地下载最新的服务层代码，只需向下滚动到“创建联系人组件”部分。</p><p id="0c10" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">提醒一下，服务层代码可以在 GitLab 的以下存储库中找到:</p><p id="0725" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-service" rel="noopener ugc nofollow" target="_blank">https://git lab . com/johnj vester/sales force-integration-service</a></p><h1 id="9051" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍联系人事件发布者</h1><p id="794b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">因为 SSE 消息将包含来自 Contact 实例的更新信息，所以我为示例用例创建了一个简单的<a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-service/-/blob/master/src/main/java/com/gitlab/johnjvester/salesforceintegrationservice/events/ContactEvent.java" rel="noopener ugc nofollow" target="_blank"> ContactEvent </a>:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="11c5" class="md ju hi lu b fi me mf l mg mh"><a class="ae iu" href="http://twitter.com/NoArgsConstructor" rel="noopener ugc nofollow" target="_blank">@NoArgsConstructor</a><br/><a class="ae iu" href="http://twitter.com/AllArgsConstructor" rel="noopener ugc nofollow" target="_blank">@AllArgsConstructor</a><br/><a class="ae iu" href="http://twitter.com/Data" rel="noopener ugc nofollow" target="_blank">@Data</a><br/>public class ContactEvent {<br/>    private Contact contact;<br/>}</span></pre><p id="847d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">利用 Spring Boot 已经存在的应用程序事件发布者，一个简单的<a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-service/-/blob/master/src/main/java/com/gitlab/johnjvester/salesforceintegrationservice/events/ContactEventPublisher.java" rel="noopener ugc nofollow" target="_blank"> ContactEventPublisher </a>被添加到服务中:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="baa1" class="md ju hi lu b fi me mf l mg mh"><a class="ae iu" href="http://twitter.com/RequiredArgsConstruc" rel="noopener ugc nofollow" target="_blank">@RequiredArgsConstruc</a>tor<br/><a class="ae iu" href="http://twitter.com/Component" rel="noopener ugc nofollow" target="_blank">@Component</a><br/>public class ContactEventPublisher {<br/>    private final ApplicationEventPublisher applicationEventPublisher;</span><span id="dbb8" class="md ju hi lu b fi mi mf l mg mh">public void publishContactEvent(Contact contact) {<br/>        applicationEventPublisher.publishEvent(new ContactEvent(contact));<br/>    }<br/>}</span></pre><p id="dfbd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，补丁事件的<a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-service/-/blob/master/src/main/java/com/gitlab/johnjvester/salesforceintegrationservice/services/ContactService.java#L85" rel="noopener ugc nofollow" target="_blank"> updateContact() </a>方法被更新以发布联系人更改:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="547f" class="md ju hi lu b fi me mf l mg mh">Contact contact = getContact(id);<br/>contactEventPublisher.publishContactEvent(contact);<br/>return contact;</span></pre><h1 id="6cda" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">提供流控制器</h1><p id="2006" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">更新 Spring Boot 服务以发布事件后，下一步是提供一个控制器<a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-service/-/blob/master/src/main/java/com/gitlab/johnjvester/salesforceintegrationservice/controllers/StreamController.java" rel="noopener ugc nofollow" target="_blank">和</a>，Vue.js 客户端可以连接到这个控制器以监听联系人的变化。</p><p id="a874" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了区分不同的客户端会话，我决定最好包含一个会话标识符来跟踪每个侦听器。因此，我创建了以下类来跟踪每个监听联系人更改的客户端:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="b8aa" class="md ju hi lu b fi me mf l mg mh"><a class="ae iu" href="http://twitter.com/Data" rel="noopener ugc nofollow" target="_blank">@Data</a><br/><a class="ae iu" href="http://twitter.com/RequiredArgsConstruc" rel="noopener ugc nofollow" target="_blank">@RequiredArgsConstruc</a>tor<br/>static class WebClient {<br/>   private final String sessionId;<br/>   private final SseEmitter emitter;<br/>}</span></pre><p id="ca62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这样的设计，就有可能将 SSE 消息定向到给定的客户端会话。但是，在本系列的这一部分，我们不会执行该功能。</p><p id="39a2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，创建了<code class="du lr ls lt lu b">/stream/{sessionId}</code>来为 Vue.js 客户端提供 URI，以便订阅基于联系人的更新:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="672b" class="md ju hi lu b fi me mf l mg mh"><a class="ae iu" href="http://twitter.com/GetMapping" rel="noopener ugc nofollow" target="_blank">@GetMapping</a>(value = "/stream/{sessionId}", produces = MediaType.TEXT_EVENT_STREAM_VALUE)<br/>public SseEmitter contactEvents(<a class="ae iu" href="http://twitter.com/PathVariable" rel="noopener ugc nofollow" target="_blank">@PathVariable</a>("sessionId") String sessionId, HttpServletResponse response) {<br/>    response.setHeader("Cache-Control", "no-store");<br/>    log.info("Creating emitter for sessionId={}", sessionId);</span><span id="8aa6" class="md ju hi lu b fi mi mf l mg mh">WebClient webClient = new WebClient(sessionId, new SseEmitter(ONE_HOUR));</span><span id="a0a2" class="md ju hi lu b fi mi mf l mg mh">Set&lt;WebClient&gt; webClientsForDocument = EMITTERS.computeIfAbsent(sessionId,<br/>            key -&gt; Collections.newSetFromMap(new ConcurrentReferenceHashMap&lt;&gt;()));<br/>    webClientsForDocument.add(webClient);</span><span id="a312" class="md ju hi lu b fi mi mf l mg mh">webClient.getEmitter().onCompletion(() -&gt; {<br/>        log.info("Removing completed emitter for sessionId={}", sessionId);<br/>        removeWebClientEmitter(sessionId, webClient);<br/>    });</span><span id="82a6" class="md ju hi lu b fi mi mf l mg mh">webClient.getEmitter().onTimeout(() -&gt; {<br/>        log.warn("Removing timed out emitter for sessionId={}", sessionId);<br/>        removeWebClientEmitter(sessionId, webClient);<br/>    });</span><span id="a9de" class="md ju hi lu b fi mi mf l mg mh">return webClient.getEmitter();<br/>}</span></pre><p id="d369" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在很高的层次上，<code class="du lr ls lt lu b">contactEvents()</code>方法完成了以下任务:</p><ol class=""><li id="6e59" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js lb lc ld le bi translated">为提供的 sessionId 建立新的 WebClient</li><li id="e76a" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">当接触事件到达时，添加到要广播到的发射器列表</li><li id="f791" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js lb lc ld le bi translated">超时或完成时移除发射器</li></ol><p id="d491" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，需要介绍事件处理。在 Spring Boot，<code class="du lr ls lt lu b">@EventListener</code>可以用一种简单的方法加以注释:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="7525" class="md ju hi lu b fi me mf l mg mh"><a class="ae iu" href="http://twitter.com/EventListener" rel="noopener ugc nofollow" target="_blank">@EventListener</a><br/>public void onDocumentEvent(ContactEvent contactEvent) {<br/>    processEvent(contactEvent);<br/>}</span></pre><p id="f519" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当发布 ContactEvents 时，<code class="du lr ls lt lu b">processEvent()</code>方法简单地将更改广播给每个监听客户端:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="c44b" class="md ju hi lu b fi me mf l mg mh">protected void processEvent(ContactEvent contactEvent) {<br/>    Collection&lt;WebClient&gt; matchingEmitters = EMITTERS.values().stream()<br/>            .flatMap(Collection::stream)<br/>            .collect(toCollection(HashSet::new));</span><span id="cb40" class="md ju hi lu b fi mi mf l mg mh">matchingEmitters.parallelStream().forEach(webClient -&gt; {<br/>            if (webClient != null) {<br/>                try {<br/>                    log.debug("Sending contact={} to WebClient sessionId={}", contactEvent.getContact(), webClient.getSessionId());<br/>                    webClient.emitter.send(contactEvent.getContact());<br/>                } catch (IOException e) {<br/>                    e.printStackTrace();<br/>                }<br/>            }<br/>        });<br/>}</span></pre><p id="2e79" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">随着 Spring Boot 服务的更新和重启，我们可以继续关注 Vue.js 客户端更新。</p><h1 id="982e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建联系人组件</h1><p id="d58b" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">和 Svelte 一样，Vue.js 允许单文件组件存在。使用 IntelliJ IDEA 和 Vue.js 插件，我创建了 Contacts.vue 组件文件，并为视图数据添加了一个简单的部分——包括标准化的引导标记:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="3604" class="md ju hi lu b fi me mf l mg mh">&lt;template&gt;<br/>  &lt;div v-if="loading"&gt;<br/>    &lt;p class="loading"&gt;loading ...&lt;/p&gt;<br/>  &lt;/div&gt;<br/>  &lt;div v-else&gt;<br/>    &lt;table class="table"&gt;<br/>      &lt;thead class="thead-dark"&gt;<br/>      &lt;tr&gt;<br/>        &lt;th scope="col"&gt;Name&lt;/th&gt;<br/>        &lt;th scope="col"&gt;Department&lt;/th&gt;<br/>        &lt;th scope="col"&gt;Title&lt;/th&gt;<br/>      &lt;/tr&gt;<br/>      &lt;/thead&gt;<br/>      &lt;tbody&gt;<br/>      &lt;tr v-for="contact in contacts" :key="contact.id"&gt;<br/>        &lt;td&gt;{{contact.Name}}&lt;/td&gt;<br/>        &lt;td&gt;{{contact.Department ? contact.Department : "(not set)"}}&lt;/td&gt;<br/>        &lt;td&gt;{{contact.Title}}&lt;/td&gt;<br/>      &lt;/tr&gt;<br/>      &lt;/tbody&gt;<br/>    &lt;/table&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="ba18" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">contacts 组件的脚本部分的核心非常简单:建立 SSE 客户机、一个联系人数组和一个加载布尔值:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="3b1c" class="md ju hi lu b fi me mf l mg mh">import contactService from '../contact-service';</span><span id="e326" class="md ju hi lu b fi mi mf l mg mh">let sseClient;</span><span id="97ec" class="md ju hi lu b fi mi mf l mg mh">export default {<br/>  name: "Contacts",</span><span id="776f" class="md ju hi lu b fi mi mf l mg mh">data() {<br/>    return {<br/>      loading: true,<br/>      contacts: []<br/>    };<br/>  },</span></pre><p id="a55c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">添加<code class="du lr ls lt lu b">mounted()</code>功能是为了从 Spring Boot RESTful API 中检索联系人列表，并为 SSE 功能建立一个监听器:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="0e98" class="md ju hi lu b fi me mf l mg mh">mounted() {<br/>    contactService.getContacts()<br/>        .then(response =&gt; {<br/>          console.log('contacts', response.data);<br/>          this.contacts = response.data;<br/>        })<br/>        .catch(error =&gt; {<br/>          console.error(error)<br/>        })<br/>        .finally(() =&gt; this.loading = false);</span><span id="4c56" class="md ju hi lu b fi mi mf l mg mh">sseClient = this.$sse.create({<br/>      url: '<a class="ae iu" href="http://localhost:9999/stream/'" rel="noopener ugc nofollow" target="_blank">http://localhost:9999/stream/'</a> + uuidv4(),<br/>      format: 'json',<br/>      withCredentials: false,<br/>      polyfill: true,<br/>    });</span><span id="217e" class="md ju hi lu b fi mi mf l mg mh">sseClient.on('message', this.handleMessage);</span><span id="d041" class="md ju hi lu b fi mi mf l mg mh">sseClient.connect()<br/>        .then(sse =&gt; {<br/>          console.log('Listening for SSEs on sse', sse);</span><span id="ab78" class="md ju hi lu b fi mi mf l mg mh">setTimeout(() =&gt; {<br/>            sseClient.off('message', this.handleMessage);<br/>            console.log('Stopped listening');<br/>          }, 60000);<br/>        })<br/>        .catch((err) =&gt; {<br/>          console.error('Failed to connect to server', err);<br/>        });<br/>  }</span></pre><p id="fd99" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了在 SSE URI 上为每个监听器生成一个惟一的 ID，在 contacts 组件中添加了一个简单的函数:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="2fc1" class="md ju hi lu b fi me mf l mg mh">function uuidv4() {<br/>  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {<br/>    let r = Math.random() * 16 | 0, v = c === 'x' ? r : (r &amp; 0x3 | 0x8);<br/>    return v.toString(16);<br/>  });<br/>}</span></pre><p id="d9f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，组件中添加了处理创建 toast 消息和 SSE 客户端断开连接的方法:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="35d6" class="md ju hi lu b fi me mf l mg mh">handleMessage(message) {<br/>      console.info('Received message', message);</span><span id="27ad" class="md ju hi lu b fi mi mf l mg mh">if (message.id &amp;&amp; this.contacts) {<br/>        let foundIndex = this.contacts.findIndex(x =&gt; x.id === message.id);</span><span id="1719" class="md ju hi lu b fi mi mf l mg mh">if (foundIndex &gt;= 0) {<br/>          let contact = this.contacts[foundIndex];</span><span id="99a3" class="md ju hi lu b fi mi mf l mg mh">let toastMessage = 'Title updated for ' + contact.Name + ' from ' + contact.Title + ' to ' + message.Title;</span><span id="a719" class="md ju hi lu b fi mi mf l mg mh">console.info(toastMessage);</span><span id="6e97" class="md ju hi lu b fi mi mf l mg mh">this.$toast.info(toastMessage, {<br/>            position : "bottom",<br/>            duration : 0<br/>          });</span><span id="5a91" class="md ju hi lu b fi mi mf l mg mh">contact.Title = message.Title;<br/>        }<br/>      }<br/>    }<br/>  },<br/>  beforeDestroy() {<br/>    sseClient.disconnect();<br/>  }</span></pre><p id="bd16" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要查看 Contacts 组件的最终版本，其中包括一个空的<style>部分，请查看以下 URL:&lt;/root&gt;</style></p><p id="b1cf" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-vue/-/blob/master/src/components/Contacts.vue" rel="noopener ugc nofollow" target="_blank">https://git lab . com/johnj vester/sales force-integration-vue/-/blob/master/src/components/contacts . vue</a></p><h1 id="aca6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">使用 Vue.js 客户端</h1><p id="1c0c" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">更新了“App.vue”组件，删除了 hello world 方面，产生了以下设计:</p><pre class="lv lw lx ly fd lz lu ma mb aw mc bi"><span id="79be" class="md ju hi lu b fi me mf l mg mh">&lt;template&gt;<br/>  &lt;div id="app"&gt;<br/>    &lt;h1&gt;Contact List (from Salesforce)&lt;/h1&gt;<br/>    &lt;Contacts /&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;<br/><br/>&lt;script&gt;<br/>import Contacts from "./components/Contacts";<br/><br/>export default {<br/>  name: 'App',<br/>  components: {<br/>    Contacts<br/>  },<br/>  data: () =&gt; {<br/>    return {<br/>    }<br/>  }<br/>}<br/>&lt;/script&gt;</span></pre><p id="ad05" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">有了这些更改，导航到 localhost:8080 显示了更新的 Vue.js 应用程序:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/e8e2a29734a4a31e291e148f2e0c62c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zn3S2c9d5uH_YrCrQr3DTA.png"/></div></div></figure><p id="f401" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，使用一个简单的 cURL 命令，我将 Sean Forbes 的头衔从 CFO 更新为 CEO。此事件更新了 Vue.js 应用程序，如下所示:</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mz"><img src="../Images/2984e53b380a2e13b49f37b84cccf365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGs4HZYwc8mbAAqoB0rTLQ.png"/></div></div></figure><p id="7953" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意上面列表中的标题变化和 toast 消息。</p><h1 id="cf15" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">并排演示</h1><p id="26c6" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">使用到目前为止在这个系列中创建的所有东西，我创建了一个动画 GIF，在左边显示了 Svelte 客户端，在右边显示了 Vue.js 客户端。</p><figure class="lv lw lx ly fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/f36976f0409f4497af2a8871eaf4250d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*T2Z23eQIsa5Lexa1_bUGBw.gif"/></div></div></figure><p id="d24a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在动画演示中，标题使用 Svelte 中的内嵌编辑功能进行更新。在 Svelte 客户端中更新标题后不久，Vue.js 客户端会收到带有更新的联系人信息的 SSE，并动态更新更新的联系人的数据。同时，显示 toast 消息，该消息会一直显示在屏幕上，直到最终用户确认。</p><h1 id="3d33" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="d553" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">从 2021 年开始，我一直努力实践以下使命宣言，我觉得这适用于任何 IT 专业人士:</p><blockquote class="lk ll lm"><p id="84d1" class="iv iw ln ix b iy iz ja jb jc jd je jf lo jh ji jj lp jl jm jn lq jp jq jr js hb bi translated"><em class="hi">“将您的时间集中在提供扩展您知识产权价值的特性/功能上。将框架、产品和服务用于其他一切。”</em></p><p id="7876" class="iv iw ln ix b iy iz ja jb jc jd je jf lo jh ji jj lp jl jm jn lq jp jq jr js hb bi translated"><em class="hi"> - J. Vester </em></p></blockquote><p id="f90d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我利用现有的客户端框架和以 laser 为中心的依赖项来创建满足示例用例中提供的业务需求的组件。就像我使用苗条客户端的练习一样，完成这项工作的端到端时间实际上是用几分钟来衡量的。</p><p id="8c5a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然，生产就绪的场景需要做一些额外的工作来准备这个应用程序供“黄金时间”使用。</p><p id="d37a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您对用于 Vue.js 客户端的源代码感兴趣，只需导航到 GitLab 上的以下存储库:</p><p id="0f74" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><a class="ae iu" href="https://gitlab.com/johnjvester/salesforce-integration-vue" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/johnjvester/salesforce-integration-vue</a></p><p id="f10d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们还计划为以下其他基于 JavaScript 的客户端撰写后续文章:</p><ul class=""><li id="13dd" class="kw kx hi ix b iy iz jc jd jg ky jk kz jo la js mk lc ld le bi translated">反应(自然反应)</li><li id="34cf" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js mk lc ld le bi translated">有角的</li><li id="910a" class="kw kx hi ix b iy lf jc lg jg lh jk li jo lj js mk lc ld le bi translated">Lightning Web 组件(在 Salesforce 生态系统之外)</li></ul><p id="352c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>