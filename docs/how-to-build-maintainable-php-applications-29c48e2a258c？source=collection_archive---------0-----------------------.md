# 如何构建可维护的 PHP 应用程序

> 原文：<https://medium.com/nerd-for-tech/how-to-build-maintainable-php-applications-29c48e2a258c?source=collection_archive---------0----------------------->

![](img/a8569e0c91a9ccf6a9465abbef49aeb8.png)

你有没有因为很难改变而纠结于这个系统？你是否想升级框架或 PHP 版本，然而这需要做很多改变？
或者你正在开始一个新项目，你想避免这种情况？

在本文中，我们将讨论外部框架和库，因为经常发生的情况是，我们使用它们的方式阻碍了我们获得可维护的代码，这些代码可以跟进最新的升级。

*   出于本文的需要，我将把包称为库或框架的同义词。

# 框架，库陷阱

![](img/d435a141bffb5ef8f4ab5367537b8ce9.png)

# 与框架的耦合

当我们开始使用框架相关的类时，我们变得依赖它。

> *当框架获得主要版本升级时，问题开始变得真实。突破性的变化，需要我们修复我们的代码，以便跟进。*

当我们将它与外部库或框架模块结合时，问题就像鼹鼠从洞里钻出来一样开始暴露出来。
如果他们也进行突破性的变革，那么变革的需求就会成倍增加。或者，如果他们不遵循我们的最新框架版本，我们将需要替换他们或留在旧版本的框架。

# 配置超载

针对类、方法、名称空间或路径名称的配置会阻止我们自由移动类和方法，并增加重构时间。

> *每当我们更改方法名，将类移动到配置文件中引用的不同名称空间时，我们也有义务更改配置。*

# 别人的抽象

特定于您的业务并解决其问题的代码是业务相关代码。如果我们通过使用一些外部包来解决与业务相关的问题，从外部获取解决方案，我们迟早会遇到这样的情况，那是不够的。
它还增加了额外的软件包，我们将需要在下一次升级中携带这些软件包。

> 业务在发展和变化，系统需求也在发展和变化。如果我们通过使用外部包来解决我们的业务相关代码，我们就被置于它的所有者的摆布之下。

# 我们需要使用外部包进行开发吗？

![](img/3f16a735b34601a5d0259b449447b705.png)

让我们考虑一下情况，我们根本没有使用任何框架。
我们首先需要创建一些请求对象，来处理传入的 HTTP 请求。然后，我们需要构建路由系统，将我们的请求映射到具体的操作。依赖注入呢，我们也需要把我们的类连接在一起，对吗？

你可能听说过开发人员的可怕故事，他们没有框架，最终建立了自己的框架。

> *框架和库可以帮助我们。它们为我们解决了很多问题，因此我们可以在我们编写的代码中保持高效和更安全。我们无法逃脱外部包装。问题是如何使用它，以便我们能够受益并避免陷阱？*

# 如何使用框架、库并避免陷阱

![](img/a3b20df4015b1500e6a7c5812b7419d7.png)

那么我们如何使用框架和库来帮助我们长期维护和升级呢？

# 隔离面向业务的代码

每当我们实现核心业务功能时，我们可以将它从框架和库中移走。

> 这意味着实现外部包中的类，这样我们就可以按照自己的方式扩展和发展系统。

如果系统很大，我们将需要决定什么属于核心业务功能，因为将时间和资源投入到支持功能中可能对业务没有好处。
如果我们要实施房间租赁服务，我们可以将预约和时间安排作为核心，并使用第三方解决方案进行授权和认证。

# 允许框架粘合你的代码

如果我们决定使用这个框架，那么让它去做它的工作。在大多数情况下，这是为了让我们的生活变得更轻松。

在使用 Symfony 和 Laravel 这样的 Web 框架时，我们会利用控制器和路由，所以我们不需要花费时间来构建和连接 HTTP 请求到特定的类和动作。

另一个例子是*消息处理者*。
消息处理器负责处理特定的消息(类)。
有了它，我们可以构建解耦的解决方案，像 *HTTP 控制器*或*控制台行命令*这样的顶层可以构造消息并发送它，而无需引用特定的业务相关代码。
负责将消息移动到特定消息处理器的粘合代码将由框架负责。

> *通过让框架完成粘合代码，我们可以将更多的时间放在核心业务功能上。*

# 利用简单的配置

假设我们正在为我们的消息处理程序使用框架。
我们想注册我们的班级:

我们希望将类 *OrderHandler* 和方法 *handle* 注册为我们的*消息处理程序*，它将处理 *PlaceOrderMessage* 消息类。

那么注册这个处理程序我们有什么选择呢？

# 1.XML 或 YAML

第一种解决方案是使用 XML 或 YAML。
让我们看看这样的配置会是什么样子:

我们可以通过将业务代码从粘合代码中分离出来来实现良好的分离。然而它也有缺点，在任何重构的情况下，我们都需要编辑那些文件，这真的很耗时。如果你熟悉使用配置文件设置依赖注入，我相信你知道这有多痛苦。

# 2.实现框架特定的接口

第二个解决方案是实现框架提供的接口。

易于实现，因为我们只需要实现接口或扩展特定的类。很容易看出，这个类是消息处理器。然而，它创建了与框架的直接耦合。
这也是限制性的，因为我们需要遵循框架定义的惯例，而且我们不能在同一个类中注册多个消息处理程序。

# 3.PHP 配置

第三种解决方案是使用 PHP 提供配置。

这允许我们为类名保持自动重构工具。
我们还会通过将业务代码从粘合代码中分离出来来保持分离。
然而，在修改的情况下，仍需要手动更改方法名称。从类的内部，我们不能清楚地看到，它被注册为消息处理器。

# 4.PHP 属性

最后一个解决方案是使用[属性](https://wiki.php.net/rfc/attributes_v2)来提供配置。

框架会找到所有标注了*#【message handler】*的类和方法。
这允许我们改变方法和类名，而配置将保持不变。
我们还提供了该类内部的确切信息，即它被注册为消息处理程序。
我们可以在一个类中有多个消息处理程序。由于属性只是我们代码的注释(像文档块一样)，它保持了业务代码和框架代码的分离。

> 利用 PHP 的属性，将使你的代码自描述，易于重构和修改。

# 摘要

![](img/794f25251829efc52d1631396bd61065.png)

如果您想要构建可维护的代码，您应该清楚地区分什么是您的核心业务功能，并将其与外部包分开。这允许你按照自己方式发展，并减少使用的库的数量，这样你可以更容易地升级你的应用程序。
将粘合代码推到框架中，这样你就可以放下重复的任务，专注于业务代码。