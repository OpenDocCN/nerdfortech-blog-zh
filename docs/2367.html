<html>
<head>
<title>Algebraic Data Types in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的代数数据类型</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/algebraic-data-types-in-swift-2a777b24253d?source=collection_archive---------6-----------------------#2021-05-03">https://medium.com/nerd-for-tech/algebraic-data-types-in-swift-2a777b24253d?source=collection_archive---------6-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="471b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由其他类型组合而成的类型</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/734391bc24682647ba2cae721020c547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTMiAL4XftZygUYsSmlGXw.png"/></div></div></figure><h1 id="1a90" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是类型？</h1><p id="67f5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">当我们使用静态类型的编程语言时，比如Swift，我们可以用两种不同的方式来考虑类型。一种是从集合代数的角度，另一种是从内存布局的角度。</p><p id="eb8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们快速看一下后者。这不是本文的主题，但我认为区分这两种观点是有好处的。从内存布局的角度来看，类型只是程序运行时解释内存中原始字节的规则。它允许程序说:“好的，这120个字节是一个<code class="du ks kt ku kv b">Person</code>类型，前4个字节分配给<code class="du ks kt ku kv b">age</code>，接下来的116个字节分配给<code class="du ks kt ku kv b">name</code>”。这提供了内存安全并有助于避免内存损坏。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kw"><img src="../Images/040df1b3ba79d9cc1e3fd2bae73c5632.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h17d7rNqM7su-vnlO9uv2g.png"/></div></div></figure><p id="3698" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我们想把重点放在类型上，因为它们是在集合代数中定义的。在这里，类型只是它们可以保存的值的集合。我喜欢把它们想象成价值袋。我们可以这样来说明这一点:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/13b1207f627109effbd5f65e4ba9560a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cjUE-Djltsow9GsXVplwTQ.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">从集合代数的观点来看，简单地说，类型是值的集合(包)</figcaption></figure><h1 id="a496" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">原始和复合类型</h1><p id="2d6c" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">每种编程语言都有基本类型。它们通常是简单的和“原子的”,因为它们不能被分成更小的类型。</p><p id="8508" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有复合类型，顾名思义，由多个基本类型或复合类型组成。比如一个整数数组或者一个带有<code class="du ks kt ku kv b">age</code>和<code class="du ks kt ku kv b">name</code>字段的<code class="du ks kt ku kv b">Person</code>。<strong class="ih hj">代数数据类型是复合类型。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lc"><img src="../Images/d377b251126632b03a02c1d0accba1ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ef3nS1EjLCynamtkZ4jWoA.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">原始和复合类型</figcaption></figure><p id="4c57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有两种代数数据类型。乘积和总和类型。</p><h1 id="0fdb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">产品类型</h1><p id="1565" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，让我们熟悉一下产品类型，因为它们出现在几乎所有的编程语言中。<strong class="ih hj">产品类型将基本类型与AND连接词结合起来。</strong>比如一个人既有<code class="du ks kt ku kv b">age</code> <strong class="ih hj">又有</strong>可以是<code class="du ks kt ku kv b">married</code>。在Swift中，产品类型由元组、结构和类表示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ld"><img src="../Images/58f02b99dbf5962464f814e349df993e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7YnFIOJSJAwgfDm8Zit2qA.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">产品类型</figcaption></figure><p id="127a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了计算类型<code class="du ks kt ku kv b">Person</code>可以容纳的所有可能值，我们需要将<code class="du ks kt ku kv b">isMarried</code>字段和<code class="du ks kt ku kv b">age</code>字段的值相乘。我们需要得到他们的产品。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/7c7c372d7cc9c620eb7deb9ebeae994f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Uw1gecrBU5AZ49sCqQgVg.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">人员类型的所有可能值</figcaption></figure><p id="25b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以有256个已婚和256个未婚的人。人们可以活到255岁😄。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/fbc94491d341a7f8e019dbf5fe291e82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FcGcO2er8I5PP7-GiXl0ig.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">人员类型说明的所有可能值</figcaption></figure><h1 id="718e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">总和类型</h1><p id="e807" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated"><strong class="ih hj"> Sum类型将原始类型与OR连词组合在一起。他们代表了一种选择。在这个例子中，我们有一个文档的枚举。一张<code class="du ks kt ku kv b">Document</code>可以是出生证明<strong class="ih hj">也可以是驾驶执照</strong>。文档不能同时是两者。它们是互斥的。</strong></p><p id="5c1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Swift支持带有关联值的枚举。在这个例子中，出生证明带有<code class="du ks kt ku kv b">age</code>和驾驶执照——带有<code class="du ks kt ku kv b">isExpired</code>布尔值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/7c4825dd7b871a9a54a600af58d754c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LfrUC5BPNuwekyYnO943_w.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">总和类型</figcaption></figure><p id="badd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了计算一个<code class="du ks kt ku kv b">Document</code>类型的所有可能值，我们需要将每种情况的值相加。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/57a4234a70ad5da0e9900cde37e8b2f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZaBZzx4kXimsQv6ee9qFg.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">文档类型的所有可能值</figcaption></figure><p id="21b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">驾驶执照可以过期也可以不过期，出生证明的年龄可以从0到255，这与现实生活有一点距离，但作为一个例子就足够了。我们总共得到258个可能的值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/6a9a193593595dd4172aa0e5c1d53cb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Oq3zyJaz9RxItbptlkHFA.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">文档类型的所有可能值</figcaption></figure><h1 id="342c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">现实生活中的例子</h1><p id="2fc0" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">当然，我们可以组合Sum和Product类型。结构中可以有枚举值，枚举中可以有结构值。这为应用程序状态建模提供了极大的灵活性。在这个例子中，我们有3个互斥的<code class="du ks kt ku kv b">ScreenState</code>。当屏幕处于<code class="du ks kt ku kv b">loaded</code>状态时，我们可以访问一个<code class="du ks kt ku kv b">Journey</code>数组，它本身是<code class="du ks kt ku kv b">start</code>和<code class="du ks kt ku kv b">end</code>位置的产物。当屏幕为<code class="du ks kt ku kv b">loading</code>时，旅程甚至不存在。这使得不可能的状态在类型系统中无法表示。当数据仍在加载时，我们永远不会意外地渲染旅程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/e057bc2ea2bed0dae50eca8e7f5af4cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0KlsWP5G_mxZceEsf71QKQ.png"/></div></div></figure><p id="ff82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是另一个例子，伟大的<a class="ae lk" href="https://www.pointfree.co" rel="noopener ugc nofollow" target="_blank">自由点</a>团队在第<a class="ae lk" href="https://www.pointfree.co/episodes/ep4-algebraic-data-types" rel="noopener ugc nofollow" target="_blank">集</a>中讨论过。这是苹果的一个有问题的API，它不使用代数数据类型。这个API创建一个网络请求，并允许在完成处理程序中有多个非法状态。是用Objective-C实现的，它不支持ADT，所以不能怪他们。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/fca43820f5fc6be2036916aa36cbd642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lRfu1Ed-BBm_jXjwGsp8qA.jpeg"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated"><a class="ae lk" href="https://developer.apple.com/documentation/foundation/urlsession/1410330-datatask" rel="noopener ugc nofollow" target="_blank">URL session data task(with:completion handler:)</a></figcaption></figure><p id="9d4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来关注一下<code class="du ks kt ku kv b">completionHandler</code>。它接受可选<code class="du ks kt ku kv b">Data</code>、可选<code class="du ks kt ku kv b">URLResponse</code>和可选<code class="du ks kt ku kv b">Error</code>。以下是所有8种可能的组合，其中大多数实际上是非法的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/3c48cc2e9220eb8863657034ea40bee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rGrNP1geGBWIjvdeqQ93gA.png"/></div></div></figure><p id="9d38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们像Ole Begemann在他的<a class="ae lk" href="https://oleb.net/blog/2018/03/making-illegal-states-unrepresentable/" rel="noopener ugc nofollow" target="_blank">博客文章</a>中建议的那样引入两种新产品类型，我们可以解决这个问题并避免非法状态。一个保存响应的<code class="du ks kt ku kv b">Success</code>值，另一个保存<code class="du ks kt ku kv b">Failure</code>值。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/141371ef8309cbe7249e6432688acb94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*wWCrowIBrnfm9MNhuicaiQ.png"/></div></figure><p id="792d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们可以将它们组合成Swift的内置Sum类型，用于此类用例— <code class="du ks kt ku kv b">Result</code>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/671885056bbbd5f9e20812237b9dab81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mMsitM_frAx3AYZAkw6e-g.png"/></div></div></figure><p id="db53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看新旧API是如何比较的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lp"><img src="../Images/0277a90a55e44529f2113f8c33276f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VhrdHGePH8-bgcV7_w2vpg.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">好多了！</figcaption></figure></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><p id="ad3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">感谢您阅读本文。如果你喜欢，请鼓掌并评论🙂</strong></p><p id="bd00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">可以在</strong><a class="ae lk" href="https://github.com/Anastasia-Petrova" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">Github</strong></a><strong class="ih hj">和</strong><a class="ae lk" href="https://www.linkedin.com/in/anastasia-ios/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">LinkedIn</strong></a>上联系我</p></div></div>    
</body>
</html>