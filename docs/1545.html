<html>
<head>
<title>What is a Postmaster PID file in PostgreSQL? | Interview Q&amp;A</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL中的Postmaster PID文件是什么？|采访问答</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-is-a-postmaster-pid-file-in-postgresql-interview-q-a-db27f657ce78?source=collection_archive---------2-----------------------#2021-03-25">https://medium.com/nerd-for-tech/what-is-a-postmaster-pid-file-in-postgresql-interview-q-a-db27f657ce78?source=collection_archive---------2-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1167" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Postmaster下的PID文件在PostgreSQL中使用</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b49fbe0ee7550e6357aff09fb5cde49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mQHRqm8Ee42jssZ7yueH-A.png"/></div></div></figure><ul class=""><li id="bcd7" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">根据PostgreSQL架构，postmaster是集群启动时启动的第一个后台进程。</li><li id="26a5" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">它是所有其他后台进程的父进程。</li><li id="7655" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">如果任何其他后台进程失败，postmaster会自动重启死进程。</li><li id="6582" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">它也作为一个听众工作。当客户端向服务器发出请求时，它首先会进入postmaster并执行语法和语义检查，一旦通过，就会产生一个新的连接，这个过程称为“<strong class="ih hj"> Pgprocess </strong>”。</li><li id="73e5" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">postmaster作为父进程的监听器，所以它也被称为“<strong class="ih hj">监督</strong>”。</li></ul><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="5bfd" class="ki kj hi ke b fi kk kl l km kn"><strong class="ke hj">ps -ef|grep postmaster</strong></span><span id="c53c" class="ki kj hi ke b fi ko kl l km kn">postgres 393 32729 0 22:28 pts/3 00:00:00 grep postmaster</span></pre><p id="8ac1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">邮件管理员PID文件的用途:</strong></p><ul class=""><li id="b455" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">当群集启动并运行时，postmaster PID文件驻留在数据目录中。</li><li id="9292" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">该PID文件用于捕获</li></ul><p id="34b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1.当前邮局主管进程ID (PID)，</p><p id="6d33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.群集数据目录路径、邮局主管开始时间戳，</p><p id="c7c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.端口号，</p><p id="d171" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.Unix域套接字目录路径，</p><p id="670f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.监听地址(IP地址)</p><p id="b131" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.共享内存段id。</p><ul class=""><li id="9c4d" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">当群集启动并运行时，捕获的PID文件详细信息被锁定。它保护另一个集群启动或运行访问相同的端口号或数据目录。</li></ul><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="c2ec" class="ki kj hi ke b fi kk kl l km kn"><strong class="ke hj">$cd $PGDATA</strong></span><span id="31c3" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">$ls</strong></span><span id="e512" class="ki kj hi ke b fi ko kl l km kn">base     pg_commit_ts  pg_ident.conf  pg_notify    pg_snapshots  pg_subtrans  PG_VERSION  postgresql.auto.conf  <strong class="ke hj">postmaster.pid</strong><br/>global   pg_dynshmem   pg_logical     pg_replslot  pg_stat       pg_tblspc    pg_wal      postgresql.conf<br/>logfile  pg_hba.conf   pg_multixact   pg_serial    pg_stat_tmp   pg_twophase  pg_xact     postmaster.opts</span></pre><p id="d157" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要查看邮局主管PID文件:</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="7491" class="ki kj hi ke b fi kk kl l km kn"><strong class="ke hj">$ cat postmaster.pid</strong></span><span id="bcba" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">4693</strong></span><span id="c01c" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">/u01/pgdatabase/data</strong></span><span id="554e" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">1615688485</strong></span><span id="402f" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">5432</strong></span><span id="558c" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">/tmp</strong></span><span id="d493" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">*</strong></span><span id="8877" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">5432001 3604491</strong></span><span id="fa66" class="ki kj hi ke b fi ko kl l km kn"><strong class="ke hj">ready</strong></span></pre><p id="bfd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我刚刚使用pg_ctl停止了我的集群服务</p><pre class="je jf jg jh fd kd ke kf kg aw kh bi"><span id="5d26" class="ki kj hi ke b fi kk kl l km kn"><strong class="ke hj">pg_ctl stop -mf</strong></span><span id="3016" class="ki kj hi ke b fi ko kl l km kn">waiting for the server to shut down.... done</span><span id="8ef0" class="ki kj hi ke b fi ko kl l km kn">server stopped</span></pre><p id="e4e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">群集停止后，我们验证邮局主管PID文件是否已从数据目录中自动消失。</p><p id="d4e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">总结:</strong></p><p id="fd30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当群集服务启动并运行时，将自动生成邮局主管PID文件。</p><p id="0c14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它是一个锁定文件，用于维护当前的集群详细信息，即不允许使用这些详细信息在同一端口或数据目录上运行另一个集群</p></div></div>    
</body>
</html>