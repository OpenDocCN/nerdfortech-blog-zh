<html>
<head>
<title>Asynchronous WebSocket Messaging Middleware and Microservices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异步WebSocket消息中间件和微服务</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/asynchronous-websocket-messaging-middleware-and-microservices-1a50a8f14e4b?source=collection_archive---------4-----------------------#2021-08-03">https://medium.com/nerd-for-tech/asynchronous-websocket-messaging-middleware-and-microservices-1a50a8f14e4b?source=collection_archive---------4-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="045b" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">沿着SOCK JS的HTTP升级</h2><div class=""/><div class=""><h2 id="2e48" class="pw-subtitle-paragraph io hr hi bd b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf dx translated">Apache Kafka PUSH范例与STOMP客户端一起使用</h2></div><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/a7b6dab9950148ac328d0d0d2e415802.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3Mwr-YYe5BZ0hOKYOOS0Og.gif"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">STOMP客户端、SOCK JS和WebSocket架构</figcaption></figure><h1 id="c221" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">范围</h1><p id="e683" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">写这篇文章是为了帮助<em class="lk">初学者</em>和<em class="lk">中级</em>对WebSocket <strong class="kq hs"> <em class="lk">双向</em> </strong>和<strong class="kq hs"> <em class="lk">全双工</em> </strong>通信到<strong class="kq hs"> <em class="lk"> API </em> </strong>(应用程序接口)和<strong class="kq hs"> <em class="lk"> UI </em> </strong>(用户界面)有了代码示例。<br/> <em class="lk">解释以下概念:</em> <br/> a. WebSocket，HTTP升级<br/> b. Sock JS，JavaScript库<br/> c. STOMP Client(简单面向文本的消息传递协议)<br/> d. Kafka异步推送范式</p><h1 id="8982" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">先决条件</h1><p id="ed82" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">a.Kafka _ 2.13–2 . 8 . 0<br/>b . Offset Explorer 2.0(Kafka tool)<br/>c .弹簧靴</p><h1 id="0b7f" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">什么是WebSocket？而我们看到的优于HTTP的优势呢？</h1><p id="348c" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated"><strong class="kq hs"> <em class="lk"> HTTP </em> </strong>是同步的，是基于<strong class="kq hs"> <em class="lk">拉</em> </strong>范式的。在拉范例中，客户端必须发起请求<strong class="kq hs"> </strong>并轮询服务器以接收新数据，这是半双工和单向的<strong class="kq hs">。<br/> </strong> <em class="lk">每次建立连接都需要一个新的TCP</em><strong class="kq hs"><em class="lk">(</em></strong><em class="lk">传输控制协议</em> <strong class="kq hs"> <em class="lk"> ) </em> </strong> <em class="lk">会话。</em></p><p id="4ead" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> <em class="lk"> WebSocket </em> </strong>为全双工双向。这意味着客户端或服务器可以发起请求，并且通信可以与浏览器和服务器之间的持久连接并行进行，直到它们中的任何一个继续断开和关闭连接。<br/>与http相反，websocket支持异步通信，并允许服务器发起基于<strong class="kq hs"> <em class="lk">推</em> </strong>范例的请求。服务器可以发起请求并向客户端推送实时信息。<br/> <em class="lk">最初的http连接是</em> <strong class="kq hs"> <em class="lk"> </em> </strong> <em class="lk">升级为websocket并用于所有未来的通信中的单个</em><strong class="kq hs"><em class="lk"/></strong><em class="lk">TCP会话。</em><strong class="kq hs"><em class="lk"><br/></em></strong><strong class="kq hs"/>web socket中的数据交换量相比<strong class="kq hs"> </strong> http <strong class="kq hs">要小得多。每次请求时，HTTP都会产生一个开销，将头和cookies传输到服务器，这增加了延迟。websocket提供持久的低延迟连接。</strong></p><h1 id="bda0" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">这篇文章是如何组织的？它分享了哪些组件和产品来说明？</h1><p id="a244" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated"><strong class="kq hs"> <em class="lk">让我们来理解一下设计:- </em> </strong> <br/>一个简单的浏览器客户端会通过Sock JS，一个JavaScript库，建立websocket连接。浏览器发起的请求将升级到websocket，以提供持久的、全双工的双向连接。Sock JS客户端将尝试并连接使用最佳可用传输，即[websocket，xhr polling，xhr streaming]。<br/> STOMP(简单面向文本的消息协议)在websocket协议之上运行，向服务器发起请求，并订阅内存中的消息代理。在这个设计中，Kafka监听器从Kafka Topic接收数据，并异步发送到内存中的消息代理。由于STOMP客户端已经订阅了内存消息代理，它将接收数据并在客户端显示。来自客户端的数据传输和从服务器接收的数据异步发生。</p><h1 id="10ec" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">让我们访问代码，并了解它是如何工作的？</h1><p id="34bf" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated"><strong class="kq hs"> <em class="lk"> a. JavaScript代码</em> </strong></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lq"><img src="../Images/f0ccab665e50290279d6ebf066ea64c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MDB02ai08xNaTCaD87BfdQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated"><strong class="bd jy"> <em class="lr"> JavaScript代码—连接和订阅</em> </strong></figcaption></figure><p id="f2b7" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">上面的JavaScript代码调用函数connect()，该函数启动http连接并升级到websocket。传递给Sock JS构造函数的端点是一个注册的STOMP端点，支持Sock JS与websocket通信。STOMP客户端订阅内存中的消息代理，接收服务器端Kafka推送的异步数据。</p><p id="def0" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> <em class="lk"> b .弹簧开机配置类</em> </strong></p><p id="a2fd" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated">配置代码显示了STOMP端点注册和启用内存中的消息代理。</p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ls"><img src="../Images/41f13fa148785d2132d85bf8c0f63472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlfMjY3JcvJTmuz1V0iqUQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">STOMP注册和启用内存中的消息代理</figcaption></figure><p id="c302" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"><em class="lk">c . Spring boot Kafka Listener类<br/> </em> </strong> Kafka Listener将从Kafka Topic异步接收数据，并将接收到的数据推送到STOMP客户端订阅的端点，即内存中的消息代理，如下图所示。<br/> <em class="lk">更多关于阿帕奇卡夫卡及其术语的信息</em>、<a class="ae lt" rel="noopener" href="/geekculture/multi-broker-insights-into-apache-kafka-cluster-architecture-617b0abfc53e"> <strong class="kq hs"> <em class="lk">查看此链接</em></strong></a><strong class="kq hs"><em class="lk"/></strong><em class="lk">获取更多见解。</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lu"><img src="../Images/426ca27e30cba739a5c788a773484bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMwRMQIcS-F0btAJdDCN8g.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">卡夫卡听众</figcaption></figure><h1 id="252b" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">让我们运行应用程序:浏览器到服务器</h1><p id="b5b7" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated"><strong class="kq hs"> <em class="lk">在这个应用程序中执行以下操作:- </em> </strong> <br/> <em class="lk"> 1 .启动动物园管理员和卡夫卡经纪人</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lv"><img src="../Images/7d84be037ee79a879025a91c57fc7abd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ub2T6EPKlTW5MPTq1WdRYw.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">Zookeeper实例在端口2181上运行</figcaption></figure><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lw"><img src="../Images/1bf0164166508259a540a28f45b8b831.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hf1ClBgBJMIqG_7TaEaiqQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">在端口9092上运行的Kafka Broker 0</figcaption></figure><p id="5db6" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><em class="lk"> 2。启动偏移浏览器工具向Kafka发送消息主题</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es lx"><img src="../Images/aa65ff5fcc093e7f7bad4e2a7a6bdc31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rYkLDW-qtU35MfpNtpsWg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">向Kafka broker发送消息—键/值对</figcaption></figure><p id="e9c4" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><em class="lk"> 3。启动弹簧启动应用程序</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es ly"><img src="../Images/b3721e7620d2c6e807921ff1fa2ed4fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FpVfgBGDQA0G_8wZ53cOg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">从Kafka Broker收到的消息</figcaption></figure><p id="4428" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><em class="lk"> 4。在开发者工具模式下启动浏览器查看连接</em> <strong class="kq hs"> <em class="lk">升级</em> </strong> <em class="lk">从HTTP到WebSocket </em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/ddfa07608946af0e3d8ef3a3aed0c747.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhAKZ7XzEZq-R5wviVHoZQ.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">模式:开发人员工具—连接升级</figcaption></figure><p id="1368" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><em class="lk"> 5。查看STOMP客户端订阅的来自Kafka Topic的消息</em></p><figure class="jh ji jj jk fd jl er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jg"><img src="../Images/904438a9f405e78b38115790a37b87c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xhvLZpX6Vvt_zBBiuVdtyg.png"/></div></div><figcaption class="js jt et er es ju jv bd b be z dx translated">推送通知—从Kafka broker收到的异步消息</figcaption></figure><h1 id="45a6" class="jw jx hi bd jy jz ka kb kc kd ke kf kg ix kh iy ki ja kj jb kk jd kl je km kn bi translated">结论</h1><p id="8877" class="pw-post-body-paragraph ko kp hi kq b kr ks is kt ku kv iv kw kx ky kz la lb lc ld le lf lg lh li lj hb bi translated">总结这篇文章，我们理解了WebSocket的定义和使用Sock JS和STOMP client的优点。应用程序的设计和实现有助于理解启动websocket连接和从Kafka主题异步接收数据以在客户端用户界面上发布的简单代码片段。</p><p id="3500" class="pw-post-body-paragraph ko kp hi kq b kr ll is kt ku lm iv kw kx ln kz la lb lo ld le lf lp lh li lj hb bi translated"><strong class="kq hs"> <em class="lk">发布于2021年8月3日</em> </strong></p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><blockquote class="mg mh mi"><p id="decd" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><strong class="kq hs"> <em class="hi">其他中等文章，</em>由<em class="hi"> Ganesh Nagalingam </em> </strong></p><p id="d26e" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" rel="noopener" href="/geekculture/quest-syntax-tree-and-remedy-code-smell-using-japa-visitor-patterns-f023a89842cf"> <em class="hi">探寻语法树和补救代码气味利用JAPA</em>访问者模式</a></p><p id="2ff1" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" rel="noopener" href="/geekculture/amalgamate-angular-with-spring-cloud-architecture-through-cors-7f13b5fdb98f">通过CORS将Angular与Spring Cloud建筑融合</a></p><p id="c3ea" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" rel="noopener" href="/geekculture/multi-broker-insights-into-apache-kafka-cluster-architecture-617b0abfc53e"> <em class="hi">多代理洞察Apache Kafka集群架构</em> </a></p><p id="4bd7" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/remote-queue-definition-ibm-mq-v9-2-c3ec4f568dab?source=user_profile---------5----------------------------" rel="noopener">远程队列定义:IBM MQ v9.2 </a></p><p id="fa6f" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/kubernetes-pods-docker-containers-spin-vm-using-virtual-box-in-windows-10-home-d3be783ff087?source=user_profile---------0----------------------------" rel="noopener">Kubernetes Pods&amp;Docker Containers:在Windows 10 Home中使用虚拟盒子旋转虚拟机</a></p><p id="d198" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/federate-okta-idp-wso2-api-manager-as-gateway-to-spring-boot-microservices-integration-ba567567e81?source=user_profile---------1----------------------------" rel="noopener">联合OKTA IdP + WSO2 API管理器作为Spring boot微服务集成的网关</a></p><p id="4132" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/integrate-ibm-business-process-manager-with-hybrid-mobilefirst-application-5aed20841bf3?source=user_profile---------2----------------------------" rel="noopener">将IBM业务流程管理器与混合MobileFirst应用程序集成</a></p><p id="683f" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/kerberos-v5-sso-authentication-in-windows-10-home-using-apache-directory-studio-fb0151899185?source=user_profile---------3----------------------------" rel="noopener"> Kerberos v5:使用Apache directory studio在Windows 10 Home中进行SSO认证</a></p><p id="c57a" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/integrate-service-providers-sps-with-okta-identity-provider-idp-ce64a4e262ae?source=user_profile---------4----------------------------" rel="noopener">整合服务提供商(sp)和OKTA身份提供商(IdP) </a></p><p id="ec99" class="ko kp lk kq b kr ll is kt ku lm iv kw mj ln kz la mk lo ld le ml lp lh li lj hb bi translated"><a class="ae lt" href="https://ganeshblog.medium.com/integrate-ibm-websphere-service-registry-and-repository-with-ibm-process-server-f97eeb0e2ea?source=user_profile---------6----------------------------" rel="noopener">将IBM WebSphere Service Registry and Repository与IBM Process Server集成</a></p></blockquote></div></div>    
</body>
</html>