<html>
<head>
<title>SAP Tutorial: Complete CAP Java Part 6</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SAP教程:完整的CAP Java第6部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/sap-tutorial-complete-cap-java-part-6-81e9e867bc60?source=collection_archive---------10-----------------------#2021-07-09">https://medium.com/nerd-for-tech/sap-tutorial-complete-cap-java-part-6-81e9e867bc60?source=collection_archive---------10-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="743e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实施评级字段</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/09048bacf746d9ceffd1a0cf19517a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v1tGAhfiMagZp3J-"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的<a class="ae jt" href="https://unsplash.com/@thisisengineering?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> ThisisEngineering RAEng </a></figcaption></figure><h2 id="de4f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">内容</h2><ul class=""><li id="13a0" class="kp kq hi ih b ii kr im ks iq kt iu ku iy kv jc kw kx ky kz bi translated"><a class="ae jt" href="https://bnheise.medium.com/sap-tutorial-complete-cap-java-part-5-fb3ff81e64c1" rel="noopener">上一集:使用CD和费奥里元素中的单位</a></li><li id="8402" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><strong class="ih hj">当前:实施评级字段</strong></li><li id="2556" class="kp kq hi ih b ii la im lb iq lc iu ld iy le jc kw kx ky kz bi translated"><a class="ae jt" href="https://bnheise.medium.com/sap-tutorial-complete-cap-java-part-7-eba7169b38fd" rel="noopener">接下来:CDS数据模型中的类型、方面和关联</a></li></ul><p id="cd89" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欢迎来到完整的CAP Java教程系列的第6部分，在这里我将一步一步地向您展示如何构建SAP的示例<a class="ae jt" href="https://github.com/SAP-samples/cloud-cap-samples-java" rel="noopener ugc nofollow" target="_blank">书店</a>应用程序。到目前为止，我们一直致力于建立应用程序浏览书籍页面。让我们快速看一下到目前为止我们已经构建了什么:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lf"><img src="../Images/91f77176988d81abacac4ad74cc15c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mSlMcCDdCmxumarlhSW-2w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">我们的书店</figcaption></figure><p id="2752" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的目标，我们今天的目标在红框中:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lg"><img src="../Images/8ce5bb72b4d7e224e4880af987fc8d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CJXoSJMg7BhHJmod1R1Cyw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">SAP书店</figcaption></figure><p id="18aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我们的图书模型还不包含评级字段，所以让我们先来看看。</p><h1 id="309d" class="lh jv hi bd jw li lj lk ka ll lm ln ke lo lp lq kh lr ls lt kk lu lv lw kn lx bi translated">步骤1:将评级字段添加到模式中</h1><p id="974a" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">让我们仔细看看评级:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mb"><img src="../Images/06af13465bfde634da70e053e88afc21.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*TOFESaeFqLkQFXfsJDBDUQ.png"/></div></figure><p id="f7c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到评级显示为5颗星，因此我们似乎可以将其建模为0.0-5.0的整数范围。然而，我们也可以从第一行看到一个分数星，所以小数可能是一个更好的方法。让我们将它添加到<em class="mc"> db/Books.cds. </em>中的CDS模型中</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="f39f" class="ju jv hi me b fi mi mj l mk ml">rating   : Decimal(2, 1);</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mm"><img src="../Images/88a94c2c942bae5dc94623292a31eae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:880/format:webp/1*78DE-X3eFUbBEVKWaHrolA.png"/></div></figure><p id="44da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们为评级字段指定了小数类型，小数位数为2，精度为1，这意味着它将接受-9.9到9.9范围内的数字。它接近我们想要的，但不精确。让我们添加一些验证，以确保我们只能获得从0到5的数字。为此，我们将使用@assert.range注释。</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="4029" class="ju jv hi me b fi mi mj l mk ml">rating   : Decimal(2, 1)<a class="ae jt" href="http://twitter.com/assert" rel="noopener ugc nofollow" target="_blank">@assert</a>.range : [ 0.0, 5.0 ];</span></pre><p id="2db0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CAP为验证提供了其他几种方便的注释。你可以在这里阅读更多关于他们的信息<a class="ae jt" href="https://cap.cloud.sap/docs/guides/providing-services#input-validation" rel="noopener ugc nofollow" target="_blank">。另外，您可以尝试为我们的其他一些字段实现一些验证。</a></p><p id="bbc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无论如何，让我们将这个字段添加到我们的模拟数据中<em class="mc">db/data/toad lop . bookshop-books . csv .</em>在CSV中添加一个名为<em class="mc"> RATING的列；</em>并提供一些值。</p><p id="6933" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能想要测试我们的输入验证，所以让我们来尝试一下。你可能会想到的一种测试方法是向种子数据添加一个超出范围的值，然后启动应用程序，但如果你这样做了，一切都会正常启动。原因是<em class="mc"> cds - deploy </em>命令在后台运行，将数据发送到数据库，绕过了正常的输入检查。为了正确地测试它，我们必须使用我们在<a class="ae jt" rel="noopener" href="/nerd-for-tech/sap-tutorial-complete-cap-java-part-1-fc1868c7bbba">第1部分</a>中创建的<em class="mc"> rest-test.http </em>文件，并尝试实际发布不正确的数据。</p><p id="dbb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您还记得，我们在那里有以下请求:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/dcc21b9ff671453acba067e49a5438c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qKMxwRrXY49UnZs1S9yYoA.png"/></div></div></figure><p id="8116" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经更新了我们的oData服务，所以我们需要修复URL。特别是用<em class="mc"> api </em>替换<em class="mc"> odata/v4 </em>，用browse替换<em class="mc"> CatalogService </em>。此外，我们需要添加一些身份验证，所以将admin:admin@放在<em class="mc"> localhost </em>之前。结果应该如下所示:</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="305a" class="ju jv hi me b fi mi mj l mk ml">POST http://admin:admin@localhost:8080/api/browse/Books HTTP/1.1</span></pre><p id="1b22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，添加一个大于5或小于0的评分字段，并尝试单击“发送请求”。确保不要发送字符串，否则它会因为类型错误而失败，而不是因为超出范围。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mo"><img src="../Images/0e6a59f6d1cdeb8e046367db61c95cbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3mM0Bpl9qwjSgGeErGzeYQ.png"/></div></div></figure><p id="3d4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">非常好。现在把它放在一个有效的范围内，看看会发生什么:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mp"><img src="../Images/1d04b14126a5eeeff37da8ac180442fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z5YCb9FLjmbkBy28YAdqEA.png"/></div></div></figure><p id="7df7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很好！我们验证了键值的唯一性约束也得到维护(我们已经部署了一个ID为1的记录)。请将其设置为另一个ID，然后重试:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mq"><img src="../Images/c28ca552cd69fb2f675d717a50d69132.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WSq4ErUmx2gZkA_4lgjFNQ.png"/></div></div></figure><p id="34f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">成功！当然，现在我们数据库里有两本叫《呼啸山庄》的书。有趣的是，还可以尝试在title字段上实现唯一性约束。</p><p id="269f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，让我们看看用户界面，看看它是什么样子的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mr"><img src="../Images/407390bcc904d19fbd0cc6cc2e929311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bd0o3r17ns3JNNCJpA3P-w.png"/></div></div></figure><p id="4d5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还不错！数据会显示出来，但是我们仍然需要配置UI来显示它。我们将在步骤2中解决这个问题。</p><h1 id="f1cf" class="lh jv hi bd jw li lj lk ka ll lm ln ke lo lp lq kh lr ls lt kk lu lv lw kn lx bi translated">步骤2:将评级字段显示为星号</h1><p id="7451" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">和往常一样，第一步是使用我们的<em class="mc"> LineItem </em>注释来设置该列默认显示，并使用<em class="mc"> title </em>注释来设置该字段在应用程序中出现的公共标签。到现在为止，您应该知道如何做到这一点，所以我不会在这里介绍它。</p><p id="b2b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，新的是我们行项目的内容。请记住，过去我们只使用了两个属性:包含字段名称的<em class="mc">值</em>，以及允许我们提供特定于表格的标签的<em class="mc">标签，这与适用于任何地方的标准标签相反。该行项目将不会使用这两个选项，而是看起来像这样:</em></p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="9be4" class="ju jv hi me b fi mi mj l mk ml">    {<br/>      $Type  : 'UI.DataFieldForAnnotation',<br/>      Target : '<a class="ae jt" href="http://twitter.com/UI" rel="noopener ugc nofollow" target="_blank">@UI</a>.DataPoint#rating'<br/>    },</span></pre><p id="f9c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们从一个<em class="mc"> $Type </em>注释开始。我们以前没有使用过它，因为省略它会产生默认的注释UI。“DataField ”,这是表字段的标准类型，它只是按原样显示数据，不做任何处理。您甚至可以通过在<a class="ae jt" href="http://localhost:8080/api/browse/$metadata" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/API/browse/$ metadata</a>查看我们的oData服务的元数据来确认这一点:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ms"><img src="../Images/6e1d5b6378f3625f3ed2e5a8992c158b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPzoJ23ewpMyNarGjCbarQ.png"/></div></div></figure><p id="e582" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们的类型是<em class="mc"> DataFieldForAnnotation </em>。这仅仅意味着一个单独的注释将描述如何显示这个<em class="mc"> LineItem </em>。</p><p id="feac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一个注释是<em class="mc"> Target </em>，它表示包含如何显示字段的信息的注释。<em class="mc">目标</em>属性的值为'<a class="ae jt" href="http://twitter.com/UI" rel="noopener ugc nofollow" target="_blank"> @UI </a>。“数据点#评级”。这意味着一个<em class="mc"> UI。ID为“rating”的数据点</em>注释是可视化定义的位置。我们还没有做这个，所以让我们继续做吧。</p><p id="4abe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在文件底部附近的<em class="mc"> PresentationVariant </em>注释下方，添加以下内容:</p><pre class="je jf jg jh fd md me mf mg aw mh bi"><span id="4f68" class="ju jv hi me b fi mi mj l mk ml">  DataPoint #rating   : {<br/>    Value         : rating,<br/>    Visualization : #Rating,<br/>    TargetValue   : 5<br/>  }</span></pre><p id="2236" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我们定义了我们的<em class="mc">数据点</em>注释。注意# rating——它是这个注释的ID。<em class="mc">数据点</em>注释用于可视化单个值；例如，还有其他可视化方式可以在图形中显示聚合数据。</p><p id="bf17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mc">数据点</em>注释可以有很多不同的属性，但是在我们的例子中我们只需要三个:<em class="mc">值</em>、<em class="mc">可视化</em>和<em class="mc">目标值</em>。<em class="mc">值</em>是将使用此<em class="mc">数据点</em>可视化的字段，因此我们选择<em class="mc">评级</em>。<em class="mc">可视化</em>获取可视化类型的ID。有许多选择，但我们选择<em class="mc"> #Rating </em>，它将接受一个整数或小数，并将数据显示为星号。最后一个属性<em class="mc"> TargetValue </em>，指定要显示的星星总数。因为我们之前将字段的最大值设置为5，所以我们也将这里的目标值设置为5。</p><p id="9506" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在UI中检查结果:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/ff8c29e00574674ceda88ed7ba551c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bn2E-TeAbXvDtp0kLi9LOw.png"/></div></div></figure><p id="2b2c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看起来不错！</p><h1 id="7179" class="lh jv hi bd jw li lj lk ka ll lm ln ke lo lp lq kh lr ls lt kk lu lv lw kn lx bi translated">结论</h1><p id="9c0b" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">这一周到此结束。又短又甜！下周我们将开始研究你真正来这里的目的——当我们实现<em class="mc">添加评论</em>按钮时，如何向应用程序添加定制的Java逻辑。那里有很多事情要做，所以我们可能要花几个星期才能完成。敬请期待！</p></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><p id="d39e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本教程中有什么不清楚的吗？请在下面留下问题，我会尽快回复您。有什么不对吗？请在下面留下评论，让我知道(更正的来源将是最有帮助的)。谢谢大家的评论！</p></div><div class="ab cl mu mv gp mw" role="separator"><span class="mx bw bk my mz na"/><span class="mx bw bk my mz na"/><span class="mx bw bk my mz"/></div><div class="hb hc hd he hf"><h1 id="99f0" class="lh jv hi bd jw li nb lk ka ll nc ln ke lo nd lq kh lr ne lt kk lu nf lw kn lx bi translated">支持</h1><p id="39bb" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq ly is it iu lz iw ix iy ma ja jb jc hb bi translated">你喜欢这个博客吗？想确保我能继续创作吗？然后考虑在<a class="ae jt" href="https://www.patreon.com/toadhousetutorials" rel="noopener ugc nofollow" target="_blank"> Patreon </a>上订阅！</p></div></div>    
</body>
</html>