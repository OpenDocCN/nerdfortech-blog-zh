<html>
<head>
<title>Telegram bot in Go app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go 应用中的电报机器人</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/telegram-bot-in-go-app-911c92f8507d?source=collection_archive---------4-----------------------#2021-07-13">https://medium.com/nerd-for-tech/telegram-bot-in-go-app-911c92f8507d?source=collection_archive---------4-----------------------#2021-07-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="ev ex if ig ih ab cb"><figure class="ii ij ik il im in io paragraph-image"><img src="../Images/f0bb4a3932fd33944050d8830cf43c9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*pkCZwllgclT5emRckbOs5g.jpeg"/></figure><figure class="ii ij ir il im in io paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><img src="../Images/4caf2e20ecfa871e1fbb8739b550f314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*4Dd26LyqGAhLoFGcAeARaA.png"/></div></figure></div></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><p id="0312" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">通知是任何面向消费者的应用程序的重要组成部分。有各种各样的通知，向用户发送移动推送通知是一种主要机制。但是应用程序通知有一个警告，你需要有一个面向消费者的客户端或应用程序。</p><p id="11b8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我是一个后端的家伙，并没有真正得到任何经验，建设面向用户的 UI 或仪表板。我喜欢尝试构建一些有用的东西，但懒得为它构建一个前端或应用程序。我有时甚至让我的同事为我建造它，但没有金钱上的激励，要么他们否认，要么一路上失去兴趣。最近，我想到了这个发送通知的电报机器人的概念，并有兴趣了解它。</p><blockquote class="kb kc kd"><p id="a4c7" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">我觉得它会有所帮助的主要用例有:<br/> 1。在 telegram 聊天应用程序上为用户建立通知机制。<br/> 2。通知可以通过 API 端点链接连接到您的后端，这可以用来在浏览器中打开一些 URL。<br/> 3。提醒或促销活动。</p></blockquote></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><h1 id="8e24" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">用例</strong></h1><p id="93b5" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">我试图解决的用例是:<br/> 1。我的新闻应用后端同步来自谷歌新闻的新闻。<br/> 2。telegram 上的用户订阅了这个机器人。<br/> 3。当用户键入“Hi”时，我需要将当天的前 5 个新闻链接发送给订阅者。重要的一点要注意的是，该网址是出版商的，而不是我的后端。<br/> 4。cron 也在后面运行，它收集当天的前 5 条新闻，并将通知推送给机器人的所有订户。</p><blockquote class="kb kc kd"><p id="1370" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">PS:我不会讨论新闻应用后端，我会在之前的博文中提到。这篇文章只详细介绍了电报机器人以及它如何使用推送通知来传递新闻。</p></blockquote><p id="1e41" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们开始吧！首先，让我们在 telegram 中创建新的机器人。这个<a class="ae ll" href="https://core.telegram.org/bots/#3-how-do-i-create-a-bot" rel="noopener ugc nofollow" target="_blank"> <strong class="jf hj"> <em class="ke">链接</em> </strong> </a>用电报记录了 bot 世界的每一个方面。因为这是在应用程序本身上完成的，所以我将重点介绍项目符号中的步骤:</p><blockquote class="kb kc kd"><p id="ffb8" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">1.telegram 中所有机器人中最大的爸爸就是机器人爸爸。你需要找到这一点，并与它聊天，以创建一个机器人。聊天中所有的机器人对话都以“/start”开头。<br/> 2。高亮显示命令序列<br/>&gt;&gt;/开始<br/>&gt;&gt;/newbot<br/>&gt;&gt;&lt;bot _ name&gt;<br/>就是它了。一个机器人被创建。附上相同的截图</p></blockquote><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es lm"><img src="../Images/c83dbf34aaf716bbfa6d4dff2a8bca3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ylOvaK4zHsnSWQH3_vD8mQ.jpeg"/></div></div></figure><blockquote class="kb kc kd"><p id="9457" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">现在你可以访问 t.me/的网址<strong class="jf hj"><em class="hi">&lt;机器人用户名&gt; </em> </strong>，将你的机器人添加到你的聊天列表中。或者你可以在应用程序中搜索你的机器人。</p></blockquote><p id="b373" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">机器人准备好了。现在您可以探索机器人提供的各种功能。</p></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><h1 id="305d" class="ki kj hi bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">与 bot 的后端集成</strong></h1><p id="b0a5" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">为了通过你的后端服务器与你的机器人交互，你需要</p><ol class=""><li id="dca2" class="lr ls hi jf b jg jh jk jl jo lt js lu jw lv ka lw lx ly lz bi translated">一个身份验证令牌——在 botfather 中创建机器人时就可以获得</li><li id="105e" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated">了解电报聊天 API——参考上面分享的关于 API 文档的链接</li><li id="8a90" class="lr ls hi jf b jg ma jk mb jo mc js md jw me ka lw lx ly lz bi translated">你自己的后台。</li></ol><p id="33e1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如前所述，可以有两种通知机制—拉和推。1.拉机制将轮询电报更新 API，以获取关于谁订阅了您的 bot 或您的订阅者发布了什么消息的信息。这必须定期运行。并基于接收到的更新做出响应。</p><blockquote class="kb kc kd"><p id="c475" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated"><a class="ae ll" href="https://api.telegram.org/bot1853514787:AAHEi4brq8vXE39sYIqPTfFzfYNPvDDWmY0/getUpdates" rel="noopener ugc nofollow" target="_blank">https://api.telegram.org/bot&lt;授权令牌&gt;/获取更新</a></p></blockquote><p id="3229" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">2.另一个机制是 push，其中我们的后端从 telegram 服务器实时接收任何使用 webhooks 的用户操作的更新。这是我选择的机制，因为这更现实，并提供更好的 UX。在我的终端创建 API，并将其注册为 webhook。</p><blockquote class="kb kc kd"><p id="becc" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">https://api.telegram.org/bot&lt;授权令牌&gt; /setWebhook？url = {您的 API 服务器 url} </p></blockquote><p id="327a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">3.电报发送 API 用于将通知从我们的后端推送到电报机器人。</p><blockquote class="kb kc kd"><p id="eb99" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">https://api.telegram.org/bot&lt;授权令牌&gt;/发送消息？聊天标识= {聊天标识} &amp;文本= {文本} </p></blockquote></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><blockquote class="kb kc kd"><p id="9944" class="jd je ke jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hb bi translated">说够了！！！给我看看代码...</p></blockquote><p id="e320" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">实体/数据层</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="ad50" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">服务层</strong></p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="c2a9" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><strong class="jf hj">电报 HTTP 客户端</strong>(认证密钥被移除)</p><figure class="ln lo lp lq fd ij"><div class="bz dy l di"><div class="mf mg l"/></div></figure></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><p id="8622" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">这就是了。这段代码足以向 bot 订阅者发送通知。<br/> <em class="ke">又提起这个。由于方法是使用 webhooks 的</em> <strong class="jf hj"> <em class="ke">实时更新</em> </strong> <em class="ke">并从我们的服务器回复电报 bot 订户，所以可以从电报订户更新中提取并回复</em> <strong class="jf hj"> <em class="ke">发送 API </em> </strong> <em class="ke">中所需的</em><strong class="jf hj"><em class="ke">chat _ id</em></strong><em class="ke">信息。<br/>另一种方法是将</em><strong class="jf hj"><em class="ke">chat _ id</em></strong><em class="ke">保存在某个存储中(我使用 cassandra 表)。这可以在以后用于将消息推送给订阅者，而不需要任何订阅者动作，作为提醒通知机制。我用它来像 cron 一样定期通知。</em></p></div><div class="ab cl iw ix gp iy" role="separator"><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb jc"/><span class="iz bw bk ja jb"/></div><div class="hb hc hd he hf"><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mh"><img src="../Images/353a3817ea7071b362c20b1890947515.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*acmWyrlmQcU334h-AMFUSg.jpeg"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">用新闻链接回复用户</figcaption></figure><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es mm"><img src="../Images/9aae0cebf9fbe771491faac65d31da1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o5oAFPkLCqX8oBf5Mmf7vg.jpeg"/></div></div><figcaption class="mi mj et er es mk ml bd b be z dx translated">后端启动对话作为通知</figcaption></figure></div></div>    
</body>
</html>