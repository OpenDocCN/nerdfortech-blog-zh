<html>
<head>
<title>Do MMA fighters with longer arms win more fights? (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">手臂越长的 MMA 拳手是否会赢得更多的打斗？(第一部分)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/do-mma-fighters-with-longer-arms-win-more-fights-part-1-963dfca02a3a?source=collection_archive---------20-----------------------#2021-03-11">https://medium.com/nerd-for-tech/do-mma-fighters-with-longer-arms-win-more-fights-part-1-963dfca02a3a?source=collection_archive---------20-----------------------#2021-03-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="f1a9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">一个完整的 R 分析项目</h1><p id="36f8" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我去年发表了一篇关于职业拳击手手臂长度的论文。我发现臂展(两条伸展的手臂之间的距离)越大的拳手赢得的比赛越多。在论文中，我认为这(以及其他研究)可能表明，人类进化出了相对更长的手臂，因为它在战斗中帮助了祖先。有趣的东西。</p><p id="9dd8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">虽然我把论文<a class="ae kb" href="https://github.com/Thomas-Richardson/Is-Arm-Length-a-Sexually-Selected-Trait-in-Humans-Evidence-From-Mixed-Martial-Arts" rel="noopener ugc nofollow" target="_blank">的代码贴在了我的 github 上，</a>我想我应该做一个多部分的教程，教你如何收集、清理和分析数据，这样你就可以自己看到结论了。第 1 部分(这里)将处理从 ufcstats.com 收集数据。<a class="ae kb" rel="noopener" href="/nerd-for-tech/do-mma-fighters-with-longer-arms-win-more-fights-part-2-d08dbf13e5ca">第 2 部分将涉及清理/处理杂乱的数据</a>，第 3 部分将向您展示如何分析数据，主要使用回归分析。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/0b968ecd53cf8065bab837780a1ce42e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JCwURzvMoiTn-Tid"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">摘自 Unsplash</figcaption></figure><h1 id="43fb" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">抓取数据</h1><p id="93ec" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们需要用于 web 抓取的 rvest 包和用于管道的 magrittr 包(这使得代码更容易阅读)。如果没有，请使用 install.packages()</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="6eda" class="lc ig hi ky b fi ld le l lf lg">library('rvest')<br/>library('magrittr')</span></pre><p id="8dc9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，我们将了解如何收集数据。看着 UFCstats.com，我们可以看到战斗机的数据整齐地排列在一个表格里。完美！有 rvest 函数可以直接从网站拉表。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lh"><img src="../Images/87696f774ea0235943594930f6898856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RB__BLv1SvAyunr4SxABdw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">截图自<a class="ae kb" href="http://ufcstats.com/statistics/fighters?char=a" rel="noopener ugc nofollow" target="_blank">http://ufcstats.com/statistics/fighters?char=a</a></figcaption></figure><p id="5f9d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们写一段代码来刮这个表:</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="fb3c" class="lc ig hi ky b fi ld le l lf lg">link &lt;- ‘<a class="ae kb" href="http://ufcstats.com/statistics/fighters?char=a'" rel="noopener ugc nofollow" target="_blank">http://ufcstats.com/statistics/fighters?char=a'</a></span><span id="8fe7" class="lc ig hi ky b fi li le l lf lg">link %&gt;% <br/> read_html() %&gt;% <br/> html_nodes(‘.b-statistics__table’) %&gt;%<br/> html_table(fill = T) %&gt;% <br/> data.frame()</span></pre><p id="b36c" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，我们给 R 一个 http://地址来查找数据，并保存为一个名为<em class="lj"> link </em>的变量。然后是这条代码管道，将它转换成 R 数据帧来查看。我来给你分解一下:</p><p id="a648" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">read_html 做它在 tin 上所说的:它从你提供的链接中读取 html 代码。页面有很多 html 代码，我们只想要包含表格的部分，所以我们使用<strong class="jf hj"> html_nodes </strong>来获取它。我们需要组成表格的元素，在这种情况下被称为<strong class="jf hj">。“b 统计 _ _ 表”。</strong>我是通过使用网站上的 S <a class="ae kb" href="https://selectorgadget.com/" rel="noopener ugc nofollow" target="_blank">选举人小工具</a>并点击表格来解决这个问题的。使用 Selector gadget，您只需点击网页的一部分，它就会告诉您可以使用哪些 css 代码来引用它(网站通常同时涉及 html 和 css 代码)。</p><p id="64b5" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">因为是表格，我们可以用<strong class="jf hj"> html_table </strong>转换成 R 理解的表格。<strong class="jf hj"> fill = T </strong>参数意味着如果一个表的特定单元格中没有数据，就用 NAs 填充它。我们需要这样做，因为我们没有战斗机的完整数据。最后，我们将新表转换成一个<strong class="jf hj"> data.frame() </strong></p><p id="64cb" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">看看网页抓取有多简单！</p><h1 id="b7eb" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">抓取多个页面</h1><p id="9a03" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">再看看网站，似乎每个字母都有一页。因此，一个直观的策略是编写一个循环，一个字母一个字母地遍历字母表，重复上面的代码，并将数据帧一个接一个地堆叠起来，直到我们有一个所有战斗机的巨大数据帧。我们在下面这样做:</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="cdcf" class="lc ig hi ky b fi ld le l lf lg">data_full<strong class="ky hj"> </strong>&lt;- data.frame()</span></pre><p id="24ec" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们创建一个名为<em class="lj"> data_full </em>的空白数据帧来存储所有抓取的数据。然后，我们将上面的代码放在一个遍历字母表的“for 循环”中:</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="7cc4" class="lc ig hi ky b fi ld le l lf lg"><strong class="ky hj">for (letter in letters){ <br/> <br/>    print(letter) <br/> <br/>    link &lt;- paste0(‘</strong><a class="ae kb" href="http://ufcstats.com/statistics/fighters?char=',letter,'&amp;page=all'" rel="noopener ugc nofollow" target="_blank"><strong class="ky hj">http://ufcstats.com/statistics/fighters?char=',letter,'&amp;page=all'</strong></a><strong class="ky hj">) </strong><br/> <br/>    link %&gt;% <br/>     read_html() %&gt;% <br/>     html_nodes(‘.b-statistics__table’) %&gt;%<br/>     html_table(fill = T) %&gt;% <br/>     data.frame <strong class="ky hj">-&gt; <br/>     temp_data <br/> <br/>    temp_data &lt;- temp_data[2:nrow(temp_data), ]<br/>    data_full &lt;- rbind(data_full, temp_data)<br/>    </strong>Sys.sleep(1)</span><span id="445b" class="lc ig hi ky b fi li le l lf lg">}</span></pre><p id="7df9" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我把最后一节没有的代码都加粗了。</p><p id="2f81" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">首先，每次打印出<em class="lj">字母</em>。这只是为了让你能看到循环有多远。</p><p id="54dd" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们改变了定义变量<em class="lj"> link </em>的方式。我们使用 paste0 创建一个链接，它添加了循环所在的字母表中的任何一个字母。所以当循环在字母' c '上时，<em class="lj">链接</em>变成了<a class="ae kb" href="http://ufcstats.com/statistics/fighters?char=',letter,'&amp;page=all'" rel="noopener ugc nofollow" target="_blank">http://ufcstats.com/statistics/fighters?char=<strong class="jf hj">c</strong>T34】page = all '</a>。</p><p id="9e23" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">然后我们有我们的刮代码。我们将数据帧保存为<em class="lj"> temp_data </em>。最后，我们去掉了第一行<em class="lj"> temp_data </em>，因为出于我不明白的原因，它都是 NAs。然后我们使用 rbind 将<em class="lj"> temp_data </em>添加到我们的完整数据帧<em class="lj"> data_full </em>中。</p><p id="43d2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">Sys.sleep(1)表示“在继续之前等待 1 秒钟”。我们这样做是因为我们不想让 R 因为重复调用而给网站带来太大压力。对于网站所有者来说，这是一件好事，但当我们只抓取 26 页时，这并不是真正必要的。对于更大的擦伤，出于礼貌这样做是个好主意。</p><p id="b8d8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">另外需要注意的是:在<em class="lj">链接</em>的末尾我们添加了<a class="ae kb" href="http://ufcstats.com/statistics/fighters?char=',letter,'&amp;page=all'" rel="noopener ugc nofollow" target="_blank"><strong class="jf hj">'&amp;page = all '</strong></a><strong class="jf hj">。</strong>这是因为对于某些信件来说，有多页的战斗机。我们想要的不仅仅是姓氏以 A 开头的拳手第一页！我发现，当我点击“所有”按钮(如下图)时，它显示了所有以给定字母开头的姓氏的战士，并且网页链接变为上面有<strong class="jf hj"> &amp; page=all </strong>。如果这是不可能的，我们必须遍历所有的页面，这可能需要更多的代码。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lk"><img src="../Images/56e4695fad5e7765414b36c3ebd35647.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*okZ8wMOrmM4GwMblz9coBw.png"/></div></div></figure><p id="9800" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">最后，让我们保存我们的<em class="lj"> data_full </em>，这样我们的计算机上就有了原始数据。拥有原始(即未清理的)数据文件是一种良好的做法。一旦我们保存了这些数据，就不能再修改了。任何修改都应保存为新的数据文件。这样我们总是有原始数据。我们把它保存在。csv 格式，因为它是一种易于使用的通用数据格式，可以在 Excel 中打开。</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="47a1" class="lc ig hi ky b fi ld le l lf lg">name = paste0(‘UFC_data_cleaned_’, Sys.Date(),’.csv’) </span><span id="32aa" class="lc ig hi ky b fi li le l lf lg">write.csv(data,name)</span></pre><p id="5e5b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们使用 Sys。Date()来获取今天的日期(无论何时运行代码),并将其插入到文件名中。这是因为你今天收集的数据明天可能会有所不同，因为有些拳手会赢或输！如果你在不同的日子刮几次，这样命名也会使生活更容易。</p><h1 id="2b49" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">这是一个总结！</h1><p id="20d0" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">有多简单？老实说，网络抓取通常比这要困难得多。我们很幸运，UFCstats.com 的人对网站进行了编码，使其易于抓取，并且没有主动试图屏蔽抓取工具(他们有权这样做)。</p><p id="d0e8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">所以现在我们有了拳手的名字、胜败、平局、身高、体重和臂展。在第 2 部分的<a class="ae kb" href="https://thomas-richie-richardson.medium.com/do-mma-fighters-with-longer-arms-win-more-fights-part-2-d08dbf13e5ca" rel="noopener">中，我们清理数据进行分析</a>！</p></div></div>    
</body>
</html>