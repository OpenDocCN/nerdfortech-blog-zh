<html>
<head>
<title>C# — Summary of Pattern Matching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">C# —模式匹配概述</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/c-summary-of-patter-matching-1a1efec983cd?source=collection_archive---------1-----------------------#2022-08-26">https://medium.com/nerd-for-tech/c-summary-of-patter-matching-1a1efec983cd?source=collection_archive---------1-----------------------#2022-08-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8643" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着 C#新版本的出现，我们找到了匹配模式的新方法，这开始让我感到困惑，所以我决定给自己写一个总结。</p><p id="d812" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模式匹配是在 C#7 中引入的。(本文中不包括正则表达式)</p><h1 id="b640" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在 if 中检查对象的类型</h1><p id="f199" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">当我们有一个 if 语句时，我们现在能够根据一个对象是否是我们感兴趣的类型来得到一个 if。参见下面的代码。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="0475" class="kp je hi kl b fi kq kr l ks kt">object i = 12; //object assigned an int<br/>object s = "hello"; //object assigned a string</span><span id="a280" class="kp je hi kl b fi ku kr l ks kt">if (i is int x)//if the object i is int, it will be assigned to x<br/>{<br/>   Console.WriteLine(x);//will happen<br/>}</span><span id="3878" class="kp je hi kl b fi ku kr l ks kt">if (s is int xx)<br/>{<br/>   Console.WriteLine(xx);//will not happen since s is not an int<br/>}</span><span id="3c1a" class="kp je hi kl b fi ku kr l ks kt">if (s is string  xxx)<br/>{<br/>   Console.WriteLine("string " + xxx);//will happen<br/>}</span></pre><h1 id="14ef" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">切换没有文字值的大小写</h1><p id="590a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们不需要在开关的 case 语句中有文字值。看看这段代码:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6a69" class="kp je hi kl b fi kq kr l ks kt">//We have 2 different classes<br/>public class <strong class="kl hj">AClass</strong><br/>{<br/>   public string? s { get; set; }<br/>}<br/>public class <strong class="kl hj">AClassToo</strong><br/>{<br/>   public string? s { get; set; }<br/>}</span><span id="3e14" class="kp je hi kl b fi ku kr l ks kt">//we are going to assign instances of the classes to tupe objects<br/>Object obj = <strong class="kl hj">new AClass</strong>();<br/>((AClass)obj).s = "Hello Class";<br/>Object obj2 = <strong class="kl hj">new AClassToo</strong>();<br/>((AClassToo)obj2).s = "Hello Class Too";</span><span id="95f4" class="kp je hi kl b fi ku kr l ks kt">//now assign one of those class objects to another object that we will use in the switch<br/><strong class="kl hj">Object theObj</strong> = obj;</span><span id="3c6b" class="kp je hi kl b fi ku kr l ks kt">//now in the switch (ac ir whatever name you want)<br/>switch(<strong class="kl hj">theObj</strong>)<br/>{<br/>   <strong class="kl hj">case AClass ac when ac.s</strong> == "Hello":<br/>      Console.WriteLine("class hello");<br/>      break;  <br/>  <strong class="kl hj"> case AClass ac when ac.s == "Hello Class":</strong><br/>      Console.WriteLine("class hello class");<br/>      break;<br/>   case AClassToo ac2 when ac2.s == "Hello":<br/>      Console.WriteLine("class 2 hello");<br/>      break;<br/>   <strong class="kl hj">case AClassToo ac2 when ac2.s == "Hello Class Too":</strong><br/>      Console.WriteLine("class hello Too");<br/>      break;<br/>   default:<br/>      break;<br/>}</span><span id="fcba" class="kp je hi kl b fi ku kr l ks kt">//Will print class hello class because theObj is a AClass with s as "Hello Class"</span><span id="2f17" class="kp je hi kl b fi ku kr l ks kt">//if we use the same code but have the assigment <br/>//Object theObj = obj2; instead (AClassToo type).</span><span id="9e3d" class="kp je hi kl b fi ku kr l ks kt">//it will print class hello too.</span></pre><h1 id="2c5c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">带有开关表达式的开关语句</h1><p id="f44a" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">从 C# 8 开始。</p><p id="3054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">开关表达式使用= &gt;来指示返回值。这使得代码更短。</p><p id="756f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与前面的开关类似，但不相同，因为这种类型的开关针对每种情况返回一个值:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="759b" class="kp je hi kl b fi kq kr l ks kt">//assign the switch to a variable<br/>string message = theObj switch<br/>{<br/>   AClass <strong class="kl hj">=&gt;</strong> "class hello", //if AClass return this string<br/>   AClassToo =&gt; "Hello Class Too",<br/>   <strong class="kl hj">null =&gt;</strong> "null",<br/>   <strong class="kl hj">_ =&gt;</strong> "some other thing", //any other cases, return this</span><span id="47e1" class="kp je hi kl b fi ku kr l ks kt">};<br/>Console.WriteLine(message);</span></pre><p id="47c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有案件或突破；这里的关键词。</p><p id="b7b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使它与原始版本更相似:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="6be6" class="kp je hi kl b fi kq kr l ks kt">string message = theObj switch<br/>{<br/>   AClass <strong class="kl hj">ac when ac.s</strong> == "Hello" <strong class="kl hj">=&gt;</strong> "class hello",<br/>   AClass ac when ac.s == "Hello Class"<strong class="kl hj"> =&gt;</strong> "class hello class",<br/>   AClassToo <strong class="kl hj">act when act.s</strong> == "Hello"<strong class="kl hj">=&gt;</strong> "classToo hello",<br/>   AClassToo act when act.s == "Hello Class Too" <strong class="kl hj">=&gt;</strong> "classToo hello too",<br/>   null =&gt; "null",<br/>   _ =&gt; "some other thing",<br/>};<br/>Console.WriteLine(message);</span></pre><p id="2bc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您只想匹配类，而不检查任何属性，我们可以这样做:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e1ca" class="kp je hi kl b fi kq kr l ks kt">string message = theObj switch<br/>{<br/>   AClass <strong class="kl hj">_</strong> =&gt; "class hello",<br/>   AClassToo<strong class="kl hj"> _</strong> =&gt; "classToo hello",<br/>   null =&gt; "null",<br/>   _ =&gt; "some other thing",<br/>};<br/>Console.WriteLine(message);</span></pre><h1 id="b24a" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Switch 语句 C#9</h1><p id="47ba" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">C#9 通过嵌套语句和对&gt;比较的支持，使得 switch 语句更加有趣。</p><p id="37a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们之前的例子，检查 s 的值，会是类似这样的嵌套表达式。</p><p id="db0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，在检查 s 值时，我们没有==</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5a88" class="kp je hi kl b fi kq kr l ks kt"><strong class="kl hj">string message = theObj switch</strong><br/>{<br/>   <strong class="kl hj">AClass ac  =&gt; ac.s switch //if this class, switch for s checking</strong><br/>   {<br/>      <strong class="kl hj">"Hello"</strong> <strong class="kl hj">=&gt; "class hello",</strong><br/>      "Hello Class" =&gt; "class hello class",<br/>      _ =&gt; "some other thing AClass",<br/>   },<br/>   <strong class="kl hj">AClassToo act =&gt; act.s switch</strong><br/>   {<br/>      "Hello" =&gt; "classToo hello",<br/>      "Hello Class Too" =&gt; "classToo hello too",<br/>      _ =&gt; "some other thing AClassToo",<br/>   },<br/>   null =&gt; "null",<br/>   _ =&gt; "some other thing",<br/>};</span></pre><p id="4445" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们要比较数量，我们可以使用类似于:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="4f27" class="kp je hi kl b fi kq kr l ks kt">Object obj3 = new AClass3();<br/>((AClass3)obj3).i = 15;</span><span id="a635" class="kp je hi kl b fi ku kr l ks kt">string message = theObj switch<br/>{<br/>   AClass3 ac3  =&gt; ac3.i switch<br/>   {<br/>      <strong class="kl hj">&gt; 5  =&gt; "&gt; 5",<br/>      </strong>_ =&gt; " &lt;= 5",<br/>   },<br/>   null =&gt; "null",<br/>   _ =&gt; "some other thing",<br/>};<br/>Console.WriteLine(message);</span></pre><h1 id="8864" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">用解构匹配类内容</h1><p id="14e9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">假设我们有一个类，它有这样一些数据:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9cf9" class="kp je hi kl b fi kq kr l ks kt">public class AClass4<br/>{<br/>   public int? I { get; set; }<br/>   public string? S { get; set; }<br/>   public AClass? ACLASS { get; set; }</span><span id="ffad" class="kp je hi kl b fi ku kr l ks kt">   public void Deconstruct(out int? i, out string? s)<br/>   {<br/>      i = I;<br/>      s = S;      <br/>   }<br/>}</span></pre><p id="0d36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以有这样一个开关:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="5f53" class="kp je hi kl b fi kq kr l ks kt">var result = four switch<br/>{<br/>   AClass4(30, "how are you?") =&gt; "how are you 30",<br/>   AClass4(25, "hey" ) =&gt; "hey 25",<br/>   _ =&gt; "who?"<br/>};<br/>Console.WriteLine(result);</span></pre><p id="a76e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以有上面的开关，因为我们在类中有解构方法。我们使用该方法与我们在交换机中使用的类的“four”实例进行比较。</p><p id="5923" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们有这样的类:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b96d" class="kp je hi kl b fi kq kr l ks kt">AClass4 four = new AClass4();<br/>four.I = 30;<br/>four.S = "how are you?";<br/>four.ACLASS = new AClass();<br/>four.ACLASS.s = "I am here";</span></pre><p id="4841" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会得到“你好吗 30”。如果任何值与传递的值不同，我们将得到“谁？”或者"嘿 25 "如果匹配。注意，我们没有检查 4 的类，因为它不是解构方法的一部分。我们可以包括它。</p><p id="ff6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与上面的实例相同，但解构如下:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e65c" class="kp je hi kl b fi kq kr l ks kt">public void Deconstruct(out int? i, out string? s , out AClass? f)<br/>{<br/>   i = I;<br/>   s = S;<br/>   f= ACLASS;<br/>}</span></pre><p id="9e10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当类为空或不为空时，我们可以使用选项进行开关检查:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b6f1" class="kp je hi kl b fi kq kr l ks kt">var result = four switch<br/>{<br/>   //if the AClass in the AClass4 is null<br/>   AClass4(30, "how are you?", <strong class="kl hj">null </strong>) =&gt; "how are you 30",<br/>   //if the AClass in the AClass4 is set <br/>    AClass4(30, "how are you?", <strong class="kl hj">_</strong>  ) =&gt; "hey 30",<br/>   _ =&gt; "who?"<br/>};<br/>Console.WriteLine(result);<br/>//the above prints hey 30</span></pre><p id="2152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们还想检查内部类的一些属性，我们也可以像这样:</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="b938" class="kp je hi kl b fi kq kr l ks kt">public void Deconstruct(out int? i, out string? s , <strong class="kl hj">out string? fs</strong>)<br/>{<br/>   i = I;<br/>   s = S;<br/>  <strong class="kl hj"> fs= ACLASS.s;</strong><br/>}</span><span id="3b12" class="kp je hi kl b fi ku kr l ks kt">var result = four switch<br/>{<br/>   AClass4(30, "how are you?", null ) =&gt; "how are you 30",<br/>   <strong class="kl hj">AClass4(30, "how are you?", "I am here") =&gt; "hey 30 with class I am here",</strong><br/>   AClass4(30, "how are you?", _  ) =&gt; "hey 30",<br/>   _ =&gt; "who?"<br/>};<br/>Console.WriteLine(result);</span></pre><p id="68d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解构方法通常像这样使用(对于我们一直在使用的同一个类)</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9f6c" class="kp je hi kl b fi kq kr l ks kt">var (ii, ss, cc) = four; //use the var to get the parts from the class<br/>Console.WriteLine(ii);//ii will be the I from "four"<br/>Console.WriteLine(ss); // S<br/>Console.WriteLine(cc); //ACLASS.s</span></pre><h1 id="92d8" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">一些额外的开关可能性</h1><p id="7547" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们也可以这样做来检查我们正在检查的类中的某个部分；</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="33b3" class="kp je hi kl b fi kq kr l ks kt">var result = four switch<br/>{<br/>   <strong class="kl hj">{ ACLASS: { s:"I am here" } } </strong> =&gt;  "I am here",<br/>   _ =&gt; "who?"<br/>};</span></pre><p id="3147" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向内部类添加另一个字符串。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="f987" class="kp je hi kl b fi kq kr l ks kt">AClass4 four = new AClass4();<br/>four.I = 30;<br/>four.S = "how are you?";<br/>four.ACLASS = new AClass();<br/>four.ACLASS.s = "I am here";<br/><strong class="kl hj">four.ACLASS.s2 = "not me";</strong></span><span id="3c23" class="kp je hi kl b fi ku kr l ks kt">//this switch now will display who?<br/>var result = four switch<br/>{<br/>   <strong class="kl hj">{ ACLASS: { s:"I am here", s2:"me too" } }  </strong>=&gt;  "I am here",<br/>   _ =&gt; "who?"<br/>};</span><span id="7328" class="kp je hi kl b fi ku kr l ks kt">//changing the class to have four.ACLASS.s2 = "me too" will display "I am here"</span></pre><p id="1a42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们不仅要检查内部类的属性，还要检查主类的属性(四个):</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="8519" class="kp je hi kl b fi kq kr l ks kt">var result = four switch<br/>{<br/><strong class="kl hj">   {S:"how are you?" ,ACLASS: { s:"I am here", s2:"me too" } }    =&gt;  "I am here",<br/></strong>   _ =&gt; "who?"<br/>};</span></pre><p id="878e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查该类是否为<code class="du kv kw kx kl b">{ACLASS: null}</code></p><p id="a82f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也可以使用元组。这个例子来自微软的文档(不是全部):</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="e93b" class="kp je hi kl b fi kq kr l ks kt">var newState = <strong class="kl hj">(state, operation, key.IsValid) switch</strong><br/>{<br/>   (State.Opened, Operation.Close, _)      =&gt; State.Closed,<br/>   (State.Opened, Operation.Lock, true)    =&gt; State.Locked,<br/>   (State.Locked, Operation.Open, true)    =&gt; State.Opened,<br/>   ...                        <br/>   _ =&gt; state<br/>};</span></pre><p id="43ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我目前就知道这么多。</p></div></div>    
</body>
</html>