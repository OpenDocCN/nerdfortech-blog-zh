<html>
<head>
<title>Flutter: A chat app in flutter using a Socket.IO service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">flutter:flutter中使用套接字的聊天应用。IO服务</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/flutter-a-chat-app-in-flutter-using-a-socket-io-service-88be02a388d6?source=collection_archive---------0-----------------------#2021-07-06">https://medium.com/nerd-for-tech/flutter-a-chat-app-in-flutter-using-a-socket-io-service-88be02a388d6?source=collection_archive---------0-----------------------#2021-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dc3e38c1a674fe9a337eac30c6cdfa68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uy8CzOvOyRdUKCygisECeA.png"/></div></div></figure><p id="ee33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Flutter很快就成为了移动应用开发框架的首选。毫无疑问，它非常简洁、富于表现力、灵活且快速。在flutter中，有很多预构建的包可以用来创建几乎任何类型的布局。在本教程中，我将帮助您在flutter中创建一个与套接字通信的聊天应用程序。用NodeJs写的IO聊天服务。</p><h1 id="ad1c" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">先决条件</strong></h1><ol class=""><li id="7eb3" class="km kn hi is b it ko ix kp jb kq jf kr jj ks jn kt ku kv kw bi translated">下载并安装OpenJDK 1.8。不幸的是，<strong class="is hj"> JDK 1.8 </strong>预计将为flutter构建Android应用。</li><li id="650d" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">下载并安装<a class="ae lc" href="https://flutter.dev/docs/get-started/install" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">颤振</strong> </a>。此步骤还将指导您下载和/或配置:<br/><strong class="is hj"><em class="ld">a)</em></strong><em class="ld"/><strong class="is hj"><em class="ld">Dart</em></strong>:Dart与旋舞捆绑在一起，不需要显式安装。<br/><strong class="is hj"><em class="ld">b)</em></strong><em class="ld"/><strong class="is hj"><em class="ld">安卓工作室</em></strong><br/><strong class="is hj"><em class="ld">c)</em></strong><em class="ld"/><strong class="is hj"><em class="ld">安卓模拟器</em> </strong></li><li id="75b4" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">通过在命令窗口中运行“flutter doctor”来确保为Android成功配置了flutter。</li></ol><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="9b11" class="ln jp hi lj b fi lo lp l lq lr"><strong class="lj hj">$ flutter doctor</strong></span></pre><h1 id="ea69" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤1:创建新的颤振应用</h1><p id="31cb" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">启动Android Studio并创建一个新的flutter应用程序(步骤<a class="ae lc" href="https://flutter.dev/docs/get-started/test-drive?tab=androidstudio" rel="noopener ugc nofollow" target="_blank">此处</a>)。我已经创建了一个应用程序“<em class="ld">聊天应用程序</em>”。这个步骤可以在VS代码中完成，也可以在flutter扩展的帮助下完成。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lv"><img src="../Images/2388e47325c93db262768f81e48a6ce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gtZJ3p1libB3ueuHNxUAQ.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">新的颤振应用程序</figcaption></figure><h1 id="fbab" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第二步:创建一个聊天窗口。</h1><p id="eee5" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我的应用程序的<a class="ae lc" href="https://github.com/codecaplet/FlutterTutorials/blob/master/chat_app/lib/main.dart" rel="noopener ugc nofollow" target="_blank">主页</a>在将用户带到聊天页面之前接受一个用户名。这是为了模拟真实世界的场景，其中用户与用户名相关联。这个用户名被转发到聊天小部件。<br/>为了创建聊天小部件，我使用了一个<a class="ae lc" href="https://pub.dev/packages/flutter_chat_bubble" rel="noopener ugc nofollow" target="_blank"> flutter_chat_bubble </a>包来创建消息气泡。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/830d4251ce29b4b1e365fc068731cad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*if1eAAAh2LcK74T0O6sMDw.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">添加flutter_chat_bubble依赖</figcaption></figure><p id="d9ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我创建了一个StatefulWidget <a class="ae lc" href="https://github.com/codecaplet/FlutterTutorials/blob/master/chat_app/lib/chat.dart" rel="noopener ugc nofollow" target="_blank">聊天</a>。它维护一个状态变量“messages ”,该变量列出了聊天中的所有消息。我使用ListView显示了泡泡中的信息。如果当前用户是左边的发送者，则气泡出现在右边。<br/>注意:‘<strong class="is hj">widget . user</strong>’持有用户的用户名。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/6cb6b5e41d1f66d16b1a56fcb181bbc4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a7jFO2k6lJJQxxWPJH59BA.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">聊天窗口代码</figcaption></figure><p id="bf9c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们验证一下这个应用程序到目前为止是否有效。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/db30797d02656bdb817968f2d74f7852.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rb47qp2rXNFkdpzOSb6jVA.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">聊天流程</figcaption></figure><h1 id="526a" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤3:设置一个套接字。IO聊天服务</h1><p id="c29b" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我在本地经营这个聊天服务。我还使用了<a class="ae lc" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> ngrok </strong> </a>从一个公共URL到这个服务。这项服务:</p><ol class=""><li id="c6e2" class="km kn hi is b it iu ix iy jb md jf me jj mf jn kt ku kv kw bi translated">打开web套接字连接@<a class="ae lc" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/</a></li><li id="472a" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">收听新消息@ channel ' <em class="ld"> chat </em>'。</li><li id="e2a3" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">向频道'<em class="ld"> newChat </em>'广播新消息。</li><li id="a0d0" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">在新连接上向频道'<em class="ld"> allChats </em>'广播所有旧消息。</li></ol><h1 id="0caa" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤#4:配置套接字。IO客户端</h1><p id="f387" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我正在使用<a class="ae lc" href="https://pub.dev/packages/socket_io_client" rel="noopener ugc nofollow" target="_blank"> socket_io_client </a>包来连接套接字。IO服务。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/9a6be3af31672d8386ad934ce47722bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NjwNLQNPF1wjtaWBOkprEA.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">套接字_ io _客户端</figcaption></figure><p id="8eca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将初始化套接字。widget <em class="ld"> initState </em>上的IO连接和widget <em class="ld"> dispose </em>上的断开连接。<br/>注意:</p><ol class=""><li id="1af1" class="km kn hi is b it iu ix iy jb md jf me jj mf jn kt ku kv kw bi translated">它连接到ngrok公共url，后者通过隧道连接到我的本地服务。</li><li id="702f" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">它监听'<em class="ld"> newChat </em>'频道的新消息，并在到达时添加到'<em class="ld"> messages </em>'状态变量中。</li><li id="887d" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">它监听所有旧消息的'<em class="ld"> allChats </em>'信道，并在到达时将它们添加到'<em class="ld">消息</em>'状态变量中。</li></ol><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/31eb42cf622d45112e4f7c890d40e4ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ev6i8xBfBssIJX4W5MGamg.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">连接/断开socket.io</figcaption></figure><p id="c62e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们为发送消息按钮引入一个<em class="ld"> onPressed </em>处理程序'<em class="ld"> _sendMessage </em>'。在这个方法中，我们将用户的任何新消息发送到'<em class="ld">聊天</em>'通道。任何聊天消息都被期望(由聊天服务)具有4个属性:<em class="ld">消息、发送者、接收者&amp;时间</em>。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/1ad556ff1e655890d1782859dec4d0fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OvfLzvzcPbyJ2sGGwO-dAg.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">发送消息</figcaption></figure><h1 id="ad1f" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">步骤#5:运行并验证</h1><p id="5efb" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb ls jd je jf lt jh ji jj lu jl jm jn hb bi translated">我在android模拟器中运行这个应用程序。我还使用<a class="ae lc" href="https://amritb.github.io/socketio-client-tool/v1/#" rel="noopener ugc nofollow" target="_blank"> socket.io客户端工具</a>连接到聊天服务，以模拟消息传递。</p><figure class="le lf lg lh fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/2fe161bafff0bc5589e91c8d9750a084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jV-sP_vx7JRpCn1V2zxXvA.png"/></div></div><figcaption class="lw lx et er es ly lz bd b be z dx translated">运行并验证</figcaption></figure></div><div class="ab cl mk ml gp mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hb hc hd he hf"><blockquote class="mr ms mt"><p id="c944" class="iq ir ld is b it iu iv iw ix iy iz ja mu jc jd je mv jg jh ji mw jk jl jm jn hb bi translated">代码库:<br/><a class="ae lc" href="https://github.com/sharmavikashkr/chat_app_flutter" rel="noopener ugc nofollow" target="_blank">https://github.com/sharmavikashkr/chat_app_flutter</a><br/>【https://github.com/sharmavikashkr/chat-service-nestjs】T4</p></blockquote></div></div>    
</body>
</html>