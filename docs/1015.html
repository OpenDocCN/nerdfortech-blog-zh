<html>
<head>
<title>TrueNAS Bespoke Alerts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TrueNAS定制警报</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/truenas-bespoke-alerts-e8f91e3de5c1?source=collection_archive---------12-----------------------#2021-03-01">https://medium.com/nerd-for-tech/truenas-bespoke-alerts-e8f91e3de5c1?source=collection_archive---------12-----------------------#2021-03-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="213f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">TrueNAS有几个内置的警报机制，但是我希望能够通过PushOver将NAS警报推送到我的手机上。为了适应这种情况，我需要滥用一种现有的警报方法来向我的自定义脚本发送警报。</p><p id="a1d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在现有的警报机制中，SNMP陷阱方法似乎是最容易屈服于我的意志的。我创建了一个名为“Monitoring”的监狱(使用Basejail)，它将包含我所有的各种监控和实用程序脚本。确保您将此监狱配置为自动启动。在这个监狱里，我安装了python、pip和python库pysnmp:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="213d" class="jm jn hi ji b fi jo jp l jq jr"># pkg update<br/># pkg install python3 py37-pip<br/># pip install pysnmp requests</span></pre><p id="9d38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于起始脚本，我使用了这个很好的例子:<a class="ae js" href="https://bytesofgigabytes.com/snmp-protocol/python-snmp-trap-receiver/" rel="noopener ugc nofollow" target="_blank">https://bytesofgigabytes . com/SNMP-protocol/python-SNMP-trap-receiver/</a></p><p id="8ec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过修改上面的脚本，我很快就能够将SNMP陷阱消息发布到我想要的任何服务。您可以通过本文档(通知部分)了解MIB的含义:【https://mibs.observium.org/mib/FREENAS-MIB/<a class="ae js" href="https://mibs.observium.org/mib/FREENAS-MIB/" rel="noopener ugc nofollow" target="_blank"/></p><p id="5769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为我使用了PushOver，所以我的脚本最终看起来是这样的:</p><figure class="jd je jf jg fd jt"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="51c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用“NAT”网络配置了监狱，并记下了NAT IP。</p><p id="caa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Monitoring jail中，我创建了一个名为/etc/rc.d/snmpmonitor的新文件，它将启动上面的监控脚本(适当地更新路径):</p><figure class="jd je jf jg fd jt"><div class="bz dy l di"><div class="ju jv l"/></div></figure><p id="afab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在将下面一行添加到/etc/rc中:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="da7e" class="jm jn hi ji b fi jo jp l jq jr">snmpmonitor_enable=YES</span></pre><p id="0cd1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后一步是转到TrueNAS应用程序-&gt;系统-&gt;警报服务，然后单击“SNMP陷阱”上的“编辑”。</p><p id="31e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在确保选中“Enabled ”,并且“Hostname”指向您的监控监狱的网络地址。还要更新“端口”以确保准确:</p><figure class="jd je jf jg fd jt er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jw"><img src="../Images/ffb423fc8258adc92468a44aedefb2ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6GCUC--A8erWdszXVCwHA.png"/></div></div></figure><p id="e4c0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在点击“保存”。现在，您应该可以通过自定义脚本获得警报。我建议使用“发送测试警报”来确保一切配置正确。</p></div></div>    
</body>
</html>