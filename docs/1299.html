<html>
<head>
<title>Continuous Deployment: CI/CD for iOS on Azure DevOps (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">持续部署:Azure DevOps 上 iOS 的 CI/CD(第 2 部分)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/continuous-deployment-ci-cd-for-ios-on-azure-devops-part-2-a95983db0475?source=collection_archive---------3-----------------------#2021-03-13">https://medium.com/nerd-for-tech/continuous-deployment-ci-cd-for-ios-on-azure-devops-part-2-a95983db0475?source=collection_archive---------3-----------------------#2021-03-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5de5632e53cf353c9abd25d468432c5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QUx67M3pofzrZ8Ga"/></div></div></figure><p id="4008" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在最后一部分中，我们使用<a class="ae jo" href="https://dev.azure.com/" rel="noopener ugc nofollow" target="_blank"> Azure DevOps </a>的管道特性创建了一个版本。在本教程中，我们将使用 Azure 的发布管道将版本推送到应用商店。这是 CI/CD 的持续部署部分。</p><p id="496c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在 DevOps 上打开您的项目，并在左侧面板的“Pipelines”部分中选择“Releases”。选择“新管道”,这将打开一个用于选择模板的对话框。</p><h1 id="f056" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">模板选择和设置</h1><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/62a9c68ecd5ae001de5df61c2fe88b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*USZ_0XYqn5Pd_3gj"/></div></div></figure><p id="285f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将选择一个空作业，因为没有用于将构建上传到 App Store 的预定义模板。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/dc5f7b8b4463acc68b7eacc5cceaed62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9pvHQlGHAoQ1zFhW"/></div></div></figure><p id="bb76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">输入阶段名称“部署”。它可以是您想要的任何东西，但是为了清楚起见，我将其设置为部署。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3409bfb049de7fcdae5eaedd251e0a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jE9BTc00N_jXJ_wO"/></div></div></figure><p id="b7ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将选择一个我们想要上传的工件。工件是在 Azure 构建管道运行时创建的东西。所以在我们的例子中，工件是从我们之前的教程中生成的。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4d7ecd953872964cab035df43640b1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hzvm3bTu-2KvM42k"/></div></div></figure><p id="5d55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击<em class="ks">工件</em>标签旁边的<em class="ks">添加</em>按钮，或者点击<em class="ks">添加工件</em>。这将在右边打开一个新的对话框。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fb732596182a9f7e7333f05fa0919ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HEBcRS2Z9sw2bPWU"/></div></div></figure><p id="f540" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在下拉列表中，您将看到我们在上一个教程中的 CI 设置。选择并点击<em class="ks">添加</em>按钮。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5ff71758003fe42d876171b3de1a68e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HA_bMlmOe5zrfprT"/></div></div></figure><p id="bebb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加工件后，我们的发布管道将看起来像下面这样。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fe60c02ce1f47e987484eaf0ac52ec17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uQ4XiRMORBGxy5Ef"/></div></div></figure><p id="9321" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在为我们刚刚添加的工件选择<em class="ks">闪电</em>图标。这将在右侧打开一个对话框，其中包含启用/禁用持续部署触发器的设置。当构建触发器启用时，当我们的构建(CI)管道完成一个新的构建时，我们的发布管道将自动启动。我们不会启用拉取请求触发器。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2db2af43d16aae1d383f7d61597949be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*b37PiIpVBJZDKL7b"/></div></div></figure><p id="2ee2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">到目前为止，我们已经将管道设置为在我们的构建管道中有新的构建可用时自动启动。我们还设置了一个<em class="ks">部署</em>阶段，我们将在下一节中为实际部署添加任务。</p><h1 id="bb75" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">部署任务</h1><p id="9488" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">选择<em class="ks"> 1 作业 0 任务</em>超链接，将切换到任务选项卡。选择<em class="ks">代理作业</em>旁边的+号，打开新任务列表。搜索<em class="ks">苹果应用商店</em>。如果你没有看到任何任务，你将不得不从市场安装应用程序。一旦安装完毕，当你再次搜索<em class="ks">苹果应用商店</em>时，你会看到如下几个新任务。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ba805fb5fc039905c52a0183fc9894e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Vx38z4lw1hRc-Z3Q"/></div></div></figure><p id="287a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">添加<em class="ks">苹果应用商店发布</em>任务。它将添加需要<em class="ks">服务连接</em>的任务。服务连接基本上是与苹果 itunesconnect 网站的连接。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/278b49841bc3906fc17f1e949d79bbaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GQuHCWCn1F3CTpNC"/></div></div></figure><p id="b196" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在将添加一个新的服务连接。点击服务连接旁边的<em class="ks">新建</em>按钮，这将打开一个新的对话框。在新建对话框中输入电子邮件的&amp;密码。尽管<em class="ks">特定于应用的密码</em>和<em class="ks">浪子会话</em>被标记为可选，但它们对于将构建上传到应用商店的自动化过程是必需的。</p><h1 id="c26c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">特定于应用程序的密码</h1><p id="8f36" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">要创建特定于<em class="ks">应用的密码</em>，请在新标签中访问<a class="ae jo" href="https://appleid.apple.com/account/manage" rel="noopener ugc nofollow" target="_blank">appleid.apple.com/account/manage</a>并向下滚动至安全部分。点击标签<em class="ks">特定于应用程序的密码</em>下方的<em class="ks">生成密码……</em>链接，这将打开一个对话框。输入标签的任意名称并点击<em class="ks">创建</em>。复制生成的文本并切换回我们的 Azure DevOps 选项卡，然后将其粘贴到特定于应用程序的密码字段下。</p><h1 id="ec1f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">浪子会话令牌</h1><p id="470e" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">作为先决条件，您的机器上应该已经安装了 fastlane。浪子需要生成会话令牌，这样我们的云机器就可以在没有我们干预的情况下自动登录。是时候打开终端并发出一些命令了。</p><p id="493d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ky kz la lb b">fastlane spaceauth -u xxxxxxx@gmail.com</code></p><p id="c546" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为双因素身份验证的一部分，您将被要求输入密码，然后输入一个 6 位数的代码。它将为您生成会话令牌，并询问您是否要复制它。按“y ”,然后切换到您的 Azure DevOps 选项卡，并将会话令牌粘贴到<em class="ks">浪子会话</em>字段中。</p><p id="eb15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据您的偏好输入服务连接名称，并根据需要输入描述。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1b3ac20c401f19e8eb234f7368d2f0a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IsxDONmR4R3Ull3u"/></div></div></figure><h1 id="daca" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">发布详细信息</h1><p id="f53a" class="pw-post-body-paragraph iq ir hi is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">您将看到服务连接现在已经设置好了。接下来输入您的应用程序的捆绑 id。选择<em class="ks">跳过构建处理等待</em>和<em class="ks">跳过提交</em>以便我们的管道不等待构建可用，否则它将消耗宝贵的构建时间。最后输入<em class="ks"> App 专用 Apple Id </em>，登录<a class="ae jo" href="https://appstoreconnect.apple.com/" rel="noopener ugc nofollow" target="_blank">https://appstoreconnect.apple.com</a>点击你的 App 查看详情，最后访问<em class="ks">通用</em>部分下的<em class="ks"> App 信息</em>即可获得。</p><figure class="ko kp kq kr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/db059cca295a816e235730ae5b756385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OTUww85hx6q7oUJx"/></div></div></figure><p id="31ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就这样了，伙计们。当您运行您的管道并看到随着任务的完成，绿色的勾号一个接一个地出现时，您的辛勤工作将最终得到回报。这将是世界上最美好的感觉之一。</p><p id="4949" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你有任何建议，优化和/或只是想连接让我知道在下面的评论。</p></div></div>    
</body>
</html>