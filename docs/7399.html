<html>
<head>
<title>How to set up Prisma with a local Docker Postgres container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用本地 Docker Postgres 容器设置 Prisma</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-set-up-prisma-with-a-local-docker-postgres-container-9e0958d08544?source=collection_archive---------1-----------------------#2022-10-20">https://medium.com/nerd-for-tech/how-to-set-up-prisma-with-a-local-docker-postgres-container-9e0958d08544?source=collection_archive---------1-----------------------#2022-10-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f2af" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">这是一个关于如何将 Docker Postgres 容器连接到 Prisma 模式设置的简单指南。这不是棱镜教程。</h2></div><h1 id="cb71" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">步骤 1:创建 Docker Postgres 实例</h1><p id="f18d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">这里你可以创建一个<code class="du kl km kn ko b">compose.yml</code>文件或者直接运行<code class="du kl km kn ko b">docker run</code>命令。</p><h2 id="04b4" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated">码头运行</h2><p id="acbe" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du kl km kn ko b">docker run -d -e POSTGRES_DB=mydb -e POSTGRES_PASSWORD=testpass123 -e POSTGRES_USER=postgres -p “6500:5432” postgres</code></p><p id="ef0a" class="pw-post-body-paragraph jp jq hi jr b js ld ij ju jv le im jx jy lf ka kb kc lg ke kf kg lh ki kj kk hb bi translated">这将启动一个分离的<code class="du kl km kn ko b">postgres:latest</code>容器，其中包含:</p><ul class=""><li id="e545" class="li lj hi jr b js ld jv le jy lk kc ll kg lm kk ln lo lp lq bi translated"><code class="du kl km kn ko b">POSTGRES_DB=mydb</code></li><li id="1bf8" class="li lj hi jr b js lr jv ls jy lt kc lu kg lv kk ln lo lp lq bi translated"><code class="du kl km kn ko b">POSTGRES_PASSWORD=testpass123</code></li><li id="aea1" class="li lj hi jr b js lr jv ls jy lt kc lu kg lv kk ln lo lp lq bi translated"><code class="du kl km kn ko b">POSTGRES_USER=postgres</code></li><li id="b238" class="li lj hi jr b js lr jv ls jy lt kc lu kg lv kk ln lo lp lq bi translated">端口范围:<code class="du kl km kn ko b">6500:5432</code></li></ul><p id="3be1" class="pw-post-body-paragraph jp jq hi jr b js ld ij ju jv le im jx jy lf ka kb kc lg ke kf kg lh ki kj kk hb bi translated">请注意端口范围与通常的 5432:5432 有什么不同。这是因为本地主机上的端口有时已经被其他服务占用了。通过手动将其设置为一些较少使用的值，您<strong class="jr hj">减少了冲突的风险</strong>。</p><h1 id="90d9" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">第二步:现在我们来看看棱镜<code class="du kl km kn ko b">DATABASE_URL</code></h1><h2 id="7126" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated">结构</h2><p id="05bc" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du kl km kn ko b">DATABASE_URL=”postgresql://{<strong class="jr hj">POSTGRES_USER</strong>}:{<strong class="jr hj">POSTGRES_PASSWORD</strong>}@localhost:{<strong class="jr hj">PORT</strong>}/{<strong class="jr hj">POSTGRES_DB</strong>}?schema=public”</code></p><h2 id="b160" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated">实际的</h2><p id="e575" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du kl km kn ko b">DATABASE_URL=”postgresql://<strong class="jr hj">postgres</strong>:<strong class="jr hj">testpass123</strong>@localhost:<strong class="jr hj">6500</strong>/mydb?schema=public”</code></p><h2 id="811d" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated">Docker 撰写示例</h2><p id="42eb" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">或者，下面是如何编写一个<code class="du kl km kn ko b">compose.yml</code>文件。(<code class="du kl km kn ko b">docker-compose.yml</code>是否计划弃用<a class="ae lw" href="https://docs.docker.com/compose/compose-file/#compose-file" rel="noopener ugc nofollow" target="_blank"/>)</p><pre class="lx ly lz ma fd mb ko mc bn md me bi"><span id="a800" class="mf iy hi ko b be mg mh l mi mj">services:<br/>  postgres:<br/>    container_name: postgres<br/>    image: postgres<br/>    environment:<br/>      - POSTGRES_USER=postgres<br/>      - POSTGRES_PASSWORD=postgres<br/>      - POSTGRES_DB=mydb<br/>    ports:<br/>      - 6500:5432<br/>    volumes:<br/>      - postgres_data:/var/lib/postgresql/data/<br/><br/>volumes:<br/>  postgres_data:</span></pre><p id="ed65" class="pw-post-body-paragraph jp jq hi jr b js ld ij ju jv le im jx jy lf ka kb kc lg ke kf kg lh ki kj kk hb bi translated">我添加了一个<code class="du kl km kn ko b">postgres_data</code>卷来保存数据。最初我纯粹是出于开发和测试的目的使用它，所以我觉得没有必要。</p><p id="b5c2" class="pw-post-body-paragraph jp jq hi jr b js ld ij ju jv le im jx jy lf ka kb kc lg ke kf kg lh ki kj kk hb bi translated">如果您需要在使用带有<code class="du kl km kn ko b">docker run</code>指令的独立容器时复制这种行为，只需使用以下语法添加<code class="du kl km kn ko b">-v</code>标志:</p><pre class="lx ly lz ma fd mb ko mc bn md me bi"><span id="276b" class="mf iy hi ko b be mg mh l mi mj">-v /your/volume/path:/var/run/postgresql</span></pre><p id="00bb" class="pw-post-body-paragraph jp jq hi jr b js ld ij ju jv le im jx jy lf ka kb kc lg ke kf kg lh ki kj kk hb bi translated">当您声明本地卷的路径时，请确保它存在，否则将会引发错误。</p><h1 id="0000" class="ix iy hi bd iz ja jb jc jd je jf jg jh io ji ip jj ir jk is jl iu jm iv jn jo bi translated">步骤 3:检查 Prisma 是否成功连接到您的 Postgres 实例</h1><h2 id="5fa4" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated"><strong class="ak">运行</strong></h2><p id="b425" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><code class="du kl km kn ko b">npx prisma db pull</code></p><h2 id="09fb" class="kp iy hi bd iz kq kr ks jd kt ku kv jh jy kw kx jj kc ky kz jl kg la lb jn lc bi translated">期望成果</h2><figure class="lx ly lz ma fd ml er es paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="er es mk"><img src="../Images/2ea3cc493cb321914e57c3fddd52a085.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cv7eewEV8J9rIuAPl2ym0Q.png"/></div></div></figure></div></div>    
</body>
</html>