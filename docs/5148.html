<html>
<head>
<title>Breaking Application’s Logic to DOS Attack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">破解应用程序逻辑应对 DOS 攻击</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/breaking-applications-logic-to-dos-attack-88326cd0dd82?source=collection_archive---------2-----------------------#2021-09-02">https://medium.com/nerd-for-tech/breaking-applications-logic-to-dos-attack-88326cd0dd82?source=collection_archive---------2-----------------------#2021-09-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="86b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘿伙计们，<br/>最近我发现了一个足以配得上这篇文章的 bug。所以，我想把它写在这里。因为保密协议，我不能透露公司的名字(NDA)。所以我将使用 redacted.com 的<strong class="ih hj"><em class="jd"/></strong>作为进一步的参考。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="bfe0" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="c95d" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">我在 POST 请求中发现一个参数，容易受到<strong class="ih hj"> <em class="jd"> IDOR </em> </strong>的攻击。这个参数实际上是<strong class="ih hj"> <em class="jd">序列</em> </strong>，这给了我在应用程序中使用我为该特定应用程序编写的 python 脚本创建<strong class="ih hj"> <em class="jd">拒绝服务</em> </strong>攻击的优势。没有 WAF (Web 应用程序防火墙)能够检测到这种攻击，因为这完全是应用程序的逻辑行为(您将在后面看到)。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h2 id="930e" class="ko jm hi bd jn kp kq kr jr ks kt ku jv iq kv kw jz iu kx ky kd iy kz la kh lb bi translated">先决条件</h2><p id="c297" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><strong class="ih hj">DOS 攻击你懂什么？<br/> </strong> <em class="jd">在计算领域，拒绝服务攻击是一种网络攻击，攻击者试图通过暂时或无限期中断连接到互联网的主机的服务，使其目标用户无法使用机器或网络资源。【来自:</em> <a class="ae lc" href="https://en.wikipedia.org/wiki/Denial-of-service_attack" rel="noopener ugc nofollow" target="_blank"> <em class="jd">维基</em> </a> <em class="jd">】。</em> <br/>好的，除此之外，这是<a class="ae lc" href="https://us-cert.cisa.gov/ncas/tips/ST04-015" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> US-CERT </strong> </a>所说的:<br/> <em class="jd">拒绝服务条件是通过用流量</em> <strong class="ih hj"> <em class="jd">淹没目标主机或网络，直到目标无法响应或干脆崩溃</em> </strong> <em class="jd">，阻止合法用户的访问来实现的。</em></p><p id="cb62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我所理解的，“<em class="jd">如果攻击者能够在攻击之后(或期间)阻止用户使用应用程序内部的任何功能或特性”应该被视为拒绝服务攻击</em>。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h2 id="9416" class="ko jm hi bd jn kp kq kr jr ks kt ku jv iq kv kw jz iu kx ky kd iy kz la kh lb bi translated">让我们从初始 bug(IDOR)开始，</h2><p id="d2c9" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">这个应用程序类似于<a class="ae lc" href="https://wetransfer.com" rel="noopener ugc nofollow" target="_blank"> Wetransfer </a>，用户可以通过提供一些细节，如接收者的电子邮件、发送者的电子邮件、手机号码(应该验证)和文件(当然)，将文件发送给另一个用户。</p><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es ld"><img src="../Images/5c9f6c300028a3cb53e827b5853d9eef.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*bG0nYMMLc6Y6oLEbJ58rHg.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">看起来怎么样</figcaption></figure><p id="837f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你上传一个文件，作为回应，我们得到一个文件 id 的上传文件。你也可以从<strong class="ih hj"> <em class="jd">检查器</em> </strong>中看到<strong class="ih hj"> <em class="jd"> file_id </em> </strong>也可以。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/64205835fe0fa732e493ed6b83099906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tqJV_m37n3QrgAnk3yc98Q.jpeg"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">上传文件&gt;获取文件标识。</figcaption></figure><p id="a7f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你上传了一个错误的文件，还可以选择从服务器上删除这个文件。现在这里有一个问题，<strong class="ih hj"> <em class="jd"> file_id </em> </strong>本质上是连续的，当我们尝试删除文件时，<strong class="ih hj"> <em class="jd"> POST </em> </strong>请求是用请求体中的<strong class="ih hj"> <em class="jd"> file_id </em> </strong>参数生成的。下面是删除文件的请求:</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/aff4968060b9742f3c76cc0f819194c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P2xdCufp6WUtRMK8oyok4w.png"/></div></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">如果文件存在，则显示<strong class="bd jn">成功</strong>，否则<strong class="bd jn">失败</strong>。</figcaption></figure><p id="6d4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你们中的许多人已经意识到可能存在 IDOR(不安全的直接对象引用)。所以，是的，你可以删除文件，因为没有访问控制删除文件。<br/>好的，所以任何人只要知道你的<strong class="ih hj"> <em class="jd"> file_id </em> </strong>就可以删除你的文件。尽管<strong class="ih hj"> <em class="jd"> file_id </em> </strong>是连续的，所以你可以简单地用<strong class="ih hj"> <em class="jd">蛮力</em> </strong>一下。当 file_id 被删除时，用户简单地得到一个错误消息，说<strong class="ih hj"> <em class="jd">“出错了，请再试一次”。</em> </strong></p><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es lu"><img src="../Images/96430b86b9d651ed36bdee27c0a19f9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*gyCRu3qznOMCIKzzzaAt2w.png"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">出错信息</figcaption></figure><p id="04fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么接下来可以做什么来增加这个 bug 的严重性呢？思考一分钟，然后继续往下读。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="40d0" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak"> IDOR - &gt; DOS </strong></h1><p id="9ba8" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">到目前为止，我们得到了一个 IDOR(严重性:高)，现在我将向您展示，我如何通过编写一个简单的 python 脚本将它提高到临界(DOS 攻击)。</p><p id="b22e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我写了一个脚本，其中定义了一个<strong class="ih hj"> <em class="jd">范围</em> </strong>，它发送 POST 请求来删除该范围内的特定 file_id。并且一旦脚本发现任何<strong class="ih hj"> <em class="jd"> file_id </em> </strong>被成功移除，则范围自动调整自身(即增加它的范围)。先看剧本:</p><figure class="le lf lg lh fd li"><div class="bz dy l di"><div class="lv lw l"/></div><figcaption class="ll lm et er es ln lo bd b be z dx translated">python3 dos_poc.py <file_id/></figcaption></figure><h2 id="10e0" class="ko jm hi bd jn kp kq kr jr ks kt ku jv iq kv kw jz iu kx ky kd iy kz la kh lb bi translated"><strong class="ak">这个脚本有什么作用？</strong></h2><p id="fd29" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">首先，你必须在网站上上传一个文件，并获得当前的文件标识(由检查员)。<br/> <strong class="ih hj"> 1。</strong>现在通过将 file_id 值作为参数传递来运行脚本。例如:<br/> (python3 dos_poc.py 310)。<br/> <strong class="ih hj"> 2。该脚本将创建一个从 310 到 330 的范围。<br/> <strong class="ih hj"> 3。它将发送一个 Post 请求来删除范围在 310 到 330 之间的文件标识。<br/> <strong class="ih hj"> 4。如果脚本找到了响应任何请求的成功消息，那么它将自动增加它的范围。例:如果发现 310 成功(响应)，那么新范围将是 311 到 331。攻击仍在继续..</strong></strong></strong></p><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es lx"><img src="../Images/51f07341fd2d9376f6c3927225b535ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*qne72cG4vJGQvsbdPg5EzQ.png"/></div></figure><h1 id="3030" class="jl jm hi bd jn jo ly jq jr js lz ju jv jw ma jy jz ka mb kc kd ke mc kg kh ki bi translated"><strong class="ak">影响</strong></h1><p id="9003" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">因此，当我运行我的脚本时，任何试图通过该网站共享文件的人都会受到影响，他们的文件会被自动从服务器上删除，并显示一条错误消息<strong class="ih hj"> <em class="jd">“出错，请稍后再试。”。</em>T3】</strong></p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="b62c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我用 IDOR 漏洞链接，使该网站容易受到拒绝服务攻击。这种 DOS 攻击是完全合乎逻辑，因为它的行为没有恶意，所以没有 WAF 能够检测到这种攻击。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><h1 id="23cf" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">外卖:</h1><p id="1178" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">&gt;我们应该始终考虑将漏洞链接起来以增加严重性(寻找最高的)。<br/> &gt;如果把访问控制的 bug 和其他一些 bug 链接起来，就变得更有意思了。想想吧。<br/> &gt;在 Twitter 上关注我了解更多信息。😉</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="d4c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于任何查询，DMs 都是开放的:</p><p id="cede" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">推特:<a class="ae lc" href="https://twitter.com/abhiunix" rel="noopener ugc nofollow" target="_blank">https://twitter.com/abhiunix</a><br/>领英:<a class="ae lc" href="https://linkedin.com/in/abhiunix" rel="noopener ugc nofollow" target="_blank">https://linkedin.com/in/abhiunix</a><br/>谢谢！！</p></div></div>    
</body>
</html>