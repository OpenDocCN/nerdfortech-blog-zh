<html>
<head>
<title>Add Email Functionality to a Django User Registration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向 Django 用户注册添加电子邮件功能</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/add-email-functionality-to-a-django-user-registration-b3b3655ed623?source=collection_archive---------0-----------------------#2021-02-15">https://medium.com/nerd-for-tech/add-email-functionality-to-a-django-user-registration-b3b3655ed623?source=collection_archive---------0-----------------------#2021-02-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="32a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户注册和认证是任何 web 应用程序的一个关键部分，为了完成这个过程，系统需要电子邮件来帮助与客户端进行通信。在本文中，我们将向 Django 用户注册流程添加电子邮件功能。</p><p id="08ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户在您的 web 应用程序上创建帐户时，您可能想要在以下情况下向他们发送电子邮件:</p><ul class=""><li id="6b43" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">他们成功地创建了一个帐户</li><li id="85bc" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">他们请求重设密码</li><li id="6222" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">他们的个人资料发生了一些重大变化</li><li id="5e89" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">然后发送通信消息</li><li id="dbc8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">双因素身份验证，每次登录时使用第二个代码以提高安全性</li><li id="2e95" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">你需要交流的任何其他原因</li></ul><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/5d5300ac9563a687ac140ec6a35f785f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbiDHAkVstEVDZZcFkuk9g.jpeg"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">向 Django 用户注册流程添加电子邮件功能</figcaption></figure><h1 id="861a" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">HTML 电子邮件和模板</h1><p id="3698" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">除了标准的纯文本电子邮件类型，我们还将发送 HTML 电子邮件类型。在 Django 文档页面上阅读更多关于从 Django 发送电子邮件的信息:【https://docs.djangoproject.com/en/3.1/topics/email/ T2】</p><p id="4f66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们假设你已经设计了一个 Django 项目和用户注册流程——查看我们以前的相关文章:<a class="ae lk" href="https://skolo-online.medium.com/python-django-user-registration-login-logout-custom-styling-c2f2901e162a" rel="noopener">https://skolo-online . medium . com/python-Django-user-registration-log in-logout-custom-styling-c2f 2901 e 162 a</a></p><h2 id="03bc" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">获取电子邮件 HTML 模板</h2><p id="d940" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">请访问:<a class="ae lk" href="https://github.com/mailchimp/email-blueprints/tree/master/templates" rel="noopener ugc nofollow" target="_blank">https://github . com/mailchimp/email-blue prints/tree/master/templates</a>获取您可以根据自己的需求使用的电子邮件模板。</p><p id="e1fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">电子邮件模板的工作方式与 Django 中的页面 HTML 模板类似。您可以使用上下文对象将数据传递给 HTML，并在双花括号中访问该数据:</p><p id="be81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的 HTML 模板中</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="1a7a" class="ll ki hi ma b fi me mf l mg mh">&lt;h1&gt;{{object.title}}&lt;/h1&gt;<br/>&lt;h2&gt;{{object.subtitle}}&lt;/h2&gt;</span></pre><p id="8dc9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将以 JSON 格式发送到模板的数据:</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="c8bd" class="ll ki hi ma b fi me mf l mg mh">{<br/>"object": { "title": "this is a title", "subtitle": "this is a subtitle" }<br/>}</span></pre><h2 id="5171" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">获取电子邮件托管帐户，并将配置添加到设置文件中</h2><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es mi"><img src="../Images/37c7ccdf6fc653dd99f416af6ec9f656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1NxWexwTZLP_Vk_Xi6FVg.jpeg"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">发送 Django 电子邮件</figcaption></figure><p id="31f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一步是获得一个电子邮件托管帐户，或者你可以使用一个现有的帐户，你需要:(1)邮件服务器，(2)邮件用户名和(3)邮件密码来访问该帐户。</p><p id="3ce4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">获得这些详细信息后，将它们添加到 settings.py 文件的底部，如下所示:</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="0f66" class="ll ki hi ma b fi me mf l mg mh">. . . . . .  <br/>#Email settings details <br/>EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend' EMAIL_HOST = 'mail.careers-portal.com' <br/>EMAIL_USE_TLS = True <br/>EMAIL_PORT = 587 <br/>EMAIL_HOST_USER = 'no-reply@careers-portal.com' <br/>EMAIL_HOST_PASSWORD = '************' <br/>. . . . . . .</span></pre><h2 id="3982" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">构建 sendMail 函数</h2><p id="284a" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">创建电子邮件数据:</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="a588" class="ll ki hi ma b fi me mf l mg mh">email = {<br/>    "title": "Thank your for registering with Careers Portal",<br/>    "shortDescription": "Welcome to Careers Portal, South Africa's Leading Job <br/>     Search Engine. These are the next steps.",<br/>    "subtitle": "Careers Portal - Start your job search process today",<br/>    "message": "You have successfully registered with Careers Portal. You can <br/>     now login in to your profile and start creating a profile. We have <br/>     thousands of jobs just waiting for you to apply. If you experience any <br/>     issues feel free to contact our support at support@careers-portal.co.za.&gt;<br/>    }<br/>subject = '[Careers Portal] Welcome to Careers Portal'<br/>to_email = 'anyemail@gmail.com"</span></pre><p id="7fd9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们现在需要的所有数据，然后我们需要创建如下所示的电子邮件功能。该函数接收上面指定的数据。</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="a7f8" class="ll ki hi ma b fi me mf l mg mh">def sendEmail(email, subject, to_email):</span><span id="e227" class="ll ki hi ma b fi mj mf l mg mh">    from_email = settings.EMAIL_HOST_USER</span><span id="5e4c" class="ll ki hi ma b fi mj mf l mg mh">    text_content = """<br/>    {}</span><span id="4cfd" class="ll ki hi ma b fi mj mf l mg mh">    {}</span><span id="2ccf" class="ll ki hi ma b fi mj mf l mg mh">    {}</span><span id="87a9" class="ll ki hi ma b fi mj mf l mg mh">    regards,<br/>    Careers Portal Support<br/>    """. format(email['shortDescription'], email['subtitle'], email['message'])</span><span id="4fc4" class="ll ki hi ma b fi mj mf l mg mh">    html_c = get_template('basic-email.html')<br/>    d = { 'email': email }<br/>    html_content = html_c.render(d)</span><span id="5c27" class="ll ki hi ma b fi mj mf l mg mh">    msg = EmailMultiAlternatives(subject, text_content, from_email, to_email)<br/>    msg.attach_alternative(html_content, 'text/html')<br/>    msg.send()</span></pre><p id="ccd4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们知道了函数应该是什么样子，让我们在现有的视图函数中应用这个函数——在我们的 python Django 项目中。为此，我们将使用“忘记邮件”功能。</p><p id="d000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该功能将启动后面的过程，使用户能够重置他们的密码。我们将重置新密码，并通过电子邮件将新密码发送给用户。</p><p id="440c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是必需的:</p><ol class=""><li id="90d2" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc mk jj jk jl bi translated">一个 HTML 文件，带有一个用户可以用来请求密码重置的表单</li><li id="1b15" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc mk jj jk jl bi translated">在上面的 HTML 文件中提供的表单</li><li id="b29b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc mk jj jk jl bi translated">处理该请求的视图函数</li><li id="0637" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc mk jj jk jl bi translated">url 文件的更新—包括“忘记密码”的新 URL</li></ol><h2 id="3ca1" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">创建满足请求的 HTML 文件</h2><p id="5fdb" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">您可以为此使用任何模板，在模板内部您将有一个表单。该表单只有一个字段，即电子邮件字段。这就是我们需要从用户那里得到的所有信息——他们的电子邮件，这样我们就可以搜索数据库并调出他们的个人资料(如果有的话):</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="cc5d" class="ll ki hi ma b fi me mf l mg mh">&lt;form class="login-form" method="POST"&gt;</span><span id="47ea" class="ll ki hi ma b fi mj mf l mg mh">{% csrf_token %}</span><span id="93e9" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="row"&gt;</span><span id="82c9" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="col-12 text-center"&gt;</span><span id="2c4e" class="ll ki hi ma b fi mj mf l mg mh">&lt;p&gt;Let us find your account first, enter the email address associated with the account below:&lt;/p&gt;</span><span id="f4bd" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="3f5e" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="col-lg-12"&gt;</span><span id="171b" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="form-group position-relative"&gt;</span><span id="d993" class="ll ki hi ma b fi mj mf l mg mh">&lt;label&gt;Enter Email &lt;span class="text-danger"&gt;*&lt;/span&gt;&lt;/label&gt;</span><span id="da99" class="ll ki hi ma b fi mj mf l mg mh">{{form.email}}</span><span id="3406" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="6368" class="ll ki hi ma b fi mj mf l mg mh">{% if form.email.errors %}</span><span id="e0f6" class="ll ki hi ma b fi mj mf l mg mh">{% for error in form.email.errors %}</span><span id="b904" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="alert alert-danger"&gt;</span><span id="0bfb" class="ll ki hi ma b fi mj mf l mg mh">&lt;strong&gt;{{ error|escape }}&lt;/strong&gt;</span><span id="9ec5" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="0c77" class="ll ki hi ma b fi mj mf l mg mh">{% endfor %}</span><span id="a839" class="ll ki hi ma b fi mj mf l mg mh">{% endif %}</span><span id="6b25" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="8ee4" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="col-lg-12 mb-0"&gt;</span><span id="0b00" class="ll ki hi ma b fi mj mf l mg mh">&lt;button class="btn btn-primary w-100" type="submit"&gt;Recover Password&lt;/button&gt;</span><span id="7bb0" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="1eee" class="ll ki hi ma b fi mj mf l mg mh">&lt;div class="col-12 text-center"&gt;</span><span id="b8fe" class="ll ki hi ma b fi mj mf l mg mh">&lt;p class="mb-0 mt-3"&gt;&lt;small class="text-dark mr-2"&gt;Create a new account ?&lt;/small&gt; &lt;a href="{% url 'register' %}" class="text-dark font-weight-bold"&gt;Register&lt;/a&gt;&lt;/p&gt;</span><span id="6cb9" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="dc61" class="ll ki hi ma b fi mj mf l mg mh">&lt;/div&gt;</span><span id="e86f" class="ll ki hi ma b fi mj mf l mg mh">&lt;/form&gt;</span></pre><h2 id="9840" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">忘记电子邮件表单</h2><p id="b724" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">在 forms.py 文件中—我们需要在文件的底部添加一个新的表单。这是将在上面的 HTML 文件中呈现的表单。确保您有这些导入—表单和用户类。</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="fdf7" class="ll ki hi ma b fi me mf l mg mh"><strong class="ma hj">from</strong> django <strong class="ma hj">import</strong> forms</span><span id="d12a" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">from</strong> django.contrib.auth.models <strong class="ma hj">import</strong> User</span><span id="5f83" class="ll ki hi ma b fi mj mf l mg mh">...<br/>.<br/>.<br/>.<br/>.<br/>....</span><span id="8812" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">class</strong> ForgotForm(forms.ModelForm):</span><span id="d5c9" class="ll ki hi ma b fi mj mf l mg mh">email = forms.EmailField(</span><span id="de6c" class="ll ki hi ma b fi mj mf l mg mh">max_length=100,</span><span id="196e" class="ll ki hi ma b fi mj mf l mg mh">required = <strong class="ma hj">True</strong>,</span><span id="7c91" class="ll ki hi ma b fi mj mf l mg mh">help_text=<strong class="ma hj">'Enter Email Address'</strong>,</span><span id="b4fb" class="ll ki hi ma b fi mj mf l mg mh">widget=forms.TextInput(attrs={<strong class="ma hj">'class'</strong>: <strong class="ma hj">'form-control'</strong>, <strong class="ma hj">'placeholder'</strong>: <strong class="ma hj">'Enter Email'</strong>}),</span><span id="c04c" class="ll ki hi ma b fi mj mf l mg mh">)</span><span id="91b4" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">class</strong> Meta:</span><span id="a38d" class="ll ki hi ma b fi mj mf l mg mh">model = User</span><span id="0426" class="ll ki hi ma b fi mj mf l mg mh">fields = [<strong class="ma hj">'email'</strong>]</span></pre><h2 id="072e" class="ll ki hi bd kj lm ln lo kn lp lq lr kr iq ls lt kv iu lu lv kz iy lw lx ld ly bi translated">创建遗忘视图</h2><p id="bbf0" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">在 views.py 文件内—添加以下代码行来处理视图:</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="a5f7" class="ll ki hi ma b fi me mf l mg mh"><strong class="ma hj">from</strong> .functions <strong class="ma hj">import</strong> WelcomeEmail, sendEmail, ForgotEmail<br/><strong class="ma hj">from</strong> uuid <strong class="ma hj">import</strong> uuid4<br/><strong class="ma hj">from</strong> django.conf <strong class="ma hj">import</strong> settings<br/><strong class="ma hj">from</strong> django.contrib.auth.models <strong class="ma hj">import</strong> User<br/><strong class="ma hj">from</strong> django.shortcuts <strong class="ma hj">import</strong> render, redirect<br/><strong class="ma hj">from</strong> django.contrib <strong class="ma hj">import</strong> messages</span><span id="9eac" class="ll ki hi ma b fi mj mf l mg mh">...<br/>.<br/>.<br/>.<br/>.<br/>...</span><span id="cf85" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">def forgot</strong>(request):</span><span id="817b" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">if</strong> request.method == <strong class="ma hj">'POST'</strong>:</span><span id="1d2e" class="ll ki hi ma b fi mj mf l mg mh">form  = ForgotForm(request.POST)</span><span id="7e9c" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">if</strong> form.is_valid():</span><span id="a334" class="ll ki hi ma b fi mj mf l mg mh">user_email = request.POST[<strong class="ma hj">'email'</strong>].lower().replace(<strong class="ma hj">' '</strong>, <strong class="ma hj">''</strong>)</span><span id="c6a4" class="ll ki hi ma b fi mj mf l mg mh">u = User.objects.get(email=user_email)</span><span id="1058" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">if</strong> u <strong class="ma hj">is</strong> <strong class="ma hj">not</strong> <strong class="ma hj">None</strong>:</span><span id="4c20" class="ll ki hi ma b fi mj mf l mg mh">new_pass = str(uuid4()).split(<strong class="ma hj">'-'</strong>)[4]</span><span id="1739" class="ll ki hi ma b fi mj mf l mg mh">forgot = ForgotEmail(new_pass)<br/></span><span id="0fa4" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">#Send the Forgot Email . . .</strong></span><span id="456f" class="ll ki hi ma b fi mj mf l mg mh">to_email = u.email</span><span id="1022" class="ll ki hi ma b fi mj mf l mg mh">e_mail = forgot.email()</span><span id="be3f" class="ll ki hi ma b fi mj mf l mg mh">sendEmail(e_mail, forgot.subject, [to_email])</span><span id="9f3a" class="ll ki hi ma b fi mj mf l mg mh">u.set_password(new_pass)</span><span id="2804" class="ll ki hi ma b fi mj mf l mg mh">u.save()</span><span id="97ee" class="ll ki hi ma b fi mj mf l mg mh">messages.success(request, <strong class="ma hj">'Your password has been reset, check your email for more details'</strong>)</span><span id="5e49" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> redirect(<strong class="ma hj">'login'</strong>)</span><span id="29a3" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">else</strong>:</span><span id="64fb" class="ll ki hi ma b fi mj mf l mg mh">messages.error(request, <strong class="ma hj">'We could not find a user with matching email'</strong>)</span><span id="fef9" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> redirect(<strong class="ma hj">'home_page'</strong>)</span><span id="6a3e" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">else</strong>:</span><span id="ecd3" class="ll ki hi ma b fi mj mf l mg mh">messages.error(request, <strong class="ma hj">'Error Processing Your Request'</strong>)</span><span id="820b" class="ll ki hi ma b fi mj mf l mg mh">context = {<strong class="ma hj">'form'</strong>: form}</span><span id="3424" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> render(request, <strong class="ma hj">'forgot.html'</strong>, context)</span><span id="c76f" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">if</strong> request.method == <strong class="ma hj">'GET'</strong>:</span><span id="400f" class="ll ki hi ma b fi mj mf l mg mh">form  = ForgotForm()</span><span id="b782" class="ll ki hi ma b fi mj mf l mg mh">context = {<strong class="ma hj">'form'</strong>: form}</span><span id="7b7b" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> render(request, <strong class="ma hj">'forgot.html'</strong>, context)</span><span id="cee2" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> render(request, <strong class="ma hj">'forgot.html'</strong>, {})</span></pre><p id="f032" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 POST 选项中，我们在这个函数中所做的事情如下:</p><p id="3931" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(1)我们用请求声明表单变量。后置参数</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="cd84" class="ll ki hi ma b fi me mf l mg mh">form  = ForgotForm(request.POST)</span></pre><p id="4b13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在继续之前，我们检查表单是否有效，然后使用提交的电子邮件检查该电子邮件中是否存在用户。如果用户存在，我们继续。我们使用 uuid4 创建一个密码(*确保您安装了它并将其导入到文件的顶部)。</p><p id="4b4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建新密码后，我们将带有新密码的电子邮件发送给客户端，然后在系统上更新密码。最后，我们将用户重定向到登录页面。</p><p id="fda5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在这里看到，我们正在导入一个 forgotEmail 类，并从其他地方调用该函数。我们在一个单独的文件中编写了这些函数。</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="9e01" class="ll ki hi ma b fi me mf l mg mh">forgot = ForgotEmail(new_pass)<br/>sendEmail(e_mail, forgot.subject, [to_email])</span></pre><p id="6328" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建一个名为 functions.py 的新文件，并粘贴下面的代码。然后，确保在 view.py 文件的顶部导入文件。</p><p id="4112" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">functions.py 内部</p><pre class="js jt ju jv fd lz ma mb mc aw md bi"><span id="4ac4" class="ll ki hi ma b fi me mf l mg mh"><strong class="ma hj">from</strong> django.conf <strong class="ma hj">import</strong> settings</span><span id="da6f" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">from</strong> django.core.mail <strong class="ma hj">import</strong> EmailMultiAlternatives</span><span id="95e9" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">from</strong> django.template.loader <strong class="ma hj">import</strong> get_template</span><span id="5a87" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">class</strong> ForgotEmail():</span><span id="35e5" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">def __init__</strong>(self, new_pass):</span><span id="8014" class="ll ki hi ma b fi mj mf l mg mh">self.new_pass = new_pass<br/></span><span id="f788" class="ll ki hi ma b fi mj mf l mg mh">subject = <strong class="ma hj">'[Careers Portal] Forgot your password'</strong></span><span id="e9d9" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">def email</strong>(self):</span><span id="e1ef" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">return</strong> {</span><span id="66a9" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">"title"</strong>: <strong class="ma hj">"Your password has been reset"</strong>,</span><span id="73ba" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">"shortDescription"</strong>: <strong class="ma hj">"You have requested a new password"</strong>,</span><span id="5f82" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">"subtitle"</strong>: <strong class="ma hj">"Please find your new password attached for Careers Portal"</strong>,</span><span id="d93c" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">"message"</strong>: <strong class="ma hj">"Your new password is: {}. If you did not request this new password, please contact support@careers-portal.co.za immediately. Othewise, kindly login to your profile with your new password. If you have any challenges, send an email to admin@careers-portal.co.za."</strong></span><span id="45b8" class="ll ki hi ma b fi mj mf l mg mh">}<br/></span><span id="2629" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">def sendEmail</strong>(email, subject, to_email):</span><span id="b66f" class="ll ki hi ma b fi mj mf l mg mh">from_email = settings.EMAIL_HOST_USER</span><span id="bffe" class="ll ki hi ma b fi mj mf l mg mh">text_content = <strong class="ma hj">"""</strong></span><span id="1936" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">{}</strong></span><span id="d81a" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">{}</strong></span><span id="2be1" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">{}</strong></span><span id="e642" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">regards,</strong></span><span id="7fee" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">Careers Portal Support</strong></span><span id="f258" class="ll ki hi ma b fi mj mf l mg mh"><strong class="ma hj">"""</strong>. format(email[<strong class="ma hj">'shortDescription'</strong>], email[<strong class="ma hj">'subtitle'</strong>], email[<strong class="ma hj">'message'</strong>])</span><span id="0379" class="ll ki hi ma b fi mj mf l mg mh">html_c = get_template(<strong class="ma hj">'basic-email.html'</strong>)</span><span id="65f5" class="ll ki hi ma b fi mj mf l mg mh">d = { <strong class="ma hj">'email'</strong>: email }</span><span id="8735" class="ll ki hi ma b fi mj mf l mg mh">html_content = html_c.render(d)</span><span id="1bec" class="ll ki hi ma b fi mj mf l mg mh">msg = EmailMultiAlternatives(subject, text_content, from_email, to_email)</span><span id="7731" class="ll ki hi ma b fi mj mf l mg mh">msg.attach_alternative(html_content, <strong class="ma hj">'text/html'</strong>)</span><span id="3179" class="ll ki hi ma b fi mj mf l mg mh">msg.send()</span></pre><h1 id="9254" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">完整视频教程——为 Django 用户注册添加电子邮件功能</h1><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ml mm l"/></div></figure></div></div>    
</body>
</html>