<html>
<head>
<title>Searching for Prominent Colors in an image from a given Palette in Go — Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Go 中从给定调色板中搜索图像中的突出颜色—第二部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/searching-for-prominent-colors-in-an-image-from-a-given-palette-in-go-part-ii-d4fd8e698fb7?source=collection_archive---------8-----------------------#2021-02-09">https://medium.com/nerd-for-tech/searching-for-prominent-colors-in-an-image-from-a-given-palette-in-go-part-ii-d4fd8e698fb7?source=collection_archive---------8-----------------------#2021-02-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5b7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇由两部分组成的文章(<a class="ae jd" rel="noopener" href="/@philojjohny/searching-for-prominent-colors-in-an-image-from-a-given-palette-in-go-part-i-13e8e511a6b0"> I </a>，<a class="ae jd" rel="noopener" href="/@philojjohny/searching-for-prominent-colors-in-an-image-from-a-given-palette-in-go-part-ii-d4fd8e698fb7"> II </a>)探讨了使用 kd-tree 数据结构从给定的调色板中识别图像中的突出颜色的概念。</p><blockquote class="je jf jg"><p id="5ef6" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated">这篇文章的源代码【https://github.com/philoj/tree-palette T4】</p></blockquote><p id="b694" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文第一部分<a class="ae jd" rel="noopener" href="/@philojjohny/searching-for-prominent-colors-in-an-image-from-a-given-palette-in-go-part-i-13e8e511a6b0">这里</a>。</p><h2 id="a0ba" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated"><a class="ae jd" href="https://en.wikipedia.org/wiki/K-d_tree" rel="noopener ugc nofollow" target="_blank"> kd 树</a>方法</h2><p id="0c1f" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">简而言之，我们将创建一个类似于<a class="ae jd" href="https://en.wikipedia.org/wiki/Binary_tree" rel="noopener ugc nofollow" target="_blank">树</a>的数据结构来存储调色板。这将在数据结构本身中保留关于每种颜色彼此接近的信息。当我们搜索相似的颜色时，我们不是计算调色板中所有颜色的距离，而是只计算最接近的几个颜色，从而节省了计算时间。</p><figure class="km kn ko kp fd kq er es paragraph-image"><div class="er es kl"><img src="../Images/03a9f62990ef20dd2e2c3396f3eef556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*cBhghbYM3H_yDYdYeWhRQQ.png"/></div></figure><p id="0808" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查是否有人已经在开源世界中做了你正在尝试做的事情，这总是一个很好的做法，这将带我们到 GitHub 中这个很酷的 kd-tree 实现，作者是<a class="ae jd" href="https://github.com/kyroy" rel="noopener ugc nofollow" target="_blank"> Dennis Kuhnert </a>:</p><blockquote class="je jf jg"><p id="7e33" class="if ig jh ih b ii ij ik il im in io ip ji ir is it jj iv iw ix jk iz ja jb jc hb bi translated"><a class="ae jd" href="https://github.com/kyroy/kdtree" rel="noopener ugc nofollow" target="_blank">https://github.com/kyroy/kdtree</a>(围棋中的 k-d 树实现)</p></blockquote><p id="cd76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了！现在我们不必完全从头开始了！</p><p id="52d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了更好地适应我们的场景，我们可以对代码进行一些重大的修改:</p><ul class=""><li id="8699" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">内置的 go 图像和颜色包使用<em class="jh"> uint32 </em>作为 RGB 值的类型，而 kdtree 使用<em class="jh"> float </em>来存储值。我们可以在实现中使用<em class="jh"> uint32 </em>来代替<em class="jh"> float </em>。</li><li id="f31f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">我们的基本假设是调色板在整个过程中保持不变。这意味着我们可以抛弃原始实现中的插入、删除、重新平衡功能(对不起，丹尼斯)。</li><li id="0889" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">kdtree 实现能够找到 n 个最相似的颜色，而我们只关心最相似的颜色。所以是的，把它全部刮开，只找到最相似的颜色。</li><li id="5cc4" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">此外，在进行实际距离比较的地方，我们可以不在距离方程中应用平方根，因为我们只是用它来进行比较。</li></ul><h2 id="a879" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">编码时间到了！</h2><p id="7f90" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">创建界面，</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="lh li l"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">(类似于 kdtree 的<em class="ln">点</em>接口)</figcaption></figure><p id="9920" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实现这些接口，</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="lh li l"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">(我们也增加了对 alpha 值的可选支持)</figcaption></figure><p id="9513" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实现 kd 树并将其称为“调色板”，</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="lh li l"/></div><figcaption class="lj lk et er es ll lm bd b be z dx translated">(kd 树创建需要在向树中插入值时，沿不同的轴对调色板值进行排序。为此，我们将保留来自 kdtree 的原始实现)</figcaption></figure><p id="dd11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对原来的<em class="jh"> knn() </em>函数进行修补，将其变成一个<em class="jh"> nn() </em>函数，</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="db84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们完事了。！</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><h2 id="518b" class="jl jm hi bd jn jo jp jq jr js jt ju jv iq jw jx jy iu jz ka kb iy kc kd ke kf bi translated">无论什么...有用吗？</h2><p id="134c" class="pw-post-body-paragraph if ig hi ih b ii kg ik il im kh io ip iq ki is it iu kj iw ix iy kk ja jb jc hb bi translated">让我们试试这张图片和我们在一开始看到的调色板:</p><figure class="km kn ko kp fd kq er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/45fdd63d045215219b90082d893927ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8mBSg6YJTvNcTsGZP0H8Hw.png"/></div></div></figure><p id="0290" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是示例代码:</p><figure class="km kn ko kp fd kq"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="63e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果是:</p><pre class="km kn ko kp fd ma mb mc md aw me bi"><span id="39ac" class="jl jm hi mb b fi mf mg l mh mi">1. OLD OLIVE(13) - 508392 Occurances<br/>2. CADILLAC(9) - 314677 Occurances<br/>3. BRICK RED(7) - 142207 Occurances<br/>4. DANDELION(1) - 62331 Occurances<br/>5. CRUSTA(3) - 44161 Occurances<br/>6. MEDIUM TURQUOISE(10) - 19462 Occurances<br/>7. DARK PINK(8) - 601 Occurances<br/>8. PACIFIC BLUE(11) - 9 Occurances</span></pre></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><p id="8d42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这是有用的。如果我仓促行事，请让我知道。还有，欢迎各种有创意的批评！</p></div></div>    
</body>
</html>