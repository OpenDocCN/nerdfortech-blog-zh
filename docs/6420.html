<html>
<head>
<title>Turn by Turn navigation with Mapbox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用地图框的即时路线导航</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/turn-by-turn-navigation-with-mapbox-16f874567b3c?source=collection_archive---------1-----------------------#2022-02-20">https://medium.com/nerd-for-tech/turn-by-turn-navigation-with-mapbox-16f874567b3c?source=collection_archive---------1-----------------------#2022-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d916" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">让我们来探索一下 Mapbox 强大的导航 SDK</h2></div><p id="3549" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将关注<strong class="iz hj">地图框搜索 API</strong>、<strong class="iz hj">导航 SDK </strong>和<strong class="iz hj">地理编码 API</strong>，同时创建一个完整的优步应用程序式体验。</p><p id="c716" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">喜欢视频，觉得文章更难读？我掩护你。😇观看下面的完整教程视频。</em></p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="jz ka l"/></div></figure><p id="b1ea" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我的上一篇博客中，我们讨论了 Mapbox 作为谷歌地图平台的替代品，并使用 Directions API 构建了一个 Flutter 应用程序。我强烈建议你读一读。</p><div class="kb kc ez fb kd ke"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/navigation-with-mapbox-for-flutter-apps-313687778686"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">针对 Flutter 应用程序的地图框导航</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">Mapbox 是谷歌地图平台的强大替代品</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">medium.com</p></div></div><div class="kn l"><div class="ko l kp kq kr kn ks kt ke"/></div></div></a></div><h1 id="c953" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">项目描述</h1><p id="f9d0" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">从外行的角度来看，优步应用程序有四个重要的屏幕。我们还有许多其他特性，但我们不会在演示中考虑所有这些特性。</p><ol class=""><li id="d478" class="lr ls hi iz b ja jb jd je jg lt jk lu jo lv js lw lx ly lz bi translated"><strong class="iz hj">主屏幕</strong> —在这里您可以看到您的位置和以前的旅行</li><li id="9310" class="lr ls hi iz b ja ma jd mb jg mc jk md jo me js lw lx ly lz bi translated"><strong class="iz hj">准备游乐设备屏幕</strong>——在这里您可以选择出发地和目的地</li><li id="fb7a" class="lr ls hi iz b ja ma jd mb jg mc jk md jo me js lw lx ly lz bi translated"><strong class="iz hj">查看乘车屏幕</strong> —在这里您可以选择出租车并查看行程</li><li id="9aea" class="lr ls hi iz b ja ma jd mb jg mc jk md jo me js lw lx ly lz bi translated"><strong class="iz hj">开始骑行</strong>——你会看到一个逐圈导航</li></ol><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><div class="er es mf"><img src="../Images/43bc0ed4208434cff2f1d88ea12bfdb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bh199oTxxKnwhLwA1OmN9Q.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">从官方网站上截取的地图框导航图</figcaption></figure><p id="c6de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">要将此翻译成 Mapbox 术语，我们需要在这些屏幕中使用 Maps SDK、搜索和地理编码 API、方向 API 和导航 SDK。这是应用程序的最后几个屏幕。我们还推出了飞溅和率骑屏幕。😇</p><div class="ju jv jw jx fd ab cb"><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/e051f2c5838b1e9ef2e17be7118d5bc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*C4pJyDC0oxtn8rOvORwavQ.png"/></div></figure><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/a5a0e01693b414cb529ace646297b887.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lKDyXm3m78ezwK9l9adeiw.png"/></div></figure><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/5e1916c4648c56a2c85a9a752bf56e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*A-bddBNl2XM8-jYOPeJ9XA.png"/></div></figure></div><div class="ab cb"><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/d01bec244f57a61418d4b005d88dc963.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*IT6chbqSm8sVj0HbVi1U6Q.png"/></div></figure><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/478f1810f61d5f08e14e906df5d7f634.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*A9NiT4Gdflin9SOkhriuNQ.png"/></div></figure><figure class="mp jy mq mr ms mt mu paragraph-image"><div role="button" tabindex="0" class="mg mh di mi bf mj"><img src="../Images/899d0c3f07a40e9a0dbca327739ee072.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*EpGy7JKjkMLgIQ-SMxuHWw.png"/></div></figure></div><p id="c1ad" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们在每个屏幕上工作，看看如何构建它们。你会在这个博客的末尾找到源代码，但是请确保你已经阅读并理解了我们是如何实现每个屏幕的。</p><h1 id="0f65" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">主屏幕</h1><p id="362f" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">主屏幕看起来非常简单。我们需要使用<strong class="iz hj"> Maps SDK </strong>和<strong class="iz hj">反向地理编码 API </strong>来生成当前地址并在地图上显示位置。既然我们在 Flutter，我们可以用<a class="ae mv" href="https://pub.dev/packages/mapbox_gl" rel="noopener ugc nofollow" target="_blank"> Mapbox GL </a>的神奇包来换 maps SDK。对于反向地理编码，您可以使用<a class="ae mv" href="https://pub.dev/packages/dio" rel="noopener ugc nofollow" target="_blank"> Dio </a>并请求 mapbox.places 端点。一个典型的请求 URL 看起来像这样—</p><pre class="ju jv jw jx fd mw mx my mz aw na bi"><span id="4069" class="nb kv hi mx b fi nc nd l ne nf">https://api.mapbox.com/geocoding/v5/mapbox.places/-73.989,40.733.json?access_token=YOUR_PUBLIC_ACCESS_TOKEN</span></pre><h1 id="3660" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">准备游乐设备屏幕</h1><p id="9edb" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">这就是乐趣的开始。Mapbox 提供了可用作搜索 API 的正向地理编码 API，非常强大。第一步是去看看地理编码 API 运动场。使用可选参数如<code class="du ng nh ni mx b">proximity</code>、<code class="du ng nh ni mx b">language</code>和<code class="du ng nh ni mx b">country</code>调整您的搜索设置，以获得更好的结果。使用<code class="du ng nh ni mx b">types</code>参数，我们可以过滤以将返回的特征限制为所需的地点类型，如地点、邮政编码、地址等。</p><div class="kb kc ez fb kd ke"><a href="https://docs.mapbox.com/playground/geocoding/" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">地理编码 API |游乐场</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">地理编码 API 允许您按名称或坐标搜索地址和地点。要生成地理编码 API…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">docs.mapbox.com</p></div></div><div class="kn l"><div class="nj l kp kq kr kn ks kt ke"/></div></div></a></div><p id="7cf1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再次使用 Dio 发出请求，在从响应中提取特性并使用您喜欢的工具进行一点点状态管理之后，您应该能够完成您的第二个屏幕。</p><h1 id="3ea6" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated"><strong class="ak">查看游乐设备屏幕</strong></h1><p id="f2c1" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">在这个屏幕中，我们可以使用 Directions API 并在两个端点、取货点和目的地之间生成一条折线。在我之前的博客中，我们已经详细讨论过了，所以如果你需要指导，你可以重温一下。考虑到交通状况，我们还可以获得最短路线的距离和下车时间。</p><p id="b895" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请注意，方向 API 的响应为您提供了所需的时间。要将其转换为下车时间，在导入<a class="ae mv" href="https://pub.dev/packages/intl" rel="noopener ugc nofollow" target="_blank"> intl </a>包后使用以下函数。</p><pre class="ju jv jw jx fd mw mx my mz aw na bi"><span id="d394" class="nb kv hi mx b fi nc nd l ne nf">import 'package:intl/intl.dart';<br/><br/>String getDropOffTime(num duration) {<br/>  int minutes = (duration / 60).round();<br/>  int seconds = (duration % 60).round();<br/>  DateTime tripEndDateTime =<br/>      DateTime.now().add(Duration(minutes: minutes, seconds: seconds));<br/>  String dropOffTime = DateFormat.jm().format(tripEndDateTime);<br/>  return dropOffTime;<br/>}</span></pre><h1 id="cb90" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated"><strong class="ak">开始乘坐</strong></h1><p id="7501" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">该应用程序最重要的部分是转弯导航，它使用了以下软件包—</p><div class="kb kc ez fb kd ke"><a href="https://pub.dev/packages/flutter_mapbox_navigation" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">Flutter _ mapbox _ navigation | Flutter 包</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">使用 MapBox 将逐圈导航添加到您的 Flutter 应用程序中。当您需要导航时，请不要离开您的应用程序…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">公共开发</p></div></div><div class="kn l"><div class="nk l kp kq kr kn ks kt ke"/></div></div></a></div><p id="e6c3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简而言之，我们要定义<code class="du ng nh ni mx b">instructions</code>、<code class="du ng nh ni mx b">directions</code>、<code class="du ng nh ni mx b">options</code>、<code class="du ng nh ni mx b">distanceRemaining</code>等一堆变量。以及一堆布尔标志，如<code class="du ng nh ni mx b">isMultiStop</code>、<code class="du ng nh ni mx b">hasArrived</code>、<code class="du ng nh ni mx b">isNavigating</code>来管理 trip 事件。你将有语音和横幅指示，路线模拟，实时交通和更多的功能。</p><h1 id="d730" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">其他页面</h1><p id="4cf1" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">对于闪屏和评级来说，它们主要是用 Flutter 编写的 UI 页面，尽管<code class="du ng nh ni mx b">SplashScreen</code>会进行一系列异步 API 调用，并将重要数据存储到<code class="du ng nh ni mx b">SharedPreferences</code>。</p><h1 id="214e" class="ku kv hi bd kw kx ky kz la lb lc ld le io lf ip lg ir lh is li iu lj iv lk ll bi translated">结论</h1><p id="45fa" class="pw-post-body-paragraph ix iy hi iz b ja lm ij jc jd ln im jf jg lo ji jj jk lp jm jn jo lq jq jr js hb bi translated">逐路段导航是 Mapbox 中一个很棒的功能。我们可以在几分钟内构建完整的产品系列，从完全定制的解决方案到带有智能默认设置的应用内导航。我们已经介绍了 Mapbox 的大部分基本功能，并通过这个博客的实例看到了它的作用。</p><p id="a052" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以在这个 Github 资源库中找到博客(和视频)的完整源代码。</p><div class="kb kc ez fb kd ke"><a href="https://github.com/Imperial-lord/mapbox-flutter" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">GitHub-Imperial-Lord/mapbox-flutter:一个展示 map box 使用的库——它的地图…</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">一个展示 Mapbox 使用的库——它的地图和导航 SDK 在一个 Flutter 应用程序中——GitHub…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">github.com</p></div></div><div class="kn l"><div class="nl l kp kq kr kn ks kt ke"/></div></div></a></div><p id="b393" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">另外，你可以在 LinkedIn 上联系我</p><div class="kb kc ez fb kd ke"><a href="https://www.linkedin.com/in/ab-satyaprakash/" rel="noopener  ugc nofollow" target="_blank"><div class="kf ab dw"><div class="kg ab kh cl cj ki"><h2 class="bd hj fi z dy kj ea eb kk ed ef hh bi translated">AB Satyaprakash -应用开发主管-IITG 学生网络委员会| LinkedIn</h2><div class="kl l"><h3 class="bd b fi z dy kj ea eb kk ed ef dx translated">我是数学和计算机专业的毕业生，IIT·古瓦哈蒂。作为一名热情的程序员，我喜欢解决问题和…</h3></div><div class="km l"><p class="bd b fp z dy kj ea eb kk ed ef dx translated">www.linkedin.com</p></div></div><div class="kn l"><div class="nm l kp kq kr kn ks kt ke"/></div></div></a></div><p id="6321" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">一如既往，祝你黑客生涯愉快！！！😄</strong></p></div></div>    
</body>
</html>