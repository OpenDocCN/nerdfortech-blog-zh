<html>
<head>
<title>Use a Swift command-line tool in a GitHub workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 GitHub 工作流程中使用 Swift 命令行工具</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/use-a-swift-command-line-tool-in-a-github-workflow-69d0331886b1?source=collection_archive---------7-----------------------#2022-01-19">https://medium.com/nerd-for-tech/use-a-swift-command-line-tool-in-a-github-workflow-69d0331886b1?source=collection_archive---------7-----------------------#2022-01-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/63c610bb8bcbeb4592ec9f5fc0708c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ozKmsp9fAGtirlfE"/></div></div></figure><p id="c6d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这篇博文是为你写的，如果</p><ul class=""><li id="700e" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">您正在为 CI/CD 使用 GitHub 操作和工作流</li><li id="215b" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">你不知道如何在 GitHub 工作流<em class="kc">或</em>中使用 Swift 命令行工具</li><li id="e174" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">您想知道您的工作流(执行 Swift 命令行工具)是否可以在性能或可维护性方面得到改进</li></ul><p id="4779" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的例子:我想使用<a class="ae kd" href="https://github.com/nicklockwood/SwiftFormat" rel="noopener ugc nofollow" target="_blank"> Swiftformat </a>，一个命令行工具来重新格式化我当前的 GitHub 存储库中的 Swift 代码。</p><h1 id="e3eb" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">简单溶体</h1><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="7be3" class="ll kf hi lh b fi lm ln l lo lp">name: Execute a Swift package command-line tool</span><span id="0548" class="ll kf hi lh b fi lq ln l lo lp">on:<br/>  push:<br/>    branches: [ main ]</span><span id="1927" class="ll kf hi lh b fi lq ln l lo lp">jobs:<br/>  swiftformat:</span><span id="4824" class="ll kf hi lh b fi lq ln l lo lp">runs-on: macos-latest</span><span id="df24" class="ll kf hi lh b fi lq ln l lo lp">steps:<br/>    - uses: actions/checkout@v2<br/>    - run: |<br/>          brew install mint<br/>          mint run nicklockwood/SwiftFormat@0.49.1 --verbose .</span></pre><p id="ec48" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该工作流程将</p><ol class=""><li id="ac93" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn lr ju jv jw bi translated">安装<a class="ae kd" href="https://github.com/yonaskolb/Mint" rel="noopener ugc nofollow" target="_blank"> Mint </a>，一个安装并运行 Swift 命令行工具包的包管理器</li><li id="39d9" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn lr ju jv jw bi translated">使用 Mint 下载、从源代码构建，然后运行 Swift 包的可执行文件</li></ol><p id="1b89" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种工作流程的简单性有几个缺点:</p><ul class=""><li id="f105" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">每次执行工作流时，Swift 包都是从源代码构建的</li><li id="d33c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">当更改要使用的命令行工具的版本时，我必须更改工作流代码，例如，在将来的某个时候，我想使用版本 0.50.0</li></ul><p id="0f86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将一步一步地解释如何改进上面的工作流程。你可以在这篇博文的末尾复制完整的和改进的工作流程。</p><h1 id="7578" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">逐步的改进</h1><p id="1424" class="pw-post-body-paragraph iq ir hi is b it ls iv iw ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn hb bi translated">首先，在您的存储库的根目录下创建一个<code class="du lx ly lz lh b">Mintfile</code>。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="bf4a" class="ll kf hi lh b fi lm ln l lo lp">nicklockwood/SwiftFormat@0.49.1</span></pre><blockquote class="ma mb mc"><p id="87eb" class="iq ir kc is b it iu iv iw ix iy iz ja md jc jd je me jg jh ji mf jk jl jm jn hb bi translated">Mintfile 可以指定一个版本化包列表。它使安装和运行这些软件包变得容易，因为具体的 repos 和版本是集中的。</p></blockquote><p id="beed" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后修改您的工作流程，利用 GitHub action <a class="ae kd" href="https://github.com/actions/cache" rel="noopener ugc nofollow" target="_blank"> cache </a>来缓存 Mint 安装和构建的 Swift 包。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="eb03" class="ll kf hi lh b fi lm ln l lo lp">- name: Cache/Restore Mint packages<br/>      id: mint-cache<br/>      uses: actions/cache@v2<br/>      with:<br/>          path: ${{ github.workspace }}/mint<br/>          key: ${{ runner.os }}-mint-${{ hashFiles('**/Mintfile') }}<br/>          restore-keys: ${{ runner.os }}-mint-</span></pre><p id="dacd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了可读性更好，我们把 Mint 的安装分开。如果 Mint 已经安装，让我们升级。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="afa7" class="ll kf hi lh b fi lm ln l lo lp">- name: Install package manager "Mint" to install and run Swift command line tool packages<br/>  run: |<br/>    brew upgrade mint || brew install mint || true</span></pre><p id="0cc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在重要的部分来了:如果没有缓存版本，只安装和构建 Swift 包。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="80a8" class="ll kf hi lh b fi lm ln l lo lp">- name: Install command line tool (if not yet cached)<br/>  if: steps.mint-cache.outputs.cache-hit != 'true'<br/>  run: mint bootstrap</span></pre><p id="3ddd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过<code class="du lx ly lz lh b">mint bootstrap</code>，包管理器将找到在<code class="du lx ly lz lh b">Mintfile</code>中声明的版本并安装该版本。</p><p id="b189" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后一步，让我们运行命令行工具。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="0150" class="ll kf hi lh b fi lm ln l lo lp">- name: Run command line tool<br/>  run: mint run swiftformat --verbose .</span></pre><p id="41ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Mint 将在已安装的包中搜索最新的标签，并在抛弃该版本时运行该版本。</p><p id="85c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">整个改进的工作流程:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="5fcd" class="ll kf hi lh b fi lm ln l lo lp">name: Execute Swift package command-line tool</span><span id="b153" class="ll kf hi lh b fi lq ln l lo lp">on:<br/>  push:<br/>    branches: [ main ]</span><span id="7b17" class="ll kf hi lh b fi lq ln l lo lp">jobs:<br/>  swiftformat:</span><span id="4a66" class="ll kf hi lh b fi lq ln l lo lp">runs-on: macos-latest</span><span id="6bf1" class="ll kf hi lh b fi lq ln l lo lp">steps:<br/>    - uses: actions/checkout@v2<br/>    - name: Cache/Restore Mint packages<br/>      id: mint-cache<br/>      uses: actions/cache@v2<br/>      with:<br/>          path: ${{ github.workspace }}/mint<br/>          key: ${{ runner.os }}-mint-${{ hashFiles('**/Mintfile') }}<br/>          restore-keys: ${{ runner.os }}-mint-<br/>    - name: Install package manager "Mint" to install and run Swift command line tool packages<br/>      run: |<br/>          brew upgrade mint || brew install mint || true<br/>    - name: Install command line tool (if not yet cached)<br/>      if: steps.mint-cache.outputs.cache-hit != 'true'<br/>      run: mint bootstrap<br/>    - name: Run command line tool<br/>      run: mint run swiftformat --verbose .</span></pre><p id="f179" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">步骤“安装命令行工具(如果尚未缓存)”将仅在第一次运行工作流时执行。后续工作流运行将跳过该步骤，因为上一步“缓存/恢复新包”将从第一次工作流运行中恢复缓存。</p></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><p id="b16b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kc">最初发布于</em><a class="ae kd" href="https://blog.eidinger.info/use-a-swift-command-line-tool-in-a-github-workflow" rel="noopener ugc nofollow" target="_blank"><em class="kc">https://blog . ei dinger . info</em></a><em class="kc">。</em></p></div></div>    
</body>
</html>