<html>
<head>
<title>JavaScript Promises. Part 2 — Fundamentals</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript承诺。第2部分—基础知识</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/javascript-promises-part-2-fundamentals-e51e36c42fac?source=collection_archive---------8-----------------------#2021-03-31">https://medium.com/nerd-for-tech/javascript-promises-part-2-fundamentals-e51e36c42fac?source=collection_archive---------8-----------------------#2021-03-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/b7456b95f9a2a16e3f9e4f3f484fa9f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_WSE_FQrGvNyEZEp7-PQow.png"/></div></figure><p id="71bd" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在本系列的<a class="ae jk" rel="noopener" href="/nerd-for-tech/javascript-promises-part-1-why-promises-d54ed05bdc9f">第1部分</a>中，我们已经理解了为什么要引入承诺。我们知道Promise API是作为处理异步JS的更好范例而引入的。在这里，我们将通过一个简单的例子来理解什么是承诺以及如何做出承诺，稍后，我们将看一个更实际的例子。</p><p id="2888" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么什么是承诺呢？</p><p id="70db" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">想象一下，一天早上上班时，你的同事打电话给你，让你帮个忙。他需要你去办公室停车场看看是否有空位。由于停车位有限，如果没有停车位，他不必浪费时间，可以把车停在别的地方。</p><p id="2646" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你<strong class="io hj">答应</strong>你会这么做。</p><p id="d4f4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">你去停车场找一个空位。</p><p id="470d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可能会出现哪些不同的情况？</p><p id="a2b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">要么有空位，要么没有。你打电话给你的同事，让他知道。</p><p id="04ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">无论如何，你的承诺已经<strong class="io hj">兑现</strong>。</p><p id="7244" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有没有另一种情况？想象一下，当你在去停车场的路上，电梯坏了。你的办公室在大楼的顶层。如果你像我一样，那么你下楼梯没有问题，但是上来……那完全是另一回事。所以你打电话给你的同事，让他知道你实际上无法找到一个开放的停车位，因为电梯坏了。</p><p id="4776" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，你对同事的承诺<strong class="io hj">落空了</strong>。</p><p id="7516" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">虽然很粗糙，但这就是承诺的本质。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="c4fe" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们使用上面的例子进入技术层面。</p><p id="c4d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">根据MDN:</p><blockquote class="js jt ju"><p id="ab5f" class="im in jv io b ip iq ir is it iu iv iw jw iy iz ja jx jc jd je jy jg jh ji jj hb bi translated">Promise对象表示异步操作的最终完成(或失败)及其结果值。</p></blockquote><p id="4c77" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们已经谈到了异步函数。并且您知道一个异步函数将被排队并最终被执行(完成)。一旦你的异步函数完成，它将返回一个结果，如果有的话。这就是许诺对象所代表的。</p><p id="0aed" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的例子中，这意味着什么？</p><p id="60d5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里的<em class="jv">承诺</em>对象是指你对同事做出的实际承诺，让他去查一个空车位。</p><p id="6868" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您去停车场、检查开放空间、回叫您的同事让他知道停车位的可用性的任务可以被认为是异步操作。根据空间的可用性，结果值可以是真/假。</p><p id="766d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它在代码中会是什么样子？让我们来看看</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es jz"><img src="../Images/0f6ebf0c65ad6f8554f7897a82527705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qnKTkLuq3xWrB3huaOur3w.png"/></div></div></figure><p id="1ec9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们来分解一下</p><p id="1b17" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可以使用<code class="du ki kj kk kl b">new</code>关键字创建一个<code class="du ki kj kk kl b">Promise</code>对象。</p><p id="9244" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">传递给构造函数的函数叫做<strong class="io hj">执行器</strong>。<br/>创建新承诺时，执行程序会自动运行。它包含最终应该产生结果的代码。在我们的例子中，去停车场找一个空地。</p><p id="bb11" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们将<strong class="io hj">执行器</strong>包装在一个<code class="du ki kj kk kl b">setTimout </code>函数中，以便异步执行。</p><p id="5c4c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">执行器</strong>有两个参数<strong class="io hj">分别是解决</strong>和拒绝<strong class="io hj">的。它们是回调函数，一旦我们的executor函数有了结果，它们就会被执行。根据我们的例子:一旦你明白一个位置是否可用。</strong></p><p id="9f43" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">根据停车位的可用性，您可以呼叫<code class="du ki kj kk kl b">resolve(true)</code>或<code class="du ki kj kk kl b">resolve(false)</code>。这意味着，你去了停车场，带着结果回来了。你已经实现了你的承诺。</p><p id="93b3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是正如我们已经讨论过的，还有第三种选择，你的承诺可能会落空。让我们来看一下代码</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es km"><img src="../Images/da57f5b97aa1863b69f7320669f3a31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xsuS0RsfWycwSdzdS2LnYQ.png"/></div></div></figure><p id="39ac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这种情况下，您没有返回结果。相反，您会抛出一个错误。所以，你的承诺被<strong class="io hj">拒绝了。</strong></p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="d70d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">调用<code class="du ki kj kk kl b">new Promise</code>构造函数返回的<code class="du ki kj kk kl b">promise </code>对象有两个内部属性:</p><ol class=""><li id="ecf7" class="kn ko hi io b ip iq it iu ix kp jb kq jf kr jj ks kt ku kv bi translated"><strong class="io hj">状态:</strong>初始状态为<strong class="io hj">待定</strong>。基于哪个回调被调用，或者<strong class="io hj">解决</strong> / <strong class="io hj">拒绝</strong>，状态将分别变为<strong class="io hj">完成/拒绝</strong>。</li><li id="8d58" class="kn ko hi io b ip kw it kx ix ky jb kz jf la jj ks kt ku kv bi translated"><strong class="io hj">结果</strong>:传递给回调的值。在我们的例子中，对/错。</li></ol><blockquote class="js jt ju"><p id="c94a" class="im in jv io b ip iq ir is it iu iv iw jw iy iz ja jx jc jd je jy jg jh ji jj hb bi translated">需要注意的是，承诺只能解决或拒绝</p><p id="ea0f" class="im in jv io b ip iq ir is it iu iv iw jw iy iz ja jx jc jd je jy jg jh ji jj hb bi translated">此外，任何状态更改都是最终的，所有进一步的resolve和reject调用都将被忽略。</p></blockquote><p id="13ea" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这意味着，如果我们在上面的例子中省略return语句，执行器将执行到最后一条语句，(即resolve(true)或resolve(false))。但不管怎样，承诺的<strong class="io hj">状态</strong>仍将是<strong class="io hj">拒绝</strong>并且<strong class="io hj">结果</strong>将是<strong class="io hj">错误对象</strong>被创建。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="191a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">好了，我们已经学会了创造承诺。我们知道promise对象表示我们的异步操作最终完成所返回的值(从上面复制粘贴；) ).但是这种价值如何被消费呢？</p><p id="b43a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在我们的例子中，消费者是我们的同事，他要求我们执行整个任务。一旦承诺被兑现<strong class="io hj">/<strong class="io hj">被拒绝</strong>，他将如何消费？</strong></p><p id="aa04" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了创建一个消费者，我们使用了<code class="du ki kj kk kl b">then/catch/finally</code>方法。</p><p id="31a2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du ki kj kk kl b">then</code>的语法如下:</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lb"><img src="../Images/0ca6068ba749f144ff821cd73bd9981c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I07t786W23VTIF7XId1IhA.png"/></div></div></figure><p id="3d3c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du ki kj kk kl b">then</code>方法有2个参数。两者都是功能。</p><p id="4f56" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">第一个函数在承诺完成时运行。<br/>第二个函数在承诺被拒绝时运行。<br/> <code class="du ki kj kk kl b">result/error </code>将是承诺返回的值。</p><p id="7bc1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><code class="du ki kj kk kl b">catch</code>方法只有一个参数，如果承诺被拒绝，将执行该方法。</p><p id="de17" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">迷惑？我们来看看我们的消费函数会怎么写。</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es lc"><img src="../Images/e08254c37fad7fb82084a13ac6811a28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUkB7doz4PsBb_VNPqJFeQ.png"/></div></div></figure><p id="ae93" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">正如我们所看到的，我们已经将方法<code class="du ki kj kk kl b">then</code>和<code class="du ki kj kk kl b">catch</code>应用于<code class="du ki kj kk kl b">promise</code>对象(之前的例子)。</p><p id="d4b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一旦<strong class="io hj">执行器</strong>完成并且<strong class="io hj">解析</strong> / <strong class="io hj">拒绝</strong>并给出一个值，基于调用的回调，将执行<code class="du ki kj kk kl b">then</code>或<code class="du ki kj kk kl b">catch</code>。</p><p id="0c11" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们可以检查停车位，<strong class="io hj">承诺</strong>将<strong class="io hj">解决</strong>对/错。在这种情况下，将执行<strong class="io hj">中的第一个功能，然后执行</strong>方法。</p><p id="ac37" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果电梯坏了，<strong class="io hj">承诺</strong>将被<strong class="io hj">拒绝</strong>并返回一个错误对象。在这种情况下，将执行<strong class="io hj"> catch </strong>方法中的函数。</p><p id="4b10" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您也可以完全省略catch块，然后使用<strong class="io hj">和</strong>方法本身来处理这两种情况。看起来像这样</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es ld"><img src="../Images/b8d14ce8f2e7e34ee1b36a0d3e550ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aTwME1Jj3qwy46SkgfSjvw.png"/></div></div></figure><p id="cff5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">是使用<code class="du ki kj kk kl b">catch </code>块，还是在<code class="du ki kj kk kl b">then</code>块中处理错误，取决于我们的需求和承诺是否链接在一起。我们将在下一节深入探讨承诺链。现在，只要记住有可能处理<code class="du ki kj kk kl b">then</code>块本身的错误。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="9b4f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，让我们以一个实际的例子来结束</p><figure class="ka kb kc kd fd ij er es paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="er es le"><img src="../Images/adec9bcf283d84b6b1e8ac5ee0cc12a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7734P9L90nZw71oy0HkwMw.png"/></div></div></figure><p id="6cef" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">获取API </strong>允许我们发出网络请求。来自<strong class="io hj"> fetch() </strong>的响应将是一个<strong class="io hj">承诺</strong>，其中<strong class="io hj">值</strong>是从服务器发送的响应。</p><p id="8e74" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果我们从服务器得到一个有效的响应，那么<strong class="io hj">中的函数将被执行</strong>方法，如果服务器以一个错误响应，那么<strong class="io hj"> catch </strong>方法中的函数将被执行。</p></div><div class="ab cl jl jm gp jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="hb hc hd he hf"><p id="b04b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">Promise是一个强大的API，我希望你对它有一个基本的了解。有很多内容要介绍，比如<strong class="io hj"> Promise chaining </strong>和不同的方法，比如<strong class="io hj"> Promise.all() </strong>、<strong class="io hj"> Promise.any() </strong>，我们将在接下来的部分中看到。</p><p id="73c4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" rel="noopener" href="/nerd-for-tech/javascript-promises-part-3-promise-chaining-707ab6f1bbfc">点击此处</a>进入下一部分，我们将了解<strong class="io hj">承诺链。</strong></p><p id="3dce" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果你觉得这篇文章很有帮助，请鼓掌并分享给你的朋友。请务必跟随我，因为我<strong class="io hj">承诺</strong>提供更简单的解释；)</p></div></div>    
</body>
</html>