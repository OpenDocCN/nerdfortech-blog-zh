<html>
<head>
<title>Working with Windows Registry using C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用C#使用Windows注册表</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/working-with-windows-registry-using-c-ae0f78e29e37?source=collection_archive---------20-----------------------#2021-05-03">https://medium.com/nerd-for-tech/working-with-windows-registry-using-c-ae0f78e29e37?source=collection_archive---------20-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0e0bb60f9b56bf0ffe7b853b037953b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cojzODCgtJxQoYBlBpChQg.png"/></div></div></figure><p id="184e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们每个人都会安装一个试用版的软件，如杀毒软件、游戏、授权工具等。在我们生命中的某个时刻。但是在做的时候，你有没有注意到试用期结束后，软件会神奇地停止为你工作。甚至当你再次尝试卸载并安装该软件时，它也会发出同样的过期信息。你一定想知道这怎么可能。这个问题的答案是Windows注册表。</p><p id="b199" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">安装后，该软件会借助Windows注册表在注册表中提供所有必要的信息。出于安全或许可目的等多种原因，该信息随后由软件在运行时使用。在这篇文章中，我们将解释什么是Windows注册表以及如何通过程序访问它。</p><p id="b2ab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="47d9" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated"><strong class="is hj">什么是Windows注册表？</strong></li><li id="fcf8" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何访问Windows注册表？</li><li id="4212" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">注册表编辑器中有什么？</li><li id="fe5d" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">如何以编程方式访问Windows注册表？</li><li id="6a81" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">包扎</li></ol><h1 id="6296" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是Windows注册表？</h1><p id="5ae5" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">Windows注册表是设置的分层数据库。它存储安装在系统上的硬件和软件所使用的信息、设置、选项和其他值。</p><p id="578d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在Windows的最初版本中，对存储程序配置和设置的配置文件有很大的依赖性。但是，在Windows注册表中，应用程序的详细信息存储为子项。</p><h1 id="06d3" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何访问Windows注册表？</h1><p id="35a4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">注册表编辑器是一个免费的注册表编辑工具，它与从微软Windows 95到最新的Windows 10的所有已知Windows版本打包在一起。它是一个预加载的工具(无需安装)，可以通过从运行(win+r)窗口执行命令<strong class="is hj"> regedit </strong>来访问。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/17a58b198f84020581e9405c0dbb8e56.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/0*_Tymi8islXl4hGS9"/></div></figure><p id="1d65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注册表编辑器充当注册表的界面，它是一种用户友好的方式来查看和编辑注册表信息。</p><h1 id="9e4d" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">注册表编辑器中有什么？</h1><p id="1014" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">注册表编辑器显示Windows注册表中存在的所有项和值。</p><p id="2c38" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在打开Windows注册表编辑器时，它会显示包含所有注册表值的根键。有5个常见的根密钥，让我们快速浏览一下-</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/5921997e5bf2ac23ec1d30e236f7315f.png" data-original-src="https://miro.medium.com/v2/resize:fit:432/0*opQmwyAaHNyfkEHm"/></div></figure><h2 id="b1ae" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">HKEY类根</h2><p id="d8cf" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">它也被称为HKCR，当用户请求查看驱动器的内容或打开某一类型的文件等时，它包含有助于Windows的信息。</p><p id="e164" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它包含的信息依次包含文件扩展名相关信息和OLE(对象链接嵌入)信息。</p><h2 id="cae6" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">HKEY当前用户</h2><p id="d98f" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">它也被称为HKCU，是Windows注册表的主要部分。它包含特定于当前登录的Windows用户的Windows和已安装软件的配置信息。</p><p id="60c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">受当前用户控制的设置，如桌面墙纸、环境变量、映射的网络驱动器、显示设置、安装的打印机都存储在此注册表配置单元中。</p><h2 id="a8ec" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">HKEY本地机器</h2><p id="b77d" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">它也被称为HKLM。它保存软件和Windows操作系统的主要配置信息。它还包含有关当前检测到的硬件和设备驱动程序的信息。</p><p id="71d8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从Windows Vista到最新版本的Windows，即Windows 10，有关计算机启动配置的信息都存储在HKLM中。</p><h2 id="af65" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">HKEY用户</h2><p id="bba2" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">它也被称为HKU。它保存所有活动用户的特定于用户的配置信息。这里的活动用户是指当前已经登录的用户，也包括其他已经登录的用户和切换用户。</p><p id="6f06" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用户的详细信息存储在HKEY用户根目录下每个用户的安全标识符下。用户的注册表项和值存储在相应的安全标识符下。一旦用户第一次登录，映射的网络驱动器、环境变量、安装的打印机等详细信息就存储在该注册表中。</p><h2 id="0980" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">HKEY当前配置</h2><p id="70d7" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">它也被称为HKCC。与其他注册表不同，它不包含任何特定的键和值。相反，它作为一个快捷方式来访问与保存当前用户的硬件配置文件信息相关的键和值。</p><p id="66cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它充当\ SYSTEM \ Current control set \ Hardware Profiles \ Current \ registry项的引用。HKCC的存在是为了方便，它使编辑其他注册表中的详细信息变得更容易。</p><h1 id="766f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何使用C#以编程方式访问Windows注册表？</h1><p id="79fc" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">到目前为止，我们已经了解了如何访问Windows注册表以及它包含的所有内容。让我们考虑一个场景，我们将运行一个应用程序的试用版本，这意味着几天后该应用程序将到期。</p><p id="93a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">背后的想法是以编程方式为应用程序创建一个注册表，它将保存应用程序的首次使用日期，每当用户使用应用程序时，它将使用注册表值验证应用程序是否已过期。</p><h2 id="5e4a" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">第一步</h2><p id="4b5d" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">为了实现这一点，我们将使用。net框架和C#作为编程语言。以管理员权限打开visual studio，因为此解决方案将改变Windows注册表中的内容。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/8c56235e13c6b4343897844b6a02c64d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*bfOz3oSU0L4zLyGw"/></div></figure><h2 id="a3e1" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">第二步</h2><p id="4575" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建应用程序后，下一步是打开program.cs文件，并编写代码来创建注册表(如果注册表不存在的话)。如果注册表项已经存在，则打印注册表中存在的值。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/2bc25bae834b4573001207ce510fe8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*FCkG9ykOPEqrp0xe"/></div></figure><p id="c515" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我们将使用HKEY_LOCAL_MACHINE Windows注册表。并且将在HKLM下的软件子密钥下工作。在“software”子项下，我们的想法是创建一个子项—“PARTECHApplication ”,它将保存一个子项—“Configuration”及其值。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/67180478197f56b503f73b17f3a5caf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*Kf3iy1bjbXuU-IiK"/></div></figure><h2 id="ea40" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">第三步</h2><p id="bf77" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">创建代码后，当我们第一次运行它时，子项将不存在。因此，代码将创建步骤2中提到的子项，并将其保存在注册表中。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/e68945361a2ada843700b94540cbd789.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*5ask0cbCATLuLK2y"/></div></figure><h2 id="a95b" class="ll kd hi bd ke lm ln lo ki lp lq lr km jb ls lt kq jf lu lv ku jj lw lx ky ly bi translated">第四步</h2><p id="98b3" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">当相同的代码再次运行时，它将返回文本“Registry always created with value ”,后跟它的值。然后，它将验证添加了30天的注册表起息日是否仍然小于当前日期的值。这样，可以通过C#应用程序来完成试验的验证。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/df83d7464a93c403f121f5c2422728d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*okSMf2G5cW5dKnhG"/></div></figure><h1 id="d915" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">包扎</h1><p id="fc70" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">Windows注册表是软件、硬件和用户的设置、配置的数据库。这是检索应用程序的存储配置的最安全的方式之一，它充当存储和使用应用程序的基本设置和配置的单一位置。所以，现在就开始尝试访问Windows注册表吧。</p></div><div class="ab cl mb mc gp md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="hb hc hd he hf"><p id="153d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mi">原载于</em><a class="ae mj" href="https://www.partech.nl/nl/publicaties/2020/09/working-with-windows-registry" rel="noopener ugc nofollow" target="_blank"><em class="mi">https://www . partech . nl</em></a><em class="mi">。</em></p></div></div>    
</body>
</html>