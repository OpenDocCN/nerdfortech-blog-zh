<html>
<head>
<title>MICE and KNN missing value imputations Explanation and Implementation with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MICE和KNN缺失值插补的解释及Python实现</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/mice-and-knn-missing-value-imputations-explanation-and-implementation-with-python-d11c53f3f4b2?source=collection_archive---------0-----------------------#2020-11-06">https://medium.com/nerd-for-tech/mice-and-knn-missing-value-imputations-explanation-and-implementation-with-python-d11c53f3f4b2?source=collection_archive---------0-----------------------#2020-11-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="71f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继续我的<a class="ae jd" rel="noopener" href="/the-innovation/feature-engineering-handling-missing-numeric-data-with-python-7be1e871f85e">博客</a>关于缺失值和如何处理它们。我在这里要谈的是另外两种非常有效的处理缺失数据的技术，通过:</p><ol class=""><li id="f723" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">链式方程的MICE或多重插补</li><li id="280f" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">KNN或K-最近邻插补</li></ol><p id="1ec0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先我们将讨论通过链式方程的<strong class="ih hj">多重插补。</strong></p><p id="c25c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">链式方程的多重插补假设数据为<a class="ae jd" rel="noopener" href="/the-innovation/feature-engineering-handling-missing-numeric-data-with-python-7be1e871f85e"> MAR </a>，即随机缺失。</p><p id="ba01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有时数据集中缺失的数据与其他要素相关，可以使用其他要素值进行预测。</p><p id="d68e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它不能用均值、众数或中位数的一般方法来估算。</p><p id="7169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，如果缺少一个人的体重值，他/她可能有或可能没有糖尿病，但填写该值需要使用其他特征(如身高、身体质量指数、超重)进行评估，以预测正确的值集。</p><p id="061b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，应用线性回归，步骤如下:</p><p id="4ef9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第一步:</strong></p><p id="1f05" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面的数据中，我们从数据集中删除一些数据，并使用单变量插补中使用的简单插补器用平均值对其进行插补。</p><p id="fe7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们清楚地看到一个问题，超重2级，身高173.8厘米，身体质量指数25.7的人不可能有67.82公斤的体重。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es js"><img src="../Images/7f0a18ab61c8fea0ccc4a7fa37ed855f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3T7spDLtVaRhd4CkDu2MxA.jpeg"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="c127" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第二步:</strong></p><p id="dedd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重量值被删除，其余值保持不变。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es ki"><img src="../Images/b3fd79b720be2426f49a8a8e5a9ae782.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*eTa9qYVn4W16sQJdjLcgew.jpeg"/></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="4cc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第三步:</strong></p><p id="949e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，以权重作为目标特征，在灰色细胞上训练线性回归。</p><p id="045d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，白细胞被视为测试数据，并预测值。假设值“a”代表重量。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kj"><img src="../Images/b3ae107d55994dc3201f180062a35016.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*AoJRd3L6U98gkFg1j4RJ8A.jpeg"/></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="d12a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第四步:</strong></p><p id="97a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在重量特征中加入“a”值，并在高度特征中移除值。</p><p id="eda9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，以高度作为目标特征，在灰色细胞上训练线性回归。</p><p id="0914" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将白细胞作为测试数据，并预测高度值。假设b值代表高度。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kk"><img src="../Images/53def94d439d063037f49c5832298881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yu-OHKf-4NSxTVLKrNHquQ.jpeg"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="c1c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第五步:</strong></p><p id="8fbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将在高度特征中放置“b”值，并在身体质量指数特征中移除值。</p><p id="42ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后用身体质量指数作为目标特征在灰色细胞上训练线性回归。</p><p id="9418" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后将白细胞作为测试数据，并预测身体质量指数值。假设身体质量指数的值为c。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kl"><img src="../Images/ef629b01cac43a8fa27e19a17a13bfa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4kojuksSkCFHdPUib6w4g.jpeg"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="b684" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">第六步:</strong></p><p id="bded" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们在步骤5和步骤1中减去基值。</p><p id="3dc1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了我们估算的体重为(a-67.82)，身高为(b-165.13)，在身体质量指数为(c-25.81)之外，所有的值都是0。</p><p id="63a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">目标是在每次迭代中使这些值接近于零。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="jy jz di ka bf kb"><div class="er es kl"><img src="../Images/acd04874e5a4bccc6ebb8e75c28f1c2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVTMnpPvWdBOaJ5xznmNdA.jpeg"/></div></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="0042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于下一次迭代，步骤5的值保留在步骤1中，并且从步骤2到6重复步骤。</p><p id="fc40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Python中，它是这样完成的:</p><p id="70bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一种复杂的方法是使用迭代插补器类，该类将每个具有缺失值的特征建模为其他特征的函数，并使用该估计值进行插补。这是以迭代的方式完成的，在每一步，一个特征列被指定为输出y，其他特征列被视为输入X。对于已知的y，回归器被拟合在(X，y)上。然后，回归器被用于预测y的缺失值。这是以迭代的方式为每个特征完成的，然后在max_iter插补回合中重复。</p><pre class="jt ju jv jw fd km kn ko kp aw kq bi"><span id="e3c7" class="kr ks hi kn b fi kt ku l kv kw">import numpy as np<br/>from sklearn.experimental import enable_iterative_imputer<br/>from sklearn.impute import IterativeImputer<br/>from sklearn.linear_model import LinearRegression<br/><br/>lr = LinearRegression()<br/>imp = IterativeImputer(estimator=lr,missing_values=np.nan, max_iter=10, verbose=2, imputation_order='roman',random_state=0)<br/>X=imp.fit_transform(X)</span></pre><p id="2297" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> KNN或K-最近邻插补</strong></p><p id="1130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">k-最近邻是机器学习中最简单和最容易的插补技术之一。它处理相邻坐标X和y之间的欧几里德距离，以了解数据的相似程度。</p><p id="3daa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面给出一个非常简单的例子来解释这种插补:</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es ki"><img src="../Images/31a36b1799126d914dddc2c8b877768c.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*9z7DjYL5V3lg1JWgDXgqKw.jpeg"/></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="155a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设我们需要预测数据集中缺失的第3行的权重。</p><p id="f962" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有其他行都有数据，也有一些缺少的列。</p><p id="74d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要找出重量，必须采取以下步骤:</p><p id="21f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1)选择缺失值来填写数据。</p><p id="ac87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2)选择一行中的值</p><p id="bc3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3)选择你想合作的邻居数量(最好是2-5个)</p><p id="bffb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4)从该行中彼此对应的所有其他数据点计算欧几里德距离。</p><p id="ebaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5)选择最小的2并平均。</p><p id="0f50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">欧几里德距离的计算是:</p><p id="f2d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">距离</strong> = sqrt(重量*距离当前坐标的距离)</p><p id="ed21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">权重</strong> =预测一个特征的特征总数除以有价值的特征数。</p><p id="af0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">坐标距离计算为以下值的平方:</p><p id="11c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">对于高度</strong>= 164.7–154.9，164.7–157.8，164.7–169.9，164.7–154.9</p><p id="7a38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于身体质量指数来说,= 24.2156250664228，空白，24.21757575866</p><p id="bfcd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">空白表示第2行中缺少身体质量指数值。</p><p id="5465" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">表示超重</strong>= 1–2，1–2，1–1，空白</p><p id="a8b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于上述值，其计算如下:(带权重的值的平方)</p><p id="37b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于第2行和第5行，因为1个特征缺少值，所以每个权重为3/2，其余权重为3/3。</p><p id="f993" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据公式计算距离。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kx"><img src="../Images/3cb087831ba2c23c90245fa2dab02638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*VlgZ6xXgGUsudmP6kXPlmA.jpeg"/></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="a5b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们选择2个最接近的值，即上述情况中的8.5390280477347和5.37299404429225。这些行的权重分别为64.9和67.5。</p><p id="7b6f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，对于缺失值，权重将是这两个值的平均值。</p><p id="41b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">体重</strong>=(64.9+67.5)/2 = 132.4/2 = 66.2kg。</p><p id="8b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于其余的缺失特征值，采用类似的方法。</p><p id="48f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Python中，KNNImputer类使用k-最近邻方法提供填充缺失值的插补。默认情况下，nan_euclidean_distances用于查找最近邻，这是一种支持缺失值的欧氏距离度量。使用来自n_neighbors最近邻的值对每个缺失要素进行估算，其中n _ neighbors最近邻具有要考虑的最近邻值。对相邻要素进行均匀平均或根据到每个相邻要素的距离进行加权。如果样本缺少多个要素，则该样本的相邻要素可能会有所不同，具体取决于要估算的特定要素。对于插补期间使用的训练集，没有定义距离。如果至少有一个邻居具有规定的距离，则在插补期间将使用其余邻居的加权或未加权平均值。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kx"><img src="../Images/2458ab62ed135a748c261645cf2f36e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*yO5Af_qWjicGvZqHKvoNmA.jpeg"/></div><figcaption class="ke kf et er es kg kh bd b be z dx translated">作者图片</figcaption></figure><p id="5c83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论:</strong></p><p id="bc29" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">MICE和KNN插补都是根据数据及其与其他特征的关系的逻辑推理来计算的。</p><p id="f6d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它远远高于其他插补方法，如均值、中值、众数、简单插补或随机值插补。但是，它用于标记缺失变量的类别。</p><p id="eb82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望看完这篇博客后，老鼠和KNN的归罪一定很容易理解。</p><p id="53af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">【参考文献:】【https://scikit-learn.org/stable/modules/impute.html】T2</p></div><div class="ab cl ky kz gp la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hb hc hd he hf"><p id="5bbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="lf">原载于2020年11月6日https://www.numpyninja.com</em><em class="lf"/><a class="ae jd" href="https://www.numpyninja.com/post/mice-and-knn-missing-value-imputations-through-python" rel="noopener ugc nofollow" target="_blank"><em class="lf">。</em></a></p></div></div>    
</body>
</html>