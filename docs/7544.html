<html>
<head>
<title>C# Start an Entity Framework Code Project—1(Basics)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开始一个实体框架代码项目—1(基础)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/start-an-entity-framework-code-project-1-basics-5d4a421bf4da?source=collection_archive---------3-----------------------#2022-11-27">https://medium.com/nerd-for-tech/start-an-entity-framework-code-project-1-basics-5d4a421bf4da?source=collection_archive---------3-----------------------#2022-11-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1aa2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像往常一样，这些是我对一些主题的笔记，在这种情况下，我想有几篇关于 EF 的文章(总之看起来会很多)。所以第一个开始了。</p><p id="1ef7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本文，我使用的是安装了<code class="du jd je jf jg b">Microsoft.EntityFrameworkCode</code>和<code class="du jd je jf jg b">Microsoft.EntityFrameworkCode.SqlServer</code>包的 Visual Studio。我的电脑上还安装了 SQL server。</p><h1 id="8188" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">创建项目</h1><p id="e097" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">在 Visual Studio 社区(我用的是最新版本)，去创建新项目，选择<strong class="ih hj">ASP.NET 核心 Web API </strong>。你不需要创建一个 API 来使用 EF，你也可以在一个控制台项目或者任何你想要的东西中使用它。</p><p id="3285" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">采用缺省值，你最终会得到一些你已经需要的文件。</p><h1 id="3cf3" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">一些背景信息</h1><p id="7ef3" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">EF 在. Net 应用程序中用于与数据库通信。当你处理数据库时，我们称之为 CRUD 操作。</p><p id="3f91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建—发布</p><p id="21dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ead —获取</p><p id="50ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新-上传</p><p id="5550" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">删除-删除</p><p id="d258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一个补丁选项，但并不常见。</p><p id="377e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面(右侧)是我们可以从浏览器或一些访问我们的 API 的应用程序获得的请求类型。我们使用代码来传达请求的进展情况。一些最常见的是:</p><ul class=""><li id="f265" class="kk kl hi ih b ii ij im in iq km iu kn iy ko jc kp kq kr ks bi translated">200 好吧</li><li id="3192" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">400 错误请求</li><li id="ce69" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">401 未经授权</li><li id="6062" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">403 禁止</li><li id="63a3" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">404 未找到</li><li id="4e80" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">不可接受</li><li id="a948" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">500 服务器错误</li><li id="26de" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">503 服务不可用</li><li id="b799" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">201 已创建</li><li id="ccc2" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">202 项被接受</li><li id="f014" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">204 无内容</li><li id="cc91" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">不允许 405 方法</li><li id="671a" class="kk kl hi ih b ii kt im ku iq kv iu kw iy kx jc kp kq kr ks bi translated">415 不支持的媒体类型</li></ul><h1 id="e82d" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">SQL Server 中的数据库</h1><p id="8bee" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">一旦安装了 SQL Server，您就可以创建自己的数据库或使用现有的数据库(您可以使用 google“下载 northwind 数据库”并查看会出现什么)。我使用的是 Northwind 数据库，我添加了一个新表，只有 3 列(id、title、language)。表名是 Songs。</p><h1 id="b23b" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">EF —代码优先或数据库优先</h1><p id="6ab1" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">使用 code first，您将从代码中创建 DB 和表。有了 DB，首先您已经有了 DB，然后您的代码需要匹配您的表。根据我的经验，DB 是独立维护的，代码使用它，所以我将使用 DB 优先的方法。</p><p id="5e72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不管采用哪种方法，您都需要一个<strong class="ih hj">实体模型类</strong>来匹配每个表，以及一个<strong class="ih hj">控制器类</strong>用于表和您将要在其上进行的操作。</p><h1 id="83c8" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">确定如何连接到数据库</h1><p id="0e33" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">您将需要一个从<strong class="ih hj"> DbContext </strong>(指数据库)继承的类。这个类大概是这样的(你可以随意命名你的类):</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="cce5" class="lg ji hi jg b be lh li l lj lk">public class APIDbContext : DbContext<br/>{<br/>  public DbSet&lt;Song&gt; Songs { get; set; }<br/><br/>  public APIDbContext(DbContextOptions&lt;APIDbContext&gt; options) : base(options)<br/>  {<br/><br/>  }<br/> }<br/>}</span></pre><p id="f6bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<strong class="ih hj"> DBContext </strong>指的是数据库，那么<strong class="ih hj"> DbSet </strong>指的是表。</p><p id="f027" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你有了数据库，你需要告诉你的应用程序如何连接到它。打开 program.cs 文件，寻找<code class="du jd je jf jg b">var app = builder.Build();</code></p><p id="a23f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之前的某个时候，您可能会希望添加类似这样的内容:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="5558" class="lg ji hi jg b be lh li l lj lk">builder.Services.AddDbContext&lt;APIDbContext&gt;(option =&gt; option.UseSqlServer("Data source= YOUR_SERVER\\YOUR-INSTANCE;" + "Initial Catalog=Northwind;" +<br/>  "Integrated Security=true;" + "MultipleActiveResultSets=true;"));</span></pre><p id="5185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的连接字符串可能不完全相同。如果证书出错，可以尝试将字符串设置为 Encrypt=False。</p><h1 id="c7f7" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">为歌曲表设置模型和控制器</h1><p id="e93b" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">型号应与表格相匹配:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="6d47" class="lg ji hi jg b be lh li l lj lk">public class Song<br/> {<br/>  [Required]  <br/>  public int Id { get; set; }<br/><br/>  [Required]<br/>  [StringLength(100)]<br/>  public string Title { get; set; }<br/><br/>  public string Language { get; set; }<br/> }</span></pre><p id="7282" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">控制器具有以下动作:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="2ce2" class="lg ji hi jg b be lh li l lj lk">[Route("api/[controller]")]//this will determine the url to call the action<br/>[ApiController]<br/>public class SongsController : ControllerBase<br/>{<br/>  private APIDbContext _dbContext;<br/>  public SongsController(APIDbContext dbContext)<br/>  {<br/>   _dbContext = dbContext;<br/>  }  <br/><br/>  [HttpGet] //could just name it Get<br/>  public IEnumerable&lt;Song&gt; GetSongs()<br/>  {<br/>   return _dbContext.Songs;<br/>  }<br/><br/>  [HttpGet("{id}")] <br/>  public Song GetSong(int id)<br/>  {<br/>   return _dbContext.Songs.Find(id);<br/>  }<br/><br/>  //add FromBody to let it know that the data we need to add is coming <br/>  //from the body of the request.<br/>  [HttpPost]<br/>  public void PostSong([FromBody] Song song)<br/>  {<br/>   _dbContext.Songs.Add(song);<br/>   _dbContext.SaveChanges();<br/>  }<br/><br/>  [HttpPut("{Id}")]<br/>  public void PutSong(int id, [FromBody] Song song)<br/>  {<br/>   Song s = _dbContext.Songs.Find(id);<br/>   s.Title = song.Title;<br/>   s.Language= song.Language;<br/>   _dbContext.SaveChanges();<br/>  }<br/><br/>  [HttpDelete("{id}")]<br/>  public void Delete(int id)<br/>  {<br/>   Song s =_dbContext.Songs.Find(id);<br/>   _dbContext.Songs.Remove(s);<br/>   _dbContext.SaveChanges();<br/>  }<br/> }</span></pre><p id="2d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，使用属性来指示操作的类型，我可以随意命名该方法。让我们一次看一个。</p><h1 id="42de" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">运行应用程序并拨打电话</h1><p id="a636" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">当您开始从 Visual Studio 运行应用程序时，您将看到 Swagger 出现。(如果您收到一条关于颁发证书的消息，您可以说“不”,在浏览器上，您只需在出现警告时单击“继续”。</p><p id="a29d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦 Swagger 出现，你可以看看你有什么行动。对于上面的代码，我们将看到:</p><figure class="ky kz la lb fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ll"><img src="../Images/437c0f1705612e35ddd56da4ad68545c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HInDWeYA9gdZm6QqA9MXBA.png"/></div></div></figure><p id="4e33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不会从这里打电话，而是从邮递员那里。没有的话可以从 postman.com<a class="ae lt" href="http://postman.com" rel="noopener ugc nofollow" target="_blank">安装</a></p><p id="2683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:在 postman 中，没有证书你不能只说继续，但是你可以点击设置和:</p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es lu"><img src="../Images/5dc623efa6b7e022fd0226be5cf233f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:764/format:webp/1*_90_SlUvEmtBbzti-pxuUA.png"/></div></figure><p id="1304" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们调用 get 从数据库中获取歌曲:</strong></p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="d184" class="lg ji hi jg b be lh li l lj lk">[HttpGet] //could just name it Get<br/>  public IEnumerable&lt;Song&gt; GetSongs()<br/>  {<br/>   return _dbContext.Songs;<br/>  }</span></pre><p id="44c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在大摇大摆中我们看到我们将称之为:</p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es lv"><img src="../Images/fb4577bf583578a0bcd27f9cdff852d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*6DdXHKLzi-YPzPKul0DlPg.png"/></div></figure><p id="0e30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以关于邮递员:</p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es lw"><img src="../Images/cdbcdce7ca13a5e0f0f266a1d238d4e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/format:webp/1*kgyolVLQaEbBDWP1AEHRtw.png"/></div></figure><p id="20b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们会回来的(状态 200OK):</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="2003" class="lg ji hi jg b be lh li l lj lk">[<br/>    {<br/>        "id": 1,<br/>        "title": "Title1",<br/>        "language": "Frend"<br/>    },<br/>    {<br/>        "id": 2,<br/>        "title": "Title2",<br/>        "language": "German"<br/>    },<br/>    {<br/>        "id": 3,<br/>        "title": "Title3",<br/>        "language": "Spanish"<br/>    },<br/>    {<br/>        "id": 4,<br/>        "title": "Title4",<br/>        "language": "English"<br/>    }<br/>]</span></pre><p id="1cc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从数据库中调用 1 首歌曲。</p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es lx"><img src="../Images/de2b8b1dd06689486bf864753f5901f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*Qq60O0NJDTFaW0VuhjPyNw.png"/></div></figure><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es ly"><img src="../Images/3306351764a02b424f445731417cdf44.png" data-original-src="https://miro.medium.com/v2/resize:fit:794/format:webp/1*-fSfECCtvHmPvHC0arlfCA.png"/></div></figure><p id="da71" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它仍然会给出状态 200，并且只返回 id=3 的那个。</p><p id="fd23" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">来贴一首歌</strong></p><figure class="ky kz la lb fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lz"><img src="../Images/d373f8d9d038d27bceb9852594a018ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*3-ht0zKls4QVqenVz6ewDA.png"/></div></div></figure><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es ma"><img src="../Images/bdae45744966c16e3e0a1980f49de490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1332/format:webp/1*R8dEAl9oaLqGZGAgwE5W2w.png"/></div></figure><p id="c1b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们去数据库，我们会在那里看到新歌。</p><p id="9a3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">放一首歌吧，意思是，更新一首。</strong></p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es mb"><img src="../Images/d54a04ecec9dc326024c30dd5011d2fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*qF1cBEDXAMDSOktCBoMqsg.png"/></div></figure><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es mc"><img src="../Images/fea610d877e4fbe2e21a078fef6edbae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*XslLQSv0KP7G8XCaFqiQVA.png"/></div></figure><p id="ad8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现在，让我们删除最后一个，因为我们不确定</strong></p><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es md"><img src="../Images/6aa9c5b37d769a9369750d7ee94b9282.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*JR65zQyFVKYqX6Pszmghdg.png"/></div></figure><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es me"><img src="../Images/4b6a89dbf9c89df7d4807ded6a163bc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*JuklGQeu8yaG56WK_3IgnQ.png"/></div></figure><h1 id="dc28" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">它怎么知道去哪个表？</h1><p id="4d40" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">你需要用相同的方式命名实体和表，除了，有一些 EF 遵循的约定，你可以覆盖其中的一些。在我的例子中，实体模型是 Song。但是数据库是歌曲。</p><p id="aed8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，如果您正在使用一个现有的数据库，并且您不喜欢您的模型的那些表名，您可以这样做，它仍然可以工作。</p><p id="bcf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在实体模型上，使用类似<code class="du jd je jf jg b">[Table(“tbl_name_in_db]</code>的属性</p><p id="ec79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者如果使用 fluent API(以后)，它将是<code class="du jd je jf jg b">.ToTable(“tbl_name_in_db”)</code></p><h1 id="1340" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">on model 创建</h1><p id="55ef" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">因为你遵循了命名惯例，EF 将会弄清楚许多关于你的数据库的事情。然而，有些时候你可能想变得更特殊。在这种情况下，您可以在 DBContext 类中添加这样的代码。</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="7365" class="lg ji hi jg b be lh li l lj lk">public class APIDbContext : DbContext<br/>{<br/>  public DbSet&lt;Song&gt; Songs { get; set; }<br/><br/>  public APIDbContext(DbContextOptions&lt;APIDbContext&gt; options) : base(options)<br/>  {<br/>  }<br/><br/>  protected override void OnModelCreating(ModelBuilder modelBuilder)<br/>  {<br/>        modelBuilder.Entity&lt;Song&gt;()<br/>            .Property(s =&gt; s.title)<br/>            .IsRequired(); //set the title property to required<br/>  } <br/>}</span></pre><p id="ef7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您已经在 Song 类本身中使用了一个属性，但是这是使用 fluent API 来完成的。您可以设置多个属性。例如，在产品表的产品实体中，您可以:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="5de0" class="lg ji hi jg b be lh li l lj lk"> modelBuilder.Entity&lt;Product&gt;()<br/>                .Property(product =&gt; product.ProductName)<br/>                .IsRequired()<br/>                .HasMaxLength(40);</span></pre><h1 id="cb4c" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">一些附加信息</h1><p id="b569" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">如果我们要为一个列命名一个不同于表中名称的属性:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="09f3" class="lg ji hi jg b be lh li l lj lk">//UnitPrice is the name in the table.<br/>[Column("UnitPrice", TypeName ="money")]<br/>public decimal? cost { get; set; }</span></pre><p id="e1e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到 in 创建:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="dacb" class="lg ji hi jg b be lh li l lj lk">//do not bring back in queries if the price is &gt;= 50<br/>modelBuilder.Entity&lt;Product&gt;().HasQueryFilter(p =&gt; p.cost &lt; 50);;</span></pre><p id="da57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EF 6 和更高版本允许你创建 preconvention 模型，意思是，将被全面共享的属性，就像这样(仍然在 APIDbContext 中):</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="963b" class="lg ji hi jg b be lh li l lj lk">protected override void ConfigureConventions(ModelConfigurationBuilder configurationBuilder)<br/>{<br/>   //apply this max to all string columns<br/>   configurationBuilder.Properties&lt;tring&gt;().HaveMaxLength(75);<br/>             <br/>   //or have a custom interface IDoNotMap and make sure none of <br/>   //the properties implementing it are mapped<br/>   //can also put a type in the IgnoreAny<br/>   //Could have also used [NotMapped] in a particular property.<br/>   configurationBuilder.IgnoreAny&lt;IDoNotMap&gt;(); <br/>}</span></pre><p id="716a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EF 可以让你做不同的事情，除了查找和添加之外，你还可以使用 linq 进行排序、过滤或查询。</p><h1 id="52d2" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">_dbContext。save changes()；</h1><p id="51ca" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">请注意，在我的代码中，在每个操作之后，我都在 DbContext 上调用了 SaveChanges。你不必做它。您可以累积一些添加、放置等操作，然后在最后调用 SaveChanges()。当您这样做时，所有操作都将被发送到数据库。请记住，如果不调用 SaveChanges，DB 中不会发生任何事情。</p><p id="c015" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SaveChanges 将启动一个事务。只有在所有更改都成功的情况下，它才会提交。您可以使用 DBContext 数据库控制显式事务。需要导入 Microsoft . entityframeworkcore . storage，如果手动控制事务，会是这样的:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="1802" class="lg ji hi jg b be lh li l lj lk">using (IDBContextTransaction t = db.Database.BeginTransaction())<br/>   //...do whatever<br/>   //after SaveChanges<br/>   t.commit();</span></pre><h1 id="69ca" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">状态代码</h1><p id="c289" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">如果我们想返回一个特定的状态代码，我们需要稍微改变一下我们的方法。让我们看看最简单的 Get。现在我有:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="b380" class="lg ji hi jg b be lh li l lj lk">[HttpGet] //could just name it Get<br/>public IEnumerable&lt;Song&gt; GetSongs()<br/>{<br/>   return _dbContext.Songs;<br/>}</span></pre><p id="83ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以改成这样:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="358a" class="lg ji hi jg b be lh li l lj lk">public IActionResult GetSongs()<br/>{<br/>   return Ok( _dbContext.Songs);<br/>}</span></pre><p id="4209" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者这个，如果我们想要更具体的代码，因为微软给了我们很多:</p><pre class="ky kz la lb fd lc jg ld bn le lf bi"><span id="42dd" class="lg ji hi jg b be lh li l lj lk">public IActionResult GetSongs()<br/>{<br/>  return StatusCode(StatusCodes.Status200OK, _dbContext.Songs);<br/>}</span></pre><figure class="ky kz la lb fd lm er es paragraph-image"><div class="er es mf"><img src="../Images/193eed88da65f7c4ced503518533042e.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*7foSkxqBqVoFBqDUlUplMQ.png"/></div></figure><p id="cae9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以返回一个字符串或任何适合每个特定方法的内容。</p><p id="f5b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是第一个。还会有更多的。</p><p id="57ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:请记住，为了让代码专注于 EF 的问题，我不检查空值，不捕捉异常，等等。当你写真正的代码时，不要忘记确保它不会在出错时爆炸:-)</p></div></div>    
</body>
</html>