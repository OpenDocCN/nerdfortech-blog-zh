<html>
<head>
<title>Service Discovery in Microservices— Spring Boot Web Flux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务中的服务发现——Spring Boot Web Flux</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/service-discovery-in-microservices-spring-boot-web-flux-3029f1cf6e68?source=collection_archive---------0-----------------------#2021-10-16">https://medium.com/nerd-for-tech/service-discovery-in-microservices-spring-boot-web-flux-3029f1cf6e68?source=collection_archive---------0-----------------------#2021-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cd92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">带有 web flux 的 Spring 云发现服务器</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/6b54f4bee2acda52ca150f403da5ad2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GCIGL-jqDHE7KjA7HaQT_g.jpeg"/></div></div></figure><p id="be3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我们在上一篇文章中提到的，我们将继续微服务案例研究。在这个帖子中，我们将讨论微服务中的服务发现。</p><h1 id="b0d2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么需要服务发现</h1><p id="e47d" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">首先，我们为什么需要服务发现？在现实世界中，当我们处理与微服务的通信时，需要检查服务是否被破坏。如果服务不可达，我们可以与其他实例通信。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ks"><img src="../Images/9e7257c527f043c71baf21e81e475d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*PUOJJPhT55BUNMCx7mCXeg.png"/></div></figure><p id="1d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上述示例中，服务 B 的第一个实例将不可访问。因此，当请求来自服务 A 时，如果它访问第一个实例，将无法连接到服务 B。因此出现了在单独的服务器上保存实例注册表的设计模式。以便在连接到服务 b 时给出实例细节。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ks"><img src="../Images/981904a195882983d9563b8546dedd98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*aj195oo4tuov-7TMFi5vcw.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">服务注册中心设计模式</figcaption></figure><p id="688b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，当启动服务 B 实例时，它将被注册在服务注册表中。然后，服务 a 中没有硬编码的实例详细信息。这将有助于动态连接到服务 B。假设如果服务 B 的一个实例失败，那么服务注册中心会阻止与服务 a 的那个实例连接。</p><h1 id="d587" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Spring Boot 与网飞尤里卡</h1><p id="a1eb" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">让我们使用网飞尤里卡图书馆来实现发现模式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/63bc2efb95ff8f313b78af7ca3fe7600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*widwNwnAm1e6u7rogNzAVw.png"/></div></div></figure><p id="61d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们的 web bff 模块充当发现服务器。这些是需要添加到 pom.xml &amp; Annotations 中的主要配置更改。</p><p id="0326" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">网络 Bff 模块</strong></p><p id="1c6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">属国</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="9554" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">配置更改</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="8c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">店铺服务模块</strong></p><p id="2b8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，这个模块需要注册为 eureka 客户端模块。所以他们会自动在尤里卡服务器上注册。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="fd8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们必须为微服务设置应用程序名称和实例 ID。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="549c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并为 spring boot 应用程序添加以下注释。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="9516" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些注册的微服务将显示在发现服务器管理门户中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es la"><img src="../Images/5d5eff4e218ef515e1dbe3cd618f6387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XknE5V9MMKHkxioqPcr86w.png"/></div></div></figure><h2 id="84f7" class="lb jq hi bd jr lc ld le jv lf lg lh jz iq li lj kd iu lk ll kh iy lm ln kl lo bi translated">使用 Webclient 实现负载平衡</h2><p id="ecf7" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这是棘手的部分。大多数时候我们都是用 RestTemplate 来连接微服务。但是在这个场景中，我们必须使用<a class="ae lp" href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/reactive/function/client/WebClient.html" rel="noopener ugc nofollow" target="_blank"> WebClient </a>。</p><p id="8db3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">确保将 spring-cloud-loadbalancer 添加到项目中。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="5eed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们不能像在 RestTemplate 中那样使用<code class="du lq lr ls lt b">@LoadBalanced</code>注释。为了在 WebClient 中使用负载平衡行为，需要使用<a class="ae lp" href="https://javadoc.io/doc/org.springframework.cloud/spring-cloud-commons/latest/org/springframework/cloud/client/loadbalancer/reactive/ReactorLoadBalancerExchangeFilterFunction.html" rel="noopener ugc nofollow" target="_blank">ReactorLoadBalancerExchangeFilterFunction</a>类作为 WebClient 中的过滤器配置。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="0520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将演示如何使用 spring webflux 和 Spring Cloud Discovery 服务。</p><p id="415e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，您可以访问代码库。</p><p id="044a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lp" href="https://github.com/sajith4u/pet-web-bff" rel="noopener ugc nofollow" target="_blank">宠物网-Bff </a></p><p id="de4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae lp" href="https://github.com/sajith4u/pet-shop-service" rel="noopener ugc nofollow" target="_blank">宠物店服务</a></p></div></div>    
</body>
</html>