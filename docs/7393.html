<html>
<head>
<title>React with Typescript series (Charity Web App) — Form state management</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Typescript 系列(慈善 Web 应用程序)作出反应—表单状态管理</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/react-with-typescript-series-charity-web-app-form-state-management-a411552097ff?source=collection_archive---------4-----------------------#2022-10-19">https://medium.com/nerd-for-tech/react-with-typescript-series-charity-web-app-form-state-management-a411552097ff?source=collection_archive---------4-----------------------#2022-10-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a6f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">大家好，在我们之前的教程中，我们学习了如何使用高阶组件创建表单。</p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/react-with-typescript-series-charity-web-app-higher-order-components-3f099f20a384"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">与 Typescript 系列(慈善网络应用程序)反应—高阶组件</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">嗨，伙计们，在我们的上一个教程中，我们创建了几个组件，最终得到了一个工作的应用程序。但是我们从来没有实现细节…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="4fe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我能够使用高阶组件创建一个动态表单。但是我们在那里所做的有一个大问题。如果你尝试过使用它，你会发现你不能在输入框中输入任何东西。主要原因是我们还没有为输入框实现 onChange 方法，以及适当的状态管理。老实说我也挣扎着想出了一个解决办法；).</p><p id="7638" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在尝试了几种解决方案后，我想出了一个解决办法。如果你还记得的话，我在上一个教程中添加了一个名为 config 的状态。我们使用这个状态将来自表组件的输入数据设置为模态组件。这里，当我们初始化配置时，我们从未处理 onChange 方法。所以我只是将索引和事件对象一起添加到 onChange 方法中。因此，只要其中一个输入框发生变化，我们就可以检测出是哪个框，并分配变化的值。以下代码将显示更改后的 StudentModalButton.tsx 文件。</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="1e8e" class="kf kg hi kb b fi kh ki l kj kk">import React, { Component } from 'react';<br/>import { Button } from 'react-bootstrap';<br/>import StudentModalComponent from '../StudentModalComponent/StudentModalComponent';<br/><br/>interface StudentModalButtonComponentProps {<br/>    studentId: string,<br/>    detail: any<br/>}<br/><br/>export default class StudentModalButton extends Component&lt;StudentModalButtonComponentProps, { show: boolean, config: any }&gt; {<br/>    constructor(props: StudentModalButtonComponentProps) {<br/>        super(props);<br/><br/>        let config = [];<br/>        let arr = [...Object.entries(this.props.detail)];<br/><br/>        for (let i = <em class="kl">0</em>; i &lt; arr.length; i++ ) {<br/>            let str = arr[i] + '';<br/>            let valArr = str.split(",");<br/><br/>            let obj = {<br/>                label: valArr[<em class="kl">0</em>],<br/>                value: valArr[<em class="kl">1</em>],<br/>                type: 'text',<br/>                <strong class="kb hj">onChange: (e: any) =&gt; {<br/>                    this.setConfigState(e.target.value, i);<br/>                }</strong><br/>            }<br/><br/>            config.push(obj);<br/>        }<br/><br/>        this.state = {<br/>            show: <em class="kl">false</em>,<br/>            config: config<br/>        };<br/>    }<br/><br/>    <strong class="kb hj">setConfigState(value: any, i: any) {<br/>        let arr = [...this.state.config];<br/>        arr[i].value = value;<br/>        this.setState({ config: arr });<br/>    }</strong><br/><br/>    setModalShow(showState: boolean) {<br/>        this.setState({ show: showState });<br/>    }<br/><br/>    <strong class="kb hj">saveData() {<br/>        console.log(this.state.config);<br/>    }</strong><br/><br/>    render(): React.ReactNode {<br/>        return &lt;&gt;<br/>            &lt;Button onClick={() =&gt; this.setModalShow(<em class="kl">true</em>)}&gt;{this.props.studentId}&lt;/Button&gt;<br/>            &lt;StudentModalComponent config={this.state.config} show={this.state.show} onHide={() =&gt; this.setModalShow(<em class="kl">false</em>)} <strong class="kb hj">onSave={() =&gt; this.saveData()}</strong> studentid = {this.props.studentId} /&gt;<br/>        &lt;/&gt;<br/>    }<br/>}</span></pre><p id="6090" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们必须更新单元测试文件 StudentModalButton.test.tsx</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="b371" class="kf kg hi kb b fi kh ki l kj kk">import { render } from "@testing-library/react";<br/>import React from "react";<br/>import { describe, it, expect } from "@jest/globals";<br/>import StudentModalButton from "./StudentModalButton";<br/><br/><strong class="kb hj">const details = [<br/>  { id: <em class="kl">0</em>, name: 'Example', contactNo: '', email: '', university: '', course: '', startDate: '', endDate: '', schoolEndDate: '', sponsor: '' },<br/>  { id: <em class="kl">1</em>, name: 'Demo', contactNo: '', email: '', university: '', course: '', startDate: '', endDate: '', schoolEndDate: '', sponsor: '' }<br/>]</strong><br/><br/>describe("Card", () =&gt; {<br/>  it("renders", () =&gt; {<br/>    const wrapper = render(&lt;StudentModalButton <strong class="kb hj">detail={details}</strong> studentId={"1"} /&gt;);<br/>    expect(wrapper.container).toMatchSnapshot();<br/>  });<br/>});</span></pre><p id="03bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在处理新的输入值很容易，更重要的是将数据保存在表单中。我们有一个保存按钮，但我们还没有实现任何东西。所以在上面的代码中你可以看到我添加了一个新的方法来处理它(只是控制台日志状态的表单)。</p><figure class="jw jx jy jz fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es km"><img src="../Images/6d2e60dcf75b910ef11ef7fe11a40027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vBIWr2bx7SaHJveT97Xg9g.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">控制台日志表单数据</figcaption></figure><p id="d4f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我用这个修改了 StudentModalComponent.tsx 文件。</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="8398" class="kf kg hi kb b fi kh ki l kj kk">import React, { Component } from 'react';<br/>import { Modal, Button } from 'react-bootstrap';<br/>import { withForm } from "../hoc/withForm";<br/><br/>export type StudentPropType = {<br/>    show: boolean,<br/>    form: any,<br/>    studentid: string,<br/>    config: any,<br/>    onHide(): void,<br/>    onSave(): void<br/>}<br/><br/>class StudentModalComponent extends Component&lt;StudentPropType&gt; {<br/>    constructor(props: StudentPropType) {<br/>        super(props);<br/>    }<br/><br/>    render(): React.ReactNode {<br/>        return &lt;Modal show={this.props.show}&gt;<br/>            &lt;Modal.Header closeButton onClick={this.props.onHide}&gt;<br/>                &lt;Modal.Title id="contained-modal-title-vcenter"&gt;<br/>                    Details of Student {this.props.config[<em class="kl">1</em>].value}<br/>                &lt;/Modal.Title&gt;<br/>            &lt;/Modal.Header&gt;<br/>            &lt;Modal.Body&gt;<br/>                {this.props.form}<br/>            &lt;/Modal.Body&gt;<br/>            &lt;Modal.Footer&gt;<br/>                &lt;Button onClick={this.props.onSave}&gt;Save&lt;/Button&gt;<br/>                &lt;Button onClick={this.props.onHide}&gt;Delete&lt;/Button&gt;<br/>                &lt;Button onClick={this.props.onHide}&gt;Close&lt;/Button&gt;<br/>            &lt;/Modal.Footer&gt;<br/>        &lt;/Modal&gt;<br/>    }<br/>}<br/><br/>export default withForm(StudentModalComponent);</span></pre><p id="4f7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们必须更新单元测试文件 StudentModalComponent.test.tsx</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="811b" class="kf kg hi kb b fi kh ki l kj kk">import { render } from "@testing-library/react";<br/>import React from "react";<br/>import { describe, it, expect } from "@jest/globals";<br/>import StudentModalComponent from "./StudentModalComponent";<br/><br/><strong class="kb hj">const config = [<br/>  {<br/>    "label": "id",<br/>    "value": "0",<br/>    "type": "text"<br/>  }, <br/>  {<br/>      "label": "name",<br/>      "value": "Examplewww",<br/>      "type": "text"<br/>  }<br/>]</strong><br/><br/>describe("StudentModalComponent", () =&gt; {<br/>  it("renders", () =&gt; {<br/>    const wrapper = render(&lt;StudentModalComponent <strong class="kb hj">config={config}</strong> show={<em class="kl">true</em>} studentid={"1"} onHide={jest.fn()} /&gt;);<br/>    expect(wrapper.container).toMatchSnapshot();<br/>  });<br/><br/>  it("not renders", () =&gt; {<br/>    const wrapper = render(&lt;StudentModalComponent <strong class="kb hj">config={config}</strong> show={<em class="kl">false</em>} studentid={"1"} onHide={jest.fn()} /&gt;);<br/>    expect(wrapper.container).toMatchSnapshot();<br/>  });<br/>});</span></pre><p id="a147" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像往常一样，一切都在<a class="ae kx" href="https://github.com/deBilla/serendib-scholarship-ui" rel="noopener ugc nofollow" target="_blank"> Github 链接</a>中。随便问任何问题。快乐编码。下节课再见。(将此连接到后端)。快乐编码:P</p></div></div>    
</body>
</html>