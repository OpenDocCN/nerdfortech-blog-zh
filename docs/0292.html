<html>
<head>
<title>The ever confusing local, nonlocal and global variables in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中令人困惑的局部、非局部和全局变量</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/the-ever-confusing-local-nonlocal-and-global-variables-in-python-949b106c0243?source=collection_archive---------1-----------------------#2020-09-12">https://medium.com/nerd-for-tech/the-ever-confusing-local-nonlocal-and-global-variables-in-python-949b106c0243?source=collection_archive---------1-----------------------#2020-09-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/12e3c9d1ff6c8500b173e0e19541dcf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAMXF7qdO0Lcf_w5grIARA.jpeg"/></div></div></figure><div class=""/><p id="ee88" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你用python编程，我敢肯定你遇到过局部变量、非局部变量和全局变量。在这篇博客中，我用python中的例子解释了变量的作用域。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="336b" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">当地的</h1><p id="7050" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">定义为函数参数的变量是函数的局部变量。换句话说，它们有一个局部范围，只能在声明它们的函数中使用。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="0e8c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抽样输出</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="653f" class="lk jw ht lg b fi ll lm l ln lo">Hi!, I am Batman. Nice to meet you!<br/>Traceback (most recent call last):<br/>  File "local_variable.py", line 6, in &lt;module&gt;<br/>    print(f"Outside variable_scope function, superhero = {superhero}")<br/>NameError: name 'superhero' is not defined</span></pre><p id="8031" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在函数<em class="lp"> variable_scope </em>中，定义了变量<em class="lp">超级英雄</em>。因为它是在函数内部定义的，所以变量的范围是局部的，并且变量只在函数<em class="lp"> variable_scope </em>内部可用。正如我们在示例输出中看到的，当函数<em class="lp"> variable_scope </em>被调用时，函数<em class="lp"> variable_scope </em>内部的print语句被执行，它打印变量<em class="lp"> superhero </em>的值。然而，当我们试图在函数之外做同样的事情时，它失败了。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="669a" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">全球的</h1><p id="367c" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">让我们稍微修改一下代码，在函数范围之外定义变量。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="b554" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抽样输出</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="07ee" class="lk jw ht lg b fi ll lm l ln lo">Outside variable_scope call, I am Batman!<br/>Outside variable_scope call, I am Superman!<br/>Hi!, I am Batman!. Nice to meet you!<br/>Traceback (most recent call last):<br/>  File "global_variable_error.py", line 12, in &lt;module&gt;<br/>    variable_scope()<br/>  File "global_variable_error", line 7, in variable_scope<br/>    superhero2 += " And I am better than Batman"<br/>UnboundLocalError: local variable 'superhero2' referenced before assignment</span></pre><p id="bf10" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码示例中，我们在程序主体中声明了两个变量<em class="lp">超级1 </em>和<em class="lp">超级2 </em>。因为变量是在主体中声明的，所以它们具有全局范围，并且在整个程序中都是可用的。在<em class="lp">变量作用域</em>函数中，我们尝试打印变量<em class="lp">超级1 </em>的值，这是可行的。但是当我们试图修改<em class="lp">超级英雄2 </em>的值时，却没有。这是因为当python编译<em class="lp"> variable_scope </em>时，<em class="lp"> superhero2 </em>变量的值被修改<em class="lp"> </em>，因此被视为局部变量。</p><p id="d858" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要修复这个错误，我们必须通知解释器这两个变量都是<a class="ae ky" href="https://en.wikipedia.org/wiki/Global_variable" rel="noopener ugc nofollow" target="_blank">全局</a>，尽管在函数内部有声明。我们通过使用关键字“<em class="lp">全局</em>”来做到这一点</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="9689" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抽样输出</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="4694" class="lk jw ht lg b fi ll lm l ln lo">Outside variable_scope call, I am Batman!<br/>Outside variable_scope call, I am Superman!<br/>Hi!, I am Batman!. Nice to meet you!<br/>Variable_scope says, I am Superman! And I am better than Batman!</span></pre><p id="9a0e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码中<em class="lp">超级1 </em>和<em class="lp">超级2 </em>变量在<em class="lp"> variable_scope </em>函数中被声明为全局变量。这样，当试图引用函数<em class="lp"> variable_scope </em>中的变量时，python解释器将这两个变量视为全局变量。</p></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><h1 id="3d03" class="jv jw ht bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">非局部的</h1><p id="687e" class="pw-post-body-paragraph iq ir ht is b it kt iv iw ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn hb bi translated">让我们考虑嵌套函数，看看变量的范围。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="3c79" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抽样输出</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="1b4a" class="lk jw ht lg b fi ll lm l ln lo">Outer function says, I am Batman!<br/>Traceback (most recent call last):<br/>  File "nonlocal_error.py", line 9, in &lt;module&gt;<br/>    outer_function()<br/>  File "nonlocal_error.py", line 7, in outer_function<br/>    inner_function()<br/>  File "nonlocal_error.py", line 5, in inner_function<br/>    superhero += " I am kidding!!"<br/>UnboundLocalError: local variable 'superhero' referenced before assignment</span></pre><p id="dffe" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上面的代码示例中，我们有<em class="lp">外部函数</em>和<em class="lp">内部函数</em>。变量<em class="lp">超级英雄</em>在<em class="lp">外层函数</em>中声明。当调用<em class="lp"> inner_function </em>时，<em class="lp"> outer_function </em>的作用域消失。这使得变量超级英雄的生活变得非常有趣！由于它没有在<em class="lp"> inner_function </em>中声明，所以它不能是局部变量。而且它也不可能是全局的，因为它没有被定义为全局的(咄！).在这种情况下，<em class="lp">超级英雄</em>是一个<a class="ae ky" href="https://en.wikipedia.org/wiki/Free_variables_and_bound_variables" rel="noopener ugc nofollow" target="_blank">自由变量</a>，因为它没有绑定到局部范围。当我们试图修改变量<em class="lp">超级英雄</em>的值时，我们隐式地创建了一个局部变量<em class="lp">超级英雄</em>。</p><p id="764e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决上面代码中的问题，让我们在<em class="lp"> inner_function </em>中声明<em class="lp">超级英雄</em>变量<a class="ae ky" href="https://en.wikipedia.org/wiki/Non-local_variable" rel="noopener ugc nofollow" target="_blank">非本地变量</a>。</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="ld le l"/></div></figure><p id="8385" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">抽样输出</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="8b7b" class="lk jw ht lg b fi ll lm l ln lo">Outer function says, I am Batman!<br/>Inner function says, I am Batman! I am kidding!!</span></pre><p id="c669" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">声明一个非局部变量，将它标记为自由变量，即使我们试图在函数内部赋值。Python将自由变量的名称保存在__code__属性中。为了列出我们可以检查返回<em class="lp"> inner_function </em>对象的<em class="lp"> fn_obj </em>。</p><pre class="kz la lb lc fd lf lg lh li aw lj bi"><span id="b6f3" class="lk jw ht lg b fi ll lm l ln lo">&gt;&gt;&gt; fn_obj.__code__.co_freevars<br/>('superhero',)</span></pre></div><div class="ab cl jo jp gp jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="hb hc hd he hf"><p id="15a7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢你的时间。这是python中有趣主题的基础，比如闭包和装饰器，我们将在下一篇博客中看到。</p><p id="330f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">还有，蝙蝠侠比超人强！</p><figure class="kz la lb lc fd hk"><div class="bz dy l di"><div class="lq le l"/></div></figure></div></div>    
</body>
</html>