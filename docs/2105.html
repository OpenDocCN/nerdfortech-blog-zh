<html>
<head>
<title>Use Python to send Messages to Facebook Messenger API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Python 向 Facebook Messenger API 发送消息</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/use-python-to-send-messages-to-facebook-messenger-api-837a18997ade?source=collection_archive---------2-----------------------#2021-04-21">https://medium.com/nerd-for-tech/use-python-to-send-messages-to-facebook-messenger-api-837a18997ade?source=collection_archive---------2-----------------------#2021-04-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ed2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将以 Messenger Graph API 教程来结束自动化系列教程。在本教程中，我们将了解如何从 Python 应用程序向脸书 Graph Messenger API 发送消息。</p><p id="4c3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在本教程中讨论的要点是:</p><ul class=""><li id="2937" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">创建我们的应用程序— Flask</li><li id="ddff" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">在我们的应用程序中设置 Facebook Messenger webhook</li><li id="cfdd" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">在 HTTPS 上托管我们的应用程序</li><li id="c4de" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">编写代码从我们的 webhook 接收消息，并将响应发送回脸书</li><li id="176d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">向我们的脸书应用添加 Messenger 权限，获取访问令牌</li><li id="d8d1" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">测试我们的应用</li></ul><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/a02f74e9779b7eb378ae486332f9e705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bcEk-U12RX43Sn-J_UwvVA.jpeg"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">使用 Python 向 Facebook Messenger API 发送消息</figcaption></figure><h1 id="a144" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">创建我们的烧瓶应用程序</h1><p id="9185" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">首先，我们创建一个 python 项目目录和虚拟环境，在命令行上运行以下命令:</p><pre class="js jt ju jv fd lk ll lm ln aw lo bi"><span id="657f" class="lp ki hi ll b fi lq lr l ls lt">mkdir messenger &amp;&amp; cd messenger<br/>virtualenv messengerenv<br/>source messengerenv/bin/activate</span></pre><p id="ec64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建我们需要使用的文件:</p><pre class="js jt ju jv fd lk ll lm ln aw lo bi"><span id="26d9" class="lp ki hi ll b fi lq lr l ls lt">touch app.py config.py<br/>nano app.py</span></pre><p id="7e80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将此粘贴到 app.py 文件中:</p><pre class="js jt ju jv fd lk ll lm ln aw lo bi"><span id="0dae" class="lp ki hi ll b fi lq lr l ls lt">from flask import Flask, request</span><span id="1be8" class="lp ki hi ll b fi lu lr l ls lt">app = Flask(__name__)</span><span id="d1ef" class="lp ki hi ll b fi lu lr l ls lt">app.config['SECRET_KEY'] = 'enter-your-secret-key-here'</span><span id="fc49" class="lp ki hi ll b fi lu lr l ls lt"><a class="ae lv" href="http://twitter.com/app" rel="noopener ugc nofollow" target="_blank">@app</a>.route('/', methods=["GET", "POST"])<br/>def home():</span><span id="9bf7" class="lp ki hi ll b fi lu lr l ls lt">    return 'HOME'</span><span id="107d" class="lp ki hi ll b fi lu lr l ls lt">if __name__ == '__main__':<br/>    app.run(host='0.0.0.0', port='8888', debug=True)</span></pre><p id="4c3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个最小的 flask 应用程序，只在主页上显示单词“HOME”。</p><p id="17d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以运行正在运行的应用程序和测试:</p><pre class="js jt ju jv fd lk ll lm ln aw lo bi"><span id="5dbd" class="lp ki hi ll b fi lq lr l ls lt">python app.py</span></pre><p id="a306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后访问 localhost:8888 或 your-ip-address:8888(端口 8888)。</p><h1 id="ff59" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">在我们的应用程序中设置 Facebook Messenger Webhook</h1><p id="3593" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">我们将遵循 Facebook Messenger API 文档中的启动教程，此处可获得:<a class="ae lv" href="https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start" rel="noopener ugc nofollow" target="_blank">https://developers . Facebook . com/docs/Messenger-platform/getting-started/quick-start</a></p><p id="f388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Facebook Messenger API 文档也提供了 Javascript 示例代码，我们将在 GitHub 上为 Python 重新编写这些代码:</p><div class="lw lx ez fb ly lz"><a href="https://github.com/fbsamples/messenger-platform-samples/blob/master/quick-start/app.js" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hj fi z dy me ea eb mf ed ef hh bi translated">FB samples/messenger-平台-样本</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">用于发送和接收消息的 Messenger 平台示例。浏览此代码的入门指南…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div></div></a></div><p id="5520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑 app.py 文件，如下所示:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">使用 Python 向 Facebook Messenger API 发送消息</figcaption></figure><h1 id="371f" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">在 HTTPS 上托管我们的应用程序</h1><p id="bb86" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">要在 HTTPS 上托管应用程序，你需要一个托管服务，youtube 上有一个完整的视频，你可以了解所有细节:<a class="ae lv" href="https://www.youtube.com/watch?v=RP8nhiiQnTc" rel="noopener ugc nofollow" target="_blank">在数字海洋上托管 Python Flask 应用程序</a>。</p><h1 id="5af0" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">添加 Messenger 应用程序并获取页面访问令牌</h1><p id="146f" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">我们需要获得一个脸书应用程序，该应用程序具有正确的 messenger 权限和访问令牌来完成该过程。</p><p id="a567" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转到 facebook 开发者页面，创建一个应用程序。进入<strong class="ih hj">设置</strong> &gt; <strong class="ih hj">基本</strong>，从应用程序网格中选择 messenger。单击设置继续。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es mk"><img src="../Images/e0c241253920f67fa7876e129ad759b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIdzRiLMT9q-L7y2fSTSFA.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">设置 Messenger API 访问令牌</figcaption></figure><p id="e1a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">选择“添加新页面”,通过登录您的帐户并选择您想要使用的页面来完成授权。</p><p id="f865" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">单击 generate token —将其复制并粘贴到 config.py 文件中。调用 config.py 文件中的令牌<strong class="ih hj"> PAGE_ACCESS_TOKEN </strong>作为字符串。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es ml"><img src="../Images/3800a46c5a3279daad3cfa32b11606b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q393kSO7DZLOwPGWPDwi6g.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">为 Messenger API 生成页面访问令牌</figcaption></figure><p id="2b48" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后单击底部的按钮，输入回拨 url 并验证字符串。您的 webhook 应用程序现在应该已经在 https 服务器上启动并运行了，这样做没有问题。</p><p id="6cd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入 URL—<a class="ae lv" href="https://your-host-domain/webook" rel="noopener ugc nofollow" target="_blank">https://your-host-domain/webook</a>，并输入与 app.py 文件中完全相同的验证令牌。</p><h1 id="8d40" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated"><strong class="ak">测试你的应用</strong></h1><p id="d89c" class="pw-post-body-paragraph if ig hi ih b ii lf ik il im lg io ip iq lh is it iu li iw ix iy lj ja jb jc hb bi translated">你现在可以转到你连接的脸书页面并测试应用程序，请注意，除了脸书页面的所有者和注册开发者之外，该应用程序将不会为任何其他用户工作，除非你将你的应用程序通过脸书应用程序验证批准流程。</p><h1 id="2b15" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">完整视频教程</h1><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mm mj l"/></div></figure></div></div>    
</body>
</html>