# AWS 认证解决方案架构师— EC2 和 AMI

> 原文：<https://medium.com/nerd-for-tech/aws-certified-solution-architect-ec2-ami-4540126117bb?source=collection_archive---------2----------------------->

大家好，在本教程中，我们将关注最受欢迎的 AWS 服务之一，EC2(弹性计算云)。换句话说，我们使用这项服务从 AWS 租用虚拟机。因此，作为一名 AWS 解决方案架构师，在创建 EC2 实例时，我们需要考虑一些要点，然后再决定要租赁什么样的虚拟机。

*   操作系统— Linux、Windows 或 Mac 操作系统
*   中央处理器
*   随机存取存储
*   储存；储备
*   网卡—速度和公共 IP 地址
*   安全组—防火墙规则
*   EC2 用户数据—引导脚本

因此，在我们的上一个教程中，我们创建了一个 AWS 帐户，并了解了 IAM。要访问这些教程，请点击以下链接。

[](/nerd-for-tech/aws-certified-solution-architect-iam-8930ce442515) [## AWS 认证解决方案架构师— IAM

### IAM 的意思是身份和访问管理服务。当我们在之前的教程中创建 AWS 帐户时，我们…

medium.com](/nerd-for-tech/aws-certified-solution-architect-iam-8930ce442515) [](/nerd-for-tech/aws-certified-solution-architect-intro-2eb2942d11e7) [## AWS 认证解决方案架构师—简介

### 大家好，这是新的教程系列，希望是您在 AWS 认证解决方案架构师中的主要助手…

medium.com](/nerd-for-tech/aws-certified-solution-architect-intro-2eb2942d11e7) 

现在你们知道如何访问 AWS 控制台了。就像我们在搜索框中搜索 IAM search EC2 一样。点击后，您将进入 EC2 部分。现在你会看到这样的景色。

![](img/1aea90c5cfebef4d4d386a7e5521de22.png)

要创建 EC2 实例，请单击左上角的 instances 选项卡，然后在我们看到的视图中有一个名为 launch instance 的按钮。点击它。现在我们的第一步是选择 AMI (Amazon 机器映像)。对于本教程，我将使用亚马逊 Linux 2 AMI。按下那里的选择按钮。

![](img/fed6539143c204a25fa1c6936f6648f8.png)

在本教程中将创建一个免费层(亚马逊不收费)。为此，我们在下一个屏幕中使用 ***t2.micro*** 实例类型。这里 t 表示实例类(这里是通用的)，2 表示实例生成，micro 表示实例的大小。大概有 5 种不同的情况。

*   通用
*   计算优化
*   内存优化
*   存储优化

记住这些都是 AWS 架构师考试要问的。因此，请尝试将这些与您必须使用 EC2 服务器的实际情况对应起来。我们已经讨论了操作系统、CPU 和 RAM 等，现在让我们来谈谈网卡。

因此，对于 EC2 实例，有 2 个不同的 IP4 地址。私有 IP 和公有 IP。专用 IP 用于 AWS 内部网络，公共 IP 用于互联网(WWW)。当我们停止和启动 EC2 实例时，这个 IP 地址可以更改，为了避免这种情况，我们在 AWS 中使用了弹性 IP。因此，我们只需转到 EC2 dashboard，转到 Elastic IPs，然后创建它。AWS 通常允许每个帐户有 5 个不同的弹性 IP。但是在最佳实践中，不建议使用弹性 IP。我们可以使用随机的公共 IP，并为它们注册一个 DNS 名称，或者我们可以使用负载平衡器，完全避免使用公共 IP。EC2 实例是在 VPC 内部创建的。这些 VPC 有一个称为虚拟网卡的逻辑组件，这些网卡为 EC2 实例提供了一个弹性网络接口(ENI)。ENI 可以有 IP4 私有和公有地址、安全组和 MAC 地址。在 AWS 中，我们可以创建 ENI，并在 EC2 实例上动态连接它们以进行故障转移。弹性网络接口(Eni)被绑定到特定的 AZ。您不能将 ENI 附加到不同 AZ 中的 EC2 例程。

安全组用于向 EC2 实例添加防火墙规则。创建一个安全组是如此简单。我们只需转到 EC2 dasboard，然后转到安全组，在那里创建一个新的安全组。安全组可以附加到多个 EC2 实例，我们可以使用它们将一个实例锁定到特定的区域。

使用安全组的最佳实践包括使用不同的安全组 SSH always 和 always use IAM roles 向 EC2 实例授权。此外，当我们在托管应用中遇到技术问题时，如果问题是超时问题，则可能是安全组问题。默认情况下，所有入站连接都受到限制，所有出站连接都在安全组中得到授权。

为了在保留内存的情况下终止 EC2 实例，AWS 提供了一个名为 AWS Hibernate 的新选项。在这里，RAM 状态被保留，操作系统没有停止，只是重新启动，因此引导时间较短。在这里，RAM 状态被写入 EBS 卷的根目录中的文件。这用于长时间运行的流程，需要时间初始化的服务。根卷必须加密才能使用，并且实例的 RAM 大小应小于 150GB。实例不能休眠超过 60 天。要启用 EC2 休眠，EC2 实例根卷类型必须是 EBS 卷，并且必须加密以确保敏感内容得到保护。

集群放置组将您的 EC2 实例并排放置，这为您提供了高性能的计算和网络。Spread Placement Group 将您的 EC2 实例放置在不同 az 的不同物理硬件上。

购买 EC2 实例主要有 4 种方式。当您成为解决方案架构师时，这一点非常重要。您应该了解如何以最低的成本为您的解决方案获得最好的东西。

*   按需—短工作负载
*   保留—长期工作负载(可转换的和计划的)—(1-3 年)
*   Spot reserved 预测价格，然后输入高于现货当前价值的现货价格，或者可以使用 spot block 在计划的时间范围内阻止实例(通过使用 Spot Block 实例，您可以在指定的持续时间(1-6 小时)内不间断地保留一组 Spot EC2 实例。).Spot Fleet 是一组 Spot 实例和可选的按需实例。它允许您自动请求具有最低价格的现货实例。
*   专用—整个物理服务器—3 年以上

终止临时保留的实例时，首先取消临时请求，然后终止实例。

EC2 的最新发展如下。

*   EC2 Nitro —新一代 EC2，新的虚拟化技术，更高的性能(更高速度的 EBS (Nitro — 64000IOPS，而非 Nitro — 32000IOPS)，更好的网络(高性能计算、增强网络、IPv6)，更好的底层安全性
*   EC2 vCPU —一个 CPU 上的多个线程，一个线程称为 vCPU。每个 CPU 个 CPU 和 2 个线程，然后是 8 个 vcpu。这些虚拟 CPU 可以根据我们的需要进行优化，以使用每个 CPU—RAM 或 HPC(高性能计算)
*   EC2 容量预留—不需要 1-3 年的承诺，但确保我们在需要时拥有 EC2 容量(节约成本)

现在我们已经谈了很多关于 EC2 的内容。所以现在是时候检查一下 AMIs 了。创建 EC2 实例时使用 Amazon 机器映像。因此，我们看到了一些内置的图像，但现在我们要创建一个定制的 AMI。做到这一点的步骤非常简单，

*   创建一个 EC2 实例，并在该实例上进行我们需要的定制
*   将其转换为 AMI

创建新 EC2 时，有一个名为**“Advanced details”**的部分。单击它，您将看到一个名为“User Data”的文本框。在此文本框中，我们可以包含创建实例时要运行的特定脚本。另一件重要的事情是如下设置 HTTPs 和 HTTP 流量刻度。

![](img/3ff7f25b400bef06b88acc3d9945e506.png)

如下输入用户详细信息。

![](img/6fb3e696b3cca40bdfa30bfd7c265079.png)

```
#!/bin/bash
yum update -y
yum install -y httpd
sudo su
systemctl start httpd
```

这里第一行非常重要，因为它将其余的行描述为 bash 命令。创建 EC2 实例后，尝试使用公共 IPv4 DNS 访问该实例。只需复制这个值并粘贴到浏览器中。如果一切正常，您应该会看到一个包含 Apache 服务器详细信息的网页。(确保在复制的 url 中使用 http 而不是 https)。比如 http://ec2-3-239-27-105.compute-1.amazonaws.com/的。

现在让我们创建这个实例的 AMI。为此，进入实例屏幕，选择您需要转换的实例。现在点击创建图像。

![](img/70d8c8938887a96ec3126eb74a51641c.png)

然后给出一个名称并创建 AMI。现在转到启动实例并创建一个新的 EC2。对于 AMI，使用您创建的 AMI，如下所示:

![](img/b59af05d789e33438ab0ccb3705986f8.png)

现在无需添加用户数据，只需启动实例，但要记住在 network 部分勾选 HTTP。现在检查网址。您将看到 apache 服务器，这意味着这是我们之前定制的映像。