<html>
<head>
<title>All Important Window Functions in SQL for Interview</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL中用于面试的所有重要窗口函数</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/all-windows-functions-in-sql-6b4da1cfedd7?source=collection_archive---------0-----------------------#2021-07-17">https://medium.com/nerd-for-tech/all-windows-functions-in-sql-6b4da1cfedd7?source=collection_archive---------0-----------------------#2021-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/e9739c074e211a0cb8394de6ccc0a9ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-fwD-FPrm7UgT8-F.jpg"/></div></div></figure><p id="dc40" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">几个月前，当我开始准备面试时，我意识到掌握分析功能对于在任何分析公司就业都是极其重要的。</p><p id="bcfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我开始在互联网上寻找资源，并意识到几乎没有任何有组织的数据资源可用。所以我决定把这些函数写在这里，以防有人准备面试。</p><h1 id="90e5" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">介绍</h1><p id="3a6c" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">我有一个基本的期望，你在编写SQL查询经验丰富。在讨论函数之前，我们先来谈谈一些基本概念。</p><p id="ad2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我假设您知道SQL命令的执行顺序。万一你没有让我们讨论一次。查询执行从“from”子句开始，并按如下所示的顺序结束。</p><ol class=""><li id="a17c" class="la lb hi is b it iu ix iy jb lc jf ld jj le jn lf lg lh li bi translated"><code class="du lj lk ll lm b">FROM</code>条款</li><li id="bcdc" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">ON</code>条款</li><li id="b987" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">OUTER</code>条款</li><li id="3042" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">WHERE</code>条款</li><li id="adca" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">GROUP BY</code>条款</li><li id="3f55" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">HAVING</code>条款</li><li id="1626" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">SELECT</code>子句(使用select子句执行窗口功能)</li><li id="46d2" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">DISTINCT</code>条款</li><li id="55e6" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated"><code class="du lj lk ll lm b">ORDER BY</code>条款</li><li id="dfed" class="la lb hi is b it ln ix lo jb lp jf lq jj lr jn lf lg lh li bi translated">条款</li></ol><p id="e513" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">语法是不言自明的，因为<strong class="is hj">窗口函数</strong>是在select子句中编写的，因此与select语句一起执行。需要记住的重要一点是，不能在windows函数创建的列上编写<strong class="is hj"> where </strong>子句，因为<strong class="is hj"> where </strong>在select之前执行。例如，在下面的示例中，我们不能在<strong class="is hj"> rnk </strong>列上写入where条件，因为where将在<strong class="is hj"> rnk </strong>列创建之前执行。</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="9873" class="ma jy hi lm b fi mb mc l md me">select empno, ename, job, hiredate, sal,<br/>rank()<br/>    over( order by hiredate<br/>    )rnk<br/>    <br/>from emp<br/>order by sal;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="ab fe cl mf"><img src="../Images/76657237745264584355db9f6445d1cf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NQphloBxkXsZiUE4W2LjEA.png"/></div></figure><p id="191b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里<strong class="is hj"> rnk </strong>只是另一个列名。计算将由函数进行，结果将显示在列中。</p><p id="2d55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">windows函数的标准语法是</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="aeac" class="ma jy hi lm b fi mb mc l md me">window_function (&lt;column_name&gt;) OVER (<br/>   [ PARTITION BY expr_list ]<br/>   [ ORDER BY order_list ]<br/>   [ windows clause )</span></pre><p id="735d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你以后会习惯的。只是看一看，然后继续前进。</p><h1 id="7ceb" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">排名功能</h1><p id="716b" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">有多个函数可用于对行进行排序。当值相同时，<strong class="is hj"> Rank() </strong>函数将显示相同的等级值，但如果前两个值相同，则下一个值将等于行号，例如1、1、3等等。</p><p id="6578" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">而在<strong class="is hj"> dense_rank() </strong> we值是连续的。例如，如果前两个值相同，则为1、1、2等</p><p id="cb58" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<strong class="is hj"> row_number() </strong>函数中，这些值与行值1、2、3等一致，即使前两个值相同。</p><h2 id="9cd9" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">等级函数</h2><p id="e5e0" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">表格结构</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/04655f3fd80cd6f13d8f9b84223781bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*wP8QF_sX8MePtAN_se8S8A.png"/></div></figure><p id="d41e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>根据员工入职日期计算排名，按员工工资排序</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="5c9c" class="ma jy hi lm b fi mb mc l md me">select empno, ename, job, hiredate, sal,<br/>rank()<br/>    over( order by hiredate<br/>    )rnk<br/>    <br/>from emp<br/>order by sal;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="ab fe cl mf"><img src="../Images/76657237745264584355db9f6445d1cf.png" data-original-src="https://miro.medium.com/v2/format:webp/1*NQphloBxkXsZiUE4W2LjEA.png"/></div></figure><h2 id="ac59" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">密集_秩</h2><p id="0822" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>按员工工资计算排名，按员工工资升序排序</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="55f2" class="ma jy hi lm b fi mb mc l md me">select empno, ename, job, hiredate, sal,<br/>rank()over(order by sal) as rnk,<br/>dense_rank()<br/>    over( order by sal<br/>    )as sal_dense_rnk<br/>    <br/>from emp<br/>order by sal<br/>;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/be99721a2a7f2f7e81d3c6730e4d8617.png" data-original-src="https://miro.medium.com/v2/resize:fit:1110/format:webp/1*oFsytWHIxzvOBeCsmRfpAQ.png"/></div></figure><h2 id="552a" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">行数</h2><p id="916b" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>按员工工资计算排名，按员工工资升序排序。sal相同时使用Empno。</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="457d" class="ma jy hi lm b fi mb mc l md me">select empno, ename, job, hiredate, sal,<br/>row_number() over(<br/>order by sal, empno) as row_num,<br/>rank()over(order by sal) as rnk,<br/>dense_rank()<br/>    over( order by sal<br/>    )as sal_dense_rnk<br/>    <br/>from emp<br/>order by sal<br/>;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es mv"><img src="../Images/5230789e2ea63154ec2d36f9685c4549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*2l_yLululfgZ9GyvrtiPFw.png"/></div></figure><h2 id="9f08" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">Percent_Rank，Cume_Dist，NTILE</h2><p id="a633" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">表格结构</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/cfc3bad84bd876a61b34b0cafdf8f860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWiDz6xFImDldEHZvDtLNg.png"/></div></div></figure><p id="764d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>使用PERCENT_RANK、CUME_DIST和NTILE(四分位数、十分位数、三分位数等)显示好莱坞电影票房销售的分布</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="d336" class="ma jy hi lm b fi mb mc l md me">select name, gross_sales,<br/>percent_rank()<br/>over(<br/>order by gross_sales<br/>) as pct,<br/>cume_dist()<br/>over(</span><span id="ae3e" class="ma jy hi lm b fi mx mc l md me">order by gross_sales<br/>) as cum_dist,</span><span id="09db" class="ma jy hi lm b fi mx mc l md me">ntile(4)<br/>over(<br/>order by gross_sales) as ntil<br/>from movies;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es my"><img src="../Images/49e257578db921cbc42b3bb917a35b1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qmXaV4eMt71hwJQKPG1hdg.png"/></div></div></figure></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h2 id="8cb9" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">处理空值</h2><p id="74d7" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">表格结构</strong></p><p id="e986" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">表1 </strong>:月亮</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ng"><img src="../Images/326f09a27dfbae65c1206b17a47974bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*5wfG9hh36JeWZ-7VVfGL5g.png"/></div></figure><p id="b457" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">表2 </strong>:行星</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nh"><img src="../Images/5a6eb91006fc6c6b5ac1ee99451e0433.png" data-original-src="https://miro.medium.com/v2/resize:fit:276/format:webp/1*XX6516r-iBvR7CH7vfk8Ww.png"/></div></figure><p id="2a27" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述</strong>:按照行星(火星、金星、冥王星、水星、海王星)的半径按Desc顺序排列。空值应该最后显示。</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="552c" class="ma jy hi lm b fi mb mc l md me">select p.name as planet,m.name as moon,  m.radius,<br/>row_number()<br/>over(<br/>order by m.radius desc</span><span id="1ad8" class="ma jy hi lm b fi mx mc l md me">) as rnk<br/>from <br/>planets p, moons m<br/>where p.name =m.planet_name(+)<br/>and p.name in ('Mars','Venus','Pluto', 'Mercury', 'Neptune')</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ni"><img src="../Images/a90bebca3503980eabfd9da2104fdb44.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*8yYzoIS-i7LkQrbZNgdZ-A.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="2349" class="ma jy hi lm b fi mb mc l md me">select p.name as planet,m.name as moon,  m.radius,<br/>row_number()<br/>over(<br/>order by m.radius desc nulls last</span><span id="a92c" class="ma jy hi lm b fi mx mc l md me">) as rnk<br/>from <br/>planets p, moons m<br/>where p.name =m.planet_name(+)<br/>and p.name in ('Mars','Venus','Pluto', 'Mercury', 'Neptune');</span></pre><h1 id="f45a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">分割条款</h1><p id="e3f0" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">Partition子句类似于group by，但是尽管两个子句都聚合数据，但Partition by不会减少行数，而group by会汇总数据。partition by只是创建了一个窗口，我们可以在这个窗口上进行计算。让我们通过例子来理解这个。</p><p id="b8c7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述</strong>:我需要按员工姓名统计的部门工资总额</p><p id="4bf7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">表格结构:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nj"><img src="../Images/cc23f3af2c51f313a2d690914f3acc4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*MPNeV7u4Q5LomwQDpk5YSQ.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="e36d" class="ma jy hi lm b fi mb mc l md me">select deptno,empno,ename, job,sal,<br/>sum(sal)<br/>over(<br/>partition by deptno<br/>order by ename) as total<br/>from emp<br/>order by deptno, ename;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nk"><img src="../Images/a6437d5da0ed6430eacb0318861ce4e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*lD4SuNKmJLgzx_x4RgM7yg.png"/></div></figure><h2 id="3c01" class="ma jy hi bd jz mg mh mi kd mj mk ml kh jb mm mn kl jf mo mp kp jj mq mr kt ms bi translated">窗口聚合</h2><p id="3ed4" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">我们现在将开始使用windows子句。我们可以对行的范围执行数学运算。</p><p id="0b50" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>我需要一个全世界海洋覆盖范围的运行总数，从最大到最小</p><p id="3886" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">表格结构</strong>:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nl"><img src="../Images/be1e68a55c495deb2e5e86f3d92042ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*9lnPgPmvCTFC4hmEMoUMEw.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="437d" class="ma jy hi lm b fi mb mc l md me">select name, type, square_km,        <br/>sum(square_km) over ( order by square_km desc            <br/>rows between unbounded preceding and current row ) as tot from water;</span></pre><p id="db8a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述:</strong>我需要一个世界范围内水域类型的海洋总覆盖范围的运行总数，从最大到最小</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="7e86" class="ma jy hi lm b fi mb mc l md me">select name, type, square_km,<br/>       sum(square_km) over ( <br/>       partition by type<br/>       order by square_km desc <br/>          rows between 1 preceding and 1 following <br/>) as tot<br/>from water<br/>order by square_km desc<br/>;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nm"><img src="../Images/f0d9f0a6ca96c978341095af0b37766b.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*YqWrMtYNREyHxwRpP8xMPw.png"/></div></figure><p id="5a41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述</strong>:每日推文的6个月移动平均值。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nn"><img src="../Images/78c09bfb768af6f296b0e6479a7f5628.png" data-original-src="https://miro.medium.com/v2/resize:fit:452/format:webp/1*qP-lSgaDPxR_pm2487CbCg.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="9486" class="ma jy hi lm b fi mb mc l md me">select dte, tweet_millions,<br/>avg(tweet_millions)<br/>over(<br/>order by dte<br/>range between interval '6' month preceding and current row) as average</span><span id="e402" class="ma jy hi lm b fi mx mc l md me">from tweets;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es no"><img src="../Images/1f7a4da8a3163da7f66caa173ebafdc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*AbWdhMGBSCcV8gjj7yscGw.png"/></div></figure><p id="807c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">问题陈述:让我看看英国历史上的预期寿命，并与两边的5年进行比较</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es np"><img src="../Images/c5d08ced88c8b8e5f4cd5a9e3799f309.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*UKj_Jj5q5PGI_PaCCdzx5w.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="f3c1" class="ma jy hi lm b fi mb mc l md me">select recorded_year, age,<br/>first_value(age)<br/>over(<br/>order by recorded_year<br/>range between interval '5' year preceding and interval '5' year following<br/>)as fv,<br/>last_value(age)<br/>over(<br/>order by recorded_year<br/>range between interval '5' year preceding and interval '5' year following</span><span id="b545" class="ma jy hi lm b fi mx mc l md me">) as lv<br/>from life_expectancy;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nq"><img src="../Images/ba3613d25c7d9483a6229c457275e7ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*LTPRXwFt7m6Gl0FWAZ6gTA.png"/></div></figure><p id="29c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">问题陈述:将纽约市的每日优步出行与7月至9月的第二低/最高进行比较</p><p id="a500" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">表格结构:</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nr"><img src="../Images/975f8d0f8107b0424ca00d47be669a72.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*FDdsUjeWpk-_Nw6nJwA4eg.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="c7f0" class="ma jy hi lm b fi mb mc l md me">select trip_Date, trip_count,</span><span id="5fef" class="ma jy hi lm b fi mx mc l md me">nth_value(trip_count, 2)<br/>over(<br/>order by trip_count<br/>rows between unbounded preceding and unbounded following</span><span id="f680" class="ma jy hi lm b fi mx mc l md me">)as secnd_lowest</span><span id="b3c7" class="ma jy hi lm b fi mx mc l md me">from trips<br/>order by trip_date</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ns"><img src="../Images/d393ee75eeb3f4b99dfdce83e10ae50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*bX3qmYtCKKFUtAj3OaUIPg.png"/></div></figure></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h1 id="a0c5" class="jx jy hi bd jz ka nt kc kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku bi translated">处理空值</h1><p id="cd1a" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated"><strong class="is hj">问题陈述</strong>:填写DEPTNPO表中的空值，按部门统计员工。</p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es ny"><img src="../Images/b493754cfc492ada26f03532cd00a5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*DCkU3h50Hp6SdvudzRctmw.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="6dcf" class="ma jy hi lm b fi mb mc l md me">select seq, empno, ename, job, mgr, hiredate, sal, deptno,<br/>last_value(deptno ignore nulls)<br/>over(order by seq) as dept<br/>from external_emp</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es nz"><img src="../Images/51629e16dd3140d805dea54e2ee6691d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*HS3orONjNXUsDQpnJwEBAA.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="fee2" class="ma jy hi lm b fi mb mc l md me">select dept, count(dept)</span><span id="30bf" class="ma jy hi lm b fi mx mc l md me">from <br/>(select seq, empno, ename, job, mgr, hiredate, sal, deptno,<br/>last_value(deptno ignore nulls)<br/>over(order by seq) as dept</span><span id="f4c9" class="ma jy hi lm b fi mx mc l md me">from external_emp) a</span><span id="58d5" class="ma jy hi lm b fi mx mc l md me">group by dept<br/>order by dept</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es oa"><img src="../Images/378084df81808677d5783682623fa944.png" data-original-src="https://miro.medium.com/v2/resize:fit:356/format:webp/1*JIJEwL5uCUOQcsIk9-lP5w.png"/></div></figure></div><div class="ab cl mz na gp nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="hb hc hd he hf"><h1 id="dd89" class="jx jy hi bd jz ka nt kc kd ke nu kg kh ki nv kk kl km nw ko kp kq nx ks kt ku bi translated">滞后和超前</h1><p id="6ff7" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">这是windows最重要的功能之一。在我最近的SQL面试中，我被问了3个关于提前和滞后的问题。lag函数将只提供上面一行的数据。</p><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="ca87" class="ma jy hi lm b fi mb mc l md me">LAG(<em class="ob">expression</em> [,<em class="ob">offset</em>[,<em class="ob">default_value</em>]]) OVER(ORDER BY <em class="ob">columns</em>)</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es oc"><img src="../Images/c4ad8bc869a139e277e1e4a78a0849d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*jgIeXovsy9lHDpNr2QFp0Q.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="f3a6" class="ma jy hi lm b fi mb mc l md me"><strong class="lm hj">SELECT</strong> <!-- -->seller_name, sale_value,</span><span id="9ad7" class="ma jy hi lm b fi mx mc l md me">LAG(sale_value) OVER(<strong class="lm hj">ORDER</strong> <strong class="lm hj">BY</strong> <!-- -->sale_value) <strong class="lm hj">as</strong> <!-- -->previous_sale_value</span><span id="3772" class="ma jy hi lm b fi mx mc l md me"><strong class="lm hj">FROM</strong> <!-- -->sale;</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es od"><img src="../Images/e6cc0bce89f178f19de432e511aa5115.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*A88aqk5w1-i-sPS-_dPNrA.png"/></div></figure><p id="8e21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">lead函数将做相反的事情。它将为我提供下面一行的值。现在来做一道复杂的题。</p><p id="a98a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">问题陈述</strong>:仅显示该特定订单的订单状态发生变化的日期。删除剩余的数据。</p><p id="9d6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">表格结构</strong></p><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es oe"><img src="../Images/3ca30f02865c50d7a526cee9fd814d74.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*7xPjNDwwH3gPrNaWOL7idA.png"/></div></figure><pre class="ls lt lu lv fd lw lm lx ly aw lz bi"><span id="770d" class="ma jy hi lm b fi mb mc l md me">select order_id, status_date,lead_status,status,<br/>lag(status_date)<br/>over(partition by order_id order by status_date ) from_date,<br/>status_date to_date<br/>from</span><span id="1a5f" class="ma jy hi lm b fi mx mc l md me">(select <br/>    order_id,<br/>    status_date,<br/>    status,<br/>    lag(status) over (partition by order_id order by status_date) lag_status,<br/>    lead(status) over (partition by order_id order by status_date) lead_status<br/>  from ORDERS)a<br/>  <br/>where lag_status is null<br/>       or lead_status is null<br/>       or lead_status &lt;&gt; status<br/>  order by order_id, from_date nulls first</span></pre><figure class="ls lt lu lv fd ij er es paragraph-image"><div class="er es of"><img src="../Images/592952f1a7bf3eb8ea90eee63d6d8f97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*N01cE6rDRb440r4CT25KJw.png"/></div></figure><h1 id="bf04" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结论</h1><p id="62c2" class="pw-post-body-paragraph iq ir hi is b it kv iv iw ix kw iz ja jb kx jd je jf ky jh ji jj kz jl jm jn hb bi translated">如果你能明智地使用这些功能，你的生活会变得更轻松。我在所有的面试中都被问到窗口功能，所以一定要练习它们。让我去掉对掌握这些功能有很大帮助的youtube频道名称。你可以<a class="ae og" href="https://www.youtube.com/watch?v=0cjxYMxa1e4&amp;list=PLJMaoEWvHwFIUwMrF4HLnRksF0H8DHGtt&amp;index=1" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">点击这里</strong> </a> <strong class="is hj"> </strong>观看视频</p></div></div>    
</body>
</html>