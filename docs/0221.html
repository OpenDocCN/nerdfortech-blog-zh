<html>
<head>
<title>Image Comparison Using Selenium-Shutterbug &amp; Romankh3/image-comparison</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Selenium-Shutterbug &amp; romankh 3/image-Comparison 进行图像比较</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/image-comparison-using-selenium-shutterbug-romankh3-image-comparison-a94de7c9644?source=collection_archive---------0-----------------------#2020-07-23">https://medium.com/nerd-for-tech/image-comparison-using-selenium-shutterbug-romankh3-image-comparison-a94de7c9644?source=collection_archive---------0-----------------------#2020-07-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fb00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将解释我们如何比较基础图像和修改后的图像。请参考以下图片:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c1763ab184f866f105558f5d690faf66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_x7J6fdVl8n5Bajyk8zQg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">原象</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/9a7c4cfdd45ee0674b5edd8576d7f80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DWZcQHCKW3fLwhhJkLx2_Q.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">改变的图像</figcaption></figure><h2 id="e0dd" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">让我们找到可以作为自动化解决方案提供的技术</h2><ol class=""><li id="5f8c" class="ko kp hi ih b ii kq im kr iq ks iu kt iy ku jc kv kw kx ky bi translated"><a class="ae kz" href="https://github.com/romankh3/image-comparison" rel="noopener ugc nofollow" target="_blank">https://github.com/romankh3/image-comparison</a></li><li id="2703" class="ko kp hi ih b ii la im lb iq lc iu ld iy le jc kv kw kx ky bi translated">https://github.com/assertthat/selenium-shutterbug<a class="ae kz" href="https://github.com/assertthat/selenium-shutterbug" rel="noopener ugc nofollow" target="_blank"/></li><li id="ad4f" class="ko kp hi ih b ii la im lb iq lc iu ld iy le jc kv kw kx ky bi translated">【https://www.selenium.dev/documentation/ T4】</li></ol><h2 id="3a25" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">然后让我们来看编码</h2><p id="8917" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">首先，我们必须创建一个 maven java 项目。<a class="ae kz" href="https://dev.cloudburo.net/2017/06/18/java-for-beginners-1-prepare-an-intellij-maven-project.html" rel="noopener ugc nofollow" target="_blank">https://dev . cloud buro . net/2017/06/18/Java-for-初学者-1-prepare-an-intellij-maven-project . html</a></p><p id="1f18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们必须在 pom.xml 中插入以下依赖项</p><p id="efdc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> &lt;依赖关系&gt; <br/> &lt;依赖关系&gt;<br/>&lt;groupId&gt;org . selenium HQ . selenium&lt;/groupId&gt;<br/>&lt;artifactId&gt;selenium-Java&lt;/artifactId&gt;<br/>&lt;版本&gt;3 . 141 . 59&lt;/版本&gt;<br/>&lt;/依赖关系&gt; &lt;groupId&gt;org . selenium HQ . selenium&lt;/groupId&gt;<br/>&lt;artifactId&gt;selenium-remote-driver&lt;/artifactId&gt;<br/>&lt;版本&gt;3 . 141 . 59&lt;/版本&gt;<br/>&lt;/依赖关系&gt; <br/> &lt;依赖关系&gt; <br/> &lt;</em></p><p id="cdec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后创建一个名为 snapshot 的类</p><p id="4cd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们必须实现一个方法，使用这些图像的路径来比较两个图像。</p><p id="2b4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">public static void compare images(String expected path，String actualPath){ <br/> //加载要比较的图像<br/>buffered image expected image = image comparison util . readimagefromresources(expected path)；<br/>buffered image actual image = image comparison util . readimagefromresources(actual path)；</em></p><p id="45aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> //保存结果的位置(如果想在 UI 中看到结果请留空)<br/>File result destination = new File(" src/main/resources/Images/result . png ")；</em></p><p id="5d9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//为其创建 ImageComparison 对象。<br/>image comparison image comparison = new image comparison(expected image，actualImage，result destination)；</em></p><p id="58c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//也可以在比较下一个属性之前配置:</em></p><p id="8b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//Threshold——不相等像素之间的最大距离。默认情况下是 5。<br/>image comparison . setthreshold(5)；<br/>image comparison . getthreshold()；</em></p><p id="c35a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> //RectangleListWidth —在矩形中绘制的线条的宽度。默认情况下是 1。<br/>image comparison . setrectanglelinewidth(1)；<br/>image comparison . getrectanglelinewidth()；</em></p><p id="5383" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//differencertanglefilling—用透明填充填充差异矩形的内部。默认情况下，它是假的，不透明度为 20.0%。<br/>image comparison . setdifferencertanglefilling(true，20.0)；<br/>image comparison . isfilldeffecterangles()；<br/>image comparison . getpercentopacitydifferencertangles()；</em></p><p id="eb28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//ExcludedRectangleFilling—用透明填充填充排除的矩形内部。默认情况下，它是假的，不透明度为 20.0%。<br/>image comparison . setexcludedrectanglefilling(true，20.0)；<br/>image comparison . isfillexcludedrectangles()；<br/>image comparison . getpercentopacityexcluded rectangles()；</em></p><p id="4d17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//目的地。在比较之前，也可以为结果图像添加目标文件。<br/>image comparison . set destination(结果目的地)；<br/>image comparison . get destination()；</em></p><p id="7d28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//MaximalRectangleCount——表示将获得前 x 个最大的矩形进行绘制。<br/> //默认情况下，所有的矩形都会被绘制出来。<br/>image comparison . setmaximalrectanglecount(10)；<br/>image comparison . getmaximalrectanglecount()；</em></p><p id="87ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> //MinimalRectangleSize —最小矩形尺寸的数量。计为(宽 x 高)。<br/> //默认为 1。<br/>image comparison . setminimalrectanglesize(1)；<br/>image comparison . getminimalrectanglesize()；</em></p><p id="f81f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//改变像素容差的级别:<br/>image comparison . setpixeltolerancelevel(0.2)；<br/>image comparison . getpixeltlerancelevel()；</em></p><p id="5dc4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//配置完 ImageComparison 对象后，可以执行 compare()方法:<br/>ImageComparisonResult ImageComparisonResult = image comparison . compare images()；</em></p><p id="ec6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//可以找到 ComparisonState。<br/>ImageComparisonState ImageComparisonState = imagecomparisonresult . getimagecomparisonstate()；</em></p><p id="3b96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//和结果图像<br/>buffered Image Result Image = imagecomparisonresult . get Result()；</em></p><p id="b278" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">//比较后可以保存图像，使用 ImageComparisonUtil。<br/>if(imagecomparisonresult . getdifference percent()&gt;0.0)imagecomparisonutil . save image(result destination，result image)；<br/> } </em></p><p id="65f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们必须编写可执行代码块来捕获预期的和实际的图像。</p><p id="ca0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kz" href="http://twitter.com/Test" rel="noopener ugc nofollow" target="_blank"><em class="li">@ Test</em></a><em class="li"><br/>public static void take screen shot(){</em></p><p id="44fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">system . set property(" web driver . chrome . driver "，" src/main/resources/chrome driver ")；</em></p><p id="3e75" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">web driver driver = new chrome driver()；</em></p><p id="c141" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> driver.manage()。窗口()。最大化()；</em></p><p id="bbea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li"> driver.navigate()。到("</em><a class="ae kz" href="https://www.google.lk" rel="noopener ugc nofollow" target="_blank"><em class="li">)https://www . Google . lk</em></a><em class="li">)；</em></p><p id="c955" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">试试{<br/>imageio . write(shutterbug . shootpage(driver，ScrollStrategy。全 _ 页)。getImage()，“PNG”，新文件(“src/main/resources/Images/expected . PNG”)；</em></p><p id="1471" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">} catch(Exception e){<br/>system . out . println(e)；<br/> } <br/>试试{<br/></em><strong class="ih hj"><em class="li">imageio . write(shutterbug . shootpage(driver，ScrollStrategy。全 _ 页)。getImage()，“PNG”，新文件(“src/main/resources/Images/actual . PNG”)；</em> </strong></p><p id="b9b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="li">} catch(Exception e){<br/>system . out . println(e)；<br/> } <br/>比较图像(" src/main/resources/Images/expected . png "，" src/main/resources/Images/actual . png ")；<br/>driver . quit()；<br/> } </em></p><p id="2f9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在将调试点设置在加粗的代码块前面，并在调试模式下运行测试。捕获第一张图像后，将停止执行。然后，您必须使用 dev 工具修改图像。请参考上面更改后的图像。完成更改后，请继续执行。</p><p id="6624" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，您可以在执行成功完成后获得对比图像。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ec4bf50c4264e5c1f76073a3e92a6cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e5sQdExdIxPsd-c_tBkKyQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">结果图像</figcaption></figure></div></div>    
</body>
</html>