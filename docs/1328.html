<html>
<head>
<title>Build Your Own Spotify with Linux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Linux构建自己的Spotify</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/build-your-own-spotify-with-linux-d46aa96c251e?source=collection_archive---------3-----------------------#2021-03-14">https://medium.com/nerd-for-tech/build-your-own-spotify-with-linux-d46aa96c251e?source=collection_archive---------3-----------------------#2021-03-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="50c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我离开家的时间越来越多，我想把我的音乐带在身边，没有广告或跟踪。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/11830fa1638475e55040eebf1cfd04ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eV5Tts5QC1vUDXRnagPc-A.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Jellyfin为我提供了一个很好的音乐流媒体服务的替代品</figcaption></figure><h1 id="8531" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么要这么做？</h1><p id="8cf1" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我实际上不使用Spotify，我使用Apple Music来满足我的流媒体音乐需求。我是一个iPhone用户，跳槽了，但仍然订阅了苹果音乐，因为我积累了所有的播放列表。今年夏天，作为一个项目，我用一些备用零件(一个树莓派3B+和一个USB 1 TB笔记本电脑硬盘)建造了一个<a class="ae kw" href="https://jellyfin.org/" rel="noopener ugc nofollow" target="_blank"> Jellyfin </a>服务器，这非常令人惊讶。这不是理想的设置，3B+缺乏千兆以太网，USB 3.0，以及有效处理流媒体视频的处理器和内存，尽管我确实看了很多视频。然而，它可以毫无问题地处理我的大量音乐库。我以前做过DJ，收集音乐。我有很多从黑胶唱片上撕下来的专辑。我的数字音乐收藏在1.1k左右的专辑。我想通过互联网访问它，这样我就不需要为流媒体音乐付费了。此外，我所听到的将是我和我的服务器之间，没有第三方。</p><h1 id="2a83" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">这个计划</h1><p id="5cbe" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我不能一直用3B+，是时候买个Pi 4B了。我还需要添加一个代理、一个证书和一个动态DNS名称。我订购了一个Pi 4B、一个Flirc外壳和一个带有USB 3.0外部外壳的2 TB 3.5英寸驱动器。我已经和几个提供商建立了动态DNS，我建议你也这样做。我为这个项目添加了一个子域到我的<a class="ae kw" href="https://www.dynu.com/en-US/" rel="noopener ugc nofollow" target="_blank"> Dynu </a> DDNS配置中。我用Rasbian Lite闪存了一个Micro SD，<a class="ae kw" href="https://engineerworkshop.com/blog/setup-an-nginx-reverse-proxy-on-a-raspberry-pi-or-any-other-debian-os/" rel="noopener ugc nofollow" target="_blank">为Nginx </a>配置了一个备用的3B+。Pi 4B一到，我就把它安装在Flirc的盒子里，把我所有的数据从旧的Jellyfin服务器转移到新的硬盘上，然后把Jellyfin安装在Pi 4B上。Jellyfin的文档说主动冷却被推荐用于Pi 4B，但是他们参考了Jeff Geerling，并且<a class="ae kw" href="https://www.jeffgeerling.com/blog/2019/best-way-keep-your-cool-running-raspberry-pi-4" rel="noopener ugc nofollow" target="_blank">他推荐Flirc用于大多数用途</a>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/b60cae709e5c9ea06b102554ab909b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7LKo515fYT3Zp3KE9894uA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Flirc的案子很漂亮。</figcaption></figure><h1 id="1550" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">把所有的放在一起</h1><p id="9c8f" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">我在Reddit 上找到了这个在Pi 4B <a class="ae kw" href="https://www.reddit.com/r/jellyfin/comments/ei6ew6/rpi4_hardware_acceleration_guide/" rel="noopener ugc nofollow" target="_blank">上安装Jellyfin的伟大指南。一旦我在本地测试了我的Jellyfin服务器，我就必须配置我的Ngnix代理。将80和443从我的路由器转发到我的Nginx代理后，我需要一个证书，所以我安装了docker和docker-compose并使用了</a><a class="ae kw" href="https://github.com/linuxserver/docker-swag/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> SWAG </a>。我只是需要证书，所以我配置了docker-compose.yml并运行<code class="du ky kz la lb b">docker-compse up</code>来观察输出。一旦我有了证书，我就停止了集装箱。证书的有效期是三个月，所以我必须停止Nginx并再次运行docker来更新它。然后我需要一个代理配置。Jellyfin docs上的那个对我不起作用，所以我用这个来研究我的问题。</p><pre class="je jf jg jh fd lc lb ld le aw lf bi"><span id="8970" class="lg ju hi lb b fi lh li l lj lk">server {<br/>    server_name TV.EXAMPLE.COM;<br/>    listen 443 ssl http2; # managed by Certbot<br/>    <br/>    access_log /var/log/nginx/TV.EXAMPLE.COM.access.log;<br/>    error_log /var/log/nginx/TV.EXAMPLE.COM.error.log;<br/>            <br/>    ssl_certificate /etc/letsencrypt/live/TV.EXAMPLE.COM/fullchain.pem; # managed by Certbot<br/>    ssl_certificate_key /etc/letsencrypt/live/TV.EXAMPLE.COM/privkey.pem; # managed by Certbot<br/>    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot<br/>    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot<br/>    ssl_trusted_certificate /etc/letsencrypt/live/TV.EXAMPLE.COM/chain.pem;<br/>    ssl_stapling on;<br/>    ssl_stapling_verify on;<br/>    add_header Strict-Transport-Security "max-age=31536000" always;</span><span id="90ae" class="lg ju hi lb b fi ll li l lj lk"># Security / XSS Mitigation Headers<br/>    add_header X-Frame-Options "SAMEORIGIN";<br/>    add_header X-XSS-Protection "1; mode=block";<br/>    add_header X-Content-Type-Options "nosniff";</span><span id="60ad" class="lg ju hi lb b fi ll li l lj lk"># Content Security Policy<br/>    # See: <a class="ae kw" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" rel="noopener ugc nofollow" target="_blank">https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a><br/>    # Enforces https content and restricts JS/CSS to origin<br/>    # External Javascript (such as cast_sender.js for Chromecast or YouTube embed JS for external trailers) must be whitelisted.<br/>    add_header Content-Security-Policy "default-src https: data: blob:; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' <a class="ae kw" href="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js" rel="noopener ugc nofollow" target="_blank">https://www.gstatic.com/cv/js/sender/v1/cast_sender.js</a> <a class="ae kw" href="https://www.youtube.com/iframe_api" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/iframe_api</a> <a class="ae kw" href="https://s.ytimg.com" rel="noopener ugc nofollow" target="_blank">https://s.ytimg.com</a>; worker-src 'self' blob:; connect-src 'self'; object-src 'none'; frame-ancestors 'self'";<br/>    <br/>    location ~ /.well-known {<br/>        allow all;<br/>    }<br/>    location / {<br/>        # Proxy main Jellyfin traffic<br/>        proxy_pass <a class="ae kw" href="http://192.168.1.54:8096/" rel="noopener ugc nofollow" target="_blank">http://192.168.1.54:8096/</a>;<br/>        proxy_set_header Host $host;<br/>        proxy_set_header X-Real-IP $remote_addr;<br/>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header X-Forwarded-Proto $scheme;<br/>        proxy_set_header X-Forwarded-Protocol $scheme;<br/>        proxy_set_header X-Forwarded-Host $http_host;</span><span id="26d5" class="lg ju hi lb b fi ll li l lj lk"># Disable buffering when the nginx proxy gets very resource heavy upon streaming<br/>        proxy_buffering off;<br/>    }<br/>    location /socket {<br/>        # Proxy Jellyfin Websockets traffic<br/>        proxy_pass <a class="ae kw" href="http://192.168.1.54:8096/socket" rel="noopener ugc nofollow" target="_blank">http://192.168.1.54:8096/socket</a>;<br/>        proxy_http_version 1.1;<br/>        proxy_set_header Upgrade $http_upgrade;<br/>        proxy_set_header Connection "upgrade";<br/>        proxy_set_header Host $host;<br/>        proxy_set_header X-Real-IP $remote_addr;<br/>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/>        proxy_set_header X-Forwarded-Proto $scheme;<br/>        proxy_set_header X-Forwarded-Protocol $scheme;<br/>        proxy_set_header X-Forwarded-Host $http_host;<br/>    }<br/>}<br/>server {<br/>    if ($host = TV.EXAMPLE.COM) {<br/>        return 301 <a class="ae kw" href="https://$host$request_uri" rel="noopener ugc nofollow" target="_blank">https://$host$request_uri</a>;<br/>    } # managed by Certbot</span><span id="623a" class="lg ju hi lb b fi ll li l lj lk">listen 80;<br/>    server_name TV.EXAMPLE.COM;<br/>    <br/>    return 404; # managed by Certbot<br/>}</span></pre><p id="e2e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我需要一个<code class="du ky kz la lb b">options-ssl-nginx.conf</code>，所以<a class="ae kw" href="https://gist.github.com/cecilemuller/a26737699a7e70a7093d4dc115915de8" rel="noopener ugc nofollow" target="_blank">我在这里找到了一个例子</a>。我稍微修改了一下，从ssl_protocols中删除了TLSv1。我启动了Nginx服务，一切正常。我可以通过我配置的DDNS URL查看我的Jellyfin服务器。我用<a class="ae kw" href="https://www.digicert.com/help/" rel="noopener ugc nofollow" target="_blank"> digicert测试页面</a>测试了我的SSL配置，一切都测试良好。我在手机上重新配置了<a class="ae kw" href="https://f-droid.org/en/packages/com.dkanada.gramophone/" rel="noopener ugc nofollow" target="_blank"> Gelli </a>,使用DDNS网址和我在Jellyfin服务器上创建的一个允许外部登录的登录名。我可以登录并在4G LTE上看到我的音乐。所以我点击了播放，并且成功了。</p><h1 id="6b1c" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">这有回报吗？</h1><p id="609d" class="pw-post-body-paragraph if ig hi ih b ii kr ik il im ks io ip iq kt is it iu ku iw ix iy kv ja jb jc hb bi translated">从那以后，我在步行和乘火车去市中心的办公室时都用手机打电话。我已经从办公室的工作网络浏览器登录到我的服务器。它非常成功，我取消了苹果音乐订阅，卸载了应用程序。所有我喜欢的音乐都可以在我的手机上找到，而且我有数百千兆字节的空间来存放新音乐。Pi 4B在转码和散热方面的表现也非常出色。这得到了回报。这不是一个容易的项目，但如果你有音乐收藏，我会推荐它。在电视上看你最喜欢的老动漫也很棒。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/20860703b1b1e245739e759944692a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tkpnb6L9a28f71GJkAbldw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">14天内Pi 4B的核心温度</figcaption></figure></div></div>    
</body>
</html>