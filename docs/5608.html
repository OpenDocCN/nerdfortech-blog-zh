<html>
<head>
<title>Kubernetes Readiness Probes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes 就绪探测器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/kubernetes-readiness-probes-722278ca9a0b?source=collection_archive---------7-----------------------#2021-10-22">https://medium.com/nerd-for-tech/kubernetes-readiness-probes-722278ca9a0b?source=collection_archive---------7-----------------------#2021-10-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/72b7b8533cb9629008d2fb372eef8598.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/format:webp/1*8MXW6IimGvLxRt04Z7IoCQ.jpeg"/></div></div></figure><h1 id="a140" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">描述</h1><ul class=""><li id="e8f3" class="jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">我们了解活性探测器以及它们通过确保不健康的容器自动重启来帮助我们的应用保持健康的方式。与活性探针一样，<a class="ae kg" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>允许我们定义 pod 的就绪状态。</li><li id="f960" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">准备就绪探测器被周期性地部署，并且检查精确的 pod 是否应该接收客户端请求。</li><li id="02db" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">每当容器的准备就绪探测返回成功时，就表示容器已经准备好接受请求。</li><li id="3c0d" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">这种做好准备的概念显然是每个容器特有的。</li><li id="93ce" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">几乎在活性探测器<a class="ae kg" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>向容器发送请求并支持成功或不成功响应的结果时，它决定容器准备请求流量或仍在为此做准备。</li><li id="a46d" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">活性探测器不像，如果一个容器没有通过就绪检查，它不会被终止或重新启动。</li><li id="d634" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">这是一个非常好的做法，总是添加一个就绪探测器，即使它是容器中最简单的应用程序。</li></ul><h1 id="56e5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">就绪探测器类型</h1><p id="eb3c" class="pw-post-body-paragraph km kn hi jq b jr js ko kp jt ju kq kr jv ks kt ku jx kv kw kx jz ky kz la kb hb bi translated">有三种就绪性探测。</p><p id="56ca" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated"><strong class="jq hj"> 1。HTTP GET </strong></p><ul class=""><li id="6172" class="jo jp hi jq b jr lb jt lc jv lg jx lh jz li kb kc kd ke kf bi translated">这种类型的探测器在我们指定的<a class="ae kg" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank">容器的 IP 地址</a>、端口和路径上传送请求。</li><li id="ddf3" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">探测总是考虑到故障，并且容器将被视为未准备好，并且没有流量将被转移到那里。</li></ul><p id="5629" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated"><strong class="jq hj"> 2。TCP 套接字</strong></p><ul class=""><li id="2af9" class="jo jp hi jq b jr lb jt lc jv lg jx lh jz li kb kc kd ke kf bi translated">TCP 套接字探针努力打开到容器所需端口的 TCP 连接。</li><li id="c2b6" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">如果连接建立成功，<a class="ae kg" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank">容器</a>将被标记为就绪，它将接收流量。</li><li id="ab13" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">Kubernetes 是另一个案例，它将等待并运行探测器以再次查看状态。</li></ul><p id="ce21" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated"><strong class="jq hj"> 3。执行探针</strong></p><ul class=""><li id="932a" class="jo jp hi jq b jr lb jt lc jv lg jx lh jz li kb kc kd ke kf bi translated">EXEC 探测器执行您在<a class="ae kg" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank">容器</a>中提供的一些命令，并检查命令的退出状态代码。</li><li id="7cef" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">如果状态代码为 0，则探测成功。</li><li id="cb71" class="jo jp hi jq b jr kh jt ki jv kj jx kk jz kl kb kc kd ke kf bi translated">所有其他代码都被视为失败。</li></ul><h1 id="0b8e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">就绪探测示例</h1><p id="cbf6" class="pw-post-body-paragraph km kn hi jq b jr js ko kp jt ju kq kr jv ks kt ku jx kv kw kx jz ky kz la kb hb bi translated"><strong class="jq hj"> my-rn-exec.yaml </strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="a878" class="ls ir hi lo b fi lt lu l lv lw">Kind: Pod</span><span id="768c" class="ls ir hi lo b fi lx lu l lv lw">apiversion: v1</span><span id="8df5" class="ls ir hi lo b fi lx lu l lv lw">metadata:</span><span id="f655" class="ls ir hi lo b fi lx lu l lv lw">name: myapp-rn-exc</span><span id="e1cd" class="ls ir hi lo b fi lx lu l lv lw">Spec:</span><span id="9825" class="ls ir hi lo b fi lx lu l lv lw">Containers:</span><span id="c84e" class="ls ir hi lo b fi lx lu l lv lw">-name: my app</span><span id="9ba3" class="ls ir hi lo b fi lx lu l lv lw">image: ahmedmansoor/hi</span><span id="73b6" class="ls ir hi lo b fi lx lu l lv lw">Ports:</span><span id="93be" class="ls ir hi lo b fi lx lu l lv lw">-containerPort: 80</span><span id="ef8f" class="ls ir hi lo b fi lx lu l lv lw">Readiness Probe:</span><span id="0039" class="ls ir hi lo b fi lx lu l lv lw">exec:</span><span id="9b7c" class="ls ir hi lo b fi lx lu l lv lw">command:</span><span id="4042" class="ls ir hi lo b fi lx lu l lv lw">-ls</span><span id="e0ed" class="ls ir hi lo b fi lx lu l lv lw">-/tmp/ready</span></pre><p id="afa7" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated"><strong class="jq hj"> my-rn-tcp.yaml </strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="499d" class="ls ir hi lo b fi lt lu l lv lw">Kind: Pod</span><span id="0be2" class="ls ir hi lo b fi lx lu l lv lw">apiversion: v1</span><span id="87dc" class="ls ir hi lo b fi lx lu l lv lw">metadata:</span><span id="69b4" class="ls ir hi lo b fi lx lu l lv lw">name: myapp-rn-tcp</span><span id="ec70" class="ls ir hi lo b fi lx lu l lv lw">Spec:</span><span id="151f" class="ls ir hi lo b fi lx lu l lv lw">Containers:</span><span id="a4a6" class="ls ir hi lo b fi lx lu l lv lw">-name: my app</span><span id="df8f" class="ls ir hi lo b fi lx lu l lv lw">image: ahmedmansoor/hi</span><span id="6e05" class="ls ir hi lo b fi lx lu l lv lw">Ports:</span><span id="f273" class="ls ir hi lo b fi lx lu l lv lw">-containerPort: 80</span><span id="88e1" class="ls ir hi lo b fi lx lu l lv lw">Readiness Probe:</span><span id="77b2" class="ls ir hi lo b fi lx lu l lv lw">tcpSocket</span><span id="3be6" class="ls ir hi lo b fi lx lu l lv lw">Port : 8080</span></pre><p id="060a" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated"><strong class="jq hj"> my-rn-http.yaml </strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="7a59" class="ls ir hi lo b fi lt lu l lv lw">Kind: Pod</span><span id="84aa" class="ls ir hi lo b fi lx lu l lv lw">apiversion: v1</span><span id="d2d0" class="ls ir hi lo b fi lx lu l lv lw">metadata:</span><span id="b75e" class="ls ir hi lo b fi lx lu l lv lw">name:myapp-rn-http</span><span id="4a81" class="ls ir hi lo b fi lx lu l lv lw">Spec:</span><span id="8539" class="ls ir hi lo b fi lx lu l lv lw">Containers:</span><span id="27c6" class="ls ir hi lo b fi lx lu l lv lw">-name: my app</span><span id="d9bf" class="ls ir hi lo b fi lx lu l lv lw">image: ahmedmansoor/hi</span><span id="d35a" class="ls ir hi lo b fi lx lu l lv lw">Ports:</span><span id="3f3e" class="ls ir hi lo b fi lx lu l lv lw">-containerPort:80</span><span id="2cda" class="ls ir hi lo b fi lx lu l lv lw">Readiness Probe:</span><span id="0560" class="ls ir hi lo b fi lx lu l lv lw">http Get:</span><span id="7d0f" class="ls ir hi lo b fi lx lu l lv lw">Port: 80 path:/</span></pre><p id="8782" class="pw-post-body-paragraph km kn hi jq b jr lb ko kp jt lc kq kr jv ld kt ku jx le kw kx jz lf kz la kb hb bi translated">更多详情请访问:<a class="ae kg" href="https://www.technologiesinindustry4.com/2020/10/kubernetes-readiness-probes.html" rel="noopener ugc nofollow" target="_blank">https://www . technologiesinindustry 4 . com/2020/10/kubernetes-readiness-probes . html</a></p></div></div>    
</body>
</html>