<html>
<head>
<title>How Heroku Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Heroku是如何工作的</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-heroku-works-7b342a2ce066?source=collection_archive---------21-----------------------#2021-05-24">https://medium.com/nerd-for-tech/how-heroku-works-7b342a2ce066?source=collection_archive---------21-----------------------#2021-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/bc03167c61f2eee2a5e22ef22402bc84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5I76h3_wPEGZAPvIrIc8Nw.jpeg"/></div></div></figure><p id="01ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我开始在空闲时间研究Heroku，将其作为创建个人应用程序的一个选择。事实上，我将AWS生态系统中的一个现有应用程序转换到Heroku，这是DZone.com上的一个系列:</p><p id="e588" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://dzone.com/articles/moving-away-from-aws-and-onto-heroku" rel="noopener ugc nofollow" target="_blank">从AWS转移到Heroku </a></p><p id="27f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从Heroku的一个全新想法开始，我也能够快速创建一个基于健身的SaaS解决方案，这在DZone.com上的另一个系列中有记录:</p><p id="f31e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://dzone.com/articles/using-heroku-to-quickly-build-a-multi-tenant-saas" rel="noopener ugc nofollow" target="_blank">使用Heroku快速构建多租户SaaS产品</a></p><p id="7910" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我的几个应用程序中使用Heroku已经一年多了，我想我应该后退一步，描述Heroku是如何工作的，并就为什么Salesforce拥有的解决方案应该成为您下一个项目的考虑因素提供一些想法。</p><h1 id="b561" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是Heroku？</h1><p id="b2bf" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Heroku成立于2007年，是一个平台即服务(PaaS)生态系统，目前支持Ruby、Java、Node.js、Scala、Clojure、Python、PHP和Go编程语言(以及对许多其他语言的社区支持)。因为它能够支持多种语言来完成相同的结果，Heroku被认为是一个<a class="ae jo" href="https://en.wikipedia.org/wiki/Polyglot_(computing)" rel="noopener ugc nofollow" target="_blank">多语言</a>平台。</p><p id="3938" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在最高层次上，Heroku旨在满足寻找住处的应用程序的需求。开发人员从创建Heroku“应用”开始，并通过标准化的git存储库引入他们的原始代码。Heroku只是从这里开始——构建和部署应用程序，然后根据需要提供给用户。这包括静态资源(如Angular或React.js应用程序)，可以从Node.js实现中提供。</p><p id="be5d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku提供超过175种附加服务来补充每个应用程序，包括:</p><ul class=""><li id="df3c" class="ks kt hi is b it iu ix iy jb ku jf kv jj kw jn kx ky kz la bi translated">数据库服务</li><li id="5974" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">正常运行时间警报</li><li id="bff8" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">消息服务</li><li id="6102" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">自动备份</li><li id="ff84" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">搜索</li><li id="f365" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">韵律学</li><li id="18b4" class="ks kt hi is b it lb ix lc jb ld jf le jj lf jn kx ky kz la bi translated">邮件传递</li></ul><p id="1d49" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下面是一个我的个人应用程序，它利用了Heroku中的数据库、安全性和消息传递功能:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/fc786adee63f2a9d5f7600ce3c65f8fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ke_iy-VCfhyfTE9.png"/></div></div></figure><p id="5e7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku尽一切可能让用户专注于在他们的应用程序中构建特性和功能。采用这种方法，您可以避免学习、实施、管理和支持DevOps驱动的应用程序部署路径所需的时间。</p><p id="9a72" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku自2010年以来一直是Salesforce公司，是2.12亿美元收购的一部分。事实上，Salesforce首席执行官Marc Benioff表示:</p><blockquote class="ll lm ln"><p id="fe92" class="iq ir lo is b it iu iv iw ix iy iz ja lp jc jd je lq jg jh ji lr jk jl jm jn hb bi translated"><em class="hi">“</em><a class="ae jo" href="https://www.salesforce.com/news/press-releases/2011/01/03/salesforce-com-completes-acquisition-of-heroku/" rel="noopener ugc nofollow" target="_blank"><em class="hi">有了Heroku，我们的平台可以成为下一代云计算的基石。”</em></a><em class="hi"><br/>Marc Benioff——sales force董事长兼首席执行官</em></p></blockquote><h1 id="2404" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Heroku的特征</h1><p id="b455" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Heroku不仅仅是一个部署和存放应用程序的地方，它提供了补充应用程序托管和管理的所有必要方面。在这篇文章中，我将关注Heroku的四个有趣的方面。</p><h1 id="6648" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">1.构建包和Slugs</h1><p id="7965" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Buildpacks是Heroku生态系统内部的机制，它编译应用程序代码并创建“slug”slug是应用程序的预打包副本(包括任何必要的运行时层),经过优化后可以发布到dyno中。为了更好地理解这个概念，请看下图:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/ad059c79f58945e6254cdeebf117b961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XDyGOtzNjKgg3w1D.png"/></div></div></figure><p id="8e69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为在Heroku中创建新应用程序的一部分，从包含要部署的源代码的存储库中创建一个git remote。准备就绪后，发出一个标准化的<code class="du lt lu lv lw b">git push</code>命令，同时指定目标主机和分支。在上面的示例中，发出<code class="du lt lu lv lw b">git push heroku master</code>命令将当前分支推送到“heroku”远程中的“主”分支。</p><p id="01cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这将触发Heroku开始处理请求。第一步是扫描项目，了解Heroku配置中是否指定了buildpack。如果使用上述受支持的语言之一，这一步是不必要的，因为Heroku会自动选择正确的构建包。如果您没有使用官方支持的语言，您可以创建一个定制的构建包，或者您可以从<a class="ae jo" href="https://elements.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Elements Marketplace </a>的6000多个第三方构建包中选择。</p><p id="87f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，buildpack告诉Heroku如何检索运行应用程序所需的所有依赖项和运行时。此操作的结果是创建一个应用程序段。Heroku然后将这个slug部署到一个(或多个)dynos上，并运行buildpack或用户指定的命令来启动应用程序。</p><h1 id="c0cb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2.动态、配置变量和版本</h1><p id="46e5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在上一节中，我们使用buildpack和slug在Heroku中启动了一个新的应用程序。应用程序本身运行在Heroku dyno中，这是Heroku平台的核心。Dynos是基于Linux的容器，它们是独立的，旨在根据用户指定的命令执行代码。(Heroku提出了术语dyno，因为当时Docker还没有提出或推广术语container。)由于这种设计，Heroku允许dynos按比例放大(或缩小)以满足容量需求。</p><p id="a573" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了避免在应用程序的源代码中包含敏感的配置信息，Heroku提供了一种存放配置变量的机制。对于命令行用户，<code class="du lt lu lv lw b">heroku config</code>命令提供以下信息:</p><pre class="lh li lj lk fd lx lw ly lz aw ma bi"><span id="76a5" class="mb jq hi lw b fi mc md l me mf">╭─me@mbp ~/new-dyno ‹master›<br/>╰─$ heroku config<br/>=== new-dyno Config Vars<br/>DATABASE_URL:      mysql://someUser:somePassword@someHost.net/someService?reconnect=true<br/>CLIENT_ID:         myAuthClientId<br/>CLIENT_SECRET:     myAuthSecreteId</span></pre><p id="a3c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku仪表盘的“设置”选项卡中有一个基于网络的补充版本:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/32ad93178f8564afa21648bb0ffee753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Rzto_mrBmYE5-n9V.png"/></div></div></figure><p id="ef42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每当部署代码、更改配置变量或修改附加资源时，Heroku都会创建一个新版本并重启dyno应用程序。这是Heroku的一个经常被忽视的特性，因为Heroku总是提供轻松回滚到先前状态的能力。</p><p id="acea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">发布历史可以在Heroku仪表板中获得，也可以通过<code class="du lt lu lv lw b">heroku releases</code>命令行获得:</p><pre class="lh li lj lk fd lx lw ly lz aw ma bi"><span id="cf35" class="mb jq hi lw b fi mc md l me mf">╭─me@mbp ~/new-dyno ‹master›<br/>╰─$ heroku releases<br/>=== new-dyno Releases - Current: v3<br/>v3  Deploy 2b93a215                            me@example.com  2021/03/23 07:49:35 -0400<br/>v2  Set CLIENT_ID, CLIENT_SECRET config vars   me@example.com  2021/03/19 07:26:34 -0400<br/>v1  Deploy 40e37807                            me@example.com  2021/03/19 06:48:00 -0400</span></pre><h1 id="4232" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">3.Heroku附件</h1><p id="c5ce" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">产品或平台的适应性在很大程度上依赖于库或服务，只需点击鼠标按钮或发出简单的命令行语句即可获得这些库或服务。目前，Heroku包括超过175个附加产品，涵盖超过24个不同类别的附加产品。下面是Heroku Marketplace的当前截图，在这里可以查看附加组件并立即添加到现有的应用程序中。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/2648055ce18fa93bd259d6bf30d90bfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*XH4AfnRHQL4kJy2v.png"/></div></div></figure><p id="bc5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大多数Heroku附加组件提供免费使用或试用期。这两种选择都允许开发人员在进行长期投资之前更好地了解产品。</p><p id="ede4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就我个人而言，我已经利用免费试用层来比较在同一领域竞争的解决方案。事实上，加载项可以像安装时一样快速删除。</p><h1 id="fe9f" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">4.记录和路由</h1><p id="7c3c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Heroku通过自动整理和路由来自应用程序每个部分的日志到一个通道来简化日志记录。这提供了真正全面和可扩展的以应用程序为中心的日志记录。</p><p id="8209" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Heroku使用<a class="ae jo" href="https://devcenter.heroku.com/articles/logplex" rel="noopener ugc nofollow" target="_blank"> Logplex </a>进行分布式日志路由和整理。使用命令行界面，可以发出以下命令来查看当前日志:</p><pre class="lh li lj lk fd lx lw ly lz aw ma bi"><span id="7e43" class="mb jq hi lw b fi mc md l me mf">╭─me@mbp ~/new-dyno ‹master›<br/>╰─$ heroku logs --tail </span><span id="aca0" class="mb jq hi lw b fi mi md l me mf">2021-03-28T20:45:30 app[web.1]: 2021-03-28 20:45:30.020  INFO 4 --- [scheduling-1] c.g.j.f.services.SmsService : sendSmsSummaryMessages() completed<br/>2021-03-28T20:50:00 app[web.1]: 2021-03-28 20:50:00.019  INFO 4 --- [scheduling-1] c.g.j.f.services.SmsService : start date=03/28/2021, time=08:50 PM<br/>2021-03-28T20:50:00 app[web.1]: 2021-03-28 20:50:00.019  INFO 4 --- [scheduling-1] c.g.j.f.services.SmsService : end date=03/30/2021, time=02:50 AM</span></pre><p id="2dec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">利用附加组件的功能，可以向应用程序引入Coralogix日志记录、Logentries、LogDNA、Papertrail和Sumo逻辑等工具，以便提供全功能的逻辑分析和调试。</p><h1 id="eeb7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">谁应该(和不应该)使用Heroku？</h1><p id="aaea" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">在多个选项争夺客户的情况下，下表说明了Heroku是(和不是)一个选项的情况:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/dbd653ea42edf8744e2d92d78362fcfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gqmjgs0B4B4FY6zm.png"/></div></div></figure><p id="130d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据我个人对30年来IT行业的分析，我可以肯定地说，Heroku提供了必要的解决方案集，可以满足目前运行的80%以上的应用程序的需求。唯一的限制因素是执行必要的分析和规划，以利用Heroku提供的服务。</p><p id="ba21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦Heroku成为目的地，每个应用程序都将开始受益于可以应用于未来特性和功能的时间。</p><h1 id="5296" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="a66c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">如果我要为任何IT专业人士起草一份简明的使命陈述，那会非常简单:</p><blockquote class="ll lm ln"><p id="07de" class="iq ir lo is b it iu iv iw ix iy iz ja lp jc jd je lq jg jh ji lr jk jl jm jn hb bi translated"><em class="hi">“将您的时间集中在提供扩展您知识产权价值的特性/功能上。将框架、产品和服务用于其他一切。”</em></p></blockquote><p id="b53c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">基本上，如果你的工作是构建一个应用程序来帮助小部件做一些事情，那么就投入你的时间和精力来最大化地赋予小部件竞争优势。避免花费时间去做框架、产品或服务已经提供的事情——要知道他们可能总是比你能提供更好的解决方案——因为这就是他们存在的原因。</p><p id="9019" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在将Heroku用于我的应用程序之前，我发现自己花费了不必要的时间试图找出Heroku已经为我做了(并且做得非常好)的方面。这种努力带来了一个严重的后果，那就是我无法以正确的方式分配有限的时间。现在，一年过去了，我对坚持上面简单的使命所取得的成果感到惊讶。</p><p id="1a26" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从我能找到的最新信息来看，我的应用程序是目前在Heroku上运行的900多万个应用程序的一部分——显然是下一代云计算的一部分。</p><p id="963c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祝你今天过得愉快！</p></div></div>    
</body>
</html>