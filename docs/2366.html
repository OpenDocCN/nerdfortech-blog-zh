<html>
<head>
<title>Flutter 2: Null Safety in a nutshell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">扑 2:简而言之，零安全</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/flutter-2-null-safety-in-a-nutshell-f20aeb74772?source=collection_archive---------5-----------------------#2021-05-03">https://medium.com/nerd-for-tech/flutter-2-null-safety-in-a-nutshell-f20aeb74772?source=collection_archive---------5-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/f8ee0d5e85f3bb286fb8161213c91914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qURTavo-VoP17OJtG8dn_w.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">文章封面:简而言之，零安全</figcaption></figure><blockquote class="iq"><p id="dc69" class="ir is hi bd it iu iv iw ix iy iz ja dx translated">你的 flutter 应用程序听起来不安全！</p></blockquote><p id="cd6a" class="pw-post-body-paragraph jb jc hi jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx ja hb bi translated">在编程中处理空值是一项单调乏味的任务。当一个函数期望一个输入，但结果却是 null 时，就会导致运行时错误，程序就会崩溃。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/b696387224fb863543ad70925d907dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*F9lQ86s2rT51pFj5gP253A.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">零模因</figcaption></figure><p id="92d1" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">Flutter 2 发布了一种处理空值的新方法。准确的说，并不是 Flutter 发布了这个规范。新的 Dart 语言规范增加了一个新特性，叫做<strong class="jd hj">编译时空安全</strong>。这个想法是强迫所有变量用某个值初始化。在这种情况下，不会有任何由空值解引用导致的运行时错误。这就是所谓的“零安全”。</p><p id="c27f" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">您可以使用<a class="ae ki" href="https://dartpad.dev/?null_safety=true" rel="noopener ugc nofollow" target="_blank"> dartpad </a>来尝试空安全，但我也会在本文中向您展示它是如何工作的。通过将 URL <strong class="jd hj"> null_safety </strong>中的查询参数设置为 false，可以在 dartpad 中启用或禁用 Null 安全。</p><p id="4241" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">要<em class="kj">启用</em>镖靶零位安全，请前往<a class="ae ki" href="https://dartpad.dev/?null_safety=true" rel="noopener ugc nofollow" target="_blank">https://dartpad.dev/?null_safety=true</a>T13】要<em class="kj">禁用</em>镖靶零位安全，请前往<a class="ae ki" href="https://dartpad.dev/?null_safety=false" rel="noopener ugc nofollow" target="_blank">https://dartpad.dev/?null_safety=false</a>。</p><h1 id="b948" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">快速浏览零安全</h1><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="1618" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">首先，我将<em class="kj">禁用 dartpad 中的</em>空安全。当您运行上面的脚本时，它会抛出一个错误，因为变量<code class="du lk ll lm ln b"><strong class="jd hj">name </strong></code>没有初始化并且为 null。</p><p id="2bd4" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated"><code class="du lk ll lm ln b"><strong class="jd hj">Uncaught TypeError: Cannot read property ‘get$isEmpty’ of nullError: TypeError: Cannot read property ‘get$isEmpty’ of null</strong></code></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lo"><img src="../Images/128da2c2e0c6bfd6d2256e584be20acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yAtz_ZodjBOw99-tkFogg.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">非空安全</figcaption></figure><p id="1787" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">当我<em class="kj">在 dartpad 中启用</em>空安全时，编译器会抛出一个错误，指出我们的变量没有初始化。该程序将不会编译和运行，如下图所示。</p><p id="7c37" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated"><code class="du lk ll lm ln b"><strong class="jd hj">Error: Non-nullable variable ‘name’ must be assigned before it can be used. isEmpty(name);</strong></code></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lt"><img src="../Images/cc26b4bc33a68dbc67e75cc2357149de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnK6Feh9L_TiVVNCd5SgSg.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">零安全</figcaption></figure><p id="633b" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">这是非常方便的！因为它会在我们运行程序之前引发错误，这样开发人员就会注意到并在将程序提交给最终用户之前修复它们。</p><h1 id="6f25" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如果值实际上是可空的呢？</h1><p id="92bf" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">因为 Dart 假定所有变量都必须初始化。任何未初始化的变量都会引发错误。但是如果真的有一个值实际上可能是 null 呢？我们如何解决这个问题？</p><p id="337b" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">要在 Dart 中允许可空类型，必须添加一个<strong class="jd hj">"？</strong>(引号)在类型标识符处。此操作告诉 dart 此值可为空。它可能有也可能没有值。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="e839" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">从上面的要点可以看出，变量<code class="du lk ll lm ln b"><strong class="jd hj">name </strong></code>的类型是<code class="du lk ll lm ln b"> <strong class="jd hj">String?</strong></code>。这个变量允许它的值为空，并且不会引发任何编辑器错误。</p><p id="81d3" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">然而，请考虑以下要点。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="db6f" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">这将导致一个编辑器错误，因为函数<code class="du lk ll lm ln b"><strong class="jd hj">isEmpty </strong></code>需要一个<code class="du lk ll lm ln b"><strong class="jd hj">String</strong> </code>类型的参数，但我们为它提供了一个<code class="du lk ll lm ln b"><strong class="jd hj">String?</strong></code>。</p><p id="769d" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated"><code class="du lk ll lm ln b"><strong class="jd hj">line 3 • The argument type ‘String?’ can’t be assigned to the parameter type ‘String’.</strong></code></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lz"><img src="../Images/c1e00e46b24845557bae304de162657e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EE5r4oQW5f-k0fW6Hoa7Q.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">可空误差</figcaption></figure><p id="1c1a" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">你能看到那根<strong class="jd hj">弦</strong>和<strong class="jd hj">弦？</strong>不一样。一个需要非空值，而另一个不需要。下一个问题是，我们如何在<strong class="jd hj"> isEmpty </strong>函数中使用可空值？</p><h1 id="0321" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">抛弃可空性</h1><p id="4091" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">要将可空值转换为非空值，必须添加<strong class="jd hj">"！"</strong>(感叹号)在变量之后。(嗯，我知道这很可怕。将可空值转换为非空值可能会失去静态安全性，最终必须检查是否为空。但是，嘿，这是一种方法。)</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="a6f6" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">上面的要点不会导致任何编辑器错误，因为我们在第 3 行的变量<code class="du lk ll lm ln b"><strong class="jd hj">name </strong></code>上添加了一个<em class="kj">感叹号</em>。现在，dart 将其识别为静态非空变量。然而，当您试图运行代码时，它将导致运行时错误，因为变量<code class="du lk ll lm ln b"><strong class="jd hj">name</strong> </code>为空。所以请<em class="kj">小心</em>丢弃空值！</p><p id="ab3d" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated"><code class="du lk ll lm ln b"><strong class="jd hj">Uncaught TypeError: Cannot read property ‘toString’ of nullError: TypeError: Cannot read property ‘toString’ of null</strong></code></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lt"><img src="../Images/08d932ebcfcaeb5cfbd2c82461a57372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oEviqp7i377SY8OiRgoi8Q.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">铸造误差</figcaption></figure><h1 id="0786" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">抱歉，我迟到了。请在运行时检查我！</h1><p id="a738" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">考虑以下要点。这是一个使用空安全的错误例子。从代码中，您可以看到变量<code class="du lk ll lm ln b"><strong class="jd hj">model</strong> </code>不是空的，但是没有初始化，将会引发一个错误。由于我们不应该初始化变量<code class="du lk ll lm ln b"><strong class="jd hj">model</strong> </code>，因为我们不知道汽车的初始模型是什么。应该是空字符串吗？还是应该是特斯拉？我们不知道。变量<code class="du lk ll lm ln b"><strong class="jd hj">model</strong> </code>应由用户指定。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="0895" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">您可以想出一个解决这个问题的方法，将<code class="du lk ll lm ln b"><strong class="jd hj">model</strong></code>的标识符从<code class="du lk ll lm ln b"><strong class="jd hj">String </strong></code>改为<code class="du lk ll lm ln b"><strong class="jd hj">String?</strong></code>。并将 drive()方法的参数从<code class="du lk ll lm ln b"><strong class="jd hj">model </strong></code>改为<code class="du lk ll lm ln b"><strong class="jd hj">model!</strong></code>。这将纠正错误，但可能会使未来的代码维护者感到困惑，如以下要点所示。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="69a4" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">Dart 有一种新的方法来处理这种情况。您可以像这样在类型标识符前面指定一个<code class="du lk ll lm ln b"><strong class="jd hj">late </strong></code>修饰符。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="7273" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">在第 2 行，您可以看到我们将变量<code class="du lk ll lm ln b"><strong class="jd hj">model </strong></code>标识为一个非空字符串。并且我们还指定它是一个<code class="du lk ll lm ln b"><strong class="jd hj">late</strong></code> <strong class="jd hj"> </strong>变量。late 修饰符告诉 flutter 这个变量不为空，但也没有初始化。</p><p id="2e04" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">灾难援助反应队的文件表明</p><blockquote class="ma mb mc"><p id="85f7" class="jb jc kj jd b je kd jg jh ji ke jk jl md kf jo jp me kg js jt mf kh jw jx ja hb bi translated"><code class="du lk ll lm ln b">late</code>修饰符的意思是“在运行时而不是编译时强制这个变量的约束”。当强制变量的保证时，这几乎就像单词“late”描述了<em class="hi">。</em></p></blockquote><p id="e777" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">在这种情况下，变量<code class="du lk ll lm ln b">model</code>没有明确初始化。它将在运行时被检查，如果出现任何错误，它将抛出一个异常。总而言之，<code class="du lk ll lm ln b">late</code>修改器告诉<strong class="jd hj">何时</strong>强制变量约束。</p><h2 id="41d3" class="mg kl hi bd km mh mi mj kq mk ml mm ku jm mn mo ky jq mp mq lc ju mr ms lg mt bi translated">惰性初始化</h2><p id="afe0" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">你可以在一个有初始化器的字段上添加<code class="du lk ll lm ln b">late</code>,就像这样。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="4fe9" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">有了一个<code class="du lk ll lm ln b">late</code>修饰符，私有变量<code class="du lk ll lm ln b"><strong class="jd hj">_model</strong></code>不会在构造 Car 对象时初始化，而是在第一次访问它时初始化。在晚期变量从未被使用过的情况下，它可能是有用的，这样初始化器就不会被调用。这可以为我们节省一些处理资源。</p><h2 id="7d24" class="mg kl hi bd km mh mi mj kq mk ml mm ku jm mn mo ky jq mp mq lc ju mr ms lg mt bi translated"><strong class="ak">后期最终变量</strong></h2><p id="44aa" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">您也可以将 late 添加到 final 修饰符，以便稍后初始化变量。它与普通变量的不同之处在于，晚期 final 变量只能初始化一次，以后在运行时不能赋值。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="7456" class="kk kl hi bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">如何在颤振中启用零位安全</strong></h1><p id="a3b9" class="pw-post-body-paragraph jb jc hi jd b je lu jg jh ji lv jk jl jm lw jo jp jq lx js jt ju ly jw jx ja hb bi translated">当你第一次创建你的 Flutter 应用时，flutter SDK 会为你生成一个模板文件夹结构。要启用空安全，您必须转到您的<strong class="jd hj"> pubspec.yaml </strong>文件，然后导航到环境标签。你会看到在标签下面，有一个 SDK 标签版本。空安全符合 SDK 版本 2.12 及更高版本。请根据以下要点更改您的环境 SDK。</p><figure class="jz ka kb kc fd ij"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="428f" class="pw-post-body-paragraph jb jc hi jd b je kd jg jh ji ke jk jl jm kf jo jp jq kg js jt ju kh jw jx ja hb bi translated">之后，在你的终端中运行<strong class="jd hj"> flutter pub get </strong>来应用新的配置。你去那里，你的颤振应用程序听起来零安全！</p><h2 id="590b" class="mg kl hi bd km mh mi mj kq mk ml mm ku jm mn mo ky jq mp mq lc ju mr ms lg mt bi translated">参考</h2><ul class=""><li id="16c3" class="mu mv hi jd b je lu ji lv jm mw jq mx ju my ja mz na nb nc bi translated">了解零安全:<a class="ae ki" href="https://dart.dev/null-safety/understanding-null-safety" rel="noopener ugc nofollow" target="_blank">https://dart.dev/null-safety/understanding-null-safety</a></li><li id="8743" class="mu mv hi jd b je nd ji ne jm nf jq ng ju nh ja mz na nb nc bi translated"><strong class="jd hj">Dart 中的零安全—简介</strong>:<a class="ae ki" href="https://www.youtube.com/watch?v=iYhOU9AuaFs" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=iYhOU9AuaFs</a></li></ul></div></div>    
</body>
</html>