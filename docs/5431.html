<html>
<head>
<title>Building Microservices using Spring Boot + HarperDB and Deploying it on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Spring Boot + HarperDB 构建微服务并将其部署在 AWS 上</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/building-microservices-using-spring-boot-harperdb-and-deploying-it-on-aws-6d9b942501a3?source=collection_archive---------4-----------------------#2021-09-30">https://medium.com/nerd-for-tech/building-microservices-using-spring-boot-harperdb-and-deploying-it-on-aws-6d9b942501a3?source=collection_archive---------4-----------------------#2021-09-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5ca1b48a5ffa6ec3269a2593fd7b5e91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ilNV8WAOkagiqbRluqKlgw.png"/></div></div></figure><h1 id="f2c3" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="5486" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在这篇文章中，你将学习如何使用 Spring Boot 和 HarperDB 来创建一个微服务。稍后，您还将了解如何在 AWS Elastic Beanstalk 上部署完整的应用程序。</p><p id="59fe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">您将构建一个员工休假管理系统。该应用程序将负责跟踪员工休假的详细记录。您还将实现添加、编辑和取消假期的功能。</p><p id="82c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">但是首先让我们对微服务有个基本的了解。</p><h1 id="28a5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是微服务？</h1><p id="a915" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">微服务是开发软件的另一种设计架构。在这种情况下，软件由通过 REST APIs 通信的小型独立服务组成。</p><p id="a36d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">微服务架构使应用程序更易于开发和扩展。它还使组织能够在以后需要时轻松地发展其技术堆栈。</p><h1 id="3f4f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">整体服务与微服务</h1><p id="2868" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在整体架构中，所有流程都作为单一服务运行，因此，它们是紧密耦合的。这意味着，如果一个进程停止运行，整个应用程序都会受到影响，从而导致单点故障。</p><p id="b01e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，随着代码库的增长，增强或添加新特性变得更加复杂。这种复杂性使得试验和实施新想法变得困难。</p><p id="f062" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在微服务架构中，应用程序是通过组合作为服务独立运行的不同组件来构建的。这些服务通过轻量级 REST APIs 的定义良好的接口进行通信。</p><p id="2238" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">每个服务负责执行一项任务，由于它们独立运行，因此可以更新、部署和扩展每个服务，以满足应用程序特定功能的需求。</p><h1 id="b67e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">HarperDB 简介</h1><p id="58b4" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">您将使用 HarperDB 作为您的数据库。HarperDB 是一个完整的数据管理解决方案和分布式数据库，具有本地 SQL 操作，如 join、order by 等。，以及 NoSQL 无模式甚至基于 API 的执行。</p><p id="2ea0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">HarperDB 最显著的特性是:</p><ul class=""><li id="e1be" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">所有 CRUD 操作都有一个端点</li><li id="6d22" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">对 JSON 数据执行 SQL 查询</li><li id="98ac" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">支持多种插件，如 ODBC、JDBC、Node-RED 等。</li><li id="fdbe" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">它同时支持 SQL 和 NoSQL</li><li id="1e37" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">通过以 JSON 数组的形式返回结果，不再需要 ORM(对象关系映射)</li><li id="d9f2" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">在 JSON 上执行复杂且符合 ACID 的 SQL 查询，没有任何数据重复</li></ul><p id="bc0b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">看起来很有趣，不是吗？</p><h1 id="2545" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">配置 HarperDB 数据库实例</h1><p id="667c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在让我们从配置 HarperDB 实例开始:</p><ul class=""><li id="209c" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">前往<a class="ae lf" href="https://studio.harperdb.io/sign-up" rel="noopener ugc nofollow" target="_blank">studio.harperdb.io/sign-up</a></li><li id="1b0f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">请在表格中填写您的详细信息</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ac1d8de38ec7940fb15069bb9afe177c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_vRhbVoD_RSqOpWH.png"/></div></div></figure><ul class=""><li id="5c64" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">点击免费注册</li><li id="a81b" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">然后，您将收到一封类似以下内容的电子邮件:</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/fc5a211e83907896c01e1d7ffff0f92a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oWnA0zhepSR-ITc2.png"/></div></div></figure><ul class=""><li id="f3a7" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">点击登录 HarperDB studio</li></ul><h1 id="751a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建实例</h1><ul class=""><li id="9c49" class="kr ks hi jq b jr js jv jw jz ll kd lm kh ln kl kw kx ky kz bi translated">点击创建 HarperDB 云实例</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/61588d88fd90f92a1d2d64db2fc2a564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qfchNipwC9iPkJR7.png"/></div></div></figure><ul class=""><li id="b504" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">输入您的凭据</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/00b1da5bc01775b7f289ad115d359110.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wW8K8gLVB2nrUmhM.jpeg"/></div></div></figure><blockquote class="lp lq lr"><p id="fde8" class="jo jp ls jq b jr km jt ju jv kn jx jy lt ko kb kc lu kp kf kg lv kq kj kk kl hb bi translated"><em class="hi">注意</em>:不要将这些凭证与您的工作室帐户混淆。这是为您在此数据库实例上创建的超级用户准备的。用户名不应该是电子邮件的形式。</p></blockquote><ul class=""><li id="afd5" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">选择你的实例规格。您可以从免费版本开始，以后根据需要进行升级。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/bb3e109431a631d14f900df66d062082.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FWbBTRh-WhL4NaOL.png"/></div></div></figure><ul class=""><li id="afe8" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">接下来，查看您的详细信息，并单击确认实例详细信息</li><li id="8f53" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">最后，单击添加实例</li></ul><p id="7374" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">再过 5 到 10 分钟，您的实例将准备就绪。完成后，您还会收到一封电子邮件。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/5e81befb05b76f3f044a6ff5d333aa67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EJLdOicioOdKeND2.png"/></div></div></figure><p id="cba3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><em class="ls">您收到的实例 URL 就是您如何通过 REST 调用访问 HarperDB 的方法</em>。</p><p id="b2eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">最初，您的实例没有任何模式或表。因此，您需要首先创建它们。</p><p id="e6ec" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我选择<strong class="jq hj"> Employee_Leaves </strong>作为我的模式的名称。但是，您可以为您的模式使用任何其他名称，然后单击绿色复选标记保存它。</p><p id="7898" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，您需要创建表。目前，您将建立两个表<strong class="jq hj"> Employee </strong>和<strong class="jq hj"> Leaves </strong>，第一个表用于存储所有员工的详细信息，如姓名和员工 id，第二个表用于存储公司员工的假期。</p><p id="3276" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">请注意，您现在还不需要添加所有的列，它们会在需要时自动添加。现在，在创建一个表时，您只需要提供一个<em class="ls"> hash_attribute </em>名称。<em class="ls">哈希属性用于唯一标识每条记录</em>。对于这两个表，您可以使用 ID 作为 hash_attribute。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/d08c18fa4b2e4e104d00ae2a26cf0092.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/0*FsmSifo2h8p7Mv32.png"/></div></figure><h1 id="379d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建 Spring Boot 应用程序</h1><p id="bbd0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">从 spring boot 开始，你必须从<a class="ae lf" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"> Spring.io </a>创建一个基本的应用程序。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/7f4d6d37e88a5e77b92da7c08edeb8b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kOoTWAODjHu0ryCl.png"/></div></div></figure><p id="a071" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">选择<code class="du ma mb mc md b">Maven</code>项目和<code class="du ma mb mc md b">Java</code>语言。对于 Spring Boot 版本，选择 2.5.3。您还必须添加 Spring-boot-starter-web 和 Lombok 依赖项。</p><p id="e158" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">或者，填写项目元数据。例如，您可以将组设置为<code class="du ma mb mc md b">com.employee</code>，将工件&amp;名称设置为<code class="du ma mb mc md b">attendance</code>，将包设置为<code class="du ma mb mc md b">com.employee.attendance</code>，最后输入一个简短描述&amp;点击生成。</p><p id="b1f8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">提取下载的项目，并在您喜欢的 IDE 中打开它。</p><p id="8761" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，要从您的 Spring Boot 应用程序访问 HarperDB 实例，您首先必须下载用于 HarperDB 的<strong class="jq hj"> CData JDBC 驱动程序</strong>。</p><p id="b77b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">CData JDBC 驱动程序允许以最直接的方式从任何基于 Java 的应用程序连接到 HarperDB。它包装并隐藏了访问数据的复杂性，并提供了额外的强大的安全特性、智能缓存、批处理、套接字管理等等。</p><p id="f19d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们来看看将这个驱动程序集成到您的应用程序中的步骤:</p><ul class=""><li id="4e0a" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">导航至—<a class="ae lf" href="https://studio.harperdb.io/resources/drivers" rel="noopener ugc nofollow" target="_blank">https://studio.harperdb.io/resources/drivers</a>，然后点击下载。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/26f9530fa0beba90676f18559686d512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5gBz8ACyG5HY01N9.png"/></div></div></figure><ul class=""><li id="cd7d" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">回到您的项目根目录，创建一个名为<code class="du ma mb mc md b">lib</code> &amp;的新文件夹，提取这个文件夹中的 zip 文件内容。</li><li id="0bc3" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">接下来，要将外部 jar 导入到您的 spring boot 应用程序中，请打开<code class="du ma mb mc md b">pom.xml</code>文件并在其中添加以下依赖项:</li></ul><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="a834" class="mi ir hi md b fi mj mk l ml mm">&lt;dependency&gt;<br/>    &lt;groupId&gt;cdata.jdbc.harperdb&lt;/groupId&gt;<br/>    &lt;artifactId&gt;cdata.jdbc.harperdb&lt;/artifactId&gt;<br/>    &lt;scope&gt;system&lt;/scope&gt;<br/>    &lt;version&gt;1.0&lt;/version&gt;<br/>    &lt;systemPath&gt;${project.basedir}/lib/cdata.jdbc.harperdb.jar&lt;/systemPath&gt;<br/>&lt;/dependency&gt;</span></pre><p id="acba" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在这里，<code class="du ma mb mc md b">${project.basedir}</code>指的是保存 pom.xml 的路径，即根目录。如果你在任何其他路径安装了驱动程序，你必须在<code class="du ma mb mc md b">&lt;systemPath&gt;</code>标签中添加它的绝对路径。</p><p id="463d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里需要注意的重要一点是，你必须将<code class="du ma mb mc md b">&lt;scope&gt;</code>设置为<strong class="jq hj">系统</strong>，并且在插件内部将<code class="du ma mb mc md b">&lt;includeSystemScope&gt;</code>设置为<strong class="jq hj">真</strong>。</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="5344" class="mi ir hi md b fi mj mk l ml mm">&lt;plugin&gt;<br/>  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;<br/>  &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;<br/>  &lt;configuration&gt;<br/>    &lt;includeSystemScope&gt;true&lt;/includeSystemScope&gt;<br/>  &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="1fc2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这是必须要做的，因为您最终将在服务器(AWS)上部署这个应用程序，为了让服务器知道任何外部<strong class="jq hj"> JAR </strong>文件，这些配置是必要的。</p><p id="23d6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，为了在您的应用程序和 HarperDB 实例之间建立一个连接，创建一个新的包并将其命名为<code class="du ma mb mc md b">service</code>。在其中，创建一个名为<code class="du ma mb mc md b">ConnectionService.java</code>的新 Java 文件，并向其中添加以下内容:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="d0f3" class="mi ir hi md b fi mj mk l ml mm">package com.employee.attendance.service;</span><span id="4485" class="mi ir hi md b fi mn mk l ml mm">import org.springframework.stereotype.Service;<br/>import java.sql.Connection;<br/>import java.sql.DriverManager;<br/>import java.sql.SQLException;</span><span id="0414" class="mi ir hi md b fi mn mk l ml mm">@Service<br/>public class ConnectionService {<br/>    public Connection createConnection() throws SQLException {<br/>        return DriverManager.getConnection("jdbc:harperdb:Server=https:xyz.harperdbcloud.com;User=admin;Password=1234;UseSSL=true;");<br/>    }<br/>}</span></pre><blockquote class="lp lq lr"><p id="346b" class="jo jp ls jq b jr km jt ju jv kn jx jy lt ko kb kc lu kp kf kg lv kq kj kk kl hb bi translated"><strong class="jq hj"> @Service </strong>注释用于提供一些业务功能的类</p></blockquote><p id="81bc" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这里，您使用在<code class="du ma mb mc md b">DriverManager</code>类下可用的<code class="du ma mb mc md b">getConnection()</code>方法中的“连接字符串”建立与数据库的连接。</p><p id="bd9e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">或者，您也可以使用 Properties 对象准备连接选项。将 Properties 对象传递给 DriverManager:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="9b65" class="mi ir hi md b fi mj mk l ml mm">Properties prop = new Properties();<br/>prop.setProperty("Server","https:xyz.harperdbcloud.com");<br/>prop.setProperty("User","admin");<br/>prop.setProperty("Password","1234");</span><span id="c126" class="mi ir hi md b fi mn mk l ml mm">Connection conn = DriverManager.getConnection("jdbc:harperdb:",prop);</span></pre><p id="20d3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">用您自己的凭证替换服务器、用户和密码，您就可以开始了。</p><h1 id="705a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设计 REST APIs</h1><p id="b3d0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">现在您的应用程序和 HarperDB 之间已经成功建立了连接，让我们开始创建 Restful APIs。</p><p id="316e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">首先，创建一个名为<code class="du ma mb mc md b">controller</code>的新包。在其中，创建一个新类，并将其命名为<code class="du ma mb mc md b">AttendanceController.java</code>。</p><p id="1796" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">控制器类是您将公开所有微服务端点的地方。这些端点是不同的微服务用来相互通信的。</p><p id="f127" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于此应用程序，您将创建 4 个端点:</p><ul class=""><li id="04cf" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><strong class="jq hj">GET</strong><code class="du ma mb mc md b">/api/get/all/leaves/{employeeId}</code>——获取某个员工到目前为止申请的所有假期。</li><li id="467f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">发布</strong> <code class="du ma mb mc md b">/api/add/leave</code> -为员工增加一个新的假期。</li><li id="fe70" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">放</strong> <code class="du ma mb mc md b">/api/edit/leave</code> -编辑已有休假的日期。</li><li id="a4ee" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated"><strong class="jq hj">删除</strong> <code class="du ma mb mc md b">/api/cancel/leave</code> -删除一个已有的休假。</li></ul><p id="6b81" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是添加这 4 个端点后完整的控制器类的外观:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="bd02" class="mi ir hi md b fi mj mk l ml mm">package com.employee.attendance.controller;</span><span id="8c3a" class="mi ir hi md b fi mn mk l ml mm">import com.employee.attendance.dto.EmployeeDataDTO;<br/>import com.employee.attendance.dto.EmployeeEditDataDTO;<br/>import com.employee.attendance.service.AttendanceService;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.web.bind.annotation.*;</span><span id="487f" class="mi ir hi md b fi mn mk l ml mm">import java.util.HashMap;<br/>import java.util.List;</span><span id="4c0c" class="mi ir hi md b fi mn mk l ml mm">@RestController<br/>public class AttendanceController {</span><span id="4e3b" class="mi ir hi md b fi mn mk l ml mm">    @Autowired<br/>    private AttendanceService service;</span><span id="0f4a" class="mi ir hi md b fi mn mk l ml mm">    @GetMapping(value = "/api/get/all/leaves/{employeeId}")<br/>    public List&lt;HashMap&lt;String, String&gt;&gt; getAllLeavesForEmployee(@PathVariable String employeeId) {<br/>        return service.getAllLeavesForEmployee(employeeId);<br/>    }</span><span id="85a4" class="mi ir hi md b fi mn mk l ml mm">    @PostMapping(value = "/api/add/leave")<br/>    public HashMap&lt;String, String&gt; addNewLeave(@RequestBody EmployeeDataDTO employeeData) {<br/>        return service.addNewLeaveForEmployee(employeeData);<br/>    }</span><span id="d108" class="mi ir hi md b fi mn mk l ml mm">    @PutMapping(value = "/api/edit/leave")<br/>    public HashMap&lt;String, String&gt; editLeave(@RequestBody EmployeeEditDataDTO employeeEditData) {<br/>        return service.editLeaveForEmployee(employeeEditData);<br/>    }</span><span id="62be" class="mi ir hi md b fi mn mk l ml mm">    @DeleteMapping(value = "/api/cancel/leave")<br/>    public HashMap&lt;String, String&gt; cancelLeave(@RequestBody EmployeeDataDTO employeeData) {<br/>        return service.cancelLeaveForEmployee(employeeData);<br/>    }<br/>}</span></pre><p id="8220" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在让我们在您之前创建的<code class="du ma mb mc md b">service</code>包中创建另一个名为<code class="du ma mb mc md b">AttendanceService.java</code>的类。在这个类中，您将编写所有的业务逻辑。因此，让我们实现控制器中提到的所有 4 种方法:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="7e9f" class="mi ir hi md b fi mj mk l ml mm">package com.employee.attendance.service;</span><span id="3bb7" class="mi ir hi md b fi mn mk l ml mm">import com.employee.attendance.dto.EmployeeDataDTO;<br/>import com.employee.attendance.dto.EmployeeEditDataDTO;<br/>import lombok.extern.slf4j.Slf4j;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.stereotype.Service;<br/>import java.sql.*;<br/>import java.util.ArrayList;<br/>import java.util.HashMap;<br/>import java.util.List;</span><span id="d199" class="mi ir hi md b fi mn mk l ml mm">@Service<br/>@Slf4j<br/>public class AttendanceService {</span><span id="c019" class="mi ir hi md b fi mn mk l ml mm">    @Autowired<br/>    private ConnectionService connectionService;</span><span id="b92d" class="mi ir hi md b fi mn mk l ml mm">    public List&lt;HashMap&lt;String, String&gt;&gt; getAllLeavesForEmployee(String empId) {<br/>        log.info("Getting all leaves for employee - {}",empId);<br/>        List&lt;HashMap&lt;String, String&gt;&gt; resultList = new ArrayList&lt;&gt;();<br/>        try {<br/>            Connection conn = connectionService.createConnection();<br/>            PreparedStatement statement = conn.prepareStatement("Select * From Employee_Leaves.Leaves where empId = ?");<br/>            statement.setString(1,empId);<br/>            ResultSet resultSet = statement.executeQuery();<br/>            while (resultSet.next()) {<br/>                HashMap&lt;String, String&gt; result = new HashMap&lt;&gt;();<br/>                result.put("date_of_apply",new Date(Long.parseLong(resultSet.getString("__createdtime__"))).toString());<br/>                result.put("last_update_date",new Date(Long.parseLong(resultSet.getString("__updatedtime__"))).toString());<br/>                result.put("leave_applied_for",resultSet.getString("date"));<br/>                result.put("employee_id",resultSet.getString("empId"));<br/>                resultList.add(result);<br/>            }<br/>            conn.close();<br/>        } catch (Exception e){<br/>            log.error("Error occurred", e);<br/>            HashMap&lt;String, String&gt; result = new HashMap&lt;&gt;();<br/>            result.put("Error",e.getMessage());<br/>            resultList.add(result);<br/>        }<br/>        return resultList;<br/>    }</span><span id="3f87" class="mi ir hi md b fi mn mk l ml mm">    public HashMap&lt;String, String&gt; addNewLeaveForEmployee(EmployeeDataDTO employeeData) {<br/>        log.info("Inserting new leave for employee - {}",employeeData.getEmployeeId());<br/>        HashMap&lt;String, String&gt; result = new HashMap&lt;&gt;();<br/>        try {<br/>            Connection conn = connectionService.createConnection();<br/>            PreparedStatement statement = conn.prepareStatement("INSERT INTO Employee_Leaves.Leaves (date, empId) VALUES (?,?)");<br/>            statement.setString(1, employeeData.getDate());<br/>            statement.setString(2, employeeData.getEmployeeId());<br/>            int count = statement.executeUpdate();<br/>            if(count&gt;0) {<br/>                result.put("Message", "Success");<br/>                result.put("Affected rows", String.valueOf(count));<br/>            }<br/>            conn.close();<br/>        } catch (Exception e){<br/>            log.error("Error occurred", e);<br/>            result.put("Error",e.getMessage());<br/>        }<br/>        return result;<br/>    }</span><span id="db96" class="mi ir hi md b fi mn mk l ml mm">    public HashMap&lt;String, String&gt; editLeaveForEmployee(EmployeeEditDataDTO employeeEditData) {<br/>        log.info("Updating leave for employee - {}",employeeEditData.getEmployeeId());<br/>        HashMap&lt;String, String&gt; result = new HashMap&lt;&gt;();<br/>        try {<br/>            Connection conn = connectionService.createConnection();<br/>            PreparedStatement statement = conn.prepareStatement("UPDATE Employee_Leaves.Leaves SET date = ? WHERE empId=? and date = ?");<br/>            statement.setString(1, employeeEditData.getNewDate());<br/>            statement.setString(2, employeeEditData.getEmployeeId());<br/>            statement.setString(3, employeeEditData.getPreviousDate());<br/>            int count = statement.executeUpdate();<br/>            if(count&gt;0) {<br/>                result.put("Message", "Success");<br/>                result.put("Affected rows", String.valueOf(count));<br/>            }<br/>            conn.close();<br/>        } catch (Exception e){<br/>            log.error("Error occurred", e);<br/>            result.put("Error",e.getMessage());<br/>        }<br/>        return result;<br/>    }</span><span id="dd27" class="mi ir hi md b fi mn mk l ml mm">    public HashMap&lt;String, String&gt; cancelLeaveForEmployee(EmployeeDataDTO employeeData) {<br/>        log.info("Cancelling leave for employee - {}",employeeData.getEmployeeId());<br/>        HashMap&lt;String, String&gt; result = new HashMap&lt;&gt;();<br/>        try {<br/>            Connection conn = connectionService.createConnection();<br/>            PreparedStatement statement = conn.prepareStatement("DELETE FROM Employee_Leaves.Leaves WHERE empId = ? and date = ?");<br/>            statement.setString(1, employeeData.getEmployeeId());<br/>            statement.setString(2, employeeData.getDate());<br/>            int count = statement.executeUpdate();<br/>            if(count&gt;0) {<br/>                result.put("Message", "Success");<br/>                result.put("Affected rows", String.valueOf(count));<br/>            }<br/>            conn.close();<br/>        } catch (Exception e){<br/>            log.error("Error occurred", e);<br/>            result.put("Error",e.getMessage());<br/>        }<br/>        return result;<br/>    }<br/>}</span></pre><p id="f309" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">完成后，让我们了解这四个功能的用途:</p><ul class=""><li id="acc3" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">getAllLeavesForEmployee()</code>。</li></ul><p id="71fa" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它将负责从<code class="du ma mb mc md b">Leaves</code>表中获取特定员工的所有假期。您只需建立一个连接，然后根据员工 Id 查询 Leaves 表。</p><ul class=""><li id="8453" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">addNewLeaveForEmployee()</code></li></ul><p id="e104" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">每当一个员工需要申请一个假期，这个函数将被调用，它将接受一个<code class="du ma mb mc md b">EmployeeDataDTO</code>类的对象，并将在数据库的<code class="du ma mb mc md b">Leave</code>表中添加一个新的假期。</p><ul class=""><li id="62d9" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">editLeaveForEmployee()</code></li></ul><p id="02c4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果员工想要更改之前申请休假的日期，<code class="du ma mb mc md b">editLeaveForEmployee()</code>功能将负责在您的数据库中进行修改。</p><ul class=""><li id="96c3" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">cancelLeaveForEmployee()</code></li></ul><p id="8436" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它将简单地取消员工的特定休假，即从表中删除该行。该函数也将<code class="du ma mb mc md b">EmployeeDataDTO</code>类的对象作为其参数。</p><p id="96de" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来的事情是理解<code class="du ma mb mc md b">EmployeeDataDTO</code>和<code class="du ma mb mc md b">EmployeeEditDataDTO</code>类的用法。</p><p id="b0b7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这两个类将充当您的数据传输对象或简称为 dto。它们将存储您将在 API 请求体中传递的数据，并通过控制器类将这些数据传递给服务进行处理。</p><p id="89d2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要生成这些 Java 文件，创建一个名为<code class="du ma mb mc md b">dto</code>的新包，并在其中添加两个文件，一个是<code class="du ma mb mc md b">EmployeeDataDTO.java</code>，另一个是<code class="du ma mb mc md b">EmployeeEditDataDTO.java</code>。</p><p id="7473" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是内容<code class="du ma mb mc md b">EmployeeDataDTO.java</code>将举行:</p><ul class=""><li id="2be5" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">员工 Id</li><li id="aa72" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">申请休假的日期</li></ul><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="1619" class="mi ir hi md b fi mj mk l ml mm">package com.employee.attendance.dto;</span><span id="5114" class="mi ir hi md b fi mn mk l ml mm">import lombok.Data;</span><span id="6ff8" class="mi ir hi md b fi mn mk l ml mm">@Data<br/>public class EmployeeDataDTO {<br/>    private String employeeId;<br/>    private String date;<br/>}</span></pre><p id="2236" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">并且<code class="du ma mb mc md b">EmployeeEditDataDTO.java</code>将具有以下特性:</p><ul class=""><li id="1a51" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">员工 Id</li><li id="b829" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">用户想要编辑的前一日期</li><li id="3160" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">新的休假日期</li></ul><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="6004" class="mi ir hi md b fi mj mk l ml mm">package com.employee.attendance.dto;</span><span id="f9ce" class="mi ir hi md b fi mn mk l ml mm">import lombok.Data;</span><span id="1a77" class="mi ir hi md b fi mn mk l ml mm">@Data<br/>public class EmployeeEditDataDTO {<br/>    private String employeeId;<br/>    private String previousDate;<br/>    private String newDate;<br/>}</span></pre><blockquote class="lp lq lr"><p id="73f9" class="jo jp ls jq b jr km jt ju jv kn jx jy lt ko kb kc lu kp kf kg lv kq kj kk kl hb bi translated"><code class="du ma mb mc md b">@Data</code>是一个有用的注释，它捆绑了<code class="du ma mb mc md b">@ToString</code>、<code class="du ma mb mc md b">@EqualsAndHashCode</code>、<code class="du ma mb mc md b">@Getter</code> / <code class="du ma mb mc md b">@Setter</code>的特性。它在 Lombok dependency 下可用。</p></blockquote><h1 id="963e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">测试端点</h1><p id="2615" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">出于测试目的，我已经手动将一些初始数据插入到数据库表中(通过单击表右上角的“+”号):</p><ul class=""><li id="04fc" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">表<strong class="jq hj">员工</strong></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/394a71667660a4e75a13c8b221638956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NKjPuqadgzfxUF_n.png"/></div></div></figure><ul class=""><li id="ae40" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">表<strong class="jq hj">离开</strong></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/0be1822908eb60773cc5f73037266d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NqSiyu0OY_PUKpHV.png"/></div></div></figure><p id="2215" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，您必须点击这 4 个 API 端点来检查是否一切都按预期运行。</p><p id="b8e7" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为此，您必须从他们的<a class="ae lf" href="https://www.postman.com/downloads/" rel="noopener ugc nofollow" target="_blank">官方下载</a>中下载您本地开发环境中的 Postman 应用程序。</p><p id="6dfe" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下载并成功安装后，打开应用程序并运行您的 Spring Boot 应用程序。</p><p id="e85e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果您使用的是 IntelliJ IDEA 之类的 IDE，可以按照以下说明运行 Spring Boot 应用程序:</p><ul class=""><li id="caa7" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">点击顶部菜单栏中的<code class="du ma mb mc md b">Add Configuration</code>。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/566fdda5624f75d15188f93e40355e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HkAU_PP4M3hFteuv.png"/></div></div></figure><ul class=""><li id="f5b1" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">一个新的对话框将会打开，点击<code class="du ma mb mc md b">Add new run configurations</code>并从下拉列表中选择<code class="du ma mb mc md b">Maven</code>。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/46587a5fa512d2fc14ce41864e95c8d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gUXGu2mbbEIBCyQo.png"/></div></div></figure><ul class=""><li id="9223" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">为您的运行配置命名。工作目录将被自动选择。你只需要在命令行中输入命令<code class="du ma mb mc md b">spring-boot:run</code>，然后点击应用和确定，最后运行应用程序。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/06f36a70f67196c46e970b9593fcb651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_bga9fSCe-1hfJrs.png"/></div></div></figure><p id="c90d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你要做的下一件事是通过邮递员应用程序到达终点:</p><ul class=""><li id="01ca" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">/api/get/all/leaves/{employeeId}</code></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d2ff2b63f89a200f4e68ae8a332030ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_QJInlELDOGoIV_N.png"/></div></div></figure><ul class=""><li id="955f" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">/api/add/leave</code></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/e7a1326aee3f05b93dfe100891f7d613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cHHIFDWCw3jqORKi.png"/></div></div></figure><p id="ff01" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了检查假期是否添加成功，让我们再次调用您在第一步中使用的<code class="du ma mb mc md b">api/get/all/leaves</code> API:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/a0ef5a743d86b722ec7cd104003de23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6mZvTJ0kCFvAwQdU.png"/></div></div></figure><p id="d2ca" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">正如您在响应中看到的，ID 为 1 的员工现在有两个假期。这同样反映在数据库中:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/b56b1e900ec3dd03d5940b03115a08c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xO1eZRepajvxU9U9.png"/></div></div></figure><ul class=""><li id="22b3" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">/api/edit/leave</code></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/8949b93b8fc3cb4801665fe8ec45c9c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aO3aV3Fft21z8AZt.png"/></div></div></figure><p id="a511" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">同样，让我们检查之前的日期是否已被修改，您将得到:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/1fac0cd9659f898aa7220f01fff6158d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*HezoxKwrNA7V6oD_.png"/></div></div></figure><p id="d750" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">这意味着编辑功能也运行良好。</p><ul class=""><li id="23f7" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated"><code class="du ma mb mc md b">/api/cancel/leave</code></li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/9c1295f99391f61ea962f137af4b268e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5bkFbbpfSrJiB60M.png"/></div></div></figure><p id="59d1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在点击 GET leaves API，您应该只得到一个响应条目:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/da86904b500515d2c6d557174d2b822a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IlFc0xk0jIV6CWFZ.png"/></div></div></figure><p id="6df8" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因此，您的所有端点都在本地开发环境中正常工作。让我们继续看如何将这些 API 部署到服务器上。</p><h1 id="e66d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创建 JAR 文件</h1><p id="5d2a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">JAR(Java Archive)是一种包文件格式，用于将所有 Java 类文件以及相关的元数据和资源(文本、图像等)聚集在一起。)合并到一个文件中，以便在 Java 平台上分发应用软件或库。</p><p id="bee2" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">简单地说，JAR 文件包含。类文件、音频文件、图像文件或其他目录。</p><p id="779d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">要创建 JAR 文件，请确保 Maven 安装在您的本地开发环境中。如果没有，请按照以下步骤配置 maven(在 Windows 操作系统中):</p><ul class=""><li id="7cb4" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">导航到官方<a class="ae lf" href="https://maven.apache.org/download.cgi" rel="noopener ugc nofollow" target="_blank"> Maven 网站</a>并下载 Maven zip 文件。比如:apache-maven-3.8.2-src.zip。</li><li id="e77b" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">解压内容，复制里面的<code class="du ma mb mc md b">bin</code>文件夹的路径。</li><li id="092f" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">从控制面板打开你的系统环境变量，找到<code class="du ma mb mc md b">PATH</code>变量然后点击<code class="du ma mb mc md b">Edit</code>按钮。</li><li id="24a6" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">在“编辑环境变量”对话框中，点击<code class="du ma mb mc md b">New</code>并添加您刚刚复制的<code class="du ma mb mc md b">bin</code>文件夹的完整路径。</li><li id="d859" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">最后点击<code class="du ma mb mc md b">OK</code>。要测试配置，打开一个新的命令提示符并键入<code class="du ma mb mc md b">mvn –version</code>。如果您可以看到某个版本，这意味着配置是正确的。</li></ul><blockquote class="lp lq lr"><p id="8cee" class="jo jp ls jq b jr km jt ju jv kn jx jy lt ko kb kc lu kp kf kg lv kq kj kk kl hb bi translated">如果你使用的是其他操作系统，你可以在 Maven 官方网站上找到安装步骤。关于更详细的步骤，你也可以查看这篇文章。</p></blockquote><p id="6db1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">接下来，为您的应用程序创建一个 JAR 文件，在您的项目根目录中运行命令<code class="du ma mb mc md b">mvn clean install</code>。</p><p id="bcc0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">将创建一个名为<strong class="jq hj">目标</strong>的新文件夹。在这个文件夹中，您将找到新创建的 JAR 文件。</p><p id="cd97" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另一种创建 JAR 文件的方法是从 IDE 中创建。例如，在 Intellij 中，您可以从侧边栏菜单导航到<strong class="jq hj"> maven </strong>选项卡，然后双击<strong class="jq hj"> Install </strong>。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/55f1f4ed4a4ea641a5064aafe742617c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Dg_GwMLGMCbqvMXm.png"/></div></div></figure><p id="2e4a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在，您的完整项目结构应该是这样的:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="4946" class="mi ir hi md b fi mj mk l ml mm">├── lib<br/>├── src<br/>├── target<br/>└── pom.xml</span></pre><p id="b58a" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在<code class="du ma mb mc md b">src&gt;main&gt;java&gt;com&gt;employee&gt;attendance</code>中，您应该有以下文件和结构:</p><pre class="lg lh li lj fd me md mf mg aw mh bi"><span id="9816" class="mi ir hi md b fi mj mk l ml mm">├── controller<br/>│   └── AttendanceController.java<br/>├── dto<br/>│   └── EmployeeDataDTO.java<br/>│   └── EmployeeEditDataDTO.java<br/>├── service<br/>│   └── AttendanceService.java<br/>│   └── ConnectionService.java<br/>└── AttendanceApplication.java</span></pre><h1 id="9f69" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">将应用程序部署到 AWS</h1><p id="6be8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">最后一步是将您的代码部署到服务器上。在本节中，您将了解如何将应用程序部署到 AWS Elastic Beanstalk。</p><blockquote class="lp lq lr"><p id="6bad" class="jo jp ls jq b jr km jt ju jv kn jx jy lt ko kb kc lu kp kf kg lv kq kj kk kl hb bi translated">使用<a class="ae lf" href="https://aws.amazon.com/elasticbeanstalk/" rel="noopener ugc nofollow" target="_blank"> Elastic Beanstalk </a>，您可以轻松地在 AWS 云中部署和管理应用程序，而无需担心运行这些应用程序的基础设施。它降低了管理的复杂性，而不限制选择或控制。您只需上传您的应用程序，Elastic Beanstalk 就会自动处理容量供应、负载平衡、伸缩和应用程序健康监控等细节。</p></blockquote><h1 id="798d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">创造弹性豆茎环境</h1><p id="be36" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">一旦你登录到你的<a class="ae lf" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS 账户</a>，进入顶部的搜索面板，输入“Elastic Beanstalk”，点击右上角的创建一个新的应用程序。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/21e3aff40a5650b53c15ec1061c298b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ztjMEiz39YYiG_wY.png"/></div></div></figure><p id="cff0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">它会询问您:</p><ul class=""><li id="3edf" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">应用程序名称</li><li id="6d36" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">应用程序标签(非强制性)</li><li id="2384" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">平台</li><li id="1aa0" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">应用代码</li></ul><p id="bbe1" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">输入您的应用程序名称，您可以选择为您的 Elastic Beanstalk 应用程序的资源添加多达 50 个标签。</p><p id="e7ac" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于平台，从下拉列表中选择“Java ”,它会自动填写“平台分支”和“版本”。</p><p id="041d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于应用程序代码，选择 Upload your code，然后选择上一步中构建的 JAR 文件。</p><p id="3526" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">检查配置并启动环境。随着应用程序的启动，您将在环境控制面板上看到与此类似的内容:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/cc8891c708f679f1f4790fe1ff3e0704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lR8uRWETaSN42Y0c.png"/></div></div></figure><p id="1e90" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">一旦部署了应用程序资源并创建了环境，您会注意到应用程序的健康状况仍然很严峻。这是因为 Spring Boot 应用程序仍然需要一些配置:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mo"><img src="../Images/c72af38a0837d4435b9813d238b0bfc9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oQwZ5OfWpP9UzfCf.png"/></div></div></figure><p id="76d6" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下一节我们来看看怎么解决。</p><h1 id="9374" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">通过环境变量配置 Spring Boot</h1><p id="f398" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">默认情况下，Spring Boot 应用程序监听端口 8080，而 Elastic Beanstalk 希望应用程序监听端口 5000。</p><p id="6c9e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">有两种方法可以修复这个错误，要么您必须更改 Elastic Beanstalk 配置使用的端口，要么更改 Spring Boot 应用程序监听的端口。对于本教程，您将更改 Spring Boot 应用程序监听的端口，因为这样更容易。</p><p id="7599" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为此，您必须在 Elastic Beanstalk 的环境中定义 SERVER_PORT 环境变量，并将其值设置为 5000。</p><ul class=""><li id="e20e" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">在环境页面的侧边栏菜单中单击配置。</li><li id="c173" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">在配置页面上，您将看到软件配置，单击编辑:</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d1b181181ce90aa2d14af3217fe8b8ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4F0NoYJzZSxG9ndA.png"/></div></div></figure><ul class=""><li id="854e" class="kr ks hi jq b jr km jv kn jz kt kd ku kh kv kl kw kx ky kz bi translated">接下来，您将看到已经设置了一些环境变量。当被配置为使用 Java 平台时，它们是由 Elastic Beanstalk 自动设置的。</li><li id="5bac" class="kr ks hi jq b jr la jv lb jz lc kd ld kh le kl kw kx ky kz bi translated">要修改 Spring Boot 监听的端口，如上所述，您需要添加一个名为<code class="du ma mb mc md b">SERVER_PORT</code>的新环境变量，其值为 5000。</li></ul><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/ee1671581588560b56fd30198c6e8dd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3fRw-D7Ewnn1VyXZ.png"/></div></div></figure><p id="241e" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">单击应用，配置更改将使应用程序重启。</p><p id="a5eb" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">重启后，它将通过环境变量获得新的配置。大约一分钟后，您将获得一个健康的应用程序实例并开始运行。</p><h1 id="6560" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">在云中测试应用程序</h1><p id="6b3f" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">一旦部署成功，您将获得您的应用程序基础 URL。您也可以从侧边栏访问相同的内容:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/d6cca429edab2da54769802c065ae5de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NlpWBUM5kpFQKyjQ.png"/></div></div></figure><p id="0ddf" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">现在用这个新的 URL 替换<code class="du ma mb mc md b">localhost:8080</code>,并尝试访问您的 API 端点之一:</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lz"><img src="../Images/eed41a69f3609f20bf47650db574cea3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WZ-IW9gH6MSYnr0R.png"/></div></div></figure><p id="c1c0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">你可以得到正确的答案。这意味着应用程序已经成功部署。</p><h1 id="a565" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="d3ca" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">至此，本教程到此结束。本教程的目的是使用 Spring Boot 和 HarperDB 来创建微服务。您还了解了如何将相同的应用程序部署到 AWS 的逐步过程。</p><p id="f60b" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">Spring Boot 和 AWS 都在行业中广泛使用，但 HarperDB 对您来说可能是新的。选择 HarperDB 的原因是因为它易于与 Spring Boot 应用程序集成，以及我在本文开头提到的显著特性。</p><p id="bcc5" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我希望你学到了新东西。万一你在某个地方卡住了，请随时在评论中射出你的疑惑。</p><p id="94d3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，本教程中使用的应用程序的完整源代码可以在这个<a class="ae lf" href="https://github.com/ApoorvTyagi/Spring-Harper" rel="noopener ugc nofollow" target="_blank"> GitHub 资源库</a>中找到。</p></div></div>    
</body>
</html>