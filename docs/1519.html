<html>
<head>
<title>OS Design: I/O optimizations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">操作系统设计:I/O 优化</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/os-design-i-o-optimizations-6c0e584372be?source=collection_archive---------10-----------------------#2021-03-23">https://medium.com/nerd-for-tech/os-design-i-o-optimizations-6c0e584372be?source=collection_archive---------10-----------------------#2021-03-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="873f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我将告诉你操作系统如何管理 I/O 设备。我们知道 I/O 设备比 CPU 或 RAM 慢，因此操作系统开发人员想出了添加特殊调度程序、缓存和缓冲区的主意。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/508393a8429dc48bd296afbe7536c261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AglRVSAKNaB4COc8.jpg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Windows、Linux 和 Mac OS</figcaption></figure><p id="9f44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在阅读这篇文章之前我强烈推荐阅读</strong> <a class="ae jt" href="https://dmfrpro.medium.com/os-design-threads-and-dispatcher-6de6f6ef4bc3" rel="noopener"> <strong class="ih hj">这篇文章</strong> </a> <strong class="ih hj">关于进程、线程和调度器。</strong></p><h2 id="29ad" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">DMA 和 I/O 总线</h2><p id="b57a" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我们都知道，CPU、RAM、GPU 是连在一条系统总线上的。在硬件上，总线是 PCI-Express 总线，可以在很短的时间内传输千兆字节的数据。</p><p id="23bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请看下图:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/2bf440970bf1b08f2af263a8c264d506.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m58g1sFbiwzAANei-Jr_Iw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">系统总线和连接的设备</figcaption></figure><p id="3e6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是这种连接方式在人们开发<strong class="ih hj"> DMA </strong>的时候被修改了。</p><p id="8718" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> DMA(直接内存访问)是一种共享数据模式，当 I/O 设备没有连接到 CPU 时。</strong>输入/输出设备连接到独立的<strong class="ih hj">输入/输出总线(SATA)。这项技术提高了数据传输的速度，因为现在 CPU 不处理 I/O 设备的数据。</strong></p><p id="084b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请看下图:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/a938cbbf871a98a11391d7cfdc5d655e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5WumiAYd-SNEOGlbbsFbWQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">具有 I/O 总线的支持 DMA 的系统</figcaption></figure><h2 id="a6b5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">缓存和缓冲</h2><p id="356b" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated"><strong class="ih hj">硬盘缓存(缓冲存储器)是一种特殊的快速存储器，用于存储进程和 CPU 最常用的数据。</strong>该内存芯片位于每个硬盘/固态硬盘上。</p><p id="eb35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">想象一下硬盘没有高速缓存。我们知道 HDD 不支持并行读写，当很多进程调用 HDD 写东西的时候，会有一个调用队列。并且进程必须<strong class="ih hj">等待</strong>直到 HDD 不执行队列前面的操作，我们失去性能。</p><p id="b778" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看下图:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/d7aa9500235f0dfba3fbfd75e20d7c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ucyrKUEGZ3cT9nFrCV_J0A.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">无缓存硬盘与带缓存和多缓冲的硬盘</figcaption></figure><p id="6c14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与没有高速缓存的 HDD/SSD 相比，高速缓存可提供更快的读取操作。</p><h2 id="687f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">调度器及其算法</h2><p id="57bd" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我们知道硬盘有一个磁头，可以将数据写入磁盘或从磁盘读取数据。这些物理操作太慢，开发人员想出了有趣的解决方案——调度器。</p><p id="ad0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">调度程序是一个管理输入输出操作的程序。</strong>例如，在上图中，调度程序响应将数据从硬盘加载到高速缓存，反之亦然——从高速缓存加载到硬盘。</p><p id="36c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看看默认情况:我们有一千个点随机分布在磁盘上，我们需要使用 HDD 的磁头在最短的时间内读取所有这些点。</p><p id="3833" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">有三种类型的调度:</strong></p><ol class=""><li id="6eb0" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj">短期调度</strong> —从硬盘读取/写入数据，并将其发送到线程</li><li id="56d8" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">中期调度</strong> —调用将数据从 HDD 交换到 RAM</li><li id="1896" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">长期调度</strong> —将线程添加到队列中</li></ol><p id="1e8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">读写点数的算法有 3 组:</strong></p><ol class=""><li id="3e79" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated"><strong class="ih hj"> FCFS 和 FCLS </strong> —以 FIFO(先进先出)或 LIFO(后进先出)顺序处理呼叫。这些算法不是很有效，有时我们可能会资源匮乏</li><li id="d73b" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj"> SSTF 和 SJF</strong>——以最短的周转时间处理电话</li><li id="6d95" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated"><strong class="ih hj">扫描查看</strong> —处理从磁盘开始到磁盘结束的调用，反之亦然</li></ol><p id="0711" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现代调度程序使用的算法包括 SSTF/SJF 和扫描/观察基本算法的优点。</p></div></div>    
</body>
</html>