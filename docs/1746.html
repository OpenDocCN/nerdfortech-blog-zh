<html>
<head>
<title>Predicting Customer Churn with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用机器学习预测客户流失</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/predicting-customer-churn-with-machine-learning-65a7ccac2f5d?source=collection_archive---------9-----------------------#2021-04-04">https://medium.com/nerd-for-tech/predicting-customer-churn-with-machine-learning-65a7ccac2f5d?source=collection_archive---------9-----------------------#2021-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fbf3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着如此多的公司和企业采用技术工具来帮助运营他们的服务，重要的是他们能够判断哪个客户正处于被另一个竞争对手夺走的边缘。客户流失率是在一定时间内停止使用公司产品或服务的客户的百分比。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e48027f0beb33dae41cb85ae5eed3d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iaMZGTm3zTxMGrg3QP-H_g.jpeg"/></div></div></figure><p id="d453" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇短文旨在介绍如何使用影响客户流失的参数的先前数据来训练机器学习模型，并从模型做出的预测中获得信息，然后采取措施来留住可能有较低机会留下的客户。所以让我们开始吧！</p><h1 id="e4f3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">可用数据集</strong></h1><p id="ce8d" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">将使用的<a class="ae ks" href="https://github.com/IBM/watson-studio-learning-path-assets/blob/master/data/customer-churn-kaggle.csv" rel="noopener ugc nofollow" target="_blank">数据集</a>来自Kaggle，有几个参数(特征)可能会影响客户流失。该CSV文件中包含的总共21列包括:</p><ul class=""><li id="7f92" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">状态</li><li id="ae34" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">账户长度</li><li id="f46d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">电话地区号</li><li id="ce01" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">电话号码</li><li id="1b83" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">国际计划</li><li id="1a0c" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">语音邮件计划</li><li id="8060" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">VMail消息数量</li><li id="f152" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总日分钟数</li><li id="fa59" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">全天通话总数</li><li id="c03b" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">全天费用</li><li id="6168" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总前夜分钟数</li><li id="4bc0" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">Eve呼叫总数</li><li id="2184" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总Eve费用</li><li id="67f2" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">夜间总分钟数</li><li id="6af8" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">夜间通话总数</li><li id="a034" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总夜间费用</li><li id="7df0" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总Int分钟数</li><li id="7d7e" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">Int调用总数</li><li id="e369" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总利息费用</li><li id="ad3f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">客户服务电话</li><li id="165e" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">搅拌</li></ul><p id="1bcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上面的列中，我们感兴趣进行预测的确切列是“客户流失”，因此这将被视为我们的标签数据。下面是数据集的预览</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lh"><img src="../Images/17b76090d5f6b48107f8bc81af4b6492.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJOiaJGMlYWJ0Wezfph0zQ.png"/></div></div></figure><p id="05bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给出数据集的概要后，接下来是为训练我们的模型制定一个行动计划。</p><h1 id="88d1" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">行动（或活动、袭击）计划</h1><ul class=""><li id="7cf7" class="kt ku hi ih b ii kn im ko iq li iu lj iy lk jc ky kz la lb bi translated">选择最佳列</li><li id="ee65" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">将要素列与标注列分开</li><li id="644a" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">用编码器预处理数据</li><li id="99da" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">检查空值</li><li id="5fb4" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">将数据分为训练数据和测试数据</li><li id="7b1d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">将数据输入线性回归模型</li><li id="632d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">做预测</li></ul><h2 id="99ac" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">选择最佳列</h2><p id="01b8" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">有了这么多可用的栏目，我们需要决定哪些栏目最能影响客户流失。对客户流失影响最大的列如下。这种情况可能并不总是如此，但与此同时，这些因素最能影响客户流失:</p><ul class=""><li id="d856" class="kt ku hi ih b ii ij im in iq kv iu kw iy kx jc ky kz la lb bi translated">vmail消息数量</li><li id="cb56" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总日分钟数</li><li id="f24f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">全天通话总数</li><li id="49e8" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">全天费用</li><li id="483b" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总前夜分钟数</li><li id="709d" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">eve呼叫总数</li><li id="7ef1" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总eve费用</li><li id="1c01" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">夜间总分钟数</li><li id="efcc" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">夜间通话总数</li><li id="406e" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总夜间费用</li><li id="a1ae" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总国际分钟数</li><li id="4dd0" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">国际电话总数</li><li id="3709" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">总国际费用</li><li id="4074" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">客户服务电话</li><li id="fa2f" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">国际计划</li><li id="d2dd" class="kt ku hi ih b ii lc im ld iq le iu lf iy lg jc ky kz la lb bi translated">语音邮件计划</li></ul><p id="93cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导入要使用的模块</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="c601" class="ll jq hi ma b fi me mf l mg mh">import numpy as np<br/>import pandas as pd<br/>from sklearn.linear_model import LinearRegression<br/>from category_encoders import BinaryEncoder<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.metrics import accuracy_score</span></pre><p id="d899" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">读入数据集:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="3db2" class="ll jq hi ma b fi me mf l mg mh">data = pd.read_csv('customer-churn-kaggle.csv')</span></pre><h2 id="6463" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">将要素列与标注列分开</h2><p id="b76a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">将感兴趣的列分为功能和标签，然后删除不相关的列</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="953c" class="ll jq hi ma b fi me mf l mg mh">features = data.drop(columns = ['churn', 'phone number', 'area code', 'state', 'account length'], axis=0)<br/>labels = data[['churn']]</span></pre><h2 id="6a22" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">用编码器预处理数据</h2><p id="244a" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">感兴趣但具有非数字值的列必须编码成数字格式，这可以使用编码器来实现。“国际计划”和“语音邮件计划”列中有“是”或“否”。由于这些不是数字，我们将使用二进制编码器将它们编码成数字格式:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="b605" class="ll jq hi ma b fi me mf l mg mh"># create binary encoder object<br/>encoder = BinaryEncoder()</span><span id="7b03" class="ll jq hi ma b fi mi mf l mg mh"># convert international plan to binary<br/>newData = encoder.fit_transform(features['international plan'])<br/>international_plan_encoded = newData.drop(['international plan_1'], axis=1)</span><span id="0d03" class="ll jq hi ma b fi mi mf l mg mh"># add encoded column back to features dataframe<br/>features = pd.concat([features, international_plan_encoded], axis=1)</span><span id="1091" class="ll jq hi ma b fi mi mf l mg mh"># drop international plan column since it has been encoded<br/>features = features.drop(columns=['international plan'], axis=1)</span></pre><p id="6771" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对“内部计划”列进行编码后，我们通过串联将编码后的表单添加回特征数据帧，并删除未编码的列。接下来，我们对“语音邮件计划”列进行编码</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="ac83" class="ll jq hi ma b fi me mf l mg mh"># create binary encoder object<br/>voicemail_encoder = BinaryEncoder()</span><span id="2de8" class="ll jq hi ma b fi mi mf l mg mh"># convert international plan to binary<br/>voice_mail_encoded = voicemail_encoder.fit_transform(features['voice mail plan'])<br/>voice_mail_encoded = voice_mail_encoded.drop(columns=['voice mail plan_0'])</span><span id="3d6b" class="ll jq hi ma b fi mi mf l mg mh"># add encoded column back to features dataframe<br/>features = pd.concat([features, voice_mail_encoded], axis=1)</span><span id="20aa" class="ll jq hi ma b fi mi mf l mg mh"># drop voice mail plan column since it gas been encoded<br/>features = features.drop(columns=['voice mail plan'], axis=1)</span></pre><h2 id="05e5" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">检查空值</h2><p id="6bed" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">在机器学习的预处理步骤中，非常关键的是确保您的数据没有空值或空字段。我们可以检查是否有任何列包含任何空字段:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="7a63" class="ll jq hi ma b fi me mf l mg mh">features.isnull()</span></pre><p id="6dc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行上述代码的结果是:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/2768efc9ff8bbedb36b02f767a54e43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZXcQOTVduE226ZJycY1kQ.png"/></div></div></figure><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="6dd8" class="ll jq hi ma b fi me mf l mg mh">features.isnull().values.any()<br/>&gt;&gt;False</span><span id="9148" class="ll jq hi ma b fi mi mf l mg mh">labels.isnull().values.any()<br/>&gt;&gt;False</span></pre><h2 id="8988" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">将数据分为训练数据和测试数据</h2><p id="9385" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">预处理数据后，下一步是将要素和标注拆分为训练和测试数据，以输入线性回归模型:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="6b1f" class="ll jq hi ma b fi me mf l mg mh"># split data into train and test<br/>features_train, features_test, labels_train, labels_test = train_test_split(features, labels, test_size=0.33)</span></pre><h2 id="388e" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">将数据输入线性回归模型</h2><p id="a0f0" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">现在是创建线性回归模型的时候了，该模型将输入将要素和标注分割成训练和测试后获得的数据:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="f183" class="ll jq hi ma b fi me mf l mg mh"># create model<br/>model = LinearRegression()</span></pre><p id="92fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来是将训练特征和标签拟合到线性回归模型中:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="ae93" class="ll jq hi ma b fi me mf l mg mh"># fit data into the model<br/>model.fit(features_train, labels_train)</span></pre><p id="513d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给模型打分让我们清楚地看到我们的模型做得有多好。我们运行模型100次迭代，因此我们可以改进模型的性能</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="6786" class="ll jq hi ma b fi me mf l mg mh">for e in range(100):<br/>    features_train, features_test, labels_train, labels_test = train_test_split(features, labels, test_size=0.33)<br/>    score = model.score(features_test, labels_test)<br/>    print(score)</span></pre><h2 id="64f2" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">做预测</h2><p id="b76b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">最后，在模型从提供给它的数据中学习之后，是时候使用我们最初通过拆分数据获得的测试数据进行预测了:</p><pre class="je jf jg jh fd lz ma mb mc aw md bi"><span id="9c1b" class="ll jq hi ma b fi me mf l mg mh"># make prediction<br/>features_train.head()<br/>preds = model.predict(features_test)</span><span id="121b" class="ll jq hi ma b fi mi mf l mg mh">for pred, act in zip(preds, labels_test['churn']):<br/>    print('The predicted val is: ', round(float(pred)), ' Actual: ', act)</span></pre><p id="ca0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述代码输出以下内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/e3ede896bad7ee1f329b9e19147e8b55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHKY7wOplad308cjGv91fw.png"/></div></div></figure><h2 id="3967" class="ll jq hi bd jr lm ln lo jv lp lq lr jz iq ls lt kd iu lu lv kh iy lw lx kl ly bi translated">结论</h2><p id="84e4" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">从上面的输出可以看出，这个模型做得相当好。0代表假，1代表真。</p><p id="98a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，该模型可以被导出，托管在服务器上，并可以在web应用程序或移动应用程序中用于检查客户流失。</p><p id="895a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你坚持到最后:)</p></div></div>    
</body>
</html>