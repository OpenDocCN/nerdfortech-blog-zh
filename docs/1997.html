<html>
<head>
<title>Building a Rich Text Editor: Day 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建富文本编辑器:第1天</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/building-a-rich-text-editor-day-1-18771b9d4be2?source=collection_archive---------6-----------------------#2021-04-16">https://medium.com/nerd-for-tech/building-a-rich-text-editor-day-1-18771b9d4be2?source=collection_archive---------6-----------------------#2021-04-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8eb9" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">项目结构|开发核心|识别关键子问题</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ix"><img src="../Images/536eb28ba82ee4c1b4b7d9f39a0ad4c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*DVg7JM9XAumqZvnUAR1VYA.png"/></div></figure><h2 id="4d86" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated"><a class="ae kd" href="https://svr8.medium.com/building-a-rich-text-editor-index-5d11d23c5111" rel="noopener">指标</a></h2><p id="c564" class="pw-post-body-paragraph ke kf hi kg b kh ki ij kj kk kl im km jq kn ko kp ju kq kr ks jy kt ku kv kw hb bi translated">构建了两次编辑器后，我意识到有太多的东西在运行，我忘记了几分钟前我构建了什么。整个项目无休止的滚动和模糊的结构让我失去了注意力。在这篇文章中，我将在开始真正的开发之前，构建我的项目并确定关键的子问题。这只是为了防止我迷失在庞大的代码库中。</p><p id="0f20" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">事实上，文本编辑器非常类似于制造一个机器人。当我把编辑当成机器人时，我会说机器人有一系列传感器和组件(键盘、鼠标和屏幕)，所以它知道是否有人告诉它做什么。所以，有一些数据流(像click、mouseup、keydown这样的事件)向机器人报告数据。它将分析来自所有3个设备的数据，并作出决定(事件处理程序)和执行的东西(反映在屏幕上的任何编辑)。</p><p id="7a81" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">如果我把上面描述的行为放在构建网页的技术术语中，核心编辑器逻辑将有:</p><ul class=""><li id="28ca" class="lc ld hi kg b kh kx kk ky jq le ju lf jy lg kw lh li lj lk bi translated"><strong class="kg hj">事件处理程序部分:</strong>接收所有通过DOM输入的数据流(键盘和鼠标)。</li><li id="3e55" class="lc ld hi kg b kh ll kk lm jq ln ju lo jy lp kw lh li lj lk bi translated"><strong class="kg hj">自定义处理器:</strong>解释组合并根据文档的当前状态做出决定。这意味着各种文档特性的高级实现。</li><li id="c667" class="lc ld hi kg b kh ll kk lm jq ln ju lo jy lp kw lh li lj lk bi translated"><strong class="kg hj"> DOM操纵器:</strong>做出决定后，任何视觉上的改变都将通过一个操纵器来实现。</li><li id="798d" class="lc ld hi kg b kh ll kk lm jq ln ju lo jy lp kw lh li lj lk bi translated"><strong class="kg hj">实用程序:</strong>这些是辅助功能，不会直接与键盘、鼠标或屏幕交互。它们主要是上述3个部分经常使用的一些操作的转储。</li></ul><h1 id="0499" class="lq jg hi bd jh lr ls lt jl lu lv lw jp io lx ip jt ir ly is jx iu lz iv kb ma bi translated">文件夹结构</h1><p id="4c6f" class="pw-post-body-paragraph ke kf hi kg b kh ki ij kj kk kl im km jq kn ko kp ju kq kr ks jy kt ku kv kw hb bi translated">我将从用<code class="du mb mc md me b">ng new text-editor</code>创建一个项目开始，并创建以下结构:</p><pre class="iy iz ja jb fd mf me mg mh aw mi bi"><span id="81df" class="jf jg hi me b fi mj mk l ml mm">src<br/>| assets<br/>| | fonts<br/>| | images<br/>| | styles<br/>|<br/>| app<br/>| | config<br/>| | models<br/>| | modules<br/>| | | text-editor<br/>| | | | components<br/>| | | | | editor &lt;- generated using angular cli<br/>| | | | util<br/>| | util</span></pre><p id="bc17" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">assets </code>文件夹非常直观。我在这里有所有的资源文件，比如SVG、png，甚至全局样式，比如颜色主题。</p><p id="156e" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">app</code>是所有源代码的根:</p><p id="a527" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">config</code>:这里的文件只包含常量变量。</p><p id="acde" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">models</code>:所有与编辑器相关的逻辑类都应该放在这里。这些模型永远不会直接与任何外部实体(如DOM、鼠标或键盘)进行交互。它们表示文档的当前<em class="mn">状态</em>。</p><p id="0808" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">modules</code>:这将包含角度模块。我们将有一个模块来包含所有的文档组件。每个模块都有一个保存所有组件的<code class="du mb mc md me b">components</code>目录和一个保存任何指令或服务的<code class="du mb mc md me b">util</code>目录。</p><p id="5268" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><code class="du mb mc md me b">util</code>:我们可能需要额外的助手工具，这些工具不一定与文档的行为相关，例如，Rope数据结构。如果我选择实现Rope，我会把它放在这里。</p><h1 id="0576" class="lq jg hi bd jh lr ls lt jl lu lv lw jp io lx ip jt ir ly is jx iu lz iv kb ma bi translated">开发模型设计</h1><p id="007b" class="pw-post-body-paragraph ke kf hi kg b kh ki ij kj kk kl im km jq kn ko kp ju kq kr ks jy kt ku kv kw hb bi translated">从哪里开始？！？！？！我通常从关注UI设计和任何已经开发的核心数据结构开始。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mo"><img src="../Images/a356b2c24c9795e469165d9d1d0ff897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lwVL9Y8wu7R_sVh686f_qg.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">第0天设计</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mx"><img src="../Images/98e1c1682f9676c774aa539e972e31d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*OhlBpxXd7SHgYw3uvY-XUg.png"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">模型</figcaption></figure><p id="a875" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">我暂时将编辑工具留在标题中。我将从开发核心模型开始，并尝试将其链接到DOM。我将在文档中添加一个<code class="du mb mc md me b">id </code>和<code class="du mb mc md me b">title </code>属性。这将使它很容易存储在数据库中，并帮助我在DOM中定位文档。让我们在模型下创建<em class="mn"> Block.ts </em>、<em class="mn"> Page.ts </em>和<em class="mn"> Doc.ts </em>文件。</p><p id="84b5" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">在我开始编辑我们的angular组件文本编辑器之前，我将组织一下结构，因为我相信这个文件会非常大。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es my"><img src="../Images/ece718f66e796a74104c8bc550bf4421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sTjhTav7Ak-PhWDytdRBOg.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">文本编辑器.组件. ts</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es mz"><img src="../Images/7b6e68fadf146f7c7062826394c41c72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSmxETTv5QfS2SgaYqoUoQ.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">文本编辑器.组件. ts</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es na"><img src="../Images/954db46ae53c843ddf50bd100ec99c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*5laszvISa6EOaMmwRvYnyQ.png"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">text-editor.component.html</figcaption></figure><p id="8ef9" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">这些部分就是上面4点中描述的部分。我已经将<em class="mn">自定义处理器</em>重命名为用户操作。像<em class="mn"> FindAndReplace </em>这样的特性的所有高级实现都将放在这里。其他部分完全按照上述方式放置。因此，我将创建一个虚拟文档，并随时构建HTML。</p><p id="cd3f" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">我不共享<code class="du mb mc md me b">.scss </code>文件。会很漫长。w3schools.com是我学习时尚的一站式服务点。</p><p id="b01b" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">我这里有一页。但是，那两个虚拟块呢？我需要一些getter setter工具来设置DOM块中的数据。如果您检查这个页面上的页面元素，您将看到两个包含空内容的块div。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nb"><img src="../Images/c572ecf25bd0a9afb7c56086f392e490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IDaK4wTHfXJdzPAbywW7Tw.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">当前用户界面</figcaption></figure><p id="4d60" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">为了完美地定位div，我将为每个页面和块赋予惟一的id。此外，我们需要一些工具将内容放入DOM。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nc"><img src="../Images/3421eed936b3df5266e815fc0a09d8fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xWejImtaaD1QBgZ28fUtMg.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">文本编辑器.组件. ts</figcaption></figure><p id="c94e" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">我已经更新了块和页面的div以支持<code class="du mb mc md me b">ids </code>和<code class="du mb mc md me b">indices</code>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nd"><img src="../Images/2c45e099ea5eb428164e830010448226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*YxlYVyQjwu9aujaiRHYp-A.png"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">text-editor.component.html</figcaption></figure><p id="bd05" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">请注意<code class="du mb mc md me b">(onCreate)</code>事件。Angular不提供每次内容呈现时触发的事件。</p><p id="d990" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">因此，假设我使用<code class="du mb mc md me b">component.ts</code>文件中的doc对象更改块内容，它不会在这里得到反映。为了处理这个问题，我基于StackOverflow的回答创建了一个on-create Angular指令。不过创建这个有点棘手。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es ne"><img src="../Images/bae39990aa8f0e4145999d3fb4efdd46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NC0xP0tskU_IKkU3VlwtLg.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">on-create.directive.ts</figcaption></figure><p id="b472" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">因此，每次我更新doc对象中的页面数组或块数组时，更改都会在这里得到反映。</p><p id="d5b9" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">这是我们的基地。现在应该可以正常工作了。我准备把我能想到的子问题列出来，在后面的文章里迭代解决。</p><h1 id="6a3e" class="lq jg hi bd jh lr ls lt jl lu lv lw jp io lx ip jt ir ly is jx iu lz iv kb ma bi translated">子问题</h1><p id="3256" class="pw-post-body-paragraph ke kf hi kg b kh ki ij kj kk kl im km jq kn ko kp ju kq kr ks jy kt ku kv kw hb bi translated"><strong class="kg hj">将换行符转换成块</strong></p><p id="2161" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">跟进<a class="ae kd" href="https://svr8.medium.com/building-a-rich-text-editor-day-0-faca73c09e00" rel="noopener">区块</a>背后的动机，每次我按下回车键，它不应该扩大当前区块。相反，需要在当前块之后创建一个新块。我将添加一个简单的事件按键事件处理程序并实现它:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es nf"><img src="../Images/da91c8f95efdfba91fc5491fcd1b498b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8MgHM9isyBCZNmirlGDDhA.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">文本编辑器.组件. ts</figcaption></figure><p id="271f" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><strong class="kg hj">检测并触发页面内容溢出分页</strong></p><p id="7119" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">内容是动态的。我无法计算字符数和检查页面尺寸。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="er es ng"><img src="../Images/d2fd86e7a0392074bdc338b976ab6b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CNzwa-JG0BT71AcrIO4Tpg.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">文本编辑器.组件. ts</figcaption></figure><p id="d745" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">一个可能的解决方案是检查DOM中每个块的高度，并将其与页面高度进行比较。但是等等。请注意，当div中的内容溢出时，滚动条会自动出现。通过DOM APIs本身肯定有某种机制。</p><p id="1457" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">DOM已经提供了外部高度和内部滚动高度值。因此，比较它们的值是检查溢出的简单方法。</p><p id="ad79" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><strong class="kg hj">检测并触发阻止块中的内容溢出</strong></p><p id="97be" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">如果你继续输入，你会看到一个区块垂直扩展，为更多的字符腾出空间。我认为这有点棘手。我不能在这里使用页面溢出的解决方案，因为块的高度永远不会相同。由于字体大小不同，它们的高度也不同。嗯，目前，我想不出解决办法。F.</p><p id="a38d" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated"><strong class="kg hj">跨多个块的文本选择</strong></p><p id="0730" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">网页不允许我们一次选择多个div。如果您开始选择文本并将鼠标移过多个块，您将无法选择其他块。必须有一种机制来检测鼠标移动和手动高亮块。我将创建一个鼠标对象<code class="du mb mc md me b">models/MouseData.ts</code>,稍后再对其进行优化:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nh"><img src="../Images/7df7a9ff8bae338cb25d6125b1abc810.png" data-original-src="https://miro.medium.com/v2/resize:fit:856/format:webp/1*T0KqA3pUhKoAowDeW0Lzrw.png"/></div><figcaption class="mt mu et er es mv mw bd b be z dx translated">模型/鼠标数据. ts</figcaption></figure><p id="b78a" class="pw-post-body-paragraph ke kf hi kg b kh kx ij kj kk ky im km jq kz ko kp ju la kr ks jy lb ku kv kw hb bi translated">暂时把它包起来。<br/>拜拜。</p><h2 id="4372" class="jf jg hi bd jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc bi translated"><a class="ae kd" href="https://svr8.medium.com/building-a-rich-text-editor-day-3-ef3e8dc02516" rel="noopener">下一篇文章</a></h2></div></div>    
</body>
</html>