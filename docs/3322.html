<html>
<head>
<title>Spring boot series — Sending Stock market data in JSON form</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring boot 系列—以 JSON 形式发送股票市场数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/spring-boot-series-sending-stock-market-data-in-json-form-cce978a9a90d?source=collection_archive---------8-----------------------#2021-06-06">https://medium.com/nerd-for-tech/spring-boot-series-sending-stock-market-data-in-json-form-cce978a9a90d?source=collection_archive---------8-----------------------#2021-06-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="585c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嗨伙计们。因此，我们创建了股票数据服务来获取单只股票的数据，在本教程中，我将讨论如何改进我们的代码，以 JSON 格式发送一组数据。教程到目前为止，</p><div class="jd je ez fb jf jg"><a href="https://billa-code.medium.com/spring-boot-series-unit-testing-basics-3ce566250465" rel="noopener follow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">弹簧靴系列—单元测试基础</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">嗨伙计们。所以到目前为止，我们已经开发了一个基本的 spring boot 应用程序，它从 Yahoo finance API 获取数据并显示…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">billa-code.medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><div class="jd je ez fb jf jg"><a href="https://billa-code.medium.com/spring-boot-series-stock-market-data-end-point-356592487254" rel="noopener follow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">春靴系列—股市数据终点</h2><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">billa-code.medium.com</p></div></div></div></a></div><div class="jd je ez fb jf jg"><a href="https://billa-code.medium.com/create-the-first-spring-boot-app-4e930d812a22" rel="noopener follow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hj fi z dy jl ea eb jm ed ef hh bi translated">创建第一个春季启动应用程序</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">我不打算深入了解许多功能和描述，而只是深入了解 Spring boot 的世界…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">billa-code.medium.com</p></div></div><div class="jp l"><div class="jw l jr js jt jp ju jv jg"/></div></div></a></div><p id="4e99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们将为此编写一个新的端点“/getStock”。所以代码如下。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="f2d1" class="kg kh hi kc b fi ki kj l kk kl">@GetMapping(value="/getStock")<br/>List&lt;StockModel&gt; getStocks() {<br/>    StockService stockService = new StockService();<br/>    List&lt;StockModel&gt; stocks = new ArrayList&lt;&gt;();<br/>    String[] symbolArr = {"A", "AA", "AAC", "GOOG", "AMZN", "AAT", "AAN", "T", "TD", "TARO", "TM"};<br/><br/>    for (String s : symbolArr) {<br/>        Stock stock = stockService.findStock(s).getStock();<br/>        StockModel stockModel = new StockModel(s, stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/>        stocks.add(stockModel);<br/>    }<br/><br/>    return stocks;<br/>}</span></pre><p id="702d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果您像我们对另一个端点那样运行，您将毫无问题地获得数组中的数据。包含此内容后运行程序，并在浏览器中访问<a class="ae km" href="http://localhost:8080/getStock" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/getStock</a>，您将看到数据。因此，我们在这里所做的是，我们创建了一个模型来封装我们需要返回的股票数据。这个模型在 StockModel.java 的档案里。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="bdea" class="kg kh hi kc b fi ki kj l kk kl">public class StockModel {<br/>    private final String symbol;<br/>    private final String name;<br/>    private final String price;<br/>    private final String chg;<br/><br/>    public StockModel(String symbol, String name, String price, String chg) {<br/>        this.symbol = symbol;<br/>        this.name = name;<br/>        this.price = price;<br/>        this.chg = chg;<br/>    }<br/>}</span></pre><p id="346a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们循环一组硬编码的符号，获取股票的名称、价格和变化百分比值，并使用这些值创建 StockModel 对象。所以现在我们的要求是确保我们发送的数据是 JSON 格式的。因此，我们将添加“produces”参数，并在 GetMapping 注释中将它设置为 JSON 类型。所以现在代码看起来像这样。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="87f5" class="kg kh hi kc b fi ki kj l kk kl">@GetMapping(value="/getStock", produces= MediaType.<em class="kn">APPLICATION_JSON_VALUE</em>)<br/>List&lt;StockModel&gt; getStocks() {<br/>    StockService stockService = new StockService();<br/>    List&lt;StockModel&gt; stocks = new ArrayList&lt;&gt;();<br/>    String[] symbolArr = {"A", "AA", "AAC", "GOOG", "AMZN", "AAT", "AAN", "T", "TD", "TARO", "TM"};<br/><br/>    for (String s : symbolArr) {<br/>        Stock stock = stockService.findStock(s).getStock();<br/>        StockModel stockModel = new StockModel(s, stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/>        stocks.add(stockModel);<br/>    }<br/><br/>    return stocks;<br/>}</span></pre><p id="b068" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们在运行应用程序时遇到了一个错误。当 spring boot 找不到 out StockModel 类的 JSON 映射时，运行时会触发异常。所以我们必须让 spring boot 检测它。为此，我们必须像这样更改 StockModel 类。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="6dd3" class="kg kh hi kc b fi ki kj l kk kl">import com.fasterxml.jackson.annotation.JsonAutoDetect;<br/><br/>@JsonAutoDetect(fieldVisibility = JsonAutoDetect.Visibility.<em class="kn">ANY</em>)<br/>public class StockModel {<br/>    private final String symbol;<br/>    private final String name;<br/>    private final String price;<br/>    private final String chg;<br/><br/>    public StockModel(String symbol, String name, String price, String chg) {<br/>        this.symbol = symbol;<br/>        this.name = name;<br/>        this.price = price;<br/>        this.chg = chg;<br/>    }<br/>}</span></pre><p id="7e35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在代码可以了，我们可以从浏览器中检查数据，或者使用 Postman 检查数据。但是为了支持另一个前端应用程序，我们必须放宽跨源策略。为此，我们可以使用@CrossOrigin 注释。现在控制器看起来像这样。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="43e6" class="kg kh hi kc b fi ki kj l kk kl">@CrossOrigin(origins = "*")<br/>@GetMapping(value="/getStock", produces= MediaType.<em class="kn">APPLICATION_JSON_VALUE</em>)<br/>List&lt;StockModel&gt; getStocks() {<br/>    StockService stockService = new StockService();<br/>    List&lt;StockModel&gt; stocks = new ArrayList&lt;&gt;();<br/>    String[] symbolArr = {"A", "AA", "AAC", "GOOG", "AMZN", "AAT", "AAN", "T", "TD", "TARO", "TM"};<br/><br/>    for (String s : symbolArr) {<br/>        Stock stock = stockService.findStock(s).getStock();<br/>        StockModel stockModel = new StockModel(s, stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/>        stocks.add(stockModel);<br/>    }<br/><br/>    return stocks;<br/>}</span></pre><p id="e97d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的*标记表示我们已启用任何 URL 与此通信。因此，现在我们正在发送一个 JSON 格式的数据列表，但是当与前端应用程序一起使用时，我们在解码 JSON 时会遇到一个问题，因为列表会产生一些错误。为了避免这一点，我使用了另一个叫做 StockResponseModel.java 的模型，代码如下。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="d588" class="kg kh hi kc b fi ki kj l kk kl">import com.fasterxml.jackson.annotation.JsonAutoDetect;<br/><br/>import java.util.List;<br/><br/>@JsonAutoDetect<br/>public class StockResponseModel {<br/>    private String stockExg;<br/>    private List&lt;StockModel&gt; stock;<br/><br/>    public String getStockExg() {<br/>        return stockExg;<br/>    }<br/><br/>    public void setStockExg(String stockExg) {<br/>        this.stockExg = stockExg;<br/>    }<br/><br/>    public List&lt;StockModel&gt; getStock() {<br/>        return stock;<br/>    }<br/><br/>    public void setStock(List&lt;StockModel&gt; stock) {<br/>        this.stock = stock;<br/>    }<br/>}</span></pre><p id="46c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我将更改我的控制器，在一个参数中存储股票列表，在另一个参数中存储交易所名称。所以我最后的 StockController.java 看起来像这样。</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="6c92" class="kg kh hi kc b fi ki kj l kk kl">import models.StockModel;<br/>import models.StockResponseModel;<br/>import org.springframework.boot.SpringApplication;<br/>import org.springframework.boot.autoconfigure.EnableAutoConfiguration;<br/>import org.springframework.http.MediaType;<br/>import org.springframework.http.ResponseEntity;<br/>import org.springframework.web.bind.annotation.CrossOrigin;<br/>import org.springframework.web.bind.annotation.GetMapping;<br/>import org.springframework.web.bind.annotation.RequestMapping;<br/>import org.springframework.web.bind.annotation.RestController;<br/>import service.StockService;<br/>import yahoofinance.Stock;<br/>import java.util.ArrayList;<br/>import java.util.List;<br/><br/>@RestController<br/>@EnableAutoConfiguration<br/>public class StockController {<br/><br/>    @RequestMapping(value="/", produces= MediaType.<em class="kn">APPLICATION_JSON_VALUE</em>)<br/>    StockModel home() {<br/>        StockService stockService = new StockService();<br/>        Stock stock = stockService.findStock("GOOG").getStock();<br/>        StockModel stockModel = new StockModel("GOOG", stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/><br/>        return stockModel;<br/>    }<br/><br/>    @CrossOrigin(origins = "*")<br/>    @GetMapping(value="/getStock", produces= MediaType.<em class="kn">APPLICATION_JSON_VALUE</em>)<br/>    StockResponseModel getStocks() {<br/>        StockService stockService = new StockService();<br/>        List&lt;StockModel&gt; stocks = new ArrayList&lt;&gt;();<br/>        String[] symbolArr = {"A", "AA", "AAC", "GOOG", "AMZN", "AAT", "AAN", "T", "TD", "TARO", "TM"};<br/><br/>        for (String s : symbolArr) {<br/>            Stock stock = stockService.findStock(s).getStock();<br/>            StockModel stockModel = new StockModel(s, stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/>            stocks.add(stockModel);<br/>        }<br/><br/>        StockResponseModel res = new StockResponseModel();<br/>        res.setStock(stocks);<br/>        res.setStockExg("US");<br/><br/>        return res;<br/>    }<br/><br/>    public static void main(String[] args) {<br/>        SpringApplication.<em class="kn">run</em>(StockController.class, args);<br/>    }<br/>}</span></pre><p id="4ca1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们已经成功地创建了一个端点，用于前端应用程序来获取股票市场数据。在接下来的教程中，我将使用这个端点来获取数据到一个 Flutter 前端应用程序。因此，请查看即将发布的帖子和快乐编码。</p></div></div>    
</body>
</html>