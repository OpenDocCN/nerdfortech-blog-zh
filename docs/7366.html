<html>
<head>
<title>Leveraging git hooks with Husky in Javascript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Javascript 中利用 Husky 的 git 挂钩</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/leveraging-git-hooks-with-husky-in-javascript-c34cac4613ee?source=collection_archive---------2-----------------------#2022-10-09">https://medium.com/nerd-for-tech/leveraging-git-hooks-with-husky-in-javascript-c34cac4613ee?source=collection_archive---------2-----------------------#2022-10-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/a0aaa1e8f2590f9b3e9f6131f121c53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C1J0VxC5YBTxqagi"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@maxwelldacombe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">麦克斯韦·达科姆</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><h1 id="ee1a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">快速介绍</h1><p id="189a" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">Git 为在特定事件之前/之后触发命令提供了不同的钩子。但是开发时可能会派上用场的钩子一般是<code class="du kr ks kt ku b">pre-commit</code>、<code class="du kr ks kt ku b">commit-msg</code>和<code class="du kr ks kt ku b">pre-push</code>钩子。</p><p id="2e09" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">我们将使用<code class="du kr ks kt ku b">pre-commit</code>(提交前运行命令，提交失败)和<code class="du kr ks kt ku b">commit-msg</code>(检查提交消息，失败)</p><p id="ec30" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">这些钩子与<code class="du kr ks kt ku b">bash</code>命令一起使用，但是为了快速入门而无需编写<code class="du kr ks kt ku b">bash</code>代码，我们可以使用 Husky npm 包来为我们设置。</p><h1 id="da88" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">设置 Husky</h1><p id="5b39" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">这很容易，因为默认情况下，husky 提供了一个命令来设置和创建一个<code class="du kr ks kt ku b">pre-commit</code>钩子。</p><p id="0ed0" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">但是第一步是初始化 git 存储库(如果还没有初始化的话)。执行<code class="du kr ks kt ku b">git init</code>并初始化 git 存储库。</p><p id="f5c2" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">下一步是安装哈士奇</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="36a8" class="li iw hi ku b fi lj lk l ll lm">npx husky-init &amp;&amp; npm install</span></pre><p id="43ff" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">上面的命令将安装 husky 作为一个开发依赖项，并创建一个<code class="du kr ks kt ku b">.husky</code>文件夹，并在<code class="du kr ks kt ku b">.husky/pre-commit</code>文件中设置一个演示<code class="du kr ks kt ku b">pre-commit</code>钩子。默认情况下，文件内容会有<code class="du kr ks kt ku b">npm test</code>命令，您可以根据需要进行更改。</p><p id="92b7" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">您可以通过类似于<code class="du kr ks kt ku b">npx eslint &amp;&amp; npm test</code>的方式来更改这个默认提交，它将首先 lint 整个代码库，然后运行测试(如果有的话)。</p><p id="8b43" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">要手动添加<code class="du kr ks kt ku b">husky</code>，请执行以下操作</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="77d4" class="li iw hi ku b fi lj lk l ll lm">npm install --save-dev husky</span><span id="a556" class="li iw hi ku b fi ln lk l ll lm">npx husky install</span></pre><p id="be91" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">要添加其他 git 挂钩，请使用</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="731d" class="li iw hi ku b fi lj lk l ll lm">npx husky add .husky/&lt;hook-name&gt; "your command"</span></pre><p id="db64" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">要在同一个挂钩中添加更多命令，请在新的一行开始添加命令</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="588b" class="li iw hi ku b fi lj lk l ll lm">// .husky/pre-commit</span><span id="ed7f" class="li iw hi ku b fi ln lk l ll lm">#!/usr/bin/env sh<br/>. "$(dirname -- "$0")/_/husky.sh</span><span id="1afb" class="li iw hi ku b fi ln lk l ll lm">npx eslint<br/>npm test</span></pre><p id="c912" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">如果出于某种原因，您想跳过 git-hooks 检查，那么在提交时添加<code class="du kr ks kt ku b">--no-verify</code>标志</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="3848" class="li iw hi ku b fi lj lk l ll lm">git commit --no-verify -m "WIP"</span></pre><h1 id="8cba" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">使用 lint-staged 搭配 Husky</h1><p id="0712" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">当林挺代码时，您只需要 lint 暂存区中将要提交的文件。</p><p id="16f2" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">但是，<code class="du kr ks kt ku b">eslint</code>或其他 linters 对代码库中的所有文件或满足特定 glob 模式(如<code class="du kr ks kt ku b">src/**/*.{js,ts}</code>)的文件运行林挺。这不利于时间效率。相反，只对暂存区中的文件运行林挺会更好。</p><p id="431a" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">有一个包可以解决这个问题。<code class="du kr ks kt ku b">lint-staged</code>可让您配置要为暂存文件运行的命令。</p><p id="f662" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">安装<code class="du kr ks kt ku b">lint-staged</code>作为开发依赖项</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="39c8" class="li iw hi ku b fi lj lk l ll lm">npm install --save-dev lint-staged</span></pre><p id="e323" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">将下面的配置添加到<code class="du kr ks kt ku b">package.json</code>，并在提交暂存的<code class="du kr ks kt ku b">js</code>或<code class="du kr ks kt ku b">ts</code>文件之前提供您想要运行的任何命令。</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="3034" class="li iw hi ku b fi lj lk l ll lm">"lint-staged": {<br/>  "*.{js,ts}": ["npx eslint --fix", "npm test"]<br/>}</span></pre><p id="794c" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">在<code class="du kr ks kt ku b">.husky/pre-commit</code>档中，将<code class="du kr ks kt ku b">npm test</code>替换为<code class="du kr ks kt ku b">npx lint-staged</code>。这将运行<code class="du kr ks kt ku b">lint-staged</code>，而<code class="du kr ks kt ku b">lint-staged</code>又将运行提供给<code class="du kr ks kt ku b">lint-staged</code>配置的命令，只在暂存文件上运行。</p><h1 id="602c" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">林挺用<code class="du kr ks kt ku b">Commitlint</code>提交消息</h1><p id="5a47" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们可以在 husky 中使用另一个流行的 git 挂钩<code class="du kr ks kt ku b">commit-msg</code>。我们将检查我们的提交是否写得很好并遵循了标准。</p><p id="0ae3" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">我们可以利用<code class="du kr ks kt ku b">commitlint</code>在提交之前验证我们的提交消息。</p><p id="60bc" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">安装<code class="du kr ks kt ku b">@commitlint/cli</code>和<code class="du kr ks kt ku b">@commitlint/config-conventional</code>(带有预定义提交规则的示例配置)。</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="4a42" class="li iw hi ku b fi lj lk l ll lm">npm install --save-dev @commitlint/cli @commitlint/config-conventional</span></pre><p id="d836" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">然后创建一个<code class="du kr ks kt ku b">commitlint.config.js</code>文件并扩展<code class="du kr ks kt ku b">config-conventional</code></p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="2ecb" class="li iw hi ku b fi lj lk l ll lm">// commitlint.config.js</span><span id="1f4b" class="li iw hi ku b fi ln lk l ll lm">module.exports = { extends: ["@commitlint/config-conventional"] };</span></pre><p id="38ca" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">默认情况下，这个设置不会做任何事情。在 husky 中添加一个<code class="du kr ks kt ku b">commit-msg</code>挂钩，以便在提交前自动运行。</p><pre class="la lb lc ld fd le ku lf lg aw lh bi"><span id="d358" class="li iw hi ku b fi lj lk l ll lm">npx husky add .husky/commit-msg "npx commitlint --edit"</span></pre><p id="2c01" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">如果消息无效，这会抛出错误，并且不允许提交(根据 commitlint 配置)。</p><p id="695c" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">如果您想了解更多关于<code class="du kr ks kt ku b">commitlint</code>的信息并想定制配置，请访问<a class="ae iu" href="https://commitlint.js.org/#/reference-configuration" rel="noopener ugc nofollow" target="_blank">https://commitlint.js.org/#/reference-configuration</a>。</p></div><div class="ab cl lo lp gp lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="hb hc hd he hf"><p id="f40d" class="pw-post-body-paragraph jt ju hi jv b jw kv jy jz ka kw kc kd ke kx kg kh ki ky kk kl km kz ko kp kq hb bi translated">这是所有的乡亲。如果这有帮助，请留下👏下一集再见。</p><h1 id="1678" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">有用的链接</h1><ul class=""><li id="ac67" class="lv lw hi jv b jw jx ka kb ke lx ki ly km lz kq ma mb mc md bi translated">【https://typicode.github.io/husky/#/】</li><li id="da52" class="lv lw hi jv b jw me ka mf ke mg ki mh km mi kq ma mb mc md bi translated"><a class="ae iu" href="https://www.npmjs.com/package/lint-staged" rel="noopener ugc nofollow" target="_blank">https://www.npmjs.com/package/lint-staged</a></li><li id="ecd7" class="lv lw hi jv b jw me ka mf ke mg ki mh km mi kq ma mb mc md bi translated"><a class="ae iu" href="https://commitlint.js.org/#/" rel="noopener ugc nofollow" target="_blank">https://commitlint.js.org/#/</a></li></ul></div></div>    
</body>
</html>