<html>
<head>
<title>Deploy Smart Contracts Using Hardhat</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Hardhat部署智能合同</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploy-smart-contracts-using-hardhat-3bf9e6e07d2a?source=collection_archive---------0-----------------------#2021-11-03">https://medium.com/nerd-for-tech/deploy-smart-contracts-using-hardhat-3bf9e6e07d2a?source=collection_archive---------0-----------------------#2021-11-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/80236192ec67403a4b6219c37e510dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0GJU3n2hcvyVtXB1SqqMQ.jpeg"/></div></div></figure><h1 id="03d0" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h1><p id="212a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">智能合约只是保存在区块链上的程序。满足预设条件时运行。它们通常用于自动履行协议。因此，所有参与者都可以直接确定结果，没有任何调解人的参与或时间损失。</p><p id="eb2c" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank"> Hardhat插件增强了将合同部署到任何网络的机制。它提供了一个编译、测试和部署Solidity智能合同的环境。在本帖中，我们将了解如何使用Hardhat部署智能合同。</a></p><h1 id="bac1" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">描述</h1><p id="be87" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Hardhat还改进了将姓名与地址相关联的机制。因此，测试和部署脚本可以通过仅仅移动名称指向的地址来重新配置，允许每个网络的不同配置。这也导致了更清晰的测试和部署脚本。</p><h1 id="ba2d" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">主要特征</h1><ul class=""><li id="b51b" class="ks kt hi jq b jr js jv jw jz ku kd kv kh kw kl kx ky kz la bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank"> Hardhats trust ethers.js，第二代以太坊JavaScript API库。</a></li><li id="e43b" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">它与TypeScript——第二代JavaScript——混合得很好。</li><li id="c3ad" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">用Solidity代码中的console.log功能带来了更好的调试能力。</li><li id="430f" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">通过网络确定性部署。</li><li id="b289" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">能够从配对网络访问部署。</li><li id="4a26" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">在松露的帮助下，从npm包装等外部来源引入产品。</li><li id="16d1" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">链配置导出。</li><li id="4041" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">列出已部署合同的地址及其ABI。</li><li id="c92c" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">部署时的库链接。</li></ul><h1 id="1bb7" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">设置</h1><p id="7b62" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">准备好项目并作为依赖项安装Hardhat。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="96e0" class="lp ir hi ll b fi lq lr l ls lt">$ npm init --yes</span><span id="e48e" class="lp ir hi ll b fi lu lr l ls lt">$ npm install --save-dev hardhat</span></pre><p id="0f1a" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">安装完成后，我们可能会运行npx hardhat。这将在项目目录中创建一个Hardhat配置文件(hardhat.config.js)。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="3366" class="lp ir hi ll b fi lq lr l ls lt">$ npx hardhat</span><span id="45c6" class="lp ir hi ll b fi lu lr l ls lt">888    888                      888 888               888</span><span id="f4b0" class="lp ir hi ll b fi lu lr l ls lt">888    888                      888 888               888</span><span id="2d99" class="lp ir hi ll b fi lu lr l ls lt">888    888                      888 888               888</span><span id="faf0" class="lp ir hi ll b fi lu lr l ls lt">8888888888  8888b.  888d888 .d88888 88888b.   8888b.  888888</span><span id="f942" class="lp ir hi ll b fi lu lr l ls lt">888    888     "88b 888P"  d88" 888 888 "88b     "88b 888</span><span id="b6d5" class="lp ir hi ll b fi lu lr l ls lt">888    888 .d888888 888    888  888 888  888 .d888888 888</span><span id="0273" class="lp ir hi ll b fi lu lr l ls lt">888    888 888  888 888    Y88b 888 888  888 888  888 Y88b.</span><span id="3060" class="lp ir hi ll b fi lu lr l ls lt">888    888 "Y888888 888     "Y88888 888  888 "Y888888  "Y888</span><span id="189a" class="lp ir hi ll b fi lu lr l ls lt">Welcome to Hardhat v2.2.1</span><span id="2b2b" class="lp ir hi ll b fi lu lr l ls lt">What do you want to do? · Create an empty hardhat.config.js</span><span id="fabe" class="lp ir hi ll b fi lu lr l ls lt">Config file created</span></pre><ul class=""><li id="5117" class="ks kt hi jq b jr kn jv ko jz lv kd lw kh lx kl kx ky kz la bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/2021/11/speech-recognition-transformation.html" rel="noopener ugc nofollow" target="_blank">实体源文件(。sol)存储在联系人目录中。这和我们可能从其他语言中熟悉的src目录是一样的。</a></li><li id="8c26" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">我们现在可以编写第一个简单的智能契约，命名为Box。</li><li id="a150" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">它将允许人们储存一个以后可以保存的价值。</li><li id="7cbb" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">我们将把这个文件保存为contracts/Box.sol。</li><li id="dc5a" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">每个。sol文件应该有单个合同的代码，并在它之后被调用。</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="b058" class="lp ir hi ll b fi lq lr l ls lt">/ contracts/Box.sol</span><span id="278e" class="lp ir hi ll b fi lu lr l ls lt">// SPDX-License-Identifier: MIT</span><span id="2d7c" class="lp ir hi ll b fi lu lr l ls lt">pragma solidity ^0.8.0;</span><span id="67c1" class="lp ir hi ll b fi lu lr l ls lt">contract Box {</span><span id="7823" class="lp ir hi ll b fi lu lr l ls lt">    uint256 private _value;</span><span id="9246" class="lp ir hi ll b fi lu lr l ls lt">    // Emitted when the stored value changes</span><span id="9a94" class="lp ir hi ll b fi lu lr l ls lt">    event ValueChanged(uint256 value);</span><span id="30eb" class="lp ir hi ll b fi lu lr l ls lt">    // Stores a new value in the contract</span><span id="94df" class="lp ir hi ll b fi lu lr l ls lt">    function store(uint256 value) public {</span><span id="ccf3" class="lp ir hi ll b fi lu lr l ls lt">        _value = value;</span><span id="e9a8" class="lp ir hi ll b fi lu lr l ls lt">        emit ValueChanged(value);</span><span id="b90d" class="lp ir hi ll b fi lu lr l ls lt">    }</span><span id="bc96" class="lp ir hi ll b fi lu lr l ls lt">    // Reads the last stored value</span><span id="5b9f" class="lp ir hi ll b fi lu lr l ls lt">    function retrieve() public view returns (uint256) {</span><span id="1344" class="lp ir hi ll b fi lu lr l ls lt">        return _value;</span><span id="a21c" class="lp ir hi ll b fi lu lr l ls lt">    }</span><span id="bc36" class="lp ir hi ll b fi lu lr l ls lt">}</span></pre><p id="29b6" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/2021/11/speech-recognition-transformation.html" rel="noopener ugc nofollow" target="_blank">我们现在将生成一个脚本来部署我们的箱式合同。我们将这个文件保存为脚本或deploy.js</a></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e7ff" class="lp ir hi ll b fi lq lr l ls lt">// scripts/deploy.js</span><span id="54c1" class="lp ir hi ll b fi lu lr l ls lt">async function main () {</span><span id="9ae0" class="lp ir hi ll b fi lu lr l ls lt">  // We receive the contract to deploy</span><span id="6a8f" class="lp ir hi ll b fi lu lr l ls lt">  const Box = await ethers.getContractFactory('Box');</span><span id="5365" class="lp ir hi ll b fi lu lr l ls lt">  console.log('Deploying Box...');</span><span id="7534" class="lp ir hi ll b fi lu lr l ls lt">  const box = await Box.deploy();</span><span id="8536" class="lp ir hi ll b fi lu lr l ls lt">  await box.deployed();</span><span id="05d0" class="lp ir hi ll b fi lu lr l ls lt">  console.log('Box deployed to:', box.address);</span><span id="61c9" class="lp ir hi ll b fi lu lr l ls lt">}</span><span id="bc64" class="lp ir hi ll b fi lu lr l ls lt">main()</span><span id="9ed8" class="lp ir hi ll b fi lu lr l ls lt">  .then(() =&gt; process.exit(0))</span><span id="c935" class="lp ir hi ll b fi lu lr l ls lt">  .catch(error =&gt; {</span><span id="4809" class="lp ir hi ll b fi lu lr l ls lt">    console.error(error);</span><span id="6240" class="lp ir hi ll b fi lu lr l ls lt">    process.exit(1);</span><span id="7ff0" class="lp ir hi ll b fi lu lr l ls lt">  });</span></pre><p id="6f1f" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">现在，使用下面的命令在脚本中安装ethers。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="7858" class="lp ir hi ll b fi lq lr l ls lt">$ npm install --save-dev @nomiclabs/hardhat-ethers ethers</span></pre><p id="2154" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">然后，我们需要添加配置。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="ea06" class="lp ir hi ll b fi lq lr l ls lt">/ hardhat.config.js</span><span id="7360" class="lp ir hi ll b fi lu lr l ls lt">require('@nomiclabs/hardhat-ethers');</span><span id="c457" class="lp ir hi ll b fi lu lr l ls lt">...</span><span id="f2d2" class="lp ir hi ll b fi lu lr l ls lt">module.exports = {</span><span id="4d3f" class="lp ir hi ll b fi lu lr l ls lt">...</span><span id="e381" class="lp ir hi ll b fi lu lr l ls lt">};</span></pre><p id="f850" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/" rel="noopener ugc nofollow" target="_blank">我们可以使用run命令将Box contract部署到本地网络(hard hat Network):</a></p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="3685" class="lp ir hi ll b fi lq lr l ls lt">$ npx hardhat run --network localhost scripts/deploy.js</span><span id="b3e7" class="lp ir hi ll b fi lu lr l ls lt">Deploying Box...</span><span id="35fa" class="lp ir hi ll b fi lu lr l ls lt">Box deployed to: 0x5FbDB2315678afecb367f032d93F642f64180aa3</span></pre><h1 id="e582" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">合同</h1><ul class=""><li id="108d" class="ks kt hi jq b jr js jv jw jz ku kd kv kh kw kl kx ky kz la bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/2021/11/cnn-image-classification.html" rel="noopener ugc nofollow" target="_blank">我们将从Open Zeppelin导入一个可靠性合同。</a></li><li id="1420" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">在新的文件夹契约下创建一个名为ERC20.sol的文件。</li><li id="ef13" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">ERC20契约将在部署时接受名称和符号参数。</li></ul><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="5208" class="lp ir hi ll b fi lq lr l ls lt">/SPDX-License-Identifier: Unlicense</span><span id="218e" class="lp ir hi ll b fi lu lr l ls lt">pragma solidity 0.8.3;</span><span id="247a" class="lp ir hi ll b fi lu lr l ls lt">import "@openzeppelin/contracts/token/ERC20/ERC20.sol";</span><span id="fe2c" class="lp ir hi ll b fi lu lr l ls lt">contract _ERC20 is ERC20 {</span><span id="173e" class="lp ir hi ll b fi lu lr l ls lt">    constructor (string memory _name, string memory _symbol) ERC20(_name, _symbol) {}</span><span id="58fb" class="lp ir hi ll b fi lu lr l ls lt">}</span></pre><h1 id="e226" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">脚本部署</h1><ul class=""><li id="4ae4" class="ks kt hi jq b jr js jv jw jz ku kd kv kh kw kl kx ky kz la bi translated">我们将控制hardhat-deploy插件来部署合同。</li><li id="a29d" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">除了一系列功能之外，它还允许我们执行和跟踪部署。</li><li id="5abe" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">第一个部署脚本位于deploy文件夹中，如下所示:</li></ul><p id="e6bd" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">deployer常量保持了namedAccounts特性的作用。它使我们能够根据地址在hardhat.config.js中给定网络的accounts数组中的索引，将自定义名称与地址关联起来</p><p id="c3bf" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">因此，在我们的示例中，将deployer设置为零允许我们使用const { deployer } = await getNamedAccounts()来访问私钥。</p><p id="98ac" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><a class="ae km" href="https://www.technologiesinindustry4.com/2021/11/speech-recognition-transformation.html" rel="noopener ugc nofollow" target="_blank">否则，参数必须按照智能合约所期望的顺序，并且标记可用于标识或分组合约以进行部署。</a></p><h1 id="1d25" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">部署</h1><p id="4791" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我们可以用下面的命令来编译我们的契约:</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="e5ec" class="lp ir hi ll b fi lq lr l ls lt">$ npx hardhat deploy --network kovan --tags ERC20</span></pre><p id="baad" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">更多详情请访问:<a class="ae km" href="https://www.technologiesinindustry4.com/2021/11/deploy-smart-contracts-using-hardhat.html" rel="noopener ugc nofollow" target="_blank">https://www . technologiesinindustry 4 . com/2021/11/deploy-smart-contracts-using-hard hat . html</a></p></div></div>    
</body>
</html>