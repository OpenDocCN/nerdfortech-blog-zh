<html>
<head>
<title>Antd File Upload with Nodejs &amp; Multer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Nodejs和Multer上传文件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/antd-file-upload-with-nodejs-multer-1621a0d4b607?source=collection_archive---------1-----------------------#2021-05-21">https://medium.com/nerd-for-tech/antd-file-upload-with-nodejs-multer-1621a0d4b607?source=collection_archive---------1-----------------------#2021-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2a7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我开始做一些项目。为了构建这个项目，我在前端使用React，在后端使用NodeJs。为了创建UI组件，我使用了<a class="ae jd" href="https://ant.design/" rel="noopener ugc nofollow" target="_blank">和</a>。每个组件都是开箱即用的，然后我遇到了某个组件的问题。在这篇文章中，我将分享我是如何解决文件上传问题的。</p><p id="f2f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我假设您熟悉Nodejs和Reactjs。我不会告诉它的基本知识。所以，如果你是新来的，我强烈建议你复习一下基础知识，然后再回到这里。</p><h1 id="d743" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">问题陈述/要求</h1><p id="2ad8" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">先说要求。项目需要频繁上传多个文件(比如15个文件)。期望是向后端发出一个请求，同时传输所有文件。但是antd上传组件不是这样工作的。你一选择文件，它就开始上传图片。现在，这对于任何公司都可能是一个问题，如果我们假设一家公司正在处理100万的用户群，如果不到一半的人上传错误的文件，这将增加公司的额外成本。</p><h1 id="f51e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">让我们先构建服务器</h1><p id="3c91" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">正如我之前提到的，对于后端，我们使用Nodejs。在上传文件的后端，我们使用了一个叫做<a class="ae jd" href="https://www.npmjs.com/package/multer" rel="noopener ugc nofollow" target="_blank"> Multer </a>的模块。这是一个易于使用和高度可配置的模块。这是我们后端代码的样子:</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/0a61acf157bdbca8b07ab0421097cd2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B_kA_XYhC3OCau7lmEZuPQ.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">后端代码</figcaption></figure><p id="2fa8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会很快给你一个代码的概述，它到底做什么。</p><p id="67ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前几行，我们正在导入模块。之后，我们正在初始化<code class="du kx ky kz la b">app</code>。然后我们定义一些配置，例如<code class="du kx ky kz la b">storage</code>、<code class="du kx ky kz la b">file type checks</code>等等。你可以在更多的官方文档中找到所有这些配置。</p><p id="62ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">配置后，我们正在定义一些路线。我们创建了两条路线。一个是返回Hello，World的<code class="du kx ky kz la b">GET</code>调用，另一个是简单返回success的<code class="du kx ky kz la b">POST</code>调用。在上传目录中保存文件将由multer模块自己处理，我们不需要做任何事情。</p><p id="0a0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这都是关于我们的服务器。</p><h1 id="18fb" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">让我们转到客户端——React应用程序</h1><p id="68a6" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">如果你不熟悉antd。建议你和antd玩一段时间。我相信你会喜欢它的，因为它会加快你的开发速度。</p><p id="f692" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们的前端react代码的样子，让我们试着部分地理解这段代码。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lb"><img src="../Images/5389e448fca563f989e2e7a33ad1e504.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpynELCjjR1M-z27ZCYASA.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">React Js代码</figcaption></figure><h1 id="253a" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">上传文件功能</h1><p id="5099" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">先说一下<code class="du kx ky kz la b">uploadFile</code>函数。这个函数负责用文件对象向服务器发送post请求。如果服务器返回成功，它将显示一条消息，否则它将在控制台中打印一条错误消息。这里需要注意的一个重要部分是我们如何在<code class="du kx ky kz la b"><a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">FormData</strong></a></code>接口的帮助下创建我们的数据有效载荷，它的内容类型是<code class="du kx ky kz la b">multipart/form-data</code></p><p id="0d33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">文件多了怎么办？</p><p id="f067" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我们只需在发出请求之前将这些文件添加到<code class="du kx ky kz la b">formdata</code>变量中。</p><h1 id="15fa" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">让我们讨论一下应用程序组件</h1><p id="1e2d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">您可能知道，JSX是JavaScript的语法扩展。JSX产生了起反应的“元素”。在<code class="du kx ky kz la b">App</code>函数中，我们正在创建一个有上传输入和提交按钮的表单。在这里，我们可以添加多个表单项来上传更多的文档。为了简化，我已经从上传元素中移除了所有其他属性，比如<code class="du kx ky kz la b">props, beforeChange, onChange</code>等。</p><p id="6ecd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当用户提交表单时。它将调用上传文件函数并返回响应。</p><p id="9466" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在这里看看我们的现场演示！</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lc"><img src="../Images/0461a83578f0f5ec59e778a6f8a0d249.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*94DTzC99aNCvUNJ-TfeRPw.gif"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">React应用</figcaption></figure><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">Nodejs后端</figcaption></figure><p id="e650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是如何在Antd上处理上传，并与作为后端的节点进行交互。您还可以使用React对远程服务器和数据存储解决方案的API进行同样的操作。</p><h1 id="43e6" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">仅此而已。</h1></div></div>    
</body>
</html>