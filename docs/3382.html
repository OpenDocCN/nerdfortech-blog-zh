<html>
<head>
<title>BEST PRACTICES FOR MICROSERVICES</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微服务的最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/best-practices-for-microservices-ac05938c2a7d?source=collection_archive---------2-----------------------#2021-06-08">https://medium.com/nerd-for-tech/best-practices-for-microservices-ac05938c2a7d?source=collection_archive---------2-----------------------#2021-06-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/83dda5d46860366352ef6fa12e57a548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BRrFCJz0xj5a0vRc.jpg"/></div></figure><p id="9bc8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">通过这篇文章，我们将讨论在实现微服务架构时应该遵循的最佳实践。我们将要讨论的主题如下。</p><ol class=""><li id="f38b" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">设计</li><li id="ef7e" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">硬编码值</li><li id="86bc" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">记录</li><li id="09ee" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">版本控制</li><li id="407c" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">授权和认证机制</li><li id="48df" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">属国</li><li id="3e57" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">签订可执行的合同</li><li id="4447" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">容错</li><li id="9150" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">证明文件</li></ol><h1 id="ab32" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.设计</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/1f19873626c673dfe74e7d722e1b6eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*iVJXVWXxa_pJrnk1QEtHag.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛:https://images.app.goo.gl/b35PjF4wqz9YYYMh7</figcaption></figure><p id="1366" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">●设计应该是领域驱动的(DDD)</p><h2 id="0e4e" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="b777" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">总是尽可能地尝试重新开始。你可能不需要从头开始写所有的东西。反思！！！如果你的服务中有与你的服务不相关的东西，把它去掉。在这种情况下，我们不需要重新设计或重写一切，但我们可以做一些小的调整，隔离并使服务独立于您的领域。</em> </strong></p></blockquote><p id="4da0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">举例:</strong>让我们以一个租车应用为例。</p><p id="e7b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">客户可以代表两种不同的服务，但在两个不同的方面。客户注册/帐户管理服务可以包含创建部分。当您实现支持服务或其他服务时，同一个客户可以在该模块中以不同方式表示。该服务的主要范围是客户支持。在另一种服务中，主要目的是金融/账户/支付等。</p><p id="cc64" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">●所以，当你设计一个服务，当你考虑迁移到微服务时，你需要确保你有一个全新的领域驱动的设计。</p><p id="bb91" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">●重写一个系统，要看一个公司能承受多少。</p><p id="f7fb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设您有一个相同的租车web应用程序，您有以下模块；</p><p id="fcb7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣库存模块</p><p id="8bd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣利益相关方模块</p><p id="170d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣搜索模块</p><p id="aa29" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣租赁模块</p><p id="b7e9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣财务模块</p><p id="70c2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">●把模块放在一起，创建一两个服务，说“我们用微服务！”是错误的做法。</p><h1 id="577c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.硬编码值</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/e18ccb526c5999402e3526ae244d2275.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*Wc8-Fgz2hY5nChEC"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参考:https://images.app.goo.gl/gMvbHUkEWT7zdVqb6<a class="ae lf" href="https://images.app.goo.gl/gMvbHUkEWT7zdVqb6" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><h2 id="1356" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="48c3" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated">你不应该硬编码国外服务的地址。您应该使用服务发现工具来完成这项工作。T13】</p></blockquote><p id="50a5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设您的一个服务正在调用另一个服务。</p><p id="7c7e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">示例:</strong>在向客户租赁车辆之前，您可以调用另一项服务来获取客户历史记录。让我们将2个服务命名为服务A和服务B。假设服务A调用服务B。为了做到这一点，您必须拥有服务B的地址。在这种情况下，大多数开发人员将主机名/URL/IP地址硬编码在服务A上。现在服务A知道服务B在哪里。</p><p id="48d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">问题➜ </strong>如果您的网络团队决定更改主机名/网络地址，您将需要更改代码并发送另一个部署。这是不正确的。</p><p id="2f9b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">如何克服</strong> ➜ <strong class="io hj"/></p><p id="5e65" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">服务发现机制是如何工作的？</strong></p><p id="856b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设服务A要去服务B，同时服务C也需要服务B。现在，服务A看到服务B离线。并且发现工具可以拥有表示服务B离线的一些标志。因此，服务C能够在调用它之前看到服务B离线。</p><p id="79d2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹你可以使用任何服务发现机制，不管它是不是代理。但是，如果您没有正确使用代理，它也会继承其他服务的问题。</p><h1 id="4b5c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.记录</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/9b19f0cc5fdc228c6fcd04915621c86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oM7jA13qalv6YMYf.jpg"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参考号:<a class="ae lf" href="https://images.app.goo.gl/HS7Cz2XoWmTkqXSK7" rel="noopener ugc nofollow" target="_blank">https://images.app.goo.gl/HS7Cz2XoWmTkqXSK7</a></figcaption></figure><h2 id="1cee" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">做法:</h2><blockquote class="lu lv lw"><p id="2711" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">失败快，日志晚！如果失败了，马上回来。但是不要记录。</em>T11】</strong></p><p id="7a89" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">不要做太多的日志记录，因为调试会很困难。</em>T15】</strong></p><p id="8cbd" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">不从各处记录。仅从您启动流程的位置记录日志。但是，您必须记录堆栈跟踪或一些信息，以了解这究竟发生在哪里。这样，当某个特定的错误实际上发生在存储库层时，您就不会被误导说它发生在服务层。</em>T19】</strong></p><p id="4f72" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated">对于一个特定的错误，你只需要记录一次，并确保在整个过程中没有丢失任何信息，以了解发生了什么。 </p><p id="ae12" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">无论何时点击初始服务，都可以生成并调用唯一的关联ID。在您访问服务层之前，您的web服务器也可以在某处生成一个关联ID。</em> </strong></p></blockquote><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mh"><img src="../Images/45977ed7334aedf66f9fd0ee970fe461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AUcNbwYkEP7GKlSYuvdwcg.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">ref:<a class="ae lf" href="https://www.c-sharpcorner.com/article/logging-and-tracing-in-multiple-microservice-with-correlation-using-net-core/" rel="noopener ugc nofollow" target="_blank">https://www . c-sharp corner . com/article/logging-and-tracing-in-multiple-microservice-with-correlation-using-net-core/</a></figcaption></figure><p id="7d31" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹您可以使用日志附加器(日志拦截器)将日志消息发送到某个目的地或介质，并将关联ID或您生成的任何ID与日志语句一起写入文件。日志将包括日期、时间、日志级别、ID和日志语句。</p><p id="b541" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">日志管理框架示例:</p><p id="8d82" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">📋Log4j</p><p id="bf5e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">📋Logstash</p><p id="77d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">📋Splunk</p><p id="fe90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">📋弹性的</p><p id="b62f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹日志对于解决任何应用程序问题都非常重要，必须正确维护。日志可以作为文本文件或控制台或云写入。</p><p id="ddd8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹:如果日志管理得当，随时跟踪您的服务电话都很容易。您可以通过日志搜索服务，并可以找到以下信息:</p><p id="4e66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它的发源地➣</p><p id="6f40" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣目的地是哪里</p><p id="f948" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣从起点到终点之间的路径</p><p id="8c41" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">例外发生的➣</p><p id="1abc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣它从哪里回来</p><p id="5105" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹确保你有某种日志聚合机制来搜索日志。</p><h1 id="1ace" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">4.版本控制</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/d8033bf5c97f5e6cbfd67b009be34312.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/0*3Z2HCl-O3LEWVWU6"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛:https://images.app.goo.gl/CwHoG4P6ADyMCHwd7</figcaption></figure><h2 id="424d" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="9b38" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">使用版本控制进行重大变更</em> </strong></p></blockquote><p id="eac3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">版本控制中基本上有两种最流行的技术，即:</p><ol class=""><li id="4575" class="jk jl hi io b ip iq it iu ix jm jb jn jf jo jj jp jq jr js bi translated">语义版本控制</li><li id="b286" class="jk jl hi io b ip jt it ju ix jv jb jw jf jx jj jp jq jr js bi translated">日历版本控制</li></ol><h2 id="779b" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">语义版本控制</h2><p id="7616" class="pw-post-body-paragraph im in hi io b ip mi ir is it mj iv iw ix mk iz ja jb ml jd je jf mm jh ji jj hb bi translated">语义版本控制是一种很好的版本编号管理机制，它指定了哪个数字应该增加；</p><p id="6cd9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣是一个Bugfix。</p><p id="18a6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣新功能或功能变化。(但是如果它是向后兼容的，要改变哪个数字)</p><p id="d995" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">➣破坏了任何现有的功能。</p><p id="fd1a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">它可以被认为是使用三部分版本号定义兼容性的正式约定。</p><p id="fd06" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">格式:&lt;专业&gt;。&lt;小调&gt;。&lt;补丁&gt;补丁</strong></p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mn"><img src="../Images/42e4d83d94eb589ac7e648b7b2b9c2e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zAcfB6tfDkqYV0gl.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参考:https://images.app.goo.gl/tofmZzMV8gwQnFPZA<a class="ae lf" href="https://images.app.goo.gl/tofmZzMV8gwQnFPZA" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="1cf6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> Major: </strong>每当您的服务与以前的服务/版本不兼容时，您就会增加。(这是因为它的功能发生了变化)</p><p id="ae3d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj"> Minor: </strong>当你有了新的功能，你就增加了，但是以前的功能也保持不变。如果用户愿意，用户可以更新。否则，用户可以使用以前的版本。</p><p id="f7b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">补丁:</strong>你可以按照自己想要的方式递增。它并没有反映出一件多么严重的事情。</p><h2 id="9803" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">日历版本控制</h2><p id="f573" class="pw-post-body-paragraph im in hi io b ip mi ir is it mj iv iw ix mk iz ja jb ml jd je jf mm jh ji jj hb bi translated">日历版本是基于发布日期而不是任意数字的约定。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mo"><img src="../Images/96e53609389e3be549fc926016a55228.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WQA8nH1xTHIblCSe.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛作品:<a class="ae lf" href="https://images.app.goo.gl/WZJW73xpTLPxs3r3A" rel="noopener ugc nofollow" target="_blank">https://images.app.goo.gl/WZJW73xpTLPxs3r3A</a></figcaption></figure><p id="d812" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><em class="lx">年份</em>和<em class="lx">版本</em>编号一起反映了一个构建包含的特性。</p><p id="209e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可执行文件和容器映像将标有内部版本号和状态标签，以及年份和版本号。</p><p id="0286" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">内部版本号将会改变，以确定在一个版本中添加的错误修复或外观改进。</p><p id="0771" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">除了上面提到的技术，还有一个概念叫做“<strong class="io hj">强制升级。</strong>”</p><p id="f5ab" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们用一个例子来理解这个概念。</p><p id="5354" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设您有一个名为服务A的服务，这个服务A调用服务B，您需要更新服务B，在更新过程中，您将更改数据库结构。因此，服务请求会有所不同。当你推送新版本的服务B时，你的服务A就会中断。因此，您可以增加主版本号，并将其作为单独的版本进行部署。</p><p id="454f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，您有了两个版本的服务服务b。但是，您的流量仍然采用服务b的前一版本。因此，您可以与客户沟通，告知其功能已发生变化，并要求客户在某个日期之前升级到新版本，因为现有服务器将在该日期后退役。一旦所有客户都迁移到新版本，您就可以关闭并停用以前的版本。</p><p id="1715" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹:你也可以使用弹性装置。让我们用一个例子来看看它是如何工作的。</p><p id="5c90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">假设您有5个消费者，并且运行10个先前版本的实例。当消费者转向新版本时，您可以增加新版本的实例，同时减少旧版本的实例。通过这种方式，您可以管理您的服务，而不会破坏任何消费者。</p><h1 id="3da8" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">5.认证和授权</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mp"><img src="../Images/5dd7f5299090bba18862888ceb77f4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*dyM5SrmzNqjZEaCP.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛:https://images.app.goo.gl/VPepFTfXh3J1fNgf9<a class="ae lf" href="https://images.app.goo.gl/VPepFTfXh3J1fNgf9" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="c9b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">如果每个服务都试图验证用户，这将增加往返行程的延迟。</p><p id="1d47" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">例如:</strong>当用户试图在租车应用程序中为客户分配车辆时，它调用3个不同的服务。假设您使用OAuth令牌来验证消费者，并且验证一个OAuth令牌需要20毫秒。当这个请求到来时，如果它通过3个不同的服务试图分别验证OAuth令牌，那么它会带来麻烦，因为您要在往返过程中增加60毫秒。</p><h2 id="017c" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="e77a" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">拥有独立的身份验证服务，并将到达您的服务层的任何请求定向到该身份服务。如果成功，您可以指向路径的其余部分。我们称之为“强制转发”。您将强制转发到特定的服务，这样可以避免一些延迟。</em>T9】</strong></p></blockquote><p id="e1c0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹:您可以根据您的算法或服务讨论在任何给定的时间更改此身份验证和授权过程。</p><h1 id="bdc5" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">6.属国</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/fe5705de904716e03cc5f093433ef792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*lFDei-cXd0_pXYwduxQT3g.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">ref:<a class="ae lf" href="https://www.aternity.com/blogs/monitoring-a-microservices-based-application/" rel="noopener ugc nofollow" target="_blank">https://www . a ternity . com/blogs/monitoring-a-micro services-based-application/</a></figcaption></figure><h2 id="947e" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="7dc7" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">您应该避免对服务的任何依赖，服务应该独立部署。</em>T15】</strong></p></blockquote><p id="6a45" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">举例:</strong>我们假设你有服务A、B、C，当你想部署A，同时部署其他B、C服务失败时，就会出现问题。</p><p id="66bb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹因此，独立是必须的。我们应该能够分别部署服务A、B或C，而不用担心破坏其他服务。</p><h1 id="1b30" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">7.签订可执行的合同</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/4df08df05116e0c68fd2507a02380d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1268/format:webp/0*S7PuMFCAxxBi87zk.jpeg"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛:https://images.app.goo.gl/dGF7cdqc8YLUQ4t48</figcaption></figure><p id="89e5" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">让我们看一个普通的应用程序。有UI/UX机制来确保用户喜欢某个网站/应用程序。你的服务也有我们称为消费者的用户。开发人员有责任让服务变得简单，让消费者满意。在您的A、B和C服务结构中，如果您在部署其中一个服务时破坏了一些消费者，那么您就做得不好。</p><h2 id="40d9" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="e646" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">你和你的消费者可以有一个契约(可能是一个API规范)，并且不惜任何代价确保契约不被破坏。为了确保这一点，您可以将此契约转换为可执行文件。可以准备一些测试用例/测试脚本/请求。每当您构建一个特定的服务时，这些测试都会自动执行。</em> </strong></p></blockquote><p id="cb7f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹持续集成工具将执行这些测试。如果所有这些测试都成功通过，您可以确保没有破坏它们。如果测试失败了，你可以100%确定当你把这些产品推向生产时，你正在破坏你的消费者。但你能这么快修好。</p><p id="1b34" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">持续集成工具的示例:</p><p id="eaf9" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔧詹金斯</p><p id="7c74" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔧好朋友</p><p id="d937" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔧特拉维斯</p><p id="7146" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔧GitLab CI</p><p id="bb28" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔧代码船</p><h1 id="1cb1" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">8.容错</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ms"><img src="../Images/db62bb80e5c288c0438d35623b5e8891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2uoZvlMuJE8pWu4l.jpg"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参考号:<a class="ae lf" href="https://images.app.goo.gl/1ibtRFDxpyiDUUhw7" rel="noopener ugc nofollow" target="_blank">https://images.app.goo.gl/1ibtRFDxpyiDUUhw7</a></figcaption></figure><p id="1dc3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">维基百科定义:</p><p id="b1e0" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">"<strong class="io hj">容错</strong>是一种属性，它使系统在其某些组件出现故障(或其中的一个或多个故障)时能够继续正常运行"</p><p id="0d92" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹:因为在处理微服务时有多个服务，所以出现故障的可能性也很大。你需要恰当地管理它们。</p><p id="bcae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现实生活中有几种模式可以实现容错。它们包括:</p><p id="22ae" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔖超时设定</p><p id="5b8a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔖断路器</p><p id="051e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔖最后期限</p><p id="a435" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">🔖重试次数</p><p id="a788" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">等等。</p><h2 id="f032" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="143c" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">你需要有强大的容错机制。如果一个服务超时、失败缓慢或需要很长时间来响应，那么您需要确保快速失败，这样您就不会在等待服务响应时在后面创建一个队列。</em>T13】</strong></p></blockquote><h1 id="6f87" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">9.证明文件</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mt"><img src="../Images/077059f8b3256fb319ee2e74a895c986.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/0*Uj2ucj3oaLDTqenH"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参赛:https://images.app.goo.gl/hCJUFtj7UNvChpwG9</figcaption></figure><h2 id="2662" class="lg jz hi bd ka lh li lj ke lk ll lm ki ix ln lo km jb lp lq kq jf lr ls ku lt bi translated">练习:</h2><blockquote class="lu lv lw"><p id="b88e" class="im in lx io b ip iq ir is it iu iv iw ly iy iz ja lz jc jd je ma jg jh ji jj hb bi translated">无论你做什么，你都需要记录下来，因为另一个人应该能够理解你写的东西。T19】</p></blockquote><p id="3856" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹你可以使用Swagger，它是一种接口描述语言，以一种技术的方式来编写文档。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mu"><img src="../Images/1f26e9ca82a3140c7f2100e4d3128773.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/0*1g2qZiqzMgvfmJn1"/></div><figcaption class="lb lc et er es ld le bd b be z dx translated">参考:https://images.app.goo.gl/w9HoJ7fp7NE3eeWU7</figcaption></figure><p id="e81a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹·斯瓦格会把你在斯瓦格控制台上写的任何技术术语转换成非常漂亮和有吸引力的文档。</p><p id="b439" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">✹不仅有文档，它还为用户提供了一个用户界面，以便消费者可以参考并尝试一些服务。</p><h1 id="a792" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">参考</h1><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="mv mw l"/></div></figure><div class="mx my ez fb mz na"><a href="https://www.capitalone.com/tech/software-engineering/10-microservices-best-practices/" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">最佳架构设计的10项微服务最佳实践| Capital One</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">1.单一责任原则就像代码一样，一个类应该只有一个改变的理由…</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">www.capitalone.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no ik na"/></div></div></a></div></div></div>    
</body>
</html>