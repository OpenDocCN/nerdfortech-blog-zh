<html>
<head>
<title>Analyze sentiments using Twitter Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Twitter数据分析情绪</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/analyze-sentiments-using-twitter-data-fe0f94dc2b61?source=collection_archive---------4-----------------------#2022-03-12">https://medium.com/nerd-for-tech/analyze-sentiments-using-twitter-data-fe0f94dc2b61?source=collection_archive---------4-----------------------#2022-03-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7179" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">利用Twitter数据构建自己的情绪分析工具指南。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2bc07a37591558660fefcd80751c7ca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2rQQAd4KAuS1hD-ZcoGYg.jpeg"/></div></div></figure><p id="590b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">众所周知，通过分析Twitter数据来衡量人们对某个话题的看法不再乏味，这些数据包括人们在社交媒体平台上分享的趋势和历史推文。情感分析目前最流行的用例为<a class="ae jp" href="https://www.ibm.com/cloud/learn/natural-language-processing" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="jq"/></strong></a>。</p><p id="331e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文的目的是分享一个全面的指南，它将帮助您通过利用Twitter API通过<a class="ae jp" href="https://www.tweepy.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="jq"> Tweepy </em> </strong> </a>构建自己的情感分析工具，Tweepy恰好是一个用户友好的Python库，它将帮助我们访问Twitter API和tweet数据。我们所需要的只是一个Twitter开发者账户和一些样本代码来进行分析</p><p id="f415" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将利用Twitter推特数据来衡量人们对疫情期间发生的新冠肺炎相关封锁趋势的想法和意见。</p></div><div class="ab cl jr js gp jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="hb hc hd he hf"><p id="363e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将按照下面指定的步骤来构建我们的情感分析工具—</p><h2 id="a1d3" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">安装并导入相关的库—</h2><p id="3a0d" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在我们开始之前，我们需要使用<strong class="ih hj"> <em class="jq">安装<a class="ae jp" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> textblob </strong> </a>和<a class="ae jp" href="https://docs.tweepy.org/en/stable/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> tweepy </strong> </a>库！pip安装</em>命令。请注意，本教程需要在Jupyter上设置和运行一个开发环境。如果您没有Jupyter环境设置，请在运行以下命令之前，遵循此处提到的<a class="ae jp" href="https://jupyter.org/install" rel="noopener ugc nofollow" target="_blank">安装和设置说明</a></strong></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="d186" class="jy jz hi kz b fi ld le l lf lg">!pip install textblob<br/>!pip install tweepy</span></pre><p id="c4cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还需要在我们的情感分析项目中导入以下库—</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="660a" class="jy jz hi kz b fi ld le l lf lg">from textblob import TextBlob<br/>import sys<br/>import tweepy<br/>import matplotlib.pyplot as plt<br/>import pandas as pd<br/>import numpy as np<br/>import os<br/>import nltk<br/>import pycountry<br/>import re<br/>import stringfrom wordcloud import WordCloud, STOPWORDS<br/>from PIL import Image<br/>from nltk.sentiment.vader import SentimentIntensityAnalyzer<br/>from langdetect import detect<br/>from nltk.stem import SnowballStemmer<br/>from nltk.sentiment.vader import SentimentIntensityAnalyzer<br/>from sklearn.feature_extraction.text import CountVectorizer</span></pre><p id="1de2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Tweepy同时支持<a class="ae jp" href="https://oauth.net/core/1.0a/" rel="noopener ugc nofollow" target="_blank"> OAuth 1.0a </a>(应用程序用户)和OAuth 2.0(仅应用程序)认证类型。身份验证由Tweepy库AuthHandler类处理。</p><p id="0068" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">OAuth 2.0是一个行业标准的授权协议。OAuth 2.0关注客户端开发人员的简单性，同时为web应用程序、桌面应用程序、移动电话和客厅设备提供特定的授权流。简单地说，这种身份验证方法是应用程序在没有用户上下文的情况下发出API请求。当我们需要对公共信息进行只读访问时，我们使用这种方法。</p><p id="464c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将首先注册我们的客户端应用程序，并获取一个消费者API密钥和一个秘密令牌。接下来，我们将创建一个AppAuthHandler实例，传入我们的消费者API密钥和秘密令牌。对于认证方面，我们需要有一个<strong class="ih hj"> Twitter开发人员帐户</strong>设置。如果您没有现有帐户，请在此处创建一个<a class="ae jp" href="https://developer.twitter.com/en" rel="noopener ugc nofollow" target="_blank"/>。这个过程通常需要一两天，但有时可能会更长，这取决于Twitter审查你的申请的时间。</p><h2 id="05b0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">为Twitter API设置认证—</h2><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="fd11" class="jy jz hi kz b fi ld le l lf lg">consumerKey = “Type your consumer key here”<br/>consumerSecret = “Type your consumer secret here”<br/>accessToken = “Type your accedd token here”<br/>accessTokenSecret = “Type your access token secret here”auth = tweepy.OAuthHandler(consumerKey, consumerSecret)<br/>auth.set_access_token(accessToken, accessTokenSecret)<br/>api = tweepy.API(auth)</span></pre><p id="407a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们的认证设置好之后，我们需要使用Tweepy来提取文本，并使用Textblob来计算文本中的<strong class="ih hj">正</strong>、<strong class="ih hj">负</strong>、<strong class="ih hj">中性</strong>、<strong class="ih hj">极性、</strong>和<strong class="ih hj">复合</strong>参数。</p><h2 id="3490" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">使用关键词/标签获取推文—</h2><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="15b1" class="jy jz hi kz b fi ld le l lf lg">def percentage(part,whole):</span><span id="419f" class="jy jz hi kz b fi lh le l lf lg">return 100 * float(part)/float(whole)keyword = input(“Please enter keyword or hashtag to search: “)<br/>noOfTweet = int(input (“Please enter how many tweets to analyze: “))<br/>tweets = tweepy.Cursor(api.search, q=keyword).items(noOfTweet)<br/>positive = 0<br/>negative = 0<br/>neutral = 0<br/>polarity = 0<br/>tweet_list = []<br/>neutral_list = []<br/>negative_list = []<br/>positive_list = []for tweet in tweets:<br/> <br/>#print(tweet.text)</span><span id="2e3d" class="jy jz hi kz b fi lh le l lf lg">tweet_list.append(tweet.text)<br/>analysis = TextBlob(tweet.text)<br/>score = SentimentIntensityAnalyzer().polarity_scores(tweet.text)<br/>neg = score[‘neg’]<br/>neu = score[‘neu’]<br/>pos = score[‘pos’]<br/>comp = score[‘compound’]<br/>polarity += analysis.sentiment.polarity<br/> <br/>if neg &gt; pos:<br/> negative_list.append(tweet.text)<br/> negative += 1elif pos &gt; neg:<br/> positive_list.append(tweet.text)<br/> positive += 1<br/> <br/>elif pos == neg:<br/> neutral_list.append(tweet.text)<br/> neutral += 1positive = percentage(positive, noOfTweet)<br/> negative = percentage(negative, noOfTweet)<br/> neutral = percentage(neutral, noOfTweet)<br/> polarity = percentage(polarity, noOfTweet)<br/> positive = format(positive, ‘.1f’)<br/> negative = format(negative, ‘.1f’)<br/> neutral = format(neutral, ‘.1f’)</span></pre><p id="3046" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这篇文章中的场景是这样的，用户应该键入一个关键字或标签(<strong class="ih hj"> lockdown2 london </strong>)并键入他们想要获得和分析多少条推文(<strong class="ih hj"> 2500 </strong>)。</p><p id="4563" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为有限制，tweets参数的数量很重要。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/2ceaac415e2f87430a94edeea69aab2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q85WMHV_3iW2psKlpyP7gw.png"/></div></div></figure><p id="8786" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在收到2500条关于“<strong class="ih hj">伦敦</strong>封锁”的推文后，让我们看看有多少条推文表达了这种情绪。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="da3f" class="jy jz hi kz b fi ld le l lf lg">(Total, Positive, Negative, Neutral)tweet_list = pd.DataFrame(tweet_list)<br/>neutral_list = pd.DataFrame(neutral_list)<br/>negative_list = pd.DataFrame(negative_list)<br/>positive_list = pd.DataFrame(positive_list)<br/>print(“total number: “,len(tweet_list))<br/>print(“positive number: “,len(positive_list))<br/>print(“negative number: “, len(negative_list))<br/>print(“neutral number: “,len(neutral_list))</span></pre><p id="bba3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于本教程，我们将获取2500条推文，分类如下-</p><ul class=""><li id="4329" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lo lp lq lr bi translated"><strong class="ih hj"> 1025条(41.0%) </strong>条推文包含正面情绪</li><li id="134d" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">580条推文(23.2%) 包含负面情绪</li><li id="5d38" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">895条(35.8%) 的推文包含中性情绪</li></ul><p id="1520" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们用上面的数据画一个饼状图</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="438a" class="jy jz hi kz b fi ld le l lf lg">PieChartlabels = [‘Positive [‘+str(positive)+’%]’ , ‘Neutral [‘+str(neutral)+’%]’,’Negative [‘+str(negative)+’%]’]</span><span id="3472" class="jy jz hi kz b fi lh le l lf lg">sizes = [positive, neutral, negative]</span><span id="e056" class="jy jz hi kz b fi lh le l lf lg">colors = [‘yellowgreen’, ‘blue’,’red’]</span><span id="e9ee" class="jy jz hi kz b fi lh le l lf lg">patches, texts = plt.pie(sizes,colors=colors, startangle=90)</span><span id="d685" class="jy jz hi kz b fi lh le l lf lg">plt.style.use(‘default’)<br/>plt.legend(labels)<br/>plt.title(“Sentiment Analysis Result for keyword= “+keyword+”” )<br/>plt.axis(‘equal’)<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lx"><img src="../Images/8bac2121b03ed9fe15dcfddf9e8c58f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aCTJLXXwAdwuEn0EMtF-Ag.png"/></div></div></figure><p id="023a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看下面的推文列表-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="7934" class="jy jz hi kz b fi ld le l lf lg">tweet_list</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/f5e8c5b12b685f2d8d7661ba00e98855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1kZMCCY8-wlZI8LiMplOVQ.png"/></div></div></figure><h2 id="c287" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">清理推文以准确分析情绪-</h2><p id="0e7a" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">当你看一下推文列表时，你会注意到有一些重复的推文。我们需要使用<strong class="ih hj"> drop_duplicates </strong>函数来消除这些重复记录。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="d547" class="jy jz hi kz b fi ld le l lf lg">tweet_list.drop_duplicates(inplace = True)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/2cf21bf6bd29d625d8a952afa3d4f377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sQFhc5kggiOql43u9YykUQ.png"/></div></div></figure><p id="0043" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的新数据集有<strong class="ih hj"> 1281 </strong>条独特的推文。</p><p id="cd38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们将创建一个新的数据框(名为— tw_list)和一个新的要素(text ),然后通过我们的lambda函数来清理文本，该函数将清理RT、链接、标点符号、特殊字符等，最后将所有内容转换为小写。因此，我们现在将通过移除RT、标点符号等来清理文本，然后使用以下命令创建一个具有全新功能集的新数据框-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="0c8b" class="jy jz hi kz b fi ld le l lf lg">tw_list = pd.DataFrame(tweet_list)<br/>tw_list[“text”] = tw_list[0]#Removing RT, Punctuation etc<br/>remove_rt = lambda x: re.sub(‘RT @\w+: ‘,” “,x)<br/>rt = lambda x: re.sub(“(@[A-Za-z0–9]+)|([⁰-9A-Za-z \t])|(\w+:\/\/\S+)”,” “,x)<br/>tw_list[“text”] = tw_list.text.map(remove_rt).map(rt)<br/>tw_list[“text”] = tw_list.text.str.lower()<br/>tw_list.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/1f11c9aec59bab227e82b4d24197a914.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XKU6QSEn4IKrDMNGBjFrDw.png"/></div></div></figure><h2 id="27d8" class="jy jz hi bd ka kb kc kd ke kf kg kh ki iq kj kk kl iu km kn ko iy kp kq kr ks bi translated">分析情绪-</h2><p id="68c8" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">现在，我们可以使用清理后的文本再次计算极性、主观性、情绪、负面、正面、中性和复合参数。为了计算所有这些参数，我们将为我们的数据框创建如下新特征-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="dfcb" class="jy jz hi kz b fi ld le l lf lg">valuestw_list[[‘polarity’, ‘subjectivity’]] = tw_list[‘text’].apply(lambda Text: pd.Series(TextBlob(Text).sentiment))</span><span id="508b" class="jy jz hi kz b fi lh le l lf lg">for index, row in tw_list[‘text’].iteritems():<br/>  score = SentimentIntensityAnalyzer().polarity_scores(row)<br/>  neg = score[‘neg’]<br/>  neu = score[‘neu’]<br/>  pos = score[‘pos’]<br/>  comp = score[‘compound’]<br/>   if neg &gt; pos:<br/>      tw_list.loc[index, ‘sentiment’] = “negative”<br/>   elif pos &gt; neg:<br/>      tw_list.loc[index, ‘sentiment’] = “positive”<br/>   else:<br/>      tw_list.loc[index, ‘sentiment’] = “neutral”</span><span id="7a3c" class="jy jz hi kz b fi lh le l lf lg"> tw_list.loc[index, ‘neg’] = neg<br/> tw_list.loc[index, ‘neu’] = neu<br/> tw_list.loc[index, ‘pos’] = pos<br/> tw_list.loc[index, ‘compound’] = comptw_list.head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/496111e6c10734f672b189278c6dfc18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dihRVo5Li_9Fxd_r-vyeGQ.png"/></div></div></figure><p id="8919" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以根据情感将我们的数据框架分成3组。在这种情况下，我们将创建3个新数据帧(即tw_list _ negative、tw_list_positive和tw_list_neutral ),并从原始tw _ list数据帧导入。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e45f" class="jy jz hi kz b fi ld le l lf lg">tw_list_negative = tw_list[tw_list[“sentiment”]==”negative”]<br/>tw_list_positive = tw_list[tw_list[“sentiment”]==”positive”]<br/>tw_list_neutral = tw_list[tw_list[“sentiment”]==”neutral”]</span></pre><p id="4103" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们统计情感特征的值，并检查总百分比。</p><p id="76a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实现<strong class="ih hj"><em class="jq">count _ values _ in _ single _ columns</em></strong>功能-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="29bf" class="jy jz hi kz b fi ld le l lf lg">def count_values_in_column(data,feature):<br/> total=data.loc[:,feature].value_counts(dropna=False)<br/> <br/>percentage = round(data.loc[:,feature].value_counts(dropna=False,normalize=True)*100,2)<br/>return pd.concat([total,percentage],axis=1,keys=[‘Total’,’Percentage’])</span><span id="a5d1" class="jy jz hi kz b fi lh le l lf lg">count_values_in_column(tw_list,”sentiment”)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/6e4ab8ab7bd99a5995a2bb9582be5d13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IevTMD1kWhl70mOo6RgXEA.png"/></div></div></figure><p id="6e63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们也可以通过利用情感推文的数量来创建一个图表，如下所示</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="efbb" class="jy jz hi kz b fi ld le l lf lg"># data for piechart</span><span id="3e64" class="jy jz hi kz b fi lh le l lf lg">piechart = count_values_in_column(tw_list,”sentiment”)<br/>names= pc.index<br/>size=pc[“Percentage”]<br/> <br/># draw a circle for plot centre</span><span id="0b07" class="jy jz hi kz b fi lh le l lf lg">my_circle=plt.Circle( (0,0), 0.7, color=’white’)<br/>plt.pie(size, labels=names, colors=[‘green’,’blue’,’red’])<br/>p=plt.gcf()<br/>p.gca().add_artist(my_circle)<br/>plt.show()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/73b86769cc10dd4d37faae67eafcc209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_s98De_UOBGnQULVrNDbA.png"/></div></div></figure><p id="e5c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将使用这1281条推文创建一个词云。这将有助于我们回顾这些推文中使用频率最高的词。为了创建词云，我们将首先定义一个如下所述的函数，然后我们可以对所有推文，正面推文，负面推文等再次使用这个词云绘图实现。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="1baa" class="jy jz hi kz b fi ld le l lf lg">create_wordcloud(text):<br/>  mask = np.array(Image.open(“cloud.png”))<br/>  stopwords = set(STOPWORDS)<br/>  wc = WordCloud(background_color=”white”,<br/>  mask = mask,<br/>  max_words=3000,<br/>  stopwords=stopwords,<br/>  repeat=True)<br/>  wc.generate(str(text))<br/>  wc.to_file(“wc.png”)<br/>  print(“Word Cloud Saved Successfully”)<br/>  path=”wc.png”<br/>  display(Image.open(path))</span></pre><p id="8118" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">定义了这个函数之后，我们可以通过运行以下命令来查看所有绘制的tweet数据的单词云</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e830" class="jy jz hi kz b fi ld le l lf lg">create_wordcloud(tw_list[“text”].values)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/e7c6fcb618d759917c3c2a4de2c81bbf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCTPhzF9T6rC9qaIdrAMcA.png"/></div></div></figure><p id="e30a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正面情感推文的词云可以绘制如下-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="54e8" class="jy jz hi kz b fi ld le l lf lg">create_wordcloud(tw_list_positive[“text”].values)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/0b14306c8d1f778b58d79bd74229a619.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P0g6KPnerPVDJNdOrpf2vQ.png"/></div></div></figure><p id="8863" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">负面情绪化推文的词云可以绘制如下-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="b132" class="jy jz hi kz b fi ld le l lf lg">create_wordcloud(tw_list_negative[“text”].values)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/eae500234fa381b2f1be300bcb2e3211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O9w87ZMBOGhynuHpXwLWmg.png"/></div></div></figure><p id="4061" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们来计算推文的长度和字数。我们可以根据不同的情绪来检查推文中使用的单词密度和字符—</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="9187" class="jy jz hi kz b fi ld le l lf lg">tw_list[‘text_len’] = tw_list[‘text’].astype(str).apply(len)<br/>tw_list[‘text_word_count’] = tw_list[‘text’].apply(lambda x: len(str(x).split()))round(pd.DataFrame(tw_list.groupby("sentiment").text_len.mean()),2)s</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mb"><img src="../Images/b4a527960b9823933bd068732a9d4ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q40mGmreEvsqPiYo6GfoTQ.png"/></div></div></figure><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="5ea3" class="jy jz hi kz b fi ld le l lf lg">round(pd.DataFrame(tw_list.groupby(“sentiment”).text_word_count.mean()),2)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/9a2afbb7bb79197a7769d156dda00dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tBGXdfKBjUYR4Y4H8q-XCg.png"/></div></div></figure><p id="e8c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">应用计数矢量器提供了在生成矢量表示之前预处理文本数据的能力，使其成为高度灵活的文本特征表示模块。算上矢量器之后，就可以用两三个或者你想要的任何东西来分析单词了。</p><p id="bcb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对我们的数据应用词干分析器也会重新运行这些tweet单词的词根。我们可以排除这些来自同一个词根的单词，如下-</p><ul class=""><li id="8567" class="lj lk hi ih b ii ij im in iq ll iu lm iy ln jc lo lp lq lr bi translated">连接</li><li id="f361" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">关系</li><li id="490a" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">连接的</li><li id="0cca" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">连接</li><li id="0e7e" class="lj lk hi ih b ii ls im lt iq lu iu lv iy lw jc lo lp lq lr bi translated">连接</li></ul><p id="0d39" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这些都可以从<strong class="ih hj">“连接”中推导出来。一旦我们将词干分析器功能应用于如上所述的单词列表，多余的部分将被删除。</strong></p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="0b0e" class="jy jz hi kz b fi ld le l lf lg">def remove_punct(text):<br/>  text = “”.join([string.punctuation])<br/>  text = re.sub(‘[0–9]+’, ‘’, text)<br/>  return texttw_list[‘punct’] = tw_list[‘text’].apply(lambda x: remove_punct(x))</span><span id="496e" class="jy jz hi kz b fi lh le l lf lg">def tokenization(text):<br/>    text = re.split('\W+', text)<br/>    return texttw_list['tokenized'] = tw_list['punct'].apply(lambda x: tokenization(x.lower()))</span><span id="74ee" class="jy jz hi kz b fi lh le l lf lg">stopword = nltk.corpus.stopwords.words('english')</span><span id="9549" class="jy jz hi kz b fi lh le l lf lg">def remove_stopwords(text):<br/>    text = [word for word in text if word not in stopword]<br/>    return text<br/>    <br/>tw_list['nonstop'] = tw_list['tokenized'].apply(lambda x: remove_stopwords(x))</span><span id="6929" class="jy jz hi kz b fi lh le l lf lg">ps = nltk.PorterStemmer()</span><span id="cf4b" class="jy jz hi kz b fi lh le l lf lg">def stemming(text):<br/>    text = [ps.stem(word) for word in text]<br/>    return texttw_list['stemmed'] = tw_list['nonstop'].apply(lambda x: stemming(x))</span><span id="bb59" class="jy jz hi kz b fi lh le l lf lg"><br/>def clean_text(text):<br/>    text_lc = "".join([word.lower() for word in text if word not in string.punctuation]) <br/>    text_rc = re.sub('[0-9]+', '', text_lc)<br/>    tokens = re.split('\W+', text_rc)    # tokenization<br/>    text = [ps.stem(word) for word in tokens if word not in stopword]  <br/>   return texttw_list.head()</span></pre><p id="49c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在应用计数矢量器后，结果显示所有这1281条推文总共有2966个唯一单词。</p><p id="7749" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们看一下我们的数据框架，我们会看到一些新功能，如点状、标记化、不间断、词干化。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/a0deb5fff71805344ba7503dc9e9c875.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Je_qgo33nlhVRlD-l9cnAg.png"/></div></div></figure><p id="569b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以按降序排列这些值，找出最常用的单词-</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="bbb0" class="jy jz hi kz b fi ld le l lf lg">count = pd.DataFrame(count_vect_df.sum())<br/>countdf = count.sort_values(0,ascending=False).head(20)<br/>countdf[1:11]</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/0f12f860ed63f08645d929a66e0e7446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Dsv-13Y3P9V0iRFYvylGw.png"/></div></div></figure><p id="84f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">构建一个n-gram模型有助于我们预测这个序列中最有可能出现的下一个单词。首先，我们将创建一个函数来构建n2_bigram、n3_trigram等。</p><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e47d" class="jy jz hi kz b fi ld le l lf lg">def get_top_n_gram(corpus,ngram_range,n=None):<br/> vec = CountVectorizer(ngram_range=ngram_range,stop_words = ‘english’).fit(corpus)<br/> bag_of_words = vec.transform(corpus)<br/> sum_words = bag_of_words.sum(axis=0) </span><span id="ed68" class="jy jz hi kz b fi lh le l lf lg"> words_freq = [(word, sum_words[0, idx]) for word, idx in vec.vocabulary_.items()]<br/> words_freq = sorted(words_freq, key = lambda x: x[1], reverse=True)<br/> return words_freq[:n]</span><span id="8195" class="jy jz hi kz b fi lh le l lf lg"> n2_bigrams = get_top_n_gram(tw_list[‘text’],(2,2),20)n2_bigrams</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/a53af623f8b6b040cbc1469bc3a9cdea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PhQ-aV7S3KdOzre97FH0ig.png"/></div></div></figure><pre class="je jf jg jh fd ky kz la lb aw lc bi"><span id="e66e" class="jy jz hi kz b fi ld le l lf lg">n3_trigrams = get_top_n_gram(tw_list[‘text’],(3,3),20)n3_trigrams</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es me"><img src="../Images/446ca90bf80e14dc9baad2bee206af95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKrtOEzU5Tp_krIqTU3CEg.png"/></div></div></figure><p id="1645" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们现在可以使用twitter tweets来分析情绪，我们可以有效地得出哪些词最常使用以及哪组词经常一起使用的结论。</p><p id="cb0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读。<br/>编码快乐！！</p></div></div>    
</body>
</html>