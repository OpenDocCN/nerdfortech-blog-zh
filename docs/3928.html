<html>
<head>
<title>Demystifying Javascript engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭秘 Javascript 引擎</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/demystifying-javascript-engine-41f9aa4bfc07?source=collection_archive---------11-----------------------#2021-06-29">https://medium.com/nerd-for-tech/demystifying-javascript-engine-41f9aa4bfc07?source=collection_archive---------11-----------------------#2021-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c9226a99ef32920de79c0096e2ec59de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L3ac2SAa92mDKTvntjt-mg.png"/></div></div></figure><p id="4be2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">事件循环是 Node.js 的核心，我们都听过这个，让我们来探讨一下</strong></p><blockquote class="jo jp jq"><p id="a55f" class="iq ir jr is b it iu iv iw ix iy iz ja js jc jd je jt jg jh ji ju jk jl jm jn hb bi translated">我们都知道 Nodejs 是单线程的，但仍然能够轻松地执行多个任务，这怎么可能呢？</p></blockquote><p id="6891" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Javascript 不会一次执行多个任务，而是一个接一个地执行所有任务，但是由于其异步特性，它看起来好像是一次执行多个任务。</p><p id="03db" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们探索一下 javascript 如何执行代码</p><p id="6629" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Javascript 有一个调用栈，所有代码都在调用栈下执行，一旦代码进入调用栈，它就立即开始执行，javascript 引擎非常快，可以立即执行，但仍有一个问题，现在我们知道 javascript 有一个调用栈，所有代码都在调用栈下执行，那么像从外部源请求数据、promise、setTimeout 等需要时间执行的代码呢，所以我们的下一张图中所有这些问题的答案，让我们探索下图</p><figure class="jw jx jy jz fd ij er es paragraph-image"><div class="er es jv"><img src="../Images/c3e52c9cdf6cc1b111f426a68333b08d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*YhKbuRTibBStb_MdPRBI9g.png"/></div><figcaption class="ka kb et er es kc kd bd b be z dx translated">事件循环</figcaption></figure><p id="c3e1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上图是 javascript 引擎的基本表现，同时也解释了 javascript 如何快速执行异步任务。</p><p id="f596" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在上图中，我们可以看到有一个调用栈、一个 webAPI、一个微任务队列、一个回调队列和一个事件循环。现在让我们探索它是如何工作的</p><p id="504d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦任何代码进入调用堆栈，javascript 就开始执行代码，但是如果有任何 fetch、promise、setTimeout、eventHandlers 找到它的代码，javascript 就将这些代码移动到 webAPI，并根据它们注册回调，一旦回调准备好执行，它就移动到微任务队列或回调队列，通知事件循环这些回调准备好执行。</p><p id="7484" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Eventloop 的工作是持续监控调用栈、微任务队列和回调队列，因此当 eventloop 发现调用栈中没有可执行的内容时，它会将回调从微任务队列或回调队列移动到调用栈，javascript 会在回调被移动后立即执行。</p><p id="5206" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在的问题是这个黑客微任务队列和回调队列是什么，为什么我们有两个队列而不是一个？</p><p id="d6b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们揭开这些的神秘面纱，微任务队列也可以被称为优先级队列，因此微任务队列中的所有任务都首先被执行，当微任务队列为空时，只有来自回调队列的任务被移动到调用堆栈中执行。</p><p id="efd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在什么任务都归入微任务队列？</p><p id="c583" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">承诺和变异观察器放在微任务队列下，所有其他回调放在回调队列下。</p><p id="b296" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望这篇文章对你理解事件循环和 javascript 引擎有所帮助，欢迎发表你对这篇文章的建议，你喜欢什么，分享你的想法，这样其他人也会觉得有用！</p></div></div>    
</body>
</html>