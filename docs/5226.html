<html>
<head>
<title>How to test the performance of the Caffe2 Model (.caffemodel)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何测试Caffe2模型的性能(。caffemodel)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-test-the-performance-of-the-caffe2-model-caffemodel-fbce2e4d9c68?source=collection_archive---------9-----------------------#2021-09-09">https://medium.com/nerd-for-tech/how-to-test-the-performance-of-the-caffe2-model-caffemodel-fbce2e4d9c68?source=collection_archive---------9-----------------------#2021-09-09</a></blockquote><div><div class="dt gx gy gz ha hb"/><div class="hc hd he hf hg"><figure class="hi hj fa fc hk hl es et paragraph-image"><div role="button" tabindex="0" class="hm hn di ho bf hp"><div class="es et hh"><img src="../Images/c1c273c6787c8bdcd3646f5eb1b5e144.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rRzkTcHUCxRqEZLFyuynYA.png"/></div></div></figure><div class=""/><div class=""><h2 id="df73" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji dy translated">深度学习框架Caffe2模型的性能</h2></div><p id="1936" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hc bi translated">我们的OpenCV框架有几个API来执行Caffe2、Tensorflow、OpenVINO模型等。</p><p id="3ded" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hc bi translated">OpenCV提供了一个统一的API来测试视频推理的准确性、深度学习模型的准确性、对所需应用程序进行基准测试以及测试模型在以下方面的性能:</p><p id="f23e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hc bi translated">模型数据的GFlops和Mb</p><blockquote class="kf kg kh"><p id="0abd" class="jj jk ki jl b jm jn iv jo jp jq iy jr kj jt ju jv kk jx jy jz kl kb kc kd ke hc bi translated"><strong class="jl hv"> Caffe2模型(。caffemodel)由模型权重和从OpenCV API输出的整个blob内存组成。</strong></p></blockquote><blockquote class="km"><p id="02a7" class="kn ko hu bd kp kq kr ks kt ku kv ke dy translated">请仔细阅读这段关键代码。</p></blockquote><pre class="kw kx ky kz la lb lc ld le aw lf bi"><span id="9fbd" class="lg lh hu lc b fj li lj l lk ll">import cv2</span><span id="4173" class="lg lh hu lc b fj lm lj l lk ll">weights = self.find_dnn_file("dnn/{caffemodel name}.caffemodel", required=False)</span><span id="a214" class="lg lh hu lc b fj lm lj l lk ll">config = self.find_dnn_file("dnn/{prototxt name}.prototxt", required=False)</span><span id="b940" class="lg lh hu lc b fj lm lj l lk ll">if weights is None or config is None:</span><span id="a889" class="lg lh hu lc b fj lm lj l lk ll">    raise Exception("Missing DNN test files (dnn/caffemodel name.{prototxt/caffemodel}). Verify OPENCV_DNN_TEST_DATA_PATH configuration parameter.")</span><span id="add0" class="lg lh hu lc b fj lm lj l lk ll"># Use OpenCV to Instantiate Caffe2 Model<br/><strong class="lc hv">model = cv2.dnn_DetectionModel(weights, config)<br/>model.setInputParams(size=(224, 224), mean=(0, 0, 0), scale=1.0)</strong></span><span id="c6d0" class="lg lh hu lc b fj lm lj l lk ll"><br/># set output layer for forward pass<br/><strong class="lc hv">outputLayer = "detection_out"</strong></span><span id="8921" class="lg lh hu lc b fj lm lj l lk ll"><br/># Evaluate Memory Consumption<br/><strong class="lc hv">weightsMemory, blobsMemory = model.getMemoryConsumption((1,3,224,224))</strong></span><span id="a4ae" class="lg lh hu lc b fj lm lj l lk ll"># calculate FLOPS<br/><strong class="lc hv">flops = model.getFLOPS((1,3,224,224))<br/>model.forward(outputLayer)</strong></span><span id="303b" class="lg lh hu lc b fj lm lj l lk ll">print("Memory consumption:")</span><span id="a9a4" class="lg lh hu lc b fj lm lj l lk ll">print("    Weights(parameters): ", (<strong class="lc hv">weightsMemory </strong>+ (1&lt;&lt;20) - 1) / (1&lt;&lt;20), " Mb")</span><span id="f2c4" class="lg lh hu lc b fj lm lj l lk ll">print("    Blobs: ", (<strong class="lc hv">blobsMemory </strong>+ (1&lt;&lt;20) - 1) / (1&lt;&lt;20), " Mb")</span><span id="2471" class="lg lh hu lc b fj lm lj l lk ll">print("Calculation complexity: ", <strong class="lc hv">flops </strong>* 1e-9, " GFlops")</span></pre><p id="0e17" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hc bi translated">谢谢你。</p></div></div>    
</body>
</html>