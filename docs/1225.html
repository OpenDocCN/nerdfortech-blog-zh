<html>
<head>
<title>Image Snapshot Testing with Mocha</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Mocha进行图像快照测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/image-snapshot-testing-with-mocha-cabc3e691fc6?source=collection_archive---------29-----------------------#2021-03-09">https://medium.com/nerd-for-tech/image-snapshot-testing-with-mocha-cabc3e691fc6?source=collection_archive---------29-----------------------#2021-03-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/41144831e63a0b499e5ef67c0fdbf41f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zEnohVVuCdDf888auQCu_w.png"/></div></div></figure><p id="4aa6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">快照测试是一种测试机制，很长时间以来似乎都是由<a class="ae jo" href="https://github.com/facebook/jest" rel="noopener ugc nofollow" target="_blank"> Jest </a>独占的。主要思想是将期望值生成到一个单独的文件中，并将实际测试值与这些保存的值进行比较。也可以通过传递环境变量来更新快照。这种测试方法非常适合复杂的数据，比如大型字符串、DOM内容或图像。我写了一个包来使用图像快照测试，也和<a class="ae jo" href="https://github.com/mochajs/mocha" rel="noopener ugc nofollow" target="_blank">摩卡</a>一起使用。</p><h1 id="3cca" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">用Jest进行快照测试</h1><p id="a177" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">快照测试本身是Jest的<a class="ae jo" href="https://jestjs.io/docs/en/snapshot-testing" rel="noopener ugc nofollow" target="_blank">内置特性</a>，当专门搜索图像快照时，您会很快找到<a class="ae jo" href="https://github.com/americanexpress/jest-image-snapshot" rel="noopener ugc nofollow" target="_blank"> jest-image-snapshot </a>，它在比较和更新图像快照方面做得很好。它还提供了一些便利的特性，比如base64 diff输出，这允许我们从CI环境中查看diff(因为不能保存或查看diff图像文件)。</p><h1 id="aa70" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">摩卡怎么样？</h1><p id="f6d5" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">虽然这一切都很棒，但是如果我出于某种原因没有使用Jest呢？如果我在用摩卡呢？</p><p id="1007" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于简单的快照测试，有一些选项。对于柴用户，有<a class="ae jo" href="https://github.com/monojitb02/mocha-chai-snapshot" rel="noopener ugc nofollow" target="_blank">摩卡柴快照</a>。对于expect用户，有<a class="ae jo" href="https://github.com/blogfoster/expect-mocha-snapshot" rel="noopener ugc nofollow" target="_blank"> expect-mocha-snapshot </a>。它基本上通过注入人工测试上下文来包装jest快照逻辑。亚历山大·贝莱茨基的功劳！</p><p id="6696" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仍然缺少的是将图像快照测试移植到Mocha的包。因为我目前使用expect作为断言库，所以我专注于寻找这个问题的解决方案。</p><p id="437e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我开始尝试将jest-image-snapshot与expect-mocha-snapshot结合使用，结果比预期的更容易兼容mocha。我把它放到自己的NPM包里，名为<a class="ae jo" href="https://github.com/dword-design/expect-mocha-image-snapshot" rel="noopener ugc nofollow" target="_blank">expect-mocha-image-snapshot</a>。用法非常类似于Jest，您只需通过<code class="du ks kt ku kv b">this</code>传递测试上下文。下面是一个简单的代码示例:</p><figure class="kw kx ky kz fd ij"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="4bdf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你对它是如何工作的感兴趣，你可以看看这个代码。这很简单。</p><h1 id="b9e3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="200f" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这是我用Mocha测试图像快照的指南。如果你喜欢<a class="ae jo" href="https://github.com/dword-design/expect-mocha-image-snapshot" rel="noopener ugc nofollow" target="_blank">expect-mocha-image-snapshot</a>，可以在GitHub上打个星支持我。还有，让我知道你对它的想法。</p><p id="a734" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">如果你喜欢我正在做的事情，请关注我的</strong> <a class="ae jo" href="https://twitter.com/seblandwehr" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj"> Twitter </strong> </a> <strong class="is hj">或者查看我的</strong> <a class="ae jo" href="https://sebastianlandwehr.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">网站</strong> </a> <strong class="is hj">。也可以考虑在</strong> <a class="ae jo" href="https://www.buymeacoffee.com/dword" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">给我买杯咖啡</strong></a><strong class="is hj"/><a class="ae jo" href="https://www.paypal.com/paypalme/SebastianLandwehr" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">PayPal</strong></a><strong class="is hj">或者</strong><a class="ae jo" href="https://www.patreon.com/dworddesign" rel="noopener ugc nofollow" target="_blank"><strong class="is hj">Patreon</strong></a><strong class="is hj">进行捐赠。非常感谢！❤️ </strong></p><p id="1c7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="lc">原载于</em><a class="ae jo" href="https://sebastianlandwehr.com/blog/image-snapshot-testing-with-mocha" rel="noopener ugc nofollow" target="_blank"><em class="lc">sebastianlandwehr.com</em></a></p></div></div>    
</body>
</html>