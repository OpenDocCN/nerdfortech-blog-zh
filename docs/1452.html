<html>
<head>
<title>Import an existing Infrastructure to Terraform.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将现有基础设施导入 Terraform。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/importing-an-existing-infrastructure-to-terraform-e5b80d143011?source=collection_archive---------2-----------------------#2021-03-20">https://medium.com/nerd-for-tech/importing-an-existing-infrastructure-to-terraform-e5b80d143011?source=collection_archive---------2-----------------------#2021-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/fee8629c48c8591e36f893e27ef401e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CWjjt0s3t_CvnpiGEep0tA.jpeg"/></div></div></figure><div class=""/><p id="0bdf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望搜索引擎在你意识到你提到的实际地形在这里之前，可能已经带你去过 NASA 的网站了。别担心，你不是一个人。</p><p id="40e4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个公司都带着某些期望和假设迁移到公共云。管理层<em class="jo">期望</em>更好的成本优化，产品团队<em class="jo">期望</em>超快速的产品交付，开发团队<em class="jo">期望</em>更少的维护。但是这些期望通常不会实现。</p><p id="2bf9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">人们经常如此字面地看待牛和宠物，以至于他们不关心有多少资源正在被创造，谁创造了这些资源，有多少正在被使用，它们是否被充分地使用，等等。</p><p id="9ada" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">IaC(Infrastructure as Code)并不是解决所有这些问题的灵丹妙药，但是使用 IaC 管理您的基础设施有助于保持健康，最终有助于解决上述棘手问题。</p><p id="3a78" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们将基础设施转化为代码，接下来就是软件了。一旦它是一个软件，那么我们就可以利用我们从过去学到的软件工程原则和最佳实践。</p><h1 id="ef52" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">比赛开始了……</strong></h1><p id="07a4" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">将应用程序/服务器迁移到公共云总是发生在最佳阶段。DevOps 团队将冲向终点线。</p><figure class="kt ku kv kw fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ks"><img src="../Images/ebb2b9f25d4aaf8304bb657195ec5e24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gxOb8D4EK_eUNcsGVLkQKQ.jpeg"/></div></div></figure><p id="cda9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一点上适应 IaC 就像在最好的一圈换轮胎一样。整个迁移团队都应该了解这项技术(比如说，Terraform)。你需要几个真正精通这方面的人，这样你才能走得更快。最重要的是，你必须承担撞上任何路障的风险。因此，人们走传统的和臭名昭著的“点击并建立”路线。</p><h1 id="db54" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">下一个最佳适应时间</h1><p id="e303" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">迁移到 IaC 的最佳时间是在迁移的开始阶段，但是如果您错过了这个时间，您还有机会。在本文中，我们将讨论几个 Terraform 导入工具。</p><h1 id="c749" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">编码的基础设施</h1><p id="4796" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Terraform 中的 IaC 代码由两个主要部分组成。</p><ol class=""><li id="9b25" class="kx ky ht is b it iu ix iy jb kz jf la jj lb jn lc ld le lf bi translated"><strong class="is hu"> <em class="jo">”。tf" </em> </strong> <em class="jo"> </em>文件，这是我们用 HCL 语言写的。</li><li id="31a6" class="kx ky ht is b it lg ix lh jb li jf lj jj lk jn lc ld le lf bi translated">terraform 根据我们在<strong class="is hu">中提供的 HCL 定义创建的<strong class="is hu"> <em class="jo">【状态文件】</em> </strong>。tf" </strong>文件。</li></ol><p id="915e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将现有基础设施导入 IaC 包括生成 HCL 脚本和状态文件。</p><h1 id="e24e" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">无效的“进口土地”</h1><p id="09ed" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Terraform 附带了一个“导入”工具，如果你有手写的 HCL 定义(至少你需要一个实体模型定义)，使用它你可以只导入<strong class="is hu">基础设施的状态</strong>。</p><p id="d11a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于一个或两个资源，手动编码 terraform HCL 定义并运行 terraform import 来生成状态文件是很好的。但是以这种方式进口大型基础设施是一场噩梦。</p><h1 id="213d" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">开源导入工具</h1><p id="f7ff" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这些开源导入工具帮助我们生成<strong class="is hu"> HCL 定义。</strong>一旦你有了定义，这些工具使用相同的“地形导入”来生成状态文件。</p><p id="4f75" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很少有非常流行的工具可以将现有资源导入 Terraform。基于他们是如何创造的”。tf 文件”，我们可以把它们分为基于<strong class="is hu">模板的</strong>和<strong class="is hu"> API 驱动的</strong>。</p><h2 id="de1c" class="ll jq ht bd jr lm ln lo jv lp lq lr jz jb ls lt kd jf lu lv kh jj lw lx kl ly bi translated">基于模板:地形化[不活跃]</h2><p id="58e3" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">Terraforming 是一个非常灵活的工具，可以将基础设施导入 terraform。这个基于 Ruby 的工具是 terraform 之外的第一批导入工具之一。这使得它最受欢迎。它还可以将新生成的状态文件与任何现有的状态文件合并。这在其他选项中是不可用的。</p><p id="ea4b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不幸的是，该项目目前没有得到积极的发展。其次，这基于预定义的模板。即。该工具通过使用预定义的模板来生成 HCL 脚本/资源块。这使得它很难维持。terraform 资源定义中的任何更改都可能会破坏代码，除非您手动将其添加到模板中。</p><div class="hh hi ez fb hj lz"><a href="https://github.com/dtan4/terraforming" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hu fi z dy me ea eb mf ed ef hs bi translated">dtan 4/地形改造</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">将现有 AWS 资源导出为 Terraform 样式(tf，tfstate)需要 Ruby 2.3 或更高版本 Terraform v0.9.3 或…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn hp lz"/></div></div></a></div><h2 id="7e59" class="ll jq ht bd jr lm ln lo jv lp lq lr jz jb ls lt kd jf lu lv kh jj lw lx kl ly bi translated">API 驱动:terraformer，terracognito</h2><p id="427c" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">与“terraforming”和其他基于模板的工具不同，这些工具使用 terraform SDK 来识别资源模式并生成适当的 HCL 资源定义。这使得它更容易适应任何变化。</p><p id="bd41" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">列出一些限制，这些工具似乎没有合并状态文件的特性。每种类型的资源(比如所有 AWS EC2instances)都有自己的状态文件。但好的一面是，对于大型基础设施，为每个资源保存单独的状态文件总是更好，以避免爆炸半径和时间。否则，运行简单的 terraform 应用/计划必须刷新整个基础架构。是的，您可能会失去资源依赖性，因为资源是分开管理的。</p><div class="hh hi ez fb hj lz"><a href="https://github.com/cycloidio/terracognita" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hu fi z dy me ea eb mf ed ef hs bi translated">cycloidio/terracognita</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">将您当前的云基础架构作为代码 Terraform 配置(HCL)导入到基础架构，或/和导入到…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mo l mk ml mm mi mn hp lz"/></div></div></a></div><div class="hh hi ez fb hj lz"><a href="https://github.com/GoogleCloudPlatform/terraformer" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hu fi z dy me ea eb mf ed ef hs bi translated">Google cloud platform/terra former</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">基于现有基础设施生成 tf/ json 和 tfstate 文件的 CLI 工具(反向地形)。免责声明…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mp l mk ml mm mi mn hp lz"/></div></div></a></div><h1 id="1592" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">奖励:导入工具作为漂移识别</h1><p id="4b18" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">无论流程有多长，都可能存在手动/意外更改。这些需要被适当地跟踪。</p><p id="b17d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">导入工具有助于识别基础架构中的手动/意外更改。运行计划的无服务器运行“terraform 导入工具”将生成当前基础架构的 HCL 定义。当对照生产状态文件运行时，将给出基础结构中的差异。有助于保持卫生。</p><h1 id="ee15" class="jp jq ht bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="7163" class="pw-post-body-paragraph iq ir ht is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">这些工具支持所有主要的云提供商。它们有自己的局限性，并且是为通用用例设计的。因此，可能需要进行一些更改才能在定制基础架构中使用。还有，需要严格的测试，“terraform 计划”是你的朋友。</p></div></div>    
</body>
</html>