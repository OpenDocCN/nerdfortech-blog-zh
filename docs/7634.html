<html>
<head>
<title>💿 Core Data — Batch Insertion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">💿核心数据—批量插入</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/core-data-batch-insertion-ff9d2e2d4fd9?source=collection_archive---------0-----------------------#2022-12-19">https://medium.com/nerd-for-tech/core-data-batch-insertion-ff9d2e2d4fd9?source=collection_archive---------0-----------------------#2022-12-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="1a15" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">核心数据指南</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div class="er es io"><img src="../Images/f11fec2f49285a9619cd43bff4de1b87.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*aNqpzfK36USto2Rt7JDniQ.jpeg"/></div><figcaption class="iv iw et er es ix iy bd b be z dx translated">学分:developer.apple.com</figcaption></figure><p id="f36a" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">几乎所有项目都需要一次性向数据库中添加大量数据。在我的情况下，它将主要是下载用户数据时，安装在一个新的设备。</p><p id="fecd" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">我见过一些新开发人员，包括我在内，使用<strong class="jb hs"> for-loop </strong>从数组中一个接一个地取出对象，然后将它添加到上下文中。</p><figure class="jy jz ka kb fd is er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jx"><img src="../Images/92eb8f7da0969cf04965a9bf89f44fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbVqANo7Ewhx_Eywlq6rOg.png"/></div></div><figcaption class="iv iw et er es ix iy bd b be z dx translated">演职员表:<a class="ae kg" href="https://www.canva.com" rel="noopener ugc nofollow" target="_blank"> canva </a></figcaption></figure><p id="503a" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">好吧，我们来看看代码。</p><p id="6520" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs"> <em class="kh">举例:</em> </strong></p><pre class="jy jz ka kb fd ki kj kk bn kl km bi"><span id="55dc" class="kn ko hi kj b be kp kq l kr ks">/// Create Batch Insert Request<br/>      let insertRequest = NSBatchInsertRequest(entity: BookKeeper.entity(), objects: booksArray)<br/>/// Set the Result Type, in our case we need object IDs<br/>       insertRequest.resultType = NSBatchInsertRequestResultType.objectIDs<br/>/// Execute the request using the background context already created.<br/>       let result = try? bgContext().execute(insertRequest) as? NSBatchInsertResult<br/>/// Finally we merge using the objectIDs we got from the results.<br/>            if let objectIDs = result?.result as? [NSManagedObjectID], !objectIDs.isEmpty {<br/>                let save = [NSInsertedObjectsKey: objectIDs]<br/>                NSManagedObjectContext.mergeChanges(fromRemoteContextSave: save, into: [mainContext])</span></pre><h2 id="628d" class="kt ko hi bd ku kv kw kx ky kz la lb lc jk ld le lf jo lg lh li js lj lk ll ho bi translated">步骤:</h2><ol class=""><li id="1202" class="lm ln hi jb b jc lo jg lp jk lq jo lr js ls jw lt lu lv lw bi translated">使用我们从<strong class="jb hs"> NSManagedObject </strong>获得的实体描述和转换为字典的对象数组创建一个<strong class="jb hs"> NSBatchInsertRequest </strong>。</li><li id="16da" class="lm ln hi jb b jc lx jg ly jk lz jo ma js mb jw lt lu lv lw bi translated">将结果类型设置为我们创建为 objectIDs 的<strong class="jb hs"> NSBatchInsertRequest </strong></li><li id="6b65" class="lm ln hi jb b jc lx jg ly jk lz jo ma js mb jw lt lu lv lw bi translated">使用后台上下文执行请求(使用<strong class="jb hs">nsmergebypropertyobjecttrumpergepolicy</strong>创建后台上下文)。</li><li id="0b39" class="lm ln hi jb b jc lx jg ly jk lz jo ma js mb jw lt lu lv lw bi translated">使用<strong class="jb hs">nsmanagedobject . merge changes</strong>和<strong class="jb hs"> changeNotificationData </strong>将更改合并到数组中的主上下文中。</li></ol><p id="9f36" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">它可能会与这些信息混淆。请参考下面给出的样本项目。</p><h2 id="b2ef" class="kt ko hi bd ku kv kw kx ky kz la lb lc jk ld le lf jo lg lh li js lj lk ll ho bi translated">📁<strong class="ak">带有批量插入代码的文件</strong></h2><div class="mc md ez fb me mf"><a href="https://github.com/Rajaikumar-iOSDev/BookKeeper/blob/main/BookKeeper/Services/BookKeeperService.swift" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hs fi z dy mk ea eb ml ed ef hr bi translated">主 Rajaikumar 的簿记员/簿记员服务. swift-IOs dev/簿记员</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">核心数据指南:批量插入。通过在…上创建帐户，为 Rajaikumar-iOSDev/BookKeeper 开发做出贡献</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">github.com</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt it mf"/></div></div></a></div><h2 id="f13d" class="kt ko hi bd ku kv kw kx ky kz la lb lc jk ld le lf jo lg lh li js lj lk ll ho bi translated">🗄️回购</h2><div class="mc md ez fb me mf"><a href="https://github.com/Rajaikumar-iOSDev/BookKeeper" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hs fi z dy mk ea eb ml ed ef hr bi translated">GitHub-Rajaikumar-IOs dev/簿记员</h2><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">github.com</p></div></div><div class="mo l"><div class="mu l mq mr ms mo mt it mf"/></div></div></a></div><h2 id="9b0e" class="kt ko hi bd ku kv kw kx ky kz la lb lc jk ld le lf jo lg lh li js lj lk ll ho bi translated">📰我的其他文章与核心数据相关</h2><ol class=""><li id="08c5" class="lm ln hi jb b jc lo jg lp jk lq jo lr js ls jw lt lu lv lw bi translated"><a class="ae kg" rel="noopener" href="/nerd-for-tech/core-data-fetch-index-for-faster-searches-c3e66a417703">核心数据获取索引，加快搜索速度。</a></li><li id="1f64" class="lm ln hi jb b jc lx jg ly jk lz jo ma js mb jw lt lu lv lw bi translated"><a class="ae kg" rel="noopener" href="/nerd-for-tech/coredata-fetch-request-template-e07e94bc013e">核心数据提取请求模板</a></li></ol></div></div>    
</body>
</html>