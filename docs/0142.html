<html>
<head>
<title>Another Dependency Injection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">另一个依赖注入</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/another-dependency-injection-81371b3434e6?source=collection_archive---------0-----------------------#2020-05-09">https://medium.com/nerd-for-tech/another-dependency-injection-81371b3434e6?source=collection_archive---------0-----------------------#2020-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/27e8cafff3802392903b0ff521726c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wpKU33nShtKatAbZG2XgQ.jpeg"/></div></div></figure><div class=""/><p id="326d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好 iOS 介质阅读器！</p><p id="2524" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天我想给大家介绍一下 Swift 中<strong class="is hu">依赖注入</strong> ( <strong class="is hu"> D.I. </strong>)的另一种方式。我知道有很多关于<strong class="is hu"> D.I. </strong>的文章，比如:<br/><a class="ae jo" href="https://www.swiftbysundell.com/articles/dependency-injection-using-factories-in-swift/" rel="noopener ugc nofollow" target="_blank">https://www . swiftbysundell . com/articles/dependency-injection-using-factories-in-swift/</a><br/>或者库:<br/><a class="ae jo" href="https://github.com/Swinject/Swinject" rel="noopener ugc nofollow" target="_blank">https://github.com/Swinject/Swinject</a>。</p><p id="8f2e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么问题来了:<strong class="is hu">我为什么选择这个题目。再次……</strong></p><p id="820d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">答:我选择这个主题是因为它非常广泛，并且它的实现依赖于对创作者的解决方案的了解。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="c5f1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想展示的是轻量级的<strong class="is hu"> D.I. </strong>用于在视图控制器之间传递协议，或者其他东西，这取决于你的架构。</p><p id="b012" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为此，我们需要用关联类型和注入方法的声明来声明协议，这将注入所需的协议。</p><p id="8bb6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们称这个协议为<strong class="is hu">可注射的:</strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="7a1b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们创建一个能够注射<strong class="is hu">可注射</strong>协议的东西。举个简单的例子，我将使用视图控制器。</p><p id="f15b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们更进一步，创建<strong class="is hu"> BaseViewController </strong>，它包含一个我们可以注入协议的方法。为此，我将使用<a class="ae jo" href="https://docs.swift.org/swift-book/LanguageGuide/Generics.html" rel="noopener ugc nofollow" target="_blank">泛型机制</a>:</p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="af6d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好吧。现在我们有了基本组件，让我们用它们做一些工作，然后我们将看到结果。</p><p id="b7a3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要创建一个我们想要使用协议的场景。让我们假设我们的<strong class="is hu"> FirstViewController </strong>正在从<strong class="is hu">核心数据</strong>中获取一些对象。因此，视图控制器的实现将如下所示:</p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="ac9e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">CoreDataProvider 的实现如下所示:</p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="6463" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要做的是将<strong class="is hu"> CoreDataProvider </strong>注入到<strong class="is hu"> FirstViewController </strong>中。为此，我们创建一个对象来实现<strong class="is hu">可注入</strong>协议:</p><p id="01e2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">第一视图注入器:</strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="f76d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好，让我们把这些积木连接起来！</p><p id="173a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">第一视图控制器</strong>:</p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="286d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在注入我们的核心数据服务并显示<strong class="is hu"> FirstViewController </strong>。</p><p id="d771" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu"> AppDelegate: </strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="ea3b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在运行我们的代码，我们会看到一个黄色的场景，Xcode 也会打印:"<em class="kc">【first view controller】</em><strong class="is hu"/><em class="kc">从核心数据</em>中获取一些不错的模型"。至少应该是这样的…希望是！</p><p id="df7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们继续，添加第二个场景，它将从<strong class="is hu">核心数据</strong>中获取我们惊人的模型，并从 REST API 自己的注入器中获得一些不可思议的东西！</p><p id="52a1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">第二视图注入器:</strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="c20d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">网络服务提供商:</strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="24f2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">第二场:</strong></p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="bbc1" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<strong class="is hu"> viewDidAppear() </strong>方法中为 FirstViewController 添加以下代码:</p><figure class="jw jx jy jz fd hk"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="3f19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我想你已经注意到我们有两个协议要注入到<strong class="is hu"> SecondViewController </strong>中，所以在<strong class="is hu"> SecondViewInjector </strong>中，我使用了<a class="ae jo" href="https://www.hackingwithswift.com/example-code/language/what-is-a-tuple" rel="noopener ugc nofollow" target="_blank">元组</a>来注入两种不同类型的协议，多亏了这个解决方案，我们可以轻松地注入它们。</p><p id="d421" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们运行整个代码，我们应该看到:</p><ul class=""><li id="806c" class="kd ke ht is b it iu ix iy jb kf jf kg jj kh jn ki kj kk kl bi translated">"<em class="kc"> [FirstViewController]从核心数据中获取一些不错的模型</em>"</li><li id="70d1" class="kd ke ht is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">"<em class="kc"> [SecondViewController]从核心数据中获取一些不错的模型</em>"</li><li id="69a9" class="kd ke ht is b it km ix kn jb ko jf kp jj kq jn ki kj kk kl bi translated">"<em class="kc"> [SecondViewController]从 REST API 中获得非常棒的东西</em>"</li></ul></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="0b13" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">结论:</strong></p><p id="4bbb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">只用了几行代码，我们就实现了真正的<strong class="is hu"><em class="kc"/></strong><strong class="is hu">【d . I .】</strong>协议注入，因此我们不需要外部库。它也可以很容易地在单元测试中用于存根响应。</p><p id="8fa7" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请以此为激励，花点时间自己开发解决方案，而不是立即添加外部依赖:)</p><p id="25e8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢阅读，祝<strong class="is hu">好运</strong>！</p><p id="4597" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">完整代码:<br/></strong><a class="ae jo" href="https://github.com/Rafal-Prazynski/D.I.Medium" rel="noopener ugc nofollow" target="_blank">https://github.com/Rafal-Prazynski/D.I.Medium</a></p></div></div>    
</body>
</html>