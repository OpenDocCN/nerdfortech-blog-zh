<html>
<head>
<title>Using Dapper to load related entities in .NET Core</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Dapper加载。网络核心</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/using-dapper-to-load-related-entities-in-net-core-e5bf4d870c7b?source=collection_archive---------0-----------------------#2020-09-26">https://medium.com/nerd-for-tech/using-dapper-to-load-related-entities-in-net-core-e5bf4d870c7b?source=collection_archive---------0-----------------------#2020-09-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="789a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Dapper </strong>是<a class="ae jd" href="https://en.wikipedia.org/wiki/.NET_Framework" rel="noopener ugc nofollow" target="_blank">微软的<a class="ae jd" href="https://en.wikipedia.org/wiki/Object-relational_mapping" rel="noopener ugc nofollow" target="_blank">对象关系映射</a> (ORM)产品。NET </a>平台:提供了一个<a class="ae jd" href="https://en.wikipedia.org/wiki/Software_framework" rel="noopener ugc nofollow" target="_blank">框架</a>，用于将<a class="ae jd" href="https://en.wikipedia.org/wiki/Object-oriented_programming" rel="noopener ugc nofollow" target="_blank">面向对象</a> <a class="ae jd" href="https://en.wikipedia.org/wiki/Domain_model" rel="noopener ugc nofollow" target="_blank">领域模型</a>映射到传统的<a class="ae jd" href="https://en.wikipedia.org/wiki/Relational_database" rel="noopener ugc nofollow" target="_blank">关系数据库</a>。</p><p id="a4e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">Dapper ORM的主要特性:</strong></p><ol class=""><li id="a428" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">对象映射。</li><li id="9f5e" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">静态和动态对象绑定。</li><li id="824e" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">SQL查询和存储过程可以很容易地处理。</li><li id="aa9f" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">静态对象绑定。</li></ol><p id="a40d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有其他的表格。NET等实体框架核心，但在。网络世界Dapper被称为ORM之王。在这篇文章中，我将介绍如何使用Dapper。NET核心项目，并通过Dapper使用原始查询检索相关实体。</p><p id="5810" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">首先让我们创建实体，我们可以用它们来演示Dapper查询。以下是我将在示例中使用的四个实体。</strong></p><ol class=""><li id="6e60" class="je jf hi ih b ii ij im in iq jg iu jh iy ji jc jj jk jl jm bi translated">学生</li><li id="c7e3" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">班级</li><li id="f6ce" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">课程</li><li id="87c7" class="je jf hi ih b ii jn im jo iq jp iu jq iy jr jc jj jk jl jm bi translated">学生课程</li></ol><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es js"><img src="../Images/b88c0046a5bb07cba403c8ab6db67e2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*LGZ5xlRrulPR1iXznBgVTg.jpeg"/></div></figure><div class="jt ju jv jw fd ab cb"><figure class="ka jx kb kc kd ke kf paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><img src="../Images/655e0d5b2b6068d2b6755fc732892361.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*bu2IkBGifDzidbvGaBEwRg.jpeg"/></div></figure><figure class="ka jx kk kc kd ke kf paragraph-image"><img src="../Images/7c6e8a676270150d5d770c749d8e16d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/format:webp/1*VUelvfp3B-nF-V_dd6_X_Q.jpeg"/></figure></div><div class="ab cb"><figure class="ka jx kl kc kd ke kf paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><img src="../Images/5b307197413b1b44b9f78b33551fc261.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*UhKiOBGh-WRA5gEHhNq34Q.jpeg"/></div></figure><figure class="ka jx km kc kd ke kf paragraph-image"><img src="../Images/d000d24a3da1dcbd6ba6e614491d043e.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*oUuqeIh4nGBNdHLWWdIYRg.jpeg"/></figure></div><p id="a179" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，我们使用了实体框架核心和SQL server，所以在我们继续之前，我们需要实体框架包。</p><p id="de22" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">让我们安装下面的Nuget包</strong></p><p id="a4fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软。EntityFrameworkCore </p><p id="ce6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软。实体框架工作核心设计</p><p id="9fed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软。EntityFrameworkCore . SQL server</p><p id="c675" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微软。实体框架工作核心工具</p><p id="a28b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在appsettings.jsonfile中添加连接字符串</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ko"><img src="../Images/8f10bac42b449f1d5deb05625c59401b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cXqy1QuAga9d5dNGeJl78w.jpeg"/></div></div></figure><p id="0886" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建DbContext，作为SQL Server和之间的桥梁。网络实体。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kp"><img src="../Images/7c8f8d930391deca726c472f2dd0e098.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gntHGiOwYpdhGs1VCDVclQ.jpeg"/></div></div></figure><p id="e6b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在ConfigureServices方法的Statup.cs文件中配置ApplicationContext类。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kq"><img src="../Images/09b9b5bbda0fa4e32e71d79e9a730741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K2kb-O6CcPK3DYo-KVC0Cw.jpeg"/></div></div></figure><p id="b987" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们需要做的下一步是将我们在上面创建的实体迁移到SQL数据库中。在这里，我们使用实体框架代码优先的方法将实体迁移到Db表中。</p><p id="ae5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kn">添加-迁移“迁移名称”</em></p><p id="a700" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kn">更新-数据库</em></p><p id="0736" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">成功运行迁移命令后，它应该在SQL Server中创建数据库，并在应用程序上下文类中注册适当的表。在SSMS，我们应该看到这样的东西。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kr"><img src="../Images/f369da3f1eaf9da569b33ec41fffd230.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*2NwzSv7S3Ucf9uy8HXYhrQ.jpeg"/></div></figure><p id="9785" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们考虑一个场景，其中我们需要检索具有适当的<strong class="ih hj">班级</strong>和<strong class="ih hj">课程的<strong class="ih hj">学生</strong>的列表。</strong>如果我们查看实体，<strong class="ih hj">学生</strong>有一个<strong class="ih hj">类</strong>与之相关。和<strong class="ih hj">科目的多对多关系。</strong></p><p id="29af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">现在，让我们创建每个实体的视图模型，以便我们只在UI中表示那些需要的属性。</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ks"><img src="../Images/5b6526c9613951aeb05933d28358f466.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*PsM8PFS5ykBS34bkn-Y5zg.jpeg"/></div></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kt"><img src="../Images/30d0e47eaf87fac4d7d4de4430c0b885.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*t0j1yWI_YvWUbosv8FhNzw.jpeg"/></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ku"><img src="../Images/1b1a50344a2017be52a634a6881edc79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*kBvU4IRKKkC4St29qE4vVQ.jpeg"/></div></div></figure><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es kv"><img src="../Images/2eae1ecab3172a6b37d71df099eb65ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*xF_C3_yClLy6jZrU9AtLvw.jpeg"/></div></figure><p id="37ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们使用Dapper和原始SQL查询来获取学生及其相关实体。首先我们需要为dapper添加nuget包。</p><p id="6378" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了获取相关类和课程的学生列表，我创建了一个学生服务类。</p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kw"><img src="../Images/e7a80b9def17958bea040491624e48ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dxiWpaaCRKdBRwWlER3hFA.jpeg"/></div></div></figure><p id="7c81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们真正关注的查询。我已经创建了一个原始SQL查询，其中包含了我需要在select语句中提取的所需属性。</p><p id="ff81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所选列按照它们在查询结构中的显示顺序映射到适当的视图模型属性。</p><p id="b3c3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Dapper中的SplitOn属性用于指定所选列中要映射到某个C#模型(视图模型)的位置。</p><p id="1d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">带输入参数的Dapper查询</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es kx"><img src="../Images/9421c90eca025f78ae9dfdd93433e180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QQFaokTDgz_yiQ3NsWidpw.jpeg"/></div></div></figure><p id="bb2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们需要向SQL查询传递参数，我们可以在SQL查询中使用带有已定义属性名的匿名对象。</p><p id="6969" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建控制器以使用服务</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ky"><img src="../Images/92b62c06925dcb9b22e2362c93beece6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OB0M5wrQVK2O8uv1Nd_K6Q.jpeg"/></div></div></figure><p id="2272" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">控制器的JSON输出看起来像这样</strong></p><figure class="jt ju jv jw fd jx er es paragraph-image"><div class="er es ku"><img src="../Images/f3e9baeab88019a3c8de05b80cb8cbf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*M8GCwj6bFOwAMVA-VTiHRA.jpeg"/></div></figure><p id="e2a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">源代码:<a class="ae jd" href="https://github.com/PratikPokhrel/DapperDemo" rel="noopener ugc nofollow" target="_blank">https://github.com/PratikPokhrel/DapperDemo</a></p></div></div>    
</body>
</html>