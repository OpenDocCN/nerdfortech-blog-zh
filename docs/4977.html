<html>
<head>
<title>Asynchronous PHP To Support Stability Of Your Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异步 PHP 支持应用程序的稳定性</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/asynchronous-php-to-support-stability-of-your-application-c59a33cc81fb?source=collection_archive---------1-----------------------#2021-08-18">https://medium.com/nerd-for-tech/asynchronous-php-to-support-stability-of-your-application-c59a33cc81fb?source=collection_archive---------1-----------------------#2021-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7537e6f59574e366dc96cdac1b5946a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HvL14jVexaRA1k35XCKSpw.jpeg"/></div></div></figure><p id="0f20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有时，系统的某些部分或外部集成不可用，或者执行时间很长。就像面包师不要站着等面包被烤好一样，因为在此期间他可以准备新的，对我们系统中的用户来说也是一样。</p><ul class=""><li id="d87e" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">我们可以让用户异步完成注册和发送电子邮件。</li><li id="0b08" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">我们可以异步生成报告，并在报告完成后发送下载链接。</li><li id="4f23" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">我们可以异步运行外部集成，因此外部服务的不可用性不会影响最终用户。</li></ul><h1 id="9ef9" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">流</h1><p id="ad7d" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在上一篇关于<a class="ae lf" rel="noopener" href="/nerd-for-tech/event-handling-php-334dbf9916e4">事件处理</a>的博客文章中，我们看了看如何使用事件将流相互分离。</p><p id="c901" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">了解系统中有哪些流是很重要的，因为<strong class="is hj">如果我们应该让它异步的话，正是这些流给了我们线索</strong>。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="573b" class="kc kd hi bd ke kf ln kh ki kj lo kl km kn lp kp kq kr lq kt ku kv lr kx ky kz bi translated">用户注册流程</h1><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3f1f8e51436b80067cac27cc93f2aa7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y5HS0s7kk1xCxcxtsfSv3w.jpeg"/></div></div></figure><p id="9866" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续<a class="ae lf" rel="noopener" href="/nerd-for-tech/event-handling-php-334dbf9916e4">帖子中关于事件处理</a>的例子。<br/>对于注册用户，<strong class="is hj">主流程将创建一个用户并将其保存</strong>到数据库。<br/>另一方面，<strong class="is hj">子流程将是</strong> : <br/> -发送欢迎或确认电子邮件<br/> -创建关于用户注册的审计日志<br/> -将注册用户同步到外部服务(外部集成)</p><p id="7305" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢我们清楚地定义了给定场景中的流，我们可以决定它们中的哪些应该异步运行。</p><p id="6774" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们定义一下，通过选择异步运行流程，我们可以解决哪些问题:</p><p id="b95b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.<strong class="is hj">调用外部服务可能需要更多时间。</strong> <br/>我们集成的服务可能有高流量或一些性能问题。<br/>通过异步调用这段代码，我们让最终用户顺利完成注册。其次，它允许我们释放内存等资源，因为请求会立即结束。</p><p id="9f23" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.外部服务可能已关闭。 <br/>它可能会关闭，因为流量太大，或者是一个错误导致 API 失败，或者只是部署过程将其置于维护模式。<br/>使代码异步允许我们成功完成注册，不管第三方发生什么。</p><p id="b53e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.<strong class="is hj">我们可能会陷入不一致的状态。</strong> <br/>如果邮件发送成功，但调用外部服务失败怎么办？<br/>如果我们回滚数据库事务，那么我们注册失败，但是用户将被通知注册成功。<br/>如果我们提交数据库事务，那么外部服务将不会有关于用户的信息。<br/>异步运行代码允许我们成功注册并在以后调用外部服务，那时它将启动并运行。所以我们总是以一致的状态结束。</p></div><div class="ab cl lg lh gp li" role="separator"><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll lm"/><span class="lj bw bk lk ll"/></div><div class="hb hc hd he hf"><h1 id="9e0f" class="kc kd hi bd ke kf ln kh ki kj lo kl km kn lp kp kq kr lq kt ku kv lr kx ky kz bi translated">使流程异步</h1><p id="8731" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">为了使特定的流异步，我们将<em class="lw">处理程序标记为异步。</em></p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><blockquote class="lz ma mb"><p id="cdf0" class="iq ir lw is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated"><em class="hi">您可能熟悉将事件标记为异步。这是孤注一掷的方法。<br/>econtero 允许将处理程序标记为异步。这为开发人员决定应该为给定事件异步运行哪些特定处理程序提供了可能性。</em></p></blockquote><p id="eb94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">批注"<em class="lw"> Asynchronous" </em> <strong class="is hj">使用“asynchronous_messages”消息通道，使特定的处理程序能够异步执行。</strong></p><blockquote class="lz ma mb"><p id="82f5" class="iq ir lw is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated"><em class="hi">消息通道允许抽象出消息传递机制的具体实现，因此您的代码变得与基础设施无关，并且您可以将其切换到不同的代码，而无需触及业务代码。</em></p></blockquote><p id="c46b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要选择异步模块。<br/>在这个特定场景中，我们将使用 RabbitMQ 模块。<br/>跟进安装流程:</p><div class="mf mg ez fb mh mi"><a href="https://docs.ecotone.tech/modules/amqp-support-rabbitmq#installation" rel="noopener  ugc nofollow" target="_blank"><div class="mj ab dw"><div class="mk ab ml cl cj mm"><h2 class="bd hj fi z dy mn ea eb mo ed ef hh bi translated">RabbitMQ 支持</h2><div class="mp l"><h3 class="bd b fi z dy mn ea eb mo ed ef dx translated">我们将我们的 AmqpConnection 注册在类名 Enqueue \ AmqpExt \ AmqpConnectionFactory 下。这将有助于生态交错区…</h3></div><div class="mq l"><p class="bd b fp z dy mn ea eb mo ed ef dx translated">docs . econtero . tech</p></div></div><div class="mr l"><div class="ms l mt mu mv mr mw io mi"/></div></div></a></div><p id="12c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们为 RabbitMQ 注册我们的消息通道。</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><blockquote class="lz ma mb"><p id="9b82" class="iq ir lw is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated"><em class="hi">您可以轻松地切换消息通道的实现，或者为不同的处理程序使用不同的通道。</em></p></blockquote><p id="6c41" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们像发布同步代码一样发布事件。</p><figure class="ls lt lu lv fd ij"><div class="bz dy l di"><div class="lx ly l"/></div></figure><p id="9fe6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在可以运行消费者来处理事件。<br/>消费者自动为我们注册，它将消费来自<strong class="is hj">【异步消息】</strong>消息通道的消息。</p><h1 id="cd2f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">Symfony:</h1><blockquote class="lz ma mb"><p id="9335" class="iq ir lw is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated">bin/控制台交错区:运行 asynchronous_messages -vvv</p></blockquote><h1 id="480b" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">拉勒维尔:</h1><blockquote class="lz ma mb"><p id="23f5" class="iq ir lw is b it iu iv iw ix iy iz ja mc jc jd je md jg jh ji me jk jl jm jn hb bi translated">工匠生态区:运行订单-vvv</p></blockquote><h1 id="3a93" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">摘要</h1><figure class="ls lt lu lv fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c414b65d69e5c065c8a28546e0d73d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DkzgRTgYz-y_UkYDINOFDA.jpeg"/></div></div></figure><p id="3ab5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<em class="lw">生态交错区</em>中，异步编码是非常简单的。这显示了生态交错带的原则之一。你的代码将变得与基础设施无关，因此你可以专注于业务功能并保持代码的整洁。</p><p id="9b3f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于异步处理的知识，你可以阅读文档。</p></div></div>    
</body>
</html>