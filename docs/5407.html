<html>
<head>
<title>Data Filtering in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫中的数据过滤</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/data-filtering-in-pandas-7ecd90d4a81a?source=collection_archive---------2-----------------------#2021-09-28">https://medium.com/nerd-for-tech/data-filtering-in-pandas-7ecd90d4a81a?source=collection_archive---------2-----------------------#2021-09-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a05a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Pandas提供了广泛的数据选择方法，以下是一些您可以选择的方法。</p><ul class=""><li id="d967" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">将条件表达式传递给<code class="du jm jn jo jp b">[]</code>操作。</li><li id="0607" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">使用<code class="du jm jn jo jp b">query()</code>功能。</li><li id="35ce" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">使用<code class="du jm jn jo jp b">eval()</code>功能。</li></ul><p id="c054" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了了解哪种数据过滤方式更优化，我们将创建一个包含大量数据集的样本数据框架，并对其进行检验。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/f46b6b8f50c003946a57e9a85ce72113.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_motb2jIV22Gv84w"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">由<a class="ae kl" href="https://unsplash.com/@delphinenz?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">戴尔芬·杜卡瑞格</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="1734" class="kq kr hi jp b fi ks kt l ku kv">#creating a sample large data set<br/>import numpy as np<br/>import pandas as pd<br/>import timeit<br/>np.random.seed(42)<br/>d = np.random.randint(1, 10, size=(500000, 2))<br/>df = pd.DataFrame(d)<br/>df.columns = ["col1 ", "col2"]</span></pre><p id="4f24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用该数据集进行整个分析<a class="ae kl" href="https://replit.com/join/spkzgwslra-dinirockz93" rel="noopener ugc nofollow" target="_blank"> repo_link </a>，当数据量较小时，您选择哪一个都没关系，但<code class="du jm jn jo jp b">[]</code>操作可能会更快(取决于您选择的系统)。如果数据量大或者过滤条件复杂，就要慎重选择。</p><h1 id="3544" class="kw kr hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated"><strong class="ak">通过</strong>选择数据<code class="du jm jn jo jp b"><strong class="ak">[]</strong></code></h1><p id="97da" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">索引是过滤数据的更简单的方法，我们可以使用pandas索引来划分数据帧的子集。实际上，条件表达式创建了一个布尔序列，我们可以用它来过滤数据帧。</p><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="e965" class="kq kr hi jp b fi ks kt l ku kv"># [] operator<br/>start = timeit.default_timer()<br/>dfTemp = df[(df["col1 "] % 2==0) &amp; (df["col2"] &gt; 5)]<br/>stop = timeit.default_timer()<br/>print("Run time of df[df[(df[\"col1\"] % 2==0) &amp; (df[\"col2\"] &gt; 5)] is {} seconds.".format(stop-start))<br/>#output<br/>Run time of df[df[(df["col1"] % 2==0) &amp; (df["col2"] &gt; 5)] is 0.020918252997944364 seconds.</span></pre><h1 id="a149" class="kw kr hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">通过查询选择数据()</h1><p id="c66f" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated"><strong class="ih hj"> query() </strong>是一种更干净、更容易的过滤行的方法。只需将一个带引号的条件表达式传递给<code class="du jm jn jo jp b">query()</code>。而且，<code class="du jm jn jo jp b">query()</code>支持复杂得多的条件表达式。</p><blockquote class="ly lz ma"><p id="324e" class="if ig mb ih b ii ij ik il im in io ip mc ir is it md iv iw ix me iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">注意</em> </strong> <em class="hi">:这个操作不会改变数据帧的位置。想改就过</em> <code class="du jm jn jo jp b"><em class="hi">inplace=True</em></code> <em class="hi">。</em></p></blockquote><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="f24b" class="kq kr hi jp b fi ks kt l ku kv">#select data by query() operator<br/>start = timeit.default_timer()<br/>dfTemp = df.query("col1 % 2 == 0 &amp; col2 &gt; 5")<br/>stop = timeit.default_timer()<br/>print("Running time of df.query(\"col1 % 2 == 0 &amp; col2 &gt; 5\") is {} seconds.".format(stop-start))</span><span id="4a0b" class="kq kr hi jp b fi mf kt l ku kv">#output<br/>Running time of df.query("col1 % 2 == 0 &amp; col2 &gt; 5") is 0.01401120700073079 seconds.<br/></span></pre><p id="ad0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与[]相比，Query似乎更快，我们能做得更好吗！？</p><h1 id="a668" class="kw kr hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">通过eval()选择数据</h1><p id="9ebf" class="pw-post-body-paragraph if ig hi ih b ii lt ik il im lu io ip iq lv is it iu lw iw ix iy lx ja jb jc hb bi translated">Pandas <code class="du jm jn jo jp b"><strong class="ih hj"> dataframe.eval()</strong></code>函数用于在调用dataframe实例的上下文中计算表达式。表达式在数据帧的列上计算，并根据需要过滤数据。</p><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="c558" class="kq kr hi jp b fi ks kt l ku kv">#select data by eval() operator<br/>start = timeit.default_timer()<br/>dfTemp = df[df.eval('col1 % 2 == 0 &amp; col2 &gt; 5')]<br/>stop = timeit.default_timer()<br/>print("Running time of df[df.eval('col1 % 2 == 0 &amp; col2 &gt; 5')] is {} seconds.".format(stop-start))</span><span id="abc7" class="kq kr hi jp b fi mf kt l ku kv">#output<br/>Running time of df[df.eval('col1 % 2 == 0 &amp; col2 &gt; 5')] is 0.001771175499743549 seconds.<br/></span></pre><blockquote class="ly lz ma"><p id="6e17" class="if ig mb ih b ii ij ik il im in io ip mc ir is it md iv iw ix me iz ja jb jc hb bi translated">当数据很小时，正统的<code class="du jm jn jo jp b"><em class="hi">[]</em></code>运算往往会更快。<code class="du jm jn jo jp b"><em class="hi">query()</em></code>和<code class="du jm jn jo jp b"><em class="hi">eval()</em></code>的优势在于海量的数据集。此外，<code class="du jm jn jo jp b"><em class="hi">eval()</em></code>的语法更加简洁。</p></blockquote><p id="52ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一些受<code class="du jm jn jo jp b">eval</code>支持的条件语句和操作符:</p><ul class=""><li id="e4a8" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">除左移(<code class="du jm jn jo jp b">&lt;&lt;</code>)和右移(<code class="du jm jn jo jp b">&gt;&gt;)</code>运算符)以外的算术运算。</li><li id="61c2" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">比较操作。</li><li id="0a59" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">布尔运算，如<code class="du jm jn jo jp b">df.col1&gt; 5</code>和<code class="du jm jn jo jp b">df.col2 &lt;=10</code></li><li id="1489" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">属性访问，比如<code class="du jm jn jo jp b">df.col1</code>。</li><li id="977b" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">下标表达式，比如<code class="du jm jn jo jp b">df[0]</code>。</li><li id="add9" class="jd je hi ih b ii jq im jr iq js iu jt iy ju jc ji jj jk jl bi translated">数学函数。</li></ul><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="ad5c" class="kq kr hi jp b fi ks kt l ku kv">import math<br/>df[df.eval('math.sin(df.col1)&gt;0')]</span></pre><ul class=""><li id="d5be" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">列表和元组文本。</li></ul><pre class="jw jx jy jz fd km jp kn ko aw kp bi"><span id="710c" class="kq kr hi jp b fi ks kt l ku kv">df[df.eval('df.col1 in ["Sun", "Moon"]')]</span></pre></div><div class="ab cl mg mh gp mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hb hc hd he hf"><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mn"><img src="../Images/1d0591a6a5752e141433883ea6c99c3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YEvp5LhVNqOn_FVR"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx translated">照片由<a class="ae kl" href="https://unsplash.com/@lucabravo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">卢卡·布拉沃</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6813" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">优化我们过滤数据的方式，将是在使用dataframe时研究系统以提高性能的选项之一，优化过滤操作<code class="du jm jn jo jp b">eval(), query(), []</code>并不能保证性能提高，这是一个多变量方程，但这将是一个令人痛苦的变量，值得一试，干杯！</p></div></div>    
</body>
</html>