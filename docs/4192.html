<html>
<head>
<title>Shared API Gateway between multiple services</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">多个服务之间的共享API网关</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/shared-api-gateway-between-multiple-services-719e66a84415?source=collection_archive---------8-----------------------#2021-07-10">https://medium.com/nerd-for-tech/shared-api-gateway-between-multiple-services-719e66a84415?source=collection_archive---------8-----------------------#2021-07-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/499d41934d8f1438a2c215e3815df682.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kvMGKoESkDQQQ9FP.png"/></div></div></figure><p id="c425" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，让我们看看如何在多个服务之间共享一个AWS API网关。</p><p id="a2a5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> TechStack </strong> : AWS API Gateway，AWS Lambda，无服务器框架，JavaScript</p><p id="be94" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">先决条件</strong>:</p><ul class=""><li id="21a7" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">本地安装和配置的AWS:<a class="ae jx" href="https://docs.aws.amazon.com/sdk-for-java/v1/developer-guide/setup-credentials.html" rel="noopener ugc nofollow" target="_blank">指南</a></li><li id="e05e" class="jo jp hi is b it jy ix jz jb ka jf kb jj kc jn jt ju jv jw bi translated">全球安装无服务器:<a class="ae jx" href="https://www.serverless.com/framework/docs/providers/aws/guide/installation/" rel="noopener ugc nofollow" target="_blank">指南</a></li></ul><p id="1b1a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设您已经在本地机器上完成了上述设置，让我们开始吧。</p><p id="abcf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">创建根API网关</strong></p><p id="572c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续创建一个你选择的单独的目录，我们称之为，<code class="du kd ke kf kg b">rest-api-root</code>然后<code class="du kd ke kf kg b">cd</code>到创建的目录中，然后创建下面的文件，</p><p id="13cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，为主lambda创建一个简单的处理程序，如下所示，</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="358e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在创建下面的serverless.yml配置</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="4920" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经完成了无服务器配置和根API的基本处理程序，让我们开始部署吧。</p><p id="f3dd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为您已经全局安装了无服务器，所以您可以运行下面的命令来部署这个简单的服务。</p><p id="9a24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kd ke kf kg b">sls deploy -v</code></p><p id="5c87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦命令执行完毕，它应该已经在幕后提供了必要的资源，并最终公开了一个API网关端点URL，如下所示，</p><p id="5f5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kd ke kf kg b"><a class="ae jx" href="https://qugc3gxwi8.execute-api.us-east-1.amazonaws.com/dev/" rel="noopener ugc nofollow" target="_blank">https://{SOME-ID}.execute-api.us-east-1.amazonaws.com/dev/</a></code></p><p id="c1b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您访问这个URL，您将能够看到如下所示的输出，</p><p id="1308" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kd ke kf kg b"><strong class="is hj">{</strong>"message": "Go Serverless!"<strong class="is hj">}</strong></code></p><p id="2845" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经用一个简单的服务创建了根API网关，让我们继续创建另一个Lambda服务，它将共享上面提供的相同API网关。</p><p id="c711" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">创建一个共享上述API网关的子服务</strong></p><p id="16b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du kd ke kf kg b">rest-api-root</code>之外单独创建一个目录，称之为<code class="du kd ke kf kg b">lambda-service1</code>。</p><p id="acf4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du kd ke kf kg b">lambda-service1</code>目录中，创建以下文件。</p><p id="7775" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为该服务创建处理程序，</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="1b44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，在我们创建serverless.yml配置文件之前，我们需要知道两件事，</p><p id="8cde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.API网关ID</p><p id="9351" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.API网关根资源ID</p><p id="aa79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">以上两种可以使用AWS控制台找到，一旦你登录到控制台，访问AWS API网关</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/a94956ee610cd03c0bd8b14b3cc98eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2CFFvZYgJ7VSYugN.png"/></div></div></figure><p id="0ee3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">正如你在上面的截图中看到的，你需要获取这两个id，并把它们放在下面的Lambda服务的无服务器配置中。</p><figure class="kh ki kj kk fd ij"><div class="bz dy l di"><div class="kl km l"/></div></figure><p id="b158" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦这也完成了，现在我们可以部署我们的第二个lambda服务，它将使用我们之前创建的相同的API网关。</p><p id="02a2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kd ke kf kg b">sls deploy -v</code></p><p id="4c92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">*重要:请注意，一旦部署完毕，您将看到生成的端点输出将在URL的末尾包含<code class="du kd ke kf kg b">/hello</code>,因为我们已经为这个lambda服务定义了一个新的方法路由。</p><p id="2f3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du kd ke kf kg b">events: </code>T5<code class="du kd ke kf kg b">- http: </code>T6<code class="du kd ke kf kg b">path: /hello</code></p><p id="f213" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果您在控制台上转到API Gateway，您会注意到它已经在同一个网关上创建了一个新路径来映射新的lambda服务，如下所示，</p><figure class="kh ki kj kk fd ij er es paragraph-image"><div class="er es ko"><img src="../Images/dd1c202c1f39ac5a2b937e3dbd454182.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/0*gmMcwA1zH5sB5xmr.png"/></div></figure><p id="b657" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您将能够适当地扩展这个解决方案，以支持可以使用一个根API网关的多个服务。这使得管理变得更加容易和简单。</p></div><div class="ab cl kp kq gp kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hb hc hd he hf"><p id="0457" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kw">原载于2021年7月10日https://dilushagonagala.com</em><em class="kw"/><a class="ae jx" href="https://dilushagonagala.com/share-api-gateway-between-multiple-services/" rel="noopener ugc nofollow" target="_blank"><em class="kw">。</em></a></p></div></div>    
</body>
</html>