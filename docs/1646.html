<html>
<head>
<title>Express Js, How to beautify and Readable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快递 Js，如何美化可读性</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/express-js-how-to-beautify-and-readable-ad87228cbc14?source=collection_archive---------4-----------------------#2021-03-30">https://medium.com/nerd-for-tech/express-js-how-to-beautify-and-readable-ad87228cbc14?source=collection_archive---------4-----------------------#2021-03-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9b79d2edd724b65f3d1325bc65d1f84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qydQYIlXu2FfnHXDrGa69g.jpeg"/></div></div></figure><h1 id="089c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是<strong class="ak">故事</strong></h1><p id="89b5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">4 年前我开始开发 NodeJs。起初，我正在处理一些紧急项目，我被迫尽快完成它们，我没有足够的时间为我的项目创建任何好的结构。</p><p id="e735" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">过了一会儿，我坚持我的<a class="ae kr" href="https://en.wikipedia.org/wiki/Spaghetti_code" rel="noopener ugc nofollow" target="_blank">意大利面条代码</a>和<strong class="jq hj">我学会了如果我有 10 分钟砍所有的树，磨利我的斧头 9 分钟，和 1 分钟砍所有的树。</strong>而现在我想分享我避免意大利面代码的经验，分享我的代码结构。</p><h2 id="b6be" class="ks ir hi bd is kt ku kv iw kw kx ky ja jz kz la je kd lb lc ji kh ld le jm lf bi translated">第一步——决定框架。</h2><p id="5da5" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi lg translated">不要忘记使用一个框架，正确地选择它。如果你打算创建一个处理端点的大型应用程序，我推荐使用类似于<a class="ae kr" href="https://nestjs.com" rel="noopener ugc nofollow" target="_blank"> NestJS </a> ( <strong class="jq hj">不要忘记，如果是一个大型应用程序</strong>)的类型脚本，或者如果你想处理一些东西或者你的应用程序不太大，使用类似于<a class="ae kr" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> ExpressJS </a>的类型脚本。我的大多数项目都是 MVP，所以，在这里我们将继续 ExpressJs。</p><h2 id="6572" class="ks ir hi bd is kt ku kv iw kw kx ky ja jz kz la je kd lb lc ji kh ld le jm lf bi translated">安装 Express。</h2><p id="7102" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我看到很多次，开发者安装了 ExpressJs 他们就直接开始写服务器代码。但是我强烈推荐你，用<a class="ae kr" href="https://expressjs.com/en/starter/generator.html" rel="noopener ugc nofollow" target="_blank"> Express CLI </a>。然后你可以在 5 秒钟内开始你的代码。</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="7120" class="ks ir hi lu b fi ly lz l ma mb">mkdir test-project<br/>cd test-project<br/>express</span></pre><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/271798fcfaeeb62d2b790be5ea17fa40.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*gRVN12ngqmreUnxe_Xq94A.png"/></div></figure><p id="90e3" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">如果你打开你的代码，你会看到类似这样的内容。这是 ExpressJs 框架的基本结构。但是我想改成我的风格。像我一样，如果你不想要任何 UI，那么移除<strong class="jq hj"> public </strong>和<strong class="jq hj"> views </strong>文件夹来清理你的结构。</p><p id="0cec" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">让我们来看看项目框架。在 bin 文件夹中有一个名为<strong class="jq hj"> www </strong>的文件。这是一个包含运行<strong class="jq hj">服务器</strong>所有代码的文件。我认为你现在不需要改变这个文件中的任何东西。<strong class="jq hj">路线</strong>文件夹包含在所有路线配置中。有两个默认的 index.js 和 users.js，你的<strong class="jq hj">主代码</strong>是进入<strong class="jq hj"> app.js </strong></p><h1 id="705e" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">提高技术能力</h1><p id="41ab" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">首先，我更喜欢创建一些文件夹，<strong class="jq hj">服务</strong>，<strong class="jq hj">资产</strong>，<strong class="jq hj">模型</strong>，<strong class="jq hj">测试</strong>和<strong class="jq hj">助手</strong>。</p><ul class=""><li id="94cb" class="md me hi jq b jr km jv kn jz mf kd mg kh mh kl mi mj mk ml bi translated"><strong class="jq hj">资产</strong>包括密钥、配置文件等资产文件。</li><li id="a973" class="md me hi jq b jr mm jv mn jz mo kd mp kh mq kl mi mj mk ml bi translated"><strong class="jq hj">助手</strong>包含在日志管理或中间件等实用程序文件中</li><li id="9b49" class="md me hi jq b jr mm jv mn jz mo kd mp kh mq kl mi mj mk ml bi translated"><strong class="jq hj">模型是</strong>数据库中包含的模型文件</li><li id="a754" class="md me hi jq b jr mm jv mn jz mo kd mp kh mq kl mi mj mk ml bi translated"><strong class="jq hj">服务</strong>包含在业务层中，将您的路线连接到您的逻辑和模型</li><li id="acc5" class="md me hi jq b jr mm jv mn jz mo kd mp kh mq kl mi mj mk ml bi translated"><strong class="jq hj">测试</strong>包含在所有测试文件中</li></ul><p id="f3f4" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">此外，我在每个项目中都有一个文件，我称之为 di.js，用于管理我的数据库。最后，你会得到这样的东西:</p><figure class="lp lq lr ls fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/0db3cde4a967aa80081075530cd091af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/format:webp/1*4AkgsTvkWoALRdaTFp7XiQ.png"/></div><figcaption class="ms mt et er es mu mv bd b be z dx translated">我的项目框架</figcaption></figure><h1 id="dc63" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">命名文件</h1><p id="1354" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">为了轻松找到你的文件，我总是根据文件夹名来设置它们的名称。例如，如果我想为计算定义一个新的服务，我将它命名为 calculation.service.js，或者对于路由，我使用 users.route.js。因此，我在项目的第一个位置将所有路由文件重命名，将 index.js 重命名为<strong class="jq hj"> index.route.js </strong>，将 users.js 重命名为<strong class="jq hj"> users.route.js </strong>。我还应该在<strong class="jq hj"> app.js </strong>中更改路线名称</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="d078" class="ks ir hi lu b fi ly lz l ma mb">var indexRouter = require('./routes/index.route');<br/>var usersRouter = require('./routes/users.route');</span></pre><p id="9f49" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">另外，如果你想了解更多关于骷髅的知识，我推荐你看这个视频</p><figure class="lp lq lr ls fd ij"><div class="bz dy l di"><div class="mw mx l"/></div></figure><h1 id="d0ad" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是 DI.js 文件</h1><p id="f525" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">假设您在一个项目中使用 Redis、Postgres 和其他一些数据库。所以我们不能在每个服务文件中定义 Redis 连接。为了解决这个问题，我决定创建自己的 DI(依赖注入)。</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="d094" class="ks ir hi lu b fi ly lz l ma mb"><strong class="lu hj">const</strong> Sequelize = <strong class="lu hj">require</strong>('sequelize');<br/><strong class="lu hj">const</strong> Redis = <strong class="lu hj">require</strong>("async-redis");<br/><strong class="lu hj">class</strong> di{<br/>   config = {};<br/>   <strong class="lu hj">constructor</strong>(_config){<br/>      <strong class="lu hj">this</strong>.config = _config;<br/>      <strong class="lu hj">this</strong>.postgres = <strong class="lu hj">null</strong>;<br/>      <strong class="lu hj">this</strong>.redis = <strong class="lu hj">null</strong>;<br/>   }<br/>   <strong class="lu hj">async</strong> connectToPostgres(){<br/>   <strong class="lu hj">const</strong> config = <strong class="lu hj">this</strong>.config;<br/>   <strong class="lu hj">this</strong>.postgres = <strong class="lu hj">new </strong>Sequelize(`postgres://${config.postgres.username}:${config.postgres.password}@${config.postgres.host}:${config.postgres.port}/${config.postgres.db_name}`, {logging: <strong class="lu hj">false</strong>});</span><span id="b999" class="ks ir hi lu b fi my lz l ma mb"><strong class="lu hj">   try</strong> {<br/>      <strong class="lu hj">await</strong> <strong class="lu hj">this</strong>.postgres.authenticate();<br/>      console.log('Connection to postgres has been established      successfully.');<br/>   } <strong class="lu hj">catch</strong> (error) {<br/>   console.error('Unable to connect to the database:', error);<br/>   }<br/>}</span><span id="5f5b" class="ks ir hi lu b fi my lz l ma mb"><strong class="lu hj">   async</strong> connectToRedis(){<br/>   <strong class="lu hj">const</strong> config = <strong class="lu hj">this</strong>.config;<br/>   <strong class="lu hj">this</strong>.redis = Redis.createClient(config.redis);<br/>   }<br/>}</span><span id="247f" class="ks ir hi lu b fi my lz l ma mb"><strong class="lu hj">const</strong> setting = <strong class="lu hj">require</strong>("./assets/setting");<br/><strong class="lu hj">const</strong> DI = <strong class="lu hj">new</strong> di(setting.test.database);</span><span id="d11c" class="ks ir hi lu b fi my lz l ma mb"><strong class="lu hj">module</strong>.exports = DI;</span></pre><p id="941d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">为了初始化 DI，我们应该在 app.js 中加载这个类</p><pre class="lp lq lr ls fd lt lu lv lw aw lx bi"><span id="e0c2" class="ks ir hi lu b fi ly lz l ma mb"><strong class="lu hj">const</strong> di = <strong class="lu hj">require</strong>("./di");<br/>di.connectToPostgres();<br/>di.connectToRedis();</span></pre><p id="4070" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">在下一课中，我将解释如何实现一个日志系统。<br/>别忘了提出你的问题，请随时在这里写下你的评论。</p><p id="565d" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">在 Youtube 和 Instagram 上关注</strong>我，获取<strong class="jq hj">更新</strong></p><p id="d643" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><a class="ae kr" href="https://cutt.ly/Nx81N4C" rel="noopener ugc nofollow" target="_blank"> Youtube 频道</a> <br/> <a class="ae kr" href="https://cutt.ly/1x80uXx" rel="noopener ugc nofollow" target="_blank"> Instagram </a></p></div></div>    
</body>
</html>