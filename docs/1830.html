<html>
<head>
<title>The Data Structures Underneath Relational Databases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">关系数据库下的数据结构</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/the-data-structures-underneath-relational-databases-9950797a88ac?source=collection_archive---------13-----------------------#2021-04-09">https://medium.com/nerd-for-tech/the-data-structures-underneath-relational-databases-9950797a88ac?source=collection_archive---------13-----------------------#2021-04-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if"><p id="ee83" class="ig ih hi bd ii ij ik il im in io ip dx translated">“我们是抽象思维的受害者，以至于当地球陷入火海时，我们几乎没有勇气穿过房间去看恒温器。”<br/>——特伦斯·麦肯纳</p></blockquote><h1 id="75e2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">关系数据库魔术</h1><p id="9861" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">Python是建立在CPython之上的，而CPython又是建立在c之上的。JavaScript中的所有东西都是一个散列表对象。这些是我们知道、接受甚至理解的常见抽象概念。关系数据库中的抽象又如何呢？MySQL、PostgreSQL和SQLite等关系数据库是开发人员日常依赖的数据模型。然而，这些开发人员中有多少人能够解释他们工具的内部工作原理？不要害怕！本指南旨在将您的关系数据库知识提升到Chad的水平。</p><h1 id="65da" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">它从一棵树开始</h1><p id="c5e4" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">我们旅途中的第一条路将我们引向一棵神秘的m-ary树。虽然这棵树看起来乌云密布，但它与计算机科学中通常教授的二叉树没有太大区别。一棵m元树是一棵有根的树，其中每个节点不超过m个孩子。让我们来分析一下。一棵有根的树仅仅意味着它是一棵有根的树，与一棵看起来更像一个没有圈的图的无根自由树相反。这是你常见的树。每个节点不超过m个子节点。二叉树和三叉树都是m叉树的类型。二叉树是m元树，其中m=2。三元树是m元树，其中m=3。m元树的唯一区别是每个节点最多可以有m个子节点。你可以简单地把一棵m叉树想象成一棵有很多孩子的二叉树。就是这样。神秘感被驱散了。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es ko"><img src="../Images/3befc467bc17349e90ca632678c42ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*Pvb4m4fjj67djWkjWqxAGw.jpeg"/></div><figcaption class="kw kx et er es ky kz bd b be z dx translated">m元树示例</figcaption></figure><h1 id="1bf5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">蜜蜂之树</h1><p id="ca41" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">我们爬上m叉树的许多节点，向外眺望地平线。我们看到一棵看起来与我们所知道的m元相似的树，但它并不相同。这种树被称为B树(“蜜蜂树”)。B树是一种m元树数据结构，它是自平衡的，并以排序的升序在其节点中存储关键字。每个键有两个对两个子节点的引用。左侧子节点键小于当前键。右侧子节点键大于当前键。一个节点可以有n个键。子节点的最大数量是n-1\B树遵守的奇怪规则允许它有O(log n)的搜索、插入和删除时间复杂度。恭喜你。如果您已经了解到这一步，那么您应该了解数据库使用的基本结构。从现在开始，我们将简单地扩展这些概念。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/9c8b214983ad7cba5e12131612d04aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sUP7cf97DIV7kuuddIE0qA.jpeg"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx translated">b树示例</figcaption></figure><pre class="kp kq kr ks fd lf lg lh li aw lj bi"><span id="d380" class="lk ir hi lg b fi ll lm l ln lo">| Type           | Insert   | Delete   | Search   |<br/>| -------------- | -------- | -------- | -------- |<br/>| Unsorted Array | O(1)     | O(n)     | O(n)     |<br/>| Sorted Array   | O(n)     | O(n)     | O(log n) |<br/>| B-Tree         | O(log n) | O(log n) | O(log n) |<br/>| B+Tree*        | O(log n) | O(log n) | O(log n) |</span></pre><p id="4099" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><em class="lu">注意:B+树对于插入和删除的最坏情况时间复杂度为O(M*log n + log L)，对于搜索的最坏情况时间复杂度为O(log n + log L)。</em></p><h1 id="3410" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">知识在树叶里</h1><p id="11d8" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">有一棵树看起来和B树一模一样，只有一个小的区别。它只在其叶节点上存储数据。这种特殊的树被称为B+树(“蜜蜂+树”)。在B+树中，所有非叶节点都被复制为叶节点。B+树拥有的另一个重要属性是指针。您可以遍历叶节点中的所有值，因为每个叶节点都有一个指向下一个叶节点的指针。这棵树就是我们想到数据库时想到的树。我们如何存储已知记录中的键值对呢？对于给定的记录，行中的数据被转换为字节流。现在我们有两个部分，主键和字节流。这两部分合在一起称为有效载荷。有效载荷是存储在B+树的叶子中的数据。</p><pre class="kp kq kr ks fd lf lg lh li aw lj bi"><span id="7f63" class="lk ir hi lg b fi ll lm l ln lo">SELECT * FROM User WHERE id = 0;</span></pre><p id="015e" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated">对于非叶节点，主键用作索引数据的键。这样，我们可以从树根开始对树进行二分搜索法，或者通过遍历树叶进行线性搜索。在上面的代码片段中，我们将使用id(“主键”)搜索B+树，以找到与id相关联的记录。</p><figure class="kp kq kr ks fd kt er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lv"><img src="../Images/fcab60643387232de61646aa80937358.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-E07mhLIv0B7OQ41vTj-6Q.jpeg"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx translated">数据库中的b+树</figcaption></figure><figure class="kp kq kr ks fd kt er es paragraph-image"><div class="er es lw"><img src="../Images/36d6e6473e5d189e7e476f763fc5ee76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*jKYUwVbeJMprwnFDHYjKyw.jpeg"/></div><figcaption class="kw kx et er es ky kz bd b be z dx translated">数据库中的b树</figcaption></figure><h1 id="0567" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">最后的工具</h1><p id="9a4a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">你学得很好。我们现在知道了数据库是如何工作的，以及如何通过主键获取记录，但是如果我们没有id呢？让我们看看下面的查询。</p><pre class="kp kq kr ks fd lf lg lh li aw lj bi"><span id="9eea" class="lk ir hi lg b fi ll lm l ln lo">SELECT * FROM User WHERE username = 'testuser';</span></pre><p id="31be" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated">为了理解这个查询的内部工作原理，我们需要使用到目前为止我们所学的所有神圣树知识，并结合一个工具:页面。页面解决了如何物理存储数据的重要问题。在深入研究之前，先退一步，我们需要理解每个SQL数据库都有两个操作系统文件:一个数据文件和一个日志文件。出于此目的，我们关心数据文件。数据文件可以分为两类:主要数据和次要数据。主数据包含启动信息以及所有实际的数据库数据。不需要辅助数据。它使用索引来允许跨许多文件甚至不同的磁盘存储和检索数据。而是作为一个整体返回到数据文件。数据文件被分成页面。像原子一样，页面是数据库的基本构件。它们的大小是固定的，具有可以引用的唯一数字标识符，并且包含重要的元数据。B树和B+树中的每个节点都存储在页面中。</p><h1 id="040c" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">树大师的崛起</h1><p id="22ca" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">b树用于存储索引。b+树用于存储表。现在在我们心中的知识是提升到树木大师的水平。当我们执行类似上面的选择查询时，我们看到我们需要“用户名”等于“测试用户”。数据库将定位与用户名相关联的适当的B树。它将在树中搜索匹配“testuser”的用户名，并使用“testuser”找到0的索引(“主键”)。一旦知道了主键，数据库将搜索B+树并找到具有相同主键的节点。它将返回主键和字节流。它会将字节流转换回人类可读的文字，查询就完成了。</p><h1 id="5484" class="iq ir hi bd is it iu iv iw ix iy iz ja jb kl jd je jf km jh ji jj kn jl jm jn bi translated">愿树木与你同在</h1><p id="962e" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated">现在，我授予你树木大师的头衔。这个旅程已经结束了，但是我希望有了这些新知识，你可以更完整地了解这个世界。我们从M元树开始，上升到B元树，征服了B+树，并把所有这些放在一起理解关系数据库是如何工作的。愿树木与你同在。</p><h2 id="3b0b" class="lk ir hi bd is lx ly lz iw ma mb mc ja jz md me je kd mf mg ji kh mh mi jm mj bi translated">来源</h2><p id="01c3" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ip hb bi translated"><a class="ae mk" rel="noopener" href="/@shashankbaravani/database-storage-engines-under-the-hood-705418dc0e35">幕后的数据库存储引擎</a></p><p id="8cfc" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><a class="ae mk" href="https://hub.packtpub.com/how-sql-server-handles-data-under-the-hood/" rel="noopener ugc nofollow" target="_blank">SQL Server如何在幕后处理数据</a></p><p id="ffd8" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><a class="ae mk" href="https://en.wikipedia.org/wiki/B%2B_tree B+ tree https://towardsdatascience.com/how-b-tree-indexes-are-built-in-a-database-6f847fb3cfcc?gi=fc3b3159bbf4" rel="noopener ugc nofollow" target="_blank">B+树索引是如何在数据库中建立的？</a></p><p id="b561" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><a class="ae mk" href="https://cstack.github.io/db_tutorial/ Let's Build a Simple Database https://dzone.com/articles/database-btree-indexing-in-sqlite" rel="noopener ugc nofollow" target="_blank">数据库B树索引的工作原理</a></p><p id="bc4c" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><a class="ae mk" rel="noopener" href="/basecs/busying-oneself-with-b-trees-78bbf10522e7">忙于B树</a></p><p id="b616" class="pw-post-body-paragraph jo jp hi jq b jr lp jt ju jv lq jx jy jz lr kb kc kd ls kf kg kh lt kj kk ip hb bi translated"><a class="ae mk" href="https://www.mssqltips.com/sqlservertip/4345/understanding-how-sql-server-stores-data-in-data-files/" rel="noopener ugc nofollow" target="_blank">了解SQL Server如何在数据文件中存储数据</a></p></div></div>    
</body>
</html>