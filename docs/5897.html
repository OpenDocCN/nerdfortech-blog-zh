<html>
<head>
<title>From Zero to Hero Django Admin: Advanced-Level ModelAdmin Class-1 (Part3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从零到英雄姜戈管理员:高级模型管理员1级(第三部分)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/from-zero-to-hero-django-admin-advanced-level-modeladmin-class-1-part3-b4a9c4a21cc2?source=collection_archive---------0-----------------------#2021-12-02">https://medium.com/nerd-for-tech/from-zero-to-hero-django-admin-advanced-level-modeladmin-class-1-part3-b4a9c4a21cc2?source=collection_archive---------0-----------------------#2021-12-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="1d4d" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">日期层次结构，管理操作，字段，字段集</h2></div><p id="fa94" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经在上一个故事的<a class="ae jx" rel="noopener" href="/nerd-for-tech/from-zero-to-hero-django-admin-modeladmin-class-part2-2c8665d6cd5">中潜入了<code class="du jt ju jv jw b">ModelAdmin</code>类。在这个故事中，我们将继续尝试学习高级<code class="du jt ju jv jw b">ModelAdmin</code>类的功能。还有，你可以从下面得到这个故事的源代码。因此，在这个系列中，我们将致力于同一个项目。</a></p><div class="jy jz ez fb ka kb"><a href="https://github.com/mebaysan/DjangoAdminForMedium" rel="noopener  ugc nofollow" target="_blank"><div class="kc ab dw"><div class="kd ab ke cl cj kf"><h2 class="bd hj fi z dy kg ea eb kh ed ef hh bi translated">GitHub-mebaysan/djangodadminformedium:为中型Django管理博客系列创建</h2><div class="ki l"><h3 class="bd b fi z dy kg ea eb kh ed ef dx translated">我开始准备这个repo来解释我们如何在Django中定制管理应用程序。本次回购依赖于一个媒介…</h3></div><div class="kj l"><p class="bd b fp z dy kg ea eb kh ed ef dx translated">github.com</p></div></div><div class="kk l"><div class="kl l km kn ko kk kp kq kb"/></div></div></a></div><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/621589dae0758c3f0ab73e538a132334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o22fbIZ82oppUXc8jHfeDQ.jpeg"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated"><a class="ae jx" href="https://unsplash.com/@faisaldada?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Faisal </a>在<a class="ae jx" href="https://unsplash.com/@faisaldada?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="1952" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated">介绍</h1><p id="89f3" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">在本节中，我将向您介绍我们将要做的事情。</p><ul class=""><li id="68e5" class="md me hi iz b ja jb jd je jg mf jk mg jo mh js mi mj mk ml bi translated">扩展<code class="du jt ju jv jw b">ModelAdmin</code>类</li><li id="5edd" class="md me hi iz b ja mm jd mn jg mo jk mp jo mq js mi mj mk ml bi translated">向<code class="du jt ju jv jw b">ModelAdmin</code>类添加管理动作</li><li id="f669" class="md me hi iz b ja mm jd mn jg mo jk mp jo mq js mi mj mk ml bi translated">在管理类中编辑<code class="du jt ju jv jw b">date_hierarchy</code></li><li id="7a1a" class="md me hi iz b ja mm jd mn jg mo jk mp jo mq js mi mj mk ml bi translated">编辑<code class="du jt ju jv jw b">ModelAdmin</code>类中的字段和字段集</li></ul><h1 id="d6cc" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated">扩展模型管理</h1><p id="7464" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">首先，我将从<code class="du jt ju jv jw b">date_hierarchy</code>开始。然后，我将继续向类中添加动作。</p><h2 id="7470" class="mr lh hi bd li ms mt mu lm mv mw mx lq jg my mz ls jk na nb lu jo nc nd lw ne bi translated">日期层次结构</h2><p id="1b6f" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">我们可以使用这个属性逐月拆分数据。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="5469" class="mr lh hi jw b fi nj nk l nl nm">class BlogAdmin(admin.ModelAdmin):<br/>   ...<br/>   date_hierarchy = 'updated_date'</span></pre><p id="4803" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以在搜索栏下看到拆分的月份。九月、十一月等。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nn"><img src="../Images/872b3feb78f3d78d1d0a81a3c378240b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AHeip-c7P4TYLpohNOkhA.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><h2 id="b050" class="mr lh hi bd li ms mt mu lm mv mw mx lq jg my mz ls jk na nb lu jo nc nd lw ne bi translated">添加管理操作</h2><p id="fb48" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">首先，我想从解释“什么是模型管理动作”开始。我们可以说，在进行批处理时，动作可以帮助我们。当然，我们可以用它们来做特定的工作。例如，给未发表的博客作者发电子邮件，等等。在本例中，我们将使用它们对表中选定的对象执行函数。</p><p id="79eb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们有一个默认的Django动作。我们可以使用这个默认操作从数据库中删除对象。操作出现在操作下拉列表中。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nn"><img src="../Images/f4106639167d7c92d25ca472524d4338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6cdBNA9MpBC9YJTNLFbpqA.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><ul class=""><li id="e228" class="md me hi iz b ja jb jd je jg mf jk mg jo mh js mi mj mk ml bi translated">我们使用ModelAdmin类的<code class="du jt ju jv jw b">actions</code>属性来添加动作函数。</li><li id="8de5" class="md me hi iz b ja mm jd mn jg mo jk mp jo mq js mi mj mk ml bi translated">我们编写一个带有3个参数的函数:<code class="du jt ju jv jw b">self</code>、<code class="du jt ju jv jw b">request</code>、<code class="du jt ju jv jw b">queryset</code></li><li id="fe75" class="md me hi iz b ja mm jd mn jg mo jk mp jo mq js mi mj mk ml bi translated">我们可以通过使用它的<code class="du jt ju jv jw b">short_description</code>属性来改变函数的显示名称。</li></ul><p id="0509" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我要写一个函数:<code class="du jt ju jv jw b">make_published</code></p><p id="2678" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过使用该功能来发布选定的文章。执行该函数后，我们将在管理页面上显示一条消息。为了显示消息，我们使用ModelAdmin类的<code class="du jt ju jv jw b">message_user</code>属性。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="834e" class="mr lh hi jw b fi nj nk l nl nm">def make_published(self, request, queryset):<br/>   count = queryset.update(is_published=True)<br/>   self.message_user(request, f"{count} objects changed")</span><span id="9d1f" class="mr lh hi jw b fi no nk l nl nm">make_published.short_description = 'Publish The Selected Blogs'</span></pre><p id="8973" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在我需要将这个函数注册到ModelAdmin类中。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="4c69" class="mr lh hi jw b fi nj nk l nl nm">class BlogAdmin(admin.ModelAdmin):<br/>   ...<br/>   actions = ('make_published',)</span></pre><p id="6e53" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我会把前两个博客列在名单上。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es np"><img src="../Images/95baaf53041badb2698844b5a8e5af2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irSSbBh4Vhxzi5HjsuGpSw.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><p id="b9d2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，我们可以添加一些功能来导出选定的数据等。</p><h2 id="11f2" class="mr lh hi bd li ms mt mu lm mv mw mx lq jg my mz ls jk na nb lu jo nc nd lw ne bi translated">田地（复数）；场；域；字段</h2><p id="3c32" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">我们可以使用这个属性对对象的详细页面中的表单元素进行重新排序(实际上是<code class="du jt ju jv jw b">change_form.html</code>，但是我们稍后将进一步讨论它)。</p><p id="95de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，当您转到一个详细页面时，您会看到如下所示的内容。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es np"><img src="../Images/9cc7682bfe7f27b5a7600d94ac256c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e2Ott4DrrgL8_tk2CIAQng.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><p id="a47b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们想改变表单元素的位置，我们需要在ModelAdmin类中使用<code class="du jt ju jv jw b">fields</code>。</p><p id="d8de" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将把下面的代码添加到ModelAdmin类中。至此，我们使用<code class="du jt ju jv jw b">list</code>来设置ModelAdmin的属性。实际上，在Django的官方文档中，他们建议使用<code class="du jt ju jv jw b">tuple</code>来设置属性。我们将使用<code class="du jt ju jv jw b">tuple</code>来设置<code class="du jt ju jv jw b">fields</code>。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="ee9c" class="mr lh hi jw b fi nj nk l nl nm">class BlogAdmin(admin.ModelAdmin):<br/>   ...<br/>   fields = (<br/>      ('added_date','updated_date'),<br/>      ('title','slug'),<br/>      'content'<br/>      )</span></pre><p id="5f1a" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一个<code class="du jt ju jv jw b">tuple</code>中的每个<code class="du jt ju jv jw b">tuple</code>，代表一行。比如我们把<code class="du jt ju jv jw b">added_date</code>和<code class="du jt ju jv jw b">updated_date</code>放在同一行。因此，我们更改了对象的详细页面的表单结构。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es np"><img src="../Images/6678fcfab00dd0393514b33b9a822be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qYI0DUmDUhItseyYLGJLQA.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><h2 id="a181" class="mr lh hi bd li ms mt mu lm mv mw mx lq jg my mz ls jk na nb lu jo nc nd lw ne bi translated">字段集</h2><p id="3964" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">我们可以通过设置<code class="du jt ju jv jw b">fieldsets</code>向表单添加更多的规范。记住，我们不能同时使用<code class="du jt ju jv jw b">fields</code>和<code class="du jt ju jv jw b">fieldsets</code>。</p><p id="5d65" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">字段集的结构如下。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="a4c5" class="mr lh hi jw b fi nj nk l nl nm">( # wrapping tuple<br/>   # Set 1 (tuple)<br/>   ('Set1 Title', {<br/>      'fields': (('row1_item1', 'row1_item2'), 'row2_item1'),<br/>      'description': 'Set1 description'<br/>      }<br/>   ),<br/>   # Set 2 (tuple)<br/>   ('Set2 Title', {<br/>      'fields': (('row1_item1', 'row1_item2'), 'row2_item1'),<br/>      'description': 'Set2 description'<br/>      }<br/>   )<br/>)</span></pre><p id="c9d1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将向ModelAdmin类添加一个字段集。</p><pre class="ks kt ku kv fd nf jw ng nh aw ni bi"><span id="6a79" class="mr lh hi jw b fi nj nk l nl nm">class BlogAdmin(admin.ModelAdmin):<br/>   ...<br/>   fieldsets = (</span><span id="a3a0" class="mr lh hi jw b fi no nk l nl nm">(None, {'fields':(('added_date','updated_date'),), 'description':'Time Information'}),</span><span id="7323" class="mr lh hi jw b fi no nk l nl nm">('Must Properties', {'fields':('title','content'), 'description':'The object has to have these attributes'}),</span><span id="909d" class="mr lh hi jw b fi no nk l nl nm">('Nice to Have Properties', {'fields':(('slug','is_published'),), 'description':'If the object hasn\'t these attributes, they will be automatically generated'})</span><span id="1c53" class="mr lh hi jw b fi no nk l nl nm">)</span></pre><p id="ff24" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">恭喜你。我们改变了形式。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es np"><img src="../Images/20917a1897b5246fc2cc1fd5fa511427.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BgsbNc5lHihEeKj79lohfw.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx translated">作者图片</figcaption></figure><h1 id="36ae" class="lg lh hi bd li lj lk ll lm ln lo lp lq io lr ip ls ir lt is lu iu lv iv lw lx bi translated">最后</h1><p id="bf33" class="pw-post-body-paragraph ix iy hi iz b ja ly ij jc jd lz im jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">在这个故事中，我们深入探讨了高级<code class="du jt ju jv jw b">ModelAdmin</code>职业的属性。希望这是有帮助的，你喜欢它。我喜欢写&amp;代码。你可以从下面得到代码。我将回购协议一章一章地拆分，然后为每一章创建一个分支。</p><div class="jy jz ez fb ka kb"><a href="https://github.com/mebaysan/DjangoAdminForMedium/tree/chapter3" rel="noopener  ugc nofollow" target="_blank"><div class="kc ab dw"><div class="kd ab ke cl cj kf"><h2 class="bd hj fi z dy kg ea eb kh ed ef hh bi translated">第三章GitHub-mebaysan/djangodadminformedium</h2><div class="ki l"><h3 class="bd b fi z dy kg ea eb kh ed ef dx translated">我开始准备这个repo来解释我们如何在Django中定制管理应用程序。本次回购依赖于一个媒介…</h3></div><div class="kj l"><p class="bd b fp z dy kg ea eb kh ed ef dx translated">github.com</p></div></div><div class="kk l"><div class="nq l km kn ko kk kp kq kb"/></div></div></a></div><p id="7c1f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">亲切的问候。</p></div></div>    
</body>
</html>