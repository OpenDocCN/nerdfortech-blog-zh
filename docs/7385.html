<html>
<head>
<title>Function visibility specifiers and modifiers in Solidity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Solidity 中的函数可见性说明符和修饰符</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/function-visibility-specifiers-and-modifiers-in-solidity-e89d35a31128?source=collection_archive---------0-----------------------#2022-10-16">https://medium.com/nerd-for-tech/function-visibility-specifiers-and-modifiers-in-solidity-e89d35a31128?source=collection_archive---------0-----------------------#2022-10-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7cfb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是你需要知道的…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/662b8a10d514ffb87a9250c11db5336e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6nE6y3Y52EZY1M_x"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="ae jt" href="https://unsplash.com/@fakurian?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Milad Fakurian </a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="f7a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可见性说明符和修饰符定义了可靠性智能契约的功能的可见性和行为。通过限制对功能和数据成员的访问，这些也可以被认为是安全措施。</p><h1 id="5a22" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">可视性说明符</h1><p id="acc7" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这些非常类似于其他面向对象语言(如 c++和 java)的访问修饰符/说明符。这些定义了给定函数相对于其他契约的可访问性。</p><p id="3415" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Solidity 中有 4 种可见性说明符。这些是<code class="du kx ky kz la b">public</code>、<code class="du kx ky kz la b">private</code>、<code class="du kx ky kz la b">internal</code>和<code class="du kx ky kz la b">external</code>。</p><p id="4b19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:这些说明符并不意味着你的<code class="du kx ky kz la b">private</code>代码将对世界隐藏。它仍然可以在区块链上看到。它只是限制从同一个/另一个契约对该函数的调用。</p><h2 id="8a6f" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">公众的</h2><p id="366a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这是限制最少的说明符。<code class="du kx ky kz la b">public</code>说明符意味着可以从同一个合同以及其他合同中访问<code class="du kx ky kz la b">function</code>。</p><p id="fe9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当从同一个契约中调用函数时，它使用简单的机器码跳转来到达那个函数。如果来自另一个契约的函数被称为 EVM 消息调用。第一种比第二种更省油。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="eebb" class="lb jv hi la b fi lt lu l lv lw">contract First {</span><span id="71b1" class="lb jv hi la b fi lx lu l lv lw">  function myFunction() public returns (bool) {</span><span id="0af7" class="lb jv hi la b fi lx lu l lv lw">    return true;</span><span id="5f68" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="9f1b" class="lb jv hi la b fi lx lu l lv lw">  function internalFunction() public {</span><span id="4775" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // works!</span><span id="e8c8" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="6e48" class="lb jv hi la b fi lx lu l lv lw">}<br/></span><span id="8e57" class="lb jv hi la b fi lx lu l lv lw">function outerFunction() {</span><span id="645a" class="lb jv hi la b fi lx lu l lv lw">  new First().myFunction();</span><span id="a686" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="30ac" class="lb jv hi la b fi lx lu l lv lw">contract Second {</span><span id="5b0e" class="lb jv hi la b fi lx lu l lv lw">  function mySecondFunction() public {</span><span id="8140" class="lb jv hi la b fi lx lu l lv lw">    new First().myFunction(); // works!</span><span id="7c6d" class="lb jv hi la b fi lx lu l lv lw">  }<br/>  function useOuterFunction() public {</span><span id="3591" class="lb jv hi la b fi lx lu l lv lw">    outerFunction(); // works!</span><span id="acbf" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="93c3" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="b83b" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated"><strong class="ak">私人</strong></h2><p id="e8ae" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">该说明符将函数的调用限制在同一个协定中。它不能从任何其他契约外部调用。</p><p id="f77c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<code class="du kx ky kz la b">this</code>关键字也不起作用，因为用<code class="du kx ky kz la b">this</code>调用的函数被视为外部 EVM 消息调用。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="94f0" class="lb jv hi la b fi lt lu l lv lw">contract First {</span><span id="a579" class="lb jv hi la b fi lx lu l lv lw">  function myFunction() private returns (bool) {</span><span id="ef16" class="lb jv hi la b fi lx lu l lv lw">    return true;</span><span id="7d75" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="c905" class="lb jv hi la b fi lx lu l lv lw">  function internalFunction() public {</span><span id="d109" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // works<br/>    <br/>    this.myFunction(); // TypeError: Member "myFunction" not found or not visible</span><span id="5bd2" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="b3bc" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="d994" class="lb jv hi la b fi lx lu l lv lw">contract Second {</span><span id="f539" class="lb jv hi la b fi lx lu l lv lw">  function mySecondFunction() public {</span><span id="b21c" class="lb jv hi la b fi lx lu l lv lw">    new First().myFunction(); // TypeError: Member "myFunction" not   found or not visible</span><span id="3c23" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="9d92" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="6c14" class="lb jv hi la b fi lx lu l lv lw">function outerFunction() {</span><span id="97d1" class="lb jv hi la b fi lx lu l lv lw">  new First().myFunction(); // TypeError: Member "myFunction" not found or not visible</span><span id="bf9f" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="c7d8" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">内部的</h2><p id="53ee" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">内部函数仅指定同一协定或派生/继承协定的可见性。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="c21d" class="lb jv hi la b fi lt lu l lv lw">contract First {</span><span id="9b18" class="lb jv hi la b fi lx lu l lv lw">  function myFunction() private returns (bool) {</span><span id="716e" class="lb jv hi la b fi lx lu l lv lw">    return true;</span><span id="e95e" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="0191" class="lb jv hi la b fi lx lu l lv lw">  function internalFunction() public {</span><span id="20c0" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // works<br/>    <br/>    this.myFunction(); // TypeError: Member "myFunction" not found or not visible</span><span id="e56d" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="e059" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="fd48" class="lb jv hi la b fi lx lu l lv lw">contract FirstDerived is First {</span><span id="308a" class="lb jv hi la b fi lx lu l lv lw">  function derivedFunction() public {</span><span id="d56d" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // works</span><span id="0150" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="3746" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="742a" class="lb jv hi la b fi lx lu l lv lw">contract Second {</span><span id="5f7a" class="lb jv hi la b fi lx lu l lv lw">  function mySecondFunction() public {</span><span id="b043" class="lb jv hi la b fi lx lu l lv lw">    new First().myFunction(); // TypeError: Member "myFunction" not   found or not visible</span><span id="16ce" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="e5c4" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="551e" class="lb jv hi la b fi lx lu l lv lw"><br/>function outerFunction() {</span><span id="2512" class="lb jv hi la b fi lx lu l lv lw">  new First().myFunction(); // TypeError: Member "myFunction" not found or not visible</span><span id="686f" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="b43a" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">外部的</h2><p id="3d2a" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">只能从不派生当前协定的其他协定中调用外部函数。这和内部函数完全相反(咄！)</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="56db" class="lb jv hi la b fi lt lu l lv lw">contract First {</span><span id="ea54" class="lb jv hi la b fi lx lu l lv lw">  function myFunction() external returns (bool) {</span><span id="adcd" class="lb jv hi la b fi lx lu l lv lw">    return true;</span><span id="eba7" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="c0fb" class="lb jv hi la b fi lx lu l lv lw">  function internalFunction() public {</span><span id="7bd0" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // DeclarationError: Undeclared identifier.</span><span id="93b4" class="lb jv hi la b fi lx lu l lv lw">    this.myFunction(); // works</span><span id="281b" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="f919" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="df55" class="lb jv hi la b fi lx lu l lv lw"><br/>contract FirstDerived is First {</span><span id="3d3d" class="lb jv hi la b fi lx lu l lv lw">  function derivedFunction() public {</span><span id="972b" class="lb jv hi la b fi lx lu l lv lw">    myFunction(); // DeclarationError: Undeclared identifier.</span><span id="e0b3" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="408e" class="lb jv hi la b fi lx lu l lv lw">}<br/></span><span id="1dc4" class="lb jv hi la b fi lx lu l lv lw">contract Second {</span><span id="cf62" class="lb jv hi la b fi lx lu l lv lw">  function mySecondFunction() public {</span><span id="d0b1" class="lb jv hi la b fi lx lu l lv lw">    new First().myFunction(); // works</span><span id="3812" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="3d0f" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="adea" class="lb jv hi la b fi lx lu l lv lw"><br/>function outerFunction() {</span><span id="bba7" class="lb jv hi la b fi lx lu l lv lw">  new First().myFunction(); // works</span><span id="0b73" class="lb jv hi la b fi lx lu l lv lw">}</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><h1 id="1905" class="ju jv hi bd jw jx mf jz ka kb mg kd ke kf mh kh ki kj mi kl km kn mj kp kq kr bi translated">修饰语</h1><p id="705b" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">可见性说明符定义了协定的可见性，而修饰符定义了协定的行为以及它们与数据成员和其他协定的关系。</p><h2 id="a4ec" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">纯的</h2><p id="ec53" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这个修饰符不允许对任何<code class="du kx ky kz la b">storage</code>变量的读/写访问。读/写访问仅针对<code class="du kx ky kz la b">memory</code>或<code class="du kx ky kz la b">calldata</code>变量。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="75ba" class="lb jv hi la b fi lt lu l lv lw">address owner;</span><span id="b5be" class="lb jv hi la b fi lx lu l lv lw">uint id = 1;</span><span id="e07f" class="lb jv hi la b fi lx lu l lv lw">function pureFun(uint data) public pure {</span><span id="d58b" class="lb jv hi la b fi lx lu l lv lw">  data = 10; // works!</span><span id="625b" class="lb jv hi la b fi lx lu l lv lw">  uint newData = data + 100; // works!</span><span id="01a7" class="lb jv hi la b fi lx lu l lv lw">  id = 2; // TypeError: Function cannot be declared as pure because  this expression (potentially) modifies the state</span><span id="f3d0" class="lb jv hi la b fi lx lu l lv lw">  address newOwner = owner; // TypeError: Function declared as pure, but this expression (potentially) reads from the environment or state and thus requires "view"</span><span id="a1a8" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="1111" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">视角</h2><p id="68ac" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">带有<code class="du kx ky kz la b">view</code>修饰符的函数只允许只读操作。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="a52a" class="lb jv hi la b fi lt lu l lv lw">address owner;</span><span id="b575" class="lb jv hi la b fi lx lu l lv lw">uint id = 1;</span><span id="cba8" class="lb jv hi la b fi lx lu l lv lw">function viewFun(uint data) public view {</span><span id="5d6c" class="lb jv hi la b fi lx lu l lv lw">  data = 10; // works!</span><span id="cded" class="lb jv hi la b fi lx lu l lv lw">  uint newData = data + 100; // works!</span><span id="b8b0" class="lb jv hi la b fi lx lu l lv lw">  id = 2; // TypeError: Function cannot be declared as view because this expression (potentially) modifies the state.</span><span id="532c" class="lb jv hi la b fi lx lu l lv lw">  address newOwner = owner; // works!</span><span id="79bd" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="d1bb" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">应付的</h2><p id="b2cb" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated"><code class="du kx ky kz la b">payable</code>允许函数接收消息调用中的<code class="du kx ky kz la b">ether</code>，并使用<code class="du kx ky kz la b">msg.value</code>访问发送的以太网。此外，发送的<code class="du kx ky kz la b">ether</code>被添加到接收合同的余额中。</p><p id="ede3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这也不限制对<code class="du kx ky kz la b">storage</code>变量的任何读/写。</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="3f9d" class="lb jv hi la b fi lt lu l lv lw">contract Payee {</span><span id="68bc" class="lb jv hi la b fi lx lu l lv lw">  address sender;</span><span id="54ea" class="lb jv hi la b fi lx lu l lv lw">  uint value;</span><span id="0c17" class="lb jv hi la b fi lx lu l lv lw">  function payableFun() external payable {</span><span id="a7a4" class="lb jv hi la b fi lx lu l lv lw">    sender = msg.sender;</span><span id="e637" class="lb jv hi la b fi lx lu l lv lw">    value = msg.value;</span><span id="31fc" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="dfcd" class="lb jv hi la b fi lx lu l lv lw">  function nonPayableFun() external {</span><span id="20eb" class="lb jv hi la b fi lx lu l lv lw">    sender = msg.sender;</span><span id="f282" class="lb jv hi la b fi lx lu l lv lw">    value = msg.value;</span><span id="667a" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="6f69" class="lb jv hi la b fi lx lu l lv lw">}<br/></span><span id="4e2a" class="lb jv hi la b fi lx lu l lv lw">contract Payer {</span><span id="4389" class="lb jv hi la b fi lx lu l lv lw">  function payer() public {</span><span id="9f12" class="lb jv hi la b fi lx lu l lv lw">    Payee payee = new Payee();</span><span id="26c2" class="lb jv hi la b fi lx lu l lv lw">    payee.payableFun{value: 5}(); // works!</span><span id="b0b5" class="lb jv hi la b fi lx lu l lv lw">    payee.nonPayableFun{value: 5}(); // TypeError: Cannot set option "value" on a non-payable function type</span><span id="3bf9" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="b4bd" class="lb jv hi la b fi lx lu l lv lw">}</span></pre><h2 id="4d3a" class="lb jv hi bd jw lc ld le ka lf lg lh ke iq li lj ki iu lk ll km iy lm ln kq lo bi translated">虚拟和覆盖</h2><p id="f96f" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">这些修饰符分别指定一个函数是否应该被重写，以及一个函数是否正在重写一个函数</p><pre class="je jf jg jh fd lp la lq lr aw ls bi"><span id="4757" class="lb jv hi la b fi lt lu l lv lw">contract Parent {</span><span id="2e14" class="lb jv hi la b fi lx lu l lv lw">  function overrideThis() public virtual {</span><span id="f590" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="0e22" class="lb jv hi la b fi lx lu l lv lw">  function dontOverrideThis() public {</span><span id="95c4" class="lb jv hi la b fi lx lu l lv lw">    // TypeError: Trying to override non-virtual function. Did you forget to add "virtual"?</span><span id="3ad2" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="3ae0" class="lb jv hi la b fi lx lu l lv lw">}</span><span id="6f70" class="lb jv hi la b fi lx lu l lv lw">contract Child is Parent {</span><span id="349e" class="lb jv hi la b fi lx lu l lv lw">  function overrideThis() public override {</span><span id="4da6" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="7d11" class="lb jv hi la b fi lx lu l lv lw">  function dontOverrideThis() public override {</span><span id="a206" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="0776" class="lb jv hi la b fi lx lu l lv lw">  function doesntOverride() public override {</span><span id="d87b" class="lb jv hi la b fi lx lu l lv lw">    // TypeError: Function has override specified but does not override anything.</span><span id="9e8e" class="lb jv hi la b fi lx lu l lv lw">  }</span><span id="f56b" class="lb jv hi la b fi lx lu l lv lw">}</span></pre></div><div class="ab cl ly lz gp ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="hb hc hd he hf"><p id="666c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是所有的人！请留下👏如果你学到了什么？下一集再见！</p><h1 id="2b2c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">有用的链接:</h1><div class="mk ml ez fb mm mn"><a href="https://docs.soliditylang.org/en/v0.8.16/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hj fi z dy ms ea eb mt ed ef hh bi translated">坚固性-坚固性 0.8.16 文件</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">部署合同时，您应该使用最新发布的 Solidity 版本。除了特殊情况，只有…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">docs.soliditylang.org</p></div></div></div></a></div><p id="f2fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编辑用:<a class="ae jt" href="https://remix.ethereum.org/" rel="noopener ugc nofollow" target="_blank">https://remix.ethereum.org/</a></p></div></div>    
</body>
</html>