<html>
<head>
<title>How To Upload And Zip Single Or Multiple Files in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 PHP 中上传和压缩单个或多个文件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-upload-and-zip-single-or-multiple-files-in-php-4a6fcb8bbe02?source=collection_archive---------3-----------------------#2022-12-11">https://medium.com/nerd-for-tech/how-to-upload-and-zip-single-or-multiple-files-in-php-4a6fcb8bbe02?source=collection_archive---------3-----------------------#2022-12-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2b0e6f4c3f0e63885e02ef66ea659aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EFw9NiLyXQGVfWK92UqHg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">亨利公司在 Unsplash 上拍摄的照片</figcaption></figure><p id="ab69" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我今天的文章中，我将向你展示如何用 PHP 上传单个和多个文件，并将它们保存在一个 zip 文件中。</p><p id="23fb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">出于本教程的目的，我将使用 PHP 中的<code class="du js jt ju jv b">ZipArchive()</code>类。</p><h1 id="dc97" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">介绍</h1><p id="ae60" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated"><code class="du js jt ju jv b">ZipArchive()</code>类是 PHP 中的一个内置类，可以用来归档一个或一组文件，并用 zip 压缩它。</p><p id="dc20" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我向您展示如何使用这个类来上传和压缩单个和多个文件。</p><h1 id="9241" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">关于课程</h1><p id="7f53" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">为了在你的项目中使用这个类，你必须使用<code class="du js jt ju jv b">new</code>关键字初始化它</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="ff22" class="lh jx hi jv b be li lj l lk ll">//initialize the zip archive class<br/>$zip = new ZipArchive()</span></pre><p id="88d2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">初始化之后，下面的方法就可以使用了</p><ul class=""><li id="6dcc" class="lm ln hi iw b ix iy jb jc jf lo jj lp jn lq jr lr ls lt lu bi translated">打开</li></ul><p id="b885" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此方法打开一个现有的 zip 存档进行读取、写入或修改，或者创建一个空的 zip 存档。</p><ul class=""><li id="d880" class="lm ln hi iw b ix iy jb jc jf lo jj lp jn lq jr lr ls lt lu bi translated">添加文件</li></ul><p id="687e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此方法将文件从给定路径添加到 ZIP 存档。</p><ul class=""><li id="7aac" class="lm ln hi iw b ix iy jb jc jf lo jj lp jn lq jr lr ls lt lu bi translated">关闭</li></ul><p id="505f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此方法关闭打开或创建的归档，然后保存更改。</p><p id="5c33" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我们继续，了解如何在 PHP 中上传和压缩单个和多个文件</p><h1 id="cec2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">上传单个文件</h1><p id="e9e4" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">假设我有一个 HTML 表单，允许用户像这样上传单个文件；</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="d544" class="lh jx hi jv b be li lj l lk ll">&lt;form method="post" action="" enctype="multipart/form-data"&gt;<br/>    &lt;input type="file" name="file"&gt;<br/>    &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>&lt;/form&gt;</span></pre><p id="405c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在 PHP 中，我将使用<code class="du js jt ju jv b">POST</code>方法检查是否上传了一个文件，然后我将处理该文件，创建一个新的 zip 存档，并将该文件添加到 Zip 存档中。</p><p id="77fd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我们来谈谈当我们上传一个文件时会发生什么。</p><h1 id="3eaf" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">当我们上传文件时会发生什么</h1><p id="7a4a" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">当我们上传一个文件时，它的属性对<code class="du js jt ju jv b">$_FILES</code>全局变量是可用的。</p><p id="7e38" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du js jt ju jv b">$_FILES</code>全局变量是一个通过 HTTP POST 方法上传到当前脚本的关联数组。</p><p id="b3ff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这意味着我们可以看到这样的属性:</p><ul class=""><li id="514a" class="lm ln hi iw b ix iy jb jc jf lo jj lp jn lq jr lr ls lt lu bi translated">文件的名称<code class="du js jt ju jv b">[name]</code>。</li><li id="139d" class="lm ln hi iw b ix lv jb lw jf lx jj ly jn lz jr lr ls lt lu bi translated">文件的类型<code class="du js jt ju jv b">[type]</code>。</li><li id="9350" class="lm ln hi iw b ix lv jb lw jf lx jj ly jn lz jr lr ls lt lu bi translated">文件<code class="du js jt ju jv b">[tmp_name]</code>的临时位置。</li><li id="9085" class="lm ln hi iw b ix lv jb lw jf lx jj ly jn lz jr lr ls lt lu bi translated">错误代码<code class="du js jt ju jv b">[error]</code>。</li><li id="689f" class="lm ln hi iw b ix lv jb lw jf lx jj ly jn lz jr lr ls lt lu bi translated">文件的大小(以字节计)<code class="du js jt ju jv b">[size]</code>。</li></ul><p id="2c07" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这是上传单个文件时来自<code class="du js jt ju jv b">$_FILES</code>数组的典型输出示例。</p><figure class="kz la lb lc fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/c5974c2b0811c17c96c1d5088e69dcbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/0*6BuXEi-mI-tsSngD.png"/></div></figure><p id="92ed" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">因此我们可以看到索引<code class="du js jt ju jv b">tmp_name</code>包含了上传文件的路径，这也是它在服务器中的临时位置。</p><p id="1d95" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，让我们创建一个脚本来处理传入的文件，并将其保存到归档文件中。</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="5bf1" class="lh jx hi jv b be li lj l lk ll">//check if the request method is POST<br/>if($_SERVER['REQUEST_METHOD'] === 'POST'){<br/>    //check if a file was uploaded<br/>    if(isset($_FILES['file']) &amp;&amp; !empty($_FILES['file']) &amp;&amp; !is_array($_FILES['file'])){<br/>        //initialize the ziparchive class<br/>        $zip = new ZipArchive();<br/>        //set the name of our zip archive<br/>        $zip_file_name = 'MyFile.zip';<br/>        //create the new zip archive using the $file_name above<br/>        if($zip-&gt;open($zip_file_name, ZipArchive::CREATE) === true){<br/>            //add the file to the archive<br/>            $zip-&gt;addFile($_FILES['file']['tmp_name'], $_FILES['file']['name']);<br/>            //close the archive<br/>            $zip-&gt;close();<br/>        }else{<br/>            echo "Couldn't create Zip Archive";<br/>        }<br/>    }<br/>}</span></pre><p id="8af4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您查看上面的代码片段，您会注意到我们在创建 zip 存档时遵循了一个非常简单的顺序。</p><p id="bc47" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我们使用<code class="du js jt ju jv b">open()</code>方法创建了一个名为<code class="du js jt ju jv b">MyFile.zip</code>的新 zip 存档。</p><p id="afb4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，我们使用<code class="du js jt ju jv b">addFile()</code>方法添加了来自<code class="du js jt ju jv b">$_FILES</code>数组的文件，最后，我们关闭了存档，这样它将使用<code class="du js jt ju jv b">close()</code>方法保存我们的更改。</p><p id="cb6b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您应该在本地开发服务器上运行这段代码并上传一个文件，您将会在您的文件夹的根目录下看到 zip 存档文件<code class="du js jt ju jv b">MyFile.zip</code>。打开这个档案，你会看到你刚刚上传的文件。</p><p id="4f50" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在让我们谈谈如何上传和压缩多个文件</p><h1 id="30c2" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">上传多个文件</h1><p id="8ee6" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">上传多个文件并保存在一个 zip 文件中与上面的脚本没有太大区别。</p><p id="74ff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们像这样修改负责上传多个文件的 HTML 表单；</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="d284" class="lh jx hi jv b be li lj l lk ll">&lt;form method="post" action="" enctype="multipart/form-data"&gt;<br/>    &lt;input type="file" name="file[]" multiple&gt;<br/>    &lt;button type="submit"&gt;Submit&lt;/button&gt;<br/>&lt;/form&gt;</span></pre><p id="1700" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在我们进入细节之前，让我们看看当我们上传多个文件时<code class="du js jt ju jv b">$_FILES</code>数组的输出。</p><figure class="kz la lb lc fd ij er es paragraph-image"><div class="er es mb"><img src="../Images/968c785e7b79c8dbba449b61e48a829d.png" data-original-src="https://miro.medium.com/v2/resize:fit:872/format:webp/0*RCapbNyj10A2Ldz8.png"/></div></figure><p id="65a6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">此时，您可能对如何检索每个文件的文件路径和名称，以及如何将它们添加到归档文件中感到困惑。</p><p id="959e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">嗯，您不必感到困惑，因为我们将遍历$_FILES 数组，然后根据索引匹配文件 tmp_names 和文件名。</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="f48f" class="lh jx hi jv b be li lj l lk ll">//check if the request method is post<br/>if($_SERVER['REQUEST_METHOD'] === 'POST'){<br/>    //check if a file was uploaded<br/>    if(isset($_FILES['file']) &amp;&amp; !empty($_FILES['file']) &amp;&amp; is_array($_FILES['file'])){<br/>        //initialize the ziparchive class<br/>        $zip = new ZipArchive();<br/>        //set the name of our zip archive<br/>        $zip_file_name = 'MyFile.zip';<br/>        //create the new zip archive using the $file_name above<br/>        if($zip-&gt;open($zip_file_name, ZipArchive::CREATE) === true){<br/>            //loop through the tmp_name of the files in $_FILES array<br/>            foreach($_FILES['file']['tmp_name'] as $key =&gt; $tmpName){<br/>                //get the name of the file<br/>                $file_name = $_FILES['file']['name'][$key];<br/>                //add the file<br/>                $zip-&gt;addFile($tmpName, $file_name);<br/>            }<br/>            //close the archive<br/>            $zip-&gt;close();<br/>        }else{<br/>            echo "Couldn't create Zip Archive";<br/>        }<br/>    }<br/>}</span></pre><p id="a22c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，如果您应该在本地开发服务器上运行这段代码并上传一些文件，您将会注意到归档文件已经用您刚刚上传的文件进行了更新。</p><p id="09dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以轻松地对逻辑进行分组，以处理单个和多个文件上传。</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="d220" class="lh jx hi jv b be li lj l lk ll">//check if request method is post<br/>if ($_SERVER['REQUEST_METHOD'] === 'POST') {<br/>    //check if a file was uploaded<br/>    if (isset($_FILES['file']) &amp;&amp; !empty($_FILES['file'])) {<br/>        //single file upload<br/>        if (!is_array($_FILES['file'])) {<br/>            //initialize the ziparchive class<br/>            $zip = new ZipArchive();<br/>            //set the name of our zip archive<br/>            $zip_file_name = 'MyFile.zip';<br/>            //create the new zip archive using the $file_name above<br/>            if ($zip-&gt;open($zip_file_name, ZipArchive::CREATE) === true) {<br/>                //add the file to the archive<br/>                $zip-&gt;addFile($_FILES['file']['tmp_name'], $_FILES['file']['name']);<br/>                //close the archive<br/>                $zip-&gt;close();<br/>            } else {<br/>                echo "Couldn't create Zip Archive";<br/>            }<br/>        }<br/>        //multiple file uploads<br/>        elseif (is_array($_FILES['file'])) {<br/>            //initialize the ziparchive class<br/>            $zip = new ZipArchive();<br/>            //set the name of our zip archive<br/>            $zip_file_name = 'MyFile.zip';<br/>            //create the new zip archive using the $file_name above<br/>            if ($zip-&gt;open($zip_file_name, ZipArchive::CREATE) === true) {<br/>                //loop through the tmp_name of the files in $_FILES array<br/>                foreach ($_FILES['file']['tmp_name'] as $key =&gt; $tmpName) {<br/>                    //the name of the file<br/>                    $file_name = $_FILES['file']['name'][$key];<br/>                    //add the file<br/>                    $zip-&gt;addFile($tmpName, $file_name);<br/>                }<br/>                //close the archive<br/>                $zip-&gt;close();<br/>            } else {<br/>                echo "Couldn't create Zip Archive";<br/>            }<br/>        }<br/>    }<br/>}</span></pre><p id="e930" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果在您的应用程序中，允许用户上传多个归档并压缩为 zip 的文件，您需要确保为 zip 归档生成一个唯一的名称。</p><p id="d8c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以使用 PHP 的内置函数<code class="du js jt ju jv b">uniqid()</code>、<code class="du js jt ju jv b">rand()</code>为 zip 存档名称生成一个随机密钥。</p><pre class="kz la lb lc fd ld jv le bn lf lg bi"><span id="218c" class="lh jx hi jv b be li lj l lk ll">//generate a random key for the zip archive name<br/>$randKey  = uniqid().rand(0000,9999);<br/>//zip file name<br/>$zip_file_name = "$randKey.zip";</span></pre><h1 id="9196" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">结论</h1><p id="af88" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">我们已经讨论了 PHP 中的<code class="du js jt ju jv b">ZipArchive</code>类，它的方法，以及我们如何使用它来创建一个文件存档并把它们压缩成 zip。</p><p id="ea40" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们还讨论了上传文件时会发生什么，以及如何从<code class="du js jt ju jv b">$_FILES</code>数组中提取上传文件的名称、大小和临时位置。</p><p id="85ce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我还向您展示了在单个或多个文件上传的情况下,<code class="du js jt ju jv b">$_FILES</code>数组的输出。</p><p id="4637" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，我给了你一个提示，如果你正在压缩用户上传的文件，你如何为你的 zip 存档名生成一个随机密钥。</p><h1 id="f8aa" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">额外的</h1><p id="5e4c" class="pw-post-body-paragraph iu iv hi iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr hb bi translated">我开发了一个验证库，使用验证规则、复杂的正则表达式和 PHP 内置的验证来帮助验证 PHP 中的表单。</p><p id="8bae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个库是开源的，您可以使用这个库来验证来自<code class="du js jt ju jv b">$_POST</code>、<code class="du js jt ju jv b">$_GET</code>或<code class="du js jt ju jv b">$_FILES</code>数组的数据。</p><p id="2857" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请查看下面这个库的文档</p><div class="mc md ez fb me mf"><a href="https://octagon-simon.github.io/projects/octavalidate/php/index.html" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hj fi z dy mk ea eb ml ed ef hh bi translated">octa validate-PHP:PHP 的服务器端验证库</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">欢迎来到这个伟大的库，它使用 PHP 内置的验证规则来帮助验证表单服务器端…</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">八角形-simon.github.io</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt io mf"/></div></div></a></div><p id="c6dd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>