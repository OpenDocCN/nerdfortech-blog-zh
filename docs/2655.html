<html>
<head>
<title>Concept of String Pool And String Object Creation In Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java 中字符串池和字符串对象创建的概念</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/concept-of-string-pool-and-string-object-creation-in-java-27ed2b3089f5?source=collection_archive---------5-----------------------#2021-05-15">https://medium.com/nerd-for-tech/concept-of-string-pool-and-string-object-creation-in-java-27ed2b3089f5?source=collection_archive---------5-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fc9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">详细解释了使用<strong class="ih hj">【字符串文字】</strong>与使用<strong class="ih hj">【new】</strong>关键字时创建了多少对象，以及 JVM 在字符串类中分配内存。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/078597bff4fca0c5d7b2f17318e9d192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6DrZ-GTkZzzY8qJT"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">约翰·拉贝莱特在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="0d64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你好！欢迎来到新博客。今天我要讲的是一个非常普通却又非常重要的概念。在面试中，你会得到很多围绕这个话题的问题。</p><blockquote class="kb kc kd"><p id="71f7" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">为什么字符串是不可变的？什么是字符串常量池？你写这段代码<code class="du ki kj kk kl b">String s1 = new String("Guess");</code>的时候创建了多少个对象？拥有一个字符串池有什么好处？<code class="du ki kj kk kl b">String.intern()</code>方法是做什么的？等等。</p></blockquote><p id="00d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们通过探索当您使用不同的方法创建一个 String 对象时在幕后发生了什么来找到所有问题的答案</p><h1 id="c689" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">Java 中的字符串池是什么？</h1><p id="0222" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">字符串池是 Java 堆内存中存储字符串的地方。</p><p id="01f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像所有的对象分配一样，字符串分配在时间和内存上都是一件代价很高的事情。JVM 在初始化字符串文字时执行一些步骤，以提高性能和减少内存开销。为了减少 JVM 中创建的字符串对象的数量，String 类保留了一个字符串池。</p><p id="4a24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次创建一个字符串，JVM 首先检查字符串池。如果字符串池中已经存在该字符串，则返回对池化实例的引用。如果池中不存在该字符串，则会初始化一个新的 string 对象，并将其放入池中。</p><p id="ac15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">字符串池之所以可能，仅仅是因为<em class="ke">字符串在 Java 中是不可变的</em>及其<em class="ke">字符串实习</em>概念的实现。</p><h1 id="50e2" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">字符串不变性和优点</h1><p id="bce5" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">如果你看字符串<em class="ke">类</em>的定义，它已经被声明为<em class="ke"> final </em>。<strong class="ih hj">所以字符串对象一旦创建，就不能修改。</strong></p><p id="6579" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">字符串在 java 中是不可变的，因为字符串对象缓存在字符串池中。因为缓存的字符串是在多个对象之间共享的，所以总是存在一个风险，即一个对象所做的更改会影响到其他对象。</p><h2 id="33c3" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">优势</h2><ol class=""><li id="4e23" class="md me hi ih b ii lk im ll iq mf iu mg iy mh jc mi mj mk ml bi translated">字符串是 HashMap 键非常受欢迎的候选者，它们需要是不可变的，以检索存储在 HashMap 中的值对象。因为 HashMap 的工作原理是散列，它需要相同的散列值才能正常工作。由于 String 是不可变的，所以它的 hashcode 在创建时就被缓存了，不需要再次计算。如果字符串是可变的，那么在插入和检索时，如果字符串的内容在插入后被修改，就会产生两种不同的 hashcodes，这一点都不理想。</li><li id="0afe" class="md me hi ih b ii mm im mn iq mo iu mp iy mq jc mi mj mk ml bi translated">另一个原因是，通过在池中缓存字符串，它帮助 JVM 节省了大量堆空间。</li><li id="e2ed" class="md me hi ih b ii mm im mn iq mo iu mp iy mq jc mi mj mk ml bi translated">在 Java 中，安全参数通常表示为字符串，例如，网络内连接、数据库连接 URL、用户名/密码等。如果它是可变的，这些参数可以很容易地改变。JVM 类装入器在装入类时也广泛使用它。</li><li id="03bb" class="md me hi ih b ii mm im mn iq mo iu mp iy mq jc mi mj mk ml bi translated">使 String 不可变会自动使它们成为线程安全的，从而解决同步问题。</li></ol><p id="96db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ke">理论够了！我们来看一些代码片段，了解一下上面的概念。</em></p><h1 id="a909" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">带有示例的基本概念</h1><h2 id="a5c0" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">创建字符串对象有两种方式:</h2><h2 id="f215" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">1.使用双引号(" ")[当使用字符串时]</h2><p id="2b38" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">每当我们使用这种方法创建 Strig 对象时，它都利用了字符串池的概念，因此是高效的。</p><pre class="je jf jg jh fd mr kl ms mt aw mu bi"><span id="ffb1" class="lp kn hi kl b fi mv mw l mx my"><strong class="kl hj">String s1= “Arpan”;</strong></span></pre><p id="bfe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的语句首先在<code class="du ki kj kk kl b">string pool</code>中搜索字符串<strong class="ih hj"> "Arpan" </strong>，如果找到，就给它一个引用<code class="du ki kj kk kl b">s1</code>。如果没有找到，它创建一个字符串对象，并把它放在<code class="du ki kj kk kl b">string pool</code>中，然后给它一个引用 s1。</p><blockquote class="kb kc kd"><p id="7363" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">在这种情况下，<strong class="ih hj">只创建一个对象: <code class="du ki kj kk kl b"><em class="hi">string pool</em></code> <em class="hi">中的</em></strong>。</p></blockquote><h2 id="a65c" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">2.使用“新”关键字:</h2><pre class="je jf jg jh fd mr kl ms mt aw mu bi"><span id="f0ac" class="lp kn hi kl b fi mv mw l mx my"><strong class="kl hj">String s2= new String(“Banerjee”);</strong></span></pre><p id="6a76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的语句在<code class="du ki kj kk kl b">heap memory </code>中创建一个字符串对象，并检查它是否出现在<code class="du ki kj kk kl b">string pool</code>中。如果字符串<strong class="ih hj"><em class="ke">"</em>baner JEE<em class="ke">"</em></strong>不在<code class="du ki kj kk kl b">string pool</code>中，那么它将把这个字符串放在<code class="du ki kj kk kl b">string pool</code>中，否则它将跳过它。</p><blockquote class="kb kc kd"><p id="91a8" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated"><strong class="ih hj">案例 1: </strong>创建两个对象:一个在<code class="du ki kj kk kl b">heap memory</code>中，另一个在<code class="du ki kj kk kl b">string pool</code>中。</p><p id="3fc3" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated"><strong class="ih hj">情况 2: </strong>只创建了一个对象:在<code class="du ki kj kk kl b">heap memory</code>中。</p></blockquote><blockquote class="mz"><p id="a3ca" class="na nb hi bd nc nd ne nf ng nh ni jc dx translated">现在你可能会有这个问题</p></blockquote><p id="2743" class="pw-post-body-paragraph if ig hi ih b ii nj ik il im nk io ip iq nl is it iu nm iw ix iy nn ja jb jc hb bi translated">假设我们用上面的方法创建了一个字符串。因此，将在堆内存中创建一个字符串对象，其值为<strong class="ih hj">“baner JEE”</strong>并且<code class="du ki kj kk kl b">s1</code>将指向它。现在，如果<strong class="ih hj"> "Banerjee" </strong>不在字符串池中，我刚才说它也会在字符串池中创建一个对象。</p><p id="2fc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">但是，你有没有想过，谁会指向这个物体呢？</strong> <code class="du ki kj kk kl b"><strong class="ih hj">s1</strong></code> <strong class="ih hj">？</strong></p><blockquote class="kb kc kd"><p id="e25a" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">不，<code class="du ki kj kk kl b">JVM</code>会指向那个物体。</p></blockquote><p id="9ba9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，为了速度和优化的利益，使用字符串文字的方式创建字符串总是可取的，除非我们特别希望为字符串创建一个新的对象。</p><h1 id="1b2e" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">通过示例理解不变性</h1><p id="6d05" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">让我们用<em class="ke">字符串文字符号创建一个字符串。</em></p><pre class="je jf jg jh fd mr kl ms mt aw mu bi"><span id="52ce" class="lp kn hi kl b fi mv mw l mx my">String s1= "java";</span></pre><p id="5f45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像往常一样，这将创建一个包含<code class="du ki kj kk kl b">"java"</code>的字符串，并给它分配一个引用<code class="du ki kj kk kl b">s1</code>。够简单吗？好吧。</p><p id="8504" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看当我们修改字符串时会发生什么:</p><pre class="je jf jg jh fd mr kl ms mt aw mu bi"><span id="4753" class="lp kn hi kl b fi mv mw l mx my">s1= s1.concat(" code");</span></pre><p id="7f3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将向<code class="du ki kj kk kl b">s1</code>追加一个字符串<code class="du ki kj kk kl b">" code"</code>。当你试图打印<code class="du ki kj kk kl b">s1</code>的值时，你会得到什么？</p><pre class="je jf jg jh fd mr kl ms mt aw mu bi"><span id="e7e1" class="lp kn hi kl b fi mv mw l mx my">System.out.print(s1);<br/>-&gt; java code</span></pre><p id="58b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，我们刚刚了解到字符串是不可变的，对吗？但是控制台上说的是别的，是吗？</p><p id="b84a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">井号</strong>，以上操作未修改<code class="du ki kj kk kl b">s1</code>。<code class="du ki kj kk kl b">JVM</code>创建了一个新的<code class="du ki kj kk kl b">String</code>对象，给了它一个值<code class="du ki kj kk kl b">"java code"</code>，给了它一个引用<code class="du ki kj kk kl b">str</code>。</p><blockquote class="kb kc kd"><p id="05a0" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">这里我们有 3 个对象:<code class="du ki kj kk kl b">java</code>、<code class="du ki kj kk kl b">code</code>和<code class="du ki kj kk kl b">java code</code>。<code class="du ki kj kk kl b">s1</code>指向<code class="du ki kj kk kl b">java code</code>。</p></blockquote><h2 id="04b5" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">让概念更清晰的代码示例。</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="no np l"/></div></figure><p id="0184" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，你能告诉我在上面的程序中创建了多少个对象吗？想想我们到目前为止学到的东西…</p><blockquote class="kb kc kd"><p id="4047" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">在上面的程序中将创建 4 个对象。</p></blockquote><ol class=""><li id="ba00" class="md me hi ih b ii ij im in iq nq iu nr iy ns jc mi mj mk ml bi translated"><strong class="ih hj"><code class="du ki kj kk kl b">heap</code>中的两个</strong>:由<code class="du ki kj kk kl b">st1</code>指向的<strong class="ih hj">【Arpan】</strong>和由<code class="du ki kj kk kl b">st2</code>指向的<strong class="ih hj">【baner JEE】</strong>，因为有了<code class="du ki kj kk kl b">new</code>关键字。</li><li id="2323" class="md me hi ih b ii mm im mn iq mo iu mp iy mq jc mi mj mk ml bi translated"><code class="du ki kj kk kl b">string pool</code>中的两个<strong class="ih hj">:<code class="du ki kj kk kl b">JVM</code>指向的<strong class="ih hj">【班纳吉】</strong>和<strong class="ih hj"/><code class="du ki kj kk kl b">s1</code><code class="du ki kj kk kl b">s2</code><code class="du ki kj kk kl b">s3</code>指向的<strong class="ih hj">【阿潘】</strong>。</strong></li></ol><h2 id="483b" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">下面是对象和内存分配的示意图:</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nt"><img src="../Images/4539980e4e586c91162b24f1194b9162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6l_-GfhR-d0YZgOMSZK8Ag.png"/></div></div></figure><h1 id="18d5" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">高级示例</h1><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="no np l"/></div></figure><p id="06aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中创建了多少个对象？</p><blockquote class="kb kc kd"><p id="7021" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">创建了 6 个对象。现在你必须知道为什么和如何。</p></blockquote><p id="ed57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有任何困惑，请看下图。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nu"><img src="../Images/83f69c4290b907538f5dfe49b7297a23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9baizw0gZsPWF_Ul5sswBQ.png"/></div></div></figure><h1 id="4728" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">最后一件事:String.intern()方法</h1><p id="8771" class="pw-post-body-paragraph if ig hi ih b ii lk ik il im ll io ip iq lm is it iu ln iw ix iy lo ja jb jc hb bi translated">string 方法的<strong class="ih hj"> intern() </strong>方法返回 String 对象的规范表示。</p><p id="953a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它在堆内存中创建一个<em class="ke">字符串</em>对象的精确副本，并将其存储在<em class="ke">字符串</em>常量池中。</p><p id="7517" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当调用 intern 方法时，如果字符串池已经包含一个等于这个使用<code class="du ki kj kk kl b">String.intern()</code>方法新创建的字符串对象的字符串，那么就返回池中的字符串。否则，这个字符串对象将被添加到池中，并返回对它的引用。</p><h2 id="eab7" class="lp kn hi bd ko lq lr ls ks lt lu lv kw iq lw lx la iu ly lz le iy ma mb li mc bi translated">下面是一个演示上述概念的 java 代码。</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="no np l"/></div></figure><blockquote class="kb kc kd"><p id="4606" class="if ig ke ih b ii ij ik il im in io ip kf ir is it kg iv iw ix kh iz ja jb jc hb bi translated">对于本例，将创建 3 个对象，一个在<code class="du ki kj kk kl b">heap</code>中，另外两个在<code class="du ki kj kk kl b">string <em class="hi">pool</em></code>中<em class="hi">。</em></p></blockquote><p id="49af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是显示对象及其引用的图表。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nv"><img src="../Images/06b4090c94bb711f148a6e5a1a624919.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SIvJhJ3sji7XyqngjM6M2g.png"/></div></div></figure><p id="2e38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，这篇文章就到这里。我相信现在你已经理解了 java 中<code class="du ki kj kk kl b">string pool</code>的概念，并且知道如何使用<code class="du ki kj kk kl b">string literals</code>符号和<code class="du ki kj kk kl b">new</code>关键字在<code class="du ki kj kk kl b">heap</code>和<code class="du ki kj kk kl b">string pool</code>中创建对象。</p><p id="42fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你有任何问题或建议，请在评论区告诉我。</p></div></div>    
</body>
</html>