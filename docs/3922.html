<html>
<head>
<title>Paper summary: “VarifocalNet: An IoU-aware Dense Object Detector”(VFNet)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">论文摘要:“VarifocalNet:一种IoU感知的密集对象检测器”(VFNet)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/paper-summary-varifocalnet-an-iou-aware-dense-object-detector-vfnet-dab63cce2626?source=collection_archive---------5-----------------------#2021-06-29">https://medium.com/nerd-for-tech/paper-summary-varifocalnet-an-iou-aware-dense-object-detector-vfnet-dab63cce2626?source=collection_archive---------5-----------------------#2021-06-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3c33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">https://arxiv.org/abs/2008.13367</p><h1 id="32ad" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">要点</h1><ul class=""><li id="5df6" class="kc kd hi ih b ii ke im kf iq kg iu kh iy ki jc kj kk kl km bi translated">另一种基于无锚点的目标检测网络</li><li id="4faf" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">引入新的损耗，变焦距损耗，它是焦距损耗的分叉版本。从焦点损失做出一些改变，以进一步补偿正/负不平衡。</li><li id="1ad4" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">这项工作不是分别预测分类和IOU得分，而是预测代表这两者组合的单个标量。作者说，这种方法在进行NMS后处理时显示出更好的结果。</li><li id="9486" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">星形盒特征表示。</li></ul><h1 id="6fb7" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">介绍</h1><p id="f15f" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">这部作品在FCOS + ATSS的基础上应用了新的理念。强烈推荐两种网络/方法的阅读。特别是，ATSS是本文采用的正/负抽样方法，这有助于理解本文顺利。</p><p id="ade4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">FCOS也是一个无锚点对象检测网络，其中每个特征图中的每个点预测对象类别和“中心性”。这种分别预测对象类别和表示bbox定位的一些标量(在这种情况下为“中心性”)的方法看起来不错且直观，但在进行NMS后处理时，它的表现并不太好。采用类似方法的其他网络通常使用分类标量作为置信度，或者将该置信度乘以“定位”标量(例如“中心度”)以将其用作排序标准。然而，根据作者的说法，这个值在NMS的表现并不好。</p><h1 id="3f40" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">IoU感知分类分数(IACS)</h1><p id="7aff" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">因此，作者建议预测单个标量，该标量已经是对象分类和定位度量的乘积值，并在NMS中直接使用该值进行排名。作者提出了欠条意识分类得分(IACS)。这个方法将填充gt类对象的IoU值，而不是类的置信度值。IoU值将是预测bbox和gt bbox之间的IoU值。在其他等级的槽中，gt值应设置为零。需要注意的一点是gt类的gt值是动态的。</p><h1 id="4927" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">星形盒特征表示</h1><p id="a5cf" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">关于对象类别和预测置信度的决定委托给IACS。那么实际的包围盒坐标呢？针对这个问题，本文采用了“星形盒特征表示法”。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es kv"><img src="../Images/fd170e43c2e03c4e1541ce6bb4be431b.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/format:webp/0*mYwjOwAkA0Arnhmz.png"/></div></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/67590501e03b87fb7275ef1280865206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oECndMYwMNCka8AH.png"/></div></div></figure><p id="6d65" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于特征图中的每个点，网络通过预测4个值来预测初始bbox:(l’，t’，r’，b’)，每个值代表来自给定点的初始bbox的左、右上、下值。然后对于每个点，收集左、右、上、下角和中点的9个点，以及给定点本身。收集这9个点，并在其上应用<strong class="ih hj">可变形卷积</strong>。使用这一新功能，预测bbox偏移，也是4个值:(dl，dt，dr，db)。更合适的名称是“比例因子”，因为最终(l，t，r，b)值是通过(dl<em class="li">* l’，dt</em>* t’，dr * r’，db * b’)获得的。在论文中，这第二步被称为“边界框细化”，作者说这有助于预测的边界框更接近真实情况。</p><p id="e8d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上，我很好奇实际的实现是如何处理l，t，r，b值的剪裁的，但是这部分在论文中没有提到。我想我必须检查这些小细节的代码实现。</p><p id="27e1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想知道为什么这种方法被称为“星形”,但我想我知道为什么。如果我们从中心点到边界的其他8个点画线，它有点像一颗星星。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lj"><img src="../Images/aee192c713a6d2e37e2bcd087fc43638.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*RxdD3Y7hiBZl3COx.png"/></div></figure><h1 id="84eb" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">变焦损失</h1><p id="357b" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">回到IACS。我们知道网络想要预测什么(IACS)，但是如何将焦点损失的“进化”版本包括进来呢？</p><p id="a980" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">焦点损失通过将预测值乘以gamma来很好地处理类别不平衡，公式如下所示。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lk"><img src="../Images/6601805195f6fa7c0ae68577ec54f2d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*FLGL_LSsEq4XAIcl.png"/></div></div></figure><p id="f834" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这项工作借用了这个概念<strong class="ih hj">只是</strong>用于负样本的损失计算。对于阳性样本，它使用bce损失，但有一个区别:它将bce损失乘以gt值。这个修改版本的公式如下所示，我们称之为“变焦损失”。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ll"><img src="../Images/5567caa72a4028102c608dfd9c04a559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5wOhpYZy6MhmZDd-.png"/></div></div></figure><p id="4203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对负样本使用焦点损失是有意义的，因为建议的网络将不可避免地对每个特征图中的每个点进行大量预测，这些预测最终甚至不会成为有效的对象框。这项工作很聪明，对阳性样品不采用这种聚焦方法，而采用BCE损失。</p><p id="d6bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">关于正样本损失的另一个巧妙之处是，它不是普通的BCE损失。地面真实值(=q)乘以BCE损失。让我们来看看这个小小的变化是如何使正样本损失对我们有利的。</p><p id="317f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于普通BCE损失，损失值如下所示变化，其中图表根据实际值(=q)变化。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es lm"><img src="../Images/5cea6bca34d3b2edb592da649ef3128e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yb-b27RCYmMCCpki.png"/></div></div></figure><p id="e705" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">修正BCE损失的相同图表如下所示。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ln"><img src="../Images/52b4c6508b2937137fd3141fe32f4c34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bLlnYc3XG8qg2My5.png"/></div></div></figure><p id="f84c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在普通版本中，不同q值的损耗图显示了以q=0.5为中心的对称行为。q=1.0和q=0.0的损耗图是相同的，只是水平翻转了一下。</p><p id="31d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，对于修正的BCE损耗，q=1.0和q=0.0的损耗图明显不同。对于q=0.0，图形是平坦的。这条曲线不会出现梯度贡献。对于q=1.0，该图与普通BCE损失中的图相同，并且该曲线将产生优化q值的梯度。像这样，我们可以看到损耗曲线在q值更接近1.0时有效，在q值接近0.0时变得没有意义。由于我们希望提高更多“确定”阳性样本的损失值，修正的BCE损失比普通BCE损失更有利。</p><h1 id="1b03" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">整个网络结构</h1><p id="32fd" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">本文中提出的三个主要增强功能是</p><ul class=""><li id="e36e" class="kc kd hi ih b ii ij im in iq lo iu lp iy lq jc kj kk kl km bi translated">星形盒特征表示</li><li id="12c3" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">变焦损失</li><li id="47ab" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">IoU感知分类分数</li></ul><p id="2b0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">包含所有这些的网络结构如下所示。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es ld"><img src="../Images/66a341539fa8e2e9012fec2539bb78e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PkI3qZLORl6tSytb.png"/></div></div></figure><p id="e80a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">主干和特征金字塔是从以前的作品中采用的，所有的新思想都被应用到附在每一层特征地图上的头部网络中。</p><p id="2c8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">论文称之为<strong class="ih hj"> VFNet </strong></p><h1 id="028e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">失败</h1><p id="bef3" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">整个损失是以下各项的加权和</p><ul class=""><li id="dc8a" class="kc kd hi ih b ii ij im in iq lo iu lp iy lq jc kj kk kl km bi translated">变焦损失</li><li id="9102" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">最初预测的bbox损失</li><li id="49d3" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">精炼bbox损耗</li></ul><p id="94aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以用这样的公式表示:</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lr"><img src="../Images/d86362abfc6a225b17561ba2c24c0cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/0*guOvd5P7x0E3TlId.png"/></div></figure><p id="09b0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个符号的含义都写在标题中。有一点我不太明白if why用N_pos归一化，就是正样本(前景点)的个数。我认为直觉上这是正确的选择，但只是无法从理论上解释为什么这是正确的选择。</p><h1 id="aa84" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">推理</h1><p id="ae83" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">该纸张使用1333x800的输入图像尺寸。当过滤输出框时，它经历以下步骤</p><ul class=""><li id="df93" class="kc kd hi ih b ii ij im in iq lo iu lp iy lq jc kj kk kl km bi translated">移除最大IACS小于0.05的bbox</li><li id="e664" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">为每个FPN级别选择前1k个max_IACS值框</li><li id="db75" class="kc kd hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">应用阈值为0.6的NMS</li></ul><h1 id="6b23" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">消融研究的收获</h1><h2 id="543f" class="ls jf hi bd jg lt lu lv jk lw lx ly jo iq lz ma js iu mb mc jw iy md me ka mf bi translated">新思想的贡献</h2><p id="f1c9" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">分析了三个组成部分(变焦损失、星形bbox表示、bbox细化)的贡献，结果如下所示。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="er es mg"><img src="../Images/50c9d43b6e7b4840a8935dda21a218cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xwcJAlMFVuLXLqle.png"/></div></div></figure><p id="2848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这三者都会带来改善。</p><h2 id="f5df" class="ls jf hi bd jg lt lu lv jk lw lx ly jo iq lz ma js iu mb mc jw iy md me ka mf bi translated">变焦损失优于其他损失</h2><p id="ccc4" class="pw-post-body-paragraph if ig hi ih b ii ke ik il im kf io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">本文还试验了变焦距损失是否优于普通焦距损失(FL)和广义焦距损失(GFL)。结果如下所示，我们可以看到，变焦损失比其他人更好。</p></div></div>    
</body>
</html>