<html>
<head>
<title>Local Database In Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振中的本地数据库</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/local-database-in-flutter-93f1d15abc9a?source=collection_archive---------1-----------------------#2021-06-24">https://medium.com/nerd-for-tech/local-database-in-flutter-93f1d15abc9a?source=collection_archive---------1-----------------------#2021-06-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="06f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今所有的移动应用都围绕着数据。根据使用情况，有些存储在云中，有些存储在本地。为了提供对应用程序的离线访问，有必要将数据存储在本地数据库中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7e72f7c3502eacd4d93effab2fe3dae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LDK0AwmUIq9EilhMW4dIxg.png"/></div></div></figure><p id="f64f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将使用Flutter作为我们的框架，并了解数据的本地存储。它是Google最流行的跨平台移动应用程序开发框架之一。它支持各种各样的包和插件，这使得开发过程更容易和更快。今天，我们将了解两个支持本地存储的产品包。</p><p id="40f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要存储像数字/字符串/布尔值这样的小数据，可以使用共享首选项。为了存储更大的数据，我们可以创建表，并使用sqflite包下的sql查询来查询它们。我们将首先浏览共享首选项包。因此，要使用它，我们需要将它添加到我们的<strong class="ih hj"> pubspec.yaml </strong>文件中:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="58c3" class="ju jv hi jq b fi jw jx l jy jz">shared_preferences: ^2.0.6</span></pre><p id="42bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在快跑</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="9df6" class="ju jv hi jq b fi jw jx l jy jz">Flutter pub get </span></pre><p id="95fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更新项目，我们的共享首选项就可以使用了。要在我们的dart文件中使用它，我们需要首先导入它:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="67f8" class="ju jv hi jq b fi jw jx l jy jz">import ‘package:shared_preferences/shared_preferences.dart’;</span></pre><p id="29bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以对变量进行两个基本的读写操作。在此之前，我们创建一个sharedPreferences实例:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="8afc" class="ju jv hi jq b fi jw jx l jy jz">final prefs = await SharedPreferences.getInstance();</span></pre><p id="f78f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，在我们读取变量之前，我们需要检查它是否存在于本地存储中。为此，我们使用containsKey方法，该方法返回一个布尔值，</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="b8fd" class="ju jv hi jq b fi jw jx l jy jz">bool doesExist = prefs.containsKey(‘VariableName');</span></pre><p id="f682" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了读取一个变量，我们使用get方法。要读int，就是getInt。对于string是getString，对于bool是getBool:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="110f" class="ju jv hi jq b fi jw jx l jy jz">myVariable = prefs.getString(‘variableName’);</span></pre><p id="2a53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要写一个变量，我们使用set方法。对于int，它是setInt，类似地，对于string，它是setString，对于bool，它是setBool:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="63f1" class="ju jv hi jq b fi jw jx l jy jz">prefs.setString(‘variableName’, ‘newValue’);</span></pre><p id="44c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这不是简单、容易和方便吗！！！共享偏好设置主要用于存储当前用户的用户名，以便于访问。基于您的应用程序需求，它可以有多种实现方式。</p><p id="589f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们来看看sqflite包，它允许我们创建表并使用sql查询来查询它们。让我们把它添加到<strong class="ih hj"> pubspec.yaml </strong>:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="9071" class="ju jv hi jq b fi jw jx l jy jz">sqflite: ^2.0.0+3</span></pre><p id="8f74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在导入sqflite包:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="b000" class="ju jv hi jq b fi jw jx l jy jz">import ‘package:sqflite/sqflite.dart’;</span></pre><p id="4610" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Sqflite支持许多查询，如创建、插入、查询、更新、删除。我们将一个一个来看。但在此之前，我们将初始化数据库并创建它的实例。当我们打开数据库时，我们需要指定它的路径，这是使用路径包的join方法来完成的。onCreate参数用于传递第一次初始化数据库时将执行的函数，即表不存在，我们必须创建它们。通常，创建和插入查询在onCreate参数中传递:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="77d1" class="ju jv hi jq b fi jw jx l jy jz">database = await openDatabase(</span><span id="f731" class="ju jv hi jq b fi ka jx l jy jz">  join(await getDatabasesPath(), 'databaseName.db'),<br/>    <br/>      onCreate: (db, version){</span><span id="439a" class="ju jv hi jq b fi ka jx l jy jz">  },</span><span id="6c3c" class="ju jv hi jq b fi ka jx l jy jz">  version: 1,</span><span id="598b" class="ju jv hi jq b fi ka jx l jy jz">);</span></pre><p id="cec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了初始化我们的数据库，我们将编写“创建表格”函数，它将为我们创建表格的结构。为了创建这个表，我们使用数据库实例db的execute方法。您将需要SQL的基本知识来编写自己的查询。在这里，我们创建的表将name作为一个参数传递，参数是name、age和address:`</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="480c" class="ju jv hi jq b fi jw jx l jy jz">void createTable(var TableName) async {</span><span id="43cd" class="ju jv hi jq b fi ka jx l jy jz">    final db = await database;</span><span id="d92a" class="ju jv hi jq b fi ka jx l jy jz">    await db.execute(‘create table ‘ + TableName +</span><span id="04ce" class="ju jv hi jq b fi ka jx l jy jz">      ‘ (name varchar, age int, address varchar);’);</span><span id="eb05" class="ju jv hi jq b fi ka jx l jy jz">}</span></pre><p id="47f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来是在我们的表中插入值，这是使用insert方法完成的。我们以映射的形式指定所有列的值:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="59da" class="ju jv hi jq b fi jw jx l jy jz">void insertValues(var TableName, var name, var age, var address) async {</span><span id="3b4c" class="ju jv hi jq b fi ka jx l jy jz">    final db = await database;</span><span id="003f" class="ju jv hi jq b fi ka jx l jy jz">    db.insert(TableName, {</span><span id="bcb1" class="ju jv hi jq b fi ka jx l jy jz">        ‘name’: name,</span><span id="1c39" class="ju jv hi jq b fi ka jx l jy jz">        ‘age’: age,</span><span id="eeee" class="ju jv hi jq b fi ka jx l jy jz">        ‘address’: address,</span><span id="09ad" class="ju jv hi jq b fi ka jx l jy jz">    });</span><span id="5e5e" class="ju jv hi jq b fi ka jx l jy jz">}</span></pre><p id="67d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们看看查询数据库的方法，我们可以使用“Select * from TableName”查询获得表中所有行的数据，结果可以存储在变量中，并使用for循环进行迭代。或者我们也可以直接将结果存储在地图中。在下面的函数中，我只是打印数据。您可以根据自己的需求，以地图/列表的形式存储和返回:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="1bb6" class="ju jv hi jq b fi jw jx l jy jz">void getTableData(var TableName) async {</span><span id="55b7" class="ju jv hi jq b fi ka jx l jy jz">    final db = await database;</span><span id="fc61" class="ju jv hi jq b fi ka jx l jy jz">    var res = await db.rawQuery(‘Select * from ‘ + TableName);</span><span id="03b6" class="ju jv hi jq b fi ka jx l jy jz">    for (var i = 0; i &lt; res.length; i++) {</span><span id="01d2" class="ju jv hi jq b fi ka jx l jy jz">        print(res[i]['name'] + res[i]['age'] + res[i]['address']);</span><span id="eda0" class="ju jv hi jq b fi ka jx l jy jz">    }</span><span id="628c" class="ju jv hi jq b fi ka jx l jy jz">}</span></pre><p id="8bf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们还可以在sql语句中使用“where”来执行条件查询。为了更新表中的任何值，我们使用update方法并指定列名，使用where下传递的参数搜索所需的行。在下面的查询中，我们将更新姓名作为参数传递给函数的人的年龄:</p><pre class="je jf jg jh fd jp jq jr js aw jt bi"><span id="f389" class="ju jv hi jq b fi jw jx l jy jz">void updateValues(var TableName, var NewAge, var name) async {</span><span id="62fa" class="ju jv hi jq b fi ka jx l jy jz">    final db = await database;</span><span id="7e04" class="ju jv hi jq b fi ka jx l jy jz">    db.update(TableName, {'age': NewAge},</span><span id="1dd4" class="ju jv hi jq b fi ka jx l jy jz">        where: "name = ? ", whereArgs: [name]);</span><span id="e8c7" class="ju jv hi jq b fi ka jx l jy jz">}</span></pre><p id="2dff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">原来如此！！！现在，我们可以处理数据并将其存储在本地数据库中，从而轻松地提供对应用程序的离线访问。我希望这是有益的。点击这里查看我以前写的关于有趣编程的文章。敬请关注更多此类文章:)</p></div></div>    
</body>
</html>