<html>
<head>
<title>How to use Rust inside your Electron application with Neon Bindings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在你的电子应用中使用 Rust 与 Neon 绑定</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-use-rust-inside-your-electron-application-using-neon-bindings-64bd83fec316?source=collection_archive---------2-----------------------#2021-08-03">https://medium.com/nerd-for-tech/how-to-use-rust-inside-your-electron-application-using-neon-bindings-64bd83fec316?source=collection_archive---------2-----------------------#2021-08-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="2567" class="io ip hi ik b fi iq ir l is it">// What is it for?<br/>/* If you have an Electron application that needs to be more performant in some tasks, if you need to access something on operating system or even to try the Rust language.</span></pre><p id="b617" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Github 库:【https://github.com/cazetto/neon-electron T2】</p><figure class="if ig ih ii fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/6efb1ddebd28afe17bd7598cff313211.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*21DgcFfS2IY4ljye"/></div></div><figcaption class="kb kc et er es kd ke bd b be z dx translated"><a class="ae js" href="https://unsplash.com/@mullyadii?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">穆利亚迪</a>在<a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="b064" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">大家好。这是我第一次在 Medium 上投稿，希望大家喜欢！</p><p id="8655" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">今天我们将使用 Rust 语言的超级能力创建一个电子应用程序。</p><h2 id="2785" class="io ip hi bd kf kg kh ki kj kk kl km kn jf ko kp kq jj kr ks kt jn ku kv kw kx bi translated">先决条件:</h2><p id="52ee" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">安装节点:https://nodejs.org/en/download/<a class="ae js" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"/></p><p id="95ac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">安装铁锈:<a class="ae js" href="https://www.rust-lang.org/tools/install" rel="noopener ugc nofollow" target="_blank">https://www.rust-lang.org/tools/install</a></p><h1 id="c765" class="ld ip hi bd kf le lf lg kj lh li lj kn lk ll lm kq ln lo lp kt lq lr ls kw lt bi translated">生锈的部分</h1><h2 id="440a" class="io ip hi bd kf kg kh ki kj kk kl km kn jf ko kp kq jj kr ks kt jn ku kv kw kx bi translated">霓虹是什么？</h2><blockquote class="lu lv lw"><p id="5605" class="iu iv lx iw b ix iy iz ja jb jc jd je ly jg jh ji lz jk jl jm ma jo jp jq jr hb bi translated">Neon 是一个库和工具链，用于在你的 NodeJS 应用程序和库中嵌入 Rust。</p></blockquote><h2 id="7f15" class="io ip hi bd kf kg kh ki kj kk kl km kn jf ko kp kq jj kr ks kt jn ku kv kw kx bi translated">什么是霓虹项目？</h2><blockquote class="lu lv lw"><p id="3aa3" class="iu iv lx iw b ix iy iz ja jb jc jd je ly jg jh ji lz jk jl jm ma jo jp jq jr hb bi translated">霓虹项目既是一个<a class="ae js" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点</a> <a class="ae js" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>包，又是一个<a class="ae js" href="https://www.rust-lang.org/" rel="noopener ugc nofollow" target="_blank">锈</a> <a class="ae js" href="https://crates.io/" rel="noopener ugc nofollow" target="_blank">板条箱</a>包。</p></blockquote><p id="aacb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，我们将创建一个新的霓虹灯项目。</p><p id="7306" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我引用了 Neon 文档，我们项目的基础是 Neon hello-world 教程的代码结果。</p><p id="b971" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://neon-bindings.com/docs/hello-world" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">https://neon-bindings.com/docs/hello-world</strong></a></p><p id="3868" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们将首先创建一个名为 neon-electronic 的 neon 项目:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="c7fc" class="io ip hi ik b fi iq ir l is it">npm init neon neon-electron</span></pre><p id="6dbf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将生成一个包含一个<code class="du mb mc md ik b">Cargo.toml</code>和一个<code class="du mb mc md ik b">package.json</code>文件的新项目，让我们看看这是什么:</p><p id="ff06" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae js" href="https://doc.rust-lang.org/cargo/" rel="noopener ugc nofollow" target="_blank"> Cargo </a>是 Rust 包管理器，就像在 node 中我们有<a class="ae js" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>，在 Rust 中我们有<a class="ae js" href="https://doc.rust-lang.org/cargo/" rel="noopener ugc nofollow" target="_blank"> Cargo </a>。</p><p id="f73c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们有一个<code class="du mb mc md ik b">src/lib.rs</code>，这就是神奇发生的地方，这个文件是我们应用程序的 Rust 部分，在本教程中，我们将共享关于您计算机中 CPU 数量的信息，就像在 Neon Bindings hello world 教程中一样。</p><p id="1ac0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先在我们的 Cargo.toml 中添加<code class="du mb mc md ik b">num_cpus</code> Rust 库作为依赖项。</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="0eb1" class="io ip hi ik b fi iq ir l is it">[dependencies]<br/>num_cpus = "1"</span></pre><p id="4360" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">运行 yarn 来安装依赖项:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="6427" class="io ip hi ik b fi iq ir l is it">yarn</span></pre><p id="f020" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，在<code class="du mb mc md ik b">lib.rs,</code>内部，我们将创建通过<a class="ae js" href="https://crates.io/crates/num_cpus" rel="noopener ugc nofollow" target="_blank">num _ CPU</a>Rust crate 读取 CPU 数量的函数:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="fef2" class="io ip hi ik b fi iq ir l is it">fn get_num_cpus(mut cx: FunctionContext) -&gt; JsResult&lt;JsNumber&gt; {</span><span id="f90d" class="io ip hi ik b fi me ir l is it">  Ok(cx.number(num_cpus::get() as f64));</span><span id="0977" class="io ip hi ik b fi me ir l is it">}</span></pre><p id="9638" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">最后，我们从 Rust 代码中导出我们的函数，它将在生成的文件<code class="du mb mc md ik b">index.node</code>中可用。</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="2f62" class="io ip hi ik b fi iq ir l is it">#[neon::main]</span><span id="949a" class="io ip hi ik b fi me ir l is it"><em class="lx">fn</em> main(<em class="lx">mut</em> cx: ModuleContext) -&gt; NeonResult&lt;()&gt; {</span><span id="cab0" class="io ip hi ik b fi me ir l is it">  cx.export_function("get", get_num_cpus)?;</span><span id="99d4" class="io ip hi ik b fi me ir l is it">  Ok(())</span><span id="35ee" class="io ip hi ik b fi me ir l is it">}</span></pre><p id="00f8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du mb mc md ik b">lib.rs</code>代码变成了:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="f339" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们应该能够重建项目了:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="d070" class="io ip hi ik b fi iq ir l is it">npm run build -- --release</span></pre><p id="bbb3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们可以通过在终端中打开 NodeJS 并运行生成的代码来测试它:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="a933" class="io ip hi ik b fi iq ir l is it">node</span><span id="7755" class="io ip hi ik b fi me ir l is it">&gt; const cpuCount = require('.')</span><span id="61ab" class="io ip hi ik b fi me ir l is it">&gt; cpuCount.get()</span><span id="3bdf" class="io ip hi ik b fi me ir l is it">4</span></pre><h1 id="9f5e" class="ld ip hi bd kf le lf lg kj lh li lj kn lk ll lm kq ln lo lp kt lq lr ls kw lt bi translated">电子部分</h1><p id="fd19" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">将电子作为从属项添加:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="0c1c" class="io ip hi ik b fi iq ir l is it">yarn add -D electron</span></pre><p id="0f71" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">将电子启动脚本添加到<code class="du mb mc md ik b">package.json</code></p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="806b" class="io ip hi ik b fi iq ir l is it">{<br/>  "scripts": {<br/>    "dev": "electron ./src/main.js",<br/>  }<br/>}</span></pre><p id="dfd5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建一个<code class="du mb mc md ik b">src/main.js</code>文件:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="468f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建<code class="du mb mc md ik b">src/preload.js</code>脚本:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="fee2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">创建<code class="du mb mc md ik b">src/index.html</code>文件:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><h2 id="a166" class="io ip hi bd kf kg kh ki kj kk kl km kn jf ko kp kq jj kr ks kt jn ku kv kw kx bi translated">将两部分结合起来:</h2><p id="ea2e" class="pw-post-body-paragraph iu iv hi iw b ix ky iz ja jb kz jd je jf la jh ji jj lb jl jm jn lc jp jq jr hb bi translated">在我们的<code class="du mb mc md ik b">src/index.html</code>中，我们需要添加一个新元素来显示 CPU 的数量。</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="c378" class="io ip hi ik b fi iq ir l is it">&lt;p&gt;</span><span id="e41a" class="io ip hi ik b fi me ir l is it">  &lt;span&gt;CPUs:&lt;/span&gt;</span><span id="576c" class="io ip hi ik b fi me ir l is it">  &lt;span <em class="lx">id</em>="number-of-cpus"&gt;&lt;/span&gt;</span><span id="f1ad" class="io ip hi ik b fi me ir l is it">&lt;/p&gt;</span></pre><p id="2a0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du mb mc md ik b">src/ndex.html</code>文件变成:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="99d6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<code class="du mb mc md ik b">src/preload.js</code>文件中我们需要导入 Neon 生成的代码:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="2d25" class="io ip hi ik b fi iq ir l is it">const lib = require('../index.node');</span></pre><p id="3a5d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">DOMContentLoader 回调内部:</p><pre class="if ig ih ii fd ij ik il im aw in bi"><span id="d610" class="io ip hi ik b fi iq ir l is it">const numberOfCPUs = lib.get();</span><span id="7098" class="io ip hi ik b fi me ir l is it">const numberOfCPUsElement = document.getElementById(‘number-of-cpus’);</span><span id="0b4b" class="io ip hi ik b fi me ir l is it">numberOfCPUsElement.innerText = numberOfCPUs;</span></pre><p id="dcce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">比，<code class="du mb mc md ik b">src/preloader.js</code>就变成了:</p><figure class="if ig ih ii fd ju"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="05ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这样，我们就可以运行<code class="du mb mc md ik b">yarn dev</code>并看到我们的应用程序运行时从 Rust 到 NodeJS 的 CPU 数据数量。</p><figure class="if ig ih ii fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es mo"><img src="../Images/18c6c5154ed65333ef993b8eae702d23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWOKtXYv3S2IuraIaBbKyQ.png"/></div></div></figure><p id="e9b7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">也就这些了，可以随意和这个帖子互动，问点什么或者建议点什么，如果有错就告诉我。</p><p id="e50c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我知道这个教程是否对你有帮助，这样我就可以指导自己写更好的帖子。</p><p id="d34b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望你喜欢它🚀</p></div></div>    
</body>
</html>