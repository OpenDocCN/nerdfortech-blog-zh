<html>
<head>
<title>Setup JaCoCo code coverage with your Multimodule Android App Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用多模块Android应用Kotlin设置JaCoCo代码覆盖率</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/setup-jacoco-code-coverage-with-your-multimodule-android-app-kotlin-a0f82573a1?source=collection_archive---------0-----------------------#2021-07-03">https://medium.com/nerd-for-tech/setup-jacoco-code-coverage-with-your-multimodule-android-app-kotlin-a0f82573a1?source=collection_archive---------0-----------------------#2021-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="bbf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们上一篇<a class="ae jd" href="https://ashish-uniyal.medium.com/setup-ktlint-with-your-android-app-and-using-github-hooks-2cfc42a2cf2" rel="noopener">文章</a>中，我们讨论了如何在我们的android项目中设置ktlint。希望对你有帮助。如果你还没有尝试过，一定要尝试一下，因为这是你做项目时最基本的要求之一。</p><p id="94cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们来谈谈代码覆盖率。我们想检查编写的代码是否没有错误。但是，我们如何检查代码的真实性呢？在来救援单位测试的情况下。也许改天我们会讨论使用Mockk或Mockito的单元测试实现，但是今天我们将讨论检查你写的测试用例的覆盖率。为此，我们将使用众所周知的代码覆盖库<a class="ae jd" href="https://github.com/arturdm/jacoco-android-gradle-plugin" rel="noopener ugc nofollow" target="_blank"> JaCoCo </a>。照章办事，这就是Jacoco:</p><blockquote class="je"><p id="83e8" class="jf jg hi bd jh ji jj jk jl jm jn jc dx translated"><em class="jo"> JaCoCo应该为基于Java VM的环境中的代码覆盖分析提供标准技术。重点是提供一个轻量级的、灵活的、文档完善的库，以便与各种构建和开发工具集成。</em></p></blockquote><p id="111c" class="pw-post-body-paragraph if ig hi ih b ii jp ik il im jq io ip iq jr is it iu js iw ix iy jt ja jb jc hb bi translated">理论到此为止。现在让我们开始为kotlin中的多模块android应用程序进行设置。</p><h1 id="f144" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第一步</h1><p id="efe9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">在项目gradle文件中添加jacoco依赖项，即<em class="kx"> build.gradle. </em></p><p id="ebf1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">classpath "org.jacoco:org.jacoco.core:0.8.6"</code></p><p id="30fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所有项目下，为多模块项目应用插件。</p><pre class="lc ld le lf fd lg lb lh li aw lj bi"><span id="81d2" class="lk jv hi lb b fi ll lm l ln lo">allprojects {<br/>   ...<br/>   apply plugin: 'jacoco'<br/>   ...<br/>}</span></pre><figure class="lc ld le lf fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lp"><img src="../Images/a6796a6b8dad4da49c6bd24444775548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ZqMqas2P5dP46LsY2BE7g.png"/></div></div><figcaption class="lx ly et er es lz ma bd b be z dx translated">项目分级文件</figcaption></figure><h1 id="bdba" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第二步</h1><p id="fad9" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">下面的设置可以在项目gradle文件中完成，但是为了更简洁，让我们创建一个<em class="kx"> jacoco.gradle </em>文件并开始添加所有需要的配置。此外，应用于应用程序中的所有模块也更容易。使用文件的以下内容:</p><figure class="lc ld le lf fd lq"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="467a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能需要检查上述目录中的fileFilter内容。根据使用的依赖注入框架和其他生成的类进行修改。</p><h1 id="5cdc" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">第三步</h1><p id="b214" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">现在，在每个模块<em class="kx"> build.gradle </em>中，将<em class="kx"> jacoco.gradle </em>应用为:</p><p id="26bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">apply from: "$project.rootDir/jacoco.gradle"</code></p><p id="5650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您同步您的项目时，您将会看到所有生成的任务，您可以为这些任务测试代码覆盖率。下面是我的项目的一个例子。</p><figure class="lc ld le lf fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es md"><img src="../Images/cfc5fc34a24db329f182e979a65ea405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nuvZS0n0o9Y3DZB4PM92UA.png"/></div></div></figure><p id="6731" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已。现在，您应该能够通过简单地运行下面的命令来生成测试覆盖报告。</p><p id="c8cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">./gradlew testDebugUnitTest</code></p><p id="175f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，如果您想单独生成模块级别，请使用下面的命令:</p><p id="b6b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">./gradlew :module:testDebugUnitTest</code></p><p id="d9f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在<em class="kx">构建/报告/测试</em>下生成报告，如下所示。</p><figure class="lc ld le lf fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es me"><img src="../Images/2182ca27a7e08731d79cd4abfcc7ef33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j1YN2gRs63rcy654ttOPow.png"/></div></div></figure><p id="f316" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要检查覆盖率报告，请运行以下命令</p><p id="9ecf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ky kz la lb b">./gradlew createDebugCoverageReport</code></p><p id="e9e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在<em class="kx">构建/报告/覆盖</em>下生成类似下面的报告</p><figure class="lc ld le lf fd lq er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mf"><img src="../Images/105a7690e0f1ad6b9b42dca3d94adb00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mGYbWVbbXAmOynQsvUVVYw.png"/></div></div></figure><p id="0518" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就对了。！！。我们已经完成了设置，现在您也可以将它与Sonarqube集成。如果你有任何建议，请随时联系我。</p><div class="mg mh ez fb mi mj"><a href="https://github.com/ashishuniyal90/JacocoTestCoverage" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hj fi z dy mo ea eb mp ed ef hh bi translated">ashishuniyal 90/JacocoTestCoverage</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">设置jacoco测试覆盖率的存储库。为ashishuniyal 90/JacocoTestCoverage开发做出贡献，创建一个…</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">github.com</p></div></div><div class="ms l"><div class="mt l mu mv mw ms mx lv mj"/></div></div></a></div></div></div>    
</body>
</html>