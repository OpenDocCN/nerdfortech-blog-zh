<html>
<head>
<title>Large-scale text processing with Apache Beam and Cloud Dataflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Apache Beam和云数据流的大规模文本处理</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/large-scale-text-processing-with-google-cloud-dataflow-740e275eb93?source=collection_archive---------1-----------------------#2022-01-23">https://medium.com/nerd-for-tech/large-scale-text-processing-with-google-cloud-dataflow-740e275eb93?source=collection_archive---------1-----------------------#2022-01-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/7691a0063590a93f3da94e32a290dacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gJvLBVNXMqw_-1V0zoxVQ.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@foxfox" rel="noopener ugc nofollow" target="_blank">娜塔莉亚Y </a>在<a class="ae iu" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="ee49" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">数据预处理是机器学习中最重要的步骤之一。机器学习模型的好坏取决于它们接受训练的数据。模型复杂性/架构也很重要，但是如果数据本身不好，什么都不会起作用。</p><p id="c752" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">互联网上的大多数数据都是不干净的。大多数机器学习应用程序在将数据输入模型进行训练之前，必须对数据进行某种预处理。数据预处理方法会对模型准确性和训练时间产生显著影响。</p><p id="c8ad" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">文本数据也不例外。它们通常比数值数据需要更多的预处理。大多数文本数据集包含特殊字符、额外的空格、表情符号、标点符号和许多其他会影响模型性能并需要删除的东西。</p><p id="2a4d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">Google Cloud dataflow是用于大规模数据处理的Google Cloud托管服务。当数据集较小时，使用普通python函数进行数据处理是可行的。但是当数据集包含数百万个示例时，使用普通的python函数就变得不可行了。相反，可以使用apache beam构建数据管道，然后作为数据流作业运行。数据流得到全面管理，并具有自动扩展功能，因此无需担心资源耗尽。一些流水线操作也是并行运行的，因此流水线会运行得更快。</p><p id="04db" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">需要一个大数据集来比较手动运行数据管道和数据流作业的性能。我们将使用Kaggle <a class="ae iu" href="https://www.kaggle.com/bittlingmayer/amazonreviews?select=train.ft.txt.bz2" rel="noopener ugc nofollow" target="_blank">中的亚马逊评论数据集。train zip文件包含一个文本文件，其中有360万条评论及其标签。文本文件本身的大小是1.5 GB。这是同一文件中的一行:</a></p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="e125" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">即使对非游戏玩家来说也是令人震惊的:这个音轨太美了！它很好地描绘了你心中的记忆，我甚至会推荐给那些讨厌视频的人。游戏音乐！我玩过Chrono Cross游戏，但在我玩过的所有游戏中，它的音乐是最好的！它摒弃了粗糙的键盘，用吉他和深情的管弦乐迈出了新的一步。它会打动任何想听的人！^_^\n" </p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="9c4c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第一个单词指定了标签。“__label__1”对应1星和2星评价(差)，“__label__2”对应4星和5星评价(好)。</p><h2 id="1c18" class="kb kc hi bd kd ke kf kg kh ki kj kk kl jg km kn ko jk kp kq kr jo ks kt ku kv bi translated"><strong class="ak">使用的预处理技术列表:</strong></h2><ol class=""><li id="2f5d" class="kw kx hi ix b iy ky jc kz jg la jk lb jo lc js ld le lf lg bi translated">删除句尾、句首或句中多余的空格。</li><li id="5e16" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">扩展单词，如“不是”、“不是”等。</li><li id="1c10" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">将句子中的所有字母转换成小写。</li><li id="a011" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">删除标点符号。</li><li id="8b26" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">删除停用词。</li><li id="7044" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">删除特殊字符。例如:+，-，:，等等。</li><li id="4c8d" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">移除表情符号。</li><li id="b93e" class="kw kx hi ix b iy lh jc li jg lj jk lk jo ll js ld le lf lg bi translated">将标签转换为数字形式。即“__label__1”为0，而“__label__2”为1</li></ol><p id="ad0f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是列出的实施步骤:</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="b0dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">加载文本文件并在本地运行这些步骤(一个接一个地运行函数)由于数据量太大(360万条评论)而花费了很长时间。我无法测量处理时间，因为它一直在运行，我不得不在一段时间后停止它。</p><p id="0c5c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是在数据流上运行与apache beam管道相同的步骤的实现:</p><figure class="lm ln lo lp fd ij"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="1fd8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">上面脚本中创建的Apache beam管道可以在本地运行，也可以作为一个成熟的数据流作业运行。通常，管道在较小版本的数据集上本地运行，以确保管道是正确的，并且运行时没有任何错误或权限问题。一旦本地运行成功，就可以将作业提交给数据流。</p><p id="5702" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">从google cloud storage (GCS)中读取原始文本文件，并将最终的预处理文本和标签写回到GCS的不同目录中。Apache beam有各种不同的预建IO连接器。预处理后的数据也可以写入Bigquery表，因为它现在是结构化数据。</p><p id="6a08" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当我将上述管道作为数据流作业运行时，整个管道在13分钟内完成。它能够在13分钟内处理所有360万篇综述文本并将结果以CSV文件形式写入GCS！</p><p id="eb63" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">以下是数据流作业仪表板的屏幕截图，包含每个管道步骤的执行细节:</p><figure class="lm ln lo lp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/35d2cbab8fc3ea9f501eb0f84b1a66d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*srapiEWFQlQtwp_sDbdS6w.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">图片作者<a class="ae iu" rel="noopener" href="/@subrahmanyajoshi123">作者</a></figcaption></figure><h1 id="e510" class="lt kc hi bd kd lu lv lw kh lx ly lz kl ma mb mc ko md me mf kr mg mh mi ku mj bi translated"><strong class="ak">尾注:</strong></h1><p id="174f" class="pw-post-body-paragraph iv iw hi ix b iy ky ja jb jc kz je jf jg mk ji jj jk ml jm jn jo mm jq jr js hb bi translated">还有很多文本预处理技术，比如删除URL、词汇化、词干化等。必须根据数据集选择适当的技术。</p><p id="d48f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">预处理完成后，下一步是使用tensorflow.keras的“Tokenizer”模块将文本数据转换为数字形式，该模块将可变长度的文本转换为固定长度的整数序列。深入探讨这个问题超出了本文的范围。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="53b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">谢谢</p></div></div>    
</body>
</html>