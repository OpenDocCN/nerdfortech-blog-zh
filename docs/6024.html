<html>
<head>
<title>.NET Logging Provider for Telegram — now Open and Extensible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">。电报的网络日志提供者——现在是开放的和可扩展的</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/net-logging-provider-for-telegram-now-open-and-extensible-1d4cfdd914fc?source=collection_archive---------9-----------------------#2021-12-20">https://medium.com/nerd-for-tech/net-logging-provider-for-telegram-now-open-and-extensible-1d4cfdd914fc?source=collection_archive---------9-----------------------#2021-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c432" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前一段时间，我写了一本关于<a class="ae jd" href="https://andrey-gubskiy.medium.com/net-logging-provider-for-telegram-b30d087dbfe2?source=your_stories_page----------------------------------------" rel="noopener">的出版物。NET Telegram</a>的日志提供者——一个简单的库，允许向<a class="ae jd" href="https://web.telegram.org/" rel="noopener ugc nofollow" target="_blank"> Telegram </a>写日志。</p><p id="04be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我想谈谈我所做的一些改进。我想让这个库更加开放和灵活。所以我添加了很多日志过程定制的选项。</p><h1 id="3f04" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">改进的日志级别过滤</h1><p id="1d15" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">首先，我更新了日志级别过滤。电报记录器现在考虑不同名称空间的日志级别。</p><p id="59f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以前，只能通过代码配置电报记录器的全局日志级别:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="260a" class="kq jf hi km b fi kr ks l kt ku">var options = new TelegramLoggerOptions<br/>{<br/> <strong class="km hj">...</strong><br/> <strong class="km hj">LogLevel</strong> <strong class="km hj">= LogLevel.Information</strong>,<br/> <strong class="km hj">...</strong><br/>};</span></pre><p id="fda0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者通过 appsettings.json:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4e05" class="kq jf hi km b fi kr ks l kt ku">{<br/>  "Logging": {<br/>    "LogLevel": {<br/>       ...<br/>    },<br/>    "Telegram": {<br/>      <strong class="km hj">"LogLevel": "Warning",</strong><br/>      ...<br/>    }<br/>  },<br/>  ...<br/>}</span></pre><p id="183d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在记录器配置可以更方便地完成，如<a class="ae jd" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-6.0#configure-logging" rel="noopener ugc nofollow" target="_blank">登录所述。网芯和 ASP.NET 芯</a>。</p><p id="3496" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过 appsettings.json 文件进行配置:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6028" class="kq jf hi km b fi kr ks l kt ku">{<br/>  "Logging": {<br/>    "LogLevel": {<br/>      "Default": "Information",<br/>      "Microsoft": "Warning",<br/>      "Microsoft.Hosting.Lifetime": "Information"<br/>    },<br/>    "Telegram": {<br/>      <strong class="km hj">"LogLevel": {<br/>        "Default": "Error",<br/>        "WebApp.Controllers": "Warning"<br/>      }</strong>,<br/>      ...<br/>    }<br/>  },<br/>  ...<br/>}</span></pre><p id="a191" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">LogLevel 指定记录选定类别的最低级别。当指定了日志级别时，将为指定级别及更高级别的消息启用日志记录。有关更多信息，请参见微软文档门户网站上的<a class="ae jd" href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/?view=aspnetcore-6.0#llvl" rel="noopener ugc nofollow" target="_blank">日志级别</a>。</p><h1 id="e222" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用自定义日志编写器</h1><p id="4824" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在，开发人员可以使用自己的实现将数据写入 Telegram。自定义编写器应实现<em class="kv"> ILogWriter </em>接口:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="5de3" class="kq jf hi km b fi kr ks l kt ku">var <strong class="km hj">customLogWriter = new CustomLogWriter();</strong><br/>logBuilder.AddTelegram(options, <strong class="km hj">customLogWriter</strong>);</span></pre><h1 id="d311" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用自定义消息格式化程序</h1><p id="b116" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">现在可以使用 ITelegramMessageFormatter 来实现定制消息格式。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="820f" class="kq jf hi km b fi kr ks l kt ku">private ITelegramMessageFormatter CreateFormatter(string name)<br/>{<br/>    return new CustomAceTelegramMessageFormatter(name);<br/>}</span><span id="9be7" class="kq jf hi km b fi kw ks l kt ku">logBuilder..AddTelegram(options, CreateFormatter)</span></pre><p id="c852" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要使用自定义消息格式化程序委托<em class="kv"> Func &lt;字符串，ITelegramMessageFormatter&gt;</em>应传递给扩展方法<em class="kv"> AddTelegram </em>。委托，因为格式化程序需要知道哪个类别用于呈现消息。</p></div></div>    
</body>
</html>