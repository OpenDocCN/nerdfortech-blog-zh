# 新冠肺炎患者入住 ICU 的预测

> 原文：<https://medium.com/nerd-for-tech/prediction-of-icu-admission-of-covid-19-patients-2d2c1616d395?source=collection_archive---------14----------------------->

# 介绍

2020 年初开始的全球新冠肺炎疫情对世界各国的医疗保健系统产生了相当大的影响。随着新冠肺炎病例的大量涌入，医院工作人员正在努力为每位患者提供有限的医疗资源。重症监护病房(ICU)是最重要的资源之一，对于受影响最严重的患者的生命至关重要，因此必须有效地分配，以确保在这些资源耗尽之前挽救患者的生命。

意识到这个问题的重要性后，圣保罗和巴西利亚的医院公布了他们过去的新冠肺炎患者的数据，并要求数据科学家提出可以预测患者对 ICU 服务需求的模型。在这份报告中，我将使用 python 中的分类模型来分析这些数据。我将从一个简单的探索性数据分析开始，然后构建并比较五个不同的模型。在我选择了性能最好的模型之后，我将进行随机网格搜索交叉验证来微调模型。最后，我将对住院不同时间的病人的模型进行评估。

本项目中进行的分析基于以下数据:

[](https://www.kaggle.com/S%C3%ADrio-Libanes/covid19) [## 新冠肺炎-评估诊断的临床数据

### Sírio-Libanês 人工智能数据和数据情报团队的分析

www.kaggle.com](https://www.kaggle.com/S%C3%ADrio-Libanes/covid19) 

# 探索性数据分析

在开始真正的预测之前，我做了一个简单的 EDA 来理解这些数据。

1.  列变量简介

![](img/e353869b4468c954c3fdedc14a94434d.png)

数据中有 231 列，使用 PATIENT_VISIT_IDENTIFIER 来标识每个患者。前三列是关于患者的人口统计信息。接下来，有九列是关于患者以前分组的疾病。然后有 210 个关于血液结果的专栏和另外 6 个关于生命体征的专栏。

![](img/0b78477e230e6c71a0ab97cb4b0d5945.png)

如上所示，最后两列对我的分析至关重要。窗口是记录病人入院的小时数。每个患者在 5 个窗口期(0-2 小时、2-4 小时、4-6 小时、6-12 小时和 12 小时以上)被记录 5 次。ICU 是每个窗口小时内患者入住 ICU 的记录，“1”表示入住 ICU，“0”表示不入住。我在这个项目中的一个主要目标是尽可能早地预测病人对 ICU 服务的需求，换句话说，用最少的窗口小时数。

2.探索缺失的价值

![](img/f7078def6c77f4ff54a5231dbab63c1d.png)

如上图，数据中包含了大量的缺失值，尤其是在血液结果中(57.35%的数据缺失)。根据我找到这些数据的网站，我可以用患者的下一个或上一个条目来填充数据，我是这样做的。

![](img/5427d80a89b35105b9aba96733d54b73.png)

3.添加列 ICU_result

根据网站，最好不要使用患者已经被送进 ICU 的数据，因为“不知道事件的顺序”(可能他们在获得所有其他数据之前就被送入 ICU)，因此我决定将每个患者的条目组合在一起，并向它们添加一个新的变量 ICU_result，并删除患者已经被送进 ICU 的数据。

![](img/4afd3d1ac1ec405bb1366d2b17002d87.png)![](img/4806f85a1005f50df19652c08faad2bc.png)

如下图所示，需要和不需要 ICU 护理的患者比例大致相同。

![](img/cc2d695d398194f2cb99bebb2bc903c8.png)

4.确保变量是 Float / Int，以便于建模

检查数据帧的信息后，我发现只有 AGE_PERCENTIL 和 WINDOW 不在 int / float 中。由于 WINDOW 是一个分类变量，我将在稍后的建模中将其转换为虚拟变量。AGE_PERCENTIL 通过下面的操作转换成 int。

![](img/5655fba1db0a3f3b14e45258ddacca86.png)

我再次检查 info，所有变量都在 float / int 中，这意味着我现在可以用分类模型进行预测了。

# 分类模型

1.  获取虚拟变量并拆分数据用于训练和测试

![](img/91c55388da15e3d5af536c650287ac5e.png)

2.基线分类

![](img/4136de0e3edc6d6472b3e7009fa11755.png)

我进行了一个基线分类，仅供参考，准确率 67.46%。

3.决策图表

接下来，我进行了一个决策树模型。

![](img/fb1a5f9b861eea2222ca930487274b5d.png)![](img/43bb8895df7d9e213feac82c398ab0d9.png)![](img/1e8e80c53c8e8689921f5eb83b835e29.png)

决策树的准确率为 94.54%，召回率为 86.86%。(我包括了回忆分数，因为我想让模型预测最少的假阴性病例，这意味着它错误地预测患者不需要 ICU 护理，而实际上他/她需要)。

4.装袋分级机

![](img/9fd8a3f66f2f4739a3c43357a04c1cd6.png)

Bagging 分类器的准确率为 96.20%，召回率为 89.78%。

5.随机森林模型

![](img/e58bd13c27c251a0f5cb65a3428288a3.png)

随机森林的准确率为 96.67%，召回率为 90.51%。

6.AdaBoost 分类

![](img/4c08c8f92fce963763f394d5239b3d42.png)

AdaBoost 分类模型的准确率为 93.82%，召回率为 85.40%。

7.投票分类

![](img/fb49242420265204f1097136d43b33f6.png)

投票分类模型的准确率为 96.67%，召回率为 89.78%。

8.比较模型

![](img/23fa8ef191657522d8021d512d1b50c5.png)

在我对每个模型做了简单的研究之后，我收集了每个模型的准确性和召回率的数据。显然，随机森林是表现最好的模型，具有最高的准确性和回忆分数，所以我决定用随机森林继续我的分析。

# 超参数调谐

为了改进我的随机森林模型，我进行了随机网格搜索交叉验证。

![](img/3f3e11d3f77ef4a6346d2fd1478115a9.png)

交叉验证给出了一组参数，这些参数对于我的随机森林模型是最优的，如下所示。

![](img/f9ab98f4ef07dac48cf7af6a6624d052.png)

我对改进后的模型进行了评估，得到了以下结果:

![](img/1b4a50d6ebae33b36d4cc1deaa065a44.png)

显然，随机森林模型的准确率和召回率都得到了提高，准确率高达 97.15%，召回率高达 91.97%。接下来，我将在不同的窗口期使用该模型，看看当患者入院时间较短时，该模型是否表现良好。

# 使用不同的窗口期进行预测

为了对不同的窗口期进行预测，我首先根据不同的窗口期提取和处理数据。

![](img/7f3d663640c25b99a749283ddcef2db6.png)

我制作了四个新的数据帧，包含第一、第二、第三和第四个窗口期的数据。

![](img/e09f14ca5ad2fa65a7ca3ab1c1c84f8a.png)

接下来，我使用刚刚获得的最优模型制作了一个函数，对四个新的数据框架进行预测。

![](img/01ca91aee663c52133666f307817422a.png)

以下是不同窗口期的四组数据的结果。

![](img/d4739ec88d1531a477b4b778d1584421.png)![](img/53b0a3b3e438d3f6181f0367226024eb.png)![](img/a63f349492a1b7ca62b6e1b455a111b0.png)![](img/88b2e5e9690bef4c3537afa667e6ae4e.png)

我在下面的图表中总结了四个预测的准确性得分:

![](img/3f0f3fa270d994ac6d14380781235d26.png)

从上面的结果来看，尽管模型在第一个窗口期(0-2 小时)的预测中表现不佳，但准确性在第二个窗口期(0-4 小时)飙升至 94.09%，并随着窗口期的延长而不断提高。因此，这种随机森林模型可以非常有助于定位在他/她入院的前四个小时期间有潜在 ICU 需求的患者，准确率超过 90%。

# 未来的改进

1.  可以进行更多的模型简化来改进随机森林模型并防止过拟合。
2.  对 0-2 小时窗口期的预测仍然不够准确。为了提高准确度和召回分值，可以使用更多的数据来训练模型。
3.  使用更好的模型可以进一步减少假阴性预测的数量，以便需要 ICU 服务的人不会被忽视，并且可以向他们提供适当的护理。