<html>
<head>
<title>Integrating Google Maps API with Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将谷歌地图API与Unity集成</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/integrating-google-maps-api-with-unity-dcef5e461e20?source=collection_archive---------6-----------------------#2021-07-03">https://medium.com/nerd-for-tech/integrating-google-maps-api-with-unity-dcef5e461e20?source=collection_archive---------6-----------------------#2021-07-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="3e99" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">接触天空之眼</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/b8ae349c0b57babef22d6406a59e2ee4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQUjiAwMlw3kyNvVexmhZQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">他们至少可以说“请”</figcaption></figure><p id="f026" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">嘿，我从我的后树林间隙回来了:如果你正在读这篇文章，支持和保护你当地的荒野保护区！</p><p id="d985" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">好了，够了。今天，我们将为我们的保险应用程序用户添加从谷歌地图获取他们当前位置的静态地图的功能，并将其添加到他们的新索赔中。让我们开始吧。</p><p id="e5cb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">如果你正在跟进，对于这个过程，你将需要一个<a class="ae kj" href="https://developers.google.com/maps/gmp-get-started" rel="noopener ugc nofollow" target="_blank">谷歌地图API键</a>。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kk"><img src="../Images/bb03f8760f38592320373857cafee476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5PYiBh6Gr-v-AOjD_OvUg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">脚本细节被隐藏，因为SHHHH API密钥是秘密的！</figcaption></figure><p id="9d3b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">首先，我将转到我的位置面板的C#脚本，并创建必要的变量来创建请求我们的地图和处理表单信息的URL。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kl"><img src="../Images/8d2d3f15ae00317dd9efd40713b3b12e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0ijz_S3IlZY0XnoDeYjkw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">这些变量是公共的，因为这是一个演示，比序列化每个字段在编辑器中查看要简单。</figcaption></figure><p id="0139" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">网址是根据谷歌提供的<a class="ae kj" href="https://developers.google.com/maps/documentation/maps-static/start" rel="noopener ugc nofollow" target="_blank">指令格式化的。要构建它，我们只需使用这些指令中提供的参数关键字从变量中构建一个新的字符串。</a></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kl"><img src="../Images/6cd21eb95ceb6f4a12a2acab4bd5c904.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*shHgV_HlCV7nVVdkaKXieA.png"/></div></div></figure><p id="4b2e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">但是为了得到latCoord和longCoord的值，我们需要首先确保我们是在使用UnityEngine的<em class="km">。联网</em>。</p><p id="81ac" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Unity为定位服务提供了Start()和Stop()方法，因此您可以精确控制您的应用程序何时主动尝试了解设备的位置。我们只在这一小段代码中需要它，所以这是这个过程的第一部分也是最后一部分。一旦定位服务打开，我们循环等待20秒，每秒检查是否有来自谷歌的结果。根据发生的情况，我们要么记录一个错误，要么请求变量所需的数据。</p><p id="dfb1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">下面是伪代码:</p><blockquote class="kn ko kp"><p id="5e8e" class="jn jo km jp b jq jr ij js jt ju im jv kq jx jy jz kr kb kc kd ks kf kg kh ki hb bi translated">如果位置服务已启用<br/>…启动()位置服务<br/>…设置最大等待时间<br/>…同时状态==正在初始化，最大等待时间&gt; 0 <br/> …等待第二秒<br/> …最大等待时间-1<br/>…如果等待时间为0，则记录“超时”<br/>…如果状态==失败，则记录“无法确定位置”<br/>…否则，获取lat和long<br/>…停止()位置服务<br/>否则记录“位置服务未启用”</p></blockquote><p id="e958" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因为我们在等待秒，所以我们需要将它放在IEnumerator类型的方法中，并使用yield语句。我们希望地图立即加载，所以我们将把<em class="km"> void Start() </em>变成<em class="km"> IEnumerator Start(): </em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kl"><img src="../Images/a7a607d8fd167218ba1ec546fe42a24f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhsCicTj7qqAgYABGoIsfw.png"/></div></div></figure><p id="d3a5" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，我们将构建另一个协程，使用从用户设备获得的位置数据从Google获取地图数据。我们构建URL(如上)，然后启用Unity Web请求。我们可以在Unity的SendWebRequest()方法上产生return，而不是while循环。如果该方法返回一个错误，我们将记录它。否则，我们将我们的图像纹理分配给我们下载的图像。</p><p id="92b9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在伪代码中:</p><blockquote class="kn ko kp"><p id="376f" class="jn jo km jp b jq jr ij js jt ju im jv kq jx jy jz kr kb kc kd ks kf kg kh ki hb bi translated">构造url和参数<br/>打开unity web请求以从url获取地图纹理<br/>…等待结果<br/>…如果结果是错误的，记录错误<br/>将地图UI图像纹理设置为下载的地图图像</p></blockquote><p id="1cdd" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在C#中:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kl"><img src="../Images/0cffcb71ad64f17b1561b77dc2643f9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZV0w5kcQpZAMnZz6uz0sdw.png"/></div></div></figure><p id="0d66" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">整个过程就是这样。为了不向您展示我的地下巢穴在哪里，我不会显示代码的结果——但它是有效的！</p><p id="656f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">明天我将介绍一个非常简洁的Unity免费插件，它可以从任何设备上的任何相机抓取图像。我们将使用该插件允许我们的用户拍摄索赔现场的照片。</p></div></div>    
</body>
</html>