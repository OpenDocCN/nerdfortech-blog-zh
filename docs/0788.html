<html>
<head>
<title>SQL Injection practical overview (1/2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL注入实践概述(1/2)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/sql-injection-practical-overview-1-2-1da0407078ea?source=collection_archive---------12-----------------------#2021-02-13">https://medium.com/nerd-for-tech/sql-injection-practical-overview-1-2-1da0407078ea?source=collection_archive---------12-----------------------#2021-02-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c004" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库一直以来就存在，大约50年前，许多项目被放在一起，并转化为今天所知的SQL或结构化查询语言。很多东西的出现只是为了得到我们今天所知道的数据库。</p><p id="9fad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在实用之前，我们需要把SQL作为一门语言来谈。</p><p id="35ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能知道，SQL不是一种产品，而是一种用于管理和从数据库获取数据的标准编程语言。SQL是当今的ISO规范，许多产品都基于该规范。</p><p id="6d80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQL套件作为:</p><ol class=""><li id="b72b" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">一种用于访问数据库的编程语言</li><li id="ccf4" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">用于处理数据完整性和视图的数据定义语言</li><li id="8001" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">一种动态的集成交易控制机制</li><li id="7e8b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">探索关系系统的灵活性和能力的机制</li><li id="b4f7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">一种控制数据寄存器集合而不是单个寄存器的方法</li></ol><p id="d70a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQL很多。我无法想象没有数据库的软件解决方案或产品，以及任何可用产品中没有SQL的情况。</p><p id="5c5e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天，我们有更多的数据存储选择，但在15年前，这是不可想象的。SQL是数据库中使用最多的语言，并且仍然被大量采用。</p><h1 id="c760" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">SQLi</h1><p id="a6f9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">SQL注入通常是通过web应用程序客户端的数据输入进行的SQL代码插入。这种插入可以在完全或部分模式下发现，并将导致访问数据库、获得权限以及获取数据或删除记录</p><p id="3911" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于您的后端代码实现和任何特权设置，您不仅可以访问数据库，还可以访问其他数据库。你可以执行基于操作系统的命令并控制你的系统。</p><p id="822c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种攻击在find中非常常见，因为易于检测和利用，所以被列入OWASP前10名。如果数据库设置配置错误，影响将是巨大的</p><p id="3196" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">数据库是存储所有信息的地方，如果这一部分被破坏，你将有一个大问题。作为一个公司，你会赔钱和信誉是事实。黑客的动机是金钱，任何形式的数据窃取对他们来说都是后来的收入。</p><p id="4d93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQLi可用于DDoS，用于数据探索和操作，也可危及基础设施，其中:</p><ol class=""><li id="0391" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">DDoS可以通过注入一个<code class="du ku kv kw kx b">DROP TABLE</code> SQL命令来实现，使整个系统因数据库不一致而不可用。</li><li id="747e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">通过进行数据探索，你可以了解数据库是如何构建的，检查任何内容，插入新用户，或任何想到的事情。</li><li id="6980" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">损害基础设施可以通过多种方式完成，您可以加载一个Webshell工具，如<code class="du ku kv kw kx b">C99Shell</code>(如果您使用PHP)，或者可能生成反向会话、执行远程连接等等。</li></ol><h2 id="a997" class="ky js hi bd jt kz la lb jx lc ld le kb iq lf lg kf iu lh li kj iy lj lk kn ll bi translated">SQLi类型</h2><p id="b8ad" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">有两种类型的<strong class="ih hj"> SQLi </strong>注射可供选择。<strong class="ih hj">经典</strong> <strong class="ih hj"> SQLi </strong>和<strong class="ih hj">盲SQLi，</strong>的结果相同，但显示返回的数据不同。</p><p id="4bce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">经典SQLi </strong>基于字符输入或布尔表达式生成一个错误，该错误会生成一个通用或非通用的错误消息。通用消息不显示任何与操作系统或路由相关的ID，也不显示错误细节，它只提示错误本身的名称。</p><p id="39aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，<strong class="ih hj">盲SQLi </strong>用于由于可能的注射而没有错误消息，并且网站代码执行(内部SQL查询)没有返回数据的情况。在这里，攻击者将尝试插入抛出布尔值True作为结果的查询，并尝试推断查询执行的信息类型。</p><p id="8c80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当执行顺利时，它将显示预期的内容，而不是错误消息。</p><h2 id="64a1" class="ky js hi bd jt kz la lb jx lc ld le kb iq lf lg kf iu lh li kj iy lj lk kn ll bi translated">发送信息</h2><p id="a94f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">如果你熟悉web开发(应该可以)，你应该已经知道有两种使用<strong class="ih hj"> HTTP </strong>协议动词向服务器发送数据的方法，它们是<code class="du ku kv kw kx b">GET</code>和<code class="du ku kv kw kx b">POST</code>方法。</p><p id="5a7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">POST</code>方法在内部发送信息，从URL看不到，可以以纯文本或任何编码方式发送。它可以由后端以简单的方式打印出来。这也可以被诸如Burpsuite之类的嗅探器捕获。</p><p id="8457" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">GET</code>方法将信息作为查询字符串直接发送到URL，也可以以纯文本或任何特定的编码技术发送。这里有一个例子</p><p id="16d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">process.php?name=David&amp;lastname=Lares</code></p><p id="fa24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">name</code>和<code class="du ku kv kw kx b">lastname</code>都是标识符或易受攻击的参数(接下来解释)</p><h2 id="d45f" class="ky js hi bd jt kz la lb jx lc ld le kb iq lf lg kf iu lh li kj iy lj lk kn ll bi translated">评估脆弱参数</h2><p id="0c70" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">在SQLi中取得成功的关键是，作为攻击者，您必须找到(或识别出)一段代码，这段代码不能执行正确的输入参数验证，而这些输入参数是以某种方式用于组成数据库查询的。</p><p id="5169" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过引用输入参数，我们可以假设在客户端-服务器架构中，我们指的是环境的客户端。这意味着我们通过HTML表单或直接操作URL，将来自客户端的任何输入集发送到后端。</p><p id="8ff7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当使用<strong class="ih hj"> GET </strong>方法时，所有数据都是从URL发送的，您需要使用<code class="du ku kv kw kx b">“</code> (ASCII <code class="du ku kv kw kx b">%27</code>)来生成错误。</p><p id="9d36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而且，当使用<strong class="ih hj"> POST </strong>方法时，参数是不可见的，所以你需要使用类似<code class="du ku kv kw kx b">tamperdata</code>的工具，或者类似<strong class="ih hj"> Burpsuite </strong>、<strong class="ih hj"> Acunetix、</strong>或<strong class="ih hj"> Fitler </strong>的代理工具来识别易受攻击的参数。</p><p id="7180" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们来练习一下！</p><p id="4276" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们测试一个已知的经典SQLi。如果我们回忆一下，需要一个布尔表达式</p><p id="56a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个例子:</p><p id="5735" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">SELECT * FROM users WHERE uname='$username' AND pwd='$password';</code></p><p id="4574" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ku kv kw kx b">$username</code>和<code class="du ku kv kw kx b">$password</code>都是PHP变量，没有以任何方式进行净化或过滤，SQL语句正在替换<code class="du ku kv kw kx b">uname</code>和<code class="du ku kv kw kx b">pwd</code>条件中的原始变量内容。</p><p id="6fc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一点上看起来很正常，但是利用这种不确定的行为将需要一个布尔<code class="du ku kv kw kx b">True</code>语句。我们将修改我们的查询为:</p><pre class="lm ln lo lp fd lq kx lr ls aw lt bi"><span id="181c" class="ky js hi kx b fi lu lv l lw lx">$username = 1' or '1' = '1;<br/>SELECT * FROM users WHERE uname='$username';</span></pre><p id="a593" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以看作是:</p><pre class="lm ln lo lp fd lq kx lr ls aw lt bi"><span id="d09a" class="ky js hi kx b fi lu lv l lw lx">SELECT * FROM users WHERE uname= 1' or '1' = '1;</span></pre><p id="e152" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在URL中，<code class="du ku kv kw kx b">%20</code>被表示为<code class="du ku kv kw kx b">''</code>，这不是基于编码，而是一种发送字符串的方式。因此，此时<code class="du ku kv kw kx b">' or '1' = '1</code>将总是解析一个<code class="du ku kv kw kx b">True</code>语句，其中:</p><ol class=""><li id="3afc" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">第一个和第二个<code class="du ku kv kw kx b">'</code>标记了一个<code class="du ku kv kw kx b">OR</code> SQL语句</li><li id="846b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">第三个和第四个<code class="du ku kv kw kx b">'</code>标志为<code class="du ku kv kw kx b">=</code>标志</li><li id="c314" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">在真值表中<code class="du ku kv kw kx b">T or 1</code>将解析一个<strong class="ih hj">真</strong>语句。因此，1或(<code class="du ku kv kw kx b">1 = 1</code>即<strong class="ih hj">真</strong>)将导致<strong class="ih hj">真语句</strong></li></ol><p id="1a4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于此<strong class="ih hj"> GET </strong>示例，注入成功</p><p id="7def" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj">后</strong>的场景，事情好像有点变化。对于像这样的手动场景，我们需要拦截请求，而Burpsuite代理是完美的工具。</p><ol class=""><li id="7ff3" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">让我们将代理服务器与浏览器设置同步</li><li id="c9ff" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">设定<code class="du ku kv kw kx b">Intercept IS ON</code>机构</li><li id="a736" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">执行一个请求，看看HTTP主体和头发生了什么。</li><li id="5d33" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">编写您的查询修改并单击<code class="du ku kv kw kx b">FORWARD</code>继续提交请求执行。</li></ol><p id="327e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是最简单的SQLi示例。</p><p id="c6d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里还有一个:</p><pre class="lm ln lo lp fd lq kx lr ls aw lt bi"><span id="fcd1" class="ky js hi kx b fi lu lv l lw lx">$username = `; DROP TABLE users; --`<br/>$password = `OR ``=`</span></pre><p id="37fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">致使</p><pre class="lm ln lo lp fd lq kx lr ls aw lt bi"><span id="6659" class="ky js hi kx b fi lu lv l lw lx">SELECT user_id FROM users where user_id = `;DROP TABLE user ; -- ` and password = ``OR`` = ``</span></pre><p id="21fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这里的目标是向你解释事情是如何完成的，但是你可以随时参考<code class="du ku kv kw kx b">OTG-INPVAL-005</code>文件来获得提示和工作示例。</p><p id="df7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一部分，让我们认真对待工具</p><p id="4f51" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在那里见。</p></div></div>    
</body>
</html>