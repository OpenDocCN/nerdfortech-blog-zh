<html>
<head>
<title>How to Prune and Sparse YOLOv5 ❓</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何修剪和稀疏约洛夫 5 ❓</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-prune-sparse-yolov5-da19e1d84a6?source=collection_archive---------0-----------------------#2022-02-03">https://medium.com/nerd-for-tech/how-to-prune-sparse-yolov5-da19e1d84a6?source=collection_archive---------0-----------------------#2022-02-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="64ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi jd translated"><span class="l je jf jg bm jh ji jj jk jl di"> Y </span> olov5 是一个现代的物体检测算法，这是用 PyTorch 写的，除此之外，它还有，<em class="jm">速度快，精度高，易于安装和使用。</em></p><p id="c2e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jm">yolov 5 的重要性提高，由于其不同的出口和部署模块。我们可以转换训练好的模型(。pt)在许多分机中即</em></p><ul class=""><li id="7e3a" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated"><em class="jm">火炬(。pt) → tensorflow-lite(。TF lite)</em><strong class="ih hj"><em class="jm"/></strong>{用于 android 开发等)</li><li id="bae9" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated"><em class="jm">火炬→开放-神经网络-交换(。onnx)</em>{用于跨平台}</li><li id="7b08" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated"><em class="jm">火炬→Tensorrt-发动机(。trt/。发动机)</em>{用于 Tensorrt 集成)</li></ul><p id="e7c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">修剪？</strong></p><blockquote class="kb kc kd"><p id="63c0" class="if ig jm ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">剪枝是<strong class="ih hj"/>通过减少权重参数来修改权重的过程，不影响类别的分类<strong class="ih hj">。</strong> Yolov5 使用剪枝技术，其方式是“随机地在某个百分比的权重参数中，<strong class="ih hj"> nn.conv2d </strong>层的权重接近于零，<strong class="ih hj">它会将它们转换为零</strong>”。</p></blockquote><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/d501d2d2a72372873554f8661df2c95a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TCmdbUimA6Nn0xdJoRwqjg.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">Yolov5 修剪工作流程</figcaption></figure><p id="e66d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> YOLOV5 修剪程序？</strong></p><p id="ad49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您首先需要在您的自定义数据上训练 yolov5，一旦训练完成，然后您需要在验证数据上验证您训练的模型，这时您可以调用 prune 函数对训练的模型进行修剪。</p><blockquote class="kb kc kd"><p id="1916" class="if ig jm ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated">您可以使用您自定义训练的 weights <strong class="ih hj"> best.pt </strong>文件来修剪以下代码，如果您只想修剪模型以获得概念，那么您可以下载 yolov5s.pt 文件并用以下代码修剪该文件。</p></blockquote><p id="4e95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您使用的是自定义模型，请打开 yolov5 文件夹，在该文件夹中您已经执行了培训，打开 val.py 文件，并将提到的代码粘贴到图像中显示的位置。否则，您可以从 GitHub 克隆 yolov5 存储库，并安装它的依赖项。打开 val.py 文件，将上面提到的代码粘贴到图中所示的位置。</p><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="c218" class="lc ld hi ky b fi le lf l lg lh">from utils.torch_utils import prune<br/>prune(model,0.3)</span></pre><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es li"><img src="../Images/5866f0b53120cf1d2c602a2c64bfce40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TOX4BhCfyahMZHbg0xHuNw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx translated">Yolov5 修剪</figcaption></figure><p id="6d25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦你添加了上面的代码，然后保存文件。然后在同一文件夹中打开终端，并运行下面的命令。此命令将修剪您的模型。</p><blockquote class="kb kc kd"><p id="f5cf" class="if ig jm ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated"><strong class="ih hj">注意:</strong>如果您正在修剪您的定制模型，那么首先将它的<strong class="ih hj"> best.pt </strong>文件存储在其他地方，因为修剪将删除该文件，并将在相同的位置创建具有相同名称<strong class="ih hj"> best.pt </strong>的新文件。</p></blockquote><pre class="ki kj kk kl fd kx ky kz la aw lb bi"><span id="89a3" class="lc ld hi ky b fi le lf l lg lh">python3 val.py --data "coco.yaml or your custom data.yaml" --weights "yolov5s.pt or your custom file.pt"</span></pre><p id="3ee9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以通过调用剪枝函数来设置剪枝的百分比，如上图，我已经用<strong class="ih hj"> <em class="jm"> 30%稀疏度</em> </strong>剪枝了我的模型。也就是说模型在<strong class="ih hj"> <em class="jm"> nn.conv2d </em> </strong>层中 30%的权重参数会等于 0，而<strong class="ih hj"> <em class="jm"> AP(平均精度)和 AR(平均召回)</em> </strong>得分会略有降低。你可以根据你的用例来改变它。</p><blockquote class="kb kc kd"><p id="c3cd" class="if ig jm ih b ii ij ik il im in io ip ke ir is it kf iv iw ix kg iz ja jb jc hb bi translated"><strong class="ih hj">以上是关于什么是修剪的全部内容&amp;在 yolov5 中修剪是如何工作的？<em class="hi"> </em> </strong>更多详情可以访问<a class="ae lj" href="https://github.com/ultralytics/yolov5/issues/304" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="hi">剪枝/稀疏</em></strong></a><strong class="ih hj"><em class="hi"/></strong>教程和<a class="ae lj" href="https://github.com/ultralytics/yolov5/issues/6514" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> <em class="hi">期</em></strong></a><a class="ae lj" href="https://github.com/ultralytics/yolov5" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"><em class="hi">约洛夫</em> </strong> </a>。</p></blockquote><p id="6cd2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于我</strong> ❓</p><p id="cbe3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有超过 1 年半的软件开发工作经验。目前，我是一名软件工程师，通过使用零售分析、建立大数据分析工具、创建和维护模型以及加入引人注目的新数据集，为我们的客户改进产品和服务。</p><p id="717c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jm">之前，我是 Spark 基金会的计算机视觉实习生，在那里我体验了对来自不同开源平台(如 Kaggle、google images、open images 等)的视觉数据的分析。)，并在该数据上训练不同的深度学习模型。</em></p><ul class=""><li id="94c9" class="jn jo hi ih b ii ij im in iq jp iu jq iy jr jc js jt ju jv bi translated"><a class="ae lj" href="https://www.linkedin.com/in/muhammadrizwanmunawar/" rel="noopener ugc nofollow" target="_blank"> <em class="jm">在 LinkedIn 上联系我</em> </a></li><li id="f463" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated"><a class="ae lj" href="https://www.upwork.com/services/product/consultation-1477666319161577472?ref=project_share" rel="noopener ugc nofollow" target="_blank"> <em class="jm">与我协商</em> </a></li><li id="4e55" class="jn jo hi ih b ii jw im jx iq jy iu jz iy ka jc js jt ju jv bi translated"><a class="ae lj" href="https://www.upwork.com/services/product/you-will-get-image-classification-projects-using-machine-learning-with-python-1323963101029052416?ref=project_share" rel="noopener ugc nofollow" target="_blank"> <em class="jm">我的 yolov5 服务</em> </a></li></ul><p id="5e4b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jm">如有疑问请在下方随意评论</em> </strong></p></div></div>    
</body>
</html>