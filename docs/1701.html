<html>
<head>
<title>Working with Rocket Chat and OpenID Connect (RH-SSO)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Rocket Chat 和 OpenID Connect (RH-SSO)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/working-with-rocket-chat-and-openid-connect-rh-sso-7c420a2ece3?source=collection_archive---------7-----------------------#2021-04-02">https://medium.com/nerd-for-tech/working-with-rocket-chat-and-openid-connect-rh-sso-7c420a2ece3?source=collection_archive---------7-----------------------#2021-04-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="b2cb" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">为什么是火箭聊天？</h1><p id="6f6d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">嗯……有很多原因。我已经在离线环境中工作了很长时间，我还没有发现像 Rocket Chat 这样好的社区/社区交流的网络应用程序。在 Rocket Chat 中，我可以为每个群组创建一个频道，并授予任何我想授予的权限(作为管理员)。<br/>更重要的是，我注意到组织内部的沟通更好了，不同团队之间的中间沟通显著增加了。</p><h1 id="4053" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">教程里有什么？</h1><p id="4089" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在本教程中，我将介绍如何在我们的 OpenShift 环境中运行 Rocket chat 的小型部署，以及如何将其配置为与我们的组织 OpenID Connect provider(在我们的示例中是 Red Hat SSO)一起工作</p><h1 id="51f1" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">从哪里开始？</h1><p id="9792" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">首先，我们将部署一个非常小的 rocket chat 部署(如果您想要企业级部署，这里有一个很棒的教程<a class="ae kb" href="https://www.arctiq.ca/our-blog/2019/7/29/rocketchat/" rel="noopener ugc nofollow" target="_blank"/>)然后，我们将 Rocket Chat 连接到 RH SSO。</p><p id="99ce" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated"><strong class="jf hj">注意！本文档已经假设您正在运行 RH SSO(或 Keycloak)应用程序。如果你还没有这样做，你可以关注我关于如何配置 RH SSO (keycloak)应用程序的故事<a class="ae kb" href="https://itnext.io/using-httpd-as-a-reverse-proxy-for-openid-connect-authentication-791d7e517608" rel="noopener ugc nofollow" target="_blank">这里</a></strong></p><h1 id="e1ef" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">部署</h1><p id="ca8f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">和往常一样，让我们首先创建项目:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7b21" class="kq ig hi km b fi kr ks l kt ku"># oc new-project rocketchat</span></pre><h2 id="f40a" class="kq ig hi bd ih kv kw kx il ky kz la ip jo lb lc it js ld le ix jw lf lg jb lh bi translated">部署 MongoDB</h2><p id="de44" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Rocket Chat 的数据库是用副本集配置的 MongoDB。在我们的例子中，我们将只启动一个 POD，但是我们仍然需要确保它提供一个副本集。为此，我们将使用带 args 选项的 statefulset。</p><p id="a2ae" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们的 mongodb 将需要一个持久存储，所以首先我们将为它创建一个 PVC，然后是 POD 本身。</p><p id="93f3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">对于持久存储:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="518c" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; mongodb-pvc.yaml &lt;&lt; EOF<br/>apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: mongodb-pvc<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  volumeMode: Filesystem<br/>  resources:<br/>    requests:<br/>      storage: 1Gi<br/>EOF</span></pre><p id="60fc" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">并且适用于以下情况:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3aaa" class="kq ig hi km b fi kr ks l kt ku"># oc apply -f mongodb-pvc.yaml</span></pre><p id="5d16" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">接下来，我们将创建 statefulset:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="5591" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; mongodb-sfs.yaml &lt;&lt; EOF<br/>kind: StatefulSet<br/>apiVersion: apps/v1<br/>metadata:<br/>  name: mongo<br/>  labels:<br/>    k8s-app: mongo<br/>spec:<br/>  serviceName: mongo<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      k8s-app: mongo<br/>  template:<br/>    metadata:<br/>      labels:<br/>        k8s-app: mongo<br/>        name: mongo<br/>    spec:<br/>      terminationGracePeriodSeconds: 10<br/>      volumes:<br/>      - name: mongo<br/>        persistentVolumeClaim:<br/>          claimName: mongodb-pvc<br/>      containers:<br/>      - image: registry.example.com/mongo:4.2<br/>        name: mongo<br/>        volumeMounts:<br/>        - mountPath: /data/db<br/>          name: mongo<br/>        ports:<br/>        - name: mongo<br/>          containerPort: 27017<br/>        args:<br/>        - --replSet=rs01<br/>        resources:<br/>          requests:<br/>            cpu: "100m"<br/>            memory: "64Mi"<br/>          limits:<br/>            cpu: "500m"<br/>            memory: "512Mi"<br/>EOF</span></pre><p id="df5d" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">并应用它:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="3fc3" class="kq ig hi km b fi kr ks l kt ku"># oc apply -f mongodb-sfs.yaml</span></pre><p id="ef5b" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">接下来，我们将创建一个小型 cron 作业，它将在出现故障时启动副本集。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ef2c" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; mongodb-cronjob.yaml &lt;&lt; EOF<br/>apiVersion: batch/v1<br/>kind: Job<br/>metadata:<br/>  name: mongo-0-init<br/>spec:<br/>  backoffLimit: 4<br/>  template:<br/>    spec:<br/>      containers:<br/>      - name: mongo-0-init<br/>        image: mongo:4.2<br/>        command: ["sh", "-c", "sleep 15; mongo mongo-0.mongo/rocketchat --eval \"rs.initiate({_id: 'rs01',members: [ { _id: 0, host: 'mongo-0.mongo:27017' } ]})\""]<br/>      restartPolicy: OnFailure<br/>EOF</span></pre><p id="18f8" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">并应用它:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="4f54" class="kq ig hi km b fi kr ks l kt ku"># oc create -f mongodb-cronjob.yaml</span></pre><p id="04f1" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在我们想要访问我们的 mongodb，所以让我们继续为它创建一个服务:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="d302" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; mongodb-svc.yaml &lt;&lt; EOF<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: mongo<br/>  labels:<br/>    k8s-app: mongo<br/>    name: mongo<br/>spec:<br/>  ports:<br/>  - port: 27017<br/>    targetPort: 27017<br/>  selector:<br/>    k8s-app: mongo<br/>EOF</span></pre><p id="ee29" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">创建完成后，我们就可以进入应用程序部分了:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="f60c" class="kq ig hi km b fi kr ks l kt ku"># oc apply -f mongodb-svc.yaml</span></pre><h2 id="b1f7" class="kq ig hi bd ih kv kw kx il ky kz la ip jo lb lc it js ld le ix jw lf lg jb lh bi translated">火箭聊天部署</h2><p id="16bb" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Rocket Chat 将数据存储在数据库之外的文件中，因此它需要自己的 PVC:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ca78" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; rocketchat-data-pvc.yaml &lt;&lt; EOF<br/>apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: rocketchat-data-pvc<br/>spec:<br/>  accessModes:<br/>    - ReadWriteOnce<br/>  volumeMode: Filesystem<br/>  resources:<br/>    requests:<br/>      storage: 1Gi<br/>EOF</span></pre><p id="eec4" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">让我们来应用它:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="5984" class="kq ig hi km b fi kr ks l kt ku"># oc apply -f rocketchat-data-pvc.yaml</span></pre><h2 id="6202" class="kq ig hi bd ih kv kw kx il ky kz la ip jo lb lc it js ld le ix jw lf lg jb lh bi translated">添加自定义 CA 证书</h2><p id="109f" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">使用 OpenID Connect 取决于通过 TLS 验证过程的应用程序。为了做到这一点，我们需要添加我们的自定义 CA 证书到火箭聊天图像。</p><p id="90c2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">要做到这一点，有两种方法:</p><ol class=""><li id="eb7a" class="li lj hi jf b jg kc jk kd jo lk js ll jw lm ka ln lo lp lq bi translated">将 CA 添加到映像中</li><li id="2800" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">使用 CA 证书文件创建配置映射。</li></ol><p id="c7d3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在我们的例子中，出于几个原因，我们将把 CA 添加到我们的映像中。<br/>感觉我们在一个断开的环境中工作，我们将我们的图像定向到一个内部注册表(在我们的例子中是 registry.example.com ),所以改变图像的摘要几乎没有影响。其次，我认为了解多种方法来实现您想要的是一个好的实践，如果在某些情况下，我们想要创建一个操作符(未来的提示)并使用该操作符部署应用程序，那么我们将无法向它添加配置映射(除非它是操作符的一部分)。<br/>要更新镜像，我们需要做的就是将 CA 证书复制到镜像中，并通过一个环境变量告诉 node.js (Rocket Chat 的中间件)我们添加的证书。</p><p id="cebe" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">要添加 ca，请创建以下 Dockerfile : <br/>(在我们的示例中，我们的 CA 证书文件被命名为 ca.crt，它与 Dockerfile 文件位于同一目录中。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="1670" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; Dockerfile &lt;&lt; EOF<br/>FROM registry.example.com/rocket.chat:latest<br/>MAINTAINER You Rock</span><span id="2b58" class="kq ig hi km b fi lw ks l kt ku">USER root<br/>RUN mkdir /etc/certs<br/>COPY ca.crt /etc/certs/keycloak.crt<br/>USER rocketchat<br/>EOF</span></pre><p id="2b7f" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">我们使用 buildah 来更新图像，然后将它推回我们的注册表。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="357d" class="kq ig hi km b fi kr ks l kt ku"># buildah bud -f Dockerfile -t registry.example.com/rocket.chat<br/># buildah push registry.example.com/rocket.chat:latest</span></pre><p id="2525" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">既然映像已经更新，我们需要将“NODE_EXTRA_CA_CERTS”环境变量添加到 rocket chat 部署中，并将 rocket chat 指向 mongodb。</p><p id="0980" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">部署文件应该如下所示:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="725e" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; rocketchat-deployment.yaml &lt;&lt; EOF<br/>kind: Deployment<br/>apiVersion: apps/v1<br/>metadata:<br/>  name: rocketchat<br/>  labels:<br/>    k8s-app: rocketchat<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      k8s-app: rocketchat<br/>  template:<br/>    metadata:<br/>      labels:<br/>        k8s-app: rocketchat<br/>        name: rocketchat<br/>    spec:<br/>      volumes:<br/>      - name: rocketchat<br/>        persistentVolumeClaim:<br/>          claimName: rocketchat-data-pvc<br/>      containers:<br/>      - image: registry.example.com/rocket.chat:latest<br/>        imagePullPolicy: Always<br/>        name: rocketchat<br/>        env:<br/>        - name: INSTANCE_IP<br/>          valueFrom:<br/>            fieldRef:<br/>              fieldPath: status.podIP<br/>        - name: MONGO_URL<br/>          value: "mongodb://mongo-0.mongo:27017/rocketchat?replicaSet=rs01"<br/>        - name: MONGO_OPLOG_URL<br/>          value: "mongodb://mongo-0.mongo:27017/local?replicaSet=rs01"<br/>        - name: ROOT_URL<br/>          value: "<a class="ae kb" href="https://chat.oichman.net" rel="noopener ugc nofollow" target="_blank">https://chat.</a>example.com"<br/>        - name: PORT<br/>          value: "3000"<br/>        - name: NODE_EXTRA_CA_CERTS<br/>          value: /etc/certs/keycloak.crt<br/>        volumeMounts:<br/>        - mountPath: /app/uploads<br/>          name: rocketchat<br/>        ports:<br/>        - name: http<br/>          containerPort: 3000<br/>EOF</span></pre><p id="0d26" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">在我的例子中，我将应用程序指向 pod 名称，但是如果我们愿意，我们也可以选择和使用 mongodb 服务。</p><p id="8d38" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">接下来，我们将为 rocket chat 创建一个服务和入口:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="52b1" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; rocketchat-service.yaml &lt;&lt; EOF<br/>kind: Service<br/>apiVersion: v1<br/>metadata:<br/>  name: rocketchat<br/>spec:<br/>  selector:<br/>    k8s-app: rocketchat<br/>  ports:<br/>    - protocol: TCP<br/>      port: 3000<br/>      name: http<br/>EOF</span></pre><p id="baec" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">因为我们想要通过 TLS/SSL 提供服务，所以我们需要创建我们的证书(一个很好的方法可以在这里找到<a class="ae kb" href="https://two-oes.medium.com/working-with-openssl-and-dns-alternative-names-367f06a23841?sk=28bf711fe07e62e407de071a9f8397b7" rel="noopener"/>)并创建一个保存证书的秘密。</p><p id="2ce3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">要创建秘密通道:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="da71" class="kq ig hi km b fi kr ks l kt ku"># oc create secret generic chat-tls \<br/>--from-file=key.pem=`pwd`/chat.key \<br/>--from-file=cert.pem=`pwd`/chat.crt \<br/>-n rocketchat</span></pre><p id="74d3" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">并为入口创建一个文件:</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="ed04" class="kq ig hi km b fi kr ks l kt ku"># cat &gt; rocketchat-ingress.yaml &lt;&lt; EOF<br/>apiVersion: networking.k8s.io/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: rocketchat-ingress<br/>spec:<br/>  tls:<br/>    - hosts:<br/>      - chat.example.com<br/>      secretName: chat-tls<br/>  rules:<br/>  - host: "chat.example.com"<br/>    http:<br/>      paths:<br/>      - backend:<br/>          serviceName: rocketchat<br/>          servicePort: 3000<br/>        path: /<br/>EOF</span></pre><p id="49dc" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在我们已经完成了部署，我们可以继续进行 OpenID 连接配置了:</p><p id="30b2" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">去 chat.example.com(去你给火箭聊天入口的 FQDN)。<br/>如果这是您第一次创建新的管理员用户，然后转到管理页面:</p><figure class="kh ki kj kk fd ly er es paragraph-image"><div class="er es lx"><img src="../Images/0d60c3320e704b881bb15f4479ab3bd1.png" data-original-src="https://miro.medium.com/v2/resize:fit:320/format:webp/1*1S02tN1CHtWix-4SCF-9pQ.png"/></div></figure><p id="2ddc" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">然后向下滚动到“oauth”(或者转到:<a class="ae kb" href="https://chat.oichman.net/admin/OAuth" rel="noopener ugc nofollow" target="_blank">https://</a><code class="du mb mc md km b"><a class="ae kb" rel="noopener ugc nofollow" target="_blank" href="/nerd-for-tech/{keycloak_ip_address}:{port}/auth">{rocket_chat_URL}</a></code><a class="ae kb" href="https://chat.oichman.net/admin/OAuth" rel="noopener ugc nofollow" target="_blank">/admin/OAuth</a>:</p><figure class="kh ki kj kk fd ly er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es me"><img src="../Images/109f2eadb781d50cc417311f7dbed5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JIUXuI3u5gpr4N5Up3qkhA.png"/></div></div></figure><p id="52dc" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在点击“添加自定义 oauth”(在右上角) :</p><figure class="kh ki kj kk fd ly er es paragraph-image"><div class="er es mj"><img src="../Images/044766cb94923390308b1508a3b13eaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:810/format:webp/1*NdhaDf2XsJ5vnqUv2y6Mfw.png"/></div></figure><p id="cd61" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">添加一个名称(类似“RH-SSO”)</p><p id="f4d7" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">然后开始填充以下值:</p><p id="1388" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">以下配置中提供的 URL 路径也可以通过导航到领域设置并点击<code class="du mb mc md km b">General Tab</code>中的端点链接来获得。配置以下设置时，用适当的域名替换<code class="du mb mc md km b">realm_name</code>。Keycloak 提供的默认领域是<code class="du mb mc md km b">master</code>。</p><ol class=""><li id="7949" class="li lj hi jf b jg kc jk kd jo lk js ll jw lm ka ln lo lp lq bi translated">确保您切换到启用栏</li><li id="9365" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">网址:<code class="du mb mc md km b"><a class="ae kb" rel="noopener ugc nofollow" target="_blank" href="/nerd-for-tech/{keycloak_ip_address}:{port}/auth">http://{rh-sso_</a><a class="ae kb" rel="noopener ugc nofollow" target="_blank" href="/nerd-for-tech/{keycloak_ip_address}:{port}/auth">URL</a><a class="ae kb" rel="noopener ugc nofollow" target="_blank" href="/nerd-for-tech/{keycloak_ip_address}:{port}/auth">:{port}/auth</a></code></li><li id="68f5" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">令牌路径:<code class="du mb mc md km b">/realms/{realm_name}/protocol/openid-connect/token</code></li><li id="c77f" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">令牌发送方式:标头</li><li id="add0" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">身份令牌通过发送:与“令牌通过发送”相同</li><li id="dbd4" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">身份路径<code class="du mb mc md km b">/realms/{realm_name}/protocol/openid-connect/userinfo</code></li><li id="3ba5" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">授权路径<code class="du mb mc md km b">/realms/{realm_name}/protocol/openid-connect/auth</code></li><li id="2483" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">适用范围:<code class="du mb mc md km b">openid</code></li><li id="e38b" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">访问令牌的参数名称:<code class="du mb mc md km b">access_token</code></li><li id="6841" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">Id:这是火箭的 id。keycloak 中创建的聊天客户端<code class="du mb mc md km b">rocket-chat-client</code></li><li id="d7e2" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">Secret:创建火箭时在 credentials 选项卡中提供的密钥。聊天客户端</li><li id="1803" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">按钮文本:<code class="du mb mc md km b">Login with Keycloak</code></li><li id="77a5" class="li lj hi jf b jg lr jk ls jo lt js lu jw lv ka ln lo lp lq bi translated">点击“保存更改”</li></ol><p id="3210" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">现在注销用户(在“用户”图标上)，现在你会看到“OpenID 连接”链接。</p><figure class="kh ki kj kk fd ly er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es mk"><img src="../Images/0048b3e7473084c80c5422526f93f1f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPsE6nrOD6T4GsTk8RCPxA.png"/></div></div></figure><p id="20df" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">单击它并使用您的组织用户名和密码登录。你将被重定向到火箭聊天。</p><p id="25a5" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">如果您有任何问题，请随时回复/留下您的评论。<br/>你可以在 linkedin 上找到:<a class="ae kb" href="https://www.linkedin.com/in/orenoichman" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/orenoichman</a>T14】或者在 twitter 上找到:<a class="ae kb" href="https://twitter.com/ooichman" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ooichman</a></p><p id="8ad7" class="pw-post-body-paragraph jd je hi jf b jg kc ji jj jk kd jm jn jo ke jq jr js kf ju jv jw kg jy jz ka hb bi translated">玩得开心！！！</p></div></div>    
</body>
</html>