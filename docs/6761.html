<html>
<head>
<title>Sending Emails with NextJS and Amazon Simple Email Services (SES)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 NextJS 和亚马逊简单电子邮件服务(SES)发送电子邮件</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/sending-emails-with-nextjs-and-amazon-simple-email-services-ses-8e4e10d1d397?source=collection_archive---------0-----------------------#2022-05-06">https://medium.com/nerd-for-tech/sending-emails-with-nextjs-and-amazon-simple-email-services-ses-8e4e10d1d397?source=collection_archive---------0-----------------------#2022-05-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="e529" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为亚马逊网络服务的新手，我总是认为发送邮件是一项大任务，并且总是害怕尝试。但是有志者事竟成。这一次，我为一个客户工作，无论如何我必须使用这个功能，这只是我开始工作所需要的小小推动。</p></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><ol class=""><li id="2568" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated">首先，让我们设置一个简单的 NextJS 项目来开始。如果您是 typescript 用户，可以按照 TS 文档开始。你可以在这里看到简单的步骤<a class="ae ju" href="https://nextjs.org/docs" rel="noopener ugc nofollow" target="_blank"/>。</li><li id="bf2a" class="jl jm hi ih b ii jv im jw iq jx iu jy iy jz jc jq jr js jt bi translated">你将需要一些依赖。为了便于使用，我们将使用<em class="jd">节点邮件</em>来创建<a class="ae ju" href="https://nodemailer.com/smtp/" rel="noopener ugc nofollow" target="_blank">传输</a>(基本上是 SMTP 传输)。我们还将需要<a class="ae ju" href="https://www.npmjs.com/package/aws-sdk" rel="noopener ugc nofollow" target="_blank"> AWS 官方 SDK </a>。</li></ol><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ecb7" class="kj kk hi kf b fi kl km l kn ko">npm install nodemailer aws-sdk</span></pre><p id="143d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在需要从您的 AWS 帐户获取 AWS 密钥和 AWS 访问密钥。如果你对此感到困惑，你可以访问他们的官方文档<a class="ae ju" href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html" rel="noopener ugc nofollow" target="_blank">这里</a>。一旦有了密钥，就把它们放在环境文件中。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="1d81" class="kj kk hi kf b fi kl km l kn ko"># .env <br/>AWS_ACCESS_KEY=xxxxxxxxxxxxxxxx</span><span id="7c48" class="kj kk hi kf b fi kp km l kn ko">AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxxxxxxxxx</span></pre><p id="b019" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们添加几个文件来帮助我们解决这个问题。</p><figure class="ka kb kc kd fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es kq"><img src="../Images/6a28c55c1a6fc7e3ff654c017acbb8a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PO_5k9PulaFJGA308rSevw.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">send-email.js 和 aws-ses.js</figcaption></figure><p id="cc9a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">index.js 将是项目的切入点。我们将对电子邮件端点进行简单的 api 调用。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="ad22" class="kj kk hi kf b fi kl km l kn ko">// index.js</span><span id="2206" class="kj kk hi kf b fi kp km l kn ko">import React, { useState } from "react";</span><span id="8c5d" class="kj kk hi kf b fi kp km l kn ko">import styles from "../styles/Home.module.css";</span><span id="16d4" class="kj kk hi kf b fi kp km l kn ko">export default function Home() {</span><span id="52d2" class="kj kk hi kf b fi kp km l kn ko">const [message, setMessage] = useState("");<br/></span><span id="61a1" class="kj kk hi kf b fi kp km l kn ko">const sendMail = async () =&gt; {</span><span id="8c13" class="kj kk hi kf b fi kp km l kn ko">    try {</span><span id="6611" class="kj kk hi kf b fi kp km l kn ko">        setMessage("Sending test mail");</span><span id="95e8" class="kj kk hi kf b fi kp km l kn ko">        const response = await fetch("http://localhost:3000/api/send-email");</span><span id="3bfe" class="kj kk hi kf b fi kp km l kn ko">        const body = await response.json();</span><span id="4175" class="kj kk hi kf b fi kp km l kn ko">        if (body.ok) {</span><span id="9f0b" class="kj kk hi kf b fi kp km l kn ko">            setMessage("Successfully send test mail");</span><span id="8698" class="kj kk hi kf b fi kp km l kn ko">        }</span><span id="5683" class="kj kk hi kf b fi kp km l kn ko">    } catch (error) {</span><span id="564e" class="kj kk hi kf b fi kp km l kn ko">        console.log(error);</span><span id="fae5" class="kj kk hi kf b fi kp km l kn ko">        // handle the error</span><span id="faf2" class="kj kk hi kf b fi kp km l kn ko">    }</span><span id="1261" class="kj kk hi kf b fi kp km l kn ko">};</span><span id="e301" class="kj kk hi kf b fi kp km l kn ko">    return (</span><span id="a614" class="kj kk hi kf b fi kp km l kn ko">        &lt;div className={styles.container}&gt;</span><span id="3a29" class="kj kk hi kf b fi kp km l kn ko">            &lt;button onClick={sendMail}&gt;Send Email&lt;/button&gt;</span><span id="a1b3" class="kj kk hi kf b fi kp km l kn ko">                {message}</span><span id="1645" class="kj kk hi kf b fi kp km l kn ko">        &lt;/div&gt;</span><span id="4f52" class="kj kk hi kf b fi kp km l kn ko">    );</span><span id="0324" class="kj kk hi kf b fi kp km l kn ko">}</span></pre><p id="21db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> send-email.js </em>将是我们将用于该项目的 api 端点。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="9a5a" class="kj kk hi kf b fi kl km l kn ko">// send-email.js</span><span id="82aa" class="kj kk hi kf b fi kp km l kn ko">import { sendTestMail } from "../../service/aws-ses";</span><span id="c502" class="kj kk hi kf b fi kp km l kn ko">export default async function checkUserAPI(request, response) {</span><span id="8507" class="kj kk hi kf b fi kp km l kn ko">const result = await sendTestMail("test@test.com");</span><span id="9556" class="kj kk hi kf b fi kp km l kn ko">    response.json(result);</span><span id="47eb" class="kj kk hi kf b fi kp km l kn ko">}</span></pre><p id="7373" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> aws-ses.js </em>将是服务文件，它将包含发送邮件的实际代码。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="f44b" class="kj kk hi kf b fi kl km l kn ko">// aws-ses.js</span><span id="b8d6" class="kj kk hi kf b fi kp km l kn ko">import * as AWS from "aws-sdk";</span><span id="31c7" class="kj kk hi kf b fi kp km l kn ko">import * as nodemailer from "nodemailer";</span><span id="10e6" class="kj kk hi kf b fi kp km l kn ko">AWS.config.update({</span><span id="7e02" class="kj kk hi kf b fi kp km l kn ko">    accessKeyId: process.env.AWS_ACCESS_KEY,</span><span id="0079" class="kj kk hi kf b fi kp km l kn ko">    secretAccessKey: process.env.AWS_SECRET_ACCESS_KEY,</span><span id="9ea7" class="kj kk hi kf b fi kp km l kn ko">    region: "ap-south-1",</span><span id="0cb7" class="kj kk hi kf b fi kp km l kn ko">});</span><span id="144d" class="kj kk hi kf b fi kp km l kn ko">AWS.config.getCredentials(function (error) {</span><span id="7a28" class="kj kk hi kf b fi kp km l kn ko">    if (error) {</span><span id="8f5c" class="kj kk hi kf b fi kp km l kn ko">        console.log(error.stack);</span><span id="0717" class="kj kk hi kf b fi kp km l kn ko">    }</span><span id="f394" class="kj kk hi kf b fi kp km l kn ko">});</span><span id="1847" class="kj kk hi kf b fi kp km l kn ko">const ses = new AWS.SES({ apiVersion: "2010-12-01" });</span><span id="954d" class="kj kk hi kf b fi kp km l kn ko"><br/>// change this to the "to" email that you want</span><span id="2315" class="kj kk hi kf b fi kp km l kn ko">const adminMail = "yourmail@mail.com";</span><span id="95c5" class="kj kk hi kf b fi kp km l kn ko">// Create a transporter of nodemailer</span><span id="0579" class="kj kk hi kf b fi kp km l kn ko">const transporter = nodemailer.createTransport({</span><span id="af92" class="kj kk hi kf b fi kp km l kn ko">    SES: ses,</span><span id="9719" class="kj kk hi kf b fi kp km l kn ko">});</span><span id="35dd" class="kj kk hi kf b fi kp km l kn ko">export const testMail = async (userEmail) =&gt; {</span><span id="e0c3" class="kj kk hi kf b fi kp km l kn ko">try {</span><span id="225d" class="kj kk hi kf b fi kp km l kn ko">const response = await transporter.sendMail({</span><span id="854f" class="kj kk hi kf b fi kp km l kn ko">from: adminMail,</span><span id="1019" class="kj kk hi kf b fi kp km l kn ko">to: userEmail,</span><span id="f871" class="kj kk hi kf b fi kp km l kn ko">subject: "Test Mail",</span><span id="0396" class="kj kk hi kf b fi kp km l kn ko">html: `</span><span id="a8c8" class="kj kk hi kf b fi kp km l kn ko">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd"&gt;</span><span id="8574" class="kj kk hi kf b fi kp km l kn ko">&lt;html&gt;</span><span id="bed5" class="kj kk hi kf b fi kp km l kn ko">&lt;head&gt;</span><span id="5210" class="kj kk hi kf b fi kp km l kn ko">&lt;meta http-equiv="Content-Type" content="text/html; charset=UTF-8"&gt;</span><span id="c4ff" class="kj kk hi kf b fi kp km l kn ko">&lt;/head&gt;</span><span id="f30a" class="kj kk hi kf b fi kp km l kn ko">&lt;body&gt;</span><span id="a640" class="kj kk hi kf b fi kp km l kn ko">&lt;div style="padding:20px;"&gt;</span><span id="9418" class="kj kk hi kf b fi kp km l kn ko">&lt;div style="max-width: 500px;"&gt;</span><span id="c6a9" class="kj kk hi kf b fi kp km l kn ko">&lt;h2&gt;Test Mail&lt;/h2&gt;</span><span id="58cc" class="kj kk hi kf b fi kp km l kn ko">&lt;p&gt;</span><span id="41e2" class="kj kk hi kf b fi kp km l kn ko">Hi there,&lt;br/&gt;&lt;br/&gt;</span><span id="bb61" class="kj kk hi kf b fi kp km l kn ko">This is a test mail.</span><span id="76fe" class="kj kk hi kf b fi kp km l kn ko">&lt;/p&gt;</span><span id="e6a8" class="kj kk hi kf b fi kp km l kn ko">&lt;/div&gt;</span><span id="94ac" class="kj kk hi kf b fi kp km l kn ko">&lt;/div&gt;</span><span id="fe63" class="kj kk hi kf b fi kp km l kn ko">&lt;/body&gt;</span><span id="a3bf" class="kj kk hi kf b fi kp km l kn ko">&lt;/html&gt;</span><span id="c73c" class="kj kk hi kf b fi kp km l kn ko">`,</span><span id="0290" class="kj kk hi kf b fi kp km l kn ko">});</span><span id="d06c" class="kj kk hi kf b fi kp km l kn ko">return response?.messageId</span><span id="4a02" class="kj kk hi kf b fi kp km l kn ko">? { ok: true }</span><span id="4de3" class="kj kk hi kf b fi kp km l kn ko">: { ok: false, msg: "Failed to send email" };</span><span id="b361" class="kj kk hi kf b fi kp km l kn ko">} catch (error) {</span><span id="1ea9" class="kj kk hi kf b fi kp km l kn ko">console.log("ERROR", error.message);</span><span id="0c3d" class="kj kk hi kf b fi kp km l kn ko">return { ok: false, msg: "Failed to send email" };</span><span id="6ae4" class="kj kk hi kf b fi kp km l kn ko">}</span><span id="e853" class="kj kk hi kf b fi kp km l kn ko">};</span></pre><p id="1ab5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd"> Home.module.scss </em>如果需要就是 css 文件。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="2c8b" class="kj kk hi kf b fi kl km l kn ko">// Home.module.scss<br/>.container {</span><span id="e39d" class="kj kk hi kf b fi kp km l kn ko">    padding: 0 2rem;</span><span id="b10e" class="kj kk hi kf b fi kp km l kn ko">    display: flex;</span><span id="5259" class="kj kk hi kf b fi kp km l kn ko">    justify-content: center;</span><span id="63fc" class="kj kk hi kf b fi kp km l kn ko">    margin-top: 200px;</span><span id="7270" class="kj kk hi kf b fi kp km l kn ko">}</span></pre><p id="b1aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在需要做的就是运行应用程序。你可以用。</p><pre class="ka kb kc kd fd ke kf kg kh aw ki bi"><span id="c5ac" class="kj kk hi kf b fi kl km l kn ko">yarn dev</span></pre><p id="8963" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">结果:</p><figure class="ka kb kc kd fd kr er es paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="er es lc"><img src="../Images/c68ed88fa6a0d6bcf490a3c9ce46a77e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVD7uzSwZQvfgOdg5OUP1g.png"/></div></div><figcaption class="ky kz et er es la lb bd b be z dx translated">默认页面</figcaption></figure><figure class="ka kb kc kd fd kr er es paragraph-image"><div class="er es ld"><img src="../Images/9ebc61843b2b096bdfe881ea3e3a16e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*bBFspRePOHmd7mkqUK2_BQ.png"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">已发送邮件</figcaption></figure><figure class="ka kb kc kd fd kr er es paragraph-image"><div class="er es le"><img src="../Images/54ba533a4fbbd9e9e089d1bc293d3189.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*A23wB3awqPbn8xmalXs75g.png"/></div><figcaption class="ky kz et er es la lb bd b be z dx translated">测试电子邮件已发送</figcaption></figure></div><div class="ab cl je jf gp jg" role="separator"><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj jk"/><span class="jh bw bk ji jj"/></div><div class="hb hc hd he hf"><p id="9d5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用 AWS SES 和 NextJS 发送电子邮件就是这么简单。Express 应用程序中的实现也是类似的。</p></div></div>    
</body>
</html>