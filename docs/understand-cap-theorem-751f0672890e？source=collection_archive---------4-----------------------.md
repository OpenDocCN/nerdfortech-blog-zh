# 理解 CAP 定理

> 原文：<https://medium.com/nerd-for-tech/understand-cap-theorem-751f0672890e?source=collection_archive---------4----------------------->

![](img/c6da86efc19295cc612fe9da5fa7a672.png)

# 什么是 CAP 定理？

CAP 有时表现为一致性、可用性、分区容差三选二。

不幸的是，这样说是有误导性的，因为网络分区是一种错误，所以它们不是你可以选择的事情:不管你喜欢与否，它们都会发生。当网络正常工作时，系统可以提供一致性和可用性。

当网络出现故障时，您必须在一致性或总体可用性之间做出选择。因此，描述 CAP 的更好的方法是在分区时保持一致或可用。

# CAP 定理中的‘CAP’是什么？

CAP 定理是指分布式系统中的三个特征

## 一致性

一致性意味着所有客户端同时看到相同的数据，无论它们连接到哪个节点。为此，每当数据写入一个节点时，都必须立即转发或复制到系统中的所有其他节点，才能认为写入“成功”

## 有效性

可用性是指系统在给定时间运行的概率。设备实际运行的时间占总运行时间的百分比。高可用性系统可能以每年停机时间的分钟数或小时数来报告可用性。可用性功能使系统即使在发生故障时也能保持运行。

## 分区容差

系统的两个节点(*分区*)在其网络出现临时通信故障时继续运行的能力。随着分区容忍度的提高，数据库对客户端来说更加可用，但是可访问的数据不太一致，反之亦然

# 理解 CAP 定理的真实例子

让我们考虑一家有两只股票和一个报价的公司。公司股票可以支撑

三种不同的操作:

1.  下订单
2.  检查产品总可用数量

现在这位员工走向一只股票。如果一切正常，那么这个系统就相对简单。如果员工销售了一些产品，公司需要更新系统上的数量，然后完成跟踪。这涉及到对产品数量的一致看法，因为它在每个库存系统中都是相同的。作为一名雇员，他喜欢用他想要的任何操作来操作系统，也喜欢在他想要的任何时候操作系统。股票系统需要对他可用。我们将考虑下面的负面情景。

# 一致性设计的股票

如果股票选择了一致的设计，那么分行将通知:**我现在不能接受卖出，因为我不能更新另一只股票的数量。**这可能会很烦人，因为你会让顾客等着检查总量是否足够他们的订单

# 库存与可用性设计

在可用性设计中，当你走到股票前说，我不能和另一个股票系统说话。但是我会允许你下订单，并会跟踪发生了什么，然后当分区愈合与其他股票，帐户数量将在另一个股票更新。因此，通过这种设计，即使库存在产品数量的存储上不一致，它也更加可用。简而言之，当你设计系统的可用性时，这就是上限定理。

# 具有一定一致性和可用性的库存设计

在现实世界中，我们还可以考虑一致性程度和可用性程度。还有，做取舍。

例如，当一个分区发生时，我们可以有股票:

*   接受部分订单
*   不提供全面的服务。

股票也可以提供有关数量的信息，但只能提供暂定的数量信息。这意味着，我们不确定这是否是正确的数量，但如果你没有在股票之间跑，它可能是正确的。

简而言之，股票决定赚钱。为了让员工获得更高的可用性，您希望为您的系统增加多少复杂性？因为一致的设计往往更容易构建和理解。复杂的可用性设计会带来冲突，变得更加难以解决，甚至无法解决。

# CAP 定理如何影响数据库决策？

尽管 CAP 定理可能感觉很抽象，但它有实际的、真实的后果。从技术和商业的角度来看，这种权衡将引导您思考一些非常重要的问题。没有正确的答案。最终，它将与数据库的运行环境、业务需求以及用户的期望和需求息息相关。

你将不得不考虑这样的事情:

*   避免在客户端抛出错误很重要吗？
*   还是我们愿意牺牲可见的用户体验来保证一致性？
*   一致性是用户体验中真正重要的一部分吗
*   或者，我们真的可以用关系数据库做我们想做的事情，并且完全避免分区容错的需要吗？

如你所见，这些最终都是用户体验问题。为了正确理解这些，您需要对项目的总体目标保持敏感，并且如上所述，对数据库解决方案运行的环境保持敏感。(它是否为内部分析仪表板提供动力？还是支持广泛使用的面向外部的网站或应用程序？)

# 参考

B [rewer 的猜想和一致的、可用的、分区容忍的 web 服务的可行性](http://dl.acm.org/citation.cfm?id=564601)

CAP [十二年后:规则如何改变](https://www.infoq.com/articles/cap-twelve-years-later-how-the-rules-have-changed)

请停止调用数据库 cp 或 ap