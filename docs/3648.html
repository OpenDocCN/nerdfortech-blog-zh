<html>
<head>
<title>Unity2d: Simple Touch Handling On Grid With Music</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Unity2d:带音乐的网格上的简单触摸处理</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/unity2d-simple-touch-handling-on-grid-with-music-7497ccdb901d?source=collection_archive---------20-----------------------#2021-06-17">https://medium.com/nerd-for-tech/unity2d-simple-touch-handling-on-grid-with-music-7497ccdb901d?source=collection_archive---------20-----------------------#2021-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="7cd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我决定回忆一下我在 Unity 上“被遗忘”的经历。更准确地说是 Unity2d。因此，该项目(引用，或者我会说测试任务)样的样本二维网格，在代码中构造，允许用户选择细胞，它播放声音。一种钢琴，或一些其他乐器…还有移动选择指示器，如果选择与触摸匹配，它将播放音乐。简单的动画用于改变播放/暂停按钮。</p><p id="e28d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<em class="jd"> iPhoneX (iOS 14) </em>上的最终游戏是这样的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/233573faf9e1bd924a45e333c09b4701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Y_DeEvtU9VGv4uq3-z9TGA.gif"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">细胞选择和主动细胞运动</figcaption></figure><p id="a338" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">图片(精灵)取自在线，一些按钮(顶行)的缩放比例不同。不完美，但对模型来说还可以。</p><p id="cd17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 iOS 设备上选择了风景模式:(<em class="jd">构建设置- &gt;播放器设置</em>)</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ju"><img src="../Images/15779202171889ddf06cdf8a856dc704.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-W0636LjwQcJiV1u8xsubw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">iOS 上的风景</figcaption></figure><p id="106b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">细胞:</strong></p><p id="8c79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">细胞是基于预设和精灵的使用(更好地使用材质和着色器的边界，我猜):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jv"><img src="../Images/d27b1a8b2448e6ef0f699c4d9befd9c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k6dxTBycrtN-VmzuA4_MkQ.png"/></div></div></figure><p id="5126" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> PolygonCollider </strong> <em class="jd"> </em>用于处理 2d 中的触摸。</p><p id="8b60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">场景</strong>:</p><p id="83f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">场景包含<strong class="ih hj"> GridManager </strong>，负责代码中网格创建的组件。<strong class="ih hj">音频管理器</strong>用于播放暂停声音。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/99fad4ba7d54b27d4d9d50d474df7ea9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NyWUV960DqYBEnsbDtXziA.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">场景视图</figcaption></figure><p id="aa80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过使用<strong class="ih hj"> tileObject </strong>并创建其实例，从<strong class="ih hj"> Awake </strong>方法完成网格生成。</p><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="da38" class="kc kd hi jy b fi ke kf l kg kh">private void GenerateGrid()<br/>    {<br/>        tileObject.transform.localScale = new Vector3(tileScale, tileScale);<br/>        <strong class="jy hj">var size = tileObject.GetComponent&lt;SpriteRenderer&gt;().bounds.size;</strong><br/>        <br/>        float xOrigin = (float)((Columns - 1) * size.x * -0.5);<br/>        float yOrigin = (float)((Rows - 1) * size.y * -0.5);</span><span id="d18d" class="kc kd hi jy b fi ki kf l kg kh">        float xPos = xOrigin;<br/>        float yPos = yOrigin;</span><span id="8755" class="kc kd hi jy b fi ki kf l kg kh">        for (var i = 0; i &lt; Rows; i++)<br/>        {<br/>            for (var j = 0; j &lt; Columns; j++)<br/>            {<br/>                var newTile = Instantiate(tileObject);<br/>                newTile.transform.parent = transform;<br/>                newTile.name = (j + i * Columns).ToString();<br/>                newTile.transform.localPosition = new Vector3(xPos,   yPos, 0);<br/>                xPos += size.x;<br/>            }<br/>            xPos = xOrigin;<br/>            yPos += size.y;<br/>        }<br/>    }</span></pre><p id="c521" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">触摸在<strong class="ih hj">更新</strong>中处理:</p><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="c11b" class="kc kd hi jy b fi ke kf l kg kh">// Update is called once per frame<br/>    void Update()<br/>    {<br/>        if (Input.GetMouseButtonDown(0))<br/>        {<br/>            Debug.Log("Position " + Input.mousePosition);<br/>            HandlePosition(Input.mousePosition);<br/>        }<br/>        else<br/>            HandleTouchOnNeed();<br/>    }<br/></span></pre><p id="da35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">单元格选择:</strong></p><p id="9a32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">网格单元的选择是在 sprite 的操作级别上处理的:</p><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="e2ac" class="kc kd hi jy b fi ke kf l kg kh">    void SwapChildState(int index)<br/>    {<br/>        if (selectedTiles.Contains(index))<br/>            selectedTiles.Remove(index);<br/>        else<br/>            selectedTiles.Add(index);</span><span id="e61a" class="kc kd hi jy b fi ki kf l kg kh">        var shouldPlay = selectedTiles.Contains(index);<br/>        var rowIndex = index / Rows;<br/>        if (shouldPlay)<br/>            audioManager.Play(rowIndex, true);<br/>        else<br/>            audioManager.StopPlaying(rowIndex);</span><span id="1dc2" class="kc kd hi jy b fi ki kf l kg kh">        ChangeChildState(index.ToString(), shouldPlay);<br/>    }</span><span id="a537" class="kc kd hi jy b fi ki kf l kg kh">    void ChangeChildState(string name, bool selected)<br/>    {<br/>        ChangeChildState(name, selected, selectedSprite,  tileObject.GetComponent&lt;SpriteRenderer&gt;().sprite);<br/>    }</span><span id="fc42" class="kc kd hi jy b fi ki kf l kg kh">    void ChangeChildState(string name, bool selected, Sprite  selectedSprite, Sprite nonSelectedSprite)<br/>    {<br/>        ChangeChildState(name, selected ? selectedSprite : nonSelectedSprite);<br/>    }</span><span id="07f1" class="kc kd hi jy b fi ki kf l kg kh">    void ChangeChildState(string name, Sprite sprite)<br/>    {<br/>        var childTranform = gameObject.transform.Find(name);<br/>        var renderer = childTranform.GetComponent&lt;SpriteRenderer&gt;();<br/>        renderer.sprite = sprite;<br/>    }</span></pre><p id="e27f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">动画</strong>:</p><p id="ae80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按下暂停/播放按钮激活按钮的精灵动画。<strong class="ih hj">播放点击</strong>布尔标志触发播放动画和反转动画(由负播放速度控制)</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kj"><img src="../Images/b7ef99cc1d534fcb7edc4d046add1d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCJ5pEJZsZLF34GKNgEyaQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">播放/暂停动画</figcaption></figure><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="3bc0" class="kc kd hi jy b fi ke kf l kg kh">// Update is called once per frame<br/>    void Update()<br/>    {<br/>        if (Input.GetMouseButtonDown(0))<br/>        {<br/>            Debug.Log("Position " + Input.mousePosition);<br/>            HandlePosition(Input.mousePosition);<br/>        }<br/>        else<br/>            HandleTouchOnNeed();<br/>    }</span><span id="49f9" class="kc kd hi jy b fi ki kf l kg kh">    private void HandleTouchOnNeed()<br/>    {<br/>        foreach (var touch in Input.touches)<br/>        {<br/>            if (touch.phase == TouchPhase.Began)<br/>            {<br/>                HandlePosition(touch.position);<br/>            }<br/>        }<br/>    }</span><span id="ebd8" class="kc kd hi jy b fi ki kf l kg kh">    private void HandlePosition(Vector2 position)<br/>    {<br/>        if (isPaused)<br/>            return;</span><span id="2ce8" class="kc kd hi jy b fi ki kf l kg kh">        var wp = Camera.main.ScreenToWorldPoint(position);<br/>        var touchPosition = new Vector2(wp.x, wp.y);</span><span id="6cfd" class="kc kd hi jy b fi ki kf l kg kh">        <strong class="jy hj">var collider = Physics2D.OverlapPoint(touchPosition);</strong><br/>        if (!collider)<br/>            return;</span><span id="8656" class="kc kd hi jy b fi ki kf l kg kh">       if (int.TryParse(collider.gameObject.name, out int res))<br/>        {<br/>            var rowIndex = res / Columns;<br/>            var colIndex = res - rowIndex * Columns;<br/>            Debug.Assert(rowIndex &lt;= Rows);<br/>            Debug.Assert(colIndex &lt;= Columns);<br/>            Debug.Log("!!! Item " + res);<br/>            SwapChildState(res);<br/>        }<br/>    }</span></pre><p id="5451" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过交换先前的选择并使用模运算来更改网格的活动单元格。它在 2.5 秒内保持活动状态。从<strong class="ih hj"> FixedUpdate </strong>中调用相应的方法。</p><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="40d5" class="kc kd hi jy b fi ke kf l kg kh">    void FixedUpdate()<br/>    {<br/>        UpdateCount();<br/>    }</span><span id="18f4" class="kc kd hi jy b fi ki kf l kg kh">    void UpdateCount()<br/>    {<br/>        if (!IsCounting || isPaused)<br/>            return;</span><span id="64ed" class="kc kd hi jy b fi ki kf l kg kh">         var diff = (int)Mathf.Ceil((float)(Time.realtimeSinceStartup -   lastInterval));<br/>        var diffCondition = diff &gt;= 2.5;<br/>        if (diffCondition || countRow == 0 &amp;&amp; countColumn == 0)<br/>        {<br/>            if (diffCondition)<br/>            {<br/>                lastInterval = Time.realtimeSinceStartup;<br/>                var oldIndex = countRow * Columns + countColumn;<br/>                ChangeChildState(oldIndex.ToString(),   selectedTiles.Contains(oldIndex));</span><span id="0cd5" class="kc kd hi jy b fi ki kf l kg kh">                if (Rows - 1 == countRow)<br/>                {<br/>                    countRow = 0;<br/>                    if (countColumn == Columns - 1)<br/>                    {<br/>                        countColumn = 0;<br/>                    }<br/>                    else<br/>                        countColumn += 1;<br/>                }<br/>                else<br/>                    countRow += 1;<br/>            }</span><span id="c1da" class="kc kd hi jy b fi ki kf l kg kh">           var index = countRow * Columns + countColumn;<br/>            if (selectedTiles.Contains(index)) {<br/>                Debug.Assert(index &gt;= 0 &amp;&amp; index &lt; Rows * Columns);<br/>                audioManager.Play(countRow);<br/>            } else {<br/>                ChangeChildState(index.ToString(), countingSprite);<br/>            }<br/>        }<br/>    }</span></pre><p id="b8ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">音频:</strong></p><p id="5a12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> AudioManager </strong>包含网格中每行的一组声音，由相应的类描述(参见<a class="ae kk" href="https://www.youtube.com/user/Brackeys" rel="noopener ugc nofollow" target="_blank">括号</a>中的类似代码) :</p><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="378b" class="kc kd hi jy b fi ke kf l kg kh">[System.Serializable]<br/>public class Sound<br/>{<br/>    public AudioClip clip;<br/>    public string name;</span><span id="2bc8" class="kc kd hi jy b fi ki kf l kg kh">    [Range(0.1f, 1f)]<br/>    public float volume = 1.0f;</span><span id="f9a7" class="kc kd hi jy b fi ki kf l kg kh">    [HideInInspector]<br/>    public AudioSource source;<br/>}</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kl"><img src="../Images/58536d5f7d05c2367e60996fc7a8046e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CziuBEuUKYZmvwYuMD0Xew.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">音频管理器</figcaption></figure><pre class="jf jg jh ji fd jx jy jz ka aw kb bi"><span id="d7a6" class="kc kd hi jy b fi ke kf l kg kh">  //excerpt from AudioManager</span><span id="a8c5" class="kc kd hi jy b fi ki kf l kg kh">    public Sound[] sounds;</span><span id="6ace" class="kc kd hi jy b fi ki kf l kg kh">// Start is called before the first frame update<br/>    void Awake()<br/>    {</span><span id="7e85" class="kc kd hi jy b fi ki kf l kg kh">        var index = 0;<br/>        foreach (var sound in sounds)<br/>        {<br/>            var source = gameObject.AddComponent&lt;AudioSource&gt;();<br/>            source.volume = sound.volume;<br/>            source.clip = sound.clip;<br/>            sound.source = source;</span><span id="850e" class="kc kd hi jy b fi ki kf l kg kh">            if (sound.name == null || sound.name.Length == 0)<br/>                sound.name = string.Format("{0}", index); <br/>            index += 1;<br/>        }<br/>    }</span><span id="6e39" class="kc kd hi jy b fi ki kf l kg kh">    public void Play(string name, bool force = false)<br/>    {<br/>        var sound = sounds.FirstOrDefault(sound =&gt; sound.name == name);<br/>        if (sound == null)<br/>            return;</span><span id="b9a1" class="kc kd hi jy b fi ki kf l kg kh">       if (!sound.source.isPlaying || force)<br/>        {<br/>            sound.source.Stop();<br/>            sound.source.Play();<br/>        }<br/>    }</span></pre><p id="ee37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">播放/暂停</strong>由代码中的标志(isPaused)处理。可以使用<strong class="ih hj">time . scale</strong>但是设置为 0 会冻结按钮的动画和状态转换。</p></div><div class="ab cl km kn gp ko" role="separator"><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr ks"/><span class="kp bw bk kq kr"/></div><div class="hb hc hd he hf"><p id="8ec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请在<a class="ae kk" href="https://github.com/yakushevichsv/MusicBoardUnity" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到最终代码</p></div></div>    
</body>
</html>