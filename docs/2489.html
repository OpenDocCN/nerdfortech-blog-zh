<html>
<head>
<title>Convert JS Date objects to Temporal</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将 JS 日期对象转换为时态</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/convert-js-date-objects-to-temporal-4acd8a8612ab?source=collection_archive---------12-----------------------#2021-05-08">https://medium.com/nerd-for-tech/convert-js-date-objects-to-temporal-4acd8a8612ab?source=collection_archive---------12-----------------------#2021-05-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f33c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Temporal 将为 ECMAScript 语言带来一个现代的日期/时间 API，取代普通的 JavaScript 日期对象</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/db5866682e6b0d38e5f053d89525bbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YciRy3JPKnDV5dxRSpL2hQ.png"/></div></div></figure><h1 id="2afc" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">2022 年 2 月更新</h1><ul class=""><li id="37c0" class="kn ko hi ih b ii kp im kq iq kr iu ks iy kt jc ku kv kw kx bi translated">根据<a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank">建议-临时</a>中的建议，将库更改为<a class="ae ky" href="https://github.com/js-temporal/temporal-polyfill" rel="noopener ugc nofollow" target="_blank">js-temporal/temporal-poly fill</a>。</li></ul><h1 id="7fc7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">从 JS 日期对象迁移的原因</h1><p id="0d65" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">当我看代码时，它是如此的令人困惑，以至于我需要不断地将月份值递增 1，然后才能将其转换成实际的月份。这个概念并不自然，至少对我来说是这样。看下面例子，<a class="ae ky" href="https://en.wikipedia.org/wiki/Jatupat_Boonpattararaksa" rel="noopener ugc nofollow" target="_blank">Jatupat Boonpatraksa aka '<em class="lc">Pai Dao Din</em>'</a>于 2021 年 3 月 8 日入狱，2021 年 4 月 23 日被保释。</p><ul class=""><li id="91ff" class="kn ko hi ih b ii ij im in iq ld iu le iy lf jc ku kv kw kx bi translated"><code class="du lg lh li lj b">new Date(2021, 2, 8)</code> = &gt;月份值为 2 = &gt;递增 1 =&gt;2021 年 3 月 8 日</li><li id="2850" class="kn ko hi ih b ii lk im ll iq lm iu ln iy lo jc ku kv kw kx bi translated"><code class="du lg lh li lj b">new Date(2021, 3, 23)</code> = &gt;月份值为 3= &gt;递增 4 =&gt;2021 年 4 月 23 日</li></ul><p id="ed1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是！！我可以用<code class="du lg lh li lj b">dateString</code>数据类型创建<code class="du lg lh li lj b">Date</code>对象，而不是将日期组件值传递给<code class="du lg lh li lj b">new Date() </code>构造函数。</p><ul class=""><li id="5138" class="kn ko hi ih b ii ij im in iq ld iu le iy lf jc ku kv kw kx bi translated"><code class="du lg lh li lj b">new Date(2021, 2, 8)</code> = <code class="du lg lh li lj b">new Date('8 Mar 2021')</code> = <code class="du lg lh li lj b">new Date('2021-03-08')</code>和</li><li id="bc72" class="kn ko hi ih b ii lk im ll iq lm iu ln iy lo jc ku kv kw kx bi translated"><code class="du lg lh li lj b">new Date(2021, 3, 23)</code> = <code class="du lg lh li lj b">new Date('23 Apr 2021')</code> = <code class="du lg lh li lj b">new Date('2021-04-23')</code></li></ul><p id="2a64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个比较好理解。但是再一次！！从<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/Date" rel="noopener ugc nofollow" target="_blank"> MDN Web 文档</a>来看，由于浏览器的差异和不一致，使用<code class="du lg lh li lj b">Date</code>构造函数解析日期字符串(如<code class="du lg lh li lj b">'23 Apr 2021'</code>或<code class="du lg lh li lj b">'2021-04-23'</code>)是<strong class="ih hj"> <em class="lc">强烈反对的。</em></strong></p><p id="7f1c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一个痛点是缺乏支持一些常见操作的方法。参见下面的示例，下面的函数需要手动计算日期差异，方法是手动减去两个日期(纪元值)并除以一天中的毫秒数，这也是手动计算的。</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="cce5" class="lt jq hi lj b fi lu lv l lw lx">const DAYS_IN_MS = 24 * 60 * 60 * 1000;<br/>function getNumberOfDaysUnderDetained(<br/>  detainedDate,<br/>  releasedDate = todayDate<br/>) {<br/>  return Math.floor((releasedDate - detainedDate) / DAYS_IN_MS);<br/>}</span></pre><p id="f622" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是其中的两个难点。还有什么？你可以从<a class="ae ky" href="https://maggiepint.com/2017/04/09/fixing-javascript-date-getting-started/" rel="noopener ugc nofollow" target="_blank">这里</a>看到，远离<code class="du lg lh li lj b">Date</code>的动力。</p><h1 id="535a" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">可供选择的事物</h1><h2 id="3b0c" class="lt jq hi bd jr ly lz ma jv mb mc md jz iq me mf kd iu mg mh kh iy mi mj kl mk bi translated">使用库</h2><p id="e05f" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><a class="ae ky" href="https://moment.github.io/luxon/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">卢克森</strong> </a>，<a class="ae ky" href="https://github.com/iamkun/dayjs" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Day.js </strong> </a>，<a class="ae ky" href="https://date-fns.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> date-fns </strong> </a>，<strong class="ih hj"/><a class="ae ky" href="https://js-joda.github.io/js-joda/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">js-Joda</strong></a><strong class="ih hj"><em class="lc"><br/></em></strong>注意，我还没有把<a class="ae ky" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">moment . js</strong></a><strong class="ih hj"/>放在这里是有原因的——“项目组不鼓励在新项目中使用<a class="ae ky" href="https://momentjs.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Moment.js </strong> </a>。</p><h2 id="b01b" class="lt jq hi bd jr ly lz ma jv mb mc md jz iq me mf kd iu mg mh kh iy mi mj kl mk bi translated">暂时的</h2><p id="ea2e" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated"><strong class="ih hj">未来就是现在！</strong>(大概<strong class="ih hj">还没有</strong><strong class="ih hj"/>但是快到了！！)</p><p id="d2fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">时态</strong> </a> <strong class="ih hj"> </strong>是在 JavaScript 语言中实现的新的日期和时间 API。它将不再需要使用第三方库，并将取代<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> Date </strong> </a>作为在 JavaScript 中处理日期和时间的 API。目前，<a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj"/></a>处于 TC39 流程的<a class="ae ky" href="https://tc39.es/process-document/" rel="noopener ugc nofollow" target="_blank">阶段 3</a></p><p id="48c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">备注</strong>:由于<a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">时态</strong> </a>处于第三阶段，其 API 可能会发生变化。<strong class="ih hj">不建议在生产中使用。</strong></p><h1 id="f951" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">履行</h1><p id="cac7" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kz is it iu la iw ix iy lb ja jb jc hb bi translated">为了开始实现<a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">时态</strong> </a>，我需要依赖 poly fill——因为浏览器还没有实现这个 API。</p><p id="ff8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要了解更多如何使用<a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">时态</strong> </a>的信息，请查看<a class="ae ky" href="https://tc39.es/proposal-temporal/docs/cookbook.html#overview" rel="noopener ugc nofollow" target="_blank">时态食谱</a>。</p><ol class=""><li id="157e" class="kn ko hi ih b ii ij im in iq ld iu le iy lf jc ml kv kw kx bi translated">首先，安装<code class="du lg lh li lj b"><a class="ae ky" href="https://github.com/tc39/proposal-temporal/tree/main/polyfill" rel="noopener ugc nofollow" target="_blank">proposal-temporal</a></code>依赖项</li></ol><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="69b5" class="lt jq hi lj b fi lu lv l lw lx">$ npm install --save @js-temporal/polyfill</span></pre><p id="980b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.将<code class="du lg lh li lj b"><a class="ae ky" href="https://github.com/tc39/proposal-temporal/tree/main/polyfill" rel="noopener ugc nofollow" target="_blank">proposal-temporal polyfill</a></code>作为 ES6 模块导入文件 App.svelte</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="379a" class="lt jq hi lj b fi lu lv l lw lx">import { Temporal } from '@js-temporal/polyfill';</span></pre><p id="66ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.获取一个代表系统时区和 ISO-8601 日历中当前日期的<code class="du lg lh li lj b">Temporal.PlainDate</code>对象，并将其存储在<code class="du lg lh li lj b">todayDate</code>变量中。</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="85ef" class="lt jq hi lj b fi lu lv l lw lx">const todayDate = Temporal.Now.plainDateISO();</span></pre><p id="504e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.用静态方法<code class="du lg lh li lj b">Temporal.PlainDate.from</code>创建一个<code class="du lg lh li lj b">Temporal.PlainDate</code>对象，接受代表期望日期的值。该方法返回一个新的<code class="du lg lh li lj b">Temporal.PlainDate</code>对象，表示与特定时间或时区无关的日历日期，例如本例中的 2021 年 3 月 8 日。</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="b200" class="lt jq hi lj b fi lu lv l lw lx">Temporal.PlainDate.from({ year: 2021, month: 3, day: 8 }),</span></pre><p id="3596" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.用<code class="du lg lh li lj b"><em class="lc">date</em>.until(<em class="lc">other</em>, <em class="lc">options</em>)</code>计算两个日期(下例中的<code class="du lg lh li lj b">detainedDate</code>和<code class="du lg lh li lj b">releasedDate</code>)之间的差值，并将其作为<code class="du lg lh li lj b">Temporal.Duration</code>对象返回。<code class="du lg lh li lj b">options</code>对象提供了<code class="du lg lh li lj b">largestUnit</code>属性，用于控制结果持续时间的表达方式；例如，当<code class="du lg lh li lj b">largestUnit</code>为<code class="du lg lh li lj b">"months"</code>时，两年的差异将变成 24 个月。然而，即使<code class="du lg lh li lj b">largestUnit</code>是<code class="du lg lh li lj b">"years"</code>，两个月的差异仍然是两个月</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="5a19" class="lt jq hi lj b fi lu lv l lw lx">detainedDate.until(releasedDate, { largestUnit: 'days' }).days;</span></pre><p id="d0e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.将所有内容放在一起，最终的文件将如下所示:</p><pre class="je jf jg jh fd lp lj lq lr aw ls bi"><span id="ca51" class="lt jq hi lj b fi lu lv l lw lx">&lt;script&gt;<strong class="lj hj"><br/>import { Temporal } from '@js-temporal/polyfill';</strong></span><span id="fe29" class="lt jq hi lj b fi mm lv l lw lx"><strong class="lj hj">//</strong>get the current date in the system time zone and ISO-8601 calendar<br/><strong class="lj hj">const todayDate = Temporal.Now.plainDateISO();</strong></span><span id="dc12" class="lt jq hi lj b fi mm lv l lw lx">const people = [<br/>{<br/>  name: `Jatupat 'Pai Dao Din' Boonpatraksa`,<br/>  nickname: 'pai',</span><span id="d37b" class="lt jq hi lj b fi mm lv l lw lx">  //A <!-- -->Temporal.PlainDate<!-- --> object represents March 8th, 2021 date<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 8 })</strong>,</span><span id="04b6" class="lt jq hi lj b fi mm lv l lw lx">  //A <!-- -->Temporal.PlainDate<!-- --> object represents April 23rd, 2021 date <br/>  releasedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 4, day: 23 })</strong>,<br/>},<br/>{<br/>  name: `Parit 'Penguin' Chiwarak`,<br/>  nickname: 'penguin',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 2, day: 9 })</strong>,<br/>},<br/>{<br/>  name: `Panupong 'Mike' Jadnok`,<br/>  nickname: 'mike',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 8 })</strong>,<br/>},<br/>{<br/>  name: `Somyot Pruksakasemsuk`,<br/>  nickname: 'somyot',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 2, day: 9 })</strong>,<br/>  releasedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 4, day: 23 })</strong>,<br/>},<br/>{<br/>  name: `Arnon Nampa`,<br/>  nickname: 'arnon',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 2, day: 9 })</strong>,<br/>},<br/>{<br/>  name: `Patiwat Saraiyaem, 'Mor Lam Bank'`,<br/>  nickname: 'bank',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 2, day: 9 })</strong>,<br/>  releasedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 4, day: 9 })</strong>,<br/>},<br/>{<br/>  name: `Panusaya Sithijirawattanakul`,<br/>  nickname: 'rung',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 8 })</strong>,<br/>},<br/>{<br/>  name: `Chaiamorn 'Ammy' Kaewwiboonpan`,<br/>  nickname: 'ammy',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 4 })</strong>,<br/>},<br/>{<br/>  name: `Parinya Cheewin Kulpathom aka 'Port Faiyen'`,<br/>  nickname: 'port',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 6 })</strong>,<br/>},<br/>{<br/>  name: `Piyarat 'Toto' Jongthep`,<br/>  nickname: 'toto',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 6 })</strong>,<br/>  releasedDate: T<strong class="lj hj">emporal.PlainDate.from({ year: 2021, month: 5, day: 5 })</strong>,<br/>},<br/>{<br/>  name: `Promsorn 'Fah' Veerathamjaree`,<br/>  nickname: 'fah',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 17 })</strong>,<br/>},<br/>{<br/>  name: `Chookiat 'Justin' Saengwong`,<br/>  nickname: 'justin',<br/>  detainedDate: <strong class="lj hj">Temporal.PlainDate.from({ year: 2021, month: 3, day: 23 })</strong>,<br/>}]</span><span id="7754" class="lt jq hi lj b fi mm lv l lw lx">/*<em class="lc">until</em> method computes the difference between the two dates<br/>the <em class="lc">largestUnit</em> option controls how the resulting duration is expressed. The returned <!-- -->Temporal.Duration<!-- --> object will not have any nonzero fields that are larger than the unit in <!-- -->largestUnit<!-- -->. A difference of two years will become 24 months when <!-- -->largestUnit<!-- --> is <!-- -->"months"<!-- -->, for example. However, a difference of two months will still be two months even if <!-- -->largestUnit<!-- --> is <!-- -->"years"*/</span><span id="8fae" class="lt jq hi lj b fi mm lv l lw lx">function getNumberOfDaysUnderDetained(detainedDate, releasedDate = todayDate) {<br/>  return <strong class="lj hj">detainedDate.until(releasedDate, { largestUnit: 'days' }).days;</strong><br/>}<br/>&lt;/script&gt;</span><span id="ffeb" class="lt jq hi lj b fi mm lv l lw lx">&lt;main&gt;...</span><span id="3c32" class="lt jq hi lj b fi mm lv l lw lx">&lt;style&gt;...</span></pre><p id="f2f0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">回到页面，最终结果将是相同的—持续时间仍然是正确计算的:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mn"><img src="../Images/3a74490524de824c5189d6206d29a0e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLHHi_gF0sGpLcZow6rfKw.png"/></div></div></figure><h1 id="630b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考</h1><ul class=""><li id="c491" class="kn ko hi ih b ii kp im kq iq kr iu ks iy kt jc ku kv kw kx bi translated"><a class="ae ky" href="https://github.com/tc39" rel="noopener ugc nofollow" target="_blank"> tc39 </a> / <a class="ae ky" href="https://github.com/tc39/proposal-temporal" rel="noopener ugc nofollow" target="_blank">提议-时间</a></li><li id="2af5" class="kn ko hi ih b ii lk im ll iq lm iu ln iy lo jc ku kv kw kx bi translated"><a class="ae ky" href="https://tc39.es/proposal-temporal/docs/cookbook.html" rel="noopener ugc nofollow" target="_blank">世俗食谱</a></li><li id="3fab" class="kn ko hi ih b ii lk im ll iq lm iu ln iy lo jc ku kv kw kx bi translated"><a class="ae ky" href="https://momentjs.com/docs/#/-project-status/recommendations/" rel="noopener ugc nofollow" target="_blank"> Moment.js 项目状态</a></li></ul></div></div>    
</body>
</html>