<html>
<head>
<title>What is Continuous Profiling in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">什么是 Go 中的连续剖析</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/continuous-profiling-in-go-9dce9b353e81?source=collection_archive---------7-----------------------#2021-07-16">https://medium.com/nerd-for-tech/continuous-profiling-in-go-9dce9b353e81?source=collection_archive---------7-----------------------#2021-07-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2df4940fc65375d56a332e8806a008c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L0QhAZs7ZD3GO5Md"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">马文·迈耶在<a class="ae iu" href="https://unsplash.com/s/photos/laptop?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="3345" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">简介</strong></h1><p id="64fe" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">由于市场需求增加，现代发展提高了生产部署的速度。由于高度自动化，这种速度的提高已经成为可能。在软件开发中，通过应用程序性能监控过程，我们可以了解 IT 基础设施中是否存在任何问题，或者是否有任何网络入侵正在发生。它还告诉我们应用程序的性能是否有问题。然而，监控本身并不能解决微小的代码级性能问题，这需要持续性能分析的高度自动化过程。</p><p id="7bbc" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">剖析告诉我们哪部分代码导致了问题，执行一个特定的任务需要多长时间，调用一行代码的频率，从哪里调用，以及在任何给定的时间点执行代码花费了多少时间。本文将介绍连续概要分析的概念，并讨论为 Go 提供连续概要分析的不同工具。</p><h1 id="0133" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">什么是连续剖析？</h1><p id="b2f1" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated"><a class="ae iu" href="https://granulate.io/introduction-to-continuous-profiling/" rel="noopener ugc nofollow" target="_blank">持续剖析</a>涉及从真实生产环境中持续收集详细的生产线级性能数据，以便开发人员和运营团队能够快速分析应用的性能，并改进性能不佳的代码部分。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kw"><img src="../Images/2cfe1bccaba82175fde49ba1e7dc8d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QRWAcUY7BMA8lh1a"/></div></div></figure><p id="88c9" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://www.opsian.com/blog/what-is-continuous-profiling/" rel="noopener ugc nofollow" target="_blank">来源</a></p><h1 id="fd10" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">持续分析的优势</h1><p id="ceb6" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">我们到底为什么需要持续的剖析？</p><ol class=""><li id="215d" class="lb lc hi jv b jw kr ka ks ke ld ki le km lf kq lg lh li lj bi translated">它帮助我们调试生产过程中出现的问题。</li><li id="bc4e" class="lb lc hi jv b jw lk ka ll ke lm ki ln km lo kq lg lh li lj bi translated">它使我们能够更好地了解 CPU 的使用情况，以控制过度计费。</li><li id="e78e" class="lb lc hi jv b jw lk ka ll ke lm ki ln km lo kq lg lh li lj bi translated">它可以帮助我们发现<a class="ae iu" href="https://en.wikipedia.org/wiki/Memory_leak" rel="noopener ugc nofollow" target="_blank">内存泄漏</a>。</li><li id="bd4d" class="lb lc hi jv b jw lk ka ll ke lm ki ln km lo kq lg lh li lj bi translated">它揭示了代码中发生争议的地方，并对它们进行了优化。</li><li id="38e4" class="lb lc hi jv b jw lk ka ll ke lm ki ln km lo kq lg lh li lj bi translated">它有助于我们分析新特性的性能。</li><li id="1fbb" class="lb lc hi jv b jw lk ka ll ke lm ki ln km lo kq lg lh li lj bi translated">它有助于我们发现<a class="ae iu" href="https://www.cloudflare.com/learning/performance/glossary/what-is-latency/" rel="noopener ugc nofollow" target="_blank">延迟</a>的根本原因。</li></ol><h1 id="e1e4" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">不同的分析工具</h1><h1 id="b43f" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">1.gProfiler</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/050cec1347d396495847215629bcb558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zrhPsZV5MThgMjmt"/></div></div></figure><p id="ca92" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://granulate.io/g-profiler/" rel="noopener ugc nofollow" target="_blank"> gProfiler </a>提供对生产环境的即时可见性，并帮助团队识别导致性能下降和成本膨胀的性能瓶颈。通过在整个生产环境中使用连续的代码性能分析，可以优化大多数消耗资源的代码行。反过来，这将提高应用程序的性能并显著降低成本。</p><p id="6363" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">gProfiler 最具定义性的特性之一是它的即插即用结构:它可以使用容器映像或 AWS、GCP 或 Azure 上的公共映像，通过一个命令进行部署。</p><h2 id="885d" class="lp iw hi bd ix lq lr ls jb lt lu lv jf ke lw lx jj ki ly lz jn km ma mb jr mc bi translated">装置</h2><p id="db42" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">Docker 安装:在您希望连续运行的服务中的每个节点上运行以下命令。</p><pre class="kx ky kz la fd md me mf mg aw mh bi"><span id="786e" class="lp iw hi me b fi mi mj l mk ml">docker pull granulate/gprofiler:latest</span><span id="0fe4" class="lp iw hi me b fi mm mj l mk ml">docker run — name gprofiler — restart=always -d — pid=host — userns=host -v /var/run/docker.sock:/var/run/docker.sock -v /lib/modules:/lib/modules:ro -v /usr/src:/usr/src:ro — privileged granulate/gprofiler:latest -cu — token &lt;unique_api_key&gt; — service-name “Service name”</span></pre><p id="3910" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">命令行:</p><pre class="kx ky kz la fd md me mf mg aw mh bi"><span id="274b" class="lp iw hi me b fi mi mj l mk ml">wget <a class="ae iu" href="https://github.com/Granulate/gprofiler/releases/latest/download/gprofiler" rel="noopener ugc nofollow" target="_blank">https://github.com/Granulate/gprofiler/releases/latest/download/gprofiler</a></span><span id="4da6" class="lp iw hi me b fi mm mj l mk ml">sudo chmod +x gprofiler</span><span id="1d57" class="lp iw hi me b fi mm mj l mk ml">sudo ./gprofiler -cu — token &lt;unique_api_key&gt; — service-name “Service name”</span></pre><h1 id="56ba" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">2.谷歌云分析器</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4364c18f866e084a2c89dd6f043b61cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NnJlXQU04bolu2Ew"/></div></div></figure><p id="216b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://cloud.google.com/profiler/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Profiler </a>是一个事实性的低开销分析器，旨在持续收集生产中应用程序的 CPU 使用或内存分配情况。它从产生它的代码行/策略中获取分析数据。它会发现应用程序的哪些空间使用了最多的资产。该云剖析器包括剖析专家和接口；专家作为库被附加到分析的应用程序中。然后，在这一点上，它偶尔会收集正在运行的应用程序的概要信息，这可以通过一个具有两个图形组件的界面看到:一个火灾图和一个正常资产利用率的视图。附图是 Google Cloud Profiler 信息的图解。Cloud Profiler 支持 Java、Go、Node.js 和 Python，设计人员可以利用它来分析在 Google Cloud、其他云平台或内部运行的应用程序。</p><p id="2933" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下面是启动分析器的示例代码。一旦您运行您的程序，分析器包将报告分析器。</p><pre class="kx ky kz la fd md me mf mg aw mh bi"><span id="d86e" class="lp iw hi me b fi mi mj l mk ml">if err := profiler.Start(profiler.Config{</span><span id="4eff" class="lp iw hi me b fi mm mj l mk ml">Service: “indexing-service”,</span><span id="1419" class="lp iw hi me b fi mm mj l mk ml">ServiceVersion: “1.0”,</span><span id="a7c2" class="lp iw hi me b fi mm mj l mk ml">ProjectID: “bamboo-project-606”,</span><span id="c8b4" class="lp iw hi me b fi mm mj l mk ml">}); err != nil {</span><span id="8bea" class="lp iw hi me b fi mm mj l mk ml">log.Fatalf(“Cannot start the profiler: %v”, err)</span><span id="0a09" class="lp iw hi me b fi mm mj l mk ml">}</span></pre><h1 id="f31d" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">3.动态跟踪代码探查器</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/130e3a09965833df0f1237dcb966563f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G4-uKSBXysYigv0L"/></div></div></figure><p id="1de2" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://www.dynatrace.com/" rel="noopener ugc nofollow" target="_blank"> Dynatrace </a>给出了代码级演示仪器，这些仪器可以显示导致 CPU 或 I/O 瓶颈的棘手区域。它提供计算机处理器和内存分析设备，允许工程师深入到技术层面来识别问题。例如，附图显示了最大的 CPU 客户。这些代码级调查工具支持用 Java 编写的应用程序。NET、PHP、Node.js 和 Golang。</p><h1 id="36bf" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">4.数据狗连续剖面仪</h1><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b70ddf6538c5ec21ff5db2aa649f6e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-OMgYuDsrGtJbQlI"/></div></div></figure><p id="8b9f" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated"><a class="ae iu" href="https://www.datadoghq.com/" rel="noopener ugc nofollow" target="_blank"> Datadog </a>的持续剖析服务可用于了解您的 API 中哪些代码是 CPU 或内存的最大消费者。例如，下图(火焰图)描述了在 CPU 上执行每个方法所花费的时间。Datadog 支持用 Java、Python 和 Go 编写的应用程序。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/00e1796bc45f7b111e9afb08c9e2eed1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yTnLTv8mQeuh4vhr"/></div></div></figure><p id="fce1" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">每个函数的 CPU 使用率的数据狗分析火焰图(<a class="ae iu" href="https://docs.datadoghq.com/tracing/" rel="noopener ugc nofollow" target="_blank">来源</a></p><h1 id="f375" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">摘要</h1><p id="9bab" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在本文中，我们讨论了为在生产环境中持续运行而设计的不同分析技术和工具，特别是针对 Go。选择最适合您需求的工具。</p><p id="45ff" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">很高兴听到想法和反馈！</p></div></div>    
</body>
</html>