<html>
<head>
<title>Setup and Teardown Unit Test in Go</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Go中的设置和拆卸单元测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/setup-and-teardown-unit-test-in-go-bd6fa1b785cd?source=collection_archive---------0-----------------------#2021-09-09">https://medium.com/nerd-for-tech/setup-and-teardown-unit-test-in-go-bd6fa1b785cd?source=collection_archive---------0-----------------------#2021-09-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="9535" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用Go的标准库进行单元测试</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/0b1e1ebc7c599d83d9275397de88801f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4i4zpBrp_pHqdsni"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">照片由<a class="ae jt" href="https://unsplash.com/@alfonsmc10?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">阿尔方斯·莫拉莱斯</a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="5843" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我记得我的一个同事对我说，“一个有用的依赖是好的，不使用一个更好”。在这种情况下，他谈论的是使用标准库来解决常见问题。有时，因为我们不想重新发明轮子，让我们的工作更容易，我们马上开始添加额外的依赖。甚至没有考虑语言提供的其他选择。这可能会导致性能问题和版本问题。</p><p id="4921" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">幸运的是，Go为我们提供了一些有用的标准库，其中之一就是<code class="du ju jv jw jx b">testing</code>。我们将讨论如何使用Go <code class="du ju jv jw jx b">testing</code>库，包括如何设置和拆卸单元测试。让我们从基础开始。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="f936" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">基础知识</h1><p id="dcba" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">从Go中的单元测试基础开始。假设我们在<code class="du ju jv jw jx b">main.go</code>文件中有我们的代码，那么我们在同一个包中的<code class="du ju jv jw jx b">main_test.go</code>中编写测试是合适的。请注意，关于在代码库中构建单元测试，您可以遵循几个约定。希望这篇文章能帮助你理解:</p><div class="li lj ez fb lk ll"><a rel="noopener follow" target="_blank" href="/@benbjohnson/structuring-tests-in-go-46ddee7a25c"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">Go中的结构化测试</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">我如何在Go中组织我的测试</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">medium.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz jn ll"/></div></div></a></div><p id="0400" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们编写极其简单的代码:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="cd2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们生活在同一个宇宙，我们会有同样的结果。如果我们给<code class="du ju jv jw jx b">doubleMe</code>函数赋值5，那么我们得到10。清晰简单！现在，让我们开始编写测试，以确保我们生活在同一个宇宙中:)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="1d0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果<code class="du ju jv jw jx b">doubleMe</code>是一个正确的函数，那么所有的测试用例都会通过。谢天谢地，的确如此！</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="da3b" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">简单地说，安装和拆卸</h1><p id="4740" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">当我们编写单元测试时，我们经常需要在每个测试(或者一组测试)之前和之后做一些事情。出于同样的原因，这就是单元测试中的设置和拆卸。所以，让我们写另一个简单的安装和拆卸单元测试的例子。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="9cbb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们仍然使用相同的<code class="du ju jv jw jx b">doubleMe</code>函数，但是在单元测试中做了一些调整。注意，我为setup和teardown函数提供了参数<code class="du ju jv jw jx b">tb</code>，以防我们需要来自<code class="du ju jv jw jx b">testing</code>库中的东西。所以如果你想的话，你可以让这个函数不带任何参数。现在，如果您通过运行命令<code class="du ju jv jw jx b">go test -v</code>来运行测试，您将在您的终端上看到类似的结果。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es mc"><img src="../Images/23db4e3d242968c0a51828bb4f85aaad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1136/format:webp/1*o3ngf6IxyZOU3n0oBtxpJQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">作者形象</figcaption></figure><p id="640c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装套件仅在所有测试开始时运行一次，而拆卸套件在所有测试都有机会运行后运行。同时，在测试运行之前和之后，安装和拆卸测试在每个测试中运行。</p></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="7350" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">RestAPI应用程序的单元测试</h1><p id="2899" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">好了，到目前为止，我们已经明白了如何只使用Go的标准库来编写单元测试。但是我们真的能在日常实践中使用它吗？当然可以。现在，让我们编写另一个RestAPI应用程序的简单示例。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="7df1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我没有使用任何额外的依赖项来创建RestAPI应用程序。为了使事情简单并支持我在引言中提到的观点。</p><p id="a252" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以通过进入<a class="ae jt" href="http://localhost:8080?x=1." rel="noopener ugc nofollow" target="_blank"> http://localhost:8080？x=1。</a>然后，你会得到这个回复<code class="du ju jv jw jx b">{“message”:”Hello!”,”result”:2}</code>。</p><p id="7856" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，单元测试:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="b0e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，与前面的代码相比，我对代码做了一些修改。套件的设置和拆卸保持不变。在<code class="du ju jv jw jx b">setupTest</code>函数中，它以<code class="du ju jv jw jx b">tb</code>和<code class="du ju jv jw jx b">x</code>作为参数，然后返回teardown函数和<code class="du ju jv jw jx b">httptest</code>响应记录器，因为我们想测试它给我们的结果。在代码的下面，我们测试所有情况，并确保我们给它的每个输入都给我们HTTP状态OK和预期的响应体。</p><p id="cbf7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们从上面的代码中得到的单元测试模式被称为<strong class="ih hj">表驱动测试</strong>。在这种情况下，我们以表格的形式提供名称、输入和预期输出，然后为每个测试遍历这个表格。这种模式允许我们拥有我们正在寻找的安装和拆卸功能。这是另一个有助于你了解更多关于<strong class="ih hj">表驱动测试的资源。</strong></p><div class="li lj ez fb lk ll"><a href="https://dave.cheney.net/2019/05/07/prefer-table-driven-tests" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">首选表格驱动测试</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">我是测试的忠实粉丝，特别是单元测试和TDD(当然是正确的)。这种做法已经发展到…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">dave.cheney.net</p></div></div></div></a></div></div><div class="ab cl jy jz gp ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="hb hc hd he hf"><h1 id="cb89" class="kf kg hi bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">结论</h1><p id="fee1" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq lf is it iu lg iw ix iy lh ja jb jc hb bi translated">我们必须记住的事情是，不要重新发明轮子，不要通过使用不必要的依赖关系使我们的项目变得太复杂。通过这样说，我并不反对某些第三方库，它们确实使我们的生活变得更容易。我确实使用那些有用的库，但是我想在使用它们的时候保持足够的智慧。请随时使用它们，并通过为项目做贡献来帮助社区。</p><p id="00bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你想加快游戏进度，并了解evidence(一个有用的围棋测试库)。然后你可以看看我的另一篇文章</p><div class="li lj ez fb lk ll"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/testing-rest-api-in-go-with-testify-and-mockery-c31ea2cc88f9"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hj fi z dy lq ea eb lr ed ef hh bi translated">测试REST API在Go中的验证和模拟</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">"当低价的甜蜜被遗忘后，劣质的苦涩依然久久不散."—本杰明·富兰克林</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">medium.com</p></div></div><div class="lu l"><div class="md l lw lx ly lu lz jn ll"/></div></div></a></div><p id="39c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读和快乐编码！</p></div></div>    
</body>
</html>