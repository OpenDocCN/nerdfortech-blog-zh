<html>
<head>
<title>Exploratory Data Analysis:English Premier League</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索性数据分析:英格兰超级联赛</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/exploratory-data-analysis-english-premier-league-d9581623dd5?source=collection_archive---------10-----------------------#2021-05-15">https://medium.com/nerd-for-tech/exploratory-data-analysis-english-premier-league-d9581623dd5?source=collection_archive---------10-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="74cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对英格兰顶级联赛历史的深入分析以及一些很酷的功能</p><p id="81d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EPL是世界上最受欢迎、竞争最激烈的足球联赛之一，拥有来自世界各地的数百万球迷。在本文中，我们将对EPL的数据进行一些探索性的数据分析。我们还将通过一些很酷的函数来导出表的位置和释放。</p><p id="4f62" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们手头的数据集可以从以下链接下载。<a class="ae jd" href="https://www.kaggle.com/saife245/english-premier-league" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/saife245/english-premier-league</a></p><p id="16b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了这个分析，我们将下载从2000/01到2017/18的18个赛季的数据集。数据集在不同的excel文件(18个文件)中，所以我们需要一个for循环来下载文件列表</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="3f23" class="jn jo hi jj b fi jp jq l jr js">cwd = os.path.abspath('') <br/>files = os.listdir(cwd)<br/>df = pd.DataFrame()<br/>for file in files:<br/>     if file.endswith('.csv'):<br/>            df = df.append(pd.read_csv(file), ignore_index=True) </span></pre><p id="b22d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用上面的代码，我们能够下载18个不同的文件，并且能够合并成一个完整的文件。在进行了一些数据预处理，删除了丢失的值之后，我们得到了一组6460行的数据，包括以下各列。</p><p id="3572" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Div =联赛分区<br/>日期=比赛日(日/月/年)<br/>主队=主队<br/>客场队=客场队<br/> FTHG =全职主队进球<br/> FTAG =全职客场队进球<br/> FTR =全职成绩(H =主场胜，D =平局，A =客场胜)<br/> HTHG =半场主队进球<br/> HTAG =半场客场队进球<br/> HTR =半场成绩(H =主场胜，D =平局，A =客场胜)</p><p id="22ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">匹配统计数据(如果可用) <br/>上座率=观众上座率<br/>裁判=比赛裁判<br/> HS =主队射门<br/> AS =主队射门<br/> HST =主队射门对准目标<br/> AST =主队射门对准目标<br/> HHW =主队击中门框<br/> AHW =主队击中门框<br/> HC =主队角球<br/> AC =主队角球<br/> HF =主队犯规<br/> AF =主队犯规<br/> HO = 主队越位<br/> AO =客队越位<br/> HY =主队黄牌<br/> AY =客队黄牌<br/> HR =主队红牌<br/> AR =客队红牌</p><p id="dff2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将数据集减少到这些列之后，我觉得需要添加一些列。首先，FTR的结果栏只说明结果是对主队有利还是对客队有利。为了改变这一点，我增加了两列:(获胜队和失败队)。数据转换的代码如下所示</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="07ec" class="jn jo hi jj b fi jp jq l jr js">conditions=[df['FTR']=='H',df['FTR']=='A',df['FTR']=='D']<br/>choices=[df.AwayTeam,df.HomeTeam,'Match Drawn']<br/>choices2=[df.HomeTeam,df.AwayTeam,'Match Drawn']<br/>df['Losing Team']=np.select(conditions,choices,default=np.nan)<br/>df['Winning Team']=np.select(conditions,choices2,default=np.nan)</span></pre><p id="8671" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，数据集也没有季节。要添加季节，我们可以使用for循环来添加季节，以升序格式对数据进行排序。EPL通常有380场比赛，因此在380行数据之后，赛季将不得不改变。</p><p id="1a32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经完成了一些数据转换，让我们尝试进行一些基本的数据分析并回答一些问题。</p><h1 id="389c" class="jt jo hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">过去18年的平均进球数趋势如何？</strong></h1><p id="68cf" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">要回答这个问题，我们可以使用pandas中的groupby函数来绘制一个线图。代码如下所示。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5d8b" class="jn jo hi jj b fi jp jq l jr js">df.groupby('Season')['Total Goals'].mean().plot(kind='line')</span></pre><figure class="je jf jg jh fd kw er es paragraph-image"><div class="er es kv"><img src="../Images/493fae05392905244320aa2864febc46.png" data-original-src="https://miro.medium.com/v2/resize:fit:756/format:webp/1*95z0zz_rMYEJlZcXoCplWw.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">按赛季平均进球/比赛得分</figcaption></figure><p id="27b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的线形图显示，每场比赛的平均进球数约为2.5至2.8个，2012至2015赛季是进球数最多的赛季。</p><h1 id="5ac9" class="jt jo hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak"> Q2)对比过去18年球队的主场赛季记录</strong></h1><p id="b491" class="pw-post-body-paragraph if ig hi ih b ii kq ik il im kr io ip iq ks is it iu kt iw ix iy ku ja jb jc hb bi translated">为此，我们将增加另一栏，将计算每场比赛的hme和客场球队的积分。我们将使用与之前获胜团队栏相同的格式。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="fe85" class="jn jo hi jj b fi jp jq l jr js">conditions=[df['FTR']=='H',df['FTR']=='A',df['FTR']=='D']<br/>choices=[3,0,1]<br/>choices2=[0,3,1]<br/>df['HomeTeamPoints']=np.select(conditions,choices,default=np.nan)<br/>df['AwayTeamPoints']=np.select(conditions,choices2,default=np.nan)</span></pre><p id="b221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">转换后，我们可以添加一个groupby列，并绘制一个条形图，以查看球队在主场的平均得分。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9650" class="jn jo hi jj b fi jp jq l jr js">df.groupby("HomeTeam")['HomeTeamPoints'].mean().sort_values(ascending=False).head(5).plot(kind='barh')</span></pre><figure class="je jf jg jh fd kw er es paragraph-image"><div class="er es ld"><img src="../Images/0d284737a8d12988deecc53426d118b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*zAKqdaY9BrAqXdQvJyAscg.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">平均积分/主场比赛</figcaption></figure><p id="ad38" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从上表可以看出，2000年的前4名拥有最好的主场记录。</p><p id="cca1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用这个数据集，我们将尝试绘制任何一年的季节表。我们稍后将把它开发成一个用户函数，用户可以输入季节并得到季节表。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="c97b" class="jn jo hi jj b fi jp jq l jr js">def table():<br/>    x=input("Please enter the season table that you want?")<br/>    df_season=df[df['Season']==x]<br/>    group1=df_season.groupby('HomeTeam')['HomeTeamPoints'].sum()<br/>    group2=df_season.groupby("AwayTeam")['AwayTeamPoints'].sum()<br/>    final=group1+group2<br/>    final=final.sort_values(ascending=False)<br/>    return final</span></pre><p id="f590" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上面的函数将能够导出我们想要的任何一年的季节表。该表可用于进一步分析。例如，使用相同的代码，我们可以得出平均最低积分要求，以避免降级。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9a51" class="jn jo hi jj b fi jp jq l jr js">sum1=0<br/>for i in season:<br/>    df_season=df[df['Season']==i]<br/>    group1=df_season.groupby('HomeTeam')['HomeTeamPoints'].sum()<br/>    group2=df_season.groupby("AwayTeam")['AwayTeamPoints'].sum()<br/>    final=group1+group2<br/>    final=final.sort_values(ascending=False)<br/>    sum1=sum1+final.iloc[16]</span><span id="9c31" class="jn jo hi jj b fi le jq l jr js">print("Average points required to escape relegation is ", round(sum1/18,0)</span></pre><p id="7c0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述代码的结果是38，这意味着平均积分足以逃脱降级，并留在EPL。类似地，我们可以用它来查看获得前4名所需的最少点数。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="82eb" class="jn jo hi jj b fi jp jq l jr js">sum1=0<br/>for i in season:<br/>    df_season=df[df['Season']==i]<br/>    group1=df_season.groupby('HomeTeam')['HomeTeamPoints'].sum()<br/>    group2=df_season.groupby("AwayTeam")['AwayTeamPoints'].sum()<br/>    final=group1+group2<br/>    final=final.sort_values(ascending=False)<br/>    sum1=sum1+final.iloc[3]</span><span id="b889" class="jn jo hi jj b fi le jq l jr js">print("Average points required to achieve Top4 place is ", round(sum1/18,0)</span></pre><p id="c787" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上述代码的结果是70，这意味着平均70分足以确保一个冠军联赛的席位。我们现在可以进一步评估裁判在决定比赛结果中有多重要。</p><p id="43f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们将进行一个假设检验，看看裁判对主队和弱队的态度是否有显著差异。对于这个分析，我们将再添加两列(主队预订积分)和(客队预订积分)。该代码将为每张黄牌分配15个预订点，为每张红牌分配25个预订点。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="8c9a" class="jn jo hi jj b fi jp jq l jr js">df['HBP']=df['HY']*15+df['HR']*25<br/>df['ABP']=df['AY']*15+df['AR']*25</span></pre><p id="9a85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将进行t检验，以确定裁判对主队和客场队的态度是否有显著差异。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="22e9" class="jn jo hi jj b fi jp jq l jr js">stat, p = ttest_ind(df.HBP, df.ABP)<br/>print('Statistics=%.3f, p=%.3f' % (stat, p))</span></pre><p id="2cce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">p值约为0，表明裁判对主队和客场队的态度存在显著差异。</p><p id="8273" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">EPL最著名的事情之一就是势均力敌的比赛和激动人心的逆转。我们可以分析这些数据，看看改变主场和客场输球的球队的半场成绩有多容易。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="cd4a" class="jn jo hi jj b fi jp jq l jr js">sns.heatmap(pd.crosstab(df.FTR,df.HTR,normalize='columns'),cmap='viridis',annot=True)</span></pre><figure class="je jf jg jh fd kw er es paragraph-image"><div class="er es lf"><img src="../Images/e89ed946e5c19ebc7fb00eddede9a8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*Rhnpts8HC6xYXiTHu8uLpQ.png"/></div></figure><p id="db01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，根据上面的热图，在EPL只有5.1%的比赛中，客队能够逆转半场失利的结果。然而，如果客队在半场时获胜，他们有69%的机会成为胜利者。此外，如果主队在半场时获胜，81%的主队最终会获胜。</p><p id="6a4f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们将分析一些主要车队的直接结果。我已经创建了一个功能，用户可以根据自己的意愿进入球队，代码将准备一个表格，列出头对头的记录。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="a61d" class="jn jo hi jj b fi jp jq l jr js">def win_loss():<br/>    team1=input("Please enter your first team")<br/>    team2=input("Please enter your second team")<br/>    new_df=df[(df['HomeTeam']==team1) | (df['HomeTeam']==team2)]<br/>    new_df=new_df[(new_df['AwayTeam']==team1) | (new_df['AwayTeam']==team2)]<br/>    return new_df['Winning Team'].value_counts()</span></pre><p id="f2b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，使用这个代码，我们可以看到阿森纳和切尔西的交锋记录。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="dfb6" class="jn jo hi jj b fi jp jq l jr js">Chelsea        14<br/>Match Drawn    13<br/>Arsenal         9</span></pre><p id="82a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢它。要连接，请通过以下链接访问我的LinkedIn个人资料。</p><p id="59a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://www.linkedin.com/in/suhaib-kamal/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/suhaib-kamal/</a></p></div></div>    
</body>
</html>