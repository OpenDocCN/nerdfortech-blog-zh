<html>
<head>
<title>What happens when you type a URL into your browser?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">当你在浏览器中输入网址时会发生什么？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-happens-when-you-type-a-url-into-your-browser-ca500d86975c?source=collection_archive---------1-----------------------#2022-11-20">https://medium.com/nerd-for-tech/what-happens-when-you-type-a-url-into-your-browser-ca500d86975c?source=collection_archive---------1-----------------------#2022-11-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/581933d02f7b240612a11c80838a2018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q3j0a7OThzbghmUJQ-NX-A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">当你在浏览器中输入 www.google.com 时会发生什么？</figcaption></figure><p id="c7b8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">本文面向以下受众:</em></p><ul class=""><li id="9d5c" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated"><em class="js">科技工作者</em></li><li id="1ae1" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">学生</em></li><li id="7c6f" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">产品经理</em></li><li id="57a0" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">营销团队</em></li><li id="8856" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">销售团队</em></li></ul><p id="d84c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">阅读这篇文章没有先决条件。我假设您已经使用 web 浏览器浏览过互联网。原文发表在<a class="ae kh" href="https://systemdesign.one/what-happens-when-you-type-url-into-your-browser/" rel="noopener ugc nofollow" target="_blank"> systemdesign.one </a>网站上。</p><p id="eef1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">免责声明</em> : <em class="js">系统设计问题是主观的。这篇文章是基于我对这个话题的研究而写的。欢迎分享您的反馈，并在评论中提问。</em></p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h2 id="5556" class="kp kq hi bd kr ks kt ku kv kw kx ky kz jf la lb lc jj ld le lf jn lg lh li lj bi translated">当你在浏览器中输入<em class="lk">Amazon.com</em>或<em class="lk">www.google.com</em>时会发生什么？</h2><p id="561d" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">在<strong class="iw hj">高电平</strong>下，当您在浏览器中键入一个 URL 并按 Enter 键时，以下操作在后台发生:</p><ol class=""><li id="9c64" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lq jz ka kb bi translated">DNS 解析</li><li id="16f7" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">TCP 三次握手</li><li id="46c2" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">HTTPS 升级</li><li id="221d" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">HTTP 请求/响应</li><li id="37df" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">浏览器呈现来自服务器的响应</li></ol></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="50e2" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">术语</h1><p id="fc1e" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">以下术语可能对您有用:</p><ul class=""><li id="ccb9" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">DNS:包含从域名到 IP 地址的映射的数据存储</li><li id="35a3" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">HTTP:用于在互联网上交换文件的标准应用层协议</li><li id="a936" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">HTTPS:HTTP 的安全(加密)版本</li><li id="a8ca" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">TCP:定义如何在客户端和服务器之间建立和维护网络对话的标准</li><li id="cbb5" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">客户端:允许您在互联网上执行不同操作的网络浏览器或移动设备</li><li id="067e" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">服务器:以网站形式存储文件和信息的计算机</li><li id="e203" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">URL:标识互联网上 web 资源的网址</li></ul></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="dfa0" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">介绍</h1><p id="a684" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">当您在浏览器中键入统一资源定位符(<a class="ae kh" href="https://en.wikipedia.org/wiki/URL" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> URL </strong> </a>)并按回车键时，大量操作将在后台执行。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/9ba7fbec66ccc4e2cdc36882d91ba025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*LOev8y_al9lNDdWCmGTcAw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTP 高级工作流</figcaption></figure><p id="e33a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">浏览器<strong class="iw hj">(客户端</strong>)必须找到托管网站的服务器的互联网协议(<a class="ae kh" href="https://en.wikipedia.org/wiki/IP_address" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> IP </strong> </a>)地址。客户端随后请求服务器的 IP 地址来传输或检索数据。当客户端在浏览器中输入缩短的 URL(使用<a class="ae kh" rel="noopener" href="/@system-design/url-shortening-system-design-88cd005604b4"> URL 缩短器</a>创建)时，在客户端和服务器之间传输数据之前，会有一个额外的 URL 重定向步骤。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><figure class="mj mk ml mm fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="6625" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">什么是域名解析？</h1><p id="3518" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">域名系统(<a class="ae kh" href="https://en.wikipedia.org/wiki/Domain_Name_System" rel="noopener ugc nofollow" target="_blank"><strong class="iw hj">)DNS</strong></a>)是一个数据存储，存储从域名(如 google.com)到其 IP 地址(142.250.185.78)的映射。你可以把域名系统比作地址簿或电话簿。</p><p id="493b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你需要一个<a class="ae kh" href="https://en.wikipedia.org/wiki/Domain_name" rel="noopener ugc nofollow" target="_blank">域名</a>(而不是直接使用 IP 地址)，因为记住一个人的域名很简单。每台服务器(例如 google.com)在互联网上都应该有一个唯一的 IP 地址。DNS 允许您使用域名在互联网上找到特定服务器的 IP 地址。</p><p id="bc0e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">域名空间(<strong class="iw hj"> DNS 层级</strong>)是一个倒树形结构。DNS 层次结构在顶级有一个域，称为根域。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mp"><img src="../Images/40f887c5d9873b6af52ce22d1006d565.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hyxkkxWwywqRykbIMRLdeA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">DNS 层次结构</figcaption></figure><p id="454c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">DNS 解析从根域 TLD 开始，一路向下到二级域。DNS 解析可能会遍历多个三级域，直到网站的主机名解析为 IP 地址。</p><p id="8905" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">URL 由以下部分组成[2]:</p><ul class=""><li id="1d27" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">协议(方案)</li><li id="d4e2" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">子整环</li><li id="05ef" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">域名(二级)</li><li id="b9b0" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">一级域名</li></ul><figure class="mj mk ml mm fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/d39c01b7680b361bef857c257a34e7ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/1*68ezIGC7qqEF8mw1zKVyiQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">基本 URL 结构</figcaption></figure><p id="98f5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">URL 的协议部分通知 web 服务器在访问网站时使用哪种协议。子域表示网站提供的服务，如地图或邮件。二级域名表示网站名称。顶级域名表示该组织在互联网上注册的实体类型。</p><p id="5e28" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">DNS 解析是一个连续的过程。只有在前面步骤中的缓存没有相关的 DNS 条目时，才会执行 DNS 解析的后续步骤。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mr"><img src="../Images/f8ba1223fa85b01564e9cfa68e3c0387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x2Ns6S3jCJWGEzR3CCr_Lg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">DNS 解析是如何工作的？</figcaption></figure><p id="8104" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">对于 DNS 解析，按顺序执行以下操作:</p><ol class=""><li id="a0c5" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lq jz ka kb bi translated">浏览器(<strong class="iw hj">客户端</strong>)检查主机名到 IP 地址的映射是否存在于客户端的本地缓存中。</li><li id="9e46" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">如果最后一步失败，客户端通过执行系统调用(<a class="ae kh" href="https://en.wikipedia.org/wiki/System_call#:~:text=In%20computing%2C%20a%20system%20call,on%20which%20it%20is%20executed." rel="noopener ugc nofollow" target="_blank"> syscall </a>)来检查操作系统(<a class="ae kh" href="https://en.wikipedia.org/wiki/Operating_system" rel="noopener ugc nofollow" target="_blank"> OS </a>)本地缓存。</li><li id="18d8" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">如果最后一步失败，客户端向网关/路由器发出 DNS 请求，并检查路由器的本地缓存。</li><li id="1f04" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">如果最后一步失败，路由器会将请求转发给互联网服务提供商(<a class="ae kh" href="https://en.wikipedia.org/wiki/Internet_service_provider" rel="noopener ugc nofollow" target="_blank"> ISP </a>)，并检查 ISP 的 DNS 缓存。</li><li id="8d4d" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">如果最后一步失败，DNS <a class="ae kh" href="https://en.wikipedia.org/wiki/Domain_Name_System#DNS_resolvers" rel="noopener ugc nofollow" target="_blank">解析器</a>查询根服务器(全球有 13 个根服务器有副本)。</li><li id="5d62" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">DNS 解析器查询顶级域(TLD)服务器，如。或. org。</li><li id="23b7" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">DNS 解析器查询权威的名称服务器，如 google.com。</li><li id="bb31" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">可选地，DNS 解析器根据您的查询查询权威子域服务器，如 maps.google.com 的<em class="js"/>。</li></ol><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ms"><img src="../Images/f9ad64a6bbc00d9ca1cad16dbb85501e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLAHFD-pygM4cNCCs2db-A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">递归 DNS 查找</figcaption></figure><p id="9913" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">一旦解析了 DNS 查询，DNS 解析过程中的中间组件将缓存带有生存时间(TTL)到期时间限制的结果。如果您更改网站的 IP 地址，客户端应该等到 TTL 过期后自动使缓存失效。缓存还改善了后续客户端请求的延迟。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="ae30" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">TCP 三次握手</h1><p id="e136" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">客户端应该创建一个到服务器的连接来传输和接收数据。传输控制协议(<a class="ae kh" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> TCP </strong> </a>)是超文本传输协议(<strong class="iw hj"> HTTP </strong>)中的底层协议之一。</p><p id="b2b2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以将 HTTP 比作客户端和服务器之间用于传输数据的抽象或高级协议(应用层或<a class="ae kh" href="https://en.wikipedia.org/wiki/OSI_model" rel="noopener ugc nofollow" target="_blank"> OSI </a>模型中的第 7 层)。在 HTTP 中传输的数据是人类可读的。TCP 是一个低层协议(OSI 模型中的传输层或第 4 层),处理数据包的错误检测和重传[3]。</p><p id="8ce5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">客户端与服务器进行三次握手，以建立 TCP 连接。由于双向通信信道，TCP 需要三次握手。如果进行双向握手，则只能启动单向通信通道。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/67ab47722e17d50e548ed99ec5f5eb54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRR2PCquXuKLy1MTotigug.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">TCP 三次握手</figcaption></figure><p id="8ed0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">以下 synchronize ( <strong class="iw hj"> SYN </strong>)和 acknowledge ( <strong class="iw hj"> ACK </strong>)消息在客户端和服务器之间发送，以打开 TCP 连接:</p><ol class=""><li id="369d" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lq jz ka kb bi translated">客户端发送一个带有随机序列号的 SYN 请求(<em class="js"> x </em>)。</li><li id="229a" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">服务器用 SYN-ACK 响应。确认号被设置为比接收到的序列号多 1(<em class="js">x+1</em>)。服务器发送另一个随机序列号(<em class="js"> y </em>)。</li><li id="8f0c" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">客户端发送 ACK。客户端发送一个比接收到的序列号多 1 的确认号(<em class="js"> y+1 </em>)。</li></ol></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="76ef" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">HTTPS 升级</h1><p id="447b" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">超文本传输协议 Secure ( <a class="ae kh" href="https://en.wikipedia.org/wiki/HTTPS" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> HTTPS </strong> </a>)是超文本传输协议(<a class="ae kh" href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> HTTP </strong> </a>)的扩展。通过 HTTP 传输的数据没有加密，因此任何人都可以窃听传输的数据包。HTTPS 加密传输的数据，从而防止中间人攻击[4]。互联网上的大多数现代网站使 HTTPS 能够进行安全通信。默认情况下，HTTPS 使用端口 443，而 HTTP 使用端口 80。</p><p id="9ab7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在<a class="ae kh" href="https://en.wikipedia.org/wiki/Public-key_cryptography" rel="noopener ugc nofollow" target="_blank">非对称加密</a>中，有一个密钥对——公钥和私钥。公钥可以与互联网上的任何人共享，而私钥永远不应该共享。在<a class="ae kh" href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm" rel="noopener ugc nofollow" target="_blank">对称加密</a>中，只有一个私钥，双方都应该可以使用同一个密钥来加密或解密消息。</p><p id="bbc5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你可以把不对称加密比作电子邮件服务。公钥是您的电子邮件地址，私钥是用于访问电子邮件帐户的密码。任何人都可以通过查看发件人的电子邮件地址来轻松验证您是否发送了该电子邮件。但是，如果任何人向您的帐户发送电子邮件，只有您可以使用密码访问它。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/d1341787bb1ab25e5fa523d75b593ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8TCKhrBOXp_SaDT6g2MfA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTPS 升级请求</figcaption></figure><p id="4866" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在传输任何数据包之前，在客户端和服务器之间执行以下操作以将 HTTP 升级到 HTTPS:</p><ol class=""><li id="705e" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lq jz ka kb bi translated">浏览器(<strong class="iw hj">客户端</strong>)使用 HTTP 请求头向服务器发出 HTTPS 升级请求。</li><li id="ccd6" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">服务器用安全套接字层(<a class="ae kh" href="https://en.wikipedia.org/wiki/Transport_Layer_Security#SSL_1.0,_2.0,_and_3.0" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> SSL </strong> </a>)证书来响应客户端，该证书包含服务器的公钥，该公钥由认证机构(<a class="ae kh" href="https://en.wikipedia.org/wiki/Certificate_authority" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> CA </strong> </a>)签名。</li><li id="5f02" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">默认情况下，客户端拥有流行的 CA(例如，Google CA)的公钥。客户端可以使用 CA 的公钥，通过检查数字签名来验证 SSL 证书的有效性(数字签名在<a class="ae kh" href="https://en.wikipedia.org/wiki/Public-key_cryptography" rel="noopener ugc nofollow" target="_blank">非对称加密</a>中)。</li><li id="1acc" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">客户端创建新的<a class="ae kh" href="https://en.wikipedia.org/wiki/Symmetric-key_algorithm" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj">对称</strong> </a>私钥，并用服务器的公钥对新的对称私钥进行加密。</li><li id="461e" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">服务器使用服务器的私钥对客户端共享的新对称私钥进行解密。</li><li id="a9f2" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">客户端和服务器之间的任何进一步通信都将使用新的对称私钥进行加密，因此保持安全。</li></ol><p id="24e6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">由于不对称加密，任何侦听 HTTP 升级请求或响应消息的人都无法捕获任何有意义的数据。HTTPS 升级后，客户端和服务器之间的进一步通信将使用对称加密。</p><p id="494d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了创建 SSL 证书，服务器向 CA 执行证书签名请求(<a class="ae kh" href="https://en.wikipedia.org/wiki/Certificate_signing_request" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> CSR </strong> </a>)。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/fe2359bb59707e9c190f2a5d7faa4a00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6tvRuq9La4mCXKUKmS1EQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">SSL 证书签名请求</figcaption></figure><p id="e255" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">CSR 将服务器的公钥传送给 CA。CA 有一对公钥和私钥。CA 使用 CA 的私钥签署服务器的公钥，并创建 SSL 证书。互联网上任何可以访问 CA 公钥的人都可以很容易地验证 SSL 证书的数字签名。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="6a96" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">HTTP 请求/响应</h1><p id="4719" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">超文本传输协议(<strong class="iw hj"> HTTP </strong>)是一种在客户端和服务器之间传输数据的机制。客户端向服务器发出 HTTP(S)请求来获取或传输数据。服务器响应请求的相关内容和完成状态信息[5，6]。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div class="er es mw"><img src="../Images/a963246818f672f5ee43623c8bbe0bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*mxGFSWFc1GRFYw_QLT1P7Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTP 简化工作流程</figcaption></figure><p id="d9a1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">客户端发出一个 GET HTTP 请求来查看一个网站(比如 google.com)。如果客户端想要向服务器提交数据(比如在 google.com 中搜索某个关键字)，客户端会发出一个 POST HTTP 请求。</p><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mx"><img src="../Images/760cfcb94e894b0d2983bb95ae56a8dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AMWzur_fO_miHT_I1uxnIg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">基本 HTTP URL 结构</figcaption></figure><p id="73ea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">URL 可以分解成多个部分。域名用于标识服务器。URL 路径用于标识服务器上的资源(特定文件或信息)。查询参数用于过滤或排序数据(或传输有状态的信息)。以下是您在客户端查看 google.com 网站时的简化工作流程[7，8]:</p><ol class=""><li id="4f0a" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr lq jz ka kb bi translated">客户端向 google.com 服务器发出 HTTP GET 方法请求</li><li id="9118" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr lq jz ka kb bi translated">如果成功，服务器响应一个<em class="js"> 200 OK </em>状态代码</li></ol><p id="4d1d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">HTTP 请求由以下实体组成:</p><ul class=""><li id="167e" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">统一资源定位器(URL)</li><li id="49be" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">HTTP 标题</li><li id="6654" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">HTTP 正文(可选)</li></ul><figure class="mj mk ml mm fd ij er es paragraph-image"><div class="er es my"><img src="../Images/6d75851c7739631744465124cb0e6fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*zk_Dh-k1i_D_3lWWg14Cuw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTP 请求</figcaption></figure><p id="8ef2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">HTTP 请求方法(动词)定义了应该在服务器上执行的操作类型。下面是一些流行的 HTTP 方法:</p><figure class="mj mk ml mm fd ij"><div class="bz dy l di"><div class="mz mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">流行的 HTTP 方法</figcaption></figure><p id="14e6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">幂等:资源的多次调用产生相似的结果</em></p><p id="4d6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="js">安全:调用不会修改资源</em></p><p id="521c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">服务器(<a class="ae kh" href="https://www.nginx.com/" rel="noopener ugc nofollow" target="_blank"> Nginx </a>，Apache web 服务器)将 HTTP 请求委托给请求处理程序。请求处理程序是用任何服务器端编程语言(如 Python、Node.js 或 Java)定义的一段代码。请求处理器检查请求的 HTTP 头(<em class="js">内容类型、内容编码、cookie</em>等)，然后验证 HTTP 请求体。请求处理器然后在客户端请求的<em class="js">内容类型</em> (JSON，XML)中生成适当的响应。</p><p id="ef0a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">HTTP 服务器响应由以下实体组成:</p><ul class=""><li id="48dd" class="jt ju hi iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated">HTTP 标题</li><li id="a0cf" class="jt ju hi iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated">HTTP 正文</li></ul><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es na"><img src="../Images/7f5e8d0e3e05d664899d5f8103c01d80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rzb3OjZzthsLxspfBugT-Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTP 响应</figcaption></figure><p id="b3f4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">HTTP 响应状态代码帮助您排除故障。HTTP 状态代码可以分为以下几类[9，10]:</p><figure class="mj mk ml mm fd ij"><div class="bz dy l di"><div class="mz mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">HTTP 状态代码</figcaption></figure><p id="70bd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">HTTP 请求和响应头用于控制缓存、授权客户端或压缩在客户端和服务器之间传输的数据。例如，<em class="js">用户代理</em> HTTP 请求头帮助服务器识别客户机是移动客户机还是桌面客户机。下面是一些最流行的 HTTP 头:</p><figure class="mj mk ml mm fd ij"><div class="bz dy l di"><div class="mz mo l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">流行的 HTTP 头</figcaption></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="d83b" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">浏览器呈现来自服务器的响应</h1><figure class="mj mk ml mm fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nb"><img src="../Images/f30cd021271355b1b0ba1a009467a1fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIiKROWX9wsl36JMXBTUVw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">呈现网站的浏览器</figcaption></figure><p id="0377" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">浏览器可能会向服务器发出多个 HTTP 请求，以获取网站的所有相关数据，如级联样式表(CSS)、JavaScript 文件、图像或视频。最后，浏览器呈现 HTML 和从服务器接收的内容[11]。</p><p id="b5db" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">根据 HTTP 响应头(<em class="js"> Cache-control </em>)，浏览器缓存响应以防止从服务器重新请求相同的数据。缓存改善了网站的延迟。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="12e4" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">摘要</h1><p id="08a1" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">客户端通常会缓存带有任意生存时间(<a class="ae kh" href="https://en.wikipedia.org/wiki/Time_to_live#:~:text=Time%20to%20live%20(TTL)%20or,data%20is%20discarded%20or%20revalidated." rel="noopener ugc nofollow" target="_blank"> <strong class="iw hj"> TTL </strong> </a>)到期时间的 DNS 映射和服务器响应。由于本地缓存的原因，当您重新访问同一个网站时，不会多次查询 DNS 服务器。</p><p id="1284" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在互联网规模的系统中，有多个组件作为中间层来满足传入的负载需求。内容交付网络(<a class="ae kh" href="https://en.wikipedia.org/wiki/Content_delivery_network" rel="noopener ugc nofollow" target="_blank"> CDN </a>)、<a class="ae kh" href="https://en.wikipedia.org/wiki/Load_balancing_(computing)" rel="noopener ugc nofollow" target="_blank">负载平衡器</a>和<a class="ae kh" href="https://en.wikipedia.org/wiki/Reverse_proxy" rel="noopener ugc nofollow" target="_blank">反向代理</a>是可能出现在大规模系统中的一些中间组件。</p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><figure class="mj mk ml mm fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="4180" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated"><strong class="ak">问题和解决方案</strong></h1><p id="fd16" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">如果你想挑战你的知识，请访问媒体文章:<a class="ae kh" rel="noopener" href="/@system-design/knowledge-test-what-happens-when-you-type-a-url-into-your-browser-8b47056c59c">知识测试</a></p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="f937" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">许可证</h1><p id="a2b1" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated"><a class="ae kh" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="noopener ugc nofollow" target="_blank">原文章<strong class="iw hj">必须反向链接</strong>。</a></p></div><div class="ab cl ki kj gp kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hb hc hd he hf"><h1 id="808e" class="lr kq hi bd kr ls lt lu kv lv lw lx kz ly lz ma lc mb mc md lf me mf mg li mh bi translated">参考</h1><p id="bd97" class="pw-post-body-paragraph iu iv hi iw b ix ll iz ja jb lm jd je jf ln jh ji jj lo jl jm jn lp jp jq jr hb bi translated">[1] <a class="ae kh" href="https://en.wikipedia.org/wiki/Domain_Name_System" rel="noopener ugc nofollow" target="_blank">域名系统</a>，Wikipedia.org</p><p id="62d4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[2] <a class="ae kh" href="https://en.wikipedia.org/wiki/URL" rel="noopener ugc nofollow" target="_blank">网址</a>，Wikipedia.org</p><p id="9c5d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[3] <a class="ae kh" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol" rel="noopener ugc nofollow" target="_blank">传输控制协议</a>，Wikipedia.org</p><p id="3796" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[4]<a class="ae kh" href="https://en.wikipedia.org/wiki/HTTPS" rel="noopener ugc nofollow" target="_blank">Wikipedia.org HTTPS</a></p><p id="d848" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[5]<a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers" rel="noopener ugc nofollow" target="_blank">MDN Web docs HTTP headers</a>，Mozilla.org</p><p id="0e6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[6] <a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status" rel="noopener ugc nofollow" target="_blank"> MDN Web docs HTTP 响应状态码</a>，Mozilla.org</p><p id="c35a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[7] <a class="ae kh" href="https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods" rel="noopener ugc nofollow" target="_blank"> HTTP 请求方法【Wikipedia.org T21】</a></p><p id="0582" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[8] <a class="ae kh" href="https://www.cloudflare.com/en-gb/learning/ddos/glossary/hypertext-transfer-protocol-http/" rel="noopener ugc nofollow" target="_blank">什么是 HTTP </a>，Cloudflare.com</p><p id="195a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[9] <a class="ae kh" href="https://learn.microsoft.com/en-us/azure/architecture/best-practices/api-design" rel="noopener ugc nofollow" target="_blank"> RESTful web API 设计</a>，learn.microsoft.com</p><p id="09ca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[10]多恩·马丁，<a class="ae kh" href="https://github.com/donnemartin/system-design-primer#communication" rel="noopener ugc nofollow" target="_blank">系统设计入门 HTTP 通讯</a>，GitHub</p><p id="2c5a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">[11] <a class="ae kh" href="https://developer.mozilla.org/en-US/docs/Web/Performance/How_browsers_work" rel="noopener ugc nofollow" target="_blank">填充页面:浏览器如何工作</a>，Mozilla.org</p></div></div>    
</body>
</html>