<html>
<head>
<title>Background Tasks Made Easy With Hangfire And .Net 5</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Hangfire 和。网络 5</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/background-tasks-made-easy-with-hangfire-and-net-5-46bbd3b5ac91?source=collection_archive---------1-----------------------#2021-04-03">https://medium.com/nerd-for-tech/background-tasks-made-easy-with-hangfire-and-net-5-46bbd3b5ac91?source=collection_archive---------1-----------------------#2021-04-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9a6cd619637da01e511b6f7dc1fe44c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fqUWw3DV_uDAEildDIYCsA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">与...交火。Net 5.0</figcaption></figure><p id="96d2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated">在这篇文章中，我们将学习绞刑。Net 库，使我们的后台任务和工作更容易在 ASP.NET 5.0。众所周知，其新推出的框架于 11 月正式发布。在这里我分享了为<a class="ae kb" href="https://dotnet.microsoft.com/download/dotnet/5.0" rel="noopener ugc nofollow" target="_blank">T3 安装 SDK 的链接。net 5T5】</a></p><p id="6a88" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">先决条件</strong></p><ol class=""><li id="d63d" class="kd ke hi iw b ix iy jb jc jf kf jj kg jn kh jr ki kj kk kl bi translated">什么是 Hangfire，为什么我需要后台任务。</li><li id="310f" class="kd ke hi iw b ix km jb kn jf ko jj kp jn kq jr ki kj kk kl bi translated">设置和配置 Hangfire</li><li id="6aef" class="kd ke hi iw b ix km jb kn jf ko jj kp jn kq jr ki kj kk kl bi translated">保护 Hangfire 仪表板。</li><li id="948b" class="kd ke hi iw b ix km jb kn jf ko jj kp jn kq jr ki kj kk kl bi translated">悬火保留时间。</li><li id="8c4f" class="kd ke hi iw b ix km jb kn jf ko jj kp jn kq jr ki kj kk kl bi translated">SQL 数据库的持久性。</li></ol><h1 id="6509" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">什么是 Hangfire，为什么我们需要使用它？</h1><p id="cf62" class="pw-post-body-paragraph iu iv hi iw b ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr hb bi translated">Hangfire 是一个. Net 库，有助于在中创建后台任务并简化作业。Net 应用程序。它支持所有类型的任务，如“一劳永逸”和“重复”以及连续作业。你可以在这里了解更多:<a class="ae kb" href="https://www.hangfire.io/" rel="noopener ugc nofollow" target="_blank"> <em class="kc"> Hangfire </em> </a></p><p id="d0aa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">为什么我需要后台任务？</strong></p><p id="752a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当您需要执行某项操作或安排某项任务在特定时间执行时，后台任务非常重要。使用后台任务，流程可以在后台继续运行，用户不能等待逐步流程。</p><p id="f631" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">绞刑中的不同工种</strong></p><p id="57fd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">重复作业</strong> —每 5 分钟运行一次后台任务，并将数据插入数据库。</p><p id="6ecd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">一劳永逸</strong> —当我们运行应用程序时，该作业仅运行一次。</p><p id="2fc0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">连续作业</strong> —当我们想在那个时候一个接一个地运行作业时，这很有用，这样它就会一个接一个地执行。</p><p id="43cf" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">重复作业</strong> —每 5 分钟运行一次后台任务，并将数据插入数据库。</p><p id="38e4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">计划任务</strong> —如果您想要计划一项任务在特定时间运行。</p><p id="ffca" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> GitHub </strong></p><div class="lu lv ez fb lw lx"><a href="https://github.com/JayKrishnareddy/Hangfire" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hj fi z dy mc ea eb md ed ef hh bi translated">JayKrishnareddy/Hangfire</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">背景工作-绞刑。净 5。通过在…上创建帐户，为 JayKrishnareddy/Hangfire 的发展做出贡献</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">github.com</p></div></div></div></a></div><h1 id="f564" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">设置和配置 Hangfire</h1><p id="3ac3" class="pw-post-body-paragraph iu iv hi iw b ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr hb bi translated">使用创建和设置项目模板。网络 5</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/83b7d3e952b497edf41afe58b4fd6792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lvYd6VzZGN8aLgFB.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">模板</figcaption></figure><p id="a572" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了配置 Hangfire，我们需要安装 hangfire 相关的包。下面是帮助配置和设置身份验证以及在 SQL 中存储作业相关信息的 4 个包。</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ml"><img src="../Images/d415510872319a3cd3627fcdd0542964.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kDVWiG-i-eRzkPRK.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">NuGet 包管理器</figcaption></figure><p id="21c8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在这个项目中，我使用后台任务将数据插入数据库——hang fire 和代码优先方法。</p><p id="3b26" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">型号</strong></p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/d224c592e268dad482009e393c228abc.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/0*P3SsM0F8ga9KaVWh.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">模型文件夹</figcaption></figure><p id="fae3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">员工。cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="9129" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> AppDbContext </strong></p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mp"><img src="../Images/9b0a226f767d010ecf27953993966098.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/0*4k4moCRdtkzfUOkU.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">ApDbContext 文件夹</figcaption></figure><p id="b7a0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">employeed context . cs</strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="0c88" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> appsettings.js </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="0f2e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在启动文件中配置连接字符串和 Hangfire 以及服务注入。</p><p id="5dfd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Startup.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="63ad" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，我们必须在包管理器控制台中使用下面的迁移命令来创建表。</p><p id="1293" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在目标项目中创建迁移文件夹和迁移脚本。</p><p id="cf12" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PM &gt;添加-迁移“迁移名称”</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mq"><img src="../Images/803f00e8fc75e6c033736d0aebd4aeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/0*X_tbhj7FUItBj1AO.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">迁移文件夹</figcaption></figure><p id="365a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">下一个命令执行迁移脚本并在数据库中创建一个表</p><p id="3040" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PM &gt;更新-数据库</p><p id="d580" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">服务业</strong></p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mr"><img src="../Images/33b5a56ccbe8e46b7e991cdb3703a8f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/0*xLQGCMmctDHuzkqh.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">服务文件夹</figcaption></figure><p id="c951" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> EmployeeService.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="934a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> IEmployeeService.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="f5ff" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">服务注入已经在启动时完成了。cs 文件</p><ol class=""><li id="4e66" class="kd ke hi iw b ix iy jb jc jf kf jj kg jn kh jr ki kj kk kl bi translated">服务。add transient<iemployeeservice employeeservice="">()；</iemployeeservice></li></ol><h1 id="3203" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">保护悬挂式仪表板</h1><p id="64c2" class="pw-post-body-paragraph iu iv hi iw b ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr hb bi translated">为了确保 hangfire 仪表盘的安全，我们设置了登录验证，以便访问 hangfire 仪表盘。我在 appsettings.js 文件中硬编码了用户名和密码，以使用 startup.cs 中的用户名和密码</p><p id="9aea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> appsettings.js </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="0d8d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Starup.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><h1 id="8ef4" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">悬火保留时间</h1><p id="d305" class="pw-post-body-paragraph iu iv hi iw b ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr hb bi translated">通常，在后台运行的 hangfire 作业将持续 24 小时。为了避免这种情况，我必须在仪表板中启用基本设置，以持续该作业至少 1 周。</p><p id="f83e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Startup.cs </strong></p><ol class=""><li id="7375" class="kd ke hi iw b ix iy jb jc jf kf jj kg jn kh jr ki kj kk kl bi translated">全局配置。配置。使用 SqlServerStorage(配置。GetConnectionString("myconn "))。WithJobExpirationTimeout(TimeSpan。from days(7))；</li></ol><h1 id="2bd7" class="kr ks hi bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">SQL 数据库的持久性</h1><p id="32d5" class="pw-post-body-paragraph iu iv hi iw b ix lp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn lt jp jq jr hb bi translated">Hangfire 有一个选项，可以将所有与工作相关的信息存储在数据库中。为此，我们不需要任何东西，我们必须在启动时配置这个设置。它会自动创建所有表格，我们可以在这些表格中看到作业状态和相应的信息。</p><p id="5a84" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Startup.cs </strong></p><ol class=""><li id="07e3" class="kd ke hi iw b ix iy jb jc jf kf jj kg jn kh jr ki kj kk kl bi translated">服务。AddHangfire(c = &gt; c . usesql server storage(Configuration。get connectionstring(" my conn "))；</li></ol><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es ms"><img src="../Images/34d54ee8dff361638034cd7191b5b7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/0*ZAJH4umwjaoAi-2o.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">SQl 自动生成的 hangfire 表</figcaption></figure><p id="b666" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上面这组表是在我们配置设置并指向数据库时自动创建的。</p><p id="fdab" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">创建后台任务</strong></p><p id="f1b4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Job.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="c4c1" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有 4 种类型的工作是我们最常使用的。我已经在 startup.cs 文件中创建了所有 4 个作业。</p><p id="f93d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj"> Starup.cs </strong></p><figure class="mh mi mj mk fd ij"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="7d53" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">运行应用程序</strong></p><p id="84de" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">默认情况下，swagger 端点将打开。现在在 URL 中输入 hangfire，去掉 swagger。由于我们已经设置了身份验证机制，它将要求输入用户名和密码。</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/2e3b4857068b3b3f19610ae8cd3eabcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1UMk--TAPDCSwSPGzgiiA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">Hangfire —身份验证</figcaption></figure><p id="53db" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你试图在没有登录的情况下访问。</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/d7d166da18a3daa103aaa75cb9e4114e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g3BOMLpGRjnxUspBU2hNBg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">认证错误</figcaption></figure><p id="16a6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果您单击“jobs”并成功，我们将看到作业执行状态及其时间，还可以在控制面板中看到历史图表。</p><figure class="mh mi mj mk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/c958740b75611628d5278c0d7a724d7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2w9oLGqIQiGJrsqVbwCBoA.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">完整的悬挂式仪表盘</figcaption></figure><p id="4fa0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以在选项卡和菜单中看到我们的计划作业和重复作业，我们还可以选择删除您不想再看到的特定作业。</p><p id="5373" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我希望这篇文章能帮助你尽可能容易地创建后台任务！</p><p id="7cb5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kc">支持我</em></p><figure class="mh mi mj mk fd ij er es paragraph-image"><div class="er es mw"><img src="../Images/7a5c035cd21f7fa41bd8ae7cbadf7d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/1*1LFaaJOnWU9L0G6_c_wRWQ.png"/></div></figure><p id="314a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">继续学习…！</p></div></div>    
</body>
</html>