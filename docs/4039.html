<html>
<head>
<title>Why Get Rid Of PromisesTo Fetch Data In React?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么要在React中去掉获取数据的承诺？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/why-get-rid-of-promisesto-fetch-data-in-react-bd9f61b6e697?source=collection_archive---------13-----------------------#2021-07-04">https://medium.com/nerd-for-tech/why-get-rid-of-promisesto-fetch-data-in-react-bd9f61b6e697?source=collection_archive---------13-----------------------#2021-07-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a68f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如何让你的代码结构良好！！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4934392afcd446aade7fc852016e9eb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*49yXrBAWTaw-TfB0"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">克里斯里德在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="601b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嘿，<strong class="ih hj">你还在一个大项目中使用承诺来获取数据吗，</strong>这导致你的代码看起来很乱？</p><p id="f949" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候将<strong class="ih hj"> <em class="ju">从承诺切换到结构良好的数据获取</em> </strong>并使您的代码变得干净。所以，我们从一个文件开始到另一个文件。但是在你开始编码和<strong class="ih hj"> <em class="ju">实现这个过程</em> </strong>之前，让我给你一个我们的文件结构是什么样子的概念…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jv"><img src="../Images/9533d63ef8399ccc1e19504645843cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*lU8VH3tOHqJFCMZHiMuFaw.png"/></div></figure><p id="a9f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们的代码看起来的样子，我建议你照着做。</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="9a55" class="kb kc hi jx b fi kd ke l kf kg"><strong class="jx hj">NOTE<em class="ju">: we have to only create a store folder only</em></strong></span></pre><p id="c18a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，让我们从store文件夹开始，在store文件夹中创建文件名<strong class="ih hj"> <em class="ju"> store.js </em> </strong>并编写如下代码:</p><p id="fa3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju"> store.js </em> </strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="074c" class="kb kc hi jx b fi kd ke l kf kg">import { createStore, applyMiddleware } from "redux";<br/>import { persistStore } from "redux-persist";<br/>import thunk from "redux-thunk";<br/>import rootReducer from "./reducer/rootReducer";<br/>import { composeWithDevTools } from "redux-devtools-extension";</span><span id="3df1" class="kb kc hi jx b fi kh ke l kf kg">export const store = createStore(<br/> rootReducer,<br/> composeWithDevTools(applyMiddleware(thunk)),<br/>);<br/>export const persistor = persistStore(store);<br/>export default store;</span></pre><p id="c6f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">关于这个代号:</em> </strong></p><p id="3fc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> createStore </strong>授予我们<strong class="ih hj"> <em class="ju">创建商店</em> </strong>的权限。也就是有减速器(你可以创建多个，但是我已经导入了一个有多个减速器<strong class="ih hj">的根减速器</strong>。</p><p id="0221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在此之后，thunk is <strong class="ih hj">中间件</strong>允许副作用运行而不阻塞状态更新。我们在商店中应用了中间件。Persisitor用于我们商场使用的本地存储。</p><p id="91e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，创建文件夹reducer并创建根Reducer，以便在根中添加多个Reducer。</p><p id="35ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="ju">root reducer . js</em>T43】</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="bdc1" class="kb kc hi jx b fi kd ke l kf kg">import { combineReducers } from "redux";<br/>import { persistReducer } from "redux-persist";<br/>import storage from "redux-persist/lib/storage";<br/>import adminReducer from "./adminReducer";</span><span id="61de" class="kb kc hi jx b fi kh ke l kf kg">const persistConfig = { key: "root", storage, whitelist: [] };<br/>const rootReducer = combineReducers({<br/> admin: adminReducer,<br/>});<br/>export default persistReducer(persistConfig, rootReducer);</span></pre><p id="4dfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">关于这段代码:</em> </strong></p><p id="0eb7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们配置了我们在代码中使用的持久化器。而<strong class="ih hj"> <em class="ju"> rootReducer </em> </strong>就是用合并器来合并那些Reducer。并且我们已经通过<strong class="ih hj"> admin </strong>(记住这个以后用)<strong class="ih hj">初始化了这个缩减器的名字。</strong>之后，我们用<strong class="ih hj">配置</strong>和<strong class="ih hj"> rootReducer </strong>输出了这个<strong class="ih hj">持久器</strong>。</p><p id="c88e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们创建了adminReducer，这是我们在rootReducer中使用的。让我们创建文件:</p><p id="0546" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">T63】admin reducer . jsT65】</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="2b96" class="kb kc hi jx b fi kd ke l kf kg">import * as types from "./../types/types";</span><span id="0484" class="kb kc hi jx b fi kh ke l kf kg">const initalState = {<br/> <strong class="jx hj">monsterList</strong>: [],<br/>};</span><span id="dc5c" class="kb kc hi jx b fi kh ke l kf kg">const adminReducer = (state = initalState, action) =&gt; {<br/> <strong class="jx hj">switch (action.type) {</strong><br/>  case types.FETCH_MONSTER_DATA:<br/>   return {<br/>    ...state,<br/>    <strong class="jx hj">monsterList</strong>: action.payload,<br/>   };<br/>  default:<br/>   return state;<br/> <strong class="jx hj">}</strong><br/>}<br/>export default adminReducer;</span></pre><p id="9dc7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">关于这段代码:</em> </strong></p><p id="fa86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们创建了一个名为monsterList的状态，我们将使用它来存储数据，这些数据将在我们点击API时存储，我们将在我们的组件中使用它来提取数据。</p><p id="90c6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们使用了一个开关来匹配我们在动作中使用的大小写，其中动作确定哪个状态与它相关，动作存储数据。</p><p id="97d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我们将在包含adminAction文件的<strong class="ih hj"> Actions </strong>的store文件夹中创建一个文件夹。</p><p id="10bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju"> adminAction.js </em> </strong>:</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="c0a1" class="kb kc hi jx b fi kd ke l kf kg">import * as actionTypes from "./../types/types";<br/>import { handleResponse } from "./../helpers/userServices";</span><span id="1419" class="kb kc hi jx b fi kh ke l kf kg">export const <strong class="jx hj">MonsterListing </strong>= () =&gt; {<br/> return (dispatch) =&gt; {<br/>  const request = new  Request("<a class="ae jt" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>", {<br/>   method: "GET",<br/>   headers: new Headers({<br/>    "Content-Type": "application/json",<br/>   }),<br/>  });<br/>  return fetch(request)</span><span id="4da2" class="kb kc hi jx b fi kh ke l kf kg">   <strong class="jx hj">.then(handleResponse)</strong><br/>   .then((data) =&gt; {</span><span id="a868" class="kb kc hi jx b fi kh ke l kf kg">    <strong class="jx hj">// NOTE HERE</strong></span><span id="e981" class="kb kc hi jx b fi kh ke l kf kg">    <strong class="jx hj">dispatch({<br/>     type: actionTypes.FETCH_MONSTER_DATA,<br/>     payload: data,<br/>    });</strong><br/>    return 1;<br/>   })<br/>   .catch((error) =&gt; {<br/>    return 0;<br/>   });<br/> };<br/>};</span></pre><p id="43da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="ju">关于这段代码:</em> </strong></p><p id="3a1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经创建了一个名为<strong class="ih hj"> MonsterListing、</strong>的动作，并看到了URL路径，然后在我注释了“<strong class="ih hj"> <em class="ju">的地方查看，注意这里是</em> </strong>”。我们在那里调度类型名<strong class="ih hj"> FETCH_MONSTER_DATA </strong>，我们也在<strong class="ih hj"> adminReducer </strong>中使用它。这被称为减速器，传递数据相关状态，具有相同的<strong class="ih hj">动作类型</strong>。</p><h2 id="3372" class="kb kc hi bd ki kj kk kl km kn ko kp kq iq kr ks kt iu ku kv kw iy kx ky kz la bi translated"><strong class="ak">注:</strong></h2><p id="a435" class="pw-post-body-paragraph if ig hi ih b ii lb ik il im lc io ip iq ld is it iu le iw ix iy lf ja jb jc hb bi translated">创建文件夹名称<strong class="ih hj">类型</strong>并创建文件名:</p><p id="8398" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">T27】types . jsT29】</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="e4c2" class="kb kc hi jx b fi kd ke l kf kg">export <em class="ju">const</em> FETCH_MONSTER_DATA = "FETCH_MONSTER_DATA";</span></pre><p id="3f2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在返回数据时使用了一个函数，这个函数名为handleResponse，它处理响应并从API返回数据。</p><p id="c34a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，在店内创建一个文件夹，用<strong class="ih hj">助手</strong>命名该文件夹，并创建一个文件名</p><p id="76f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">T33】userservice . jsT35】</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="b96a" class="kb kc hi jx b fi kd ke l kf kg">import swal from "sweetalert";</span><span id="ea3c" class="kb kc hi jx b fi kh ke l kf kg">export const handleResponse = (response) =&gt; {<br/> return response.text().then((text) =&gt; {<br/>  if (response.status === 500) {<br/>   swal({ title: "Error!", text: 'Something Went Wrong! Please Try Again Later.', icon: "error" });<br/>  }<br/>  const data = text &amp;&amp; JSON.parse(text);<br/>  if (!response.ok) {<br/>   if (response.status === 401 || response.status === 400) {<br/>    localStorage.removeItem("token");<br/>    window.location.href = "/";<br/>   }<br/>   const error = (data &amp;&amp; data.message) || response.statusText;<br/>   return Promise.reject(error);<br/>  }<br/>  return data;<br/> });<br/>};</span></pre><p id="af64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">几乎所有的事情都完成了，我们只需要在APP.js中设置这个动作(或者你想调用这个动作的地方)。</p><p id="3e88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，让我们开始吧，</p><p id="db60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">T37】app . jsT39】</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="eebe" class="kb kc hi jx b fi kd ke l kf kg">// import component and whatever you needed</span><span id="c634" class="kb kc hi jx b fi kh ke l kf kg">import { MonsterListing } from "./store/actions/adminActions";</span></pre><p id="2313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当我们在组件中调用API时，我们都使用生命周期方法，所以让我们使用componentDidMount。但在此之前，让我给你展示一下我们以前是如何调用API的:</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="2037" class="kb kc hi jx b fi kd ke l kf kg">componentDidMount() <br/>  fetch("<a class="ae jt" href="https://jsonplaceholder.typicode.com/users" rel="noopener ugc nofollow" target="_blank">https://jsonplaceholder.typicode.com/users</a>")<br/>  .then((response) =&gt; response.json())<br/>  .then((users) =&gt; this.setState({ monsters: users }));<br/> }</span></pre><p id="81ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相反，我们只需要调用我们已经创建的动作。像这样:</p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="b50c" class="kb kc hi jx b fi kd ke l kf kg">componentDidMount() {<br/>  // we're receiving in props because we're connecting component with connect at the end of the component.</span><span id="e99c" class="kb kc hi jx b fi kh ke l kf kg">  this.props.MonsterListing();<br/> }</span></pre><p id="8733" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看为什么使用<strong class="ih hj">this . props . monster listing():</strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="2ac3" class="kb kc hi jx b fi kd ke l kf kg">const mapStateToProps = (state) =&gt; ({<br/> admin: state.admin,<br/>});<br/>export default connect(mapStateToProps, { MonsterListing })(App);</span></pre><p id="2e03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，您需要从“react-redux”导入连接。但问题仍然是我们使用这个的方式。行动前的道具？</p><p id="86d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">答案是<strong class="ih hj">“Redux分派传递到道具中的动作(在花括号中)。因此，如果我们没有调度或者我们需要调用API，那么我们需要使用它。道具”。</strong></p><p id="65b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，请看<strong class="ih hj"> <em class="ju"> App.js的完整代码:</em> </strong></p><pre class="je jf jg jh fd jw jx jy jz aw ka bi"><span id="6136" class="kb kc hi jx b fi kd ke l kf kg">import React from "react";<br/>import "./App.css";<br/>import { CardList } from "./components/card-list/card-list";<br/>import { SearchBox } from "./components/search-box/search-box.component";<br/>import { connect } from "react-redux";<br/>import { MonsterListing } from "./store/actions/adminActions";</span><span id="6d41" class="kb kc hi jx b fi kh ke l kf kg">class App extends React.Component {<br/> constructor(props) {<br/>  super(props);</span><span id="56a8" class="kb kc hi jx b fi kh ke l kf kg">this.state = {<br/>   searchField: "",<br/>  };<br/> }<br/> componentDidMount() {<br/>  this.props.MonsterListing();<br/> }</span><span id="c37c" class="kb kc hi jx b fi kh ke l kf kg">render() {<br/>  const { monsterList } = this.props.admin;<br/>  const { searchField } = this.state;<br/>  const filteredMonster = monsterList.filter((monster) =&gt;<br/>   monster.name.toLowerCase().includes(searchField.toLowerCase()),<br/>  );<br/>  return (<br/>   &lt;div className="App"&gt;<br/>    &lt;h1&gt;Monster's World&lt;/h1&gt;<br/>    &lt;SearchBox<br/>     placeholder="Search Monster"<br/>     handleChange={(e) =&gt; this.setState({ searchField: e.target.value })}<br/>    /&gt;<br/>    &lt;CardList monsters={filteredMonster} /&gt;<br/>   &lt;/div&gt;<br/>  );<br/> }<br/>}<br/>const mapStateToProps = (state) =&gt; ({<br/> admin: state.admin,<br/>});<br/>export default connect(mapStateToProps, { MonsterListing })(App);</span></pre><p id="1550" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有，可以参考我的Github代码:<a class="ae jt" href="https://github.com/ArunKashyap199/monster-world" rel="noopener ugc nofollow" target="_blank">见完整代码</a></p><p id="60b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读，如果您有任何疑问，请告诉我。T53】</p></div></div>    
</body>
</html>