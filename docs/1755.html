<html>
<head>
<title>Redux-Saga</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">还原传奇</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/redux-saga-54d7a4489ce0?source=collection_archive---------18-----------------------#2021-04-04">https://medium.com/nerd-for-tech/redux-saga-54d7a4489ce0?source=collection_archive---------18-----------------------#2021-04-04</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="c494" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Redux-Saga 是一个中间件库，处理带有副作用的异步任务，比如 API。此外，我们能够读取状态并在 Saga 上调用操作。它使用生成器函数来完成异步任务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4e66691aa668401a60ef7d108953cb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GC9G3YWGrTD85yV5N0STg.png"/></div></div></figure><p id="67ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下概述了我们为什么使用 Saga 以及如何安装它。然后，讨论了处理 API 的有用的 Saga 方法。</p><h1 id="6101" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么我们要使用 Redux-Saga？</h1><p id="d369" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Saga 的主要职责是处理 API 调用，并根据端点的响应更新状态！redux-saga 的主要优势之一是测试友好。</p><blockquote class="ks kt ku"><p id="c85e" class="if ig kv ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">在使用 Redux-Saga 之前，你应该熟悉 Redux。</p></blockquote><p id="91c1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">阅读 Redux，点击<a class="ae kz" href="https://zaraco.medium.com/what-is-the-redux-js-b74b172423ef" rel="noopener">这里</a>。</p><h1 id="2359" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">如何安装 Redux-saga？</h1><p id="9003" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">基于您的软件包管理器，有两种安装 redux-saga 的方法:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="ce3a" class="lf jq hi lb b fi lg lh l li lj">npm install redux-saga</span></pre><p id="0a09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="f96b" class="lf jq hi lb b fi lg lh l li lj">yarn add redux-saga</span></pre><p id="f3bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，您需要创建一个示例 redux 中间件。例如:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="0646" class="lf jq hi lb b fi lg lh l li lj">import { call, put, takeEvery } from 'redux-saga/effects'<br/>import <strong class="lb hj"><em class="kv">Api</em></strong> from '...'<br/><br/>function* <strong class="lb hj">fetchUser</strong>(action) {<br/>    try {<br/>        const user = yield call(<strong class="lb hj"><em class="kv">Api</em></strong>.fetchUser, action.payload.userId);<br/>        yield put({type: "<strong class="lb hj">USER_FETCH_SUCCEEDED</strong>", user: user});<br/>    } catch (e) {<br/>        yield put({type: "<strong class="lb hj">USER_FETCH_FAILED</strong>", message: e.message});<br/>    }<br/>}<br/><br/>function* <strong class="lb hj">mySaga</strong>() {<br/>    yield takeEvery("<strong class="lb hj">USER_FETCH_REQUESTED</strong>", fetchUser);<br/>}<br/><br/>export default <strong class="lb hj">mySaga</strong>;</span></pre><p id="4bc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个例子中，当<em class="kv"> USER_FETCH_REQUESTED </em>动作被分派时，它向 API 发送一个调用请求。如果成功，它将使用用户负载调度一个类型为<em class="kv"> USER_FETCH_SUCCEEDED </em>的操作。否则，在出现错误状态的情况下，它会调度一个带有类型<em class="kv"> USER_FETCH_FAILED </em>和错误消息有效负载的操作。</p><p id="9ffa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">API 可能是这样的:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="964e" class="lf jq hi lb b fi lg lh l li lj">import axios from 'axios';<br/><br/>const <strong class="lb hj"><em class="kv">Api </em></strong>= {<br/>    fetchUser: (userId) =&gt; {<br/>        return axios.get(`...?userId=${userId}`)<br/>    }<br/>};<br/><br/>export default <strong class="lb hj"><em class="kv">Api</em></strong>;</span></pre><p id="3032" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，您需要将您的传奇故事添加到 redux 商店:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="c104" class="lf jq hi lb b fi lg lh l li lj">import { createStore, applyMiddleware } from 'redux'<br/>import createSagaMiddleware from 'redux-saga'<br/><br/>import reducer from './reducers'<br/>import mySaga from './sagas'<br/><br/><strong class="lb hj">const sagaMiddleware = createSagaMiddleware();</strong><br/><br/>const store = createStore(<br/>    reducer,<br/>    <strong class="lb hj">applyMiddleware(sagaMiddleware)</strong><br/>);<br/><br/><strong class="lb hj">sagaMiddleware.run(mySaga);</strong></span></pre><p id="03ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，saga 的中间件被创建并应用于商店，最后，它运行。</p><h1 id="1a59" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">佐贺方法</h1><p id="ca78" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">下面将解释最常用的方法:</p><h2 id="0ab0" class="lf jq hi bd jr lk ll lm jv ln lo lp jz iq lq lr kd iu ls lt kh iy lu lv kl lw bi translated">挑选</h2><p id="645b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它从选择器(state)中读取数据，下面是 select 调用的一个示例。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="d014" class="lf jq hi lb b fi lg lh l li lj">const userId = yield select(userSelectors.getUserId);</span></pre><h2 id="984a" class="lf jq hi bd jr lk ll lm jv ln lo lp jz iq lq lr kd iu ls lt kh iy lu lv kl lw bi translated">放</h2><p id="c17b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它调度操作，例如:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="947c" class="lf jq hi lb b fi lg lh l li lj">yield put({type: "USER_FETCH_SUCCEEDED", user: user});</span></pre><h2 id="b53a" class="lf jq hi bd jr lk ll lm jv ln lo lp jz iq lq lr kd iu ls lt kh iy lu lv kl lw bi translated">呼叫</h2><p id="2f3b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它调用一个异步函数，比如 API，例如:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="60ba" class="lf jq hi lb b fi lg lh l li lj">const user = yield call(<strong class="lb hj"><em class="kv">Api</em></strong>.fetchUser, action.payload.userId);</span></pre><h2 id="b1a6" class="lf jq hi bd jr lk ll lm jv ln lo lp jz iq lq lr kd iu ls lt kh iy lu lv kl lw bi translated">拿走每一个</h2><p id="2cd5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它监视每个动作调度以调用一个生成器函数。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="7937" class="lf jq hi lb b fi lg lh l li lj">yield takeEvery("<strong class="lb hj">USER_FETCH_REQUESTED</strong>", fetchUser);</span></pre><h2 id="2746" class="lf jq hi bd jr lk ll lm jv ln lo lp jz iq lq lr kd iu ls lt kh iy lu lv kl lw bi translated">获取最新信息</h2><p id="247b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">它与 takeEvery 相同，唯一的区别是，当前一个呼叫未决时，不会再次呼叫。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="a892" class="lf jq hi lb b fi lg lh l li lj">yield takeLatest("<strong class="lb hj">USER_FETCH_REQUESTED</strong>", fetchUser);</span></pre><h1 id="1d36" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="9429" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">Redux-saga 是一个在 Redux 中处理异步任务的库。在这篇文章中，讨论了为什么和如何使用 Saga 和方法。</p></div></div>    
</body>
</html>