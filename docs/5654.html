<html>
<head>
<title>Demystifying Errors in MUI Autocomplete — part — I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开 MUI 自动完成中错误的神秘面纱—第一部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/demystifying-errors-in-mui-autocomplete-part-i-e306f922a906?source=collection_archive---------0-----------------------#2021-10-28">https://medium.com/nerd-for-tech/demystifying-errors-in-mui-autocomplete-part-i-e306f922a906?source=collection_archive---------0-----------------------#2021-10-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="93f5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">自动完成是 Material UI 核心包中的新功能。</h1><p id="b688" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它是<strong class="jf hj">搜索</strong>暨<strong class="jf hj">输入</strong>组件。对于<strong class="jf hj">搜索</strong>，我们需要给出搜索选项。因此<strong class="jf hj">【选项】</strong>道具是强制的。关于<strong class="jf hj">输入</strong>字段，自动完成是一个抽象输入字段。我们需要指定需要呈现什么输入组件，在大多数情况下，应该是<strong class="jf hj"> TextField。</strong>因此'<strong class="jf hj"> renderInput' </strong>组件是必需的。</p><blockquote class="kb kc kd"><p id="48b0" class="jd je ke jf b jg kf ji jj jk kg jm jn kh ki jq jr kj kk ju jv kl km jy jz ka hb bi translated">自动完成→搜索和输入→选项和渲染输入属性</p></blockquote><p id="f8ef" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">选项属性只接受数组。我得到的几乎所有自动完成错误都是因为数据结构的不一致，我们将在后面看到。如果选项数组包含原始值，它将直接在选项列表中显示这些值。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="e6df" class="kw ig hi ks b fi kx ky l kz la">import * as React from "react";<br/>import TextField from "@mui/material/TextField";<br/>import Autocomplete from "@mui/material/Autocomplete";</span><span id="1662" class="kw ig hi ks b fi lb ky l kz la">export default function ComboBox() {</span><span id="2a5e" class="kw ig hi ks b fi lb ky l kz la">return (</span><span id="ebe4" class="kw ig hi ks b fi lb ky l kz la">&lt;Autocomplete<br/><strong class="ks hj">options</strong>={<strong class="ks hj">top100Films</strong>}<br/>sx={{ width: 300 }}<br/><strong class="ks hj">renderInput</strong>={(params) =&gt; &lt;TextField {...params} label="Movie" /&gt;}<br/>/&gt;<br/>);<br/>}</span><span id="0d35" class="kw ig hi ks b fi lb ky l kz la">const <strong class="ks hj">top100Films</strong> = [<br/><strong class="ks hj">"The Shawshank Redemption",<br/>"The Godfather",<br/>"The Godfather: Part II",<br/>"The Dark Knight",<br/>"12 Angry Men",<br/>"Schindler's List",<br/>"Pulp Fiction",<br/>"The Lord of the Rings: The Return of the King",<br/>"The Good, the Bad and the Ugly",<br/>"Fight Club",<br/>"The Lord of the Rings: The Fellowship of the Ring",<br/>"Star Wars: Episode V - The Empire Strikes Back",<br/>"Forrest Gump",<br/>"Inception",</strong><br/>];</span></pre><p id="8630" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">在上面的例子中，options prop 接受一个数组。这个数组包含电影的字符串(原始数据类型)值。</p><figure class="kn ko kp kq fd lc"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">选项道具演示</figcaption></figure><p id="a781" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">如果数组包含对象。默认情况下，它接受以下结构。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="727b" class="kw ig hi ks b fi kx ky l kz la">options = <!-- --> [<br/>  { label: 'The Shawshank Redemption', year: 1994 },<br/>  { label: 'The Godfather', year: 1972 },<br/>  { label: 'The Godfather: Part II', year: 1974 },<br/>  { label: 'The Dark Knight', year: 2008 },<br/>  { label: '12 Angry Men', year: 1957 },<br/>  { label: "Schindler's List", year: 1993 },<br/>  { label: 'Pulp Fiction', year: 1994 },<br/>]</span></pre><p id="2825" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">它会将对象中的<strong class="jf hj">标签</strong>属性显示为选项列表。然而，我们可以通过使用<strong class="jf hj"> getOptionLabel </strong> prop 来使用不同的选项结构。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="2fc6" class="kw ig hi ks b fi kx ky l kz la">options = <!-- --> [<br/>  { name:'The Shawshank Redemption', year: 1994 },<br/>  { name:'The Godfather', year: 1972 },<br/>  { name: 'The Godfather: Part II', year: 1974 },<br/>  { name: 'The Dark Knight', year: 2008 },<br/>  { name: '12 Angry Men', year: 1957 },<br/>  { name: "Schindler's List", year: 1993 },<br/>  { name: 'Pulp Fiction', year: 1994 },<br/>]</span><span id="bd64" class="kw ig hi ks b fi lb ky l kz la">&lt;Autocomplete<br/>options={top100Films}<br/><strong class="ks hj">getOptionLabel = {option =&gt; option.name}</strong><br/>sx={{ width: 300 }}<br/>renderInput={(params) =&gt; &lt;TextField {...params} label="Movie" /&gt;}<br/>/&gt;<br/>);<br/>}</span></pre><p id="1813" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj"> getOptionlabel </strong>需要一个有默认参数的函数，这个参数基本上是数组中每个对象的单独选项。</p><figure class="kn ko kp kq fd lc"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">getoptionlabel 的演示</figcaption></figure><p id="db0b" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">getOptionLabel 的一个特点是它不会改变输入值。它只是改变了我们在列表中看到的标签。输入值仍然是整个单个对象。这一事实需要铭记在心，因为知道这一点可以避免 60%的错误。</p><p id="7f03" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">Autocomplete 中的大多数 prop 都是基于与 options prop 的关系。特别是与选项的引用关系。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="2f90" class="kw ig hi ks b fi kx ky l kz la">import * as React from "react";<br/>import Box from "@mui/material/Box";<br/>import TextField from "@mui/material/TextField";<br/>import Autocomplete from "@mui/material/Autocomplete";</span><span id="1696" class="kw ig hi ks b fi lb ky l kz la">export default function CountrySelect() {</span><span id="4402" class="kw ig hi ks b fi lb ky l kz la">return (</span><span id="9e8d" class="kw ig hi ks b fi lb ky l kz la">&lt;Autocomplete<br/>id="country-select-demo"<br/>sx={{ width: 300 }}<br/><strong class="ks hj">options={countryStrings}</strong><br/>autoHighlight<br/><strong class="ks hj">value={"Andorra"}</strong><br/>renderInput={(params) =&gt; (<br/>&lt;TextField<br/>{...params}<br/>label="Choose a country"<br/>inputProps={{<br/>...params.inputProps,<br/>autoComplete: "new-password" <em class="ke">// disable autocomplete and autofill<br/></em>}}<br/>/&gt;<br/>)}<br/>/&gt;<br/>);<br/>}</span><span id="c887" class="kw ig hi ks b fi lb ky l kz la">const <strong class="ks hj">countries</strong> = [<br/>{ code: "AD", label: "Andorra", phone: "376" },<br/>{ code: "AI", label: "Anguilla", phone: "1-264" },<br/>{ code: "AL", label: "Albania", phone: "355" },<br/>{ code: "AM", label: "Armenia", phone: "374" },<br/>{ code: "AO", label: "Angola", phone: "244" },<br/>{ code: "AQ", label: "Antarctica", phone: "672" },<br/>{ code: "AR", label: "Argentina", phone: "54" },<br/>{ code: "AS", label: "American Samoa", phone: "1-684" },<br/>{ code: "AT", label: "Austria", phone: "43" }<br/>];</span><span id="5f77" class="kw ig hi ks b fi lb ky l kz la"><br/><strong class="ks hj">*-----Extracting only label from countries array----*</strong></span><span id="db59" class="kw ig hi ks b fi lb ky l kz la"><strong class="ks hj">const countryStrings = countries.map((option) =&gt; option.label);</strong></span><span id="b64a" class="kw ig hi ks b fi lb ky l kz la">console.log(<strong class="ks hj">countryStrings</strong>);<br/><em class="ke">["Andorra", "Anguilla", "Albania", "Armenia", "Angola", "Antarctica", "Argentina", "American Samoa", "Austria"]</em></span></pre><p id="9f24" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">指称关系是如何工作的？让我们在这里看一些案例。带有<strong class="jf hj">国家字符串</strong>和<strong class="jf hj">国家的选项。</strong></p><p id="8a3c" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj"> countryStrings </strong>由字符串数组组成。让我们看看会发生什么</p><p id="dd3c" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">案例一</strong>:options = {<strong class="jf hj">country strings</strong>} value = '<strong class="jf hj">安道尔</strong>'。</p><p id="4827" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">上面的例子工作正常，因为我们输入的<strong class="jf hj">值</strong>与<strong class="jf hj"> countryStrings 的值之一匹配。</strong></p><p id="a7c1" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">但是当我们稍微改变这个值时，事情就变得有趣了。</p><p id="99a5" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">案例二</strong>:options = {<strong class="jf hj">country strings</strong>} value = '<strong class="jf hj">安道尔</strong>'。</p><p id="39c0" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">上面的例子会抛出一个错误，但是文本框中显示的值会是'<strong class="jf hj">安道尔【T1]'，但是我们会在控制台中得到一个错误。</strong></p><figure class="kn ko kp kq fd lc er es paragraph-image"><div class="er es lj"><img src="../Images/144544b89ebf702a133d3382645dc945.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*YFt3Ci1NoCIFNDaSoUPbpA.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">显示的值为“安道尔”</figcaption></figure><figure class="kn ko kp kq fd lc er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/43e985f465584bc7dffd364566eaa83a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xfq6kDAiFHgQps3jC7etIQ.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">控制台出错</figcaption></figure><p id="ba61" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">出现此错误是因为'<strong class="jf hj">安道尔</strong>与<strong class="jf hj">国家字符串</strong>中的任何字符串都不匹配</p><blockquote class="kb kc kd"><p id="a122" class="jd je ke jf b jg kf ji jj jk kg jm jn kh ki jq jr kj kk ju jv kl km jy jz ka hb bi translated">所以第一条规则是值必须与任何一个选项完全匹配。从技术上讲，它必须与选项之一具有<strong class="jf hj">引用相等性</strong>。</p></blockquote><p id="e4d7" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">情况 3 </strong>:改变数据结构本身</p><p id="33c4" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj">选项</strong> = <strong class="jf hj">国家 getOptionLabel = { option =&gt;option . name }值= '安道尔'</strong></p><p id="a303" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">让我们把国家的<strong class="jf hj">标签改为<strong class="jf hj">名称</strong>财产，而不是</strong>财产。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="f9ad" class="kw ig hi ks b fi kx ky l kz la">import * as React from "react";<br/>import Box from "@mui/material/Box";<br/>import TextField from "@mui/material/TextField";<br/>import Autocomplete from "@mui/material/Autocomplete";</span><span id="a3ee" class="kw ig hi ks b fi lb ky l kz la">export default function CountrySelect() {<br/>return (<br/>&lt;Autocomplete<br/>id="country-select-demo"<br/>sx={{ width: 300 }}<br/><strong class="ks hj">options={countries}</strong><br/><em class="ke">// value={"Andorra"}<br/></em>renderInput={(params) =&gt; (<br/>    &lt;TextField {...params}<br/>      label="Choose a country"<br/>}}<br/>/&gt;<br/>)}<br/>/&gt;<br/>);<br/>}</span><span id="9eb7" class="kw ig hi ks b fi lb ky l kz la">const <strong class="ks hj">countries</strong> = [<br/>{ code: "AD", <strong class="ks hj">name</strong>: "Andorra", phone: "376" },<br/>{ code: "AI", <strong class="ks hj">name</strong>: "Anguilla", phone: "1-264" },<br/>{ code: "AL", <strong class="ks hj">name</strong>: "Albania", phone: "355" },<br/>{ code: "AM", <strong class="ks hj">name</strong>: "Armenia", phone: "374" },<br/>{ code: "AO", <strong class="ks hj">name</strong>: "Angola", phone: "244" },<br/>{ code: "AQ", <strong class="ks hj">name</strong>: "Antarctica", phone: "672" },<br/>{ code: "AR", <strong class="ks hj">name</strong>: "Argentina", phone: "54" },<br/>{ code: "AS", <strong class="ks hj">name</strong>: "American Samoa", phone: "1-684" },<br/>{ code: "AT", <strong class="ks hj">name</strong>: "Austria", phone: "43" }<br/>];<br/></span></pre><p id="ac53" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">如果没有<strong class="jf hj"> getOptionLabel 和 label </strong>属性，我们会得到一个错误</p><figure class="kn ko kp kq fd lc er es paragraph-image"><div class="er es lr"><img src="../Images/ca46ad2d6d2c1856b10d372cc94dac81.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*fLr7sbT3HD72ljedJ_qf8A.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">props 中没有标签属性时出错</figcaption></figure><p id="b56e" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">注意<strong class="jf hj"> getOptionLabel </strong>被调用，即使我们在 props 中添加了它。这是因为获取'<strong class="jf hj">标签</strong>'属性的默认行为。</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="c7dd" class="kw ig hi ks b fi kx ky l kz la">&lt;Autocomplete<br/>id="country-select-demo"<br/>sx={{ width: 300 }}<br/><strong class="ks hj">options={countries}<br/>getOptionLabel={(option) =&gt; option.name}</strong><br/><em class="ke">//value={"Andorra"}<br/></em>renderInput={(params) =&gt; (<br/>    &lt;TextField {...params}<br/>      label="Choose a country"<br/>}}<br/>/&gt;<br/>)}<br/>/&gt;</span></pre><p id="72ad" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">现在我们没有得到任何错误，因为我们明确提到通过<strong class="jf hj">getOptionLabel = {(option)=&gt;option . name }</strong>从<strong class="jf hj"> name </strong>属性中获取<strong class="jf hj">标签</strong></p><p id="01c9" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">让我们增加道具的价值</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="d7b1" class="kw ig hi ks b fi kx ky l kz la">&lt;Autocomplete<br/>id="country-select-demo"<br/>sx={{ width: 300 }}<br/><strong class="ks hj">options={countries}<br/>getOptionLabel={(option) =&gt; option.name}</strong><br/><strong class="ks hj"><em class="ke">value={"Andorra"}</em></strong><em class="ke"><br/></em>renderInput={(params) =&gt; (<br/>    &lt;TextField {...params}<br/>      label="Choose a country"<br/>}}<br/>/&gt;<br/>)}<br/>/&gt;</span></pre><figure class="kn ko kp kq fd lc er es paragraph-image"><div class="er es ls"><img src="../Images/33af736189f2ba1ee8e2001e9d3e1c9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*tst6YaA15Lb3h92nNNxngg.png"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">给定值= '安道尔'时出错</figcaption></figure><p id="4495" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">这里我们会得到一个类似上面的错误。这是棘手的部分。见流程是</p><p id="190f" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">给 props 的值是'<strong class="jf hj">字符串</strong>，但是每个单独的选项是一个'<strong class="jf hj">对象</strong>。这里的<strong class="jf hj">值</strong>是硬编码的，因此它试图直接放入 DOM。既然我们提到<strong class="jf hj"> getOptionLabel </strong>，那就要经过这一步。<strong class="jf hj"> getOptionLabel </strong>需要一个对象，但提供的值是<strong class="jf hj">“字符串”。</strong>这实际上导致了一个错误。</p><p id="5163" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated"><strong class="jf hj"><em class="ke">MUI:Autocomplete 的“getOptionLabel”方法返回 undefined，而不是“Andorra”的字符串。</em>T45】</strong></p><blockquote class="kb kc kd"><p id="e58b" class="jd je ke jf b jg kf ji jj jk kg jm jn kh ki jq jr kj kk ju jv kl km jy jz ka hb bi translated">所以第二条规则很简单——只要在道具之间保持相同的数据结构。</p></blockquote><p id="a02b" class="pw-post-body-paragraph jd je hi jf b jg kf ji jj jk kg jm jn jo ki jq jr js kk ju jv jw km jy jz ka hb bi translated">所以正确的方法应该是</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="1190" class="kw ig hi ks b fi kx ky l kz la">&lt;Autocomplete<br/>id="country-select-demo"<br/>sx={{ width: 300 }}<br/><strong class="ks hj">options={countries}<br/>getOptionLabel={(option) =&gt; option.name}</strong><br/><strong class="ks hj"><em class="ke">value={countries[0]}</em></strong><em class="ke"><br/></em>renderInput={(params) =&gt; (<br/>    &lt;TextField {...params}<br/>      label="Choose a country"<br/>}}<br/>/&gt;<br/>)}<br/>/&gt;</span></pre><figure class="kn ko kp kq fd lc"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="lf lg et er es lh li bd b be z dx translated">当值满足相同数据结构的标准时</figcaption></figure><figure class="kn ko kp kq fd lc er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lt"><img src="../Images/7024509f3b7acdb6b5b9f01c09c7a32d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6INKkUAMwj-KJR0YrIkaiw.png"/></div></div><figcaption class="lf lg et er es lh li bd b be z dx translated">使用 canva 的插图</figcaption></figure></div></div>    
</body>
</html>