<html>
<head>
<title>Automatically create releases using GitHub Actions and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub动作和Python自动创建发布</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/automatically-create-releases-using-github-actions-and-python-af8fc434a4aa?source=collection_archive---------2-----------------------#2020-08-18">https://medium.com/nerd-for-tech/automatically-create-releases-using-github-actions-and-python-af8fc434a4aa?source=collection_archive---------2-----------------------#2020-08-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d65d51f084ab9bb309b4be99043cba56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*x9Qj4yp4qAVQIJ1B"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://unsplash.com/@franckinjapan?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Franck V. </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="029b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">执行重复的任务既费时又乏味。幸运的是，我们有工具可以用来为我们做重复性的工作并节省时间。最近，我决定在我的一个库中自动化发布过程。在本文中，我将分享我使用<a class="ae iu" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub Actions </a>和<a class="ae iu" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>自动化发布过程的旅程。</p><h1 id="c354" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">问题是</h1><p id="0520" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我维护一个依赖于新发布的<code class="du kw kx ky kz b">Detekt CLI</code>的<a class="ae iu" href="https://github.com/natiginfo/action-detekt-all" rel="noopener ugc nofollow" target="_blank">库</a>。当有了新版本的<code class="du kw kx ky kz b">Detekt CLI</code>时，只要我有空，我就会收到电子邮件并发布我的库。使用这种方法，我通常按照下面的步骤来发布新的版本:</p><ol class=""><li id="7ca3" class="la lb hi ix b iy iz jc jd jg lc jk ld jo le js lf lg lh li bi translated">收到一封关于Detekt新版本的电子邮件。</li><li id="2d2a" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">一有空就在<code class="du kw kx ky kz b">Dockerfile</code>和<code class="du kw kx ky kz b">README.md</code>更新版本。</li><li id="a0ff" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">提交更改。</li><li id="af66" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">创建新标签。</li><li id="1589" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">推动变革。</li><li id="e3c6" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lf lg lh li bi translated">发布新闻稿。</li></ol><p id="a4e4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然新版本的发布时间很关键，但很明显，从<strong class="ix hj">第一步</strong>到<strong class="ix hj">第二步</strong>的时间差会根据我的情况而变化，这可能会让用户不高兴。除了发布新版本的时间和让我的库的用户高兴之外，个人时间也很重要，可以花在更令人兴奋的事情上，而不仅仅是手工做一些可以自动化的工作。</p><h1 id="e864" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">解决办法</h1><p id="6c97" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">因为我们知道问题所在，并且我们已经写下了步骤，所以我们可以想出解决这个问题的方法。我想制作的解决方案需要以下特性:</p><ul class=""><li id="d5be" class="la lb hi ix b iy iz jc jd jg lc jk ld jo le js lo lg lh li bi translated">每24小时检查一次<code class="du kw kx ky kz b">Detekt CLI</code>的新版本。</li><li id="6b2c" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated">如果<code class="du kw kx ky kz b">Detekt CLI</code>的最新版本与我的存储库的最新标签不同，请更新<code class="du kw kx ky kz b">Dockerfile</code>和<code class="du kw kx ky kz b">README.md</code>中的<code class="du kw kx ky kz b">Detekt CLI</code>版本</li><li id="b9bd" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated">提交更改</li><li id="66a0" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated">创建新标签</li><li id="735c" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated"><em class="lp">创建一个发布分支</em></li><li id="142a" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated">推动变革</li><li id="b009" class="la lb hi ix b iy lj jc lk jg ll jk lm jo ln js lo lg lh li bi translated">当创建新的发布分支时，创建一个新的拉请求。</li></ul><p id="d1fa" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个新的发布分支和一个新的拉请求是我过去手工发布时没有做过的事情。我添加了前面提到的步骤，以确保我可以审查变更，从而不会将损坏的代码合并到主分支中。为了检查新的发布并运行<a class="ae iu" href="https://github.com/natiginfo/action-detekt-all/tree/master/.release-manager" rel="noopener ugc nofollow" target="_blank">我的Python脚本</a>，我创建了两个工作流，其中<a class="ae iu" href="https://github.com/natiginfo/action-detekt-all/blob/master/.github/workflows/create_new_release.yml" rel="noopener ugc nofollow" target="_blank">第一个工作流</a>每24小时运行一次脚本，而<a class="ae iu" href="https://github.com/natiginfo/action-detekt-all/blob/master/.github/workflows/create_release_pr.yml" rel="noopener ugc nofollow" target="_blank">第二个工作流</a>在创建新的发布分支时创建一个拉请求。除了每24小时运行一次发布脚本的工作流，我注意到GitHub actions中的<code class="du kw kx ky kz b">workflow_dispatch</code>触发器可以用于手动运行工作流。</p><p id="bd24" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据<code class="du kw kx ky kz b">Detekt</code>的发布历史，每个月大概有两到三个新发布。通过使用GitHub Actions和Python创建的简单解决方案，我的目标是每月至少节省20到30分钟。此外，我可以在其他项目中使用该解决方案，从而节省大量时间。</p><h1 id="926b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最后的话</h1><p id="e466" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">本文的目的是鼓励您通过自动化任务来利用现有工具并节省时间。正如您所看到的，一旦您写下步骤，使用您所使用的工具实现自动化就很容易了。</p><p id="834b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我希望你喜欢这篇文章。</p><blockquote class="lq lr ls"><p id="be2a" class="iv iw lp ix b iy iz ja jb jc jd je jf lt jh ji jj lu jl jm jn lv jp jq jr js hb bi translated">这最初发布在<a class="ae iu" href="https://www.natigbabayev.com/2020-08-18/automating-the-release-process-using-github-actions-and-python" rel="noopener ugc nofollow" target="_blank">natigbabayev.com</a></p></blockquote></div></div>    
</body>
</html>