<html>
<head>
<title>How to create a Geospatial Contained Environment with Docker Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Docker Compose创建包含地理空间的环境</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/docker-compose-with-nodejs-express-and-postgresql-384c59d6871a?source=collection_archive---------2-----------------------#2021-01-24">https://medium.com/nerd-for-tech/docker-compose-with-nodejs-express-and-postgresql-384c59d6871a?source=collection_archive---------2-----------------------#2021-01-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/b3ba71c6da26dd9eb2220cecf31fbfbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K0WRGy55mni5cmbF"/></div></div><figcaption class="iy iz et er es ja jb bd b be z dx translated">照片由<a class="ae jc" href="https://unsplash.com/@viniciusamano?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">vini cius“amnx”Amano</a>在<a class="ae jc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><blockquote class="jd je jf"><p id="4ef1" class="jg jh ji jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">在本教程中，我们将探索如何在Docker的帮助下创建一个可以在任何操作系统上工作的封闭环境。</p></blockquote><p id="a166" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">Docker是一个包含的环境，它使得一个应用程序可以在不同的操作系统上运行。它有多种优势，比如通过使用容器消除管理版本冲突或服务器配置的痛苦。</p><p id="a56b" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">有了容器，应用程序是可移植的，可以很容易地从一个操作系统转移到另一个操作系统，因为其中有所有必要的依赖和配置。不用说，它让应用程序的部署变得轻而易举💨。</p><blockquote class="ki"><p id="e626" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">在开始之前，我们必须了解Docker图像和Docker容器之间的区别。例如，Docker映像是包含配置和脚本的包。另一方面，Docker容器是您的映像的运行环境。</p></blockquote><p id="8ab2" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">在本教程中，我们将使用<strong class="jj hj"> Docker Compose </strong>，这是一种通过在单个配置文件中定义所有服务来运行多个容器的方法。</p><p id="e61d" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">我们首先在与主js文件相同的目录中创建一个Dockerfile，以便能够启动包含所有必需包的Nodejs映像:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="3f02" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">我们首先定义我们想要的Nodejs版本。您可以在此处查看所有可用版本:</p><div class="kz la ez fb lb lc"><a href="https://hub.docker.com/_/node" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">节点对接集线器</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">Node.js是一个基于JavaScript的服务器端和网络应用程序平台。</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">hub.docker.com</p></div></div></div></a></div><p id="0186" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">工作目录是节点应用程序的工作目录。然后我们添加copy以将package.json文件添加到映像中，然后我们运行npm install。副本。。命令将所有内容复制到当前文件夹。最后，npm start是启动应用程序的命令。</p><p id="d18e" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">下一步是在docker-compose.yml中定义我们所有的图像，我们在主目录中创建它:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="02ec" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">如您所见，我们有两个服务，分别是Nodejs应用程序(<strong class="jj hj">节点</strong>)和postgreSQL服务(<strong class="jj hj">postgreSQL</strong>)。然后，我们可以定义容器的名称(这是可选的。)postgreSQL的图像是<strong class="jj hj"> postgis/postgis </strong>因为我们将使用地理数据填充数据库。你可以在这里阅读更多关于这张图片的细节:</p><div class="kz la ez fb lb lc"><a href="https://registry.hub.docker.com/r/postgis/postgis" rel="noopener  ugc nofollow" target="_blank"><div class="ld ab dw"><div class="le ab lf cl cj lg"><h2 class="bd hj fi z dy lh ea eb li ed ef hh bi translated">码头枢纽</h2><div class="lj l"><h3 class="bd b fi z dy lh ea eb li ed ef dx translated">编辑描述</h3></div><div class="lk l"><p class="bd b fp z dy lh ea eb li ed ef dx translated">registry.hub.docker.com</p></div></div></div></a></div><p id="42f8" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">build命令允许我们基于Dockerfile文件构建Nodejs映像。卷是容器的路径。</p><p id="a2cf" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">如您所见，我们在每个服务中定义了两个端口。右边是容器的端口，左边是可从本地主机访问的端口。</p><p id="5546" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">因为我们希望即使容器停止，数据库中创建的数据也是持久的，所以我们在服务<strong class="jj hj">PostgreSQL</strong>中创建一个卷，并在末尾添加另一个同名的卷(<strong class="jj hj"> db_persdata </strong>)。</p><p id="878c" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">下一步是创建一个简单的Nodejs/Express应用程序，它使用PostgreSQL来公开地理数据。这是它的样子:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="a26c" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">所以这里没什么特别的。如您所见，我们使用pg包来连接数据库，我们使用端口5432，因为我们在网络内部，主机是服务的名称。现在我们的main.js文件已经创建，让我们通过运行以下命令来启动容器:</p><blockquote class="ki"><p id="56f3" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">docker-撰写向上-d</p></blockquote><p id="4162" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">这个命令将启动我们的容器。d是可选的，它告诉Docker在终端的后台运行容器。要测试容器是否启动并运行，请使用以下命令显示所有正在运行的容器:</p><blockquote class="ki"><p id="da6c" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">docker ps</p></blockquote><p id="fa90" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">你可以在这个命令中添加<em class="ji"> </em> <strong class="jj hj"> -a </strong>来查看所有的容器是否正在运行。</p><blockquote class="jd je jf"><p id="0b5b" class="jg jh ji jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">此时，您应该在终端Docker的names列中看到您的容器名<strong class="jj hj"> nodejspost </strong>和<strong class="jj hj"> postgresqlpostgis </strong>。</p></blockquote><p id="9117" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">在我们打开端口3150上的本地主机之前，我们必须添加一些数据，以便能够在浏览器窗口中显示它。当我们想要向数据库添加数据时，我们必须进入postgresqlpostgis容器内部，该容器包含一个带有postgis扩展的PostgreSQL数据库。要进入容器内部，请运行以下命令:</p><blockquote class="ki"><p id="14ed" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">docker exec-it postgresqlpostgis bash</p></blockquote><p id="a502" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">如你所见，我们在其后使用容器的名称。现在，我们将使用psql命令在数据库bdtuto中创建表，该表是我们在yml文件中使用用户名(postgres)定义的:</p><blockquote class="ki"><p id="6b16" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">psql -U postgres</p></blockquote><p id="5f47" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">我们用这个命令进入我们的数据库:</p><blockquote class="ki"><p id="e67e" class="kj kk hi bd kl km kn ko kp kq kr ke dx translated">\c bdtuto</p></blockquote><p id="2796" class="pw-post-body-paragraph jg jh hi jj b jk ks jm jn jo kt jq jr kf ku ju jv kg kv jy jz kh kw kc kd ke hb bi translated">现在我们可以创建表dockerpoint:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="8013" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">我们现在可以将一些数据插入表dockerpoint:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="1e15" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">然后，您所要做的就是按照。yml文件，并像这样在json中可视化您的数据:</p><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es ll"><img src="../Images/98cd4a5b28729fc0499004ad1c16750b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eUWGruzejqxM0C-z8rTmjg.png"/></div></div></figure><p id="ee43" class="pw-post-body-paragraph jg jh hi jj b jk jl jm jn jo jp jq jr kf jt ju jv kg jx jy jz kh kb kc kd ke hb bi translated">如果你做到了这一步，恭喜你🎉。这就是本教程，我希望你喜欢它。当然，如果你有任何问题，我会很乐意回答。最后，我希望这篇教程至少能帮助你学到一两件事😃。</p></div></div>    
</body>
</html>