<html>
<head>
<title>Explained: Load Balancer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解释:负载平衡器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/explained-load-balancer-89edc6d1f444?source=collection_archive---------0-----------------------#2020-11-18">https://medium.com/nerd-for-tech/explained-load-balancer-89edc6d1f444?source=collection_archive---------0-----------------------#2020-11-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="48bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，什么是负载平衡器呢？它在哪里使用？？让我们在下面找到答案</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/94575659ad7b824d2052cfefcef6af4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVkmwhmlKzLWvCrF_3_otQ.png"/></div></div></figure><p id="cafa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，负载平衡器这个术语来源于20世纪90年代末，当时技术公司无法在单台大型计算机上处理大量流量，而且他们确实没有预算来购买新的计算机。</p><blockquote class="jp jq jr"><p id="d468" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">"要发明，你需要一个好的想象力和一堆垃圾."—托马斯·阿尔瓦·爱迪生</p></blockquote><p id="02d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">爱迪生的名言非常适合20世纪90年代末的情况，然后他们出现了术语负载平衡器，负载平衡器是一种充当反向代理的设备，它通过网络或应用程序流量在服务器之间进行分配。就像下图一样。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/98f9bdeffe3173e1743db5a8e078657b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DfpfFpWlQv278aKwOJehVA.png"/></div></div></figure><blockquote class="jp jq jr"><p id="344c" class="if ig js ih b ii ij ik il im in io ip jt ir is it ju iv iw ix jv iz ja jb jc hb bi translated">反向代理是一种代理服务器，代表客户机从一个或多个服务器检索资源。代理是互联网和用户之间的媒介或网关。</p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jx"><img src="../Images/46a90ebd0fdc17cf10b5dd1d84ef33c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*VwDWvuBCa-Bp8nQnFztZjA.png"/></div></figure><h1 id="b085" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">那么，负载平衡实际上做什么呢？？</h1><p id="4efc" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">用更专业的语言来说，<a class="ae lb" href="https://www.nginx.com/solutions/adc" rel="noopener ugc nofollow" target="_blank">负载平衡器</a>充当位于您的服务器前面的“交通警察”,在所有能够满足这些请求的服务器之间路由客户端请求，从而最大限度地提高速度和容量利用率，并确保没有一台服务器超负荷工作，从而降低性能。如果一台服务器出现故障，负载平衡器会将流量重定向到其余的在线服务器。当一个新的服务器被添加到服务器组时，负载平衡器自动开始向它发送请求。</p><p id="793b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">要点</strong> :-</p><ul class=""><li id="e3a0" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated">跨多台服务器高效地分配客户端请求或网络负载</li><li id="3f66" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">通过仅向在线服务器发送请求，确保高可用性和可靠性</li><li id="2c6c" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">提供根据需求增加或减少服务器的灵活性</li></ul><p id="bd8a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如今，负载均衡器在每个大型可扩展的分布式系统中都是必不可少的，从每个视频流平台到电子商务平台，你都会在它们的系统设计中看到负载均衡器。例如，脸书，亚马逊，Airbnb，网飞，Youtube，谷歌等。负载平衡现在是系统设计的一个关键部分，现在你应该知道它是如何工作或运行的。</p><h1 id="3359" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">硬件与软件负载平衡</h1><p id="f0d2" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">负载平衡器通常有两种类型:基于硬件的和基于软件的。基于硬件的解决方案的供应商将专有软件加载到他们提供的机器上，这些机器通常使用专门的处理器。为了应对网站流量的增加，你必须从供应商那里购买更多或更大的机器。软件解决方案通常运行在商用硬件上，使它们更便宜、更灵活。您可以将软件安装在自己选择的硬件上，或者安装在AWS EC2这样的云环境中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lq"><img src="../Images/a10aa0b792ef107a7cd5c43e93440d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*CTnl6UcX18sxy6b5lSEaXA.jpeg"/></div></figure><h1 id="687a" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">负载平衡算法</h1><p id="73a9" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">不同的负载平衡算法提供不同的好处；负载平衡方法的选择取决于您的需求:</p><ul class=""><li id="5f92" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lh li lj lk bi translated"><strong class="ih hj">循环调度</strong> —请求按顺序分布在服务器组中。</li><li id="6cef" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">最少连接</strong> —新请求被发送到当前与客户端连接最少的服务器。每台服务器的相对计算能力是决定哪台服务器连接最少的因素。</li><li id="5ef4" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">最短时间</strong> —向由公式选择的服务器发送请求，该公式结合了<br/>最快的响应时间和最少的活动连接。NGINX Plus专属。</li><li id="4031" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj"> Hash </strong> —基于您定义的密钥分发请求，例如客户端IP地址或<br/>请求URL。NGINX Plus可以有选择地应用一致的散列来最小化负载的重新分配<br/>,如果上游服务器组改变的话。</li><li id="e606" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj"> IP哈希</strong> —客户端的IP地址用于确定哪个服务器接收请求。</li><li id="514a" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated"><strong class="ih hj">随机选择两个选项</strong> —随机挑选两个服务器，然后将请求发送到<br/>通过应用最少连接算法(或者对于NGINX加<br/>最少时间算法，如果这样配置的话)选择的服务器。</li></ul><p id="b985" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最常用的是一致散列法，</p><h1 id="632d" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">一致散列法</h1><h1 id="fa96" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">哈希函数和模数(%)</h1><p id="6a30" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">将具有唯一标识符(例如IP地址)的所有传入请求被假定为均匀随机的。</p><p id="1d94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用散列函数，我们能够获得一个输出值，之后我们应用模函数来获得对应于负载平衡器应该将请求定向到的服务器的数字。</p><ol class=""><li id="3835" class="lc ld hi ih b ii ij im in iq le iu lf iy lg jc lr li lj lk bi translated">哈希(IP地址)→输出</li><li id="8815" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lr li lj lk bi translated">服务器数量的输出百分比-1 →服务器ID</li></ol><p id="b47b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用良好的哈希函数来确保输出值分布在一个值范围内以提高随机性是很重要的。然后，模函数保证服务器ID在0的范围内。(服务器数量-1。)</p><h1 id="0a27" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">可视化映射</h1><p id="acdb" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">让我们后退一步，想象一下如何使用数组作为数据结构将每个请求映射到服务器。</p><p id="08da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下面这个简单的例子中，数组的索引直接映射到服务器ID，但是在生产环境中不一定是这样。因此，利用像数组这样的数据结构可以让我们更灵活地将输出映射到我们喜欢的服务器。</p><p id="b892" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方案是使用一致的散列法。让我们先试着用三个步骤来形象化这个概念。</p><h1 id="9619" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤1:将请求映射到环上的一个位置</h1><p id="7f60" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">现在，让我们想象一个圆形数组，而不是一个规则的数组。类似于数组，每个请求现在都映射到散列环上的一个位置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/dbe945a8f33c7737978f7f7da58f2b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*8sSS3iA9Z-ETHJf5"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/2e5ec32dd406756fdb0da5fb12767f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SknxWpERa4UgX_yX.png"/></div></div></figure><p id="e94a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个哈希环，其中每个客户端请求映射到一个索引</p><h1 id="cae0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">步骤2:将服务器映射到环上的某个位置</h1><p id="3f0b" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">因为每个服务器都有一个ID，所以我们可以将应用于IP地址的相同散列和模函数应用于服务器ID。让我们假设所选择的散列函数是最优的，并且我们在IP地址和服务器ID之间没有冲突。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/6909eb189be4a340fab878250333b2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*Ov7YUrNAuHOZr5iy"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/b23436f05c98f985f6e383ec430a4421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iOe6yyrEhUehKd_b.png"/></div></div></figure><p id="84ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">某些索引现在被映射到服务器</p><h1 id="95d6" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">第三步:顺时针移动</h1><p id="b3d8" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">既然我们已经将请求和服务器映射到一个环上，那么最后一步就很简单了。</p><p id="aae5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于每个请求，我们只需以顺时针方式找到其右侧最近的服务器。例如，映射到索引7的传入请求由映射到索引9的服务器提供服务。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/55f984e6ce80879f095d31dc1fb4f6db.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*6O_r5Evx67pyNGln"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lv"><img src="../Images/74d2573819d72d74dbdef006928f4de0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1ACLLtKCGH7sbssf.png"/></div></div></figure></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><h1 id="2dcf" class="jy jz hi bd ka kb md kd ke kf me kh ki kj mf kl km kn mg kp kq kr mh kt ku kv bi translated">一致哈希如何最大限度地减少对其他服务器的影响？</h1><p id="0afe" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq ky is it iu kz iw ix iy la ja jb jc hb bi translated">由于请求由最右边的服务器提供服务，因此服务器数量的变化最多会影响一个其他服务器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/eb1d27c21c887bfae934b2d8c2279c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*8kyp38dmyftnj_jE"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mi"><img src="../Images/21722ad2be8c1b0eaa7ac8d89f2bcd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fACERebtnOPXUqs-.png"/></div></div></figure><p id="492a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的示例中，添加了一个新服务器，它映射到索引95。映射到索引88的请求现在由映射到索引95的新服务器提供服务，而不是以前映射到索引99的服务器。</p><p id="52ed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，只有映射到索引99的服务器需要使其缓存无效。同样，如果一台服务器被移除，下一台服务器的邻居将接管负载，而其他服务器不会受到影响。</p><p id="cec4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在寻找最近的邻居时，一致散列的概念避免了强加在其他服务器上的改变的昂贵成本，并且将成本降低到常数。</p><h1 id="c8ad" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">负载平衡的优势</h1><ul class=""><li id="a25e" class="lc ld hi ih b ii kw im kx iq mj iu mk iy ml jc lh li lj lk bi translated">减少停机时间</li><li id="b6cf" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">可攀登的</li><li id="451e" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">裁员</li><li id="76ec" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">灵活性</li><li id="d9be" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">效率</li><li id="184a" class="lc ld hi ih b ii ll im lm iq ln iu lo iy lp jc lh li lj lk bi translated">全局服务器负载平衡</li></ul><h1 id="d7e0" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">进一步阅读</h1><div class="mm mn ez fb mo mp"><a href="https://www.nginx.com/resources/glossary/load-balancing/" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">什么是负载平衡？负载平衡器如何工作</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">负载平衡指的是在一组后端服务器之间有效地分配传入的网络流量，也…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">www.nginx.com</p></div></div><div class="my l"><div class="mz l na nb nc my nd jn mp"/></div></div></a></div><p id="7d99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gaurav Sen关于负载平衡和一致性哈希的视频，以便更好地理解</p><p id="d267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">负载平衡器</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="1f8b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一致散列法</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ne nf l"/></div></figure><p id="602e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你喜欢我的文章，我试图用最简单的方式解释负载平衡和一致性散列。为了解释软件开发中的系统设计，我开始了名为“解释:系统设计”的系列文章。这是第二集，第一集在<a class="ae lb" rel="noopener" href="/nerd-for-tech/explained-database-sharding-442b72eb28ed">https://medium . com/nerd-for-tech/explained-database-sharding-442 b 72 EB 28 ed</a></p><p id="a42d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于那些不知道的人。</p><h2 id="a927" class="ng jz hi bd ka nh ni nj ke nk nl nm ki iq nn no km iu np nq kq iy nr ns ku nt bi translated">希望大家喜欢，分享一下。请在社交媒体平台上为我展示你的支持。这有助于我保持斗志。</h2><div class="mm mn ez fb mo mp"><a href="https://www.linkedin.com/in/sparsh-gupta-b80b5a169/" rel="noopener  ugc nofollow" target="_blank"><div class="mq ab dw"><div class="mr ab ms cl cj mt"><h2 class="bd hj fi z dy mu ea eb mv ed ef hh bi translated">Sparsh Gupta -技术作家-技术书呆子| LinkedIn</h2><div class="mw l"><h3 class="bd b fi z dy mu ea eb mv ed ef dx translated">查看Sparsh Gupta在世界上最大的职业社区LinkedIn上的个人资料。Sparsh有4个工作列在他们的…</h3></div><div class="mx l"><p class="bd b fp z dy mu ea eb mv ed ef dx translated">www.linkedin.com</p></div></div><div class="my l"><div class="nu l na nb nc my nd jn mp"/></div></div></a></div><p id="8888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于insta gram:【https://www.instagram.com/sparsh.gupta06/】T2</p><p id="f257" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">推特:https://twitter.com/Sparsh94749562<a class="ae lb" href="https://twitter.com/Sparsh94749562" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>