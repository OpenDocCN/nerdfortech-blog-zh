<html>
<head>
<title>How to build a Microsoft Teams Chatbot with Sharepoint, QnA Maker, and Logic Apps — Part I</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 Sharepoint、QnA Maker 和 Logic Apps 构建微软团队聊天机器人—第一部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-build-a-microsoft-teams-chatbot-with-sharepoint-qna-maker-and-logic-apps-part-i-7ecf594cf718?source=collection_archive---------0-----------------------#2020-08-05">https://medium.com/nerd-for-tech/how-to-build-a-microsoft-teams-chatbot-with-sharepoint-qna-maker-and-logic-apps-part-i-7ecf594cf718?source=collection_archive---------0-----------------------#2020-08-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="8811" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">一个聊天机器人，当被询问有关 SharePoint 网站中的文件时，它返回文件信息。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/7284d25b95a66f6f5f0fce4334d3bc1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NrVm-tSLRJQ-IYTl"/></div></div></figure><h1 id="515c" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第 1 部分:从 Sharepoint 网站获取嵌套文件夹路径和详细信息</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kb"><img src="../Images/e3b609aa5e55780e8c2058252cedbaa1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1292/format:webp/1*XG9M6WNIrBeS7rCYTy7B0A.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">逻辑应用流程</figcaption></figure><h2 id="31d9" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">Powershell 操作手册代码</h2><p id="39ed" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">此脚本扫描 SharePoint 文件夹及其子文件夹，并返回信息。</p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="4217" class="kg jk hi lr b fi lv lw l lx ly">#Connect to SPO<br/>$sitename = "<a class="ae lz" href="https://kuharan.sharepoint.com/sites/NewSite/" rel="noopener ugc nofollow" target="_blank">https://xxxx.sharepoint.com/sites/xxxx/</a>"<br/>$username = "<a class="ae lz" href="mailto:kuharan@kuharan.onmicrosoft.com" rel="noopener ugc nofollow" target="_blank">xxxx@xxxx.onmicrosoft.com</a>"<br/>$password = "xxxx"<br/>$encpassword = convertto-securestring -String $password -AsPlainText -Force<br/>$cred = new-object -typename System.Management.Automation.PSCredential -argumentlist $username, $encpassword<br/>Connect-PnPOnline -Url $sitename -Credential $cred </span><span id="d920" class="kg jk hi lr b fi ma lw l lx ly">#Target multiple lists <br/>$allLists = Get-PnPList | Where-Object {$_.BaseTemplate -eq 101}</span><span id="e7ed" class="kg jk hi lr b fi ma lw l lx ly">#Store the results<br/>$results = @()<br/>foreach ($row in $allLists) {<br/>    $allItems = Get-PnPListItem -List $row.Title -Fields "FileLeafRef"<br/>    <br/>    foreach ($item in $allItems) {<br/>            $results += New-Object psobject -Property @{<br/>                FullName            = $item["FileLeafRef"]<br/>                FullPath            = "<a class="ae lz" href="https://kuharan.sharepoint.com" rel="noopener ugc nofollow" target="_blank">https://xxxx.sharepoint.com</a>"+$item["FileRef"].replace(" ","%20")<br/>            }<br/>    }<br/>}</span><span id="a5df" class="kg jk hi lr b fi ma lw l lx ly">#Export the results<br/>$results | ConvertTo-Json</span></pre><h2 id="85da" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">您也可以尝试其他领域:</h2><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="8684" class="kg jk hi lr b fi lv lw l lx ly">$allItems = Get-PnPListItem -List $row.Title -Fields "FileLeafRef", "SMTotalFileStreamSize", "FileDirRef", "FolderChildCount", "ItemChildCount"<br/>    <br/>    foreach ($item in $allItems) {<br/>            $results += New-Object psobject -Property @{<br/>                FileType          = $item.FileSystemObjectType <br/>                RootFolder        = $item["FileDirRef"] <br/>                LibraryName       = $row.Title<br/>                FullName            = $item["FileLeafRef"]<br/>                FullPath            = "<a class="ae lz" href="https://kuharan.sharepoint.com" rel="noopener ugc nofollow" target="_blank">https://xxxx.sharepoint.com</a>"+$item["FileRef"].replace(" ","%20")<br/>                FolderSizeInMB    = ($item["SMTotalFileStreamSize"] / 1MB).ToString("N")<br/>                NbOfNestedFolders = $item["FolderChildCount"]<br/>                NbOfFiles         = $item["ItemChildCount"]<br/>            }<br/>    }</span></pre><p id="2bcd" class="pw-post-body-paragraph kx ky hi kz b la mb ij lc ld mc im lf kn md lh li kq me lk ll kt mf ln lo lp hb bi translated">为了运行这个 PowerShell 脚本，我必须在 automation 帐户中安装这两个模块。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mg"><img src="../Images/26bd4f66276186558c425827567e9b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2wMVlaWiqkGHKTIgKuBYQ.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mh"><img src="../Images/efa739eae36aa1abd9bc67f896d82297.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*OON4CLgZ13Dlipc_OtMdug.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">创造一份工作</figcaption></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mi"><img src="../Images/4e98e535f02eee3d75cb310869962208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*5pUj0kkouD5At8-xnoXg8A.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">获取作业输出</figcaption></figure><h2 id="0c91" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">解析 JSON</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mj"><img src="../Images/061a43bf741e9c30abbc3edb588fd0fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*9EVcPm4CwVQ9vFjL36G8Wg.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">解析 JSON</figcaption></figure><p id="8a6a" class="pw-post-body-paragraph kx ky hi kz b la mb ij lc ld mc im lf kn md lh li kq me lk ll kt mf ln lo lp hb bi translated">下面是活动的输入模式</p><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="b63e" class="kg jk hi lr b fi lv lw l lx ly">{<br/>    "items": {<br/>        "properties": {<br/>            "FullName": {<br/>                "type": "string"<br/>            },<br/>            "FullPath": {<br/>                "type": "string"<br/>            }<br/>        },<br/>        "required": [<br/>            "FullName",<br/>            "FullPath"<br/>        ],<br/>        "type": "object"<br/>    },<br/>    "type": "array"<br/>}</span></pre><h2 id="5b2b" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">创建 CSV</h2><p id="0d65" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">创建 CSV 表。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mk"><img src="../Images/b3556b86995621510877eb970bd43b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*pDEkqR-BfkJ-pNiC3X8yaA.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">创建 CSV 表</figcaption></figure><h2 id="6e24" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">皈依 TSV 教</h2><p id="4eff" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">为什么？<em class="ml"> QnA 制造商要求</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mi"><img src="../Images/25cb1e578cd7b000182075b44f809101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*vHea7PHCJAT1EdjgrQPtsQ.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">用制表符替换逗号</figcaption></figure><h2 id="e30e" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">动态表达式代码</h2><pre class="iy iz ja jb fd lq lr ls lt aw lu bi"><span id="ffa3" class="kg jk hi lr b fi lv lw l lx ly">replace(body('Create_CSV_table_2'),',','    ')</span></pre><h2 id="ee10" class="kg jk hi bd jl kh ki kj jp kk kl km jt kn ko kp jv kq kr ks jx kt ku kv jz kw bi translated">创建一个斑点</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mm"><img src="../Images/fe13c57a39d8115c3bf0975fd11115f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*6VgCTkZF0GxMSKE1vsWpyw.png"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">存储帐户</figcaption></figure><p id="f73d" class="pw-post-body-paragraph kx ky hi kz b la mb ij lc ld mc im lf kn md lh li kq me lk ll kt mf ln lo lp hb bi translated">当它运行时，它是绿色的:)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mn"><img src="../Images/81356cc516c26fe3a36980f75a5afcf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oP5R_1fZlyurgzatDcIhKw.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">逻辑应用输出</figcaption></figure><p id="b155" class="pw-post-body-paragraph kx ky hi kz b la mb ij lc ld mc im lf kn md lh li kq me lk ll kt mf ln lo lp hb bi translated">接下来，</p><h1 id="aa45" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第 2 部分:QnA maker 服务和聊天机器人</h1><h1 id="b1de" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第 3 部分:团队部署</h1><h1 id="7744" class="jj jk hi bd jl jm jn jo jp jq jr js jt io ju ip jv ir jw is jx iu jy iv jz ka bi translated">第 4 部分:实现自动化！</h1><p id="10f8" class="pw-post-body-paragraph kx ky hi kz b la lb ij lc ld le im lf kn lg lh li kq lj lk ll kt lm ln lo lp hb bi translated">敬请期待！</p></div></div>    
</body>
</html>