<html>
<head>
<title>Ruby on Rails Testing with RSpec: Writing your First Tests</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用RSpec测试Ruby on Rails:编写您的第一个测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ruby-on-rails-testing-with-rspec-writing-your-first-tests-6330920928fd?source=collection_archive---------1-----------------------#2021-05-22">https://medium.com/nerd-for-tech/ruby-on-rails-testing-with-rspec-writing-your-first-tests-6330920928fd?source=collection_archive---------1-----------------------#2021-05-22</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2bdf" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">考试并不总是很难或者很可怕。作为一名开发人员，如何在早期编写自己的测试对您有长期的好处</h2></div><p id="a840" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你和我一样，那么当我说我有<em class="jt">总是</em>可怕的评估时，你就会明白我从何而来。也许是焦虑，缺乏知识，或者是在压力下表演(<em class="jt">或者也许是所有这些… </em>)。不管怎样，这是一种我从未克服的恐惧，至今仍未克服。</p><p id="9421" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，随着年龄的增长，我越来越能接受考试和考试背后的目的。是的，他们仍然很可怕，并将永远如此，但如果我们不把他们看作，“<em class="jt">明白了！你仍然不够聪明</em>”更重要的是，作为一个衡量你进步如何和你需要改进的地方的标尺<strong class="iz hj"> <em class="jt">，这并不坏。</em></strong></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ju"><img src="../Images/396101f94536b0582e9e1828dee45b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/0*-bw5TANPYZVppQcc"/></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">至少从这里只有一条路可走！</figcaption></figure><p id="b736" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">测试你的代码应该以同样的方式来看待。</p><p id="40a1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">是的，一次失败的测试仍然可能是令人生畏的(我仍然不能克服看起来可怕和刻薄的红色文本)，但它使我们免于进一步的困难。将测试视为检查点——每个测试都可以检查特定的特性是否仍然通过。当我们扩展应用程序并添加越来越多的功能时，我们希望确保我们以前的功能仍然有效。否则，我们会有一个烂摊子。</p><p id="7cfd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">想象一下，如果我们不断地添加功能，但没有在过程中测试我们的代码，却发现我们的代码被破坏了，我们不能准确地指出它在何时何地被破坏。我们将不得不一步一步地返回并测试<em class="jt">所有的东西— </em>这将是超级低效的&amp;让开发人员感到沮丧！</p><p id="b0a8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">事实上，围绕这个概念有一整套软件开发方法，叫做<strong class="iz hj">测试驱动开发</strong>。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="1b61" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">测试驱动开发(TDD)</h1><p id="2023" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">根据网站Guru99的定义:</p><p id="0460" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jt">“TDD是一种软件开发方法，在这种方法中，开发测试用例来指定和验证代码将做什么。简而言之，首先创建并测试每个功能的测试用例，如果测试失败，则编写新代码以通过测试，使代码简单且无错误"</em></p><p id="9c57" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如上所述，我们为应用程序的每个功能编写测试用例，甚至是一个小功能。如果一个测试失败了，我们作为开发人员应该回去写新的代码来解决这个问题。</p><p id="e7da" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">值得注意的是，这个概念围绕着我们在开发(或编写新代码)之前编写和纠正代码<em class="jt">的想法。这确保了我们保持代码的整洁，每次编写少量的代码，并避免重复的代码。</em></p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="ae71" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">RSpec和通用测试类型</h1><p id="6e98" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">在本文中，我们将介绍RSpec gem，它是测试Rails应用程序最常用的工具。</p><p id="953d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">作为开发人员，在您的旅程中会遇到一些常见的测试类型。它们是:</p><ol class=""><li id="bed6" class="lk ll hi iz b ja jb jd je jg lm jk ln jo lo js lp lq lr ls bi translated">模型测试:模型应该验证的测试，并且所有的方法都有效。</li><li id="3efa" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">请求测试:测试控制器是否做了它应该做的事情，无论是处理HTTP请求还是API端点</li><li id="7dd0" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">功能测试:测试web应用程序执行浏览器操作、在字段中输入数据、点击按钮和其他功能</li><li id="9c60" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">系统测试:应用程序的端到端测试</li></ol><p id="bc88" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本文中，我们将关注模型测试。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="58cc" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">正在设置</h1><p id="e588" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">在开始之前，我们需要将rspec-rails gem添加到我们的Gemfile中。在添加这个gem之后，我们还需要做一个包安装。这个gem可以添加到gem文件的:development::test部分下。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es ly"><img src="../Images/a0cd60c624ec8874e502a69eeb5c1fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rVCLPnNyk6tTfhMOO5WQkA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx translated">添加后别忘了捆绑安装！</figcaption></figure><p id="f2b8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将您的模式设置为如下所示——我们将使用一个具有first_name、last_name和phone属性的客户模型。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es md"><img src="../Images/0220aa7acf0b4c1f115f93208cca98d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cSlk2sJ00m9YzkTbzHRzCA.png"/></div></div></figure><p id="e85b" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的终端中输入以下命令来完成rspec的设置并设置测试数据库</p><pre class="jv jw jx jy fd me mf mg mh aw mi bi"><span id="f42d" class="mj ko hi mf b fi mk ml l mm mn">bin/rails generate rspec:install<br/>bin/rails db:migrate db:test:prepare</span></pre><p id="5924" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后，输入这些命令来为客户模型和客户控制器设置测试类的外壳。</p><pre class="jv jw jx jy fd me mf mg mh aw mi bi"><span id="0e04" class="mj ko hi mf b fi mk ml l mm mn">bin/rails generate rspec:model Customer<br/>bin/rails generate rspec:request Customer</span></pre><p id="eabd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这些命令之后，将会生成两个测试用例文件的外壳。这些是:</p><pre class="jv jw jx jy fd me mf mg mh aw mi bi"><span id="0b86" class="mj ko hi mf b fi mk ml l mm mn">./spec/models/customer_spec.rb<br/>./spec/request/customer_spec.rb</span></pre><p id="f3ba" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们现在可以通过在命令行中键入“rspec”来运行rspec！</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="3de5" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">编写我们的第一个测试</h1><p id="ca7a" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">现在我们已经设置好了，让我们向您介绍一些rspec特定的语法并编写一些测试</p><pre class="jv jw jx jy fd me mf mg mh aw mi bi"><span id="3ba2" class="mj ko hi mf b fi mk ml l mm mn">require 'rails_helper'</span><span id="f540" class="mj ko hi mf b fi mo ml l mm mn">RSpec.describe Customer, type: :model do<br/>  subject { Customer.new(first_name: "Jack", last_name: "Smith", phone: "8889995678", email: "jsmith@sample.com" )}</span><span id="0774" class="mj ko hi mf b fi mo ml l mm mn">  it "is valid with valid attributes" do<br/>    expect(subject).to be_valid<br/>  end<br/>  it "is not valid without a first_name" do<br/>    subject.first_name=nil<br/>    expect(subject).to_not be_valid<br/>  end<br/>  it "is not valid without a last_name" do<br/>    subject.last_name=nil<br/>    expect(subject).to_not be_valid<br/>  end</span><span id="1ac9" class="mj ko hi mf b fi mo ml l mm mn">it "is not valid without a phone number"    <br/>it "is not valid if the phone number is not 10 chars"   <br/>it "is not valid if the phone number is not all digits"</span><span id="38ee" class="mj ko hi mf b fi mo ml l mm mn">end</span></pre><p id="555c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们来分析一下上面的片段中发生了什么:</p><ol class=""><li id="09ec" class="lk ll hi iz b ja jb jd je jg lm jk ln jo lo js lp lq lr ls bi translated">Rspec.describe do…end块<em class="jt">描述</em>对象的类型(在我们的例子中，是一个模型类，<em class="jt">应该</em>做<em class="jt">)。</em></li><li id="f91c" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">主题设置好了，就是一段样本数据。在我们的例子中，我们有一个样本客户对象</li><li id="dad1" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">“it”块陈述了测试用例的预期结果。</li><li id="92d4" class="lk ll hi iz b ja lt jd lu jg lv jk lw jo lx js lp lq lr ls bi translated">“expect”关键字陈述了测试的预期结果，因此每个测试用例都有一个或多个预期结果。</li></ol><p id="b4c8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们编写一个没有do…end的“it”块，那么它就是一个<em class="jt">挂起</em>的测试用例，这意味着测试还没有被编写。</p><p id="58dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看看有书面预期结果的前三个测试。第一个测试只是测试我们的客户是否具有所有有效的属性。</p><p id="4588" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来的两个测试客户是否有名字和姓氏。如果缺少其中一项(或两项)，客户将无效。</p><p id="6825" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">那么我们如何检查这个呢？我们可以在我们的客户模型中编写验证！</p><p id="e254" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">搜索Rails文档，我们可以使用<em class="jt"> presence </em>来检查它是否存在:</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mp"><img src="../Images/d3c34bdfb61d6eb38b838165b85c0047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*Il7mNxw9RM1MFOjZ4aZRpw.png"/></div></figure><p id="f6cd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们的命令行中运行rspec，我们应该看到除了3个待定测试之外，所有的测试都通过了。我们现在就解决这个问题。</p><p id="ab29" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们的第一个未决测试与我们看到的类似，因为我们想要检查一个电话号码是否存在。我们可以再次使用相同的语法，也就是说，如果值=nil，我们期望对象是无效的。</p><p id="cacd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">至于剩下的两个测试，我们可以使用内置的length方法来检查那个属性是否等于10个字符，使用正则表达式来检查所有的字符是否都是数字。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es mq"><img src="../Images/5e1612d3dec745cbd468d03fdf9050e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qJFQLCK9MRiU7AVq8oU8ww.png"/></div></div></figure><p id="cf50" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">再次查看Rails文档，我们可以在客户模型中使用<em class="jt">数值</em>和<em class="jt">长度</em>编写一些额外的验证</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div role="button" tabindex="0" class="lz ma di mb bf mc"><div class="er es mr"><img src="../Images/cefad9500653fccf1447e8d7c1e01d3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uqxArtDjzjDvl_HfNLqEbQ.png"/></div></div></figure><p id="1f61" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在您的终端中再次运行rspec。我们所有的测试现在都应该通过了！</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="186c" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">结论</h1><p id="f177" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">祝贺您编写了第一个测试！希望介绍一些简单的测试将有助于消除你对编写和通过测试的恐惧。在开发生涯的早期被介绍给测试当然可以帮助你成为一个更好的开发人员，并改变你对如何使用测试的观点。</p><p id="0efb" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">请记住，编写大量的测试来测试每一个特性将有助于您在扩展应用程序时进行调试。</p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="e3cc" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">来源</h1><p id="a98d" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">什么是测试驱动开发(TDD)？举例教程【https://www.guru99.com/test-driven-development.html】T5<br/></p></div><div class="ab cl kg kh gp ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="hb hc hd he hf"><h1 id="2ec7" class="kn ko hi bd kp kq kr ks kt ku kv kw kx io ky ip kz ir la is lb iu lc iv ld le bi translated">额外资源</h1><p id="107d" class="pw-post-body-paragraph ix iy hi iz b ja lf ij jc jd lg im jf jg lh ji jj jk li jm jn jo lj jq jr js hb bi translated">Semaphore:如何用RSpec <br/> <a class="ae ms" href="https://semaphoreci.com/community/tutorials/how-to-test-rails-models-with-rspec" rel="noopener ugc nofollow" target="_blank">测试Rails模型https://semaphore ci . com/community/tutorials/How-to-Test-Rails-Models-with-RSpec</a></p></div></div>    
</body>
</html>