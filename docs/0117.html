<html>
<head>
<title>Removing simulator architecture from framework [x86_64, i386]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从框架中删除模拟器体系结构[x86_64，i386]</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/removing-simulator-architecture-from-framework-x86-64-i386-d8c4218b8e1?source=collection_archive---------0-----------------------#2020-03-27">https://medium.com/nerd-for-tech/removing-simulator-architecture-from-framework-x86-64-i386-d8c4218b8e1?source=collection_archive---------0-----------------------#2020-03-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/27e8cafff3802392903b0ff521726c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wpKU33nShtKatAbZG2XgQ.jpeg"/></div></div></figure><div class=""/><p id="76ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好iOS介质阅读器！</p><p id="7e23" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">几天前，我在上传应用程序到应用商店时遇到了问题。这个问题促使我写了第一篇文章。让我们开始吧:</p><p id="1844" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么问题出在哪里？问题在于上传应用程序到App Store时出现的这条迷人的信息:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es jo"><img src="../Images/804ea47693b067670f30b4b15c3dcdf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCPrVWcGGlZ-mKyuFC_aTA.png"/></div></div></figure><p id="0f5b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这条消息意味着你的<strong class="is hu"> <em class="jt">。添加到您的项目中的框架</em> </strong>文件包含被禁止的架构<strong class="is hu"> x86_64 </strong>和<strong class="is hu"> i386 </strong>。</p><p id="b295" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一如既往,<strong class="is hu">堆栈溢出</strong>为我们提供了一个解决方案，其中一个建议的解决方案是:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es ju"><img src="../Images/2b3e6b15e61bdbb9c1d5d420ff2075e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IkOQ73A7l4vR-FsEv9r_rQ.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated"><a class="ae jz" href="https://stackoverflow.com/questions/42641806/check-and-remove-unsupported-architecture-x86-64-i386-in-ipa-archive?answertab=votes#tab-top" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/42641806/check-and-remove-unsupported-architecture-x86-64-i386-in-IPA-archive？answertab=votes#tab-top </a></figcaption></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="ea35" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">上述解决方案在我的项目中运行良好，直到我不得不将Mac上的操作系统升级到Catalina。</p><p id="28c6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于那些没注意到的人，更新后说明<strong class="is hu"> <em class="jt">。框架</em> </strong>文件被当作一个目录。所以看起来不会是这样的:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es kh"><img src="../Images/44f8b1eb1bc41bcae5719e2052fddf7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*E8JBxOmNeWZRJgp5yZmdxg.png"/></div></figure><p id="d8dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">看起来会像一个:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es ki"><img src="../Images/00f418ffcc9f8d56708e17bd35f58805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/1*WHetPBG9CnPOqcLrmFnjNw.jpeg"/></div></figure><p id="8bde" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于这一行代码，这种细微的差别在您的脚本中造成了巨大的混乱:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es kj"><img src="../Images/2c081c5d36cbe45ebffecd2fab1a889b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhhYFefdvZSeIUb9fKrNPQ.png"/></div></div></figure><p id="9ef9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">负责在<strong class="is hu"><em class="jt">$ APP _ PATH</em></strong>(“<strong class="is hu"><em class="jt">$ APP _ PATH”</em></strong>是我们框架所在的路径)找到带有<strong class="is hu">的文件。框架</strong>扩展。乍一看，一切似乎都很好……几分钟后，我意识到<strong class="is hu"> <em class="jt">。框架</em> </strong>文件现在是一个目录，代码的`*framework '末尾缺少了`/`。正确的条目应该如下所示:` *。框架/`。</p><p id="1bad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">知道我在代码中添加了这个缺失的元素，并希望修复这个问题。但是问题还是出现了...</p><p id="a7d3" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我决定寻找一种不同的解决方案，并创建自己的脚本来消除这种有缺陷的架构。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="089a" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如何<strong class="ak">检查</strong>框架是否包含被禁止的架构？</h1><p id="a56e" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">要回答这个问题，我需要在中的可执行文件上使用带有<strong class="is hu"> -info </strong>选项的<strong class="is hu"> lipo </strong>命令<strong class="is hu"> </strong>。框架目录。</p><blockquote class="ln lo lp"><p id="a0b1" class="iq ir jt is b it iu iv iw ix iy iz ja lq jc jd je lr jg jh ji ls jk jl jm jn hb bi translated">M <!-- -->矿石信息关于<strong class="is hu">脂</strong>命令:<strong class="is hu">https://ss64.com/osx/lipo.html</strong>T43</p></blockquote><p id="74a6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将以<a class="ae jz" href="http://snapkit.io" rel="noopener ugc nofollow" target="_blank"><strong class="is hu">snap kit . framework</strong></a><strong class="is hu"/>为例:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lt"><img src="../Images/284a36769cf0c8c8127a61769bdaecb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vzU0Eql8doiQsA0Lht4Lw.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">巴什:脂肪信息SnapKit.framework/SnapKit</figcaption></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h1 id="065a" class="kk kl ht bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如何<strong class="ak">去除</strong>被禁建筑？</h1><p id="9df1" class="pw-post-body-paragraph iq ir ht is b it li iv iw ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn hb bi translated">答案是再次使用<strong class="is hu"> lipo </strong>命令<strong class="is hu">T5，这一次用<strong class="is hu"> -remove </strong>选项:</strong></p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lu"><img src="../Images/5a321651372549b1d724711fb5e3369f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0wI6F7pAhT6Ze5FekEUIA.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">bash:lipo-remove x86 _ 64 SnapKit.framework/Snapkit-SnapKit.framework/Snapkit</figcaption></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="9a92" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">到目前为止一切顺利。在这一点上，我可以检查框架包含的架构，并删除不必要的架构。</p><p id="e9dd" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我已经得到了创建该脚本所需的一切，我需要检查可执行文件是否包含我想要删除的架构，因为如果不包含，我将得到如下所示的致命错误:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lv"><img src="../Images/10341e190c1d5ce45dba9f32d3b049d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PDhiQ5hZ-OW_yOKw1mO7w.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">bash:当我试图删除不存在的架构时出现致命错误</figcaption></figure><p id="1247" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了解决这个问题，我需要再次使用<strong class="is hu"> lipo </strong>，这次使用<strong class="is hu"> -verify_arch </strong>选项。稍后我会解释如何使用它。</p><p id="a876" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我有了创建脚本所需的所有必要元素。</p><p id="ea4f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您从未在Xcode中创建过运行脚本，请转到项目<strong class="is hu">构建阶段</strong>并遵循以下截图中的步骤:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lw"><img src="../Images/f450c7f1f6cd36a672035c11206b6e0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNEY8V9UmBCRH3C3RplMQw.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx translated">xcode--&gt;构建阶段--&gt;+--&gt;新运行脚本阶段</figcaption></figure><h1 id="fc09" class="kk kl ht bd km kn lx kp kq kr ly kt ku kv lz kx ky kz ma lb lc ld mb lf lg lh bi translated">最终脚本:</h1><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es mc"><img src="../Images/99b15374321b5210148cdc894a625f0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sl5yJyphRi6IeWal01Ew1g.png"/></div></div></figure><p id="ed46" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个脚本中发生了什么:</p><ul class=""><li id="3b97" class="md me ht is b it iu ix iy jb mf jf mg jj mh jn mi mj mk ml bi translated">首先，我需要找到框架目录的所有路径，例如:“myawesompoject/Carthage/Build/iOS/snap kit . framework/”并重复它，直到我找到所有正在发生的可能性，</li><li id="e7d1" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">对于每个找到的路径:</li><li id="b785" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">计算由“/”分隔的单词数，取最后一个，在“.”之前的“cut”单词,</li><li id="06aa" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">获取<strong class="is hu"> <em class="jt">中可执行文件的路径。框架</em> </strong>目录，例如:"SnapKit.framework/SnapKit"。</li><li id="f59c" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">打印找到的文件名(用于检查)，</li><li id="7450" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">检查可执行文件是否包含搜索到的体系结构，</li><li id="9979" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">移除不必要的架构，</li><li id="d443" class="md me ht is b it mm ix mn jb mo jf mp jj mq jn mi mj mk ml bi translated">打印包含的架构(也用于检查目的)。</li></ul><p id="cd45" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一次归档项目时，架构可能不会被删除。当这种情况发生时，只需再次存档。</p><blockquote class="ln lo lp"><p id="2cbd" class="iq ir jt is b it iu iv iw ix iy iz ja lq jc jd je lr jg jh ji ls jk jl jm jn hb bi translated">提示:在归档项目之前，最好复制您的<strong class="is hu"> <em class="ht">。</em> </strong>框架目录到另一个地方。当脚本完成工作时，可执行框架文件将不再包含架构模拟器，因此您将需要使用Carthage再次构建您的依赖项，并在模拟器上运行它。</p></blockquote><p id="76cf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">希望那篇文章对某人有帮助:)</p><p id="a008" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢，祝你好运！</p><p id="ef05" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">脚本要点:<br/><a class="ae jz" href="https://gist.github.com/Rafal-Prazynski/74b910fbaaf27540742dac49a84843ff" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/Rafal-Prazynski/74b 910 FBA af 27540742 DAC 49 a 84843 ff</a></p><h2 id="4e6e" class="mr kl ht bd km ms mt mu kq mv mw mx ku jb my mz ky jf na nb lc jj nc nd lg ne bi translated">出于好奇:</h2><blockquote class="nf"><p id="f074" class="ng nh ht bd ni nj nk nl nm nn no jn dx translated">1)我调查了一下为什么第一次没有移除架构。结果是，在脚本运行之前，框架已经被复制了。这解释了为什么在第二次尝试后归档会正确运行。</p><p id="2e2e" class="ng nh ht bd ni nj nk nl nm nn no jn dx translated">2)如果您想了解更多关于ipo指令的信息，请访问以下网站:【https://ss64.com/osx/lipo.html】</p></blockquote></div></div>    
</body>
</html>