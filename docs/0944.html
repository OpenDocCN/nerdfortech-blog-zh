<html>
<head>
<title>How to handle 100k rows decision table in Drools-Part3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Drools-Part3中处理100k行决策表</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-handle-100k-rows-decision-table-in-drools-part3-a185641a905e?source=collection_archive---------7-----------------------#2021-02-24">https://medium.com/nerd-for-tech/how-to-handle-100k-rows-decision-table-in-drools-part3-a185641a905e?source=collection_archive---------7-----------------------#2021-02-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4f36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如在<a class="ae jd" href="https://ryanzhangcheng.medium.com/how-to-run-100k-rules-in-drools-7b9308e75687" rel="noopener">上一篇文章</a>中所描述的，当解决100k行决策表时，我们面临着一个非常具有挑战性的性能问题。</p><p id="fc56" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要查看之前的讨论，请单击:</p><p id="5418" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方案1: <a class="ae jd" href="https://ryanzhangcheng.medium.com/how-to-run-100k-rules-in-drools-7b9308e75687" rel="noopener">规则模板+ Xls </a></p><p id="b79e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方案2: <a class="ae jd" href="https://ryanzhangcheng.medium.com/how-to-handle-100k-rows-decision-table-in-drools-part2-2b7fb4de3532" rel="noopener">预编译电子表格决策表</a></p><p id="960c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将改变思维模式，将决策表行数据从规则改为事实。我再次使用drools作为我的框架。</p><h1 id="1f4d" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">解决方案3:将行数据转换为事实，而不是规则</h1><p id="0609" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">当决策表低于行大小10k时，解决方案2(预编译规则)非常有用。然而，当行数非常大时，如100k，解决方案2的改进可以忽略不计。更糟糕的是编译时间太长，这是因为在一个项目中编译100k个Java文件不是一个正常的任务。</p><p id="db50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就其设计本质而言，决策表很受欢迎，因为它允许您在一行中管理一个规则，因此您可以以一种简单的方式管理多行。然而，漂浮在船上的水也可能会把它吞没。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/62f6f31bfc931b92262eef3f57fa912d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MdXM4Gg1eRGl6LhY"/></div></div></figure><p id="9e33" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果规则数量太大，我们能减少规则数量吗？</p><p id="80ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们能否以原始格式读取Excel文件，将这些行数据作为事实插入，然后在内存中计算它们？然后你在内存中有100k个事实而不是100k个规则。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="fc01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对上面的代码做一个简单的测试，就可以了，性能是&lt;50 ms!</p><p id="f46c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">However, We don’t throw away the bath water with the child. We don’t want to hardcode the Excel Read and Parser in our generic application code. The business logic needs to be decoupled with generic application.</p><p id="e379" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Could we load Excel data in a DRL file and insert the fact?</p><p id="cac9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">The answer is <strong class="ih hj"> yes </strong>！</p><p id="d805" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DRL是非常动态和灵活的，基本上你可以像写java代码一样去做。</p><p id="195b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，为了简化drl编辑，通常我们可以提供一个干净的工具来读取Excel文件，并将它们转换成定制的事实，以满足您的需要。</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="d414" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还在我的分支中提供了一个简单的Excel工具，参见KeywordReader.java:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="d3fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们在客户端应用程序中运行这些规则:</p><figure class="ki kj kk kl fd km"><div class="bz dy l di"><div class="kt ku l"/></div></figure><p id="81af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">太好了，表现非常好。<br/>如您所见，加载规则中的excel文件可能需要2.7秒。之后，每个规则的执行只需要70毫秒。</p><h1 id="f765" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">赞成</h1><p id="4efb" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">最大的好处就是性能好。如您所见，考虑到Excel文件中的大量输入数据，性能比以前的解决方案快100多倍；</p><p id="510a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更好的是，没有编译开销。</p><p id="837a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">excel数据仍然可以从应用程序逻辑中分离出来。所有业务规则数据都可以照常打包到规则项目中。</p><h1 id="d78e" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">欺骗</h1><p id="c72d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">据我所知，有两个缺点:</p><ol class=""><li id="ebe6" class="kv kw hi ih b ii ij im in iq kx iu ky iy kz jc la lb lc ld bi translated">原始Excel数据不能在kie-workbench中处理</li><li id="c683" class="kv kw hi ih b ii le im lf iq lg iu lh iy li jc la lb lc ld bi translated">规则项目中有一些复杂的Excel阅读器逻辑。</li></ol><p id="2106" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于业务用户来说可能不太舒服，但是，我认为，您可以将Excel解析逻辑包装在一个单独的jar文件中，这样可以将它从业务规则项目中分离出来。</p></div></div>    
</body>
</html>