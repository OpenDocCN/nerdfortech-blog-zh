<html>
<head>
<title>Installing K6 and Running a Load Test</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安装 K6 并运行负载测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/installing-k6-and-running-a-load-test-b1fd07161b37?source=collection_archive---------8-----------------------#2021-07-09">https://medium.com/nerd-for-tech/installing-k6-and-running-a-load-test-b1fd07161b37?source=collection_archive---------8-----------------------#2021-07-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="efaa" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">装置</h1><p id="c550" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我有一台 Mac 设备，所以我将使用 brew 来安装 K6。其他使用其他操作系统的用户，请阅读此<a class="ae kb" href="https://k6.io/docs/getting-started/installation/" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="0e95" class="kl ig hi kh b fi km kn l ko kp">brew install k6</span></pre><p id="7e92" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">创建一个新文件夹 K6，并创建一个名为 loadtest.js 的文件名。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="70fa" class="kl ig hi kh b fi km kn l ko kp">touch loadtest.js</span></pre><p id="dfce" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">将以下脚本添加到该文件中</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="a84c" class="kl ig hi kh b fi km kn l ko kp">import http from 'k6/http';<br/>import { sleep } from 'k6';</span><span id="db55" class="kl ig hi kh b fi kv kn l ko kp">export default function () {<br/>  http.get('<a class="ae kb" href="https://test.k6.io'" rel="noopener ugc nofollow" target="_blank">https://test.k6.io'</a>);<br/>  sleep(1);<br/>}</span></pre><p id="c559" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">将尝试使用以下命令运行脚本。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="3e85" class="kl ig hi kh b fi km kn l ko kp">k6 run loadtest.js</span></pre><p id="25e6" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">现在你可以看到结果了</p><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kw"><img src="../Images/0808e451a42634c02539404e8a07bd80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UMS1dP9t98tC4SQQKWSAPQ.png"/></div></div></figure><p id="82e7" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">我们将为这个请求做断言。断言是确保我们到达正确终点的中继重要因素。</p><p id="923f" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">我试图否定这个断言。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="e04a" class="kl ig hi kh b fi km kn l ko kp">import { check } from 'k6';<br/>import http from 'k6/http';</span><span id="a1b7" class="kl ig hi kh b fi kv kn l ko kp">export default function () {<br/>  let res = http.get('<a class="ae kb" href="http://test.k6.io/'" rel="noopener ugc nofollow" target="_blank">http://test.k6.io/'</a>);<br/>  check(res, {<br/>    'is status 200': (r) =&gt; r.status === 200,<br/>    'body contains text': (r) =&gt; r.body.includes('aaa'),<br/>  });<br/>}</span></pre><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es le"><img src="../Images/d33be21aee04ee3c8728e0d531bfe699.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0V0GZUMef2tZ84HWwvViZA.png"/></div></div></figure><p id="f847" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">我们将更正并运行相同的测试。</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="0d36" class="kl ig hi kh b fi km kn l ko kp">import { check } from 'k6';<br/>import http from 'k6/http';</span><span id="3b56" class="kl ig hi kh b fi kv kn l ko kp">export default function () {<br/>  let res = http.get('<a class="ae kb" href="http://test.k6.io/'" rel="noopener ugc nofollow" target="_blank">http://test.k6.io/'</a>);<br/>  check(res, {<br/>    'is status 200': (r) =&gt; r.status === 200,<br/>    'body contains text': (r) =&gt; r.body.includes('Collection of simple web-pages suitable for load testing.'),<br/>  });<br/>}</span></pre><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lf"><img src="../Images/38bad0f6f619d6a13848155784daf46b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D63rRUGAf691L4EmtKde4w.png"/></div></div></figure><p id="d4c1" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">然后，我们将尝试与一个用户一起运行 30 秒</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="f700" class="kl ig hi kh b fi km kn l ko kp">k6 run --duration 30s loadtest.js</span></pre><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lg"><img src="../Images/07883c0c265f679e4d212bad8c056097.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WUEitZvyVravX8VZ1k7ZvA.png"/></div></div></figure><p id="9cf1" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">是时候向脚本中添加一个端点了</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="b409" class="kl ig hi kh b fi km kn l ko kp">import { check, sleep } from 'k6';<br/>import http from 'k6/http';</span><span id="3ecc" class="kl ig hi kh b fi kv kn l ko kp">export default function () {<br/>  let res = http.get('<a class="ae kb" href="http://test.k6.io/',{tags" rel="noopener ugc nofollow" target="_blank">http://test.k6.io/',{tags</a>: {'name': 'home'}});<br/>  check(res, {<br/>    'is status 200': (r) =&gt; r.status === 200,<br/>    'body contains text': (r) =&gt; r.body.includes('Collection of simple web-pages suitable for load testing.'),<br/>  });<br/>sleep(1);<br/>  res = http.get('<a class="ae kb" href="http://test.k6.io/news.php',{tags" rel="noopener ugc nofollow" target="_blank">http://test.k6.io/news.php',{tags</a>: {'name': 'news'}});<br/>  check(res, {<br/>    'is status 200': (r) =&gt; r.status === 200,<br/>    'body contains text': (r) =&gt; r.body.includes('In the news'),<br/>  });<br/>}</span></pre><p id="f9fd" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">然后，我们将尝试与一个用户一起运行 30 秒</p><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lh"><img src="../Images/a5afd714b4e77f0436ab185007c14861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gwpnN5uul8JDZjuguIQu0w.png"/></div></div></figure><p id="6164" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">然后，我们将尝试 10 个用户运行 30 秒</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="0df1" class="kl ig hi kh b fi km kn l ko kp">k6 run --vus 10 --duration 30s loadtest.js</span></pre><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kw"><img src="../Images/694a1037c476c2ef88378c64330a09e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BwL73Fqtvr1m6S_z5raLHg.png"/></div></div></figure><p id="0f0f" class="pw-post-body-paragraph jd je hi jf b jg kq ji jj jk kr jm jn jo ks jq jr js kt ju jv jw ku jy jz ka hb bi translated">我们可以得到 json 格式的结果</p><pre class="kc kd ke kf fd kg kh ki kj aw kk bi"><span id="3866" class="kl ig hi kh b fi km kn l ko kp">k6 run --out json=my_test_result.json --vus 10 --duration 30s loadtest.js</span></pre><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es li"><img src="../Images/4daf4cf0552e54919a2eb30a2614d824.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xRsM2UGUbqh5vt1BCgBxVQ.png"/></div></div></figure><figure class="kc kd ke kf fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lj"><img src="../Images/de097b520bf2dbb6e0cee84f75d2f10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTLWExTlQ2n2xXL9APCWHQ.png"/></div></div></figure></div></div>    
</body>
</html>