<html>
<head>
<title>Should I use const?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">应该用const吗？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/should-i-use-const-593d4ab07529?source=collection_archive---------13-----------------------#2021-05-26">https://medium.com/nerd-for-tech/should-i-use-const-593d4ab07529?source=collection_archive---------13-----------------------#2021-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cd61" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写JavaScript的时候经常用<code class="du jd je jf jg b">const</code>。</p><p id="394f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<code class="du jd je jf jg b">const</code>和<code class="du jd je jf jg b">let</code>的技术差异方面，差别很小。有些人认为<code class="du jd je jf jg b">const</code>不应该经常使用。我推荐阅读这些作品:</p><div class="jh ji ez fb jj jk"><a href="https://jamie.build/const" rel="noopener  ugc nofollow" target="_blank"><div class="jl ab dw"><div class="jm ab jn cl cj jo"><h2 class="bd hj fi z dy jp ea eb jq ed ef hh bi translated">一个他妈的咆哮关于他妈的const vs他妈的let</h2><div class="jr l"><h3 class="bd b fi z dy jp ea eb jq ed ef dx translated">我不想成为写这篇文章的人，但我是，因为克里斯告诉我去责怪那个该死的家伙。我是受害者…</h3></div><div class="js l"><p class="bd b fp z dy jp ea eb jq ed ef dx translated">杰米。建立</p></div></div></div></a></div><div class="jh ji ez fb jj jk"><a href="https://github.com/getify/You-Dont-Know-JS/blob/2nd-ed/scope-closures/apA.md#const-antly-confused" rel="noopener  ugc nofollow" target="_blank"><div class="jl ab dw"><div class="jm ab jn cl cj jo"><h2 class="bd hj fi z dy jp ea eb jq ed ef hh bi translated">getify/你不知道</h2><div class="jr l"><h3 class="bd b fi z dy jp ea eb jq ed ef dx translated">现在，我们将围绕本书正文中涵盖的许多主题探讨一些细微差别和边缘。这个…</h3></div><div class="js l"><p class="bd b fp z dy jp ea eb jq ed ef dx translated">github.com</p></div></div><div class="jt l"><div class="ju l jv jw jx jt jy jz jk"/></div></div></a></div><p id="2bcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是我很喜欢用<code class="du jd je jf jg b">const</code>，我一直在想为什么。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/8acffe3ea5c133d13dbd9c1f0bb6d106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IGs1FkMtPUwO8X5g8u1Grg.png"/></div></div></figure><h1 id="e3fd" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">团队风格指南</h1><p id="0e4f" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">在工作中，大家一致同意<code class="du jd je jf jg b">const</code>只能用于“实际常数”。如果一个值发生突变，应该用<code class="du jd je jf jg b">let</code>来定义。</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="d368" class="ls km hi jg b fi lt lu l lv lw">let arr = [];    // arr is mutated, so we use let<br/>arr.push(3);</span></pre><p id="cc82" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照这个想法，任何使用<code class="du jd je jf jg b">const</code>的地方都应该是<em class="lx">一个实际的常数。与其尽可能盲目地使用<code class="du jd je jf jg b">const</code>，不如使用<code class="du jd je jf jg b">const</code>作为一种开发者交流意图的方式。我喜欢这个原则。</em></p><h1 id="faee" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">我为什么喜欢康斯特</h1><p id="1694" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">为什么我这么经常用<code class="du jd je jf jg b">const</code>？有两个答案引起了我的注意。</p><p id="33cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我倾向于用函数式风格编写代码。我更喜欢用<code class="du jd je jf jg b">map</code>和<code class="du jd je jf jg b">filter</code>而不是<code class="du jd je jf jg b">push</code>。在用函数式方式思考时，我使用常量变量，这表明了我的意图。</p><p id="4f27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在所有值都不可变(或者至少被视为不可变)的函数式代码中，我不认为这有什么特别的争议。</p><p id="bdc2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是考虑到我使用const的其他原因，我想更仔细地研究一下样式指南。</p><h1 id="90c8" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">关于突变的想法</h1><p id="96a3" class="pw-post-body-paragraph if ig hi ih b ii lj ik il im lk io ip iq ll is it iu lm iw ix iy ln ja jb jc hb bi translated">在我的工作中，我写了很多我们称之为工作流的东西。例如，对于申请延长截止日期的流程，工作流将管理申请在不同审批者之间的传递。这基本上是作为一个状态机来建模的。</p><p id="eaee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">工作流的每个特定实例由一个对象表示，按照惯例称为<code class="du jd je jf jg b">M</code>。我从来没有听到有人质疑过在代码中使用<code class="du jd je jf jg b">const</code>这样的用法:</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="aefc" class="ls km hi jg b fi lt lu l lv lw">const M = workflow.instanceForRef(ref);</span></pre><p id="f295" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我只对一个特定的工作流实例感兴趣，所以我不打算重新分配<code class="du jd je jf jg b">M</code>，所以<code class="du jd je jf jg b">const</code>在技术上是有意义的。但是风格呢？</p><p id="c3e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个工作流实例都有一个<code class="du jd je jf jg b">state</code>属性，将工作流的状态表示为字符串，不能直接修改。像基本状态机一样，<code class="du jd je jf jg b">state</code>是通过转换来改变的。例如:</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="bafe" class="ls km hi jg b fi lt lu l lv lw">const M = workflow.instanceForRef(ref);<br/>console.log(M.state);    // "wait_submit"<br/>M.transition("submit");<br/>console.log(M.state);    // "wait_approval_supervisor</span></pre><p id="f8af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据对风格指南的严格阅读，<code class="du jd je jf jg b">M</code>是变异的，所以我不应该使用<code class="du jd je jf jg b">const</code>。但是，至少对我来说，<code class="du jd je jf jg b">const</code>感觉传达我的想法是正确的，而且我以前没有听到任何人质疑它。</p><p id="f073" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每个工作流都有一个惟一的ID，在这段代码中，我只对一个特定的工作流实例感兴趣。尽管它的状态可能会改变，<code class="du jd je jf jg b">M</code>在我的函数中总是引用同一个工作流实例。<code class="du jd je jf jg b">const</code>是我用来交流的工具。</p><p id="cfc0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我似乎有一个没有争议的例子，可以不遵循风格指南的字面意思。有什么方法可以让我们清楚地定义什么时候规则可以被忽略？</p><p id="8f76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想到的另一个例子是使用数据结构，比如JavaScript的Map和Set。在我看来，在这里使用<code class="du jd je jf jg b">const</code>是有意义的:</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="8ef9" class="ls km hi jg b fi lt lu l lv lw">const uniqueNames = new Set();<br/>for(const person of people) {<br/>    uniqueNames.add(person.name);<br/>}</span></pre><p id="d1be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jd je jf jg b">uniqueNames</code>正在变异，但对我来说有意义的是，集合整体上是一个不变的概念，而不是一个变化的值。</p><p id="cebc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有趣的是，对我来说，这比这样的事情更有意义:</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="5795" class="ls km hi jg b fi lt lu l lv lw">const results = [];<br/>results.push(something());<br/>if(condition) {<br/>    results.push(somethingElse());<br/>}<br/>results.push(yetAnotherThing());<br/>if(skipFirstResult) {<br/>    results.shift();<br/>}<br/>return results;</span></pre><p id="38e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会(按照风格指南的指示)使用<code class="du jd je jf jg b">let result = [];</code>来代替。</p><p id="6463" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想知道一个重要的区别是变量看起来是否代表一个具体的概念(这似乎是一个很难定义的特征)。<code class="du jd je jf jg b">M</code>指一个特定的工作流实例(具有唯一的、不可变的ID)。<code class="du jd je jf jg b">uniqueNames</code>是目前看到的所有名字的集合。<code class="du jd je jf jg b">result</code>只是我正在收集的结果列表。</p><p id="579a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在前两个例子中，<code class="du jd je jf jg b">const</code>变量是远离我的代码实现的某个类的实例，它有一个明确定义的接口和一个隐藏的实现。我在想<code class="du jd je jf jg b">M</code>的时候，不去想移动状态的确切步骤；我考虑文档中的<code class="du jd je jf jg b">transition</code>方法。当我想到数组<code class="du jd je jf jg b">results</code>的时候，我会想到在末尾粘贴更多的元素。</p><p id="ad35" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我有某种队列结构，用一个空数组实现，会怎么样？</p><pre class="kb kc kd ke fd lo jg lp lq aw lr bi"><span id="7886" class="ls km hi jg b fi lt lu l lv lw">const queue = [];<br/>while(queue.length) {<br/>    const node = queue.shift();<br/>    for(const adjacent of node.children) {<br/>        queue.push(adjacent);<br/>    }<br/>}</span></pre><p id="5eb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<code class="du jd je jf jg b">push</code>和<code class="du jd je jf jg b">shift</code>是与<code class="du jd je jf jg b">results</code>例子中完全相同的方法，但是它们看起来更有意义。用不同的数组替换<code class="du jd je jf jg b">queue</code>是没有意义的:队列是算法的主要部分。</p><p id="8042" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在队列的例子中，我认为<code class="du jd je jf jg b">const</code>更有意义，但是这不符合风格指南的字面意思。</p><p id="b095" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想知道:</p><ul class=""><li id="fd74" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">风格指南该不该改？</li><li id="7e36" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">如果改了，应该怎么改？</li><li id="efa0" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">风格指南中的规则能考虑到开发人员想要表达想法的每一种方式吗？</li><li id="7d27" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">花时间思考这个问题有多大价值？与之前版本的风格指南相比，当我们一直使用<code class="du jd je jf jg b">let</code>时，我们失去了或获得了多少价值？</li></ul><p id="3d5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我没有答案。但是我倾向于同意丹·阿布拉莫夫的观点:选择一种风格(作为一个团队)，然后一起工作。</p></div></div>    
</body>
</html>