<html>
<head>
<title>Interesting SQL function’s worth knowing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有趣的 SQL 函数值得了解</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/interesting-sql-functions-worth-knowing-982def8878fd?source=collection_archive---------16-----------------------#2021-04-11">https://medium.com/nerd-for-tech/interesting-sql-functions-worth-knowing-982def8878fd?source=collection_archive---------16-----------------------#2021-04-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d375" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> COALESCE()，存储过程，SELECT INTO，CASE </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/cd7cefbc6aeb4ea8fd6a02fcc1196618.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*JwMX2smoYasgkddKDCaPLQ.jpeg"/></div></figure><h1 id="ba51" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">联合()</h1><p id="0133" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">COALESCE 接受任意数量的参数，并返回第一个不为 null 的值。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="8d36" class="kt jm hi kp b fi ku kv l kw kx">COALESCE(x,y,z) = x if x is not NULL<br/>  COALESCE(x,y,z) = y if x is NULL and y is not NULL<br/>  COALESCE(x,y,z) = z if x and y are NULL but z is not NULL<br/>  COALESCE(x,y,z) = NULL if x and y and z are all NULL</span></pre><p id="988d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当您想要用其他值替换空值时，COALESCE 会很有用。在本例中，您显示了每个有聚会的 MSP 的聚会名称。对于没有交易方的 MSP(如卡纳万、丹尼斯)，显示字符串 None。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="e3fb" class="kt jm hi kp b fi ku kv l kw kx">SELECT name, party<br/>      ,COALESCE(party,'None') AS aff<br/>  FROM msp WHERE name LIKE 'C%'</span></pre><h1 id="fdbf" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">存储过程</strong></h1><p id="0676" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">存储过程是一个准备好的 SQL 代码，您可以保存它，这样代码就可以重复使用。</p><p id="dd30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果您有一个反复编写的 SQL 查询，请将其保存为存储过程，然后调用它来执行它。</p><p id="ce4c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还可以将参数传递给存储过程，以便存储过程可以根据传递的参数值进行操作。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="2d1e" class="kt jm hi kp b fi ku kv l kw kx">CREATE PROCEDURE <em class="ky">procedure_name </em>AS <em class="ky">sql_statement </em>GO;</span><span id="fde5" class="kt jm hi kp b fi kz kv l kw kx">EXEC <em class="ky">procedure_name</em>;</span></pre><h2 id="ad01" class="kt jm hi bd jn la lb lc jr ld le lf jv iq lg lh jz iu li lj kd iy lk ll kh lm bi translated">例子</h2><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="fae6" class="kt jm hi kp b fi ku kv l kw kx">CREATE PROCEDURE SelectAllCustomers AS SELECT * FROM Customers GO;</span></pre><p id="75c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">执行上面的存储过程，如下所示</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="46e7" class="kt jm hi kp b fi ku kv l kw kx">EXEC SelectAllCustomers;</span></pre><h1 id="e906" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">带参数的存储过程</h1><p id="4286" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">列出每个参数和数据类型，用逗号分隔，如下所示。</p><p id="ae19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下 SQL 语句创建了一个存储过程，该过程从“Customers”表中选择具有特定邮政编码的特定城市的客户:</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="748e" class="kt jm hi kp b fi ku kv l kw kx">CREATE PROCEDURE SelectAllCustomers @City nvarchar(30), @PostalCode nvarchar(10)<br/>AS<br/>SELECT * FROM Customers WHERE City = @City AND PostalCode = @PostalCode<br/>GO;</span><span id="6f91" class="kt jm hi kp b fi kz kv l kw kx">EXEC SelectAllCustomers @City = ‘London’, @PostalCode = ‘WA1 1DP’;</span></pre><h1 id="c1a7" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">选择进入</h1><p id="c6a4" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><code class="du ln lo lp kp b">SELECT INTO</code>语句将数据从一个表复制到一个新表中。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="6468" class="kt jm hi kp b fi ku kv l kw kx">SELECT *<br/>INTO <em class="ky">newtable</em> [IN <em class="ky">externaldb</em>]<br/>FROM <em class="ky">oldtable<br/></em>WHERE <em class="ky">condition</em>;</span></pre><p id="5b0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅将一些列复制到新表中</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="e8d2" class="kt jm hi kp b fi ku kv l kw kx">SELECT <em class="ky">column1</em>, <em class="ky">column2</em>, <em class="ky">column3</em>, ...<br/>INTO <em class="ky">newtable</em> [IN <em class="ky">externaldb</em>]<br/>FROM <em class="ky">oldtable<br/></em>WHERE <em class="ky">condition;</em></span></pre><h2 id="4ad9" class="kt jm hi bd jn la lb lc jr ld le lf jv iq lg lh jz iu li lj kd iy lk ll kh lm bi translated"><strong class="ak">例题</strong></h2><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="d932" class="kt jm hi kp b fi ku kv l kw kx">SELECT * INTO CustomersBackup2017<br/>FROM Customers;</span><span id="fa2a" class="kt jm hi kp b fi kz kv l kw kx">SELECT  CustomerName, ContactName INTO CustomersBackup2017 IN 'Backup.mdb'<br/>FROM Customers;</span><span id="cea1" class="kt jm hi kp b fi kz kv l kw kx">SELECT Customers.CustomerName, Orders.OrderID<br/>INTO CustomersOrderBackup2017<br/>FROM Customers<br/>LEFT JOIN Orders ON Customers.CustomerID = Orders.CustomerID;</span></pre><h1 id="0090" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated"><strong class="ak">案例</strong></h1><p id="d46a" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated"><code class="du ln lo lp kp b">CASE</code>语句遍历条件，并在满足第一个条件时返回值(类似于 if-then-else 语句)。所以，一旦条件为真，它将停止读取并返回结果。如果没有条件为真，则返回<code class="du ln lo lp kp b">ELSE</code>子句中的值。</p><p id="25a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果没有<code class="du ln lo lp kp b">ELSE</code>部分并且没有条件为真，则返回 NULL。</p><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="2e12" class="kt jm hi kp b fi ku kv l kw kx">CASE<br/>    WHEN <em class="ky">condition1</em> THEN <em class="ky">result1</em><br/>    WHEN <em class="ky">condition2</em> THEN <em class="ky">result2</em><br/>    WHEN <em class="ky">conditionN</em> THEN <em class="ky">resultN</em><br/>    ELSE <em class="ky">result</em><br/>END;</span></pre><h2 id="c60e" class="kt jm hi bd jn la lb lc jr ld le lf jv iq lg lh jz iu li lj kd iy lk ll kh lm bi translated">例子</h2><pre class="je jf jg jh fd ko kp kq kr aw ks bi"><span id="2df4" class="kt jm hi kp b fi ku kv l kw kx">SELECT OrderID, Quantity,<br/>CASE<br/>    WHEN Quantity &gt; 30 THEN 'The quantity is greater than 30'<br/>    WHEN Quantity = 30 THEN 'The quantity is 30'<br/>    ELSE 'The quantity is under 30'<br/>END AS QuantityText<br/>FROM OrderDetails;</span><span id="9608" class="kt jm hi kp b fi kz kv l kw kx">SELECT CustomerName, City, Country<br/>FROM Customers<br/>ORDER BY<br/>(CASE<br/>    WHEN City IS NULL THEN Country<br/>    ELSE City<br/>END);</span></pre><h1 id="e81c" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">这就是所有的人…</h1><p id="2cbb" class="pw-post-body-paragraph if ig hi ih b ii kj ik il im kk io ip iq kl is it iu km iw ix iy kn ja jb jc hb bi translated">如果你们有兴趣并想学习 SQL，<a class="ae lq" href="https://sqlzoo.net/wiki/SQL_Tutorial" rel="noopener ugc nofollow" target="_blank">https://sqlzoo.net/wiki/SQL_Tutorial</a>，我推荐你们去看看这个神奇的教程</p><p id="d33e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">和往常一样，如果你已经读到这里..</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ls lt di lu bf lv"><div class="er es lr"><img src="../Images/dcf21bddde5fc157c9aac93e9c15ed20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Jf6hf9EonuGzdIN5JeZObQ.gif"/></div></div></figure></div></div>    
</body>
</html>