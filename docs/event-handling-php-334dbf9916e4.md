# 事件处理— PHP

> 原文：<https://medium.com/nerd-for-tech/event-handling-php-334dbf9916e4?source=collection_archive---------7----------------------->

![](img/5b030a516f9157d70683f4779be68de4.png)

John 被指派处理用户注册问题。他想避免这个问题，因为这与代码的复杂程度有关。他在这个项目中工作了两年，已经修复了好几次，但是每当他打开代码，就好像他第一次看到它一样。

约翰在挑其他问题，把注册问题拖到最后一刻。每当他的主管询问这个问题时，他都在冒汗。所以几天后，他决定重构代码，使他的工作更容易。

你曾经做过的代码*做了太多，以至于改变它*都让人害怕？或者*你每次打开它的时候都从头分析过吗*？

这通常来自于充满子流程的**代码，这些子流程已经与**主流程合并。****

# 主流和支流

![](img/d598878aefb8198adaaedb8cf443be84.png)

在注册**的情况下，主流程将创建一个用户并将其保存**到数据库。
另一方面，**子流程** **可以是** :
-发送欢迎或确认电子邮件
-创建关于用户注册的审计日志
-将注册用户同步到外部服务

如果我们将注册(创建和保存用户)视为主流程，那么**子流程将作为主流程成功**的结果而发生。

那么我们如何判断主流是成功的呢？
**我们正在通过*事件*来做这件事！**

事件是描述过去发生的事情。在注册的情况下，*用户已经注册。*
**通过订阅事件，我们能够运行任何子流。**

# 发布和订阅事件

[](https://docs.ecotone.tech/install-php-service-bus) [## 装置

### 提供商应自动注册。2.由于需要访问依赖容器，您必须在…中选择一个

docs . econtero . tech](https://docs.ecotone.tech/install-php-service-bus) 

让我们从定义事件类开始。

> ****事件是任何框架相关接口或抽象类*** *的类清除。**

*我们将使用来自*PersonRegistrationService*的事件总线发布 PersonWasRegistered 事件。*

> **安装生态区后，事件总线自动注册到依赖容器中**

*我们现在可以将所有的逻辑转移到事件处理程序中，事件处理程序订阅特定的事件。*

> *****事件处理程序根据第一个参数类型提示*** *订阅特定事件。***
> 
> **我们在这里使用了一个包含三个事件处理程序的类。如果您觉得有必要，您可以自由地为每个事件处理程序创建单独的类。**

**您可能会注意到，我们将特定的服务直接注入到事件处理程序的方法中。**

**由于 econtero 的方法调用机制，这是可能的。您可以将任何服务传递给给定的*命令/事件/查询处理程序的*方法，而 econtero 将通过**为您注入这些服务来完成这项工作。****

# **快乐的约翰**

**![](img/fd2e77e899b82da5d524d48796e60d1b.png)**

**John 现在确信，分离子流将使他的代码更具可读性、可测试性和可靠性。
他发现**改变给定功能的代码只会影响现在的给定流程**。他可以想到更简单的测试方法，因为他可以单独测试事件处理程序。并且确信，将来当新的子流程到来时，团队维护代码会变得更加容易。**

**如果你想了解更多关于事件处理的信息，请阅读[生态交错区的文档](https://docs.ecotone.tech/modelling/event-handling)。**