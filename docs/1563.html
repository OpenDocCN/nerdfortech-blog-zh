<html>
<head>
<title>Using Context API in React with Functional Components</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在与功能组件的交互中使用上下文API</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/using-context-api-in-react-with-functional-components-dbc653c7d485?source=collection_archive---------0-----------------------#2021-03-26">https://medium.com/nerd-for-tech/using-context-api-in-react-with-functional-components-dbc653c7d485?source=collection_archive---------0-----------------------#2021-03-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="4bc4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">理解和使用React上下文API</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/6163a85f1a0de734987694b1c161e41e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wK-UqAbyM5FZ4yDp"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">安德烈亚斯·古尔霍恩在<a class="ae jn" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="adc3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在本文中，我们将学习React中的上下文API，并使用它来构建一个非常简单的项目。</p><p id="153c" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">先决条件:</strong>本文假设你已经掌握了JavaScript和react的基本知识，但并不要求你在阅读之前就了解这些知识。</p><h2 id="ffdd" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated"><strong class="ak">React中的上下文API是什么？</strong></h2><blockquote class="lf lg lh"><p id="c98c" class="jo jp li jq b jr js ij jt ju jv im jw lj jy jz ka lk kc kd ke ll kg kh ki kj hb bi translated">上下文提供了一种通过组件树传递数据的方式，而不必在每一层手动向下传递属性。— <strong class="jq hj">反应文档</strong></p></blockquote><p id="a4f2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">如果您使用react有一段时间了，或者对react有一定的经验，您将会知道，当项目中的许多组件都要使用props时，通过props传递数据变得非常麻烦，您必须显式地将props传递到组件树中。</p><p id="483a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有时，一些组件不得不接收道具，只是为了将它传递给它的子组件。这就是所谓的<strong class="jq hj">支柱钻孔。这给你的项目增加了一些复杂性，当项目越来越大时，管理起来就变得很困难。</strong></p><p id="9644" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这种情况下，上下文API被证明是有用的。在我们的应用程序中使用上下文API，我们避免通过不需要道具的中间组件传递道具，“道具演练”。</p><blockquote class="lf lg lh"><p id="cd64" class="jo jp li jq b jr js ij jt ju jv im jw lj jy jz ka lk kc kd ke ll kg kh ki kj hb bi translated">B <!-- -->同样，Context API被设计用来共享“全局”数据，这些数据可以在你的应用程序的任何部分使用，而不需要沿着组件树向下传递属性。</p></blockquote><h2 id="c529" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">如何使用上下文API</h2><p id="0233" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">让我们看看如何使用上下文API来构建这个简单的用户列表应用程序。</p><p id="45d5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我用<strong class="jq hj"><em class="li">create-react-app</em></strong>来引导项目。<br/>如果你想跟着做，你可以做<strong class="jq hj"> <em class="li"> npx创建-反应-app应用-名称</em> </strong></p><p id="8635" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li">我们将建造什么:</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lr"><img src="../Images/63806c56606aa618dd0504a0a2dcba3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w0RUC4lHB2WuAMwQobLnBQ.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">简单用户列表应用程序</figcaption></figure><p id="49d9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是一个简单的应用程序，可以让你添加一个用户到用户列表中，也可以删除用户。</p><p id="6f69" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这是我的文件结构的样子:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ls"><img src="../Images/12a0b31b09562c9be9c4dfe04775900e.png" data-original-src="https://miro.medium.com/v2/resize:fit:492/format:webp/1*FpjUU8lfySVeNYW0Lw1kog.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">文件结构</figcaption></figure><p id="0889" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你会看到我使用了三(3)个组件<strong class="jq hj"> <em class="li"> (User.js，UserList.js，AddUser.js) </em> </strong>和<strong class="jq hj"> App.js </strong>，我们很快就会看到它们各自做了什么。<strong class="jq hj"> </strong>还可以看到我们接下来要讲的<strong class="jq hj"> context.js </strong>文件。</p><h2 id="bc6e" class="kk kl hi bd km kn ko kp kq kr ks kt ku jx kv kw kx kb ky kz la kf lb lc ld le bi translated">如何在react中创建上下文？</h2><p id="6290" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated"><em class="li"> context.js </em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lt"><img src="../Images/67795206018afbc97816a6a7b2c0c30f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*im98w8MRZ1yQnkBcTSYOZA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">创建上下文</figcaption></figure><pre class="iy iz ja jb fd lu lv lw lx aw ly bi"><span id="3e0b" class="kk kl hi lv b fi lz ma l mb mc">import { createContext } from 'react';<br/>export const AppContext = createContext();</span></pre><p id="8c0e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在上面的例子中，<code class="du md me mf lv b">createContext</code>方法将帮助我们创建一个<strong class="jq hj">上下文实例</strong>，它将帮助我们向各个组件发送数据。所以我们出口是为了能够进口并在那些组件中使用它。</p><p id="0e3a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">让我们看看App.js文件里有什么</strong></p><p id="4148" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li"> App.js </em></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="6cb9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你会看到在<em class="li">第8行</em> : <code class="du md me mf lv b"><em class="li">const [ users, setUsers ] = useState(userList);<br/></em></code>我使用了<em class="li"/><strong class="jq hj"><em class="li">useState</em></strong>钩子来存储用户列表。</p><p id="bc9b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li">第10–21行→ </em> <code class="du md me mf lv b"><strong class="jq hj">dispatchUserEvent(actionType, payload) </strong></code>是一个函数，它接收一个<strong class="jq hj"> actionType </strong>(例如:<strong class="jq hj"/>‘ADD _ USER’，‘REMOVE _ USER’<strong class="jq hj">)</strong>和一个<strong class="jq hj"> payload </strong>(实际内容)<strong class="jq hj"> </strong>，它将从如上所示的状态中添加或删除用户。</p><p id="c0af" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">l <em class="li">线24–29→<strong class="jq hj">返回</strong>块中我正在做的<code class="du md me mf lv b">&lt;AppContext.Provider value={{ users, dispatchUserEvent }}&gt;</code></em></p><p id="b3df" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><code class="du md me mf lv b">AppContext.Provider</code>标签中的<code class="du md me mf lv b">value</code>属性是对<code class="du md me mf lv b">&lt;AddUser /&gt;</code>和<code class="du md me mf lv b">&lt;UserList /&gt; </code>组件可用的数据。<br/>这意味着在<code class="du md me mf lv b">&lt;AddUser /&gt;</code>和<code class="du md me mf lv b">&lt;UserList /&gt;</code>及其所有子组件中，我们可以访问用户列表，还可以调度事件来添加或删除用户。</p><p id="59b7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">现在让我们看看如何从我们的<strong class="jq hj"> UserList.js </strong>组件的上下文中获取并呈现用户列表。</p><p id="14d1" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li"> UserList.js </em></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="8c50" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li">第6行</em> →因为我们正在使用功能组件，所以我们正在使用<strong class="jq hj"> useContext </strong>钩子，它是react提供给我们的，如此处所示<code class="du md me mf lv b">const { users } = useContext(AppContext);</code></p><blockquote class="lf lg lh"><p id="c95a" class="jo jp li jq b jr js ij jt ju jv im jw lj jy jz ka lk kc kd ke ll kg kh ki kj hb bi translated">注意我们是如何在<strong class="jq hj"> useContext </strong>钩子中传递<strong class="jq hj"> AppContext </strong>的，以及我们是如何从上下文中只析构<strong class="jq hj"> users </strong>的，因为我们想用这个组件呈现用户列表。</p></blockquote><p id="3d8d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们使用<strong class="jq hj">地图</strong>显示用户，并为每个用户呈现<strong class="jq hj"> User.js </strong>组件。</p><p id="ba38" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li"> User.js </em></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="92be" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="li">第12–16行</em> →我们显示用户信息(如姓名、年龄和简历)</p><p id="d5ad" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="li">第5行→我们从上下文中得到</em> <code class="du md me mf lv b">dispatchUserEvent </code>。</p><p id="30b8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在第7–9行→我们调度一个<strong class="jq hj"> REMOVE_USER </strong>事件，用<strong class="jq hj"> userId </strong>作为第18行<em class="li">按钮点击的有效负载。</em>这意味着每次点击按钮时，它都会调度一个事件，使用用户的id将用户从状态中移除。<br/> <em class="li">还记得</em><strong class="jq hj"><em class="li">dispatchUserEvent</em></strong><em class="li">函数吗？</em></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/c0305041d2ea868af84a48e69089da67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IkuHe1lUu-y3bwpRrkTsYA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">调度用户事件</figcaption></figure><p id="819b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">让我们看看如何将用户添加到列表中。</p><p id="520e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><em class="li"> AddUser.js </em></p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="90e0" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以在这里，我们也可以从上下文访问<strong class="jq hj"> dispatchUserEvent </strong>。<code class="du md me mf lv b">const { dispatchUserEvent } = useContext(AppContext);</code></p><p id="e895" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在<em class="li">第6–8行</em> → am使用<strong class="jq hj"> useState </strong>跟踪来自输入字段的数据。<br/>和函数<strong class="jq hj"><em class="li">handleAddUser()</em></strong><em class="li">通过在按钮点击时分派一个</em>“添加用户”动作并将用户数据作为有效载荷传递来将用户添加到列表中。</p><p id="a7fd" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">所以最后我们有了这个:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mj"><img src="../Images/6698e0099486562016d846aa7b71085b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*q8fuZBcs1JgktZypRtbPAw.gif"/></div></div></figure><h1 id="713b" class="mk kl hi bd km ml mm mn kq mo mp mq ku io mr ip kx ir ms is la iu mt iv ld mu bi translated">在使用上下文API之前</h1><p id="d60a" class="pw-post-body-paragraph jo jp hi jq b jr lm ij jt ju ln im jw jx lo jz ka kb lp kd ke kf lq kh ki kj hb bi translated">请注意，上下文主要用于某些数据需要由不同嵌套级别的许多<em class="li">组件访问，并且您希望避免沿树向下传递道具时。</em></p><p id="244a" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">上下文API非常有用，但是您应该小心使用它，因为它有时会使组件重用变得困难。</p><p id="2399" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">你可以在这里阅读更多<a class="ae jn" href="https://reactjs.org/docs/context.html" rel="noopener ugc nofollow" target="_blank"> React文档—上下文</a></p><p id="73e9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">感谢您的阅读。</p></div><div class="ab cl mv mw gp mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="hb hc hd he hf"><p id="66e9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">也可以看下面的视频版。</p><figure class="iy iz ja jb fd jc"><div class="bz dy l di"><div class="nc mh l"/></div></figure></div></div>    
</body>
</html>