<html>
<head>
<title>Refactor non-developer codes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重构非开发人员代码</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/refactor-non-developer-codes-b29083281622?source=collection_archive---------12-----------------------#2021-10-14">https://medium.com/nerd-for-tech/refactor-non-developer-codes-b29083281622?source=collection_archive---------12-----------------------#2021-10-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6db6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">基于真实故事</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7d1ee9d3b4bb7ed8550d8e6a43830be1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W3e1nv2bOKoRMRHtFj1vQg.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">这张图片改编自文件:2021 年 3 月 24 日，在泰国曼谷举行的一次集会上，亲民主抗议者在地板上画了一个标志，要求释放被捕的抗议领袖，并废除 112 lese majeste 法律。照片:路透社/豪尔赫·席尔瓦</figcaption></figure><p id="5516" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我有机会为一个内部活动创建一个网站。我们的团队决定，这个网站的体验可以类似于设计团队创建的体验——他们最近刚刚举行了类似的活动——这种体验看起来整洁干净。</p><p id="9552" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于努力和时间有限(…和懒惰)，我决定使用他们的代码作为起点。</p><p id="d17d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在与代码一起工作了一小段时间后，我看到了可以改进的模式和实践，例如命令式编程、死代码、未使用的依赖，并有了将它们写下来的想法。</p><h2 id="da87" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated"><strong class="ak">免责声明</strong></h2><p id="a6de" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">我的目的不是批评任何人，而是记录学到的教训，这对以后的任何人都是有益的。</p><h1 id="76c4" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">命令式编程</h1><h2 id="d373" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">不使用数组方法—映射</h2><p id="6450" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">这只是将<code class="du lk ll lm ln b">this.programsData</code>转换为<code class="du lk ll lm ln b">Session</code>对象的数组。在滚动、滚动…和滚动之后，很容易忘记这个操作的结果是什么。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="0ca0" class="jt ju hi ln b fi ls lt l lu lv">let sessions = [];<br/>let entries = this.programsData;</span><span id="8770" class="jt ju hi ln b fi lw lt l lu lv">for (var j = 0; j &lt; entries.length; j++) {<br/>  var newSession = new Session();<br/>  var entry = entries[j];</span><span id="efae" class="jt ju hi ln b fi lw lt l lu lv">  var ID = entry.RowKey;<br/>  if (ID) {<br/>    newSession.ID = ID;<br/>  }</span><span id="b29e" class="jt ju hi ln b fi lw lt l lu lv">  var title = entry.Title;<br/>  if (title) {<br/>    newSession.Title = title;<br/>  }</span><span id="f510" class="jt ju hi ln b fi lw lt l lu lv">  var track = entry.Track;<br/>  if (track) {<br/>    newSession.Track = entry.Track;<br/>  }</span><span id="f7ca" class="jt ju hi ln b fi lw lt l lu lv">  var type = entry.Type;<br/>  if (type) {<br/>    newSession.Type = type;<br/>  }</span><span id="8921" class="jt ju hi ln b fi lw lt l lu lv">  var description = entry.Description;<br/>  if (description) {<br/>    newSession.Description = description;<br/>  }</span><span id="f452" class="jt ju hi ln b fi lw lt l lu lv">  var language = entry.Language;<br/>  if (language) {<br/>    newSession.Language = language;<br/>  }</span><span id="93a5" class="jt ju hi ln b fi lw lt l lu lv">  var calendarLink = entry.CalendarLink;<br/>  if (calendarLink) {<br/>    newSession.CalendarLink = calendarLink;<br/>  }</span><span id="c477" class="jt ju hi ln b fi lw lt l lu lv">  var eventX = entry.EventX;<br/>  if (eventX) {<br/>    newSession.EventX = eventX;<br/>  }</span><span id="94f1" class="jt ju hi ln b fi lw lt l lu lv">  var eventXText = entry.EventXText;<br/>  if (eventXText) {<br/>    newSession.EventXText = eventXText;<br/>  } else {<br/>    newSession.EventXText = "Register in EventX";<br/>  }</span><span id="ac7a" class="jt ju hi ln b fi lw lt l lu lv">  var special = entry.Special;<br/>  if (special) {<br/>    newSession.Special = special;<br/>  }</span><span id="3a3b" class="jt ju hi ln b fi lw lt l lu lv">  var specialText = entry.SpecialText;<br/>  if (specialText) {<br/>    newSession.SpecialText = specialText;<br/>  }</span><span id="3d3b" class="jt ju hi ln b fi lw lt l lu lv">  var specialIcon = entry.SpecialIcon;<br/>  if (specialIcon) {<br/>    newSession.SpecialIcon = "images/em-icons.svg#" + specialIcon;<br/>  }</span><span id="c0d0" class="jt ju hi ln b fi lw lt l lu lv">  if (special &amp;&amp; specialText) {<br/>    if (!specialIcon) {<br/>      newSession.SpecialIcon = "images/em-icons.svg#" + "exclamation-point";<br/>    }<br/>    newSession.ShowSpecial = true;<br/>  } else {<br/>    newSession.ShowSpecial = false;<br/>  }</span><span id="a9ae" class="jt ju hi ln b fi lw lt l lu lv">  var start = entry.Start;<br/>  if (start) {<br/>    var startDate = new Date(start);<br/>    newSession.Date = startDate;<br/>    newSession.StartTime = startDate;<br/>  }</span><span id="9ddf" class="jt ju hi ln b fi lw lt l lu lv">  var end = entry.End;<br/>  if (end) {<br/>    var endDate = new Date(end);<br/>    newSession.EndTime = endDate;<br/>  }</span><span id="f8c1" class="jt ju hi ln b fi lw lt l lu lv">  var speakerIDs = entry.Speakers;<br/>  if (speakerIDs) {<br/>    var speakers = speakerIDs.split(",");<br/>    var sp;<br/>    for (sp = 0; sp &lt; speakers.length; sp++) {<br/>      if (speakers[sp].charAt(0) == " ") {<br/>        speakers[sp] = speakers[sp].substr(1);<br/>      }<br/>    }<br/>    newSession.Speakers = speakers;<br/>  }</span><span id="2638" class="jt ju hi ln b fi lw lt l lu lv">  var regionIDs = entry.Regions;<br/>  if (regionIDs) {<br/>    var regions = regionIDs.split(",");<br/>    var rg;<br/>    for (rg = 0; rg &lt; regions.length; rg++) {<br/>      if (regions[rg].charAt(0) == " ") {<br/>        regions[rg] = regions[rg].substr(1);<br/>      }<br/>    }<br/>    newSession.Regions = regions;<br/>  }<br/>  sessions.push(newSession);<br/>}</span></pre><p id="173c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">重构后，代码可以从 100 多行减少到大约 20 行。数据结构很容易理解，转换逻辑也很简单。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="ed15" class="jt ju hi ln b fi ls lt l lu lv">let sessions = this.programsData.map(program =&gt; {<br/>  return {<br/>    ID: program.RowKey,<br/>    Title: program.Title,<br/>    Track: program.Track,<br/>    Type: program.Type,<br/>    Description: program.Description,<br/>    Language: program.Language,<br/>    CalendarLink: program.CalendarLink,<br/>    EventX: program.EventX,<br/>    EventXText: program.EventXText &amp;&amp; "Register in EventX",<br/>    Special: program.Special,<br/>    SpecialText: program.SpecialText,<br/>    SpecialIcon: program.SpecialIcon ? "images/em-icons.svg#" +  program.SpecialIcon : "images/em-icons.svg#" + "exclamation-point",<br/>    ShowSpecial: program.Special &amp;&amp; program.SpecialText,<br/>    Date: new Date(program.Start),<br/>    StartTime: new Date(program.Start),<br/>    EndTime: new Date(program.End),<br/>    Speakers: program.Speakers ? program.Speakers.split(",").map(speaker =&gt; speaker.trim()): [],<br/>    Regions: program.Regions ? program.Regions.split(",").map(region =&gt; region.trim()) : []<br/>  }<br/>});</span></pre><h2 id="ec8e" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">不使用数组方法—查找</h2><p id="309a" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">这个例子类似，但更短。这只是为了找到选定的会话。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="095f" class="jt ju hi ln b fi ls lt l lu lv">getSession(ID) {</span><span id="8c98" class="jt ju hi ln b fi lw lt l lu lv">  for (var i = 0; i &lt; this.sessionList.length; i++) {<br/>    if (this.sessionList[i] &amp;&amp; this.sessionList[i].ID &amp;&amp; this.sessionList[i].ID == ID) {<br/>      return this.sessionList[i];<br/>    }<br/>  }</span><span id="ebd2" class="jt ju hi ln b fi lw lt l lu lv">  //No session associated with that ID<br/>  return null;<br/>}</span></pre><p id="c595" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这可以用内置数组方法在一行中完成。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="4f11" class="jt ju hi ln b fi ls lt l lu lv">getSession(ID) {<br/>  return this.sessionList.find(session =&gt; session.ID === ID);<br/>}</span></pre><h2 id="1250" class="jt ju hi bd jv jw jx jy jz ka kb kc kd iq ke kf kg iu kh ki kj iy kk kl km kn bi translated">手动追加 CSS 类</h2><p id="8a65" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">这只是显示或隐藏 HTML 文档的一部分。强制性地，这可以通过手动操作类列表来完成，但是当查看 HTML 元素时这并不明显。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="c4a5" class="jt ju hi ln b fi ls lt l lu lv">&lt;div class="em-c-alert <strong class="ln hj">em-u-is-hidden</strong>" role="alert" :id="s.ID"&gt;<br/>  ...<br/>&lt;/div&gt;</span><span id="0943" class="jt ju hi ln b fi lw lt l lu lv">openLink(ID){<br/>  var element = document.getElementById(ID);<br/>  element.classList.remove("<strong class="ln hj">em-u-is-hidden</strong>");<br/>}</span><span id="e862" class="jt ju hi ln b fi lw lt l lu lv">closeLink(ID) {<br/>  var element = document.getElementById(ID);<br/>  element.classList.add("<strong class="ln hj">em-u-is-hidden</strong>");<br/>  element.tabindex = -0;<br/>}</span></pre><p id="b077" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于应用程序已经用 Vue 实现，我们可以简单地绑定变量来切换 CSS 类。</p><pre class="je jf jg jh fd lo ln lp lq aw lr bi"><span id="0f21" class="jt ju hi ln b fi ls lt l lu lv">&lt;div class="em-c-alert" v-bind:class="{ '<strong class="ln hj">em-u-is-hidden</strong>': <strong class="ln hj">!s.isLinkDisplayed</strong> }" role="alert" :id="s.ID"&gt;<br/>  ...<br/>&lt;/div&gt;</span><span id="161d" class="jt ju hi ln b fi lw lt l lu lv">openLink(session){<br/>  session.isLinkDisplayed = true;<br/>}</span><span id="f3d1" class="jt ju hi ln b fi lw lt l lu lv">closeLink(session) {<br/>  session.isLinkDisplayed = false;<br/>}</span></pre><h1 id="ba68" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">单一组件中的多种职责</h1><p id="3f12" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">一个组件中有 6 个子页面(主页、项目、项目详情、团队、演讲者详情、常见问题)。该组件使用布尔标志自行管理路由，而不是将其分解成自己的组件并通过<a class="ae lx" href="https://router.vuejs.org/" rel="noopener ugc nofollow" target="_blank"> Vue 路由器</a>管理路由。概念概述如下:</p><ul class=""><li id="8d00" class="ly lz hi ih b ii ij im in iq ma iu mb iy mc jc md me mf mg bi translated">用户试图访问子页面(通过单击链接或手动输入 URL)</li><li id="f267" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">每个链接都映射到自己的 URL，但都链接到同一个组件！！！用不同的道具。</li><li id="ff2c" class="ly lz hi ih b ii mh im mi iq mj iu mk iy ml jc md me mf mg bi translated">在组件内部，根据道具设置布尔标志，即<code class="du lk ll lm ln b">profileView, profilesView, sessionsView, sessionView, aboutView, FAQView </code>。它稍后使用这些标志来显示/隐藏组件中的子页。</li></ul><p id="9a9e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这导致一个巨大的组件包含 4350 行代码！！！这是非常繁琐的。</p><h1 id="60ba" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">未使用的依赖项</h1><p id="1aaa" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">最初，我对大量的包依赖关系感到惊讶。我使用<a class="ae lx" href="https://www.npmjs.com/package/depcheck" rel="noopener ugc nofollow" target="_blank"> depcheck </a>来分析依赖项，这样我就可以决定删除。不幸的是，有相当多的错误警报——依赖项正在被使用，但被报告为未使用。为了克服这些错误警报，我需要删除并重新启动应用程序，以验证它是否工作正常。最后，我可以去掉一半的依赖。</p><h1 id="c636" class="kt ju hi bd jv ku kv kw jz kx ky kz kd la lb lc kg ld le lf kj lg lh li km lj bi translated">死代码</h1><p id="75c4" class="pw-post-body-paragraph if ig hi ih b ii ko ik il im kp io ip iq kq is it iu kr iw ix iy ks ja jb jc hb bi translated">应移除注释代码。</p></div></div>    
</body>
</html>