<html>
<head>
<title>Hello-world in Kubernetes with Terraform, k3d and kpt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带Terraform、k3d和kpt的Kubernetes hello-world</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hello-world-with-terraform-k3d-and-kpt-860e8a414669?source=collection_archive---------4-----------------------#2021-02-23">https://medium.com/nerd-for-tech/hello-world-with-terraform-k3d-and-kpt-860e8a414669?source=collection_archive---------4-----------------------#2021-02-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/2d755204045f639600b4d5c7999538ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X8MPAIrMYvTqx_Zl.jpg"/></div></div></figure><p id="bc53" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简短的高级教程，使用Terraform和k3d在本地设置Kubernetes集群，然后使用kpt部署一个简单的hello-world应用程序。</p><h2 id="d9af" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">要求:</h2><ul class=""><li id="7a01" class="kj kk hi is b it kl ix km jb kn jf ko jj kp jn kq kr ks kt bi translated">地形0.13+:<a class="ae ku" href="https://www.terraform.io/downloads.html" rel="noopener ugc nofollow" target="_blank">https://www.terraform.io/downloads.html</a></li><li id="b031" class="kj kk hi is b it kv ix kw jb kx jf ky jj kz jn kq kr ks kt bi translated">k3d:<a class="ae ku" href="https://github.com/rancher/k3d" rel="noopener ugc nofollow" target="_blank">https://github.com/rancher/k3d</a></li><li id="f3d3" class="kj kk hi is b it kv ix kw jb kx jf ky jj kz jn kq kr ks kt bi translated">https://googlecontainertools.github.io/kpt/installation/</li><li id="5c55" class="kj kk hi is b it kv ix kw jb kx jf ky jj kz jn kq kr ks kt bi translated">kubectl 1.15+:<a class="ae ku" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/tasks/tools/install-kubectl/</a></li><li id="1da4" class="kj kk hi is b it kv ix kw jb kx jf ky jj kz jn kq kr ks kt bi translated">https://docs.docker.com/install/</li><li id="6117" class="kj kk hi is b it kv ix kw jb kx jf ky jj kz jn kq kr ks kt bi translated">https://git-scm.com/downloads</li></ul></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="ec48" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated"><strong class="ak">使用地形创建k3d集群:</strong></h2><p id="ca29" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">克隆源repo并导航到它，初始化terraform，然后应用配置:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ad1e" class="jo jp hi lp b fi lt lu l lv lw">git clone https://gitlab.com/bengordonfraser/terraform-k3d.git ; cd terraform-k3d</span><span id="029c" class="jo jp hi lp b fi lx lu l lv lw">cp terraform.tfvars.example terraform.tfvars</span><span id="096e" class="jo jp hi lp b fi lx lu l lv lw">terraform init</span><span id="89b0" class="jo jp hi lp b fi lx lu l lv lw">terraform apply</span></pre><p id="0975" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出现提示时输入"是"，接受<code class="du ly lz ma lp b">terraform apply</code></p><p id="d422" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意输出<code class="du ly lz ma lp b">k3d_cluster_ip</code>和<code class="du ly lz ma lp b">k3d_host_lb_port</code>，因为稍后将使用它们来访问集群。</p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/5e43c7aa15bc529986a282edeb73f96e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAOwHLXyApc_rrbHulVnQw.png"/></div></div></figure></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="39a8" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated"><strong class="ak">使用kpt下载hello-world包并部署到k3d集群:</strong></h2><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="3892" class="jo jp hi lp b fi lt lu l lv lw">mkdir hello-world-workspace; cd $_</span><span id="2b81" class="jo jp hi lp b fi lx lu l lv lw">export SRC_REPO=https://gitlab.com/bengordonfraser/hello-world-kpt.git</span><span id="dd26" class="jo jp hi lp b fi lx lu l lv lw">kpt pkg get $SRC_REPO@v0.1.0 helloworld                                                                                                     </span><span id="b0d8" class="jo jp hi lp b fi lx lu l lv lw">kpt live apply helloworld</span></pre><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/1fe80502bffd1c802d50b797ec050ab2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGookk-hyOknDWGeh0GUgg.png"/></div></div></figure></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="bd24" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">卷起来！</h2><p id="cea5" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">使用Terraform输出的ip和端口(在本例中为127.0.0.1，即localhost和端口8043):</p><p id="4acf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ly lz ma lp b">curl localhost:8043</code></p><figure class="lk ll lm ln fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/1c435bc580995a02152ffbff4bd80ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L6c7NfA_CPzU7-jvtL-yFQ.png"/></div></div></figure><p id="4efb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意——入口可能需要几秒钟才能实例化，所以如果curl首先返回一个空响应，请重试。</p></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="7b63" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">学习:</h2><p id="d9cc" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">使用kubectl或kubernetes管理工具(如<a class="ae ku" href="https://k9scli.io/" rel="noopener ugc nofollow" target="_blank"> k9s </a>)探索集群和helloworld部署。一些kubectl命令示例:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0a2e" class="jo jp hi lp b fi lt lu l lv lw">kubectl get nodes</span><span id="7def" class="jo jp hi lp b fi lx lu l lv lw">kubectl get pods</span><span id="3773" class="jo jp hi lp b fi lx lu l lv lw">kubectl get svc</span><span id="de34" class="jo jp hi lp b fi lx lu l lv lw">kubectl get ingress</span></pre><p id="ec54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尝试使用kpt来更改部署配置:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="5987" class="jo jp hi lp b fi lt lu l lv lw">kpt cfg tree helloworld</span><span id="8727" class="jo jp hi lp b fi lx lu l lv lw">kpt cfg list-setters helloworld</span><span id="b294" class="jo jp hi lp b fi lx lu l lv lw">kpt cfg set helloworld replicas 5</span><span id="4403" class="jo jp hi lp b fi lx lu l lv lw">kpt cfg tree helloworld  --replicas</span><span id="018c" class="jo jp hi lp b fi lx lu l lv lw">kpt live apply helloworld</span></pre><p id="ecdd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">探索<a class="ae ku" href="https://gitlab.com/bengordonfraser/terraform-k3d/" rel="noopener ugc nofollow" target="_blank"> terraform-k3d repo </a>以了解如何使用输入变量和本地执行供应器将简单的基础架构配置组合在一起。</p></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="255e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">清理:</h2><p id="17f4" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated">使用以下命令删除helloworld部署:</p><p id="76e2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ly lz ma lp b">kpt live destroy helloworld</code></p><p id="4f65" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ly lz ma lp b">cd ..</code>返回到terraform-k3d目录，然后使用以下命令删除k3d集群:</p><p id="d750" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ly lz ma lp b">terraform destroy</code></p></div><div class="ab cl la lb gp lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="hb hc hd he hf"><h2 id="0d0e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki bi translated">阅读更多信息:</h2><p id="e272" class="pw-post-body-paragraph iq ir hi is b it kl iv iw ix km iz ja jb lh jd je jf li jh ji jj lj jl jm jn hb bi translated"><a class="ae ku" href="https://gitlab.com/bengordonfraser/hello-world-kpt/" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/bengordonfraser/hello-world-kpt</a>/</p><p id="a8d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">https://gitlab.com/bengordonfraser/terraform-k3d/<a class="ae ku" href="https://gitlab.com/bengordonfraser/terraform-k3d/" rel="noopener ugc nofollow" target="_blank"/></p><p id="092b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">【https://googlecontainertools.github.io/kpt/ T4】</p><div class="me mf ez fb mg mh"><a href="https://learn.hashicorp.com/tutorials/terraform/associate-study" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hj fi z dy mm ea eb mn ed ef hh bi translated">学习指南- Terraform助理认证</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">如果您准备参加来自…的Terraform助理认证考试，本指南列出了您应该学习的资源</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">learn.hashicorp.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv io mh"/></div></div></a></div><div class="me mf ez fb mg mh"><a href="https://github.com/rancher/k3d" rel="noopener  ugc nofollow" target="_blank"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hj fi z dy mm ea eb mn ed ef hh bi translated">牧场主/k3d</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">请注意:main现在是v4.0.0，v3.x的代码可以在main-v3分支中找到！k3s是轻量级的…</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">github.com</p></div></div><div class="mq l"><div class="mw l ms mt mu mq mv io mh"/></div></div></a></div></div></div>    
</body>
</html>