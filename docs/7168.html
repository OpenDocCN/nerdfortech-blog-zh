<html>
<head>
<title>HTTP Caches and Cookies</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HTTP 缓存和 Cookies</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/http-caches-and-cookies-80704e2f95a5?source=collection_archive---------2-----------------------#2022-08-15">https://medium.com/nerd-for-tech/http-caches-and-cookies-80704e2f95a5?source=collection_archive---------2-----------------------#2022-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="6cf4" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">Cookies:</h2></div><p id="ca65" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">HTTP 是一种无状态协议。这意味着它独立处理每个请求，而不知道以前的请求。</p><blockquote class="jt ju jv"><p id="c5c6" class="ix iy jw iz b ja jb ij jc jd je im jf jx jh ji jj jy jl jm jn jz jp jq jr js hb bi translated"><em class="hi">在同一连接上连续执行的两个请求之间没有链接</em></p></blockquote><p id="8617" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当你在一个电子商务网站上时，这种无国籍的概念就成了问题。这是因为一旦你登录了亚马逊或者 Flipkart，你就被要求登录，直到你的交易结束。直到你的交易完成，你不会改变你的浏览器(比如说 Chrome)。记住<strong class="iz hj">这个词<em class="jw">浏览器。</em> </strong></p><p id="d909" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj"> <em class="jw">饼干来了。</em> </strong> <em class="jw">它帮助服务器记住它从客户端获得的请求是否来自同一个浏览器。</em></p><p id="77a2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，HTTP cookie 是服务器发送给 web 浏览器的一小段数据。浏览器存储 cookie 并为每个后续请求发回它。</p><h2 id="4886" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated"><strong class="ak">cookie 是如何工作的？</strong></h2><p id="02a3" class="pw-post-body-paragraph ix iy hi iz b ja kv ij jc jd kw im jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">当收到请求时，服务器发送一个带有<strong class="iz hj"/><strong class="iz hj">‘Set-Cookie’</strong>HTTP 头的响应。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="eae1" class="ka kb hi lf b fi lj lk l ll lm">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt; <br/>Set-Cookie: hello=user</span></pre><p id="5773" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">浏览器保存 cookie 并将其与'<strong class="iz hj"> Cookie' </strong>标头一起发送。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="0ed1" class="ka kb hi lf b fi lj lk l ll lm">Cookie:hello=user</span></pre><p id="6734" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这样，服务器就知道请求来自同一个浏览器。</p><h2 id="6edc" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">饼干的一生</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="c2a6" class="ka kb hi lf b fi lj lk l ll lm">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Expires=&lt;date&gt; <br/>Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Max-Age=&lt;number&gt;</span></pre><p id="c34d" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里的到期日期(日期格式)是针对客户端的，最大期限以秒为单位。</p><p id="0d82" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于 cookies 存储在浏览器中，因此可以通过 JavaScript[document]访问它们。cookie API]，这就产生了漏洞。因此我们只用<strong class="iz hj"> <em class="jw"> httponly。</em>T25】</strong></p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2f85" class="ka kb hi lf b fi lj lk l ll lm">Set-Cookie: hello=user <strong class="lf hj"><em class="jw">HttpOnly</em></strong></span></pre><p id="bfdc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">缓存的基本发展点是减少请求消息和响应消息之间的时间。</p><h2 id="8a0c" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">HTTP 缓存:HTTP</h2><p id="706d" class="pw-post-body-paragraph ix iy hi iz b ja kv ij jc jd kw im jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">缓存的基本发展点是减少请求消息和响应消息之间的时间。</p><p id="f93c" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">提高了对用户的快速响应时间。</p><h2 id="ad33" class="ka kb hi bd kc kd ke kf kg kh ki kj kk jg kl km kn jk ko kp kq jo kr ks kt ku bi translated">场景？</h2><p id="29c0" class="pw-post-body-paragraph ix iy hi iz b ja kv ij jc jd kw im jf jg kx ji jj jk ky jm jn jo kz jq jr js hb bi translated">很简单，只要服务器的响应不变(可以是同一个静态网页，同一个 JSON，等等。).</p><p id="d7a1" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">不同的请求，但相同的回应。</p><p id="b8f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它可以在<em class="jw">浏览器</em>、<em class="jw">中间</em>服务器(代理服务器)以及<em class="jw">服务器</em>本身中实现。</p><p id="d621" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所有 HTTP 请求都首先通过浏览器缓存，不管特定请求是否有有效的缓存响应。这减少了网络时间和数据成本。</p><p id="37ee" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当响应被像网飞和亚马逊这样的服务提供商缓存在中间服务器中以减少用户等待时间时，它就成为了 CDN(至少是 CDN 的基础)。</p><p id="5d66" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果存储的响应应该只在浏览器中，我们应该添加一个 HTTP 头。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="24c7" class="ka kb hi lf b fi lj lk l ll lm">Cache-Control: <strong class="lf hj">private</strong></span></pre><p id="b3ea" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">实现代理缓存(中间服务器缓存)是为了减少服务器的网络流量。这些是缓存服务器。</p><p id="2992" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">但是，<strong class="iz hj"><em class="jw"/></strong>的请求和响应都是加密的。因此，代理服务器不能用作缓存服务器。</p><p id="dacc" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了减少用户等待时间和原始服务器的网络负载，服务开发人员发现了许多缓存策略。这些被称为<strong class="iz hj">托管缓存</strong>。例如 CDN。</p><p id="ac60" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您可以深入阅读这些 MDN 文档。</p><p id="8bb8" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">存储/缓存的响应有两种状态— <strong class="iz hj">新鲜</strong>和<strong class="iz hj">陈旧。</strong></p><p id="9a7e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">新鲜— </strong>存储的响应有效</p><p id="af36" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">陈旧— </strong>存储响应无效。</p><p id="0783" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">如何判断响应是</em> <strong class="iz hj"> <em class="jw">陈旧</em> </strong> <em class="jw">还是</em> <strong class="iz hj"> <em class="jw">新鲜</em> </strong> <em class="jw">？</em></p><p id="6be6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">两种情况-</p><p id="c91e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">1)具有共享缓存(中间服务器缓存)</p><p id="8be6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2)没有共享缓存</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="39dc" class="ka kb hi lf b fi lj lk l ll lm">Cache-Control: max-age=604800 --&gt; 1 week in seconds --&gt; from response generated time</span></pre><p id="2bce" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果超过 1 周→响应<em class="jw">失效</em>。</p><p id="9a98" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果少于 1 周→响应为<em class="jw">新鲜</em>。</p><p id="8f46" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果来自原始服务器的响应在中间或<strong class="iz hj">代理</strong>服务器中存储了一天，则需要通知这个<em class="jw">一天。</em>这就是<strong class="iz hj">年龄</strong>头来的原因。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="8655" class="ka kb hi lf b fi lj lk l ll lm">Cache-Control: max-age=604800 <br/><strong class="lf hj">Age: 86400 --&gt; One day in seconds</strong></span></pre><p id="b322" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，604800–86400 = 518400 用于确定陈旧或新鲜。</p><p id="f2db" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="iz hj">记住:</strong></p><p id="da08" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">HTTP 缓存的工作是基于头部和它们之间的链接的集合。</p><p id="c533" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一些标题是，</p><p id="c6b3" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">缓存控制</em></p><p id="9b53" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">最后修改</em></p><p id="af18" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">如果-修改-自</em></p><p id="fad2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">如果不匹配</em></p><p id="19b6" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw"> Etag 等。</em></p><p id="7fc2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="jw">最初发表于 2022 年 8 月 15 日</em><a class="ae ln" href="https://www.pansofarjun.com/post/http-caches-and-cookies" rel="noopener ugc nofollow" target="_blank"><em class="jw">https://www.pansofarjun.com</em></a><em class="jw">。</em></p></div></div>    
</body>
</html>