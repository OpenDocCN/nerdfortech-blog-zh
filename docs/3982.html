<html>
<head>
<title>Finding Outliers in SQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">查找SQL中的异常值</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/finding-outliers-in-sql-7de6296cc80c?source=collection_archive---------3-----------------------#2021-07-02">https://medium.com/nerd-for-tech/finding-outliers-in-sql-7de6296cc80c?source=collection_archive---------3-----------------------#2021-07-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a99b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">使用SQL Server使用中位数绝对偏差查找异常值</em></p><p id="267a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在现实世界的场景中，我们经常得到倾斜的数据分布。也就是说，大部分数据都集中在一个区域，剩下的几个数据点远离大部分数据。在统计学中，发现异常值的常用方法是计算标准差，并识别超过3个标准差的数据点。然而，如果数据分布是偏斜的，中位数是比平均值更好的集中趋势的度量，四分位间距是比标准差更好的分布度量。这是因为均值和标准差将考虑数据集中的所有数据点，包括异常值。</p><p id="ce49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将通过一个例子来看看如何使用中位数绝对偏差来发现异常值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/47a3b0cb2f4f361f095714f221b96845.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5iygpVkZ28vONFMNoADOrQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated"><a class="ae ju" href="https://www.cuemath.com/data/outlier/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="10e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">问题定义</strong></p><p id="8b16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">识别数据中的异常值</p><p id="3ca7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案</strong></p><p id="8a07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将“雇员”表中的时薪视为30、10、20、15、100</p><p id="0205" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">第一步:</em>计算薪水列的中位数</p><p id="14c5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(10，15，20，30，100)的中位数是20</p><p id="f1fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">第二步:</em>计算中间值和每个值的绝对差值</p><p id="2f90" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> abs(工资中位数)</strong> =10，5，0，10，80</p><p id="4f5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">第三步:</em>求绝对差的中值</p><p id="9954" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">中位数</strong> (0，5，10，10，80)为10，称为<strong class="ih hj">中位数绝对偏差(MAD) </strong></p><p id="2aea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">第四步:</em>求各数值的偏差与中位数偏差的<strong class="ih hj">比值</strong>。即<strong class="ih hj">ABS(salary-MAD)/MAD</strong>= ABS((10–10)/10，(15–10)/10，(20–10)/10，(30–10)/10，(100–10)/10))=(0，0.5，1，2，9)</p><p id="a2da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以清楚地注意到，100的工资与9的比率是一个异常值，是MAD的3倍以上。</p><p id="8d84" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面显示了在MS SQL Server中使用中位数绝对偏差来查找异常值的示例代码</p><pre class="jf jg jh ji fd jv jw jx jy aw jz bi"><span id="7106" class="ka kb hi jw b fi kc kd l ke kf">with median<br/>as<br/>(SELECT distinct PERCENTILE_CONT(0.5)within group(order by Salary)<br/>over() as median<br/>FROM Employees),</span><span id="a030" class="ka kb hi jw b fi kg kd l ke kf">Deviation<br/>as<br/>(SELECT abs(Salary-median)as Deviation<br/>FROM Employees <br/>JOIN median on 1=1)<br/>,<br/>MAD as<br/>(<br/>SELECT DISTINCT PERCENTILE_CONT(0.5) within group(order by deviation) over() as MAD<br/>FROM Deviation)</span><span id="0011" class="ka kb hi jw b fi kg kd l ke kf">SELECT abs(Salary -MAD)/MAD as Ratio, Salary<br/>FROM MAD <br/>JOIN Employees On 1=1</span></pre><p id="6c7d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">结论</strong></p><p id="f01d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们能够找到超出中位数3个绝对偏差的异常工资。即使数据不呈正态分布，这种方法也是解释异常值的有效方法。</p></div></div>    
</body>
</html>