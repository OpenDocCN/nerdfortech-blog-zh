<html>
<head>
<title>Integrate JWT in SpringBoot to realize Token verification (Integration)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在SpringBoot中集成JWT，实现令牌验证(集成)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/integrate-jwt-in-springboot-to-achieve-token-verification-integration-60b57b24db19?source=collection_archive---------8-----------------------#2021-04-26">https://medium.com/nerd-for-tech/integrate-jwt-in-springboot-to-achieve-token-verification-integration-60b57b24db19?source=collection_archive---------8-----------------------#2021-04-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="467d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JSON web token (JWT)是一个基于JSON的开放标准(RFC 7519)，实现该标准是为了在web应用程序环境之间传输声明。令牌被设计得紧凑而安全，特别适合于分布式站点上的单点。登录(SSO)场景。</p><p id="0397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JWT语句一般用于在身份提供者和服务提供者之间传递经过认证的用户身份信息，以便从资源服务器获取资源，并且还可以添加一些必要的附加业务逻辑，令牌也可以直接用于认证，或者可以加密。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3bc7fca01acd4c3212ddd4c40e733d5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pTqTepGSAillroCw2mwlUA.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">马克西米利安·魏斯贝克尔在<a class="ae jt" href="https://unsplash.com/s/photos/java?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h2 id="d34d" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">我们为什么需要JWT？</h2><p id="8ca9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">当我们开发一个前端和后端分离的项目时，我们需要对用户会话状态执行一个无状态的过程。然后我们知道普通的web项目经常被用来管理用户会话。每当用户向服务器进行身份验证时，服务器通常会使用会话。向用户发送sessionid。</p><p id="fab7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">会话存储在服务器上。服务器通过会话区分用户，并进行授权认证等一系列操作。每次请求后，sessionid将在响应头中返回给浏览器，浏览器将sessionid存储在cookie中。每个后续请求将在请求头中携带sessionid信息，并且服务器将在索引获取特定会话时使用该sessionid。</p><p id="e5dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么上面描述的场景就会有一个痛点。当我们把前后端分开的时候，我们的前端项目和后端项目是分开部署的，甚至用Nginx来代理转发，也就是说应用解耦后增加了前后端的分离。降低了部署的复杂性。</p><p id="b336" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通常，用户必须为一个请求转发多次。如果每次都使用会话将sessionid携带到服务器，服务器也会查询用户信息。同时如果有很多用户。这些信息存储在服务器的内存中，增加了服务器的负担。还有一种CSRF(跨站点请求伪造攻击)攻击。</p><p id="7d2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该会话基于用于用户识别的cookies。如果cookie被拦截，用户将容易受到跨站点请求伪造攻击。还有sessionid是特征值，表达的信息不够丰富。不容易扩展。如果您的后端应用程序是多节点部署。然后你需要实现一个会话共享机制。对于集群应用不太方便。</p><h2 id="df2a" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">JWT的应用场景</h2><p id="f079" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">JWT是上述痛点的解决方案之一。当客户端请求服务器登录时，服务器会验证用户的帐户和密码。验证成功后，生成令牌并将其返回给客户端。之后浏览器的每一次操作都会在头中用这个令牌请求，服务器会验证令牌信息，验证成功后会将资源返回给浏览器。</p><p id="f663" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">JWT的开销很小，可以很容易地在不同的域名中传输，因此在单点登录(SSO)中被广泛使用。信息交换是一种非常安全的方式，在通信双方之间使用JWT对数据进行编码。，因为它的信息是经过签名的，所以可以保证发送方发送的信息没有被伪造。</p><p id="291f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">整合JWT </strong></p><p id="7274" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">介绍JWT依赖关系</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="f854" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> JWT工具</strong></p><p id="3128" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">工具包括</strong>:创建令牌、验证令牌、获取用户id等。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="909c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我们可以看到，在创建令牌时使用了以下参数:</strong></p><ul class=""><li id="4ee0" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated"><strong class="ih hj">算法</strong> : HS256</li><li id="3a69" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj">类型</strong> : jwt</li><li id="9364" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj"> withAudience </strong>:向有效负载添加一个特定的受众(“aud”)语句，我们可以在其中放置一些用户信息，比如userid</li><li id="39d1" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj"> withClaim </strong>:添加一个自定义的声明值，我们用用户的账号和密码一起加密生成jwt</li><li id="c184" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj"> withExpiresAt </strong>:超时时间设置，超时后令牌无效</li><li id="4592" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj">withsissuedat</strong>:发布时间，一般设置为当前时间</li><li id="d1f0" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated"><strong class="ih hj">签名</strong>:签名，我们可以自定义签名和算法</li></ul><p id="3ab8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> JWT验证:</strong></p><ul class=""><li id="7b23" class="kw kx hi ih b ii ij im in iq ky iu kz iy la jc lb lc ld le bi translated">首先要先获取HttpServletRequest请求对象，工具类放在下面。</li><li id="5986" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">从请求头中获取令牌信息，根据密钥(授权)获取值。</li><li id="8665" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">然后用签名加密算法得到jwt的验证对象，用JWTVerifier.verify(token)验证令牌的正确性。</li><li id="f0d6" class="kw kx hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">我们还可以从通过验证获得的DecodedJWT对象中获取创建令牌时放入的信息，例如userid。</li></ul><p id="4a30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取HttpServletRequest对象工具类</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="72a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">自定义JSON对象工具类</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="0b0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在SpringBoot中集成了JWT来实现令牌验证</p></div></div>    
</body>
</html>