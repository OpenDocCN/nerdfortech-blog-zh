# 在 SpringBoot 中集成 JWT，实现令牌验证(集成)

> 原文：<https://medium.com/nerd-for-tech/integrate-jwt-in-springboot-to-achieve-token-verification-integration-60b57b24db19?source=collection_archive---------8----------------------->

JSON web token (JWT)是一个基于 JSON 的开放标准(RFC 7519)，实现该标准是为了在 web 应用程序环境之间传输声明。令牌被设计得紧凑而安全，特别适合于分布式站点上的单点。登录(SSO)场景。

JWT 语句一般用于在身份提供者和服务提供者之间传递经过认证的用户身份信息，以便从资源服务器获取资源，并且还可以添加一些必要的附加业务逻辑，令牌也可以直接用于认证，或者可以加密。

![](img/3bc7fca01acd4c3212ddd4c40e733d5c.png)

马克西米利安·魏斯贝克尔在 [Unsplash](https://unsplash.com/s/photos/java?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) 上的照片

## 我们为什么需要 JWT？

当我们开发一个前端和后端分离的项目时，我们需要对用户会话状态执行一个无状态的过程。然后我们知道普通的 web 项目经常被用来管理用户会话。每当用户向服务器进行身份验证时，服务器通常会使用会话。向用户发送 sessionid。

会话存储在服务器上。服务器通过会话区分用户，并进行授权认证等一系列操作。每次请求后，sessionid 将在响应头中返回给浏览器，浏览器将 sessionid 存储在 cookie 中。每个后续请求将在请求头中携带 sessionid 信息，并且服务器将在索引获取特定会话时使用该 sessionid。

那么上面描述的场景就会有一个痛点。当我们把前后端分开的时候，我们的前端项目和后端项目是分开部署的，甚至用 Nginx 来代理转发，也就是说应用解耦后增加了前后端的分离。降低了部署的复杂性。

通常，用户必须为一个请求转发多次。如果每次都使用会话将 sessionid 携带到服务器，服务器也会查询用户信息。同时如果有很多用户。这些信息存储在服务器的内存中，增加了服务器的负担。还有一种 CSRF(跨站点请求伪造攻击)攻击。

该会话基于用于用户识别的 cookies。如果 cookie 被拦截，用户将容易受到跨站点请求伪造攻击。还有 sessionid 是特征值，表达的信息不够丰富。不容易扩展。如果您的后端应用程序是多节点部署。然后你需要实现一个会话共享机制。对于集群应用不太方便。

## JWT 的应用场景

JWT 是上述痛点的解决方案之一。当客户端请求服务器登录时，服务器会验证用户的帐户和密码。验证成功后，生成令牌并将其返回给客户端。之后浏览器的每一次操作都会在头中用这个令牌请求，服务器会验证令牌信息，验证成功后会将资源返回给浏览器。

JWT 的开销很小，可以很容易地在不同的域名中传输，因此在单点登录(SSO)中被广泛使用。信息交换是一种非常安全的方式，在通信双方之间使用 JWT 对数据进行编码。，因为它的信息是经过签名的，所以可以保证发送方发送的信息没有被伪造。

**整合 JWT**

介绍 JWT 依赖关系

**JWT 工具**

**工具包括**:创建令牌、验证令牌、获取用户 id 等。

**我们可以看到，在创建令牌时使用了以下参数:**

*   **算法** : HS256
*   **类型** : jwt
*   **withAudience** :向有效负载添加一个特定的受众(“aud”)语句，我们可以在其中放置一些用户信息，比如 userid
*   **withClaim** :添加一个自定义的声明值，我们用用户的账号和密码一起加密生成 jwt
*   **withExpiresAt** :超时时间设置，超时后令牌无效
*   **withsissuedat**:发布时间，一般设置为当前时间
*   **签名**:签名，我们可以自定义签名和算法

**JWT 验证:**

*   首先要先获取 HttpServletRequest 请求对象，工具类放在下面。
*   从请求头中获取令牌信息，根据密钥(授权)获取值。
*   然后用签名加密算法得到 jwt 的验证对象，用 JWTVerifier.verify(token)验证令牌的正确性。
*   我们还可以从通过验证获得的 DecodedJWT 对象中获取创建令牌时放入的信息，例如 userid。

**获取 HttpServletRequest 对象工具类**

**自定义 JSON 对象工具类**

我们在 SpringBoot 中集成了 JWT 来实现令牌验证