<html>
<head>
<title>RSpec: Using Subject to Test Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">RSpec:使用主题测试模型</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/rspec-using-subject-to-test-models-92be4a093d7e?source=collection_archive---------5-----------------------#2021-07-26">https://medium.com/nerd-for-tech/rspec-using-subject-to-test-models-92be4a093d7e?source=collection_archive---------5-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/feebf09380700188fa167bdfdd87f9b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XO919YVgQ2UmquivvgCpjA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@_louisreed" rel="noopener ugc nofollow" target="_blank">路易斯·里德</a>经由<a class="ae iu" href="https://unsplash.com/photos/pwcKF7L4-no" rel="noopener ugc nofollow" target="_blank">unsplash.com</a>拍摄</figcaption></figure><p id="ef40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">过去几周我一直在做一个新项目，并决定学习如何使用 RSpec 并为我的 Rails 后端编写测试。事实证明，这比我想象的要容易得多，尤其是在我了解了 RSpec 的主题之后。</p><p id="0cec" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我写的第一个测试围绕着我在 Rails 中的模型。我想确认我写的关系和验证工作正常。现在我知道这不符合正常的红灯，绿灯，重构方法论，但这是我的第一次，所以我希望你能给我一个通行证。</p><p id="bf95" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我第一次尝试写测试时非常草率，一点也不枯燥。我为每个测试创建单独的变量，因此每个测试重复四到五行代码。真是一团糟。当我去重构这些测试时，我发现了 RSpec 提供的主题。</p><p id="9b82" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">希望这篇文章能帮助你了解更多关于 RSpec 的知识，并使你能像我一样编写更干燥的测试。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="e196" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我从一个名为<a class="ae iu" href="https://relishapp.com/rspec/" rel="noopener ugc nofollow" target="_blank"> RelishApp </a>的网站上发现了 Subject 关键字，这个网站上有很多关于 RSpec 的有用资料。根据这个网站:</p><blockquote class="ka kb kc"><p id="f440" class="iv iw kd ix b iy iz ja jb jc jd je jf ke jh ji jj kf jl jm jn kg jp jq jr js hb bi translated">如果一个示例组的第一个参数是一个类，那么这个<br/>类的一个实例通过<code class="du kh ki kj kk b">subject</code> <br/>方法暴露给这个示例组中的每个示例。— RelishApp</p></blockquote><p id="35de" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在 Rails 中测试我们的模型时，我们实际上是在测试一个 Ruby 类，这意味着我们可以访问这个类的一个实例。现在 RSpec 将隐式地给我们这个类的一个实例，但是如果我们想要操作那个实例呢？</p><p id="61af" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以显式地定义该实例看起来像什么，这允许我们通过 ActiveRecord 利用关系。看看下面的例子。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/a798f7e13ba8598dc19ba1acc63b11e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uHdmjJsD4-yp6BY7xLkKjQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">显示主题关键字使用的简单示例。</figcaption></figure><p id="54c4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如您所见，我们可以使用 subject 关键字定义 subject，并使用<code class="du kh ki kj kk b">described_class.new</code>方法创建一个新实例，类似于我们使用类名创建一个新实例的方式。<code class="du kh ki kj kk b">described_class</code>在这个例子中引用了 Family 类。我们在这里所做的就是让我们编写的每个测试访问一个名为 Polcari 的家族实例。</p><p id="6591" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是一个非常简单的例子，没有任何关系。让我们来看一个具有多个关系的更复杂的实例。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kq"><img src="../Images/f32f126d3895b81a8f5ea3f41b8deaec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5i2DkGL9wjxtmGs8yFIDDw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">使用 Subject 关键字显示 ActiveRecord 关系的示例。</figcaption></figure><p id="2428" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个例子中，我们创建了几个不同类的实例，作为我们的主题实例将依赖的变量。这样，我们可以在我们的主题实例中引用它们各自的 id。</p><p id="7d88" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我想指出的另一点是，以一种有效的方式创建你的主题是非常有帮助的。这使得编写隔离缺失变量的单独测试变得容易得多。</p><p id="ba35" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们不是为每个测试创建一个新的实例并忽略一个变量，而是创建一个有效的主题，然后在运行测试之前更改我们想要隔离的一个参数。请看从第 17 行开始的测试。</p><p id="0d89" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们在模型中的验证要求描述参数存在。既然我们有一个有效的 subject 实例，我们所要做的就是将描述重新分配给一个无效的输入，比如 nil，然后我们就可以测试我们的验证是否正常工作。</p><figure class="km kn ko kp fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kr"><img src="../Images/74c358fa51d9d97d3de7581bb152531e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xQ_PhAITl2YP2vjN18mKWw.jpeg"/></div></div></figure><p id="33a0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是因为每个测试都会接收到一个与 subject 关键字定义的主题相匹配的新实例。正如您所看到的，使用这种方法会产生非常枯燥的测试，可以用来准确、轻松地测试我们所有的验证。</p><p id="1282" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果你有任何其他使用 RSpec 编写测试的酷技巧，我很乐意在下面的评论中听到。</p></div></div>    
</body>
</html>