# 您想知道，您应该将您的应用程序秘密存储在哪里？

> 原文：<https://medium.com/nerd-for-tech/where-should-you-store-your-application-secrets-you-wonder-4c2b1219773f?source=collection_archive---------0----------------------->

源代码控制、CI/CD 工具和云提供商存储应用程序机密的比较。

![](img/43bb47ccb88a0a11588db46e17dcb9fa.png)

您应该在哪里存储您的应用程序机密

如果您告诉我您的 web 应用程序是真正独立的，我会感到非常惊讶。没有集成就无法想象 Web 应用程序，每个应用程序都需要连接到对等的微服务、外部服务、数据库、文件存储等等。这使我们需要维护秘密(密码/API 密钥/授权令牌/证书/..)连接到这些服务，对于不同的应用程序环境，这些服务在大多数情况下是不同的。

毫无疑问，任何应用程序使用的敏感数据都必须外部化，而不能直接在代码中使用。开发人员通常倾向于将秘密直接放在代码中，或者将他们的。环境或。属性或配置文件添加到源代码管理。这是一种非常不好的做法，必须不惜一切代价避免。秘密应该在构建或部署步骤期间或者在代码运行时获取。

有很多方法可以管理你的秘密。您可以将秘密存储在您的源代码控制中(GitHub/Bitbucket/GitLab/..)、CI/CD 工具(GitHub Actions/circle CI/Jenkins/..)或者云(AWS 秘密管理器/Azure Key Vault/GCP 秘密管理器/..).你甚至可以选择像 HashiCorp Vault 这样的第三方密钥库，但我不会讨论它们。让我们分析一下在不同场景下，在上述选项中存储秘密的利弊。
*注意:*你可以使用你的源代码控制本身的 CI/CD 特性，比如 GitHub Actions/bit bucket Pipelines/git lab Pipelines/..在这种情况下，您的源代码管理和 CI/CD 工具应该是相同的。

# 运行时秘密

有些秘密本质上是不稳定的，可能会不断更新，比如一些访问令牌。这些秘密不能在构建或部署期间只被读取一次，而是需要在运行时被访问。这个场景让云提供商比源代码控制和 CI/CD 工具更有优势。服务可以在运行时更新它们的云秘密，供其他服务使用。

# 易接近

将秘密存储在云中无疑也在可访问性方面占尽优势。无论是在运行时还是在构建期间访问机密，云中的机密相对更容易访问。服务应该可以直接从云中重启，而不需要依赖 CI/CD 或源代码控制来获取秘密。

# 构建一次，随处运行

如果您希望您的构建是自给自足的，并且可以在任何地方运行，那么将您的秘密保存在源代码控制或 CI/CD 工具中将是一个不错的选择。这样，您就可以用提供的所有秘密创建您的构建，并将它们部署到任何地方。这对于多云基础设施来说也是非常理想的。

# Devops

在存储库和 CI/CD 管道中存储和管理机密可能很麻烦。存储库和管道不断增加，管理它们的特定秘密不是一件容易的事情。在云中维护它们会更加简单和容易。您可以创建特定于环境的秘密管理器，每个管理器都有自己的所有应用程序的秘密副本。

# 存储云凭据

老实说，把你的云证书存储在云服务中有什么用呢(:D)。要将您的构建部署到云中，您需要将您的云凭证存储在源代码控制或 CI/CD 工具中。CI/CD 将再次成为两者中的首选，因为将部署环境细节从源代码控制中分离出来并使它们更接近 CI/CD 管道是一个很好的实践。

# 特定于环境的秘密

对于不同的环境，您的大多数应用程序秘密都是不同的，最好将它们保存在云中。您可以在云中拥有特定于环境的秘密管理器，您的 CI/CD 工具甚至不需要以不同的方式处理不同的环境。它需要做的就是指定环境并加载相应的云凭证。在源代码控制或 CI/CD 中配置这些秘密需要您在构建-部署管道中单独处理它们。建立新的环境也不容易。

如您所见，secret manager 的选择取决于您的用例。但是，在大多数情况下，这将是所有选项的组合。例如，您可以在源代码控制中存储通用常量，在 CI/CD 工具中存储云凭证，在云中存储特定于运行时/环境的秘密。