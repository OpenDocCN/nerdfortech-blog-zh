<html>
<head>
<title>Experiment Go webapp with cassandra db on Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Docker 上的 cassandra db 体验 Go webapp</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/experiment-go-webapp-with-cassandra-db-on-docker-f3b12226b609?source=collection_archive---------9-----------------------#2021-05-07">https://medium.com/nerd-for-tech/experiment-go-webapp-with-cassandra-db-on-docker-f3b12226b609?source=collection_archive---------9-----------------------#2021-05-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class="ev ex if ig ih ab cb"><figure class="ii ij ik il im in io paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><img src="../Images/90197044a7a544fb503119c993ee4c5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:678/format:webp/1*2ntsTufRTwJ74PI0COs1Ow.png"/></div></figure><figure class="ii ij iv il im in io paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><img src="../Images/f55c9fd98b4b82c52c791f31d2ce34a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*7eqexcCbZTVgi86AITOlHg.png"/></div></figure></div><p id="6b60" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">我有一个 SQL 数据库的 Go webapp 以前的职位。在我的职业生涯中，到目前为止，我一直在使用 SQL 数据库进行大部分持久存储。我在 NoSQL 的唯一经历是严重依赖 redis，过于注重缓存的使用而不是存储。我有一点使用 MongoDB 的经验，但是用例主要用于审计，而不是实际的业务数据。</p><p id="5305" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">因此，作为个人项目的一部分，我最近试着摆弄了一下<strong class="iy hj"> Cassandra </strong>数据库。由于 Docker 在设置和形成多节点<strong class="iy hj"> NoSQL </strong>设置方面提供的便利，体验相当不错。让我们开始…</p><p id="f892" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">PS:我假设你的系统里安装了 docker。我假设您了解 Go 和 Cassandra 知识以及基于 docker 的部署。对于一些基础知识，请参考一些早期的职位。我指的是我的个人项目的 github 链接如下</p><div class="ju jv ez fb jw jx"><a href="https://github.com/prateekgupta3991/gnews-service" rel="noopener  ugc nofollow" target="_blank"><div class="jy ab dw"><div class="jz ab ka cl cj kb"><h2 class="bd hj fi z dy kc ea eb kd ed ef hh bi translated">prateekgupta 3991/gnews-服务</h2><div class="ke l"><h3 class="bd b fi z dy kc ea eb kd ed ef dx translated">Go 中的简单新闻服务。与谷歌新闻 api 集成-https://newsapi.org/使用卡珊德拉作为存储层和…</h3></div><div class="kf l"><p class="bd b fp z dy kc ea eb kd ed ef dx translated">github.com</p></div></div><div class="kg l"><div class="kh l ki kj kk kg kl it jx"/></div></div></a></div><h1 id="95af" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">设置 cassandra 节点</h1><p id="edca" class="pw-post-body-paragraph iw ix hi iy b iz lk jb jc jd ll jf jg jh lm jj jk jl ln jn jo jp lo jr js jt hb bi translated">按照上面提到的步骤让 cassandra 出现在 docker 上:</p><blockquote class="lp lq lr"><p id="ab5b" class="iw ix ls iy b iz ja jb jc jd je jf jg lt ji jj jk lu jm jn jo lv jq jr js jt hb bi translated">创建一个节点-暴露在端口 9042 <br/>上&gt;docker run-p 9042:9042-name my-Cassandra-1-m 1g-d Cassandra:3.11</p><p id="774d" class="iw ix ls iy b iz ja jb jc jd je jf jg lt ji jj jk lu jm jn jo lv jq jr js jt hb bi translated">检查已创建实例的 IP<br/>&gt;docker inspect—format = ' { { . network settings . IP address } } ' my-Cassandra-1</p><p id="cd70" class="iw ix ls iy b iz ja jb jc jd je jf jg lt ji jj jk lu jm jn jo lv jq jr js jt hb bi translated">创建另一个节点并链接到 prev 节点—在端口 9043 <br/> &gt;上公开 docker run—name my-CASSANDRA-2-m 2g-d-e CASSANDRA _ SEEDS = " $(docker inspect—format = ' { { . network settings . IP address } } ' my-CASSANDRA-1)" CASSANDRA:3.11</p><p id="f7e8" class="iw ix ls iy b iz ja jb jc jd je jf jg lt ji jj jk lu jm jn jo lv jq jr js jt hb bi translated">通过 cqlsh 客户端使用 cassandra(替换 IP)<br/>&gt;docker run-it—link my-Cassandra-1—RM Cassandra:3.11 bash-c ' exec cqlsh&lt;&lt;IP&gt;&gt;'</p><p id="8237" class="iw ix ls iy b iz ja jb jc jd je jf jg lt ji jj jk lu jm jn jo lv jq jr js jt hb bi translated">检查 cassandra 节点状态<br/>&gt;docker exec-I-t my-Cassandra-1 bash-c‘节点工具状态’</p></blockquote><p id="171b" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">希望现在，你的卡珊德拉已经开始运行了。现在继续创建一个键空间/表。获取您创建的节点的 ip，因为这将在您的 go 应用程序中用于连接。</p><h1 id="785b" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">转到后端</h1><p id="081c" class="pw-post-body-paragraph iw ix hi iy b iz lk jb jc jd ll jf jg jh lm jj jk jl ln jn jo jp lo jr js jt hb bi translated">我假设你已经有了一个基本的 go 后端。你可以参考上面的 github 链接来看看样例应用程序。<br/>要从你的 go 应用程序连接到 cassandra，你需要使用库 gocql。<br/>创建 gocql。将在您的存储库层中用于查询数据库的会话。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="c222" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">这将初始化会话。下一步是创建将拥有数据库会话的结构。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="2e23" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">服务层将通过调用<strong class="iy hj"> GetNewDbSession() </strong>创建数据库会话，然后可以在服务调用中使用。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="050e" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">我添加了 repo 链接和代码片段以供参考。希望有帮助。我的服务基于 http over json，并使用 gin-gonic 作为 REST 框架。</p><h1 id="d7a8" class="km kn hi bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">构建和部署- Docker</h1><p id="4e6d" class="pw-post-body-paragraph iw ix hi iy b iz lk jb jc jd ll jf jg jh lm jj jk jl ln jn jo jp lo jr js jt hb bi translated">对于构建和部署步骤，我已经创建了一个基于 docker 的设置。我使用了 docker 缩微图像作为一种机制。我花了一段时间和多个学习视频和博客来构建最终的 docker 文件。没有保存 docker 文件的多次迭代。在这里附上相同的。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="6da8" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">这很容易构建包含 Go 应用程序二进制文件和 docker-compose 文件的 docker 映像，以便启动后端。<br/> PS:我假设你了解 docker 以及 docker 部署的相关文件和步骤。我把回购的自述文件里的东西都加了，供参考。</p></div><div class="ab cl mc md gp me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hb hc hd he hf"><p id="9df8" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">我就这样结束了这篇文章。我试图记录我在用 Cassandra 作为数据库构建 Go 应用后端的过程中所做的一切。如果你在帖子中发现不一致的地方，或者如果帖子对你有帮助，请在评论中告诉我。</p><p id="16ed" class="pw-post-body-paragraph iw ix hi iy b iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt hb bi translated">在那之前，继续试验，继续编码。</p></div></div>    
</body>
</html>