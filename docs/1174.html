<html>
<head>
<title>Angular 11: PART 2 Insert external HTML in your own website — Web scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular 11:第2部分在自己的网站中插入外部HTML网络抓取</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/angular-11-part-2-insert-external-html-in-your-own-website-web-scraping-acbf73d51fda?source=collection_archive---------15-----------------------#2021-03-07">https://medium.com/nerd-for-tech/angular-11-part-2-insert-external-html-in-your-own-website-web-scraping-acbf73d51fda?source=collection_archive---------15-----------------------#2021-03-07</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2a0f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一部分中，我向你展示了我是如何在我的网站上将一个网页从一个外部源移动到一个本地模态的(你没有阅读它😳头那边马上<a class="ae jd" href="https://johanfaerch.medium.com/angular-11-insert-external-html-in-your-own-website-web-scraping-ff78f2540c4b" rel="noopener"> Part 1 </a>)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/9db1181d3cd561836c63ed45e1063c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uli164q2r2fTWyXUlFR7QQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">伊恩·施耐德在<a class="ae jd" href="https://unsplash.com/s/photos/web-modal?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="9bbe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你看了吗？好吧，我们可以继续了🤓</p><p id="add8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一次，我将扩展原来的解决方案，进一步操纵HTML和错误处理。</p><p id="ce4e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我收集了外部web页面的HTML字符串之后，我发现与web站点的其他部分相比，有些样式已经过时了。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="efdb" class="jz ka hi jv b fi kb kc l kd ke">...<br/>const originText = await response.text();</span></pre><p id="f7aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">包含我们可以操作的字符串形式的HTML。我们当然可以根据外部HTML的元素和现有类添加一些样式，但在这种情况下，我更喜欢改变HTML字符串。</p><p id="5a8e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，段落是用p标签包装的，我想把它换成span标签，因为这是我在我的网页上其他地方使用的。为此，我使用带有regex的字符串“replace()”方法在同一个方法中执行多次替换，即p -&gt; span。这并没有削减它，因为这将取代文本中的任何“p”。相反我们这样替换:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="a395" class="jz ka hi jv b fi kb kc l kd ke">const text1 = originText.replace(/&lt;p|&lt;\/p&gt;/gi, (x) =&gt; {<br/>  if (x === '&lt;p') {<br/>    return x = '&lt;span';<br/>  } else if (x === '&lt;/p&gt;') {<br/>     return x = '&lt;/span&gt;';<br/>  }<br/>});</span></pre><p id="69c7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这应该可以解决段落问题。此外，没有header标记，所以我将整个“header”替换为具有相同内容的h1标记:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="4db8" class="jz ka hi jv b fi kb kc l kd ke">const text = text1.replace('&lt;span&gt;Nutzungsbedingungen&lt;/span&gt;', '&lt;h1&gt;Nutzungsbedingungen&lt;/h1&gt;');</span></pre><p id="ad37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">页脚变得很奇怪，因为它有来自不再需要的外部站点的支持信息。页面的最后一部分看起来像这样:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5ff5" class="jz ka hi jv b fi kb kc l kd ke">...<br/>&lt;span&gt;Yadayada&lt;/span&gt;</span><span id="2965" class="jz ka hi jv b fi kf kc l kd ke">&lt;hr&gt;</span><span id="ca6f" class="jz ka hi jv b fi kf kc l kd ke">&lt;span class="text-center"&gt;&lt;strong&gt;Contact Yada Support&lt;/strong&gt;<br/>&lt;br&gt;Need help?&lt;/span&gt;<br/>&lt;span class="text-center"&gt;&lt;a class="btn btn-primary" href="<a class="ae jd" href="mailto:unzerdirect@unzer.com" rel="noopener ugc nofollow" target="_blank">yada@yada.com</a>" role="button"&gt;&lt;i class="fa fa-envelope-o"&gt;&lt;/i&gt; <a class="ae jd" href="mailto:unzerdirect@unzer.com" rel="noopener ugc nofollow" target="_blank">yada@yada.com</a>&lt;/a&gt;&lt;/span&gt;</span></pre><p id="ac37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以我认为这将是更容易做的HTML操作，所以p的替换为span的，我回到了HTML</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="18c0" class="jz ka hi jv b fi kb kc l kd ke">const terms = parse(text);<br/>const htmlTerms1 = terms?.querySelector('#sidebar')?.nextElementSibling;</span></pre><p id="deb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并删除了hr标签后的两个兄弟</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5d94" class="jz ka hi jv b fi kb kc l kd ke">htmlTerms1?.querySelector('hr')?.nextElementSibling?.remove();<br/>htmlTerms1?.querySelector('hr')?.nextElementSibling?.remove();<br/>this.htmlTerms = htmlTerms1?.innerHTML;</span></pre><p id="5ec9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于这个结果:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="9783" class="jz ka hi jv b fi kb kc l kd ke">...<br/>&lt;span&gt;Yadayada&lt;/span&gt;</span><span id="7b6b" class="jz ka hi jv b fi kf kc l kd ke">&lt;hr&gt;</span></pre><p id="7ff8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以现在我有了我想要的标题和段落格式，并且我已经移除了页脚。下面是属性“htmlTerms”中的抓取、格式化和最终HTML代码:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="0250" class="jz ka hi jv b fi kb kc l kd ke">(async () =&gt; {<br/>  const response = await fetch('<a class="ae jd" href="https://www.unzerdirect.com/terms/'" rel="noopener ugc nofollow" target="_blank">https://your/external/terms/'</a>);<br/>  const originText = await response.text();<br/>  const text1 = originText.replace(/&lt;p|&lt;\/p&gt;/gi, (x) =&gt; {<br/>    if (x === '&lt;p') {<br/>      return x = '&lt;span';<br/>    } else if (x === '&lt;/p&gt;') {<br/>      return x = '&lt;/span&gt;';<br/>    }<br/>  });<br/>  const text = text1.replace('&lt;span&gt;Nutzungsbedingungen&lt;/span&gt;', '&lt;h1&gt;Nutzungsbedingungen&lt;/h1&gt;');<br/>  const terms = parse(text);<br/>  const htmlTerms1 = terms?.querySelector('#sidebar')?.nextElementSibling;<br/>  htmlTerms1?.querySelector('hr')?.nextElementSibling?.remove();<br/>  htmlTerms1?.querySelector('hr')?.nextElementSibling?.remove();<br/>  this.htmlTerms = htmlTerms1?.innerHTML;<br/>})();</span></pre><p id="5c8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意可选的链接？这是避免在我向用户交付模型的过程中出现问题时破坏一切的类型脚本部分。但是如果能处理这样的错误就更好了，所以我想我会采用模态…</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6b43" class="jz ka hi jv b fi kb kc l kd ke">openTerms() {<br/>  if (this.htmlTerms) { // Only needed for the error handling<br/>    this.dialogService.confirm(<br/>      '',<br/>      this.htmlTerms,<br/>      this.translate.instant('Accept'),<br/>      this.translate.instant('Cancel')<br/>    )<br/>    .afterClosed()<br/>    .subscribe((confirmed: boolean) =&gt; {<br/>      if (confirmed) {<br/>        this.accept = true;<br/>      }<br/>    });<br/>  } // end of if<br/>}</span></pre><p id="25f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">…并添加一个else子句，至少给用户一些半有用的信息…</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="2fbe" class="jz ka hi jv b fi kb kc l kd ke">...<br/>  } else {<br/>    this.dialogService.alert(<br/>      `Sorry, we could not get the Terms at this point`,<br/>      `Please go to <a class="ae jd" href="https://www.unzerdirect.com/terms/" rel="noopener ugc nofollow" target="_blank">https://your/external/terms/</a> (copy the URL and paste it in a new tab)`,<br/>      'warning_amber'<br/>    );<br/>  }<br/>}</span></pre><p id="9e32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这只是一个带有URL的警告，以防出现未定义的术语。</p><p id="9360" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这能给你自己的项目提供一些思路。</p><p id="cbff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">快乐编码🤗</p></div></div>    
</body>
</html>