<html>
<head>
<title>Handle Sessions and Engagements in the Google Analytics 4 (GA4) data in a correct way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以正确的方式处理 Google Analytics 4 (GA4)数据中的会话和约定</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/handle-sessions-and-engagements-in-the-google-analytics-4-ga4-data-in-a-correct-way-d55cc988efee?source=collection_archive---------0-----------------------#2022-11-17">https://medium.com/nerd-for-tech/handle-sessions-and-engagements-in-the-google-analytics-4-ga4-data-in-a-correct-way-d55cc988efee?source=collection_archive---------0-----------------------#2022-11-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2cae" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">在 BigQuery 中使用 GA4 原始数据。由萨努·马哈尔詹</h2></div><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es iy"><img src="../Images/ec0ec8f566694cd2f1a20dabc6594281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*7eQqVk2VJdCjjQZp.png"/></div><figcaption class="jg jh et er es ji jj bd b be z dx translated">由<a class="ae ix" href="https://unsplash.com/@lucabravo" rel="noopener ugc nofollow" target="_blank">卢卡·布拉沃</a>在<a class="ae ix" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="3b02" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">当你使用 GA4 来跟踪你的网站或应用程序时，查看会话和参与度可能会非常有见地。没有任何延迟，首先，让我们看看会话和参与在 GA4 中是如何定义的，然后我们如何将它们提取到 Bigquery 中。</p><h1 id="2c2d" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">会议</h1><p id="7360" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">当满足以下条件之一时，将触发会话:</p><ul class=""><li id="7bd0" class="ld le hi jm b jn jo jq jr jt lf jx lg kb lh kf li lj lk ll bi translated">用户打开您的网站或应用程序</li><li id="af39" class="ld le hi jm b jn lm jq ln jt lo jx lp kb lq kf li lj lk ll bi translated">用户查看页面或屏幕(假设没有其他会话处于活动状态)</li></ul><p id="b3b4" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">注意:一次会议通常持续 30 分钟。也就是说，当用户访问你的网站，31 分钟后又回来时，新的会话就开始了。</p><p id="d28f" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">会话有助于了解有多少用户访问你的平台，但更有趣的是了解他们中有多少人有某种“参与”。然后我们来看看谷歌是如何定义敬业度的。</p><h1 id="3382" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">参与会议</h1><p id="1cb2" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">在 GA4 中，如果满足以下条件，则会话被视为正在进行:</p><ul class=""><li id="566f" class="ld le hi jm b jn jo jq jr jt lf jx lg kb lh kf li lj lk ll bi translated">有 2 个或更多的页面浏览量或</li><li id="e1c9" class="ld le hi jm b jn lm jq ln jt lo jx lp kb lq kf li lj lk ll bi translated">有一个或多个转换事件，或者</li><li id="2041" class="ld le hi jm b jn lm jq ln jt lo jx lp kb lq kf li lj lk ll bi translated">用户持续超过 10 秒钟</li></ul><p id="17b8" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">注意:如果您认为 10 秒对于一个忙碌的会话来说太短，那么您可以在您的 GA 帐户中手动更改时间，最长可达 60 秒。</p><p id="e79c" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">现在的问题是，如何提取会话和参与会话的数据？如果你看原始的 GA4 数据，没有直接的答案。因此，诀窍是通过执行以下查询来计算 ga_session_id 和 user_pseudo_id:</p><p id="f5e3" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated"><a class="ae ix" href="https://gist.github.com/sigmaError/bc8d4d5728480fe7195b690ebf8d58f1" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/sigma error/BC 8d 4d 5728480 Fe 7195 b 690 ebf 8d 58 f 1</a></p><figure class="iz ja jb jc fd jd"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="iz ja jb jc fd jd er es paragraph-image"><div class="er es iy"><img src="../Images/6fbf31c23509284c5d8e2fd081605b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*2nrj68d8DZD8fiIB.png"/></div></figure><p id="1eee" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">简单解释一下幕后发生的事情:首先，我创建了一个名为 prep 的子查询(与准备中一样)。在准备子查询中，我选择了已解析的事件日期和 user_pseudo_id。</p><p id="3e15" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">接下来，我取消了 event_params 数组的嵌套，只选择那些 key = 'ga_session_id '的值。这些值以“int_value”存储，这意味着它们是 INT64 数据类型。这里，ga_session_id 是用户进入你的平台时的时间戳。我们不能简单地计算 ga_session_id，称它们为会话数，原因是，如果两个用户同时进入您的平台，他们将拥有相同的 ga_session_id。</p><p id="cffe" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">然后对于 session_id，我首先 UNNEST event_params 并提取 key = 'ga_session_id '的整数值，然后连接 user_pseudo_id 和 ga_session_id。通过这样做，即使在多个用户同时进入平台的情况下，他们也会有不同的 session_id。</p><p id="69df" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">类似地，对于 engaged_session 和 engagement_time_msec，我已经取消了 event_params 列的嵌套，然后只选择那些键，它们分别是‘session _ engaged’和‘engagement _ time _ msec’。还要注意，session_engaged 的值是字符串，而 engagement_time_msec 的值是整数，并且以微秒为单位。</p><p id="6a33" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">最后，我按 event_date 分组，然后计算会话数的不同 session_id，当有一个参与会话时，我再次计算 session_id，并以微秒为单位计算平均参与时间。</p><h1 id="1dc2" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">结论</h1><p id="fd99" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">通过这样的查询，可以获得关于触发了多少个会话、参与了多少个会话以及参与的平均时间的信息。在接下来的文章中，我将写下更多关于如何从原始 GA4 中提取数据的问题。</p><h1 id="cc9b" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">本月即将发布的 datadice 博客文章</h1><ul class=""><li id="a6d2" class="ld le hi jm b jn ky jq kz jt lt jx lu kb lv kf li lj lk ll bi translated"><a class="ae ix" rel="noopener" href="/geekculture/latest-updates-on-google-data-analytics-november-2022-48f32c9ce40a?source=your_stories_page-------------------------------------">谷歌数据分析的最新更新(2022 年 11 月)</a></li><li id="bafe" class="ld le hi jm b jn lm jq ln jt lo jx lp kb lq kf li lj lk ll bi translated"><a class="ae ix" rel="noopener" href="/nerd-for-tech/rawgraphs-a-free-and-open-source-tool-for-data-visualization-b79e337d750a?source=your_stories_page-------------------------------------"> RAWGraphs:一个免费的开源数据可视化工具</a></li></ul><h1 id="1b15" class="kg kh hi bd ki kj kk kl km kn ko kp kq io kr ip ks ir kt is ku iu kv iv kw kx bi translated">更多链接</h1><p id="831d" class="pw-post-body-paragraph jk jl hi jm b jn ky ij jp jq kz im js jt la jv jw jx lb jz ka kb lc kd ke kf hb bi translated">这篇文章是从 BQ 的 GA4 原始数据中获得洞察力的系列文章的一部分。</p><p id="1a85" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">查看我们的<a class="ae ix" href="https://www.linkedin.com/company/datadice?original_referer=https%3A%2F%2Fwww.linkedin.com%2F" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>账户，深入了解我们的日常工作生活，并获得关于 BigQuery、Data Studio 和营销分析的重要更新。</p><p id="3262" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">我们也从我们自己的 YouTube 频道开始。我们讨论了重要的 DWH、BigQuery、Data Studio 和许多其他主题。点击查看频道<a class="ae ix" href="https://www.youtube.com/channel/UCpyCm0Pb2fqu5XnaiflrWDg" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="6d18" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">如果你想了解更多关于如何使用 Google Data Studio 并结合 BigQuery 更上一层楼，请查看我们的 Udemy 课程<a class="ae ix" href="https://www.udemy.com/course/bigquery-data-studio-grundlagen/" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="326c" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated">如果您正在寻求帮助，以建立一个现代化的、经济高效的数据仓库或分析仪表板，请发送电子邮件至 hello@datadice.io，我们将安排一次通话。</p></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="e028" class="pw-post-body-paragraph jk jl hi jm b jn jo ij jp jq jr im js jt ju jv jw jx jy jz ka kb kc kd ke kf hb bi translated"><em class="md">最初发布于</em><a class="ae ix" href="https://www.datadice.io/sessions-and-engagement-in-ga4-data" rel="noopener ugc nofollow" target="_blank"><em class="md">https://www . data dice . io</em></a><em class="md">。</em></p></div></div>    
</body>
</html>