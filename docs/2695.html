<html>
<head>
<title>Asynchronous programming in NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NodeJS异步编程</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/asynchronous-programming-in-nodejs-a4c1d56d1176?source=collection_archive---------22-----------------------#2021-05-16">https://medium.com/nerd-for-tech/asynchronous-programming-in-nodejs-a4c1d56d1176?source=collection_archive---------22-----------------------#2021-05-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/f92f215fcd0313b28531f404f4d6389d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YewXGCTLtNjEArBA"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">照片由<a class="ae iu" href="https://unsplash.com/@ffstop?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Fotis Fotopoulos </a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="cd6a" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">编写异步代码的不同解决方案</h2><p id="2611" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">在NodeJS中，异步代码主要可以用三种方式编写:</p><ol class=""><li id="8a26" class="ko kp hi jv b jw kq ka kr jg ks jk kt jo ku kn kv kw kx ky bi translated">使用回调</li><li id="2c9d" class="ko kp hi jv b jw kz ka la jg lb jk lc jo ld kn kv kw kx ky bi translated">利用承诺</li><li id="1224" class="ko kp hi jv b jw kz ka la jg lb jk lc jo ld kn kv kw kx ky bi translated">使用异步/等待</li></ol></div><div class="ab cl le lf gp lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="hb hc hd he hf"><h2 id="2ceb" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">复试</h2><p id="a273" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">回调是传递给一个函数的函数，这个函数需要时间来执行。这些回调函数只在它被传递到的函数执行之后才被执行。回调也必须等待所有同步代码被执行。直到它在回调队列中等待。</p><p id="97db" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">例如定时器、API调用等。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="3a04" class="iv iw hi lt b fi lx ly l lz ma">// will be printed after two seconds<br/>const afterTwo = () =&gt; {</span><span id="91f2" class="iv iw hi lt b fi mb ly l lz ma">  console.log("Printed after two seconds");</span><span id="8623" class="iv iw hi lt b fi mb ly l lz ma">};<br/></span><span id="f23b" class="iv iw hi lt b fi mb ly l lz ma">// passing "afterTwo" as a callback function<br/>setTimeout(afterTwo, 2000);</span><span id="47ee" class="iv iw hi lt b fi mb ly l lz ma">// passed an anonymous function as a callback on request<br/>const req = https.request(options, (res) =&gt; {</span><span id="c26e" class="iv iw hi lt b fi mb ly l lz ma">  res.on("data", (data) =&gt; {</span><span id="e40b" class="iv iw hi lt b fi mb ly l lz ma">  console.log(data);</span><span id="5618" class="iv iw hi lt b fi mb ly l lz ma">  });</span><span id="f8de" class="iv iw hi lt b fi mb ly l lz ma">});</span><span id="5499" class="iv iw hi lt b fi mb ly l lz ma">req.end();</span></pre></div><div class="ab cl le lf gp lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="hb hc hd he hf"><h2 id="4115" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">承诺</h2><p id="051c" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">ES6中引入了处理异步代码的承诺。每当请求或函数调用返回一个承诺时，必须使用接受函数作为参数的“then”关键字进行解析。该功能仅在承诺返回后执行。执行不会等待调用函数之外的其他代码被执行。</p><p id="355e" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">为优先级高于回调队列的承诺引入了一个特殊的作业队列。</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="8b1d" class="iv iw hi lt b fi lx ly l lz ma">// a function that mocks api call and returns a promise<br/>const fecthData = () =&gt; {</span><span id="e6a7" class="iv iw hi lt b fi mb ly l lz ma">  return new Promise((resolve, reject) =&gt; {<br/>    <br/>    setTimeout(() =&gt; resolve("data fetched"), 3000);</span><span id="8cff" class="iv iw hi lt b fi mb ly l lz ma">  });</span><span id="a665" class="iv iw hi lt b fi mb ly l lz ma">};</span><span id="9c12" class="iv iw hi lt b fi mb ly l lz ma">// resolving the promise after it is received</span><span id="bf01" class="iv iw hi lt b fi mb ly l lz ma">fecthData().then((data) =&gt; {</span><span id="7e3a" class="iv iw hi lt b fi mb ly l lz ma">  // logs "data fetched"<br/>  console.log(data);</span><span id="bd13" class="iv iw hi lt b fi mb ly l lz ma">}).catch((err) =&gt; {</span><span id="92f9" class="iv iw hi lt b fi mb ly l lz ma">  console.log(err);</span><span id="9fbe" class="iv iw hi lt b fi mb ly l lz ma">});</span></pre></div><div class="ab cl le lf gp lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="hb hc hd he hf"><h2 id="8b95" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">异步等待</h2><p id="8aa0" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd jg ke kf kg jk kh ki kj jo kk kl km kn hb bi translated">关键字async-await是在ES8中引入的。使用这种语法，可以用看起来像同步的代码来编写异步代码。这个特性的工作原理与承诺完全一样，并且是建立在承诺之上的。async-await的语法很有意义，感觉很容易使用。请注意，在“async”函数之外使用“await”将会引发错误。</p><p id="ea0d" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">例如，上面的代码可以写成:</p><pre class="lo lp lq lr fd ls lt lu lv aw lw bi"><span id="6af8" class="iv iw hi lt b fi lx ly l lz ma">const fetchData = () =&gt; {</span><span id="1237" class="iv iw hi lt b fi mb ly l lz ma">  return new Promise((resolve, reject) =&gt; {</span><span id="d93d" class="iv iw hi lt b fi mb ly l lz ma">    setTimeout(() =&gt; resolve("data fetched"), 3000);</span><span id="8147" class="iv iw hi lt b fi mb ly l lz ma">  });</span><span id="e930" class="iv iw hi lt b fi mb ly l lz ma">};</span><span id="e866" class="iv iw hi lt b fi mb ly l lz ma">// use keyword async before function definition</span><span id="0e74" class="iv iw hi lt b fi mb ly l lz ma">async function loadData() {</span><span id="5e1c" class="iv iw hi lt b fi mb ly l lz ma">  // use keyword await before the function call</span><span id="5732" class="iv iw hi lt b fi mb ly l lz ma">  const data = await fetchData();</span><span id="cfcf" class="iv iw hi lt b fi mb ly l lz ma">  console.log(data);</span><span id="c1dd" class="iv iw hi lt b fi mb ly l lz ma">}</span><span id="2cf2" class="iv iw hi lt b fi mb ly l lz ma">loadData();</span></pre><p id="33a6" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">这是所有的乡亲。</p><p id="ccd0" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">如果有帮助，请留下掌声。</p><p id="743d" class="pw-post-body-paragraph jt ju hi jv b jw kq jy jz ka kr kc kd jg ll kf kg jk lm ki kj jo ln kl km kn hb bi translated">下一集见。</p></div></div>    
</body>
</html>