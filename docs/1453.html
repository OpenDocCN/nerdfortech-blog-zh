<html>
<head>
<title>Dotnet Core and RabbitMQ</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Dotnet核心和RabbitMQ</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/dotnet-core-and-rabbitmq-df5e7038e5c5?source=collection_archive---------3-----------------------#2021-03-20">https://medium.com/nerd-for-tech/dotnet-core-and-rabbitmq-df5e7038e5c5?source=collection_archive---------3-----------------------#2021-03-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="4eb0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">RabbitMQ是一个开源的消息代理。当用文字解释时，可能会令人困惑。我试着用图表来解释。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a863454fe627b0b7864fa6567b3d04d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HEhE_3579ZNLL46F6llBA.png"/></div></div></figure><p id="ca5d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">生产者:</strong>生产者发布关于事件的消息。生成器是此图中的一个应用程序。当用户发布一篇新文章时，系统创建一篇文章并发布一条消息(ArticleCreatedEvent)。</p><p id="8116" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">消费者:</strong>消费者在听信息。当消息发布时，消费者触发并读取消息上下文。当ArticleCreatedEvent消息发布时，NotificationSenderConsumer和ArticlePriceCalculatorConsumer在此关系图中触发。NotificationSenderConsumer运行SendNotificationCommand，它向作者的追随者发送通知。</p><p id="03e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ArticlePriceCalculatorConsumer运行CalculateArticlePriceCommand，它计算商品的价格。</p><p id="3971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我做了一个示例项目来解释这个主题。【https://github.com/emreerkoca/dotnet-core-rabbitmq-sample T4】</p><p id="dd50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果想写一个关于RabbitMQ的样例代码，可以下载安装RabbitMQ。</p><p id="8c6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://www.rabbitmq.com/" rel="noopener ugc nofollow" target="_blank">https://www.rabbitmq.com/</a></p><p id="5dc5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在这个项目中使用了MassTransit。面向. NET的MassTransit开源分布式应用框架。</p><p id="af20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jp" href="https://masstransit-project.com/" rel="noopener ugc nofollow" target="_blank">https://masstransit-project.com/</a></p><p id="77a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会一步一步地解释这个项目。我猜你安装了RabbitMQ。</p><p id="1bf2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建一个Dotnet核心Web应用程序(Web API) </strong></p><p id="a1df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将MassTransit包添加到您的项目中:</p><p id="21ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">命令:dotnet添加包MassTransit</p><p id="b59f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你不使用命令，你可以从Nuget包管理器安装这个包。</p><p id="cbf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建MembershipStartedEvent类。这是一个事件。它会把你的信息公布出去。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="00ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建IMembershipService接口:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="caab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建MemberShipService类:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="9bdf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">PostMembership方法只发布事件。我们假设它已经保存了用户的数据。您可以像这样发布一个新事件。</p><p id="276f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当事件发布时，它通过队列进行处理。消费者消费你的信息并执行你的命令。当它在工作中出错时，您的消息将被发送到错误队列。当错误队列中有消息时，您可以移动和处理它们。</p><p id="0bd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以从以下网址打开本地RabbitMQ面板:<a class="ae jp" href="http://localhost:15672/" rel="noopener ugc nofollow" target="_blank">http://localhost:15672/</a></p><p id="c1bc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">队列:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es js"><img src="../Images/ac1d64b1a8844e289cca415a0faa32cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bIjy1zx47E7_YTouVCRoQ.png"/></div></div></figure><p id="e6bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">就绪:</strong>等待处理的排队消息数。</p><p id="f5ef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">未确认:</strong>已处理的消息数，但不清楚。因此，消费者说“是的，我会消费它们”，但是没有关于过程的信息。当您看到邮件总数减少时，您可以理解他们正在消耗。</p><p id="cbb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">错误队列:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/4a82208db0794d27031d54ab883623b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xpi14DHmL1UA4n4aJEexRg.png"/></div></div></figure><p id="1876" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在添加一个新的控制器(MembershipController.cs)</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="6dca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对IMemberService感到困惑，你可以搜索“依赖注入”和“依赖注入构造函数注入”</p><p id="9e6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了一个服务类并使用了它。没有业务或数据访问层，因为它不是软件架构教程。</p><p id="894f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">postMembershipRequest方法将PostMembershipRequest对象发送到PostMembership方法。</p><p id="7baf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没必要解释每一部分。您可以检查存储库中的请求类、模型类或响应类。</p><p id="ea7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">消费阶层是这样的。当消息发布时，它来到这里:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="3326" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">大众运输配置</strong></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jq jr l"/></div></figure><p id="511c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它添加消费者和定义队列名称。</p><p id="3df2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您创建了其他部件或者下载了存储库，它就可以运行了。</p><p id="d1b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将断点放在Consume方法上，并发送post请求。你会看到你的信息将会传达给消费者。</p><p id="3bfa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">会员后运营图:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ju"><img src="../Images/ae0b18e3a877c0346e6f14061a2f8d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*jzpTf7AZ_ftRkUUDOjd5ww.png"/></div></figure><p id="787b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我会犯错。因为我不是机器。如果你在这篇文章中看到任何错误，你可以告诉我。希望能有所帮助。</p></div></div>    
</body>
</html>