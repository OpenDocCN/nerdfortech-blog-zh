<html>
<head>
<title>Time picker and custom entries in Preference Fragment made simple 🕒</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化了首选项片段中的时间选择器和自定义条目🕒</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/time-picker-and-custom-entries-in-preference-fragment-made-simple-1e0e125ff2ac?source=collection_archive---------2-----------------------#2021-05-11">https://medium.com/nerd-for-tech/time-picker-and-custom-entries-in-preference-fragment-made-simple-1e0e125ff2ac?source=collection_archive---------2-----------------------#2021-05-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="0903" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">以一个(主题化的)时间选择器为例，概述了在 Android 中实现自定义偏好设置的最快、最干净的方法</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/c71da5471015b2703d93603c59e6c159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLV5o8O3Yy662nSdxlFmlg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">材料时间选取器</figcaption></figure></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><p id="2cdd" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">使用 Android 中的 PreferenceFragmentCompat 实现的标准首选项肯定是一个很好的快速解决方案，可以获得功能设置屏幕。然而，以这种方式实现的标准设置屏幕有一些限制:例如，只支持有限的设置类型，并且屏幕布局不受我们的控制。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kq"><img src="../Images/f54a58e7a900ec5de43300cd75e7f678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oxALaOnNDn4jZU964hOF7g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">自定义首选项屏幕示例</figcaption></figure><p id="27c0" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在本文中，我将重点关注<strong class="jw hj">时间选择器</strong>，因为它是自定义首选项输入的一个很好的例子，但是同样的方法可以应用于几乎所有类型的自定义首选项。我将发布并评论代码和一个项目的链接，在这个项目中，我最初使用这个解决方案来实现这个和其他自定义首选项。会很简单的，放心吧！我将使用<strong class="jw hj">科特林</strong>和我所知道的每一个最佳实践。我们走吧！</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><h1 id="9e8d" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">第一步:设置偏好屏幕</h1><p id="8e8e" class="pw-post-body-paragraph ju jv hi jw b jx lj ij jz ka lk im kc kd ll kf kg kh lm kj kk kl ln kn ko kp hb bi translated">首先，您需要一个使用<strong class="jw hj"> PreferenceFragmentCompat </strong>实现的首选项屏幕，在撰写本文时，这是最现代的解决方案。这意味着您应该:</p><ol class=""><li id="27ac" class="lo lp hi jw b jx jy ka kb kd lq kh lr kl ls kp lt lu lv lw bi translated"><strong class="jw hj">实现 PreferenceFragmentCompat 的设置片段</strong></li></ol><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="6736" class="mc ks hi ly b fi md me l mf mg">class SettingsFragment : PreferenceFragmentCompat<em class="mh">()</em>, OnSharedPreferenceChangeListener {<em class="mh"><br/></em><br/>    // Create the screen, given the xml containing the preferences<br/>    override fun onCreatePreferences<em class="mh">(</em>savedInstanceState: Bundle?, rootKey: String?<em class="mh">) {<br/>        </em>setPreferencesFromResource<em class="mh">(</em>R.xml.<em class="mh">preferences</em>, rootKey<em class="mh">)<br/>    }<br/><br/>    </em>override fun onResume<em class="mh">() {<br/>        </em>super.onResume<em class="mh">()<br/>        </em>// Set up a listener whenever a key changes<br/>        <em class="mh">preferenceScreen</em>.<em class="mh">sharedPreferences<br/>            </em>.registerOnSharedPreferenceChangeListener<em class="mh">(</em>this<em class="mh">)<br/>    }<br/><br/>    </em>override fun onPause<em class="mh">() {<br/>        </em>super.onPause<em class="mh">()<br/>        </em>// Unregister the listener whenever a key changes<br/>        <em class="mh">preferenceScreen</em>.<em class="mh">sharedPreferences<br/>            </em>.unregisterOnSharedPreferenceChangeListener<em class="mh">(</em>this<em class="mh">)<br/>    }<br/>    </em>override fun onSharedPreferenceChanged<em class="mh">(</em>sharedPreferences: SharedPreferences, key: String<em class="mh">) {<br/>        </em>when <em class="mh">(</em>key<em class="mh">) {<br/>            </em>"theme_color" -&gt; activity.recreate<em class="mh">()<br/>            </em>"accent_color" -&gt; activity.recreate<em class="mh">()<br/>        }<br/>    }</em></span></pre><p id="7eee" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">2.<strong class="jw hj">RES/XML/preferences . XML 中包含屏幕结构的 XML</strong></p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="e39e" class="mc ks hi ly b fi md me l mf mg"><em class="mh">&lt;?</em>xml version="1.0" encoding="utf-8"<em class="mh">?&gt;<br/>&lt;</em>PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<em class="mh">&gt;<br/><br/>    &lt;</em>PreferenceCategory<br/>        android:key="app_behavior"<br/>        android:title="@string/app_behavior"<br/>        app:icon="@drawable/ic_app_behavior_24dp"<em class="mh">&gt;<br/><br/>        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="hide_images"<br/>            android:summaryOff="@string/hide_images_off"<br/>            android:summaryOn="@string/hide_images_on"<br/>            android:title="@string/hide_images"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="only_fav"<br/>            android:summaryOff="@string/only_fav_off"<br/>            android:summaryOn="@string/only_fav_on"<br/>            android:title="@string/only_fav"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="surname_first"<br/>            android:summaryOff="@string/surname_first_off"<br/>            android:summaryOn="@string/surname_first_on"<br/>            android:title="@string/surname_first"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>    &lt;/</em>PreferenceCategory<em class="mh">&gt;<br/><br/>    &lt;</em>PreferenceCategory<br/>        android:key="customization"<br/>        android:title="@string/customization"<br/>        app:icon="@drawable/ic_customization_24dp"<em class="mh">&gt;<br/><br/>        &lt;</em>ListPreference<br/>            android:defaultValue="system"<br/>            android:entries="@array/themes"<br/>            android:entryValues="@array/themeValues"<br/>            android:key="theme_color"<br/>            android:summary="%s"<br/>            android:title="@string/theme_name"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>ListPreference<br/>            android:defaultValue="aqua"<br/>            android:entries="@array/accents"<br/>            android:entryValues="@array/accentValues"<br/>            android:key="accent_color"<br/>            android:summary="%s"<br/>            android:title="@string/accent_name"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/>    &lt;/</em>PreferenceCategory<em class="mh">&gt;<br/>&lt;/</em>PreferenceScreen<em class="mh">&gt;</em></span></pre><p id="c175" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">在上面的例子中，屏幕(它只是一个普通的片段，可以是应用程序普通导航的一部分)是使用包含首选项的 xml(它是<strong class="jw hj">而不是</strong>一个布局)创建的，并且每当主题或重点改变时，监听器被用来刷新活动。只有当某个设置需要<strong class="jw hj">进一步的步骤</strong>时，这种操作才是必要的，而不是简单地更新 SharedPreferences 条目。XML 用一个(可选)图标定义了两个选项类别。“%s”代表选项的<strong class="jw hj">实际值</strong>，取自可能值列表。</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><h1 id="6864" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">步骤 2:为自定义首选项定义布局</h1><p id="cb2a" class="pw-post-body-paragraph ju jv hi jw b jx lj ij jz ka lk im kc kd ll kf kg kh lm kj kk kl ln kn ko kp hb bi translated">添加时间选择器的第一步是定义一个自定义的“行”用于首选项屏幕。布局将只包含行本身的设计。让我们设计一个类似于<strong class="jw hj">普通首选项行</strong>的布局:</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="2ba3" class="mc ks hi ly b fi md me l mf mg"><em class="mh">&lt;?</em>xml version="1.0" encoding="utf-8"<em class="mh">?&gt;<br/>&lt;</em>LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    android:id="@+id/timePicker"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:orientation="vertical"<br/>    android:paddingHorizontal="@dimen/settings_row_padding"<br/>    android:paddingVertical="@dimen/settings_row_padding"<br/>    android:hapticFeedbackEnabled="false"<br/>    android:background="?attr/selectableItemBackground"<em class="mh">&gt;<br/><br/>        &lt;</em>TextView<br/>            android:id="@+id/timePickerTitle"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:text="@string/notification_hour_name"<br/>            android:textAppearance="@style/TextAppearance.MaterialComponents.Body1" <em class="mh">/&gt;<br/><br/>        &lt;</em>TextView<br/>            android:id="@+id/timePickerDescription"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:text="@string/notification_hour_description"<br/>            android:textAppearance="@style/TextAppearance.MaterialComponents.Body2"<br/>            android:textSize="@dimen/custom_preference_text_size"<em class="mh">/&gt;<br/><br/>&lt;/</em>LinearLayout<em class="mh">&gt;</em></span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mi"><img src="../Images/bb60114d1ddad573d9d04d8c6f5b7a30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2FvhtkOhVrVOwPmteKRpzw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">上述布局的结果</figcaption></figure><p id="d8dc" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">外观符合标准文本，大小为 14sp，填充为 16dp，仅供参考。文本比通常的要长一点，但是你可以使用一个标准的单行描述。当然，换行符是使用字符串中的“\n”获得的，我写的警告与通知相关，因为这个特定的时间选择器将包含发送通知的时间。此外，请记住，该行文本中的任何更改都必须手动管理。</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><h1 id="de7c" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">步骤 3:为我们的时间选择器首选项创建一个类</h1><p id="727c" class="pw-post-body-paragraph ju jv hi jw b jx lj ij jz ka lk im kc kd ll kf kg kh lm kj kk kl ln kn ko kp hb bi translated">现在我们需要一个类来管理与我们正在创建的自定义行的交互。该类应该实现<strong class="jw hj">首选项</strong>和<strong class="jw hj"> OnClickListener </strong>，并管理时间选择器本身和行中文本的更新。不多不少。</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="7bea" class="mc ks hi ly b fi md me l mf mg">// A custom preference to show a time picker<br/>class TimePickerPreference<em class="mh">(</em>context: Context?, attrs: AttributeSet?<em class="mh">) </em>: Preference<em class="mh">(</em>context, attrs<em class="mh">)</em>,<br/>    View.OnClickListener <em class="mh">{<br/>    </em>private lateinit var sharedPrefs: SharedPreferences<br/>    private lateinit var currentHour: String<br/>    private lateinit var currentMinute: String<br/>    private lateinit var binding: TimePickerRowBinding<br/>    val formatter: DateTimeFormatter = DateTimeFormatter.ofLocalizedTime<em class="mh">(</em>FormatStyle.<em class="mh">SHORT)<br/><br/>    </em>override fun onBindViewHolder<em class="mh">(</em>holder: PreferenceViewHolder<em class="mh">) {<br/>        </em>sharedPrefs = PreferenceManager.getDefaultSharedPreferences<em class="mh">(context)<br/>        </em>currentHour = sharedPrefs.getString<em class="mh">(</em>"notification_hour", "8"<em class="mh">)</em>.<em class="mh">toString()<br/>        </em>currentMinute = sharedPrefs.getString<em class="mh">(</em>"notification_minute", "0"<em class="mh">)</em>.<em class="mh">toString()<br/>        </em>super.onBindViewHolder<em class="mh">(</em>holder<em class="mh">)<br/>        </em>binding = TimePickerRowBinding.bind<em class="mh">(</em>holder.itemView<em class="mh">)<br/><br/>        </em>// Format the time correctly<br/>        val currentTime = LocalTime.of<em class="mh">(</em>currentHour.<em class="mh">toInt()</em>, currentMinute.<em class="mh">toInt())<br/><br/>        </em>binding.timePickerDescription.<em class="mh">text </em>=<br/>            String.<em class="mh">format(<br/>                context</em>.getString<em class="mh">(</em>R.string.<em class="mh">notification_hour_description)</em>,<br/>                "~<em class="mh">${</em>formatter.format<em class="mh">(</em>currentTime<em class="mh">)}</em>"<br/>            <em class="mh">)<br/><br/>        </em>binding.<em class="mh">root</em>.setOnClickListener<em class="mh">(</em>this<em class="mh">)<br/>    }<br/><br/>    </em>override fun onClick<em class="mh">(</em>v: View<em class="mh">) {<br/>        </em>val act = <em class="mh">context </em>as MainActivity<br/>        currentHour = sharedPrefs.getString<em class="mh">(</em>"notification_hour", "8"<em class="mh">)</em>.<em class="mh">toString()<br/>        </em>currentMinute = sharedPrefs.getString<em class="mh">(</em>"notification_minute", "0"<em class="mh">)</em>.<em class="mh">toString()<br/><br/>        </em>// Show the time picker<br/>        val isSystem24Hour = is24HourFormat<em class="mh">(context)<br/>        </em>val clockFormat = if <em class="mh">(</em>isSystem24Hour<em class="mh">) </em>TimeFormat.<em class="mh">CLOCK_24H </em>else TimeFormat.<em class="mh">CLOCK_12H<br/>        </em>val picker =<br/>            MaterialTimePicker.Builder<em class="mh">()<br/>                </em>.setTimeFormat<em class="mh">(</em>clockFormat<em class="mh">)<br/>                </em>.setHour<em class="mh">(</em>currentHour.<em class="mh">toInt())<br/>                </em>.setMinute<em class="mh">(</em>currentMinute.<em class="mh">toInt())<br/>                </em>.setTitleText<em class="mh">(context</em>.getString<em class="mh">(</em>R.string.<em class="mh">notification_hour_name))<br/>                </em>.build<em class="mh">()<br/><br/>        </em>picker.addOnPositiveButtonClickListener <strong class="ly hj">{<br/>            </strong>val editor = sharedPrefs.edit<em class="mh">()<br/>            </em>editor.putString<em class="mh">(</em>"notification_hour", "<em class="mh">${</em>picker.<em class="mh">hour}</em>"<em class="mh">)<br/>            </em>editor.putString<em class="mh">(</em>"notification_minute", "<em class="mh">${</em>picker.<em class="mh">minute}</em>"<em class="mh">)<br/>            </em>editor.apply<em class="mh">()<br/><br/>            </em>// Format the selected hour and update the text<br/>            val currentTime = LocalTime.of<em class="mh">(</em>picker.<em class="mh">hour</em>, picker.<em class="mh">minute)<br/><br/>            </em>binding.timePickerDescription.<em class="mh">text </em>=<br/>                String.<em class="mh">format(<br/>                    context</em>.getString<em class="mh">(</em>R.string.<em class="mh">notification_hour_description)</em>,<br/>                    "~<em class="mh">${</em>formatter.format<em class="mh">(</em>currentTime<em class="mh">)}</em>"<br/>                <em class="mh">)<br/>        </em><strong class="ly hj">}<br/><br/>        </strong>picker.show<em class="mh">(</em>act.<em class="mh">supportFragmentManager</em>, "timepicker"<em class="mh">)<br/>    }<br/><br/>}</em></span></pre><p id="0a1a" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">上面的代码使用了<a class="ae mj" href="https://developer.android.com/topic/libraries/view-binding" rel="noopener ugc nofollow" target="_blank"> <strong class="jw hj">视图绑定</strong> </a>，但是您可以使用标准的“findViewById”方法，这没有任何问题。当用户点击该行时，时间选择器被配置(使用本地时间格式)并显示。当用户点击时间选择器的正按钮(“确定”按钮)时，时间被保存，文本被更新。我选择在两个不同的 SharedPreference 条目中节省分钟和小时，但这取决于你:在我的情况下，避免破坏以前版本的应用程序和正确管理通知调度是很方便的。关于时间选择器如何工作的完整概述，请参考<a class="ae mj" href="https://material.io/components/time-pickers/android" rel="noopener ugc nofollow" target="_blank">官方文档</a>。</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><h1 id="f6b4" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">步骤 4:使用 preference.xml 中的自定义首选项</h1><p id="d152" class="pw-post-body-paragraph ju jv hi jw b jx lj ij jz ka lk im kc kd ll kf kg kh lm kj kk kl ln kn ko kp hb bi translated">最后，是时候将我们的自定义参数链接到包含标准参数的 xml 了。很简单，只需使用完全限定的类名和对布局的引用！结果如下:</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="9f2b" class="mc ks hi ly b fi md me l mf mg"><em class="mh">&lt;?</em>xml version="1.0" encoding="utf-8"<em class="mh">?&gt;<br/>&lt;</em>PreferenceScreen xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<em class="mh">&gt;<br/><br/>    &lt;</em>PreferenceCategory<br/>        android:key="app_behavior"<br/>        android:title="@string/app_behavior"<br/>        app:icon="@drawable/ic_app_behavior_24dp"<em class="mh">&gt;<br/>    <br/>        &lt;</em>com.author.example.utilities.TimePickerPreference<br/>            android:layout="@layout/time_picker_row"<br/>            android:selectable="true" <em class="mh">/&gt;</em></span><span id="72d1" class="mc ks hi ly b fi mk me l mf mg"><em class="mh">        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="hide_images"<br/>            android:summaryOff="@string/hide_images_off"<br/>            android:summaryOn="@string/hide_images_on"<br/>            android:title="@string/hide_images"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="only_fav"<br/>            android:summaryOff="@string/only_fav_off"<br/>            android:summaryOn="@string/only_fav_on"<br/>            android:title="@string/only_fav"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>SwitchPreference<br/>            android:defaultValue="false"<br/>            android:key="surname_first"<br/>            android:summaryOff="@string/surname_first_off"<br/>            android:summaryOn="@string/surname_first_on"<br/>            android:title="@string/surname_first"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>    &lt;/</em>PreferenceCategory<em class="mh">&gt;<br/><br/>    &lt;</em>PreferenceCategory<br/>        android:key="customization"<br/>        android:title="@string/customization"<br/>        app:icon="@drawable/ic_customization_24dp"<em class="mh">&gt;<br/><br/>        &lt;</em>ListPreference<br/>            android:defaultValue="system"<br/>            android:entries="@array/themes"<br/>            android:entryValues="@array/themeValues"<br/>            android:key="theme_color"<br/>            android:summary="%s"<br/>            android:title="@string/theme_name"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/><br/>        &lt;</em>ListPreference<br/>            android:defaultValue="aqua"<br/>            android:entries="@array/accents"<br/>            android:entryValues="@array/accentValues"<br/>            android:key="accent_color"<br/>            android:summary="%s"<br/>            android:title="@string/accent_name"<br/>            app:iconSpaceReserved="false" <em class="mh">/&gt;<br/>    &lt;/</em>PreferenceCategory<em class="mh">&gt;<br/>&lt;/</em>PreferenceScreen<em class="mh">&gt;</em></span></pre><p id="0bbd" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">当然，用你的包名替换“com.author.example ”,用你用来存储我们之前讨论过的类的包<strong class="jw hj">替换“utilities”。我决定将它存储在一个通用的“实用工具”包中，但这不是最佳实践。如果您需要在自定义首选项更新时添加更多的逻辑，您可以在自定义类本身或 PreferenceFragmentCompat 中使用我们之前设置的侦听器来完成。</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kq"><img src="../Images/592fcb759ef5c81fa28aa956b54b6c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KMGowMmVTygt7XlzEC5g_g.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">时间选择器在工作！</figcaption></figure><p id="1584" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">下面是<strong class="jw hj">最终结果</strong>。当单击该行时，时间选择器打开，选择得到完美的管理。根据你的主题/颜色，拾色器在你的应用程序中会有所不同，我将在文章的最后一部分，奖金部分涉及这个主题。显然，只有当设备使用 12 小时制时,“AM/PM”选择器才可见。</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><h1 id="93d0" class="kr ks hi bd kt ku kv kw kx ky kz la lb io lc ip ld ir le is lf iu lg iv lh li bi translated">奖金:主题的时间挑选！</h1><p id="a02a" class="pw-post-body-paragraph ju jv hi jw b jx lj ij jz ka lk im kc kd ll kf kg kh lm kj kk kl ln kn ko kp hb bi translated">时间选择器可以主题化，以匹配应用程序中的其他对话框。虽然文档中包含了基本的主题化(主要是颜色相关的)来主题化<strong class="jw hj">角落</strong>和<strong class="jw hj">背景</strong>你将需要一些额外的主题化。这是我的主题:</p><pre class="iy iz ja jb fd lx ly lz ma aw mb bi"><span id="17fb" class="mc ks hi ly b fi md me l mf mg">&lt;!-- Base app theme --&gt;<em class="mh"><br/>&lt;</em>style name="AppTheme" parent="Theme.MaterialComponents.DayNight.NoActionBar"<em class="mh">&gt;<br/>...    </em>name="materialTimePickerTheme"<em class="mh">&gt;</em>@style/ThemeOverlay.App.TimePicker<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>...<br/>&lt;/</em>style<em class="mh">&gt;</em></span><span id="993f" class="mc ks hi ly b fi mk me l mf mg">&lt;!-- Time picker theme --&gt;<br/><em class="mh">&lt;</em>style name="ThemeOverlay.App.TimePicker" parent="@style/ThemeOverlay.MaterialComponents.TimePicker"<em class="mh">&gt;<br/>    &lt;</em>item name="shapeAppearanceMediumComponent"<em class="mh">&gt;</em>@style/ShapeAppearance.App.MediumComponent<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>    &lt;</em>item name="boxCornerRadiusBottomEnd"<em class="mh">&gt;</em>@dimen/text_field_corner<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>    &lt;</em>item name="boxCornerRadiusTopEnd"<em class="mh">&gt;</em>@dimen/text_field_corner<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>    &lt;</em>item name="boxCornerRadiusBottomStart"<em class="mh">&gt;</em>@dimen/text_field_corner<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>    &lt;</em>item name="boxCornerRadiusTopStart"<em class="mh">&gt;</em>@dimen/text_field_corner<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>    &lt;</em>item name="colorSurface"<em class="mh">&gt;</em>?android:colorBackgroundFloating<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>&lt;/</em>style<em class="mh">&gt;</em></span><span id="1518" class="mc ks hi ly b fi mk me l mf mg"><em class="mh">&lt;</em>style name="ShapeAppearance.App.MediumComponent" parent="ShapeAppearance.MaterialComponents.MediumComponent"<em class="mh">&gt;<br/>    &lt;</em>item name="cornerSize"<em class="mh">&gt;</em>@dimen/rounded_corners<em class="mh">&lt;/</em>item<em class="mh">&gt;<br/>&lt;/</em>style<em class="mh">&gt;</em></span></pre><p id="1e64" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">这将基本上使<strong class="jw hj">对话框角</strong>和<strong class="jw hj">文本字段角</strong>变圆，并使用浅灰色作为背景(默认比标准偏好对话框暗)。</p></div><div class="ab cl jn jo gp jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="hb hc hd he hf"><p id="aded" class="pw-post-body-paragraph ju jv hi jw b jx jy ij jz ka kb im kc kd ke kf kg kh ki kj kk kl km kn ko kp hb bi translated">我要说的差不多就是这些了！这个和其他自定义首选项的完整源代码在<a class="ae mj" href="https://github.com/m-i-n-a-r/birday" rel="noopener ugc nofollow" target="_blank"> <strong class="jw hj">这个资源库</strong> </a>中，查看一下，如果你愿意，可以随意留下一个<strong class="jw hj">star</strong>⭐；)</p></div></div>    
</body>
</html>