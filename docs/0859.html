<html>
<head>
<title>CI/CD Pipeline with Docker using GitHub Actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GitHub操作的Docker的CI/CD管道</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ci-cd-pipeline-with-docker-using-github-actions-c364803b6bc2?source=collection_archive---------4-----------------------#2021-02-19">https://medium.com/nerd-for-tech/ci-cd-pipeline-with-docker-using-github-actions-c364803b6bc2?source=collection_archive---------4-----------------------#2021-02-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/9cdc9a01706e54ebdeb7b16523c68cf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-w9HpjX_EiGoZDSp.png"/></div></div></figure><blockquote class="iq ir is"><p id="eed1" class="it iu iv iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">几年前，Github发布了Github Actions，这对开发者来说是一个非常有用的工具。现在最大的问题是Github动作会降低现代DevOps操作的复杂性吗？答案就在这篇文章里。</p></blockquote><p id="c725" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">在本文中，我们将重点关注…</p><ol class=""><li id="9f1b" class="jv jw hi iw b ix iy jb jc js jx jt jy ju jz jr ka kb kc kd bi translated">什么是GitHub动作？</li><li id="2bd3" class="jv jw hi iw b ix ke jb kf js kg jt kh ju ki jr ka kb kc kd bi translated">什么是开发人员工作流程？</li><li id="74bd" class="jv jw hi iw b ix ke jb kf js kg jt kh ju ki jr ka kb kc kd bi translated">GitHub事件和动作。</li><li id="651b" class="jv jw hi iw b ix ke jb kf js kg jt kh ju ki jr ka kb kc kd bi translated">具有GitHub操作的CI/CD管道。</li></ol><h1 id="5570" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是GitHub动作？</h1><p id="d801" class="pw-post-body-paragraph it iu hi iw b ix lh iz ja jb li jd je js lj jh ji jt lk jl jm ju ll jp jq jr hb bi translated">如今，开发人员不得不考虑的不仅仅是写代码。开发人员必须编写他们的代码，构建工件，测试这些工件，并将这些工件部署到测试环境中。你可以认为“这是很大的工作量..!"是的，这是GitHub action真正开始发光的地方。简而言之，GitHub动作用于自动化软件开发工作流程。基本上，GitHub actions是CI/CD平台，可以帮助开发人员自动化他们的工作流程。因此，我们最好看一下这些开发人员工作流是什么？</p><h1 id="61b6" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">什么是开发人员工作流程？</h1><p id="7770" class="pw-post-body-paragraph it iu hi iw b ix lh iz ja jb li jd je js lj jh ji jt lk jl jm ju ll jp jq jr hb bi translated">就像我之前说的，开发人员花了很多时间在代码管理、代码测试、部署等方面。说到GitHub，有许多组织任务正在进行。一个项目既有贡献者也有用户。用户产生了新的问题，开发人员或贡献者需要检查并解决这个问题。解决问题后，新版本的代码可用，并且正在为新版本的代码创建拉请求。这样，新版本的代码可以用于软件的下一个版本。有了这些，就有了可以与这些任务等同的主要任务。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/379da247c81109e24755970a9594710c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MySWrUzAZsFN351G.png"/></div></div></figure><p id="d152" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">上图显示了合并新版本软件后需要完成的最常见的工作流程。开发人员需要测试新版本的代码，构建软件并将其部署到生产环境中。对于一个小项目，你可以说没有很多工作需要做，但当项目开始增长时，问题就来了，更多的用户将与项目相关联，更多的贡献者将加入，所以这使得整个过程难以管理。所以你可以理解，当项目变得更大时，与项目相关的组织任务也变得复杂。因此，作为一名开发人员，你不需要花时间管理与项目相关的组织任务，你需要尽可能地自动化这些事情。这将允许开发人员更加专注于他们的代码。</p><h1 id="fbcb" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">GitHub事件和动作</h1><p id="2cd6" class="pw-post-body-paragraph it iu hi iw b ix lh iz ja jb li jd je js lj jh ji jt lk jl jm ju ll jp jq jr hb bi translated">到目前为止，我们已经讨论了什么是GitHub动作，什么是开发人员工作流。现在我们可以看看GitHub事件和动作是如何协同工作的。当存储库中发生某些事情时，您可以设置自动操作作为对这些事件的响应。这些事件专门命名为<strong class="iw hj"> GitHub事件，</strong>创建新问题，新的拉取请求，贡献者加入所有这些事情都可以被识别为GitHub事件。触发动作的过程非常简单。首先，您监听某个特定事件被触发，然后根据该事件自动启动某个操作。</p><h1 id="c99c" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">具有GitHub操作的CI/CD管道</h1><p id="6da8" class="pw-post-body-paragraph it iu hi iw b ix lh iz ja jb li jd je js lj jh ji jt lk jl jm ju ll jp jq jr hb bi translated">每个人想到的第一个问题是，我们需要GitHub做什么？，我们已经有很多像Jenkins这样的CI/CD工具。答案是，如果你在GitHub中有你的代码，你不需要任何第三方工具来管理你的CI/CD过程。GitHub Actions是GitHub用户的内置工具。使用GitHub操作设置CI/CD管道也非常容易。这也使得与其他技术的集成变得容易。</p><p id="f556" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">现在，让我们看看如何为您的应用程序使用docker设置CI/CD管道。在这个例子中，我们使用了一个基于java的应用程序。在我们开始演示之前，您需要有一个GitHub库来设置您的CI/CD管道。我创建了一个名为Java-CI-CD-pipeline的存储库。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/2fc3dc44b71400a6393c90a147767d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_84G0iNYkxeHpgONfFw6aw.png"/></div></div></figure><p id="96de" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">您可以看到在您的Git存储库中有一个名为“Actions”的选项卡。单击该选项卡，您可以看到您可以开始自动化自己的工作流程。现在，我将把我的java应用程序发布到我刚刚创建的Git存储库中。使用“git push”命令，您可以发布您的更改。</p><p id="0870" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">要创建GitHub操作，请点击“操作”选项卡，然后您会看到一个工作流模板列表。在这个例子中，我将向您展示如何为您的应用程序创建一个简单的持续集成工作流。因此，您可以使用其中一个匹配的工作流模板来创建GitHub操作。在本例中，我使用的是java Gradle应用程序，因此根据应用程序类型，我必须为我的项目选择Java with Gradle workflow。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/d1951e24ca863a13f3c91c029c362f3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pfXacmD4EQ7XqYolG4V97g.png"/></div></div></figure><p id="3b88" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">选择工作流类型后。yml类型文件将被创建在您的GitHub库的。/工作流目录。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/0f4cff8f1704470e6b7999afef17875a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*DxzPld98tPT9Rv4wKP-bkw.png"/></div></figure><p id="8fdc" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">这是我在回购中创建的文件。在这个文件中，push和pull指的是通用的git push命令和pull操作，所以如果任何一种操作被触发，它将启动。刚刚创建的yml文件。在此文件中，作业是指将在工作流中执行的一组操作。</p><p id="2c0c" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">在上面的代码示例中，定义了“name”标记来添加工作流名称。在steps标签下，“uses”属性用于设置预定义的动作，比如checkout。因此，像这样使用“使用”属性，您可以设置任何这样的行动。“运行”属性是指运行命令行命令。因此，让我们来看看我们的工作流将如何执行。</p><p id="9953" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">设置好这个文件后，将文件提交到您的代码中。接下来，对您的本地代码添加一些更改，并将其推送到您刚刚启用了GitHub操作的git存储库。完成后，转到GitHub actions部分，您将能够在git commit消息下看到已执行的工作流。在我的例子中，我将git提交添加为“Update gradle.yml”</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lu"><img src="../Images/fe5c785c10c6b829a7825547dfc56ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2qh3dM06cFK-h2aJA3_hlQ.png"/></div></div></figure><p id="e41a" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">单击工作流，您将能够看到您在工作流中定义的作业的执行情况。</p><figure class="ln lo lp lq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/3b488653b6ab5e45cfa6a45beecfd416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5abvebixHo9fWfzHK5Y2RQ.png"/></div></div></figure><p id="7a8f" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">好酷..！现在我们已经有了GitHub操作的基本设置，现在让我们看看如何将Docker集成到其中。</p><h2 id="32de" class="lv kk hi bd kl lw lx ly kp lz ma mb kt js mc md kx jt me mf lb ju mg mh lf mi bi translated">将Docker集成到工作流程中</h2><p id="7c2a" class="pw-post-body-paragraph it iu hi iw b ix lh iz ja jb li jd je js lj jh ji jt lk jl jm ju ll jp jq jr hb bi translated">在这一步中，我们将使用GitHub actions为我们的应用程序构建并发布一个docker映像。首先，您需要在docker hub帐户中有一个docker存储库。创建存储库后，将以下代码示例添加到您的工作流yaml文件中。</p><pre class="ln lo lp lq fd mj mk ml mm aw mn bi"><span id="2240" class="lv kk hi mk b fi mo mp l mq mr">steps:<br/>  - uses: actions/checkout@v2<br/>    name: Check out code<br/><br/>  - uses: mr-smithers-excellent/docker-build-push@v5<br/>    name: Build &amp; push Docker image<br/>    with:<br/>      image: repo/image<br/>      tags: v1, latest<br/>      registry: registry-url.io<br/>      dockerfile: Dockerfile.ci<br/>      username: ${{ secrets.DOCKER_USERNAME }}<br/>      password: ${{ secrets.DOCKER_PASSWORD }}</span></pre><p id="8800" class="pw-post-body-paragraph it iu hi iw b ix iy iz ja jb jc jd je js jg jh ji jt jk jl jm ju jo jp jq jr hb bi translated">添加docker配置所需的详细信息。对于这段代码中的用户名和密码，它指的是一个秘密，所以你可以做的是，你可以使用GitHub secrets添加一个秘密。在您的存储库中，转到设置部分，在底部您可以找到秘密选项卡，在那里您可以添加用户名和密码的两个秘密。请注意，在运行工作流之前，您需要将docker文件添加到工作目录中。之后，将变更推送到存储库。现在，您将能够看到您的docker工作流也在运行。</p></div></div>    
</body>
</html>