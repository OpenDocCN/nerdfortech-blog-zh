<html>
<head>
<title>Deadlock and its 4 necessary conditions with Code example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">死锁及其4个必要条件和代码示例</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deadlock-and-its-4-necessary-conditions-with-code-example-a5b6657c91f0?source=collection_archive---------0-----------------------#2020-12-14">https://medium.com/nerd-for-tech/deadlock-and-its-4-necessary-conditions-with-code-example-a5b6657c91f0?source=collection_archive---------0-----------------------#2020-12-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f58e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">任何读过操作系统的人都会遇到死锁的概念。我们看到几篇文章给出了死锁的定义，并列出了死锁的4个必要条件。我觉得缺少文章，用一个简单的代码例子来演示死锁和4个条件。在本文中，我将展示一个代码，演示导致死锁的4种情况，并给出代码的一个演练。</p><p id="37e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我想先给出“死锁”的定义和导致系统发生死锁的4个条件。之后，我将展示代码示例，并解释它如何导致死锁。</p><blockquote class="jd je jf"><p id="fcbf" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated"><a class="ae jk" href="https://en.wikipedia.org/wiki/Deadlock" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">死锁</strong> </a>是一种状态，其中组中的每个成员等待另一个成员(包括其自身)采取行动，例如发送消息或更常见的释放锁。</p></blockquote><p id="55f3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果满足以下所有必要条件，就会发生死锁(转载自<a class="ae jk" href="https://en.wikipedia.org/wiki/Deadlock" rel="noopener ugc nofollow" target="_blank">维基</a></p><ol class=""><li id="0ae9" class="jl jm hi ih b ii ij im in iq jn iu jo iy jp jc jq jr js jt bi translated"><em class="jg">互斥:</em>必须至少有一个资源处于不可共享模式。否则，就不会阻止进程在必要时使用资源。在任何给定的时刻，只有一个进程可以使用该资源。</li><li id="31f4" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><em class="jg">保持并等待</em>或<em class="jg">资源保持:</em>一个进程当前至少保持一个资源，并请求被其他进程保持的额外资源。</li><li id="05a0" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><em class="jg">无抢占:</em>资源只能由持有它的进程自愿释放。</li><li id="64de" class="jl jm hi ih b ii ju im jv iq jw iu jx iy jy jc jq jr js jt bi translated"><em class="jg">循环等待:</em>每个进程必须等待另一个进程占用的资源，而另一个进程又在等待第一个进程释放资源。总的来说，有一组等待过程，<em class="jg"> P </em> = { <em class="jg"> P </em> 1，<em class="jg"> P </em> 2，…，<em class="jg"> PN </em> }，这样<em class="jg"> P </em> 1在等待<em class="jg"> P </em> 2持有的资源，<em class="jg"> P </em> 2在等待<em class="jg"> P </em> 3持有的资源，以此类推，直到<em class="jg"> PN </em></li></ol><p id="ea68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个代码示例，它通过满足所有4个条件来演示死锁</p><figure class="jz ka kb kc fd kd"><div class="bz dy l di"><div class="ke kf l"/></div></figure><p id="71e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我想解释一下代码。</p><p id="7049" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的代码中，在第2行，文件“test.txt”被加锁。因为锁是在调用fork()系统调用之前放置的，所以文件上的锁由父进程持有。在第4行中，调用了fork()系统调用，这将导致创建一个新的子进程，复制fork()系统调用之后的所有代码语句。在第7行，子进程试图锁定同一个文件，这个文件已经被第2行的父进程锁定了。因为文件已经被锁定，所以子进程必须等待父进程释放锁来获取锁。在第12行，父进程使用wait()系统调用等待子进程结束。</p><p id="d06a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们看看上面的代码是如何满足死锁的4个必要条件的。</p><p id="2588" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于文件在任何时候只能由一个进程持有，因此文件上的锁满足<strong class="ih hj">互斥</strong>的条件。在第2行，父进程获得文件的锁，并等待第12行的子进程结束。这导致了<strong class="ih hj">‘保持并等待</strong>状态。第7行，子进程不能让父进程释放文件上的锁，这符合<strong class="ih hj">‘不抢占’</strong>的条件。此外，由于子进程正在等待父进程释放锁，而父进程又在等待子进程，这满足了'<strong class="ih hj">循环等待'</strong>'的条件。</p><p id="2b7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我总是习惯于忘记死锁条件，但是通过使用上面的代码，我对死锁的理解不仅提高了，而且我导出了死锁的必要条件，而不是记住它们。我希望阅读这篇文章的每个人都会发现它很有用，并且现在能够使用上面的简单代码推导出死锁的必要条件。我希望你喜欢这篇文章，如果有任何更改/澄清，请留言，我将很乐意更新/澄清。感谢阅读。</p><p id="9291" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">进一步阅读:<a class="ae jk" href="https://www.goodreads.com/book/show/2523069.The_C_Odyssey" rel="noopener ugc nofollow" target="_blank">维贾伊·穆希的“C”奥德赛</a></p></div></div>    
</body>
</html>