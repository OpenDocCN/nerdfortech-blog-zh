<html>
<head>
<title>Android Tutorial Part 1: Using Apollo library to fetch data from a GraphQL endpoint</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android教程第1部分:使用Apollo库从GraphQL端点获取数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/android-tutorial-part-1-using-apollo-library-to-fetch-data-from-a-graphql-endpoint-61e8c58158de?source=collection_archive---------0-----------------------#2021-03-17">https://medium.com/nerd-for-tech/android-tutorial-part-1-using-apollo-library-to-fetch-data-from-a-graphql-endpoint-61e8c58158de?source=collection_archive---------0-----------------------#2021-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/94f7ac890ed7a1ce6c25de7b15781730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kRfQ_qluaF58b8Ddd88dhw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">美国宇航局在<a class="ae iu" rel="noopener ugc nofollow" target="_blank" href="/s/photos/astronaut?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText"> Unsplash </a>拍摄的照片</figcaption></figure><p id="b179" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本教程中，我将展示如何使用<a class="ae iu" href="https://www.apollographql.com/docs/android/essentials/get-started-kotlin/" rel="noopener ugc nofollow" target="_blank"> Apollo </a>库从<a class="ae iu" href="https://rickandmortyapi.com/documentation/#graphql" rel="noopener ugc nofollow" target="_blank"> Rick和Morty GraphQL端点</a>获取数据。我将展示如何使用<a class="ae iu" href="https://kotlinlang.org/docs/reference/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/data-binding" rel="noopener ugc nofollow" target="_blank">数据绑定</a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/view-binding" rel="noopener ugc nofollow" target="_blank">视图绑定</a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank"> ViewModel </a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> LiveData </a>、<a class="ae iu" href="https://developer.android.com/kotlin/coroutines" rel="noopener ugc nofollow" target="_blank">Kotlin Coroutines</a>、<a class="ae iu" href="https://developer.android.com/guide/navigation/navigation-getting-started" rel="noopener ugc nofollow" target="_blank">导航组件</a>、<a class="ae iu" href="https://www.apollographql.com/docs/android/essentials/get-started-kotlin/" rel="noopener ugc nofollow" target="_blank"> Apollo </a>、<a class="ae iu" href="https://coil-kt.github.io/coil/getting_started/" rel="noopener ugc nofollow" target="_blank">线圈</a>、<a class="ae iu" href="https://developer.android.com/training/dependency-injection/hilt-android" rel="noopener ugc nofollow" target="_blank">手柄</a>以及MVVM架构模式从Rick获取数据这将是一个简单的应用程序，它获取一个角色列表，并通过点击特定的卡片，一个新的屏幕显示角色的详细信息。这是一个循序渐进的教程。</p><h1 id="808d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="669a" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">你应该已经熟悉<a class="ae iu" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank">科特林</a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/data-binding" rel="noopener ugc nofollow" target="_blank">数据绑定</a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/view-binding" rel="noopener ugc nofollow" target="_blank">视图绑定</a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank"> ViewModel </a>、<a class="ae iu" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> LiveData </a>、<a class="ae iu" href="https://developer.android.com/kotlin/coroutines" rel="noopener ugc nofollow" target="_blank">科特林协同程序</a>和MVVM。</p><p id="5e7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我用的是Android Studio 4 . 1 . 2<br/>Build # AI-201 . 8743 . 12 . 41 . 7042882，2020年12月20日构建。</p><h1 id="22a6" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">为什么是这篇文章？</h1><p id="9b22" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">我目前工作的公司已经从REST API转换到GraphQL API。其中一个主要好处是，客户端能够准确地指定他们需要从服务器获得什么，并以可预测的方式接收数据。使用GraphQL，您只能得到您需要的东西。与REST API响应相比，REST API响应通常包含很多大多数时候不需要的数据。在那里你必须筛选出真正感兴趣的数据。这使得GraphQL更加高效。如需简短介绍，请查看YouTube上来自<a class="ae iu" href="https://www.youtube.com/watch?v=eIQh02xuVw4" rel="noopener ugc nofollow" target="_blank"> Fireship </a>的视频。</p><h1 id="dfef" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">应用程序将会是什么样子</h1><p id="8585" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">该应用程序将包含一个卡片列表。每张人物卡显示一个id，名字和物种。角色细节显示了角色的id、名字、状态、种类、类型、性别和形象。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/42e2dc15c8aac30beb9f416113adfc7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:620/format:webp/1*21GJaqT_rxAGwlXFGlYhzQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">字符列表</figcaption></figure><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/abd7bac4e176eac195a6f87cf5094788.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/format:webp/1*apgSzkNrzkLZ2_BeBrT9AQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">角色详细信息</figcaption></figure><h1 id="bb0b" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">开始新项目</h1><p id="6f04" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">去Android Studio新建一个<strong class="ix hj"> <em class="lc">空项目</em> </strong>(语言<strong class="ix hj"> <em class="lc"> </em> </strong>科特林，<strong class="ix hj"> <em class="lc"> </em> </strong> API 23)。或者到分行查看我的GitHub回购:<a class="ae iu" href="https://github.com/fahrican/ApolloGraphQlTutorial/tree/initial_project" rel="noopener ugc nofollow" target="_blank"> initial_project </a></p><h1 id="bf0f" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">梯度依赖性</h1><p id="5f3a" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">转到您的<strong class="ix hj">项目build.gradle </strong>文件。首先，为我们将使用的依赖项创建变量。</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="939c" class="li ju hi le b fi lj lk l ll lm">ext <strong class="le hj">{<br/>    </strong>kotlin_version = "1.4.31"<br/>    apollo_version = "2.5.4"<br/>    hilt_version = "2.31.2-alpha"<br/>    hilt_compiler_version = '1.0.0-alpha03'<br/>    legacy_support_v4_version = '1.0.0'<br/>    fragment_component_version = "2.3.3"<br/><strong class="le hj">}</strong></span></pre><p id="3d29" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后添加句柄和导航安全参数的类路径。</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="56ba" class="li ju hi le b fi lj lk l ll lm">dependencies <strong class="le hj">{<br/>    </strong>classpath "com.android.tools.build:gradle:4.1.2"<br/>    classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"<br/>    classpath "androidx.navigation:navigation-safe-args-gradle-plugin:$fragment_component_version"<br/>    classpath "com.google.dagger:hilt-android-gradle-plugin:$hilt_version"<br/><strong class="le hj">}</strong></span></pre><p id="dfe1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是<strong class="ix hj">项目build.gradle </strong>现在应该是什么样子的要点:</p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><p id="8ade" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在转到<strong class="ix hj"> app build.gradle </strong>，添加第一行所需依赖的插件:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="975c" class="li ju hi le b fi lj lk l ll lm">plugins <strong class="le hj">{<br/>    </strong>id 'com.android.application'<br/>    id 'kotlin-android'<br/>    id 'kotlin-kapt'<br/>    id 'dagger.hilt.android.plugin'<br/>    id 'androidx.navigation.safeargs.kotlin'<br/>    id("com.apollographql.apollo").version("2.5.4")<br/><strong class="le hj">}</strong></span></pre><p id="1bf1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后在<strong class="ix hj"> kotlinOptions </strong>下面添加以下内容:</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="99ac" class="li ju hi le b fi lj lk l ll lm">buildFeatures <strong class="le hj">{<br/>    </strong>viewBinding = true<br/>    dataBinding = true<br/><strong class="le hj">}</strong></span></pre><p id="897e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在出现了一个非常非常重要的依赖。下面的依赖项是从<a class="ae iu" href="https://www.apollographql.com/docs/android/" rel="noopener ugc nofollow" target="_blank"> Apollo库</a>转换而来的*。graphql文件转换成*。kt文件。应该和<em class="lc">安卓{} </em>在一个层次。</p><pre class="kx ky kz la fd ld le lf lg aw lh bi"><span id="43a4" class="li ju hi le b fi lj lk l ll lm">apollo <strong class="le hj">{<br/>    </strong>// instruct the compiler to generate Kotlin models<br/>    generateKotlinModels.set(true)<br/><strong class="le hj">}</strong></span></pre><p id="641d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里汇总了<strong class="ix hj"> app build.gradle </strong></p><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="ln lo l"/></div></figure><h1 id="a639" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">GraphQL模式</h1><p id="627f" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">这部分是整个教程中最重要的部分。在这里我将解释Apollo和GraphQL是如何为Android工作的。</p><p id="a634" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">将您的项目视图从“Android”更改为“project”。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lp"><img src="../Images/586044ccf1607d528fe0187afa1917e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*fpieBoBuKg05LjkH1nlI4g.png"/></div></figure><p id="e5a3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在从<strong class="ix hj">app</strong>-&gt;<strong class="ix hj">src</strong>-&gt;<strong class="ix hj">main</strong>导航。右键点击<strong class="ix hj">主</strong>-&gt;-<strong class="ix hj">新建</strong>-&gt;-<strong class="ix hj">目录</strong></p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lq"><img src="../Images/094309cd284d881046bfc7ec8afef476.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dbJyX_PoY16-PaHZcVyr2w.png"/></div></div></figure><p id="801e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">创建一个新目录，并将其命名为<strong class="ix hj"> graphql </strong>。创建与java文件夹相同的子目录。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es lr"><img src="../Images/945112ace131d314f3e604109096f2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*rW0Mz6QE1D81y0XNkRMCSw.png"/></div></figure><p id="e9eb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这很重要，因为现在我们将保存<strong class="ix hj"> schema.sdl </strong>文件并添加<strong class="ix hj"> *。graphql </strong>文件在那里。相同的包结构很重要，因为我们将能够在java包中使用生成的Kotlin类。</p><h2 id="bf51" class="li ju hi bd jv ls lt lu jz lv lw lx kd jg ly lz kh jk ma mb kl jo mc md kp me bi translated">JS GraphQL Android Studio插件</h2><p id="077f" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">在我们添加<strong class="ix hj"><em class="lc">schema . SDL</em></strong><em class="lc"/>文件之前，我们想要添加一个特殊的插件来使我们的GraphQL语法更加简单。打开您的Android Studio偏好设置。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mf"><img src="../Images/7e690ce936c0eb4c8c4d9b2a6043e5ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*HXlokeFDMpbZceLqlfPs5A.png"/></div></figure><p id="98d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我用的是MacBook，所以如果你用的是Windows或Linux，偏好可能会在别的地方。</p><p id="4ca0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然后进入<strong class="ix hj">插件</strong>点击<strong class="ix hj"> Marketplace </strong>搜索“js graphql”并安装Jim Kynde Meyer的第一个条目。安装后，您可能需要重新启动Android Studio。</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/ed4cb48a67038b69039a37c5f3bc0489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZgs_mwl2NVsCUjLCbz-wQ.png"/></div></div></figure><p id="cdbe" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">重启安装插件<strong class="ix hj"> JS GraphQL </strong>并重启IDE后，再次打开首选项。这次导航到<strong class="ix hj">编辑器</strong>-&gt;-<strong class="ix hj">文件类型</strong></p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mh"><img src="../Images/cb00db7b45ae921997da6f3f0757d6b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*zir_6aM5pnByFO4pwmvZbg.png"/></div></figure><p id="54f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在寻找GraphQL并点击它。下面的“注册模式:”是添加文件类型的加号。添加一个又一个文件类型，比如:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mi"><img src="../Images/3c4dda4bac1554a79f99b37da0014dd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/format:webp/1*X_N3L6QO6pJ2IACijrpobA.png"/></div></figure><ul class=""><li id="d1b7" class="mj mk hi ix b iy iz jc jd jg ml jk mm jo mn js mo mp mq mr bi translated">*.gql</li><li id="aa66" class="mj mk hi ix b iy ms jc mt jg mu jk mv jo mw js mo mp mq mr bi translated">*.graphql</li><li id="87ce" class="mj mk hi ix b iy ms jc mt jg mu jk mv jo mw js mo mp mq mr bi translated">*.图表qls</li><li id="5b92" class="mj mk hi ix b iy ms jc mt jg mu jk mv jo mw js mo mp mq mr bi translated">*.sdl</li></ul><p id="1152" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">添加完这些文件类型后，我们最终可以添加<strong class="ix hj"> schema.sdl </strong>文件。头回到你的包结构:<strong class="ix hj">graph QL</strong>-&gt;<strong class="ix hj">com</strong>-&gt;<strong class="ix hj">example</strong>-&gt;<strong class="ix hj">apollographql tutorial</strong>-&gt;<strong class="ix hj">右键</strong> - &gt; <strong class="ix hj">新建</strong>-&gt;<strong class="ix hj">File</strong>-&gt;<strong class="ix hj">schema . SDL</strong></p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es mx"><img src="../Images/308b57aeaa402b9bb99522aa2f6726ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*F5IHxyphEkNe0YxddQCaQA.png"/></div></figure><p id="9aed" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">好了，第一部分到此为止。如果你喜欢这篇文章<strong class="ix hj">，请鼓掌</strong>。这里是<a class="ae iu" href="https://fahri-c93.medium.com/android-tutorial-part-2-using-apollo-library-to-fetch-data-from-a-graphql-endpoint-96dad8a58639" rel="noopener">第二部</a>。</p><p id="324a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这里是已完成的项目，退房分支<strong class="ix hj"> part_one </strong></p><div class="my mz ez fb na nb"><a href="https://github.com/fahrican/ApolloGraphQlTutorial/tree/part_one" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab dw"><div class="nd ab ne cl cj nf"><h2 class="bd hj fi z dy ng ea eb nh ed ef hh bi translated">fahrican/apollographql教程</h2><div class="ni l"><h3 class="bd b fi z dy ng ea eb nh ed ef dx translated">在GitHub上创建一个帐户，为fahrican/apollographqlturtutorial开发做贡献。</h3></div><div class="nj l"><p class="bd b fp z dy ng ea eb nh ed ef dx translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np io nb"/></div></div></a></div></div></div>    
</body>
</html>