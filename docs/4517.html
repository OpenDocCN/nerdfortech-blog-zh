<html>
<head>
<title>Point &amp; Click Movement for Multiple Units with Unity Input System Events</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过Unity输入系统事件点击移动多个单元</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/point-click-movement-for-multiple-units-with-unity-input-system-events-fdafb922f032?source=collection_archive---------4-----------------------#2021-07-24">https://medium.com/nerd-for-tech/point-click-movement-for-multiple-units-with-unity-input-system-events-fdafb922f032?source=collection_archive---------4-----------------------#2021-07-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="2906" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">战术团队运动力学</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/9a46dd6071402e44f546cb626b811102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UFcrNu4bnD8ZfEXs"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">已选择单位。</figcaption></figure><p id="a016" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">今天的挑战:点击一个单位进行选择，右键将选择的单位移动到最近的整数网格坐标。对于这一个，我们将回到等距视图。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kj"><img src="../Images/6332b6e41071e3252ff82e123b013255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxLEjU7yfjRfMUUa_npRQg.png"/></div></div></figure><p id="d69a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我的场景是用1m ProBuilder立方体的20x20网格和两个胶囊“单元”建立的我还准备了一台等轴摄影机，在<em class="kk"> x </em>轴上旋转34度，在<em class="kk">y</em>轴上旋转45度。如果你想更详细地了解如何设置一台等轴摄影机，请查看<a class="ae kl" href="https://michael-l-davis.medium.com/isometric-player-movement-in-unity-998d86193b8a" rel="noopener">这篇文章</a>。最后，我们需要将地板烘焙成一个NavMesh，并为每个单元赋予一个NavMesh代理组件。你可以在<a class="ae kl" href="https://michael-l-davis.medium.com/point-and-click-movement-in-unity-3d-2ff602b33437" rel="noopener">我的原始观点中查看如何设置，并点击教程文章</a>。</p><p id="febb" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">之后，我们需要配置输入系统。确保您已经安装了输入系统包，并且创建了输入动作和输入设置资产(在<a class="ae kl" href="https://michael-l-davis.medium.com/isometric-player-movement-in-unity-998d86193b8a" rel="noopener">之前链接的文章</a>中也有涉及)。对于这个实现，我们不需要播放器输入组件，但是我们*将*需要从检查器面板为输入动作资产生成一个C#脚本:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es km"><img src="../Images/264babc95e006d95ea2a1111aee81ac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NeqQlzBV1_iopd4_aLjTvg.png"/></div></div></figure><p id="4262" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，我们需要在输入动作资产中配置三个输入动作:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kn"><img src="../Images/327414a9c5b82086993f97fb91be9e9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzqU17O5kZufnVFI_zYmqQ.png"/></div></div></figure><p id="e0fe" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">第一个动作是与鼠标位置相关的Vector2动作。接下来，我们有一个右键，用于执行任何需要执行的命令。左键(默认按下)将进行选择。</p><p id="904d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">接下来，我需要一种方法将我点击的任何对象加载到内存中作为“选择”由于我有多个对象要处理，因此让选择机制受它们中的任何一个控制都没有意义，所以我将在场景中创建一个空对象，并为其附加一个SelectionManager C#脚本组件。</p><p id="60ea" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因为我们没有使用播放器输入组件，所以我们需要初始化自己的输入类实例。我们还需要将实例设置为启用和禁用运行实例的对象。以下是C#方法:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/630523abea491ad57c5ea10dcbb01304.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Mnmt0U3KhWarrSgOxfriw.png"/></div></div></figure><p id="1c64" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在，我们将创建一个名为SelectUnit()的方法。我们希望在执行Select Input操作时触发该事件，因此我们将创建一个Start()方法，将SelectUnit()方法委托给在输入设置期间生成的C#类中的事件。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/e640d78bdb266e61c121f5894f10ce3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Nljtpcnz-eMscN2NzD57g.png"/></div></div></figure><p id="aa66" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们在Awake()中创建的_input实例正在访问单元输入动作映射，并通过它访问选择动作，我们感兴趣的事件是动作是否被执行。如果我们将鼠标悬停在performed上，我们会看到它是行动号召的简写:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kp"><img src="../Images/a2ef2efbae4d0e73e523b0d93c53c33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*nPnq_cKkA91rVst9_6CzgA.png"/></div></figure><p id="6378" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">因此，我们为该操作订阅了SelectUnit()。那里的小下划线是输入系统的<em class="kk">上下文</em>参数。我们在这里不需要它，因为我们实际上完全是从另一个输入动作读取数据:鼠标位置动作(稍后会有更多的介绍)。因此，强调这一点是为了避免混乱，使其具有可读性。</p><p id="8566" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在我们已经订阅了我们的方法，让我们定义它。首先是伪代码:</p><blockquote class="kq kr ks"><p id="ab3e" class="jn jo kk jp b jq jr ij js jt ju im jv kt jx jy jz ku kb kc kd kv kf kg kh ki hb bi translated">从mouse position动作中获取鼠标位置<br/>使用鼠标位置投射一个相机屏幕点toray<br/>如果它击中一个单位，获取它的单位组件<br/>…将该单位指定为_selectedUnit <br/>否则将_selectedUnit设置为空(也称为取消选择)</p></blockquote><p id="7112" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在C#中是这样的:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/c15a90485d9b0c9f6266d5f631973288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7C3jTqeL4RjYH4fG6ciZQ.png"/></div></div></figure><p id="f891" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我还没有一个系统来识别谁被选中，所以现在我们将依赖于良好的旧调试日志。当然，在这个类的范围内，你需要声明一个_selectedUnit变量。</p><p id="3fa9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们看看我们有什么。我将单击一个单元来选择它们，然后在地面上取消选择。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es kw"><img src="../Images/cec5868c05877e97e8e81733e9c71499.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-83_VaChelGE7Ikq7o4XQ.png"/></div></div></figure><p id="7d0b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">太棒了。</p><p id="ac62" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">现在让我们让这些单位动起来。为此，我们将为单元创建一个新的C#类。现在它只需要一个方法:HandleMovement(Vector2 mousePos)</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/64491fb43e31b119dd927d6b514b9c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gP-M1gsbk4RAvcdQByzimg.png"/></div></div></figure><p id="7a35" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">回到SelectionManager类，我们将创建一个Execute()方法，并为其订阅另一个输入动作事件:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/c86f24a735d983a713f416b8e8e13cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGCmrtRKGG2PBduRSnHAcw.png"/></div></div></figure><p id="0dc9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">同样，我们并没有真正使用回调上下文变量，所以我们可以把它加下划线。当执行动作被执行时，我们的Execute方法将把鼠标位置发送给我们选择的单元的HandleMovement()方法。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/3827ac6a40535b09a5e09d6478b69abe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QiGm7QOjZu-qIZzmntlBFw.png"/></div></div></figure><p id="d7bc" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当然，如果我们没有选定的单位，我们什么都不想做。</p><p id="1977" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">最后，在HandleMove方法中，我们将经历大致相同的过程:</p><blockquote class="kq kr ks"><p id="8e71" class="jn jo kk jp b jq jr ij js jt ju im jv kt jx jy jz ku kb kc kd kv kf kg kh ki hb bi translated">从mouse position动作中获取鼠标位置<br/>使用鼠标位置<br/>投射一个相机屏幕点如果它碰到地面<br/>…收集所单击空间的世界空间向量<br/>…将每个坐标四舍五入为最接近的整数<br/>…将NavMesh代理的目的地设置为四舍五入后的坐标</p></blockquote><p id="ccf1" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我把这些四舍五入的原因是为了确保单位总是停在一个整数网格坐标上。这让我们假装我们在格子上移动，以达到战术游戏的目的。</p><p id="bf7c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">C#方法应该类似于:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ko"><img src="../Images/1ba5924f0246a4004f3af8fcb99546bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IOQ0gHWKVkqGqMZGXYacfw.png"/></div></div></figure><p id="f1ba" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这应该可以了。来看看gif:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es kx"><img src="../Images/35e952221950cb986129cba584ff3e5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/1*c34uf33PTXAOoKPl4MZq2g.gif"/></div></figure><p id="f6ec" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">太棒了！</p><p id="9900" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这就是你需要知道的关于新输入系统的点击运动的一切。通过将你的输入信息分成两种不同类型的输入动作，你可以将按钮和矢量动作组合成一个对玩家来说明显的动作。轻松点。</p></div></div>    
</body>
</html>