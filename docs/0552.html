<html>
<head>
<title>Azure Event Hubs Are Not Queues</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure事件中心不是队列</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/azure-event-hubs-are-not-queues-ebf25bb3d49c?source=collection_archive---------3-----------------------#2021-01-13">https://medium.com/nerd-for-tech/azure-event-hubs-are-not-queues-ebf25bb3d49c?source=collection_archive---------3-----------------------#2021-01-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2bab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，我见过相当多的人使用Azure事件中心，而他们真正想要的是一个队列。</p><p id="da67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">事件中心非常适合大规模数据接收，但是如果您只需要在服务之间传递消息，请使用其他工具。以下是几个原因。</p><h1 id="e403" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">消息阻塞了队列</h1><p id="690b" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">事件中心使用分区模型，发送给它的消息分布在各个分区中。<br/>每个分区都有一个可以并发读取的读取器，消息总是按顺序处理。</p><p id="ede6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着，如果您有一条消息需要一段时间来处理，那么该分区上的其余消息也会被延迟。<br/>这意味着，如果你有一条导致你的应用崩溃的消息，你就不能在那个分区上处理任何其他东西，直到你以某种方式处理了这条消息。通过等待和重试、丢弃消息或者将它保存在其他地方。</p><p id="26b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">相比之下，Azure存储队列可以锁定消息并尝试处理它。<br/>如果你处理不了或者需要一段时间，你就不会耽误任何人。其他消费者不需要等你处理完你的信息才可以继续。</p><h1 id="1173" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">检查点使错误处理变得困难</h1><p id="d972" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">事件中心是面向批处理的。你接收一批消息，然后当你处理足够多的消息时，你创建一个所谓的<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features#checkpointing" rel="noopener ugc nofollow" target="_blank">检查点</a>。</p><p id="f0bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查点是一种写下来的方式:这是我处理的消息的数量。检查点是您偶尔会做的事情，并不意味着您对每封邮件都要做。<br/>如果你的应用程序在检查点之间崩溃，它将从最后一个检查点开始，你将重新处理每条消息，直到你再次更新。<br/>这意味着您的系统必须对多次发送的消息相当耐用。</p><p id="ddc8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">虽然这是大多数队列都存在的问题(应用程序在接收和处理消息之间总是会崩溃)，但通常情况下，您一次只能处理一条消息，因此如果出现故障，造成的伤害会更小。</p><h1 id="74e9" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">活动中心需要一个额外的存储帐户</h1><p id="aedf" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">分区读取器使用Azure存储帐户来协调它们之间的检查点和<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-processor-balance-partition-load" rel="noopener ugc nofollow" target="_blank">分区所有权</a>。</p><p id="eb19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着，如果没有存储帐户，您将无法从事件中心进行读取。这没什么大不了的，但是确实增加了一个额外的连接字符串需要管理，一个额外的Azure资源需要部署。</p><h1 id="01e5" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">地方发展</h1><p id="834f" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">没有办法在本地运行活动中心。<br/>与Azure存储队列形成对比，你可以使用<a class="ae jd" href="https://github.com/Azure/Azurite" rel="noopener ugc nofollow" target="_blank">Azure</a>在本地运行Azure存储队列，或者你可以在Docker中运行许多其他队列。</p><p id="0329" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">能够在本地运行您的依赖项真是太好了。这意味着您不必为每个开发人员处理事件中心。</p><h1 id="07d0" class="je jf hi bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">使用活动中心的理由</h1><p id="370d" class="pw-post-body-paragraph if ig hi ih b ii kc ik il im kd io ip iq ke is it iu kf iw ix iy kg ja jb jc hb bi translated">我不讨厌活动中心。如果你需要它提供的功能，比如<a class="ae jd" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-capture-overview" rel="noopener ugc nofollow" target="_blank">事件捕获功能</a>，或者你有大量数据，它们是一个很好的工具。</p><p id="3e86" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是如果只是需要在服务之间发送消息呢？用别的。</p></div><div class="ab cl kh ki gp kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hb hc hd he hf"><p id="10d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="ko">最初发布于</em><a class="ae jd" href="https://www.gustavwengel.dk/event-hubs-are-not-queues" rel="noopener ugc nofollow" target="_blank"><em class="ko">https://www . Gustav wengel . dk</em></a><em class="ko">。</em></p></div></div>    
</body>
</html>