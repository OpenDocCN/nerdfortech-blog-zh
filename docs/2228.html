<html>
<head>
<title>How to create a microservice</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何创建微服务</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-create-a-microservice-c7bfc6325038?source=collection_archive---------6-----------------------#2021-04-27">https://medium.com/nerd-for-tech/how-to-create-a-microservice-c7bfc6325038?source=collection_archive---------6-----------------------#2021-04-27</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/43163d653fe766390a28feb8eb046e19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iedeXlTbcJMHFhqDqIRGLQ.jpeg"/></div></div></figure><p id="d33c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们之前的博客中，我们已经了解了什么是微服务，以及它与整体架构有何不同。我们甚至研究了它相对于单片应用程序的优势。在这篇文章中，我们将更深入一层，看看如何在你的 Visual Studio 中创建微服务。</p><p id="941b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Sub 系好安全带，准备好打造自己的微服务吧。</p><p id="2a67" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ol class=""><li id="75b9" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">如何创建微服务？</li><li id="f17e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">包扎</li></ol><h1 id="72c6" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何创建微服务？</h1><p id="a3b5" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">要创建微服务，我们需要使用以下工具-</p><ol class=""><li id="44fd" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">Visual Studio(用于为服务实现基于 C#的代码)</li><li id="7cad" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">SQL 数据库服务器和 studio(用于为应用程序创建数据库和表)。</li></ol><p id="1500" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，如果您想将应用程序容器化，您可能需要 docker。</p><p id="2b0a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个想法是创建一个 API 来完成所有的用户服务，其中有一个单独的数据库来存储所有与用户相关的信息。</p><p id="51fd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们将创建将由 API 使用的数据库。为了创建数据库，我们将使用 SQL Server Management Studio。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/bb16366e37072bfb425ea83bd4e066e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/0*ObCgEJQlVmjKU1zt"/></div></figure><p id="a69c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">右键单击数据库并选择“新建数据库”选项。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lk"><img src="../Images/90c2116a8d0b462f5e18a3e41e97fa09.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/0*LJ1tOB7xa_-sOXzX"/></div></figure><p id="6426" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">点击它，弹出窗口询问数据库名称。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ll"><img src="../Images/6311be8c239cc833a9fa2008149eb180.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DeJchOiVkFhD7KxV"/></div></div></figure><p id="3971" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦创建了数据库，下一步就是创建用于存储记录的表。要创建它们，右键单击已创建的数据库中的表文件夹，并选择其中的“新建”选项和“表”选项。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/e52c32dfd3a77a6cfa7d3f7fec6bc535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/0*107Wa4-0AjJQjXK2"/></div></figure><p id="e9ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">尽管完全从 API 中执行 CRUD 操作是可能的，但是在 API 中将只实现 read 操作。为此，我们将手动向表中添加数据。要添加数据，请右键单击该表并选择“编辑前 200 行”选项。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ln"><img src="../Images/733c10550ffb765a0d48b444ee6d610a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/0*7SjtZTBHZt3vAOLP"/></div></figure><p id="0594" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据需要添加数据。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/b2dd60d49459aaf7ce806772249aaca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/0*JlgShg76RNVS-lXP"/></div></figure><p id="7968" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就是我们的应用程序所需的数据库。</p><p id="6c7c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是创建一个 API，它可以使用创建的数据库并响应来自邮递员的调用。要创建 WebAPI，让我们选择“ASP。NET 核心 Web 应用程序”作为项目。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/4c7bffceecc6d72b16d4e3502cd8ca58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yowS1TL06fIFqbuZ"/></div></div></figure><p id="87b8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">和‘API’作为项目的模板。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/4b582abab7f2b02b3e44f25995e172fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FmUx8mAE4ORC7RrU"/></div></div></figure><p id="bc1f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建完成后，项目如下所示。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lq"><img src="../Images/ceee461534546ab09f0ba68923cbbc25.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/0*Xk4_IbbAHRNCyvwD"/></div></figure><p id="ba08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">第一步是创建两个文件夹，“上下文”和“模型”，用于存储数据库上下文的类文件和数据库的实体文件。</p><p id="8d2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建一个文件夹，右键单击项目，转到“添加”并寻找“新文件夹”</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/74b462971a1c64f15d5477499c7332de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dOQJYkrpCMRE2_Ii"/></div></div></figure><p id="7eb7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，我们将使用实体框架方法来连接代码和数据库。为了能够使用 EF，我们需要安装下面两个 NuGet 包。</p><ul class=""><li id="8205" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn ls ju jv jw bi translated">微软。EntityFrameworkCore.SqlServer</li><li id="304a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn ls ju jv jw bi translated">微软。EntityFrameworkCore.tools</li></ul><p id="28bf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要安装 NuGet 包，右键单击项目并寻找“管理 NuGet 包”选项。因为我们在使用。Net Core 3.1，两个包我们都选择了 3.1.14 版本。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/b3d56a2bdf6f33dc1f4043c8b472f511.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/0*2W34M8zaB057kPzw"/></div></figure><p id="fc8e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是将数据库连接到代码。为此，我们需要通过运行下面的命令，自动将数据库表和其他对象移植到代码中。</p><p id="aeaa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Scaffold-DbContext "Server=。；Database = PARTECHTrusted _ Connection = True 微软。SqlServer -OutputDir 上下文</p><p id="daec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它表示搭建的输出将存储在上下文文件夹中。</p><p id="4167" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在搭建之后，实体文件应该手动移动到 Models 文件夹中，名称空间必须更改为 Models。之后，项目的文件夹结构如下图所示。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lu"><img src="../Images/dc3c98812d208004125fc86256d68aae.png" data-original-src="https://miro.medium.com/v2/resize:fit:770/0*wP95tPz-8Qcj2JMS"/></div></figure><p id="c4be" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，数据库已经拉到代码了。让我们在这里实现一些业务逻辑。为此，我们创建了另一个名为“Services”的文件夹来存放实现业务逻辑所需的类和接口文件。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/f0f30bc8aea208ddabe8f1469bb9d946.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/0*APab3s3C4OCGfbHO"/></div></figure><p id="af63" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是添加接口和类文件。要将它们添加到“服务”文件夹中，请右键单击该文件夹并转到“添加”选项，然后选择“类别”选项。创建两个类文件，一个名为 IUserService，另一个名为 UserService。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/81736db6e9e3720e421296fd6906fd10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v8Maa1EFs9AAMhAo"/></div></div></figure><p id="2e44" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开“IUserService.cs”文件，并编辑该类以实现如下图所示的界面。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lx"><img src="../Images/f5bf87aeb99fc13d0acab6fc8747708a.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/0*5l2DSE46xHAqRAVd"/></div></figure><p id="5be6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开“UserService.cs”文件，继承 IUserService 作为接口，如下图。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/32ed65ad5509ccd6d7f4590dfd5e6b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/0*XPT1FfSuJveciTWa"/></div></figure><p id="88f8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们将实现两种方法来获取用户数据。一个用于通过指定 id 获取它，另一个用于获取所有记录。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/397576e9f098e82d14b128d5b1a49bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/0*-_WhGyqFMKco7TgP"/></div></figure><p id="09b0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在接口文件中创建两个方法的声明。并在 UserService.cs 文件中做两个方法的定义。</p><p id="c981" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这里，UserService.cs 文件依赖于数据库上下文，我们期望它作为构造函数注入的一部分。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/98072783329ed53961756bb3abcef3c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vK0-dvcimtU05cKt"/></div></div></figure><p id="dc1e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">实现业务逻辑后，转到 appsettings.json 文件。我们将在这里配置数据库连接字符串，该字符串将在应用程序内部被访问。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mb"><img src="../Images/5efe52491a9269ad5c77a52c4f48e5bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VwdqT58I4nSXL8Rk"/></div></div></figure><p id="540a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">打开 Startup.cs 文件，转到配置服务方法。这里，为 dbcontext 添加注入，并使用需要从配置文件中引用的配置。此外，将完成对 UserService 的注入，这将在调用它的控制器中使用。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/80edc52dd300612939bb966e13444b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CKNOZGuyIfDsOtOU"/></div></div></figure><p id="e754" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们已经有了数据库的业务逻辑和连接字符串。剩下的唯一部分是创建可以从外部世界消费的端点。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mc"><img src="../Images/41b8013b8b25b3424d055bdde2b318b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IOvsvq0O8QllzxKe"/></div></div></figure><p id="e7d6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">右键单击控制器文件夹，然后单击添加-&gt;控制器。并选择选项— API 控制器。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lr"><img src="../Images/5f32c097f30006ac88c8e43e27e4a937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*64BsDFoA9T-Z-AR_"/></div></div></figure><p id="0ee4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，控制器文件带有这些选项。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es md"><img src="../Images/544c8a0e6886c1f4ece7c3331d1294ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/0*v_y-xf4oF6vYs16n"/></div></figure><p id="a51e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，添加需要 IUserService 对象的构造函数。另外，创建一个新的 HttpGet 端点，它使用 IUserService 对象来调用我们在 UserService.cs 文件中创建的 GetUserData 方法。</p><p id="a9d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行应用程序的编码部分已经完成。现在，让我们运行应用程序。你看到默认的天气控制器在浏览器中打开了吗？</p><p id="9840" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将其基本 URL 复制到端口号(https://localhost:xxxxx)。现在，使用 append /API/user 并更改 HTTP 方法来获取 postman 并发送请求。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es me"><img src="../Images/bdb1a17456cad661b2a46ebcae1c4e66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/0*tfY8eDTZriHczTFH"/></div></figure><p id="845a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您是否看到数据库中的数据被我们的应用程序获取，并作为 JSON 对象显示在 postman 的响应部分？如果是，那么恭喜你，你已经创建了你的第一个微服务！</p><p id="64a8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">除此之外，您甚至可以为这个项目实现 docker，并在本地将其作为 docker 映像运行。</p><h1 id="2b9f" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">包扎</h1><p id="b3db" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">微服务不仅轻便，而且支持更快的部署选项，并限制了测试范围。这个博客给你一个在你的系统中创建和测试微服务的步骤。所以继续尝试吧，在评论中告诉我们。</p></div><div class="ab cl mf mg gp mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="hb hc hd he hf"><p id="5f7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mm">原载于</em><a class="ae mn" href="https://www.partech.nl/nl/publicaties/2021/04/how-to-create-a-microservice" rel="noopener ugc nofollow" target="_blank"><em class="mm">https://www . partech . nl</em></a><em class="mm">。</em></p></div></div>    
</body>
</html>