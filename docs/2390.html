<html>
<head>
<title>Introduction to Fluent Migrator</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">流畅迁移器简介</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/introduction-to-fluent-migrator-21b5f7831c6?source=collection_archive---------29-----------------------#2021-05-03">https://medium.com/nerd-for-tech/introduction-to-fluent-migrator-21b5f7831c6?source=collection_archive---------29-----------------------#2021-05-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5537893b13518166f2248db18cdaab8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WeCDWKmljsr0c_n1lzwGlg.jpeg"/></div></div></figure><p id="1724" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任何项目的一个关键方面是管理数据库迁移。在开发应用程序时，团队成员的协同工作至关重要，尤其是在处理数据库时。</p><p id="3b5f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">开发应用程序时，数据库是手动管理的。例如，开发人员经常创建用于更新表和存储过程的SQL脚本。然后，他们必须按照一定的顺序管理它们，以便它们能够在上层环境中顺利执行。</p><p id="2c21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简而言之，管理数据库一点也不容易。这就是Fluent Migrator派上用场的地方。这是一个工具，有助于解决上述所有问题和更多。让我们从了解什么是Fluent Migrator及其工作原理开始这篇文章。</p><p id="f7e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">目录</strong></p><ul class=""><li id="2258" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">什么是流利的迁移者？</li><li id="3aa5" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">一个流利的迁移者是如何工作的？</li><li id="c9eb" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Fluent Migrator中的有用功能和技术</li><li id="bf7e" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">结论</li></ul><h1 id="4335" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">什么是流利的迁移者？</h1><p id="74c9" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">Fluent Migrator是一个用于. NET中数据库迁移的框架。它涉及到编写一系列可以创建和修改数据库和数据的类。Fluent Migrator中的每个类都描述了一次迁移，即从空数据库迁移到填充了一些信息的数据库。</p><p id="022e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了使用Fluent迁移器，模式更改是在具有两种方法的类中编写的</p><p id="48bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">顾名思义，Up()方法用于升级数据库，而Down()方法用于降级数据库。</p><p id="b08f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">使用Fluent Migrator时，您还可以调出要迁移到的版本。当您这样做时，所有必要的迁移将以这样一种方式运行，即您的数据库更新到您希望它迁移到的版本。</p><h1 id="b158" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">Fluent Migrator是如何工作的？</h1><p id="397f" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">从“Migration”基类继承的简单C#类称为迁移类。迁移的版本号作为唯一标识符放在每个类的迁移属性中。当多个开发人员创建迁移时，可以使用YYYYMMDDHHMM格式来避免不同开发人员之间的迁移冲突。或者，也可以用一个增量整数来代替。</p><p id="060e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在每个类的迁移属性中分配一个惟一的标识符后，实现Up()和Down()方法。例如，可以使用Up()方法在数据库中创建一个新表，而使用Down()方法可以从数据库中删除一个表。</p><p id="4d85" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Migrate.exe是Fluent迁移器附带的迁移运行器工具。它用于以正确的顺序执行像Up()和Down()这样的迁移类的方法。为了自动化迁移过程，可以在任何持续集成(CI)工具中完成Migrate.exe的集成，如Team-City、Azure DevOps Server、Jenkins等。“版本”表由Fluent迁移器维护，以跟踪在数据库中执行的迁移版本。</p><h1 id="205d" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">FluentMigrator中的有用功能和技术</h1><h2 id="3e1d" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">处理多种数据库类型</h2><p id="7ac4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在同一个迁移项目中，您可以将多个数据库类型作为Fluent迁移器的目标。请记住这一点，FluentMigrator中的每个项目都是与数据库无关的。然而，总有这样的情况，在一个项目中，您只需要针对一个数据库执行少量的迁移。在这种情况下，可以在FluentMigrator中使用IfDatabase表达式。</p><p id="dd75" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">假设您有一个运行脚本文件来创建视图的迁移。这是它看起来的样子-</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div class="er es lt"><img src="../Images/5384605ffcfe3d38cf138ae1ec67529f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/0*aLBfS1ZCG-hDZc-G"/></div></figure><p id="1cea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在设想一个场景，您希望在SQLServer数据库中创建几个视图，在Oracle数据库中创建几个视图。您还希望在同一个迁移中执行这两个任务，并让它们在两个数据库中共享相同的迁移号。这很容易处理，首先为两个数据库创建脚本，然后指定需要执行哪个数据库:</p><figure class="lu lv lw lx fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/5ce957117553fc9222b027f3c036a17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0lbdlJ9OVQ994MlW"/></div></div></figure><h2 id="6fe5" class="lf kd hi bd ke lg lh li ki lj lk ll km jb lm ln kq jf lo lp ku jj lq lr ky ls bi translated">过滤器迁移基于标记运行</h2><p id="4115" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">曾经有一段时间，多个数据库有相同的模式。但是这些年来这已经改变了，因为你可以看到它们之间的差异。因此，单个程序集中的绝大多数迁移都可以针对所有数据库执行。但是，您还必须筛选特定于国家和环境的数据库中运行的迁移。</p><p id="42d9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了在Fluent Migrator中实现这一点，您可以标记迁移，然后通过将标记传递到runner中来过滤它们。一旦迁移被过滤，只有那些没有标签或者所有标签都被传递到运行器中的迁移才会被执行。</p><h1 id="c526" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">结论</h1><p id="71fd" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">使用Fluent Migrator，您可以轻松升级和降级数据库，还可以通过将其与任何配置项集成来自动化数据库迁移过程。这是一个非常方便的工具，因为数据库管理不仅是任何开发项目的关键部分，也是一个具有挑战性的部分。</p></div><div class="ab cl lz ma gp mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hb hc hd he hf"><p id="6c2f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="mg">原载于</em><a class="ae mh" href="https://www.partech.nl/nl/publicaties/2021/05/introduction-to-fluent-migrator" rel="noopener ugc nofollow" target="_blank"><em class="mg">https://www . partech . nl</em></a><em class="mg">。</em></p></div></div>    
</body>
</html>