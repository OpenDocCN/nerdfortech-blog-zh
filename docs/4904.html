<html>
<head>
<title>Ethereum JavaScript API- web3.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以太坊JavaScript API- web3.js</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ethereum-javascript-api-web3-js-c02e4434cd52?source=collection_archive---------4-----------------------#2021-08-13">https://medium.com/nerd-for-tech/ethereum-javascript-api-web3-js-c02e4434cd52?source=collection_archive---------4-----------------------#2021-08-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6b3112af34979c8984df0790609ed920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FWWdOX85i6BtfcDixDxYlg.jpeg"/></div></div></figure><h2 id="d14f" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">介绍</h2><p id="628c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">在这篇文章中，我们将讨论如何开始使用Web3.js库。以太坊<a class="ae kj" href="https://www.technologiesinindustry4.com/javascript-yui-test-framework/" rel="noopener ugc nofollow" target="_blank"> JavaScript </a> API web3.js是库的集合。它允许我们使用HTTP、IPC或WebSocket与本地或远程以太坊节点建立联系。</p><p id="f339" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">Web3.js允许我们完成开发与以太坊区块链交互的客户端的职责。它是一个库的集合，使我们能够做像这样的活动；</p><ul class=""><li id="9f0f" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">将乙醚从一个帐户转到另一个帐户</li><li id="5caa" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">从智能合约交付和写入数据</li><li id="82dd" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">签订明智的合同，并且</li><li id="0006" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">更加</li></ul><h2 id="30bf" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">描述</h2><p id="09a1" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">web3.js库是一个开源的JavaScript库。它是由以太坊基金会制作的。它包括通过JavaScript对象符号—远程过程调用(JSON-RPC)协议与以太坊节点连接的函数。这是一个JavaScript库，使开发者能够与以太坊区块链进行交互。Web3.js目前的版本是1.2.9。它由四个模块组成。</p><h2 id="5d3a" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是模块？</h2><p id="3e62" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">JavaScript中的模块是在大型程序中具有精确功能的代码。模块将是独立的。因此，如果我们从一个库、程序或应用程序中删除一个模块，整个库、程序或应用程序不会停止工作。</p><h2 id="e4f9" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">模块组成了web3.js</h2><p id="a2d9" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">Web3.js有一个名为Web3的关键类。该库的大部分功能都源于这个类。以下是组成web3js的五个附加模块:</p><p id="014a" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-eth</p><p id="5108" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-eth模块具有允许web3.js用户与以太坊区块链交互的功能。这些功能是智能交互的；</p><ul class=""><li id="2196" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">智能合同</li><li id="4833" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">外部拥有的账户</li><li id="b06b" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">节点</li><li id="7776" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">开采的区块</li></ul><p id="0fda" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">下面给出三个说明性的例子:</p><ul class=""><li id="5b20" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">getBalance使我们能够成为给定块中地址的ETH balance。</li><li id="2141" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">eth.signTransaction允许我们签署交易。</li><li id="38f9" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">eth.sendSignedTransaction允许我们将已签名的交易发送到区块链以太坊。</li></ul><p id="c9db" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">网络3-嘘</p><p id="912c" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-shh模块允许我们使用耳语协议。耳语是一种信息协议。它旨在简单地广播消息，并用于低级异步通信。下面显示了两个描述性插图:</p><ul class=""><li id="468c" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">嘘。在网络上发布一条悄悄话。</li><li id="c585" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">shh.subscribe订阅传入的耳语消息。</li></ul><p id="d910" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated"><strong class="jq hj"> web3-bzz </strong></p><p id="9a96" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-bzz模块使我们能够与Swarm交互。Swarm是一个去中心化的存储平台。它也是一种内容分发服务。它可以作为一个家来存储文件，例如我们的分散应用程序的图像或视频。下面给出了两个描述性的例子:</p><ul class=""><li id="75fe" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">bzz。上传允许我们上传文件和文件夹到Swarm</li><li id="7f2e" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">bzz。下载使我们能够从Swarm下载文件和文件夹</li></ul><p id="93a4" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated"><strong class="jq hj">网三网</strong></p><p id="8ad7" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-net模块允许我们与以太坊节点的网络属性相关联。通过使用web3-net可以让我们找到关于节点的信息。下面给出两个说明性的例子:</p><ul class=""><li id="1592" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">. net.getID继续网络ID</li><li id="b2ca" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">. net.getPeerCount处理与该节点关联的对等方的数量。</li></ul><p id="329d" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated"><strong class="jq hj"> web3-utils </strong></p><p id="6426" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">web3-utils模块为我们提供了实用功能。我们可以在以太坊Dapp中与其他web3.js模块一起使用。效用函数是一个可返回的函数，用于简化代码编写，这在JavaScript和其他编程语言中很常见。Web3-utils包含实用函数。它改变数字，确认某个值是否发生在特定条件下，并搜索数据集。三幅描述性插图如下所示:</p><ul class=""><li id="c7db" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">把乙醚换成魏。</li><li id="35a3" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">utils.hexToNumberString将十六进制值更改为字符串。</li><li id="2a0a" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">utils。如果提供的字符串是有效的以太坊地址，则为地址格式。</li></ul><h2 id="0f05" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">装置</h2><p id="396c" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">我们可以在终端中安装带有NPM的Web3.js库，如下所示:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="b0c8" class="iq ir hi li b fi lm ln l lo lp">$ npm install web3</span></pre><h2 id="5e36" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Infura RPC URL</h2><p id="3fa3" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">我们需要访问以太坊节点，以便通过主网上的JSON RPC连接到以太坊节点。我们有一些方法可以做到这一点。首先，我们可以用Geth或奇偶校验运行我们自己的以太坊节点。尽管如此，这需要我们从区块链下载大量数据并同步。如果我们以前尝试过这样做，这将是一个巨大的麻烦。</p><p id="cdf9" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">我们可以使用Infura来访问以太坊节点，而不需要手动运行，主要是为了适用性。Infura是一个免费提供远程以太坊节点的设施。我们需要做的是注册，获得一个API密钥和我们想要连接的网络的RPC URL。</p><p id="d88b" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">注册后，我们的Infura RPC URL应该是这样的:</p><p id="b718" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">https://mainnet.infura.io/YOUR_INFURA_API_KEY<a class="ae kj" href="https://mainnet.infura.io/YOUR_INFURA_API_KEY" rel="noopener ugc nofollow" target="_blank"/></p><h2 id="15cb" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">用Web3.js从智能合约中读取数据</h2><p id="7d1b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">我们可以用web3.eth.Contract()函数实现以太坊智能合约的JavaScript表示。该函数需要两个参数:</p><ul class=""><li id="8bfa" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">一个是智能合同ABI</li><li id="0f9c" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">一个用于智能合同地址。</li></ul><p id="f35d" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">智能契约ABI是一个JSON数组。它定义了一个精确的智能合约是如何工作的。下面是ABI的一个实例:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="3fcc" class="iq ir hi li b fi lm ln l lo lp">const abi = [{"constant":true,"inputs":[],"name":"mintingFini</span></pre><p id="c6ef" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">如何使用Web3.js部署智能合约</p><p id="4823" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">我们可以通过许多方式将智能合约部署到以太坊区块链。在Web3.js本身中，有多种方法可以部署它们。我们将使用app.js文件，并对其进行如下设置:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="dac6" class="iq ir hi li b fi lm ln l lo lp">var Tx = require('ethereumjs-tx')</span><span id="8459" class="iq ir hi li b fi lq ln l lo lp">const Web3 = require('web3')</span><span id="a688" class="iq ir hi li b fi lq ln l lo lp">const web3 = new Web3('https://ropsten.infura.io/YOUR_INFURA_API_KEY')</span><span id="c5fb" class="iq ir hi li b fi lq ln l lo lp">const account1 = '' // Your account address 1</span><span id="3ed8" class="iq ir hi li b fi lq ln l lo lp">const privateKey1 = Buffer.from('YOUR_PRIVATE_KEY_1', 'hex')</span><span id="ac5c" class="iq ir hi li b fi lq ln l lo lp">This example has consisted on three basic steps:</span></pre><ul class=""><li id="67e5" class="kp kq hi jq b jr kk jv kl jb kr jf ks jj kt ki ku kv kw kx bi translated">构建事务对象</li><li id="c1b0" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">签署交易</li><li id="d8a6" class="kp kq hi jq b jr ky jv kz jb la jf lb jj lc ki ku kv kw kx bi translated">发送交易</li></ul><p id="e87e" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">到目前为止，我们一直在构建一个交易并将其发送到网络。公正的差异是交易参数。</p><p id="e3ac" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">接下来，我们将像这样构建事务对象:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="ffd6" class="iq ir hi li b fi lm ln l lo lp">const txObject = {</span><span id="8c7c" class="iq ir hi li b fi lq ln l lo lp">  nonce:    web3.utils.toHex(txCount),</span><span id="236c" class="iq ir hi li b fi lq ln l lo lp">  gasLimit: web3.utils.toHex(1000000), // Raise the gas limit to a much higher amount</span><span id="c0df" class="iq ir hi li b fi lq ln l lo lp">  gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),</span><span id="7c9c" class="iq ir hi li b fi lq ln l lo lp">  data: data</span><span id="14a2" class="iq ir hi li b fi lq ln l lo lp">}</span></pre><p id="9183" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">数据参数是十六进制智能协定的编译后的字节码表示。为了获得这个价值，我们首先需要一个智能契约。然后我们需要编译它。我们欢迎使用任何我们喜欢的智能合约。不过，我们将使用一个ERC-20令牌智能契约以及附带的Web3.js。我们可以在编译完契约后将数据值赋给一个变量。</p><p id="8c16" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">现在，我们还可以通过获取事务计数来分配nonce值:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="b2ab" class="iq ir hi li b fi lm ln l lo lp">web3.eth.getTransactionCount(account1, (err, txCount) =&gt; {</span><span id="2d5b" class="iq ir hi li b fi lq ln l lo lp">  const data = '' // Your data value goes here...</span><span id="a868" class="iq ir hi li b fi lq ln l lo lp">  const txObject = {</span><span id="1060" class="iq ir hi li b fi lq ln l lo lp">    nonce:    web3.utils.toHex(txCount),</span><span id="c39e" class="iq ir hi li b fi lq ln l lo lp">    gasLimit: web3.utils.toHex(1000000),</span><span id="fa54" class="iq ir hi li b fi lq ln l lo lp">    gasPrice: web3.utils.toHex(web3.utils.toWei('10', 'gwei')),</span><span id="bf97" class="iq ir hi li b fi lq ln l lo lp">    data: data</span><span id="bfa0" class="iq ir hi li b fi lq ln l lo lp">  }</span><span id="02a8" class="iq ir hi li b fi lq ln l lo lp">})</span></pre><p id="21b7" class="pw-post-body-paragraph jo jp hi jq b jr kk jt ju jv kl jx jy jb km ka kb jf kn kd ke jj ko kg kh ki hb bi translated">更多详情请访问:<a class="ae kj" href="https://www.technologiesinindustry4.com/ethereum-javascript-api-web3-js/" rel="noopener ugc nofollow" target="_blank">https://www . technologiesinindustry 4 . com/ether eum-JavaScript-API-web 3-js/</a></p></div></div>    
</body>
</html>