<html>
<head>
<title>Efficient memory usage in Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">熊猫的有效内存使用</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/efficient-memory-usage-in-pandas-e71d1e6f8314?source=collection_archive---------1-----------------------#2021-10-23">https://medium.com/nerd-for-tech/efficient-memory-usage-in-pandas-e71d1e6f8314?source=collection_archive---------1-----------------------#2021-10-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="78f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你加载一个大文件到pandas Dataframe，object中时，pandas会消耗比预期更多的内存。在这篇博客中，我们将尝试通过一些最佳实践来缓解这一问题</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b537aa1a80d22f9c8c9fd53f0311e403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1Cbw2G--yek_QpSZ"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">由<a class="ae jt" href="https://unsplash.com/@austindistel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Austin Distel </a>在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="bfd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">类型转换</strong></p><p id="0898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将数据类型视为多个用例</p><ul class=""><li id="e2c9" class="ju jv hi ih b ii ij im in iq jw iu jx iy jy jc jz ka kb kc bi translated">减少内存使用</li><li id="6357" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">不匹配类型</li><li id="2252" class="ju jv hi ih b ii kd im ke iq kf iu kg iy kh jc jz ka kb kc bi translated">特定类型</li></ul><p id="d610" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们关注一下内存管理<code class="du ki kj kk kl b">int64</code>比<code class="du ki kj kk kl b">int8</code>占用更多的内存。当我们从CSV文件加载数据时，如果我们没有为每一列指定<code class="du ki kj kk kl b">dtype</code>，默认的<code class="du ki kj kk kl b">dtype</code>将是<code class="du ki kj kk kl b">int64</code>、<code class="du ki kj kk kl b">float64</code>或<code class="du ki kj kk kl b">object</code>。这些都是最大的数据类型。如果一列只存储从0到20的数字，<code class="du ki kj kk kl b">int8</code>就足够了。对于<code class="du ki kj kk kl b">float64</code>，可以用<code class="du ki kj kk kl b">float32</code>代替。</p><p id="97ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看能省多少内存。检查用法的示例代码片段</p><pre class="je jf jg jh fd km kl kn ko aw kp bi"><span id="d191" class="kq kr hi kl b fi ks kt l ku kv">import numpy as np<br/>import pandas as pd<br/>data = np.random.randint(-100, 100, size=(50000, 10))<br/>df = pd.DataFrame(d)<br/>print(“The total information about original object”)<br/>print(df.info())<br/>print(“The memory usage of all columns”)<br/>print(df.memory_usage())<br/>print('--------------')<br/>intCols = df.select_dtypes(include=[‘int64’]).columns.tolist()<br/>df[intCols] = df[intCols].apply(pd.to_numeric, downcast=’integer’)<br/>print(“The total information about modified object”)<br/>print(df.info()<br/>print(“The memory usage of all columns”)<br/>print(df.memory_usage())</span></pre><p id="083a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有个结论，优化效果非常明显。总内存使用量从<code class="du ki kj kk kl b">1.5MB</code>下降到了<code class="du ki kj kk kl b">195KB</code>，非常可观。内存使用量减少了近<code class="du ki kj kk kl b">90 percent</code>。我们唯一做的事情是将数据类型从<code class="du ki kj kk kl b">int64</code>改为<code class="du ki kj kk kl b">int8</code>。</p><p id="063d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">使用类别类型代替对象</strong></p><p id="ba26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在现实世界中，一些列的对象类型选择有限。例如，在一个有1亿行的数据集中，有一个名为<code class="du ki kj kk kl b">Continent</code>的列标识了七大洲之一，虽然这个数据集有1亿行，但我们知道世界上只有几百个地区和国家。如果每行存储一个对象，这是对内存的巨大浪费。在pandas中，我们可以使用<code class="du ki kj kk kl b">category</code>类型而不是<code class="du ki kj kk kl b">object</code>用于此列。</p><pre class="je jf jg jh fd km kl kn ko aw kp bi"><span id="8015" class="kq kr hi kl b fi ks kt l ku kv">import pandas as pd<br/>import string<br/>import random<br/>l = [''.join(random.choice(string.ascii_uppercase + string.digits) for _ in range(2))<br/>for i in range(2000000)]<br/>   s = pd.Series(l)<br/>print("The original series memory usage")<br/>print(s.memory_usage())<br/>s = s.astype("category")<br/>print("The modified series memory usage")<br/>print(s.memory_usage())</span></pre><p id="7abf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从结果来看，category显然表现得更好，一定要试一试！</p><p id="5649" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">加载CSV文件时指定列类型</strong></p><p id="8b50" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是我们已经知道的更多的提示，您可以在加载CSV文件时指定列类型。此外，您不需要加载所有列，您可以只加载列的子集。在现实世界中，大多数数据都存储在文件中。最常见的文件类型是CSV。</p></div><div class="ab cl kw kx gp ky" role="separator"><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb lc"/><span class="kz bw bk la lb"/></div><div class="hb hc hd he hf"><p id="74b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这篇文章对你有所帮助，请在评论中分享你对改进这篇文章的想法，干杯！</p></div></div>    
</body>
</html>