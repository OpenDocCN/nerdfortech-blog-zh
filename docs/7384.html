<html>
<head>
<title>How to Generate an Amazon ECS Cluster using Docker Image with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Docker Image 和 Terraform 生成 Amazon ECS 集群</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-generate-an-amazon-ecs-cluster-using-docker-image-with-terraform-23396b7fc4f7?source=collection_archive---------2-----------------------#2022-10-15">https://medium.com/nerd-for-tech/how-to-generate-an-amazon-ecs-cluster-using-docker-image-with-terraform-23396b7fc4f7?source=collection_archive---------2-----------------------#2022-10-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2205" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">简要介绍如何从 Docker 注册表中提取 CentOS 映像，并使用 Docker 映像和 Terraform 创建 ECS 集群。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/81e440d719a9201089df8f8282a0516f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BBYPY_ZjoDtuBiYQcETB6A.png"/></div></div></figure><p id="ff0d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">目标:</strong>使用 CentOS 映像部署 Docker 容器。</p><p id="186b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件:</strong> Terraform &amp; Docker 安装，AWS 账号，AWS CLI，Cloud9。</p><p id="ff66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">资源</strong>:演练所需的一切都可以在<a class="ae jp" href="https://www.terraform.io/docs" rel="noopener ugc nofollow" target="_blank">这里</a>找到。偶尔，当我遇到错误时，我会在<a class="ae jp" href="https://stackoverflow.com/" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a>中结束。一定要将 Stack Overflow 加入书签，因为它将是你在谷歌之外的最好的朋友之一。</p><p id="adb6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jq">现在来说说好东西……</em></p><p id="9744" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，创建目录和。tf 文件。我创建了一个新目录，在这个目录中，你将拥有这个项目的所有地形文件。使用<code class="du jr js jt ju b">mkdir</code>创建目录，并使用<code class="du jr js jt ju b">cd</code>导航至目录。然后我创建了我所有的文件<code class="du jr js jt ju b">main.tf, variables.tf, vpc.tf, subnets.tf, keys.tvars</code>。然后，我使用<code class="du jr js jt ju b">touch</code>命令，将 Docker 和 AWS 作为提供者，并将 AWS ECS 集群资源和 Fargate 模块添加到<code class="du jr js jt ju b">main.tf</code>文件中。</p><p id="959e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jr js jt ju b">variables.tf</code>文件由 VPC、访问密钥和秘密访问密钥组成。<code class="du jr js jt ju b">vpc.tf</code>由 VPC 标签名组成。这同样适用于<code class="du jr js jt ju b">subnet.tf</code>,除了它是子网的标记名、VPC 名称，以及附加的可用性区域等。最后,<code class="du jr js jt ju b">keys.tvars</code>持有<em class="jq">秘方，</em>你永远不会分享这些信息，那就是访问密钥和秘密密钥。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jv jw l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jv jw l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jv jw l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jv jw l"/></div></figure><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="jv jw l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/11beabf26aeedcece15b3955b810ecda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HhX5UMV9vj6T2_8xF6GLw.png"/></div></div></figure><p id="ad7b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我用<code class="du jr js jt ju b">terraform init</code>初始化 Terraform。然后我使用了<code class="du jr js jt ju b">terraform plan</code>来检查 Terraform 将用来修改基础设施的动作的预览，最后我使用了<code class="du jr js jt ju b">terraform fmt and terraform validate</code>，它用于重写 Terraform 配置文件并验证目录中的配置文件。</p><p id="dad5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的第一次尝试中，我遇到了一个错误，并立即转换到调查模式，使用了本文开头提到的资源。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/a7b6bd2c04eca20c1b132719726181df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MuX53ktIg0p_I22DgHs27w.png"/></div></div></figure><p id="d683" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">根据我的研究，在授权过程中出现了问题，但是一旦问题得到纠正，我会再次重新执行<code class="du jr js jt ju b">terraform plan, fmt, and validate</code>。一旦我确认配置是正确的，我就使用<code class="du jr js jt ju b">Terraform apply</code> <strong class="ih hj">。</strong>此<strong class="ih hj"> </strong>使用相关基础设施提供商的 API 对每个资源执行计划的更改，并通过让您键入<code class="du jr js jt ju b">yes</code>进行确认来进行验证。要<code class="du jr js jt ju b">terraform apply</code>改变而不必键入‘是’，你可以试试<code class="du jr js jt ju b">terraform apply -auto-approve</code>。我还没有尝试过，但在自动化领域会很有用。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jy"><img src="../Images/1004ddc19d4c9a8f71de78b2258111a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*pipesnZiF0gUMyxu77C8og.png"/></div></figure><p id="fd83" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，我检查以确保所有资源在我的 AWS 控制台上都正常工作。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jz"><img src="../Images/b0a85411ffd47b21c064852d15954642.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*MaUyntUf4hErriko8VGgeA.png"/></div></figure><p id="bc07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">没有什么比成功的甜蜜味道更好的了！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ka"><img src="../Images/f9d3e877a3db09f39a979d22407a2d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*fAMlwyM9tqFYzB-St8dK8w.gif"/></div></figure><p id="1d31" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我用<code class="du jr js jt ju b">terraform destroy</code>结束所有资源。对于使用该命令的其他方式，<code class="du jr js jt ju b">destroy</code>点击<a class="ae jp" href="https://www.terraform.io/cli/commands/destroy" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kb"><img src="../Images/e36d3c907c74d4d67fb5a50cd67fbc2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:894/format:webp/1*rIQyw7vStDA-oWWOrZDHkA.png"/></div></figure><p id="005d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">感谢您的阅读！！</p></div></div>    
</body>
</html>