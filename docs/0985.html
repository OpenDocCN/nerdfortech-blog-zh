<html>
<head>
<title>Angular 11: Insert external HTML in your own website — Web scraping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Angular 11:在自己的网站中插入外部HTML网络抓取</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/angular-11-insert-external-html-in-your-own-website-web-scraping-ff78f2540c4b?source=collection_archive---------2-----------------------#2021-02-28">https://medium.com/nerd-for-tech/angular-11-insert-external-html-in-your-own-website-web-scraping-ff78f2540c4b?source=collection_archive---------2-----------------------#2021-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="351d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想我会试着与你分享一个有趣问题的小解决方案(注意我是如何与“你”分享的——如果你在这里，我欢迎你并很高兴能够帮助你——如果你不在这里，没有人会注意到我使用了“你”这个词)。聪明呵；)</p><p id="448d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前几天，我们不得不在入职表格中加入新的条款。问题是，这些条款是在一个外部网站上托管的。我们的网站是在Angular 11中建立的，这似乎是一个可以在几秒钟内完成的小问题。如果你忽略了UX的部分。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/e9b30d95b570c235528b343c5edf9206.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*2VdSck6Uehd0huQB5AutUQ.png"/></div></figure><p id="a406" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个建议仅仅是一个指向URL的a元素，其中包含:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="2625" class="jq jr hi jm b fi js jt l ju jv">&lt;mat-checkbox [checked]=”accept” (change)=”accept = !accept”&gt;<br/>  {{ ‘I have read and accepted’ | translate }}<br/>&lt;/mat-checkbox&gt;<br/>&lt;a href=”https://your/external/terms/” target=”_blank”&gt;<br/>  {{ ‘terms’ | translate }}<br/>&lt;/a&gt;</span></pre><p id="4e8f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这样做的主要问题是，您的用户现在在入职过程中被抛到外部网站。此外，没有简单的方法回来；您不能在外部页面上选择“接受”,您必须再次手动关闭页面并返回表单，等等。只是不是好UX。</p></div><div class="ab cl jw jx gp jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="hb hc hd he hf"><p id="a61e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">解决方案—网页抓取</strong></p><p id="3e10" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为什么不从外部网站抓取条款文本，并将其插入到一个模态中？就这么办吧。</p><p id="255d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们需要知道我们要去哪里，要得到什么。“在哪里”只是网站的网址。</p><p id="a8b7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用async/await(我相信是ES7)并首先获取整个网页HTML:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="5992" class="jq jr hi jm b fi js jt l ju jv">(async () =&gt; {<br/>  const response = await fetch('https://your/external/terms/');<br/>  const text = await response.text();<br/>  console.log(text);<br/>})();</span></pre><p id="a29e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后控制台将打印出所有的HTML——但是有一个条件:这是一个字符串！<br/>提示:您可以直接在浏览器中完成此操作，方法是转到外部URL，在开发人员工具中打开控制台，粘贴上述代码，然后点击“Enter”:</p><p id="8866" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于“什么”,请访问该网站，右键单击文本并选择“检查元素”。这就是我的情况:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kd"><img src="../Images/1e1d31f054180032640c018ae4fb9637.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*YURKJ1534v2V4hnjIIdRtA.png"/></div></figure><p id="40c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">蓝色标记的DIV是我需要的。我能直接处理的最接近的东西是带有ID="sidebar "的兄弟DIV，所以让我们试试。</p><p id="8dd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在这里面临的挑战是，我们不能在字符串格式的HTML中导航——我们需要一个DOM，所以让我们将字符串“还原”成HTML。</p><p id="67ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我选择了一个使用和维护良好的npm包<code class="du ke kf kg jm b">node-html-parser</code>，并将<code class="du ke kf kg jm b">import { parse } from ‘node-html-parser';</code>添加到我的组件中。所以让我们把它付诸实践。</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="d452" class="jq jr hi jm b fi js jt l ju jv">(async () =&gt; {<br/>  const response = await fetch('https://your/external/terms/');<br/>  const text = await response.text();<br/>  const terms = parse(text);<br/>})();</span></pre><p id="984e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ke kf kg jm b">terms</code>现在是转换成HTML的字符串，我们现在可以遍历它，所以我们将取出DIV <code class="du ke kf kg jm b">#sidebar</code>，转到下一个兄弟节点并获取内部HTML。</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="aa14" class="jq jr hi jm b fi js jt l ju jv">htmlTerms: string;</span><span id="ed29" class="jq jr hi jm b fi kh jt l ju jv">(async () =&gt; {<br/>  const response = await fetch('https://your/external/terms/');<br/>  const text = await response.text();<br/>  const terms = parse(text);<br/>  this.htmlTerms = terms.querySelector('#sidebar').nextElementSibling.innerHTML;<br/>})();</span></pre><p id="6350" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，我们用response.text()将所有的HTML作为一个字符串取出，但是为了得到有趣的部分，我们用parse(text)将它解析回HTML，并用<code class="du ke kf kg jm b">terms.querySelector('#sidebar').nextElementSibling.innerHTML;</code>遍历这个新创建的DOM。<br/>现在您又有了一个包含您需要的确切内容的字符串，并且可以使用属性<code class="du ke kf kg jm b">htmlTerms</code>将它直接放在您自己的组件视图中。</p><p id="0ff3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请注意，Angular内置于XSS，你可能需要更多的操纵比上面显示的。此外，如果外部网页与您的抓取代码相关的更改，您将失去HTML。因此，为了以防万一，你可能需要一些错误处理；)</p><p id="27c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我为术语选择了一个交互模式(德语；)但是你想怎么实现就怎么实现。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="er es ki"><img src="../Images/318a67bb106204c476f75d0c6f3d067b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*km6rMkRYaPsiUPnMCJU2sA.png"/></div></div></figure><p id="0e37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你当然可以操纵代码或添加你自己的风格(或他们的风格)，但你操纵得越多，如果原来的网站被改变，就越容易崩溃，所以我更喜欢KISS。</p><p id="e2cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">玩得开心。</p></div></div>    
</body>
</html>