<html>
<head>
<title>How long is an SMS? And how to best handle the UX.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一条短信有多长？以及如何最好地处理UX。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-long-is-an-sms-and-how-to-best-handle-the-ux-88a75e161f43?source=collection_archive---------10-----------------------#2021-03-17">https://medium.com/nerd-for-tech/how-long-is-an-sms-and-how-to-best-handle-the-ux-88a75e161f43?source=collection_archive---------10-----------------------#2021-03-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d096" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是另一个有趣的挑战，我最近重构了一个客户的短信服务，遇到了不少问题。(哦，顺便说一句，SMS是你通常在手机上发送的文本消息——可能不会考虑它的长度😉)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/7cb9e7fcb73e3d81c8b7d866dce3d8b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D9SW8JZYstL3FYnYbNMBDw.jpeg"/></div></div></figure><p id="bd85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关于短信长度的一些背景信息</strong></p><p id="3808" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一条标准短信最多可以容纳160个字符。如果你输入161个字符，从技术上讲，你将发送2条短信，但这些短信将无缝连接，因此接收者会将其视为一条短信。这听起来很简单，但有趣的地方就在这里🙃</p><p id="0160" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这取决于…几件事。</p><p id="dca7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像一些短信提供商保留字符/字节用于拼接多条短信，因此每条标准短信只需要153个字符…</p><p id="9470" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你用西班牙语写你的情书，你可能最多有155个字符——减去一些其他的东西…</p><p id="eba5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您选择插入一个💕你的莎士比亚才能将不得不在仅仅70个字符中显露出来🤔</p><p id="edaa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">问题是，用户不能直接看到这一点。因此，如果唐璜(在这个例子中是英国人)用159个字符(1条短信)发送他的爱，并以一个漂亮的结尾💕他现在将被收取3条短信共160封“信”的费用。</p><p id="0c20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">搞什么鬼？为什么这很重要？</strong></p><p id="8e6d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你使用的智能手机不具备包含短信的昂贵服务，而是需要一个API来向成百上千的短信接收者发送短信时，你将不得不为每条短信付费。大量的这些并不便宜。所以你基本上想避免为每条短信支付2或3条短信的费用。</p><p id="3f3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先，你将不得不看看你的短信API，看看他们有什么缺陷或不包括。</p><p id="b617" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第二，你必须决定如何处理这个UX。</p><p id="8478" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">简单易行的解决方案</strong></p><p id="2c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">"我不在乎，我会支付额外的费用."</p><p id="d8a3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">几乎一样简单的解决方案</strong></p><p id="0e19" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“我只需‘询问’API，然后在1条短信后删除文本”</p><p id="392b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">趣味解决方案(带更好的UX) </strong></p><p id="d2cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">范围:我们希望实时通知用户，而不会有太多的麻烦。</p><p id="ec3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">免责声明:您可以通过为每个字符请求SMS API来解决以下问题。但那有什么好玩的🤭</p><p id="4c13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jp">允许160 char标准短信。</em> </strong> <br/>这意味着“仅”使用+128字符的标准GSM-7字符集。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="0f03" class="jv jw hi jr b fi jx jy l jz ka">this.gsm7 = ['@', '£', '$', '¥', 'è', 'é', 'ù', 'ì', 'ò', 'Ç', 'Ø', 'ø', 'Å', 'å', 'Δ', '_', 'Φ', 'Γ', 'Λ', 'Ω', 'Π', 'Ψ', 'Σ', 'Θ', 'Ξ', '^', '{', '}', '\\', '[', '~', ']', '|', '€', 'Æ', 'æ', 'ß', 'É', '!', '"', '#', '¤', '%', '&amp;', '\'', '(', ')', '*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&lt;', '=', '&gt;', '?', '¡', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'Ä', 'Ö', 'Ñ', 'Ü', '§', '¿', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'ä', 'ö', 'ñ', 'ü', 'à', ' ']</span></pre><p id="0000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">标准GSM-7上SMS的长度。<br/>这里我们取消息字段，每次修改时，我们检查gsm7数组中的整个字符串。这在添加和删除字段中的字符时有效。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="ae1b" class="jv jw hi jr b fi jx jy l jz ka">gsm7: string[];</span><span id="4946" class="jv jw hi jr b fi kb jy l jz ka">onValueChanges(): void {<br/>  this.message.valueChanges.pipe(<br/>    tap((value: string) =&gt; {<br/>      [...value].forEach((char: string) =&gt; {<br/>        if (this.gsm7.find(element =&gt; element === char)) {<br/>          this.maxAllowed = 160;<br/>        }<br/>      });<br/>    }),<br/>  ).subscribe();<br/>}</span></pre><p id="8dee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jp">允许非标准短信。</em>T19】</strong></p><p id="5b16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们必须决定如何处理gsm7数组之外的消息字符串。我们可以去所有的细节，并找出究竟是哪些字符导致每条短信字符较少，但我决定如下。</p><p id="b621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当处理gsm7之外的2字节字符(即一些西班牙字符，如ú)时，我们有最大145–155个字符范围内的消息，而在gsm7之外，我们有最大70个字符和4字节字符(表情符号等)的消息。</p><p id="7815" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我测量4字节字符</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="9b65" class="jv jw hi jr b fi jx jy l jz ka">(new Blob([char]).size === 4)</span></pre><p id="76c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">并将这些消息的最大长度设置为70，否则我会将固定长度设置为140，如下所示。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="b981" class="jv jw hi jr b fi jx jy l jz ka">gsm7: string[];</span><span id="21b9" class="jv jw hi jr b fi kb jy l jz ka">onValueChanges(): void {<br/>  this.message.valueChanges.pipe(<br/>    tap((value: string) =&gt; {<br/>      this.maxAllowed = 160;<br/>      [...value].forEach((char: string) =&gt; {<br/>        if (!this.gsm7.find(element =&gt; element === char)) {<br/>          if (new Blob([char]).size === 4) {<br/>            this.maxAllowed = 70;<br/>          } else if (this.maxAllowed &gt;= 140) {<br/>            this.maxAllowed = 140;<br/>          }<br/>        }<br/>      });<br/>    }),<br/>  ).subscribe();<br/>}</span></pre><p id="28a7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以进一步简化，允许140个字符的表情信息，并提示用户确认他们想给每个收件人发送2条信息。</p><p id="784c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我的解决方案中，如果他们有很多2字节字符，他们可能在很少的情况下发送2条消息，但除此之外，他们将总是只发送1条消息。这里的另一个权衡是140个字符的限制，有时他们可以发送稍微多一点的字符(实际上从不超过154个字符)。</p><p id="5eba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jp">界面中的信息</em> </strong></p><p id="c771" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我想在最大长度减少时通知用户，所以当这种情况发生时，我会插入一个通知图标和解释文本。<br/>注意，一个4字节的字符算作两个1字节的字符。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kc"><img src="../Images/e7ce18fc6e48d2e390c037f7bf396157.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ahdCkmvBpljZR6xGdlbpw.png"/></div></div></figure><p id="59b1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jp">我的解决方案中的最终代码</em> </strong></p><p id="5eb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此处未显示导入和表单。</p><pre class="je jf jg jh fd jq jr js jt aw ju bi"><span id="e1ba" class="jv jw hi jr b fi jx jy l jz ka">template: `<br/>...<br/>&lt;mat-form-field fxFlex&gt;<br/>  &lt;mat-label i18n&gt;Your message&lt;/mat-label&gt;</span><span id="3f1c" class="jv jw hi jr b fi kb jy l jz ka">  &lt;textarea matInput #message maxlength="{{ maxAllowed }}" rows="5" required formControlName="message"&gt;&lt;/textarea&gt;</span><span id="623c" class="jv jw hi jr b fi kb jy l jz ka">  &lt;mat-hint&gt;&lt;span i18n&gt;Max&lt;/span&gt;&lt;span&gt; {{ maxAllowed }} &lt;/span&gt;&lt;span i18n&gt;characters&lt;/span&gt;: {{ message.value.length }} / {{ maxAllowed }}&lt;/mat-hint&gt;</span><span id="2341" class="jv jw hi jr b fi kb jy l jz ka">&lt;/mat-form-field&gt;</span><span id="bc13" class="jv jw hi jr b fi kb jy l jz ka">&lt;div *ngIf="maxAllowed === 140"&gt;<br/>  &lt;mat-icon color="warn" aria-hidden="false" aria-label="Warning for short message"&gt; notification_important &lt;/mat-icon&gt; &lt;span style="font-size: small"&gt;&lt;strong i18n&gt;You are using special characters and can max send 140 characters in total&lt;/strong&gt;&lt;/span&gt;<br/>&lt;/div&gt;</span><span id="21a9" class="jv jw hi jr b fi kb jy l jz ka">&lt;div *ngIf="maxAllowed === 70"&gt;<br/>  &lt;mat-icon color="warn" aria-hidden="false" aria-label="Warning for shortest message"&gt; notification_important &lt;/mat-icon&gt; &lt;span style="font-size: small"&gt;&lt;strong i18n&gt;You are using special characters, probably emoji 😁, and can max send 70 characters in total - Note that one emoji counts as two characters&lt;/strong&gt;&lt;/span&gt;<br/>&lt;/div&gt;</span><span id="c641" class="jv jw hi jr b fi kb jy l jz ka">&lt;div fxFlex="16px"&gt;&lt;/div&gt;</span><span id="aa08" class="jv jw hi jr b fi kb jy l jz ka">&lt;button mat-flat-button type="submit" color="primary" fxFlex class="mat-body uppercase" [disabled]="smsForm.invalid || avoidDoubleClick" i18n&gt;Send SMS&amp;#x2026;&lt;/button&gt;<br/>...<br/>`</span><span id="dac9" class="jv jw hi jr b fi kb jy l jz ka">export class SmsCardComponent implements OnInit, OnDestroy {<br/>  gsm7: string[];<br/>  maxAllowed: number;<br/>  messageLengthObservable: Subscription;</span><span id="9e3c" class="jv jw hi jr b fi kb jy l jz ka">  // eslint-disable-next-line max-len<br/>  this.gsm7 = ['@', '£', '$', '¥', 'è', 'é', 'ù', 'ì', 'ò', 'Ç', 'Ø', 'ø', 'Å', 'å', 'Δ', '_', 'Φ', 'Γ', 'Λ', 'Ω', 'Π', 'Ψ', 'Σ', 'Θ', 'Ξ', '^', '{', '}', '\\', '[', '~', ']', '|', '€', 'Æ', 'æ', 'ß', 'É', '!', '"', '#', '¤', '%', '&amp;', '\'', '(', ')', '*', '+', ',', '-', '.', '/', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '&lt;', '=', '&gt;', '?', '¡', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', 'Ä', 'Ö', 'Ñ', 'Ü', '§', '¿', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', 'ä', 'ö', 'ñ', 'ü', 'à', ' '];</span><span id="ae13" class="jv jw hi jr b fi kb jy l jz ka">  constructor() { this.maxAllowed = 160; }<br/>  get message() { return this.smsForm.get('message'); }</span><span id="d8db" class="jv jw hi jr b fi kb jy l jz ka">  ngOnInit(): void { this.onValueChanges(); }</span><span id="456a" class="jv jw hi jr b fi kb jy l jz ka">  ngOnDestroy() {<br/>    // unsubscribing to avoid memory leak<br/>    this.messageLengthObservable.unsubscribe();<br/>  }</span><span id="eee2" class="jv jw hi jr b fi kb jy l jz ka">  onValueChanges(): void {<br/>    this.messageLengthObservable = this.message.valueChanges.pipe(<br/>      tap((value: string) =&gt; {<br/>        this.maxAllowed = 160;<br/>        [...value].forEach((char: string) =&gt; {<br/>          if (!this.gsm7.find(element =&gt; element === char)) {<br/>            if (new Blob([char]).size === 4) {<br/>              this.maxAllowed = 70;<br/>            } else if (this.maxAllowed &gt;= 140) {<br/>              this.maxAllowed = 140;<br/>            }<br/>          }<br/>        });<br/>      }),<br/>    ).subscribe();<br/>  }</span></pre><p id="4306" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这能激发你对短信和随之而来的UX的创造力。</p><p id="17d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">玩得开心🤗</p></div></div>    
</body>
</html>