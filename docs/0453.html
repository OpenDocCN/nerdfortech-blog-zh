<html>
<head>
<title>Setting up a standalone Redis Instance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">设置独立的 Redis 实例</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/setting-up-a-standalone-redis-instance-2721a7318037?source=collection_archive---------0-----------------------#2020-12-20">https://medium.com/nerd-for-tech/setting-up-a-standalone-redis-instance-2721a7318037?source=collection_archive---------0-----------------------#2020-12-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/761772f831bd7ef7bcdcd33fb4bf8f66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1d88Q8NNrRv6kjf7Ssw4g.png"/></div></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Redis 设置</figcaption></figure><div class=""/><p id="e4b4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">谈到缓存，Redis 是一个非常流行的内存数据库。这篇文章介绍了在 docker 中设置 Redis 实例的基本配置。</p><h1 id="da2d" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">目录结构</h1><p id="4fd3" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">创建一个名为<code class="du kv kw kx ky b">redisdb</code>的目录，并确保以下文件结构。</p><p id="d04e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">redisdb/ <br/> ├──数据/ <br/> ├── redis.conf</p><p id="7b19" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">data</code>目录将包含随时间拍摄的快照(如<code class="du kv kw kx ky b">.rdb</code>和/或<code class="du kv kw kx ky b">.aof</code>)。</p><p id="1d20" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">redis.conf</code>文件将包含实例配置。</p><h1 id="2427" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">配置</h1><p id="014c" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">一般来说，下面的配置似乎很重要。其余的可以保留默认值。</p><h2 id="f6f9" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated">网络</h2><pre class="ln lo lp lq fd lr ky ls lt aw lu bi"><span id="ac61" class="kz jt hx ky b fi lv lw l lx ly">bind 0.0.0.0       # bind to all available interfaces<br/>protectedmode no   # since we're not serving over localhost<br/>port 6379          # default port</span><span id="5eea" class="kz jt hx ky b fi lz lw l lx ly">tcp-backlog 511    # high backlog value helps avoid slow client <br/>                     connection issues, helpful in <br/>                     high-request-per-second environments</span><span id="445a" class="kz jt hx ky b fi lz lw l lx ly">timeout 0          # disable idle connection timeout<br/>tcp-keepalive 300</span></pre><h2 id="972f" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated">一般</h2><p id="8159" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">因为我们将在容器中运行它，所以不需要服务的后台进程。</p><pre class="ln lo lp lq fd lr ky ls lt aw lu bi"><span id="22ca" class="kz jt hx ky b fi lv lw l lx ly">daemonize no       <br/>supervised no<br/>databases          # valid between 1-16. Indexed with 0</span></pre><h2 id="6e7f" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated">给…拍快照</h2><p id="ade5" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">这些设置将从内存中生成数据的快照，并以文件扩展名<code class="du kv kw kx ky b">.rdb</code>将它们保存在我们根据指定的策略在上面创建的<code class="du kv kw kx ky b">data/</code>目录下。</p><pre class="ln lo lp lq fd lr ky ls lt aw lu bi"><span id="b8bc" class="kz jt hx ky b fi lv lw l lx ly">save 900 1                      # save &lt;seconds&gt; &lt;writes&gt;<br/>save 300 10<br/>save 60 10000</span><span id="8698" class="kz jt hx ky b fi lz lw l lx ly">stop-writes-on-bgsave-error yes # stop accepting writes if<br/>                                  snapshotting fails. This limits <br/>                                  the risk of losing data.</span></pre><h2 id="87ae" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated">安全性</h2><p id="1213" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">基本的安全性包括设置服务器密码。</p><pre class="ln lo lp lq fd lr ky ls lt aw lu bi"><span id="9aac" class="kz jt hx ky b fi lv lw l lx ly">requirepass PASSWORD # set the server password</span></pre><p id="f8eb" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">但是，如果数据是敏感的，仅仅使用服务器密码进行身份验证是有风险的。因为一个<code class="du kv kw kx ky b">FLUSHALL</code>命令就可以删除一切。它可以通过<a class="ae ma" href="https://redis.io/topics/acl" rel="noopener ugc nofollow" target="_blank">访问控制列表</a> (ACL)来缓解，该列表包含用户名/密码以及允许的命令列表。</p><h2 id="1941" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated"><strong class="ak">内存管理(重要)</strong></h2><p id="90cc" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">由于 Redis 是一个内存数据库，您不希望它淹没运行它的节点，从而危及所有其他服务。合适的内存管理策略可以扭转局面。</p><figure class="ln lo lp lq fd hk"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">驱逐政策</figcaption></figure><p id="cd13" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hy">驱逐政策</strong></p><p id="cd9a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">noeviction</code>:当达到内存限制并且客户端试图执行可能导致使用更多内存的命令时，返回错误。</p><p id="b238" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">allkeys-lru</code>:通过尝试首先移除最近较少使用的(LRU)键来驱逐键，以便为添加的新数据腾出空间。</p><p id="0980" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">volatile-lru</code>:通过尝试首先移除最近较少使用的(LRU)密钥来驱逐密钥，但是仅在具有到期设置的密钥中，以便为添加的新数据腾出空间。</p><p id="8309" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">allkeys-random</code>:随机驱逐密钥，为添加的新数据腾出空间。</p><p id="6b9c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">volatile-random</code>:随机驱逐密钥，以便为添加的新数据腾出空间，但只驱逐设置了过期的密钥。</p><p id="bab7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><code class="du kv kw kx ky b">volatile-ttl</code>:驱逐设置过期的密钥，首先尝试驱逐生存时间(TTL)较短的密钥。</p><p id="1a98" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">可用驱逐策略的列表可以在<a class="ae ma" href="https://redis.io/topics/lru-cache" rel="noopener ugc nofollow" target="_blank">这里找到</a>。</p><h2 id="bddb" class="kz jt hx bd ju la lb lc jy ld le lf kc jf lg lh kg jj li lj kk jn lk ll ko lm bi translated">坚持</h2><p id="ead3" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">Append Only File ( <code class="du kv kw kx ky b">aof</code>)是另一种持久性模式，与<code class="du kv kw kx ky b">rdb</code>相比，它提供了更好的持久性，因为它创建了类似于时间点快照的东西。</p><figure class="ln lo lp lq fd hk"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">Redis 持久性</figcaption></figure><p id="5142" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">与<code class="du kv kw kx ky b">aof</code>文件相关的一些问题是，</p><ul class=""><li id="9436" class="md me hx iw b ix iy jb jc jf mf jj mg jn mh jr mi mj mk ml bi translated">AOF 文件大小与写入次数成正比。会越来越大。</li><li id="7f61" class="md me hx iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">AOF 文件越大，服务器重启的时间就越长。</li><li id="f496" class="md me hx iw b ix mm jb mn jf mo jj mp jn mq jr mi mj mk ml bi translated">因此，我们需要一种不时压缩 AOF 的方法。同样以非阻塞的方式，在服务器运行时接收读和写查询。</li></ul><blockquote class="mr ms mt"><p id="95b7" class="iu iv mu iw b ix iy iz ja jb jc jd je mv jg jh ji mw jk jl jm mx jo jp jq jr hb bi translated">因此，只有当您拥有非常敏感的数据并且无法承受丢失时，才考虑此选项。</p></blockquote><p id="f945" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><a class="ae ma" href="https://redis.io/topics/persistence" rel="noopener ugc nofollow" target="_blank">这里是<code class="du kv kw kx ky b">rdb</code>和<code class="du kv kw kx ky b">aof</code>选项详细比较的链接</a>。</p><h1 id="e645" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">启动实例</h1><p id="5bab" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr hb bi translated">在<code class="du kv kw kx ky b">redisdb/</code>目录下运行以下命令，因为本地路径在<code class="du kv kw kx ky b">-v</code>选项中必须是绝对路径。</p><figure class="ln lo lp lq fd hk"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">启动 Redis 实例</figcaption></figure><h1 id="e57d" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">测试连接</h1><figure class="ln lo lp lq fd hk"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="hr hs et er es ht hu bd b be z dx translated">测试 Redis 连接</figcaption></figure></div></div>    
</body>
</html>