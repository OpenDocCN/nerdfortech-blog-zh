<html>
<head>
<title>Build APIs You Won’t Hate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建你不会讨厌的 API</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/build-apis-you-wont-hate-21ce27e03351?source=collection_archive---------3-----------------------#2019-02-03">https://medium.com/nerd-for-tech/build-apis-you-wont-hate-21ce27e03351?source=collection_archive---------3-----------------------#2019-02-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d7612b84b40d1bb58ff8ad4ca6f27a94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uWouYRveA4Gbc1s8oNcWgg.png"/></div></div></figure><p id="850b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">应用编程接口或 API 是软件的接口。软件应用程序使用 API 的方式与人类使用应用程序和其他软件的界面的方式非常相似。</p><p id="6c18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天，以 API 为中心的架构正在崛起，我们比以往任何时候都在构建大量的 API。大多数 Android 和 iPhone 应用程序的前端 javascript 框架都使用 API。一方面，您从数据源获取数据，并以 JSON 的形式显示出来，但是要经受住业务逻辑、数据库模式更新、新特性或不赞成使用的端点等方面的变化会变得非常困难。</p><p id="073c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我为我的公司构建一些 API 时，我会利用 Laravel 的雄辩的 ORM、路由、迁移、播种等等。但是随着一些业务逻辑的改变，我会发现很难适应我的 API，我为此奋斗了很久。我对一些 API 的编写方式不满意，我想重新设计它。</p><p id="91cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在做一个简单的谷歌搜索编写 API 的最佳实践是什么的时候，我看到了菲尔·斯特金写的书<a class="ae jo" href="https://www.amazon.in/Build-APIs-You-Wont-Hate-ebook/dp/B07HNFVRNH/ref=sr_1_1?ie=UTF8&amp;qid=1549163352&amp;sr=8-1&amp;keywords=phil+sturgeon" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">《构建你不会讨厌的 API》</strong></a>。我读了这本书，理解了一些可以让我的 API 更好的方法，我按照书中提到的所有规则重新设计了我的 API。在这之后，我成了一个快乐的开发者。</p><p id="d5f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个故事中，我将给出我从书中学到的一些想法，这些想法帮助我在我们的项目中编写更好的 API。</p><h1 id="d782" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">#1 用复数命名 API 的路由</h1><p id="1fdc" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">例如，给定端点<em class="ks"> /place/1 </em>和<em class="ks"> /place </em>，最后一个端点返回哪个位置？。当我们对一个端点使用一个单一的名字时，会混淆路由实际返回的内容。所以对端点使用复数名称将有助于更好的理解，并且可以一致地命名子资源。</p><ul class=""><li id="107c" class="kt ku hi is b it iu ix iy jb kv jf kw jj kx jn ky kz la lb bi translated">/places-获取地点集合</li><li id="9ad8" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">/places/45 —获得一个位置 45</li><li id="d20b" class="kt ku hi is b it lc ix ld jb le jf lf jj lg jn ky kz la lb bi translated">/places/45，24 —获取位置 45 和 24</li></ul><p id="aea4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这就解决了很多歧义。</p><h1 id="896e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">#2 响应采用 JSON 格式</h1><p id="0ac1" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">您可以根据项目需求支持多种响应格式，比如 JSON 或 XML。但是我觉得 JSON 格式的回复更加清晰易读。JSON 更擅长存储类型，占用的空间也更小。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a6b7" class="lq jq hi lm b fi lr ls l lt lu">{<br/> "place": {<br/> "id" : 1,<br/> "name": "This is a bunch of text.",<br/> "is_true": false,<br/> "maybe": null,<br/> }<br/>}</span></pre><h1 id="bfbb" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">#3 内容结构</h1><p id="5884" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">我想没有正确的方法来显示你的数据。有些人会因为这不是他们喜欢的结构而感到恼火。当我们显示单个项目或多个项目时，我们在项目中遵循以下格式:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="7516" class="lq jq hi lm b fi lr ls l lt lu"># for multiple items<br/>{<br/>  <strong class="lm hj">"data"</strong>:[<br/>      {<br/>          <strong class="lm hj">"name"</strong>: <strong class="lm hj">"Batman"</strong>,<br/>          <strong class="lm hj">"id"</strong>: 10002,<br/>      },<br/>      {<br/>          <strong class="lm hj">"name"</strong>: <strong class="lm hj">"Superman"</strong>,<br/>          <strong class="lm hj">"id"</strong>: 10003,<br/>      },<br/>  ]<br/>}</span><span id="d6cb" class="lq jq hi lm b fi lv ls l lt lu"># for single items<br/>{<br/>  <strong class="lm hj">"data"</strong>:[<br/>      {<br/>          <strong class="lm hj">"name"</strong>: <strong class="lm hj">"Batman"</strong>,<br/>          <strong class="lm hj">"id"</strong>: 10002,<br/>      }<br/>  ]<br/>}</span></pre><p id="5b29" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这种格式的优点是，响应是一致的，并且总是具有相同的结构。此外，还有分页和一些元数据的空间。</p><p id="91c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">缺点是，一些客户端不喜欢数组中的单个响应。</p><p id="ca6e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在书中，作者建议以下面的格式命名单个项目，而不是返回数组中的单个项目:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="4c26" class="lq jq hi lm b fi lr ls l lt lu">{<br/>  <strong class="lm hj">"data"</strong>:<br/>      {<br/>          <strong class="lm hj">"name"</strong>: <strong class="lm hj">"Batman"</strong>,<br/>          <strong class="lm hj">"id"</strong>: 10002,<br/>      }<br/>}</span></pre><p id="9116" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这也是一个很好的方法，但是为了一致性，我在我的项目中在一个数组中同时返回单个和多个项。</p><h1 id="2e06" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">#4 使用带有错误代码的 HTTP 代码</h1><p id="329c" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">显示错误信息时，不要将 200 OK 代码和错误信息一起使用。使用 HTTP 4xx 或 5xx，这将提醒客户端发生了不好的事情，如果客户端感兴趣，错误代码会提供确切问题的细节。使用不同的 HTTP 代码，不要对所有错误过度使用 4XX HTTP 代码。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="47ce" class="lq jq hi lm b fi lr ls l lt lu">{<br/>    <strong class="lm hj">"error"</strong>:{<br/>        <strong class="lm hj">"code"</strong>: 1024,//custome error code of your application<br/>        <strong class="lm hj">"message"</strong>:<strong class="lm hj">"You do not have authorization to use this resource",// custom error message<br/>    </strong>}<br/>}</span><span id="60c6" class="lq jq hi lm b fi lv ls l lt lu"># display this error response with 403(Forbidden) HTTP code</span></pre><p id="4990" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如上例所示，使用自定义错误代码和 HTTP 代码。</p><h1 id="f3b5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">#5 分页</h1><p id="c2e8" class="pw-post-body-paragraph iq ir hi is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn hb bi translated">当你为一个用户界面构建一个 API 时，很快就会需要分页。而且我们不考虑分页，我们的用户界面将很难加载所有的数据，页面可能会没有反应。因此，在开发 API 时，为 API 中的分页留出空间是很重要的。</p><p id="5341" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我从书中学到的几个要点。你可以在这里阅读菲尔·斯特金的<a class="ae jo" href="https://www.amazon.in/Build-APIs-You-Wont-Hate-ebook/dp/B07HNFVRNH/ref=sr_1_1?ie=UTF8&amp;qid=1549163352&amp;sr=8-1&amp;keywords=phil+sturgeon" rel="noopener ugc nofollow" target="_blank"> <strong class="is hj">一书</strong> </a>，获得更多关于如何构建一个你不会讨厌的 API 的见解。</p><p id="c2ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ks">感谢阅读！！。</em></p></div></div>    
</body>
</html>