<html>
<head>
<title>Deploying ASG &amp; ALB in a Custom VPC with 3 Public Subnets to make the Application Highly Available</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在具有 3 个公共子网的定制 VPC 中部署 ASG 和 ALB，以使应用程序高度可用</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/creating-an-aws-autoscaling-group-with-a-custom-vpc-a49c43cc3613?source=collection_archive---------0-----------------------#2022-06-17">https://medium.com/nerd-for-tech/creating-an-aws-autoscaling-group-with-a-custom-vpc-a49c43cc3613?source=collection_archive---------0-----------------------#2022-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/d78c962029c344ece38cde610779b165.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*Ne9_kuXq5XsotFg6i39bsg.jpeg"/></div><figcaption class="im in et er es io ip bd b be z dx translated">让我们从一些有趣的事情开始</figcaption></figure><h2 id="6bfd" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">概述:</h2><p id="e9f0" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jb jz ka kb jf kc kd ke jj kf kg kh ki hb bi translated">在本文中，我将创建一个 VPC 和 3 个公共子网来演示 ALB 和 ASG 的工作方式(2 分钟和 5 分钟，目标策略是 50%的 CPU 利用率)。然后，使用压力测试将对其中一个 CPU 施加压力以达到其利用率极限，这将启动另一个实例。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div class="er es kj"><img src="../Images/5195f1f1d3fdcff9e13aef045bfa9e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*WPsCLfqNHZlNYEJB4s-ksA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">这是我们将通过这个项目实现的云中的架构</figcaption></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ko"><img src="../Images/a233ed3a0993e43d51de0302e3818e3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LnJw5PeKVIDQX2ozUEYN4w.png"/></div></div></figure><p id="663a" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">步骤 1:创建 VPC </strong> <br/>为了使事情变得更加简单，使用“VPC 和更多选项”来创建 VPC &amp;一次性添加子网。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ky"><img src="../Images/7f0e4449033c572f8e32811a5045674f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxYpPqFcAg99i9wzaZIz0w.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">一起创建 VPC 和子网</figcaption></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es kz"><img src="../Images/3c7083ed6adec158bb030959c22d6d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMgM6rZcpdpw9xm-Bs_KCA.png"/></div></div></figure><p id="df45" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">步骤 2:创建启动模板<br/> </strong>使用 Apache 安装创建启动模板:转到 EC2 &gt;启动模板&gt;配置设置</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es la"><img src="../Images/b528b5dc7ecee3e871ca6368954e118e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Os_gABksFIr8GfPxr4z3w.png"/></div></div></figure><p id="507c" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">选择 AMI</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lb"><img src="../Images/1e132ff8b0d345875a98e513d59b83c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2gheCAgHUtWCyuY9Z05lw.png"/></div></div></figure><p id="ade7" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">配置网络设置</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lc"><img src="../Images/002102c9e3e343f1024448e42ee188a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPX9rO3612CwRhn15rpvxQ.png"/></div></div></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lc"><img src="../Images/7d8bc6f74de4269803e3a64feeb94651.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Tj1blGK52tXttrou_IjIvw.png"/></div></div></figure><p id="5ba6" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">启用自动分配公共 IP</p><figure class="kk kl km kn fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/8282baa058815970f5c200a51f337c69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*GP56LKReAc14f8YZ3MUq-g.png"/></div></figure><p id="21b3" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">转到高级设置:启用监控并添加用户数据</p><figure class="kk kl km kn fd ij er es paragraph-image"><div class="er es le"><img src="../Images/9bdc6cb94716e0785e949a5dd3463b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1314/format:webp/1*mhJWQVRoQ-lQnebzOAZUow.png"/></div></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lf"><img src="../Images/5185440230918deabdd10c2b20984a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*A7jkpzMFhcmuV2zsz2C5lQ.png"/></div></div></figure><pre class="kk kl km kn fd lg lh li lj aw lk bi"><span id="63c5" class="iq ir hi lh b fi ll lm l ln lo">#!/bin/bash<br/>yum update -y<br/>yum install httpd -y<br/>systemctl start httpd<br/>systemctl enable httpd<br/>amazon-linux-extras install epel -y          <em class="lp"> #extra package library </em><br/>yum install stress -y                       #<em class="lp">Installs the stress pkg</em></span></pre><p id="d215" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">第三步:使用上一步创建的启动模板创建一个自动缩放组<br/></strong>:<strong class="jq hj"/>点击启动模板&gt;选择启动模板&gt;动作&gt;创建自动缩放组</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lq"><img src="../Images/88c9dcbb98b5650ee3baf2bdb261fdf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LGUCmIhlVRmoZnUVbYHZvA.png"/></div></div></figure><p id="dba7" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">点击&gt;配置您的 ASG 后</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lr"><img src="../Images/955581b55fc793b17917e557bccfd6a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RpJme2Ngt9ieuELTc7TDKg.png"/></div></div></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es ls"><img src="../Images/e3aeccd9ecb761b51b6b254d017a342a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ngYMcjz2sppD2zoBbnP3WA.png"/></div></div></figure><p id="98b2" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">在下一步中，添加 ALB 并关联您的子网。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lt"><img src="../Images/53126b96ecf2c76ee5d0d1e4f0939174.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gf830ABjI2F9gxNFnNJ6kw.png"/></div></div></figure><p id="e103" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">将最小和最大 CPU 分别增加到 2 和 5</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lu"><img src="../Images/03b873b1f24baff966098f98693efa36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hJeHF4lssF0-DVJZQps9jA.png"/></div></div></figure><p id="b36b" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">在 CPU 利用率超过 50%后，将目标策略添加到扩展中</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es lv"><img src="../Images/d67267125b9954f502fe5ae95c9ee583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zia5Zdy2BA-4A3zPEJx-Kg.png"/></div></div></figure><p id="5c6a" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">现在你已经完成了创建 ASG 和奥尔布。因此，实例将在 2 个 AZs 中启动，因为我们已经将最小值设置为 2。</p><p id="6452" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">步骤 4:测试运行实例 IP 以显示 apache 服务器</strong> <br/>只需复制已启动实例的公共 IP 并在浏览器中测试</p><figure class="kk kl km kn fd ij er es paragraph-image"><div class="er es lw"><img src="../Images/c2e64176d06ea7a94ccc6e580baba790.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kXZkOgVz2ucWJQxlInbdzQ.png"/></div></figure><p id="1155" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">步骤 5:对我们的实例进行压力测试的时间</strong> <br/>我们已经通过启动模板中的用户数据安装了压力包。现在，我们将 ssh 到其中一个实例，并使用下面的命令运行压力测试。</p><pre class="kk kl km kn fd lg lh li lj aw lk bi"><span id="3bbc" class="iq ir hi lh b fi ll lm l ln lo">$ sudo stress — cpu 1 — timeout 300</span></pre><p id="1f95" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">由于我的实例将需要 60 秒来预热(如 Auto Scaling 组中所配置的)，压力工具将需要对 CPU 施加足够的压力，以达到最大限度并触发目标跟踪策略中配置的 CloudWatch 警报。<code class="du lx ly lz lh b">--timeout</code>值代表压力测试的长度。压力测试将结束并产生以下结果:</p><figure class="kk kl km kn fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/c326847fc619f670561193c8418dc9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*FclN2MMQo6kUiE2XlffApg.png"/></div></figure><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es mb"><img src="../Images/378a52c51ef253e7c76f6d61319e7067.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwVuYuDtT1B0j66KjTjyzQ.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">显示 CPU 利用率超过 50%的云观察指标</figcaption></figure><p id="7131" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">因此，将启动一个新实例。</p><figure class="kk kl km kn fd ij er es paragraph-image"><div role="button" tabindex="0" class="kp kq di kr bf ks"><div class="er es mc"><img src="../Images/812a80b226c86eedfb361f51e2ac18ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QdxU77mf_SiBOfvTyAJE0w.png"/></div></div></figure><p id="e6ff" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated">实现的目标</p><p id="6af2" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">第五步:清理<br/> </strong>请清理你的资源以避免收费。</p><p id="aab8" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi">— — — — — — — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="99d3" class="pw-post-body-paragraph jo jp hi jq b jr kt jt ju jv ku jx jy jb kv ka kb jf kw kd ke jj kx kg kh ki hb bi translated"><strong class="jq hj">感谢通过！鼓掌并跟随:如果我的文章内容丰富。继续推！！</strong></p></div></div>    
</body>
</html>