<html>
<head>
<title>Home DevOps Pipeline: A junior engineer’s tale (2/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">家庭开发管道:一个初级工程师的故事(2/4)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c?source=collection_archive---------0-----------------------#2020-02-12">https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c?source=collection_archive---------0-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5c08" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">内容:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">，(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">)，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><p id="3aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一系列文章中，我将解释我是如何使用几个 Raspberry Pis 和许多软件构建自己的家庭开发环境的。在本文中，我将介绍管道的开发/ CI 部分，从 Git 存储库开始。</p><blockquote class="jf"><p id="baeb" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">🔗在 Github 上获取 Home DevOps 管道代码📔</a></p></blockquote><h1 id="0158" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">吉特亚</h1><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kn"><img src="../Images/d52198fd7097b096e9ce9bb801d9398d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JiRexLOf79xRWQXBz62Pog.png"/></div></div></figure><p id="cc5a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gitea 是一个可以安装在机器上的 git 存储库应用程序。这意味着作为标准，存储库的存储是在机器本身上完成的。然而，随着错误的发生，我已经将它升级到一个外置硬盘，并定期备份到 AWS S3。</p><p id="0ec5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在家托管自己的回购有很多好处。如果像我一样，你经常编辑视频或大量的大图片，那么用廉价的 WiFi 从互联网上下载东西很慢(10mb/s)，上传简直是愚蠢的(500kb/s)。然而，本地网络存储允许更高的传输速度(有待测量)。</p><p id="0d17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能认为大文件和 git 没有任何意义。你完全正确。任何涉及大型二进制文件的编辑都会导致 git repo 的大小爆炸。进入 stage left 解决所有 git/大文件问题:<a class="ae je" href="https://git-lfs.github.com" rel="noopener ugc nofollow" target="_blank"> Git LFS </a>(大文件存储)——一个以合理的方式存储指定文件的 Git 插件。</p><p id="3f3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">“Git 大文件存储(LFS)将音频样本、视频、数据集和图形等大文件替换为 Git 内部的文本指针，同时将文件内容存储在 GitHub.com 或 GitHub Enterprise 等远程服务器上。”</em></p><p id="c621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Git LFS 意味着我拥有使用心爱的 Git 处理必要的大文件的所有好处，并享受本地网络的高速传输！万岁！</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kz"><img src="../Images/e53f0239013ff02d1d18c94fd4627fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7GalwN7QnHbmcq5Q"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">由<a class="ae je" href="https://unsplash.com/@swimstaralex?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">亚历山大·辛恩</a>在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="555a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我已经介绍了 Gitea 的用例，但没有对它是什么和提供了什么进行过多的解释。为此，你应该看看 Gitea 和其他 Git 库提供者之间的比较。</p><p id="c6f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要创建您自己的 gitea 应用程序，使用<code class="du le lf lg lh b">docker-compose</code>运行这个包含 gitea 和 postgres 映像(生产就绪数据库)的模板:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="3027" class="lm jq hi lh b fi ln lo l lp lq">version: “2”</span><span id="c3b5" class="lm jq hi lh b fi lr lo l lp lq">networks:<br/>  appnet:<br/>    external: false</span><span id="d68e" class="lm jq hi lh b fi lr lo l lp lq">volumes:<br/>  gitea-app:<br/>  gitea-db:</span><span id="ae41" class="lm jq hi lh b fi lr lo l lp lq">services:</span><span id="65a1" class="lm jq hi lh b fi lr lo l lp lq">gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - ./volumes/gitea_data:/data<br/>      - ./custom:/data/gitea<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>     depends_on:<br/>      - gitea-db</span><span id="d1c3" class="lm jq hi lh b fi lr lo l lp lq">gitea-db:<br/>    image: postgres:alpine<br/>    container_name: gitea-db<br/>    ports:<br/>      - 5432:5432<br/>    restart: always<br/>    volumes:<br/>      - ./volumes/gitea_db:/var/lib/postgresql/data<br/>    environment:<br/>      - POSTGRES_USER=gitea<br/>      - POSTGRES_PASSWORD=gitea<br/>      - POSTGRES_DB=gite<br/>    networks:<br/>      - appnet</span></pre><p id="095a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个文件中，gitea 服务引用了一个文件<code class="du le lf lg lh b">gitea.env</code>。这是 gitea 的配置文件，它允许我们以一种不需要在应用程序内部进行任何设置的方式来设置这个 home repo 这意味着我们可以直接从备份中运行。</p><p id="f9f4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行完<code class="du le lf lg lh b">docker-compose up</code>后，你应该可以在本地网络的<code class="du le lf lg lh b">raspberrypi.local:3000</code>下访问并使用它。快乐的日子。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ls"><img src="../Images/5801a9ccb23a47efcbc717838af8ee15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5MOqu-ArI9QekHos"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">照片由<a class="ae je" href="https://unsplash.com/@hbtography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">哈里森·布罗德本特</a>在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="b65e" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">外置硬盘</h2><p id="22b2" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">gitea 启动并运行后，我想添加一个比 Micro SD 卡更大的存储设备。为此，我们只需像这样安装一个硬盘驱动器:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="3c93" class="lm jq hi lh b fi ln lo l lp lq">sudo mount /dev/sda1 /media/hdd</span></pre><p id="5efb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦挂载，你可以引用位置<code class="du le lf lg lh b">/media/hdd</code>，就像你引用其他文件夹一样。现在，我们希望能够定期备份该驱动器的内容。很容易地，有人制作了一个码头工人的形象，它就是 https://github.com/istepanov/docker-backup-to-s3。然而，正如预期的那样，这个映像不适合 ARM 架构，所以我使用基于 Pi 的 Raspbian 重新构建了这个映像。</p><p id="1862" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">将此添加到我们当前的<code class="du le lf lg lh b">docker-compose.yml</code>中，例如:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="ab57" class="lm jq hi lh b fi ln lo l lp lq">services:<br/>  backup:<br/>    image: t3chflicks/backuper<br/>    environment:<br/>      - ACCESS_KEY=<br/>      - SECRET_KEY=<br/>      - S3_PATH=<br/>      - CRON_SCHEDULE=0 12 * * *<br/>    volumes:<br/>      - /media/hd:/data:ro<br/>    container_name: backup<br/>    restart: always</span><span id="2502" class="lm jq hi lh b fi lr lo l lp lq">gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - /media/hd/gitea_data:/data<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>    depends_on:<br/>      - gitea-db</span></pre><p id="c42a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 Gitea 配置中启用 Git LFS 后，我们也可以在 repo 上安装 Git 插件，就像<code class="du le lf lg lh b">git lfs install</code>一样简单，然后像这样标记文件:<code class="du le lf lg lh b">git lfs track "*.mp4"</code>。</p><p id="880e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，您可以使用 git repo 来处理大型媒体文件，这太棒了。</p><h2 id="5b99" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">特拉菲克</h2><p id="a0ec" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">拥有一个主存储库是很棒的。但是，因为我不是一个完全的隐士，并且希望与其他人合作，所以我继续向我的回购协议添加外部访问。我使用了<a class="ae je" href="https://traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>，反向代理使用来自<a class="ae je" href="http://letsencrypt.org" rel="noopener ugc nofollow" target="_blank">的证书进行自动 SSL 加密</a>，并且我使用了来自<a class="ae je" href="https://www.duckdns.org/" rel="noopener ugc nofollow" target="_blank"> duckdns </a>的自由域。</p><p id="9543" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我发现 Traefik 文档有点令人困惑，但事实证明它非常容易添加到当前的 docker-compose 中。</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="ec2b" class="lm jq hi lh b fi ln lo l lp lq">version: “2”<br/>networks:<br/>  appnet:<br/>    external: false<br/>  homereponet:<br/>    external: true</span><span id="33d2" class="lm jq hi lh b fi lr lo l lp lq">volumes:<br/>  gitea-app:<br/>  gitea-db:<br/>  traefik:</span><span id="3985" class="lm jq hi lh b fi lr lo l lp lq">services:<br/>  gitea-app:<br/>    image: webhippie/gitea<br/>    env_file:<br/>      - gitea.env<br/>    container_name: gitea-app<br/>    restart: always<br/>    networks<br/>      - appnet<br/>    volumes:<br/>      - /media/hdd/gitea_data:/data<br/>    ports:<br/>      - "222:22"<br/>      - "3000:3000"<br/>    depends_on:<br/>      - gitea-db<br/>  depends_on:<br/>    - gitea-db<br/>    - traefik<br/>  labels:<br/>    - "traefik.enable=true"<br/>    - traefik.backend=gitea-app<br/>    - traefik.git.frontend.rule=Host:git.&lt;your_domain&gt;<br/>    - traefik.docker.network=homereponet<br/>    - traefik.git.port=3000</span><span id="5713" class="lm jq hi lh b fi lr lo l lp lq">gitea-db:<br/>    image: postgres:alpine<br/>    container_name: gitea-db<br/>    ports:<br/>      - 5432:5432<br/>    restart: always<br/>    volumes:<br/>      - /media/hdd/gitea_db:/var/lib/postgresql/data<br/>    environment:<br/>      - POSTGRES_USER=gitea<br/>      - POSTGRES_PASSWORD=gitea<br/>      - POSTGRES_DB=gitea<br/>    networks:<br/>     - appnet<br/>  <br/>  traefik:<br/>    image: traefik:1.7-alpine<br/>    container_name: “traefik”<br/>    ports:<br/>      - “80:80”<br/>      - “443:443”<br/>    networks:<br/>      - homereponet<br/>    volumes:<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>      - ./traefik/traefik.toml:/traefik.toml <br/>      - ./traefik/acme:/etc/traefik/acme<br/>    restart: always</span></pre><p id="260c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这需要一些额外的步骤来创建 acme 文件夹和编辑权限，以及添加这个 traefik.toml 文件</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="6a1d" class="lm jq hi lh b fi ln lo l lp lq">debug = false<br/>logLevel = “ERROR”<br/>defaultEntryPoints = [“https”,”http”]</span><span id="b1eb" class="lm jq hi lh b fi lr lo l lp lq">[entryPoints]</span><span id="8f6b" class="lm jq hi lh b fi lr lo l lp lq">[entryPoints.http]<br/>address = “:80”<br/>[entryPoints.http.redirect]<br/>entryPoint = “https”<br/>[entryPoints.https]<br/>address = “:443”<br/>[entryPoints.https.tls]</span><span id="1a22" class="lm jq hi lh b fi lr lo l lp lq">[retry]</span><span id="0244" class="lm jq hi lh b fi lr lo l lp lq">[docker]<br/>endpoint = “unix:///var/run/docker.sock”<br/>domain = “&lt;your domain&gt;”<br/>watch = true<br/>exposedByDefault = false</span><span id="c915" class="lm jq hi lh b fi lr lo l lp lq">[acme]<br/>email = “&lt;your email&gt;”<br/>caServer = “https://acme-v02.api.letsencrypt.org/directory"<br/>storage = “acme.json”<br/>entryPoint = “https”<br/>onHostRule = true</span><span id="2ed8" class="lm jq hi lh b fi lr lo l lp lq">[acme.httpChallenge]<br/>entryPoint = “http”</span></pre><p id="5221" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是现在，只要您暴露了端口 443 并将流量转发到您的 Pi，您应该能够通过您的 duckdns 地址访问您的主存储库，并且它将在<em class="jd"> https </em>上加密。太棒了！</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ml"><img src="../Images/79e4f44b71c90ee5e7ad4095e13590c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPubvAkPg-kKi150QLzkGg.png"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">替代茶主题(黑暗模式)</figcaption></figure><h2 id="6d88" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">雄蜂</h2><p id="0646" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">我们现在在 Docker 环境中拥有自己的私有 Git 回购设置，包括 Postgres、Git LFS、外部硬盘存储和外部 SSL 加密访问。这很好:我们可以愉快地工作在我们的项目上，知道我们可以轻松地处理大文件，并在任何地方使用 git。</p><p id="b5db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，这并不完全是 DevOps。使用 git 可以通过拉请求等方式为您提供代码的持续集成。，但不提供连续交付。为此，我们期待一款名为<a class="ae je" href="https://drone.io/" rel="noopener ugc nofollow" target="_blank">无人机</a>的软件。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mm"><img src="../Images/18ceffd0495d959ba51055a7a77a0758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hPTZq_bDHmlLIBLr"/></div></div><figcaption class="la lb et er es lc ld bd b be z dx translated">在<a class="ae je" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae je" href="https://unsplash.com/@imkirk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Iewek Gnos </a>拍摄的照片</figcaption></figure><p id="6621" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用无人机来管理我们构建 Docker 容器、测试和部署到机器的管道。</p><p id="2337" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">像目前为止讨论的所有其他服务一样，Drone 在 DockerHub 上有一个<a class="ae je" href="https://hub.docker.com/r/drone/drone" rel="noopener ugc nofollow" target="_blank">图像</a>。要将它添加到我们当前的设置中，我们需要将以下内容添加到我们的<em class="jd"> docker-compose </em>文件中:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="5cca" class="lm jq hi lh b fi ln lo l lp lq">services:<br/>  drone:<br/>    image: drone/drone:1-linux-arm<br/>    container_name: drone<br/>    volumes:<br/>      - /media/hdd/drone:/var/lib/drone/<br/>    restart: always<br/>    depends_on:<br/>      - gitea-app<br/>    environment:<br/>      - DRONE_OPEN=true<br/>      - DRONE_GITEA_CLIENT_ID=&lt;gitea_auth_id&gt;<br/>      - DRONE_GITEA_CLIENT_SECRET=&lt;gitea_auth_secret&gt;<br/>      - DRONE_GITEA_SERVER=http://git.&lt;your_domain&gt;<br/>      - DRONE_SERVER_HOST=drone.&lt;your_domain&gt;<br/>      - DRONE_SERVER_PROTO=https<br/>      - DRONE_TLS_AUTOCERT=false<br/>      - DRONE_RPC_SECRET=&lt;drone_runner_secret&gt;<br/>      - DRONE_AGENTS_ENABLED=true<br/>    networks:<br/>      - homereponet<br/>      - appnet<br/>    labels:<br/>      - “traefik.enable=true”<br/>      - traefik.backend=drone<br/>      - traefik.drone.frontend.rule=Host:drone.&lt;your_domain&gt;<br/>      - traefik.drone.port=80<br/>      - traefik.docker.network=homereponet</span><span id="5ee6" class="lm jq hi lh b fi lr lo l lp lq">runner:<br/>    container_name: runner<br/>    image: drone/drone-runner-docker:1<br/>    volumes:<br/>      - /var/run/docker.sock:/var/run/docker.sock<br/>    depends_on:<br/>      - drone<br/>    environment:<br/>      - DRONE_RPC_HOST=drone.&lt;your_domain&gt;<br/>      - DRONE_RPC_PROTO=https<br/>      - DRONE_RPC_SECRET=&lt;drone_runner_secret&gt;<br/>    restart: always<br/>    ports:<br/>      - “3000:3000”<br/>    networks:<br/>      - appnet<br/>      - homereponet</span></pre><p id="67f5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，当您启动系统并访问<code class="du le lf lg lh b">https://drone.&lt;domain&gt; </code>时，您会在尝试登录时得到一个错误。这是因为您需要运行 Gitea，首先创建 OAuth 应用程序，然后重新构建您的容器，将<code class="du le lf lg lh b">DRONE_GITEA_CLIENT_SECRET</code>设置为新值——这里的<a class="ae je" href="https://docs.drone.io/installation/providers/gitea/" rel="noopener ugc nofollow" target="_blank">描述的是</a>。</p><p id="2ca9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在可以使用您的 Gitea 凭据登录 Drone。接下来，您应该通过点击大按钮来同步 Gitea 的存储库。下一件你想尝试的事情是做一个构建，为此你应该添加一个<code class="du le lf lg lh b">.drone.yml</code>文件到你的 repo 中，在推的时候，它应该触发一个构建。</p><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mn"><img src="../Images/66569efa8540167388e54391516a6a12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-QEZBWRVw9FbsdTsuetzIQ.png"/></div></div></figure><p id="302a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每一步都是在隔离的环境中构建，并在无人机上执行。无人机运行程序为一种架构构建，因此我们将只在 Pi 运行程序上构建 Raspberry Pi (arm v7)映像，但对于 x86 构建，我们需要在 AWS 上部署 EC2(稍后将详细介绍)。我的示例无人机文件如下所示:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="2b62" class="lm jq hi lh b fi ln lo l lp lq">kind: pipeline<br/>name: commitPipeline</span><span id="c21e" class="lm jq hi lh b fi lr lo l lp lq">trigger:<br/>  event:<br/>    - push</span><span id="6377" class="lm jq hi lh b fi lr lo l lp lq">platform:<br/>  os: linux<br/>  arch: arm</span><span id="beef" class="lm jq hi lh b fi lr lo l lp lq">steps:<br/>  - name: buildsomething<br/>    image: python:alpine<br/>    commands:<br/>      - echo ‘hello world’</span></pre><p id="2603" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">瞧，你现在是一个家庭回购骄傲的主人！我们会忽略一个事实，那就是它很可能仍然做不到 Gitlab 开箱即用那么多，但它是你的(呜，资本主义！).</p><h2 id="1606" class="lm jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">登记处</h2><p id="5f74" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">DockerHub 很棒，就像 Github 很棒一样。这是因为他们为人们提供了一个分享工作的地方。然而，正如私人回购的论点是不想共享和快速的本地速度，这同样适用于 Docker 注册中心。</p><p id="e2ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将创建自己的空间来存储我们使用 Docker 自己的注册表映像制作的映像。要将它添加到我们现有的 Docker-compose 文件中，我们只需要添加这个额外的服务:</p><pre class="ko kp kq kr fd li lh lj lk aw ll bi"><span id="001b" class="lm jq hi lh b fi ln lo l lp lq">registry:<br/>  image: registry:2<br/>  container_name: registry<br/>  restart: always<br/>  networks:<br/>    - homerepone<br/>  volumes:<br/>    - ./volumes/registry:/var/lib/registr<br/>    - ./auth:/auth<br/>  labels:<br/>    - “traefik.enable=true”<br/>    - traefik.registry.frontend.rule=Host:registry.&lt;your_domain&gt;<br/>    - traefik.backend=registry<br/>    - traefik.docker.network=homereponet<br/>    - traefik.registry.port=5000<br/>  environment:<br/>    - REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/data<br/>    - REGISTRY_AUTH=htpasswd<br/>    - REGISTRY_AUTH_HTPASSWD_REALM=Registry<br/>    - REGISTRY_AUTH_HTPASSWD_PATH=/auth/registry.password</span></pre><p id="926a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这引用了一个我们使用 apache2-utils bcrypt 散列密码创建的<code class="du le lf lg lh b">auth/registry.password</code>文件，就像这里描述的<a class="ae je" href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-private-docker-registry-on-ubuntu-18-04" rel="noopener ugc nofollow" target="_blank">一样</a>。</p><p id="edd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行我们新的<code class="du le lf lg lh b">docker-compose.yml</code>意味着您可以使用<code class="du le lf lg lh b">docker login <a class="ae je" href="https://registry.homerepo4.duckdns.org" rel="noopener ugc nofollow" target="_blank">https://registry.&lt;</a>your_domain&gt;</code>通过 docker cli 登录来访问注册表。</p></div><div class="ab cl mo mp gp mq" role="separator"><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt mu"/><span class="mr bw bk ms mt"/></div><div class="hb hc hd he hf"><p id="c999" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经讨论了管道的开发部分，在本系列的下一篇文章中，我们将讨论部署方法。点击查看<a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934">。</a></p><p id="84d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">内容:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">，(</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">)，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"> <em class="jd"> 4 </em> </a></p><blockquote class="jf"><p id="d78a" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">🔗在 Github 上获取 Home DevOps 管道代码📔</a></p></blockquote><h1 id="e02b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">感谢阅读</h1><p id="83b2" class="pw-post-body-paragraph if ig hi ih b ii mg ik il im mh io ip iq mi is it iu mj iw ix iy mk ja jb jc hb bi translated">我希望你喜欢这篇文章。如果你喜欢这种风格，可以去 T3chFlicks.org 的<a class="ae je" href="https://t3chflicks.org/Projects/home-devops-pipeline" rel="noopener ugc nofollow" target="_blank"/>看看更多以科技为中心的教育内容(<a class="ae je" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>、<a class="ae je" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>、<a class="ae je" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">脸书</a>、<a class="ae je" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>)。</p></div></div>    
</body>
</html>