<html>
<head>
<title>CI/CD: Implement your ideas into production</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CI/CD:将您的想法应用到生产中</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ci-cd-implement-your-ideas-into-production-ee9f18303d8b?source=collection_archive---------16-----------------------#2021-04-28">https://medium.com/nerd-for-tech/ci-cd-implement-your-ideas-into-production-ee9f18303d8b?source=collection_archive---------16-----------------------#2021-04-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ee60" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">我们利用Kubernetes实施CI/CD的案例研究。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/71977de96935edc8f57c34ace62fb430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*iw6QiB2n0hv8d63XiJSAtA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated"><em class="jq">与Kubernetes合作的CI/CD</em></figcaption></figure><p id="5f46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">迭代代码的连续构建、测试和交付提高了软件开发生命周期(SDLC)的速度，即当开发人员编写代码时，它被自动部署到相应的环境中，使他们能够自己测试功能，并将构建提交给测试团队进行详细测试。值得注意的是，随着一个新版本的出现，整个过程重复出现。</p><p id="c1c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">持续软件开发包括三个主要步骤，即从源代码到产品:</p><p id="ae1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">持续集成</p><p id="02cf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">持续部署(CD)</p><p id="a5bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">连续交付(CD)</p><p id="1db2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">包括构建、打包、测试和将经验证的代码部署到适当的环境中在内的各种步骤的编排定义了CI/CD管道。CI/CD管道的系统布局为团队提供了将他们的想法带入生产的更广泛的理解。CI/CD管道通常由环境、测试、人员、服务和结果驱动。DevOps团队的主要目标是在其开发环境中自动化CI/CD。</p><p id="c632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">自动化CI/CD中使用的软件包括:</p><p id="06df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Gitlab</p><p id="e6a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">詹金斯</p><p id="3201" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">码头工人</p><p id="25f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">舵</p><p id="f549" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">舵柄</p><p id="c7fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">索纳库贝</p><p id="be73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安克雷</p><h1 id="06d5" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">连续累计</h1><p id="d184" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">代码库中的多次代码变更、额外的新特性和每日迭代，以及脚本的创建，对于代码的不间断自动构建和打包被称为<em class="jd">持续集成</em>。对于不同的系统，打包过程是不同的，例如，为JAVA构建生成一个JAR文件，然后将其部署为docker映像。这些脚本确保了最小的错误，并且测试阶段确定了对每个应用程序的指导方针和标准的严格检查。</p><p id="d600" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CI最吸引人的部分是将新思想集成到应用程序中的成就。此外，CI努力通过集成测试和单元测试使它的构建可重复、一致、无错误和可伸缩。然而，在CI过程中会面临一些挑战，比如CI平台的过载，这可以通过战略性地应用测试套件来避免。</p><h1 id="c878" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">持续部署</h1><p id="4bcc" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">连续部署涉及到代码的安装和分发，并且关注于以最小的阻力将包放到所需环境中的自动化路径。换句话说，连续部署确保了从CI到适当环境的自动部署。现代技术，如Kubernetes，可能只有一个分隔环境的名称空间。</p><h1 id="dc9b" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">连续交货</h1><p id="027e" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">连续部署和连续交付的区别在于，随着连续代码的变更，在连续交付中部署是手动进行的，而在连续部署中部署是完全自动化的。构成CD管道的组件包括版本控制系统、CI系统、存储docker映像的docker注册表和Kubernetes集群。所有上述组件的自动化确保了平稳和无缝的交付。</p><h1 id="3465" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">Kubernetes中的CI/CD</h1><p id="fa84" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Kubernetes以其效率和广泛的利用而闻名，例如在云世界中部署应用程序、调度批处理作业、处理工作负载和其他部署。Kubernetes的主要使用案例是其运行CI/CD管道的能力。</p><p id="f96d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在涉及不同团队或应用程序的管道中集成各种元素可能会令人苦恼。然而，当代的CI/CD工具已经出现，增强了管道的灵活性和坚固性。不同应用程序的一个例子是具有无服务器部分的应用程序。在这种情况下，需要较长时间的工作负载被部署到Kubernetes，然后将无服务器部分部署到云提供商。Jenkins、Spinnaker、Drone和GoCD是Kubernetes使用的一些CI/CD平台。</p><h1 id="3037" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">用于CI/CD用例的Kubernetes</h1><p id="3dfa" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">Jenkins在这个项目中使用，因为它被广泛使用，并以其可扩展性和庞大的生态系统而闻名。JenkinsX是使用Kubernetes时推荐使用的官方插件，因为它有一些特殊的特性，比如自动化CI/CD、GitOps和预览环境。在Kubernetes上安装JenkinsX之前，需要保持以下安装顺序:</p><p id="08cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Helm的安装:Kubernetes的包管理器</p><p id="a5fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">安装舵柄，以确保舵的平稳运行</p><p id="7e00" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过运行inspect命令检查部署的配置值</p><p id="c5e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仔细检查，然后安装JenkinsX</p><p id="0aa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">下面总结了一个使用Kubernetes描述堆栈部署流程的实时项目。</em></p><p id="fe43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">标记构建</strong></p><p id="d674" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当代码准备好进行部署时，它会使用特定的格式进行标记。类似于stag-frontend-x.x.x .在Gitlab中设置了一个push事件，它触发了一个Jenkins作业。Jenkins服务器读取Git存储库根目录下的“Jenkinsfile ”,并遵循其中的指令。</p><p id="250f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">詹金斯的工作</strong></p><p id="e5cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">“Jenkinsfile”是用Groovy语言编写的，它指导应用程序的构建、测试、docker、发布和交付。在将代码打包到docker映像之前，依赖项是使用Jenkinsfile提取的。</p><p id="db73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实时项目及其图像所涉及的步骤如下所述:</p><ul class=""><li id="4d1b" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">标签的标识。例如，如果标记以stag-x.x.x开始，那么部署将是到登台环境，而标记prod-x.x.x包含它自己的一组指令。当不符合格式时，Jenkins作业结束。</li><li id="bc31" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">现在，在开源项目<em class="jd"> SonarQube </em>的帮助下，代码将接受静态代码分析，该项目检查代码中潜在的错误和糟糕的编码实践。</li><li id="e9be" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">docker映像将在成功的代码质量检查之后构建。</li><li id="8fc2" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">另一个名为Anchore的开源项目用于分析docker图像。Anchore评估安全性、合规性和执行检查。</li><li id="3c07" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">docker映像随后被推送到弹性容器注册中心(ECR)</li><li id="b760" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">这个项目中使用的部署工具是<em class="jd"> Helm chart </em>，因为它管理最复杂的Kubernetes应用程序。具体来说，这个项目采用了<em class="jd">舵图</em>的<em class="jd">伞图</em>版本，它包括一个有多个子图的根图。在部署期间，需要更新子图表应用程序的标签/版本以及根图表“requirements.yaml”文件中的相应版本。所有这些过程都是通过Jenkins文件中的Groovy脚本来处理的。</li><li id="7ca2" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">最后，使用带有容器编排器的“Helm Package Manager”启动部署。</li><li id="eb50" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">部署之后，清理超过两周的docker映像</li></ul><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es li"><img src="../Images/49ab93bf9b1a9c8836951ede2a87e928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3NA0CPouUkaEaLPYhRKK5A.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">在Kubernetes上部署CI/CD</figcaption></figure><h1 id="11a0" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">在Kubernetes上大规模运行CI/CD</h1><p id="acaf" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">为了使Kubernetes上的CIC/CD大规模发挥作用，需要记住的一些要点如下:</p><p id="a6dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kubernetes发行版的偏好，如托管Kubernetes解决方案</p><p id="0657" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Docker注册表和包管理的首选项，如Helm</p><p id="c5f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">利用集成流，例如ChatOps和GitOps</p><p id="619d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，通过定制所需的Kubernetes操作员，可以实现许多自动化优势。作为Kubernetes的初学者，可以从任务开始，比如集成CI/CD管道。</p></div></div>    
</body>
</html>