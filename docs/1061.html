<html>
<head>
<title>Asynchronous Promise</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异步承诺</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/asynchronous-promise-e3a70a18cd58?source=collection_archive---------34-----------------------#2021-03-02">https://medium.com/nerd-for-tech/asynchronous-promise-e3a70a18cd58?source=collection_archive---------34-----------------------#2021-03-02</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><h2 id="84a5" class="hg hh hi bd b fp hj hk hl hm hn ho dx hp translated" aria-label="kicker paragraph">iOS 测试指南</h2><div class=""/><figure class="ev ex ip iq ir is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es io"><img src="../Images/fc0fcc7a0cec1281645c614cee6777cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wreYwb0c4dFNMDnjEKglRQ.png"/></div></div></figure><p id="8ceb" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">测试异步代码并不简单。</p><p id="eacc" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">有什么问题？</strong></p><p id="5601" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">通常，当函数返回时，测试就结束了。使用这个理论，所有的异步代码都将被跳过，因为测试将在代码开始之前结束。</p><p id="e9d6" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">有什么解决办法？</strong></p><p id="e898" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">一个承诺。我们需要告诉系统等待一段特定的时间，或者直到我们履行承诺。</p><p id="f86b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">怎么做到的？</strong></p><p id="ad9d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在这里我们所说的承诺实际上是一种期望- <code class="du jx jy jz ka b"><strong class="jb hs">XCTestExpectation</strong></code>，但承诺是软件行业中广泛使用的术语，你自己谷歌一下就知道了。</p><p id="8e4f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">使用<code class="du jx jy jz ka b"><strong class="jb hs">expectation(description:)</strong></code> <strong class="jb hs"> </strong>方法设置期望值，并提供解释期望值的描述。</p><p id="c3aa" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">当异步代码完成时，调用<code class="du jx jy jz ka b"><strong class="jb hs">fulfill()</strong></code>方法。</p><p id="e47c" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">然后使用<code class="du jx jy jz ka b"><strong class="jb hs">waitForExpectations(timeout:)</strong></code>继续运行，直到超时间隔结束，或者达到预期。</p><p id="696f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">让我们看一些代码。</p><figure class="kc kd ke kf fd is er es paragraph-image"><div class="er es kb"><img src="../Images/4bf0be4dfbd1e7e56e646f41167cc2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*LQywYUkmy2JIviwC6UoQcw.jpeg"/></div></figure><p id="e76b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">导入您要测试的项目。</p><figure class="kc kd ke kf fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kg"><img src="../Images/278bdc0304ee66356cb1681386cf5158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwO6oRKAGUOVtBVQr2RrXQ.png"/></div></div></figure><p id="bd1f" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">在这个例子中，我们将使用<code class="du jx jy jz ka b"><strong class="jb hs">URLSession </strong></code>。为此，您可以使用自己的类/结构或任何第三方库，如<a class="ae kh" href="https://github.com/Alamofire/Alamofire" rel="noopener ugc nofollow" target="_blank"><strong class="jb hs"><em class="ki">aloma fire</em></strong></a>。</p><p id="414d" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">编写<code class="du jx jy jz ka b"><strong class="jb hs">setUp() </strong></code>和<code class="du jx jy jz ka b"><strong class="jb hs">tearDown()</strong></code>方法。</p><figure class="kc kd ke kf fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kj"><img src="../Images/92858c289c56eef6394f5b9ac9fc84ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3MktprHilPcj3fvnCDsfWA.png"/></div></div></figure><p id="efe1" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">让我们在没有承诺的情况下编写测试，看看它是如何失败的。测试总是会失败，因为当调用<code class="du jx jy jz ka b"><strong class="jb hs">XCTAssertEqual() </strong></code>方法时，完成处理程序中的代码甚至没有启动。使用断点或打印语句来验证这一点。</p><figure class="kc kd ke kf fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kk"><img src="../Images/b2c4e95592b9c4a576b2dafd9f3a1bf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vNnDVfH5ppoz4uVHziun0A.png"/></div></div></figure><p id="fe51" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">是时候使用我们首先看到的方法来编写我们的测试了。我们将使用<strong class="jb hs">给出的</strong> - <strong class="jb hs">当</strong> - <strong class="jb hs">然后</strong>的格式来编写这个测试用例，如果你想了解更多关于这个格式的内容，那么就来看看<a class="ae kh" rel="noopener" href="/nerd-for-tech/ios-behavioural-testing-given-when-then-in-ui-unit-testing-part-1-41e3eff8811b"> <strong class="jb hs"> iOS:行为测试-给出当然后在 UI &amp;单元测试</strong> </a>。</p><figure class="kc kd ke kf fd is er es paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="er es kk"><img src="../Images/26f9354ba1bdf38fe76dd69386653fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Igk0mSSpIWQHUPj4ogdalg.png"/></div></div></figure><p id="5063" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated">现在您将能够看到在 3 秒钟之后或者在调用了<code class="du jx jy jz ka b"><strong class="jb hs">fulfill()</strong></code>方法之后调用了<code class="du jx jy jz ka b"><strong class="jb hs">XCTAssertEqual()</strong></code>方法。使用断点对此进行检查。</p><p id="b70b" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs"> <em class="ki">就这样了伙计们，我该离开了。</em> </strong></p><h1 id="4b76" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">👾要点</h1><figure class="kc kd ke kf fd is"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="7bf7" class="pw-post-body-paragraph iz ja hi jb b jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw hb bi translated"><strong class="jb hs">🙏🏽感谢- </strong> <a class="ae kh" href="https://www.raywenderlich.com" rel="noopener ugc nofollow" target="_blank">雷·温德里奇</a>，<a class="ae kh" href="https://www.hackingwithswift.com" rel="noopener ugc nofollow" target="_blank">保罗·哈德森</a>，<a class="ae kh" href="https://ray.so" rel="noopener ugc nofollow" target="_blank">雷·索恩</a></p></div></div>    
</body>
</html>