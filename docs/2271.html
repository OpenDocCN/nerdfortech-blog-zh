<html>
<head>
<title>Uploading Images to Cloudinary With React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 React 将图像上传到 Cloudinary</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/uploading-images-to-cloudinary-with-react-e432c644485?source=collection_archive---------5-----------------------#2021-04-29">https://medium.com/nerd-for-tech/uploading-images-to-cloudinary-with-react-e432c644485?source=collection_archive---------5-----------------------#2021-04-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1c56eb6becadd1b03b6647eab33c3bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_O10n1ET5NMRtFuTcQPp-g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">云雾缭绕</figcaption></figure><p id="8acb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi js translated">如果我们想在某个地方存储我们成员的个人资料图片、他们上传的图片/视频等，该怎么办？我们当然不能使用大多数数据库。尽管一些数据库服务允许你上传你的图片到他们的云中，但是我们不能用它来满足我们的大部分需求！。否则，我们必须<em class="kb">存储上传图像的 URL。</em>在这些当中，出现了<a class="ae kc" href="https://cloudinary.com/" rel="noopener ugc nofollow" target="_blank">云淡风轻</a></p><blockquote class="kd ke kf"><p id="4683" class="iu iv kb iw b ix iy iz ja jb jc jd je kg jg jh ji kh jk jl jm ki jo jp jq jr hb bi translated">Cloudinary 是一家 SaaS 技术公司，提供基于云的图像和视频管理服务。它使用户能够上传、存储、管理、操作和交付网站和应用程序的图像和视频。</p></blockquote><p id="8900" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以，让我们<em class="kb">潜</em>进去吧！</p><h1 id="f307" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">内容</h1><ul class=""><li id="9af5" class="lh li hi iw b ix lj jb lk jf ll jj lm jn ln jr lo lp lq lr bi translated">设置 UI (React) <br/>确保您已经在全球范围内安装了最新版本的 create-React-app:<code class="du ls lt lu lv b">npm i create-react-app -g</code>)</li><li id="42d4" class="lh li hi iw b ix lw jb lx jf ly jj lz jn ma jr lo lp lq lr bi translated">设置 Cloudinary <br/>(确保您在<a class="ae kc" href="https://cloudinary.com/" rel="noopener ugc nofollow" target="_blank"> Cloudinary </a>中有帐户)</li><li id="069f" class="lh li hi iw b ix lw jb lx jf ly jj lz jn ma jr lo lp lq lr bi translated">设置功能</li><li id="26d8" class="lh li hi iw b ix lw jb lx jf ly jj lz jn ma jr lo lp lq lr bi translated">更新用户界面</li></ul><h1 id="978f" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">设置用户界面(React)</h1><p id="f60f" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf mb jh ji jj mc jl jm jn md jp jq jr hb bi translated">为了这篇文章，我使用 CMD(窗口的终端)和 VSCode(你可以使用任何，根据你的喜好！)</p><p id="2fa8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">首先，在 CMD 中导航到您的目录，并键入<code class="du ls lt lu lv b">npx create-react-app cloudinary-tutorial</code>，<code class="du ls lt lu lv b">cloudinary-tutorial</code>是项目的名称</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/282a3f4184a947cb7ee3d1df0d9f92b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*edBVagxesJQBcdvHL5Kt-Q.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建-反应-应用</figcaption></figure><p id="f750" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">安装完成后，通过<code class="du ls lt lu lv b">cd cloudinary-tutorial &amp;&amp; code .</code>导航到该文件夹，这将为我们打开 VSCode。现在是清洁过程。</p><p id="3ed4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">清理过程包括删除<code class="du ls lt lu lv b">src</code>文件夹中不需要的文件，如:<code class="du ls lt lu lv b">App.test.js</code>和<code class="du ls lt lu lv b">setupTests.js</code>，并清理(删除)所有<code class="du ls lt lu lv b">App.js</code>中的代码，替换为:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="01bd" class="mn kk hi lv b fi mo mp l mq mr">//App.js<br/>import React from "react";<br/>import "./App.css";</span><span id="f0a9" class="mn kk hi lv b fi ms mp l mq mr">function App() {<br/> return (<br/>  &lt;div className="app"&gt;<br/>  &lt;input type="file" className="app_uploadInput" /&gt;<br/>  &lt;button className="app_uploadButton"&gt;Upload&lt;/button&gt;<br/>  &lt;/div&gt;<br/> );<br/>}</span><span id="ffb4" class="mn kk hi lv b fi ms mp l mq mr">export default App;</span></pre><p id="cb73" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里我们放置了一个带有<code class="du ls lt lu lv b">className </code>“app”的<code class="du ls lt lu lv b">div</code>和一个带有<code class="du ls lt lu lv b">className</code>作为“app_uploadInput”的<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file" rel="noopener ugc nofollow" target="_blank">上传输入</a>以及一个带有<code class="du ls lt lu lv b">className </code>“app _ upload button”<br/>的<code class="du ls lt lu lv b">button</code>。您也可以将<code class="du ls lt lu lv b">App.css</code>替换为:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="b08a" class="mn kk hi lv b fi mo mp l mq mr">//App.css<br/>.app {<br/> height: 100vh;<br/> display: flex;<br/> align-items: center;<br/> justify-content: center;<br/>}</span><span id="53c0" class="mn kk hi lv b fi ms mp l mq mr">.app_uploadButton {<br/> height: 2rem;<br/> width: 5rem;<br/> background-color: black;<br/> color: white;<br/>}</span></pre><p id="01e5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这些都是基本的造型，我不打算详细介绍。<br/>现在让我们启动开发服务器，看看我们的进度！</p><p id="ca76" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">为了启动开发服务器，在 VSCode 中通过<code class="du ls lt lu lv b">Ctrl+Shift+` </code>打开一个新的终端，然后在浏览器中键入:<code class="du ls lt lu lv b">npm start</code>现在打开<code class="du ls lt lu lv b">localhost:3000</code>，您会看到类似这样的内容:</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mt"><img src="../Images/7a85afab346d3811a51fd1ad67094a17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_3cIDGJWzChoBKXY6b09g.png"/></div></div></figure><p id="ccfc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！好消息是您已经完成了 UI 的设置(React)。</p><h1 id="5e29" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">设置云阵列</h1><p id="b457" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf mb jh ji jj mc jl jm jn md jp jq jr hb bi translated">现在让我们设置 Cloudinary！<br/>登录后，转到您的仪表板，从那里复制<strong class="iw hj">云名称</strong>。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/782662e16ecd54318506511b55d615fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fmyLuxj6tEAgVhqRWIz7dw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">云名称</figcaption></figure><p id="be6f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">你还需要你的<strong class="iw hj"> upload_preset </strong>。为此，请转到设置:</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/7a09e82011697d06982b9722e632b15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VpEsXDCSY_dPvuWX0rHxwg.png"/></div></div></figure><p id="3d8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">导航至上传选项卡:</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/07c13e40f9299b97e7a66837ff068744.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfnqegtCDbmQ3Zf3DxKrjw.png"/></div></div></figure><p id="9077" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">向下滚动至上传预设部分，点击<em class="kb">添加上传预设:</em></p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mv"><img src="../Images/eed95e0597e7ae5cd3dba60efb910811.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*llLj99vgdMdJtIjFOKfPuA.png"/></div></div></figure><p id="1685" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在新页面中，选择<em class="kb">签名方式</em>为<em class="kb">未签名，同时选择</em>，复制<em class="kb">上传预置名称</em>，点击保存。</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mu"><img src="../Images/943f68ef06fcff7d1b300f26e969c7f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExiOiBsWf7s-sotJHoib4w.png"/></div></div></figure><p id="b267" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！好消息是您已经完成了 Cloudinary 的设置。</p><h1 id="888c" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">设置功能</h1><p id="168a" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf mb jh ji jj mc jl jm jn md jp jq jr hb bi translated">首先，我们为按钮添加一个<code class="du ls lt lu lv b">onClick</code>处理程序。为此，请导航回<code class="du ls lt lu lv b">App.js</code>，然后:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="c5ed" class="mn kk hi lv b fi mo mp l mq mr">function App() {<br/> <strong class="lv hj"><em class="kb">const handleClick = () =&gt; {};</em></strong></span><span id="ddfb" class="mn kk hi lv b fi ms mp l mq mr">return (<br/> &lt;div className="app"&gt;<br/> &lt;input type="file" className="app_uploadInput" /&gt;<br/> &lt;button className="app_uploadButton" <strong class="lv hj"><em class="kb">onClick={handleClick}</em></strong>&gt;Upload&lt;/button&gt;<br/>&lt;/div&gt;<br/> );<br/>}</span></pre><p id="fc7e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们正在定义一个名为‘handle click’的箭头函数，它现在是空的，当按钮被点击时就会被触发。下一步是将<em class="kb">手柄</em>点击。</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="f1bd" class="mn kk hi lv b fi mo mp l mq mr">function App() {<br/>const cloud_name = "your_cloud_name";<br/>const upload_preset = "your_upload_preset"; </span><span id="a4c1" class="mn kk hi lv b fi ms mp l mq mr">const handleClick = () =&gt; {<br/> <strong class="lv hj"><em class="kb">const { files } = document.querySelector(".app_uploadInput");<br/> const formData = new FormData();</em></strong></span><span id="1a37" class="mn kk hi lv b fi ms mp l mq mr"><strong class="lv hj"><em class="kb"> formData.append("file", files[0]);<br/> formData.append("upload_preset", upload_preset);<br/> const options = {<br/>  method: "POST",<br/>  body: formData,<br/> };</em></strong></span><span id="7c53" class="mn kk hi lv b fi ms mp l mq mr"><strong class="lv hj"><em class="kb"> return fetch(`https://api.Cloudinary.com/v1_1/${cloud_name}/image/upload`, options<br/>)<br/> .then((res) =&gt; res.json())<br/> .then((res) =&gt; console.log(res))<br/> .catch((err) =&gt; console.log(err));</em></strong><br/>};</span><span id="7e24" class="mn kk hi lv b fi ms mp l mq mr">//rest of code</span></pre><p id="899f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们来分解代码吧！<br/>首先我们要<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment" rel="noopener ugc nofollow" target="_blank">析构</a>上传输入的文件数组。然后我们创建一个新的<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/FormData" rel="noopener ugc nofollow" target="_blank">表单数据</a>。然后我们<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/API/FormData/append" rel="noopener ugc nofollow" target="_blank">将上传输入的第一个上传文件</a>和我们的<em class="kb"> upload_preset </em>一起添加到表单数据中。之后，我们向 Cloudinary API 端点发送一个 POST 请求，类似于:<code class="du ls lt lu lv b">https://api.cloudinary.com/v1_1/:cloud_name/:action.</code>然后我们将在控制台中得到结果/错误！</p><p id="7941" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，让我们测试我们的应用程序。转到<code class="du ls lt lu lv b">localhost:3000</code>，上传一个文件并点击按钮。在控制台中，您可以看到结果！</p><p id="07a5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！好消息是您已经完成了函数的设置:)</p><h1 id="d51b" class="kj kk hi bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">更新用户界面</h1><p id="36b7" class="pw-post-body-paragraph iu iv hi iw b ix lj iz ja jb lk jd je jf mb jh ji jj mc jl jm jn md jp jq jr hb bi translated">现在让我们在 UI 中显示<em class="kb">上传的</em>图片。<br/>为此，首先让我们创建一个<a class="ae kc" href="https://reactjs.org/docs/hooks-state.html" rel="noopener ugc nofollow" target="_blank">状态钩子</a>。</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="25ec" class="mn kk hi lv b fi mo mp l mq mr"><strong class="lv hj"><em class="kb">import { useState } from "react";</em></strong></span><span id="b318" class="mn kk hi lv b fi ms mp l mq mr">function App() {<br/><strong class="lv hj"><em class="kb"> const [imageUrl, setImageUrl] = useState("");<br/></em></strong>//rest of the code</span></pre><p id="6e2a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><em class="kb">其次</em>，让我们创建一个新的<code class="du ls lt lu lv b">img</code>来显示图像:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="9ffc" class="mn kk hi lv b fi mo mp l mq mr">&lt;div className="app"&gt;<br/> &lt;input type="file" className="app_uploadInput" /&gt;<br/> <strong class="lv hj"><em class="kb">&lt;img src={imageUrl} className="app_uploadedImg" alt="" /&gt;</em></strong><br/> &lt;button className="app_uploadButton" onClick={handleClick}&gt;Upload&lt;/button&gt;<br/>&lt;/div&gt;</span></pre><p id="4d24" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以在您的<code class="du ls lt lu lv b">App.css</code>中添加:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="fbfd" class="mn kk hi lv b fi mo mp l mq mr">.app_uploadedImg {<br/> height: 10rem;<br/> width: 10rem;<br/> position: absolute;<br/> top: 0;<br/>}</span></pre><p id="9745" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在，您的<code class="du ls lt lu lv b">App.js</code>可能看起来像:</p><figure class="mf mg mh mi fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mw"><img src="../Images/dbc41e44caa0be1727c3e2b3ac2be76a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vk34zrlD0nMFN4P8b3J8RA.png"/></div></div></figure><p id="d6de" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">接下来，是最重要的部分！<br/>将您的帖子请求编辑为:</p><pre class="mf mg mh mi fd mj lv mk ml aw mm bi"><span id="b36d" class="mn kk hi lv b fi mo mp l mq mr">return fetch(`https://api.cloudinary.com/v1_1/${cloud_name}/image/upload`, options)<br/> .then((res) =&gt; res.json())<br/> <strong class="lv hj"><em class="kb">.then((res) =&gt; {<br/>  setImageUrl(res.secure_url);<br/> })</em></strong><br/> .catch((err) =&gt; console.log(err));</span></pre><p id="29cc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这段代码将图片上传到 Cloudinary 后，将<code class="du ls lt lu lv b">imageUrl</code>设置为我们得到的 URL。</p><p id="22c6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">就是这样！好消息是您已经完成了 UI 的更新。</p><p id="d394" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以访问您的 Cloudinary 仪表盘来查看、编辑、删除(等等。)上传的图片。</p><p id="aef3" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">今天就到这里吧！如果你读这篇文章感到无聊，找到这个有趣的提示:“GitLab”这个名字是如何形成的？通过连接字母 G-i-t-l-a-b。就是这样！<em class="kb">好消息是你已经看完了我的小</em> <strong class="iw hj"> <em class="kb">笑话</em> </strong> <em class="kb">！</em></p><p id="7563" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">如果你没看过我之前的文章，在这里找到<a class="ae kc" rel="noopener" href="/nerd-for-tech/react-frontend-nodejs-backend-167e2904e5c9">。</a></p><p id="933c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">希望你们都喜欢这个！</p><p id="c8be" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">谢谢！</p></div></div>    
</body>
</html>