<html>
<head>
<title>Building Spring Boot Microservices , Monitoring with prometheus and grafana and log aggregation using ELK stack: Part III</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建Spring Boot微服务，使用prometheus和grafana进行监控，使用ELK stack进行日志聚合:第三部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/building-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-1e51016210ba?source=collection_archive---------2-----------------------#2021-02-20">https://medium.com/nerd-for-tech/building-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-1e51016210ba?source=collection_archive---------2-----------------------#2021-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/983041f6a3fad46b57e85fb4727fa170.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*GuJPp5hcevkj0rG8xg5k3Q.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">麋鹿</figcaption></figure><p id="8d6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在之前的<a class="ae jo" href="https://firas-messaoudi.medium.com/building-spring-boot-microservices-monitoring-with-prometheus-and-grafana-and-log-aggregation-5ed9ca7dda36" rel="noopener">部分</a>中，我们设法创建了3个springboot微服务，并与prometheus和grafana一起监控它们。</p><p id="3121" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一部分，我们将重点关注日志聚合和分析。</p><h2 id="8d39" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">为什么它如此重要？</h2><p id="3801" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">日志是必不可少的信息，允许我们更好地理解、分析和诊断某些故障，因为它们可以帮助我们跟踪和追踪由我们系统的参与者执行的不同操作。只是，在一个信息系统中，利用如此多的应用程序、设备、服务、系统和受管元素来利用这些关键数据变得非常复杂。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es kp"><img src="../Images/e77d9e0276b57eaff7fb62243e6188d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*mvjmHh-S4tHW1sY0rWQqhA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">日志分析</figcaption></figure><p id="7353" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为这个问题的解决方案，我们将使用ELK stack，它是用于日志聚合和分析的最好、最有效的工具之一。</p><h2 id="9e71" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">那么什么是麋鹿栈呢？</h2><p id="0b45" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">ELK由Elasticsearch、Logstash和Kibana组成，是一个由三个互为补充的开源项目组成的套件。这三个工具将使向系统管理员显示概览成为可能，同时向他提供他所负责的元素的快速图形分析。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/efe56ffcdd1bea2ff4068a6504087da3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*2MJNL99XfZZhB5px2DUIlg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">麋鹿</figcaption></figure><p id="fa0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">1-elastic search:</strong>elastic search是一个实时分布式开源全文搜索和分析引擎。它可以从RESTful web服务接口访问，并使用JSON文档来存储数据。它建立在Java编程语言之上，因此Elasticsearch可以在不同的平台上运行。它使用户能够以非常高的速度探索大量的数据。</p><p id="ae07" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2-Logstash: </strong>那时，Logstash被用来处理来自应用程序的日志，并将它们发送到Elasticsearch。但是，从那时起，logstash已经发展成为一个更通用的工具，使它成为一个数据处理管道。</p><p id="2b87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">logstash收集的数据将被处理并运送到一个或多个目的地(Elasticsearch、kafka、e-mail……)。</p><p id="9187" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3-Kibana:  Kibana基本上是一个分析和可视化平台，它让您可以轻松地可视化来自Elasticsearch的数据，并对其进行分析以理解其意义。您可以假设Kibana是一个Elasticsearch仪表板，您可以在其中创建可视化效果，如饼图、折线图等。</p><h2 id="df24" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">全球建筑</h2><p id="698c" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">以下是ELK堆栈的架构，显示了ELK中日志流的正确顺序。在这里，Logstash根据提供的过滤标准收集和处理从各种来源生成的日志。Logstash然后将这些日志传输到Elasticsearch，后者随后分析和搜索这些数据。最后，使用Kibana，根据需求可视化和管理日志。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/e78622bb27137c98cc6e450ae2ad8502.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*6zntB1gugyuF3nohPjGjPg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">麋鹿建筑</figcaption></figure><h2 id="b2ad" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">带微服务的麋鹿</h2><p id="3746" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated">我们所有的微服务都会把各自的日志推送到Logstash，Logstash会用Elasticsearch来索引。索引日志可以在以后被Kibana使用。</p><p id="e48d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用Logback作为日志框架。</p><p id="bf3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Logback提供了更快的实现，为配置提供了更多的选项，并在归档旧日志文件方面提供了更多的灵活性。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/573fac71c652480a4ed25a0e3e52b3a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YOe_Pltc-N6ZqV1WlNon0Q.png"/></div></div></figure><h2 id="7857" class="jp jq hi bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">使用spring boot微服务设置ELK</h2><p id="6bce" class="pw-post-body-paragraph iq ir hi is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn hb bi translated"><strong class="is hj">1-安装弹性搜索</strong></p><p id="b495" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从https://www.elastic.co/downloads/elasticsearch<a class="ae jo" href="https://www.elastic.co/downloads/elasticsearch" rel="noopener ugc nofollow" target="_blank">下载Elasticsearch zip文件</a></p><p id="48da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解压缩然后运行它。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es lb"><img src="../Images/aa5e421ec715c159702ff35cd2a47877.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*LISldpQZT56W_0Xmc4o6AQ.png"/></div></figure><p id="1d21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了确保一切正常，请打开浏览器:<a class="ae jo" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a> :9200。您一定会看到类似于以下群集信息的内容:</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es lc"><img src="../Images/25de241c325c8c93a1ef88a02d27b1af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*Duxp8Ug1Tod6dlodFG4F5g.png"/></div></figure><p id="2ac5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">2-安装基巴纳</strong></p><p id="4a04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从https://www.elastic.co/downloads/kibana<a class="ae jo" href="https://www.elastic.co/downloads/kibana" rel="noopener ugc nofollow" target="_blank">下载Elasticsearch zip文件</a></p><p id="a69c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">解压缩然后运行它。</p><p id="c32f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在浏览器中打开Kibana，使用:<a class="ae jo" href="http://localhost:5601." rel="noopener ugc nofollow" target="_blank"> http://localhost:5601。</a>您将看到基巴纳主页。</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es ld"><img src="../Images/5f756251f65d441f01eee6a1ffad1213.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*nBSsdOsaCtxXe5_qvGKVeQ.png"/></div></figure><p id="3c55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">3-安装&amp;配置日志存储</strong></p><p id="e757" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从https://www.elastic.co/downloads/logstash<a class="ae jo" href="https://www.elastic.co/downloads/logstash" rel="noopener ugc nofollow" target="_blank">下载Elasticsearch zip文件</a></p><p id="e65c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">拉开拉链。</p><p id="9ffa" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">logstash配置主要包括3个阶段:</p><p id="323b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.<strong class="is hj">输入</strong></p><p id="ecd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置文件中的输入部分定义了要使用的输入插件。每个插件都有自己的配置选项，您应该在使用前进行研究。在我们的cas中，它将是一个从我们的微服务日志中获取的json流，我们将使用tcp插件来监听任何发送的日志。</p><p id="298d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.<strong class="is hj">过滤器</strong></p><p id="9ed8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置文件中的过滤器部分定义了我们想要使用的过滤器插件，或者换句话说，我们想要对日志应用什么处理。每个插件都有自己的配置选项，您应该在使用前进行研究。</p><p id="48fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.<strong class="is hj">输出</strong></p><p id="2d62" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">配置文件中的输出部分定义了我们想要将日志发送到的目的地(例如elasticsearch)。和以前一样，每个插件都有自己的配置选项，您应该在使用之前进行研究。</p><p id="2641" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我们的logstash文件配置将类似于此:</p><pre class="kq kr ks kt fd le lf lg lh aw li bi"><span id="957f" class="jp jq hi lf b fi lj lk l ll lm">input {<br/> tcp {<br/>  port =&gt; 7000<br/>  codec =&gt; "json"<br/> }<br/>}</span><span id="35db" class="jp jq hi lf b fi ln lk l ll lm">output {<br/> elasticsearch {<br/>   hosts =&gt; ["localhost:9200"]<br/>   index =&gt;"ecommerce"<br/> }<br/>}</span></pre><p id="2958" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行它</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div class="er es lo"><img src="../Images/7dd7318bc7000a575e1a4220c01e12ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1118/format:webp/1*-N3P0ruPOxCK-_5PA6XqGA.png"/></div></figure><p id="2f6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Losgatsh将启动并公开两个端口:</p><ul class=""><li id="6f1d" class="lp lq hi is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated">9600 logstash api端点</li><li id="332c" class="lp lq hi is b it ly ix lz jb ma jf mb jj mc jn lu lv lw lx bi translated">先前定义的7000 tcp输入监听器。</li></ul><p id="2904" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">4-配置回退</strong></p><p id="33bd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们首先需要将这些maven依赖项添加到我们的每个微服务中:</p><pre class="kq kr ks kt fd le lf lg lh aw li bi"><span id="2ffc" class="jp jq hi lf b fi lj lk l ll lm">&lt;dependency&gt;</span><span id="1ec3" class="jp jq hi lf b fi ln lk l ll lm">&lt;groupId&gt;net.logstash.logback&lt;/groupId&gt;</span><span id="f4a4" class="jp jq hi lf b fi ln lk l ll lm">&lt;artifactId&gt;logstash-logback-encoder&lt;/artifactId&gt;</span><span id="723a" class="jp jq hi lf b fi ln lk l ll lm">&lt;version&gt;5.1&lt;/version&gt;</span><span id="823d" class="jp jq hi lf b fi ln lk l ll lm">&lt;/dependency&gt;</span><span id="5562" class="jp jq hi lf b fi ln lk l ll lm">&lt;dependency&gt;</span><span id="78d5" class="jp jq hi lf b fi ln lk l ll lm">&lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><span id="41a9" class="jp jq hi lf b fi ln lk l ll lm">&lt;artifactId&gt;logback-core&lt;/artifactId&gt;</span><span id="770a" class="jp jq hi lf b fi ln lk l ll lm">&lt;/dependency&gt;</span><span id="7d1a" class="jp jq hi lf b fi ln lk l ll lm">&lt;dependency&gt;</span><span id="d38f" class="jp jq hi lf b fi ln lk l ll lm">&lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><span id="ce7d" class="jp jq hi lf b fi ln lk l ll lm">&lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><span id="066f" class="jp jq hi lf b fi ln lk l ll lm">&lt;/dependency&gt;</span></pre><p id="2abd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后添加这些配置类:</p><pre class="kq kr ks kt fd le lf lg lh aw li bi"><span id="33f1" class="jp jq hi lf b fi lj lk l ll lm">@Configuration</span><span id="ed59" class="jp jq hi lf b fi ln lk l ll lm">public class LogbackConfiguration {</span><span id="a257" class="jp jq hi lf b fi ln lk l ll lm">private static final String LOGSTASH_APPENDER_NAME = "LOGSTASH";</span><span id="5bc9" class="jp jq hi lf b fi ln lk l ll lm">private static final String ASYNC_LOGSTASH_APPENDER_NAME = "ASYNC_LOGSTASH";</span><span id="5a88" class="jp jq hi lf b fi ln lk l ll lm">private final Logger LOG = LoggerFactory.getLogger(LoggingConfiguration.class);</span><span id="d9ef" class="jp jq hi lf b fi ln lk l ll lm">private final LoggerContext CONTEXT = (LoggerContext) LoggerFactory.getILoggerFactory();</span><span id="4c6c" class="jp jq hi lf b fi ln lk l ll lm">private final String appName;</span><span id="b956" class="jp jq hi lf b fi ln lk l ll lm">private final String logstashHost;</span><span id="b223" class="jp jq hi lf b fi ln lk l ll lm">private final Integer logstashPort;</span><span id="9ca0" class="jp jq hi lf b fi ln lk l ll lm">private final Integer logstashQueueSize;</span><span id="b085" class="jp jq hi lf b fi ln lk l ll lm">public LogbackConfiguration(</span><span id="8277" class="jp jq hi lf b fi ln lk l ll lm">@Value("${spring.application.name}") String appName,</span><span id="16c5" class="jp jq hi lf b fi ln lk l ll lm">@Value("${logstash.host}") String logstashHost,</span><span id="7139" class="jp jq hi lf b fi ln lk l ll lm">@Value("${logstash.port}") Integer logstashPort,</span><span id="778d" class="jp jq hi lf b fi ln lk l ll lm">@Value("${logstash.queue-size}") Integer logstashQueueSize) {</span><span id="314d" class="jp jq hi lf b fi ln lk l ll lm">this.appName = appName; </span><span id="5ff4" class="jp jq hi lf b fi ln lk l ll lm">this.logstashHost = logstashHost; </span><span id="9af2" class="jp jq hi lf b fi ln lk l ll lm">this.logstashPort = logstashPort; </span><span id="73be" class="jp jq hi lf b fi ln lk l ll lm">this.logstashQueueSize = logstashQueueSize; </span><span id="98b6" class="jp jq hi lf b fi ln lk l ll lm">addLogstashAppender(CONTEXT);</span><span id="e869" class="jp jq hi lf b fi ln lk l ll lm">}</span><span id="321a" class="jp jq hi lf b fi ln lk l ll lm">private void addLogstashAppender(LoggerContext context) {</span><span id="dad8" class="jp jq hi lf b fi ln lk l ll lm">LOG.info("Initializing Logstash logging");</span><span id="b8c5" class="jp jq hi lf b fi ln lk l ll lm">LogstashTcpSocketAppender logstashAppender = new LogstashTcpSocketAppender(); </span><span id="4648" class="jp jq hi lf b fi ln lk l ll lm">logstashAppender.setName(LOGSTASH_APPENDER_NAME);</span><span id="ad68" class="jp jq hi lf b fi ln lk l ll lm">logstashAppender.setContext(context);</span><span id="8d53" class="jp jq hi lf b fi ln lk l ll lm">String customFields = "{\"servicename\":\"" + this.appName + "\"}"; &lt;3&gt;</span><span id="9401" class="jp jq hi lf b fi ln lk l ll lm">// More documentation is available at: <a class="ae jo" href="https://github.com/logstash/logstash-logback-encoder" rel="noopener ugc nofollow" target="_blank">https://github.com/logstash/logstash-logback-encoder</a></span><span id="160b" class="jp jq hi lf b fi ln lk l ll lm">LogstashEncoder logstashEncoder = new LogstashEncoder();</span><span id="0636" class="jp jq hi lf b fi ln lk l ll lm">// Set the Logstash appender config</span><span id="07d8" class="jp jq hi lf b fi ln lk l ll lm">logstashEncoder.setCustomFields(customFields);</span><span id="f524" class="jp jq hi lf b fi ln lk l ll lm">logstashAppender.addDestinations( </span><span id="3650" class="jp jq hi lf b fi ln lk l ll lm">new InetSocketAddress(this.logstashHost, this.logstashPort) </span><span id="4e4b" class="jp jq hi lf b fi ln lk l ll lm">);</span><span id="c96f" class="jp jq hi lf b fi ln lk l ll lm">ShortenedThrowableConverter throwableConverter = new ShortenedThrowableConverter();</span><span id="be6f" class="jp jq hi lf b fi ln lk l ll lm">throwableConverter.setRootCauseFirst(true);</span><span id="b00e" class="jp jq hi lf b fi ln lk l ll lm">logstashEncoder.setThrowableConverter(throwableConverter);</span><span id="b0c3" class="jp jq hi lf b fi ln lk l ll lm">logstashEncoder.setCustomFields(customFields);</span><span id="9285" class="jp jq hi lf b fi ln lk l ll lm">logstashAppender.setEncoder(logstashEncoder);</span><span id="a004" class="jp jq hi lf b fi ln lk l ll lm">logstashAppender.start();</span><span id="beea" class="jp jq hi lf b fi ln lk l ll lm">// Wrap the appender in an Async appender for performance</span><span id="5ed1" class="jp jq hi lf b fi ln lk l ll lm">AsyncAppender asyncLogstashAppender = new AsyncAppender();</span><span id="9931" class="jp jq hi lf b fi ln lk l ll lm">asyncLogstashAppender.setContext(context); </span><span id="0ae4" class="jp jq hi lf b fi ln lk l ll lm">asyncLogstashAppender.setName(ASYNC_LOGSTASH_APPENDER_NAME); </span><span id="8c38" class="jp jq hi lf b fi ln lk l ll lm">asyncLogstashAppender.setQueueSize(this.logstashQueueSize); </span><span id="435c" class="jp jq hi lf b fi ln lk l ll lm">asyncLogstashAppender.addAppender(logstashAppender); </span><span id="151f" class="jp jq hi lf b fi ln lk l ll lm">asyncLogstashAppender.start(); </span><span id="76c9" class="jp jq hi lf b fi ln lk l ll lm">context.getLogger("ROOT").addAppender(asyncLogstashAppender); </span><span id="8e46" class="jp jq hi lf b fi ln lk l ll lm">}</span><span id="9791" class="jp jq hi lf b fi ln lk l ll lm">}</span></pre><p id="57f2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后添加这些属性:</p><pre class="kq kr ks kt fd le lf lg lh aw li bi"><span id="7ef4" class="jp jq hi lf b fi lj lk l ll lm">logstash.host= localhost</span><span id="787b" class="jp jq hi lf b fi ln lk l ll lm">logstash.port= 7000</span><span id="9d01" class="jp jq hi lf b fi ln lk l ll lm">logstash.queue-size= 512</span></pre><p id="498e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们运行我们的微服务，并前往基巴纳，开始使用我们的索引。</p><p id="72bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在kibana中，转到管理并单击创建索引模式:</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es md"><img src="../Images/778ced3a73aecd0f193e4ef5ab5a2f55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afmAGAR0GZTMKd3oJuZ4kw.png"/></div></div></figure><p id="2c7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将在logstash配置文件中找到索引的名称。</p><p id="1485" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在转到“发现”部分，您会发现由我们的微服务生成的日志流:</p><figure class="kq kr ks kt fd ij er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es me"><img src="../Images/e5ca019073cf5fbb39e9d6694ed11e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_1O98EbanJgZNkw7NNjxQ.png"/></div></div></figure><p id="c808" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在你可以玩kibana，根据你的需要生成很酷的dashbords。</p><p id="2d76" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这个项目的最新版本可以在git存储库中找到。</p><p id="a7ba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://github.com/FirasMessaoudi/ecommerce" rel="noopener ugc nofollow" target="_blank">https://github.com/FirasMessaoudi/ecommerce</a></p></div></div>    
</body>
</html>