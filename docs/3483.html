<html>
<head>
<title>Full Scale development of Recommendation system as ML Engineer from scratch.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为ML工程师，从零开始全面开发推荐系统。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/full-scale-development-of-recommendation-system-as-ml-engineer-from-scratch-ba66c05b1f4b?source=collection_archive---------18-----------------------#2021-06-11">https://medium.com/nerd-for-tech/full-scale-development-of-recommendation-system-as-ml-engineer-from-scratch-ba66c05b1f4b?source=collection_archive---------18-----------------------#2021-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/3869b9d9bafce36ea543820a6901c775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LTdYgNvU_B9fl0PRKV_Qcg.jpeg"/></div></div></figure><p id="6cc6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从许多方面来看，推荐系统都是最重要和最复杂的软件工程系统之一。这是网飞、youtube等巨头成功的原因之一。</p><p id="fed4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将一个全面的推荐系统作为一个工作中的公司的现成可部署产品，需要深度学习、逻辑编程、数据库和领域的大量知识，除此之外，您还应该具备部署和维护所需的软件工程和开发知识。[“是的，这些我都知道，哈哈”]</p><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es jo"><img src="../Images/6c4ff952c9010da5ed461ffaca02f02c.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*npOCjUfkcgmEIMe9bmtVDA.jpeg"/></div></figure><p id="ff7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">大家好，我是Aditya Raj，目前是阿拉哈巴德IIIT大学的二年级学生，同时也是yellowbacks.com大学的机器学习工程师。</p><p id="daac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我现在已经工作了5个月，感到非常幸运能在一家成长中的初创公司工作，我学到了很多东西，并有机会设计、制作和部署一些有趣的基于人工智能的系统。</p><p id="c48b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">好吧，在这里我将谈论我最喜欢的项目，它让我真正成为了一名完整的软件工程师。好吧，我会试着从头开始解释，但基本的工程和数学知识不会让你觉得狗屎。</p><p id="c558" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这里，有价值的计算机视觉知识是优选的。如果你没有，下面是另一个博客的链接。</p><p id="c817" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我将保持事情的小基本相比，原来的项目，以便任何人都可以参考他们未来的项目。</p><p id="a8b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">推荐系统:-推荐系统是基于人工智能的软件系统，它根据产品的特征或用户的特征或两者向用户推荐产品。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ju"><img src="../Images/d971cfda679bf85fc87fede85410fbca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wgxoYnYtDnTOCTNdUbnYYA.png"/></div></div></figure><p id="5bd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在基于项目的推荐系统中，我们发现项目的特征，然后根据特征之间的相似性进行推荐。(内容过滤)</p><p id="d00c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在基于用户中，我们发现用户的特征，然后向相似的用户推荐相似的产品。(协同过滤)</p><p id="61a1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">混合推荐系统是一个使用两者的系统。我正在开发混合推荐系统。</p><p id="3957" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天，我将解释基于内容的部分，我仍然在努力将其转换为混合之一。我做的推荐系统是为一个时尚创业公司，所以它是一个基于视觉的产品(计算机视觉的东西)。它基本上是在亚马逊上以“你可能也会喜欢”的形式向你展示产品的东西。</p><p id="ea99" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的工作系统的基本演示</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/3d028ca7eef89b81452f52c5c212a9c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A6VzcEb9rY07gw6UW3okXg.png"/></div></div></figure><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jv"><img src="../Images/e686ee3a84f0007207cf69fc4610e991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RUjm0WxTWPT68E7Xmdf5YQ.png"/></div></div></figure><p id="f406" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在把它与一家大型科技公司的相比较</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jw"><img src="../Images/d8222355c50ed2be3cdc3c1aad8710b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oKJXlS0MsDlaZ9-hR1AcHA.png"/></div></div></figure><p id="faa2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗯，谢谢，我知道我很好……..</p><p id="d778" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要为设计而哭泣，因为它只是一个<strong class="is hj"> api </strong>还没有嵌入到一个漂亮的软件中。</p><p id="75f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们来学习。</p><p id="1cd9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我将在这些部分解释整个系统:-</p><ol class=""><li id="bf8b" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">高级外观和设计</li><li id="209c" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">R&amp;E(研究和实验)</li><li id="c48c" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">深度学习和数据工程</li><li id="10bc" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">后端编码和API制作</li><li id="512d" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">部署</li></ol><h1 id="9bf5" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated"><strong class="ak">高级外观和设计</strong></h1><p id="f872" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">所以，这部分对我来说是最难写的，让我们试试:-</p><p id="7e4a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简单地说，考虑时尚网站的每个图像都存储在数据库服务器中。假设每个图像都被转换成2048维的数学向量(或者对于编码器来说是具有2048个元素的数组)。现在假设一个用户正在为他的女朋友看一条牛仔裤，而我的人工智能系统必须向他推荐相似的牛仔裤，那会怎样呢？</p><p id="cf20" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很简单，计算当前jean向量与所有图像向量之间的距离，并输出距离最小的图像。</p><p id="464a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，我必须设计和编写一个算法，为每张图片寻找嵌入(向量)，并将其保存在数据库和另一个基本代码，以寻找向量之间的距离，并推荐距离较小的图片。</p><p id="16ca" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这并不简单，为每张图像寻找嵌入需要大量的深度学习、机器学习知识和经验，最重要的是耐心。</p><h1 id="5293" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">研究和实验部分</h1><p id="ef7a" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">这一部分包括更多地研究和理解github、colab、medium和其他开源平台上的现有系统和模型。</p><p id="7bf6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在解释我所有的研究和实验肯定会让你厌烦，所以直接下结论吧。</p><p id="9fc3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我从研究和实验中学到的</p><ol class=""><li id="886a" class="jx jy hi is b it iu ix iy jb jz jf ka jj kb jn kc kd ke kf bi translated">我应该使用迁移学习法，以时尚图像分类为基础。</li><li id="4498" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">DeepFashion数据集是可用的最佳选项。</li><li id="32c7" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">迁移学习架构应修改为与分类并行的对象检测或包围盒架构，以忽略背景以及分别推荐每个时尚子部分。</li><li id="729c" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">嵌入应该是一维的，并且被排列以使得数据库更便宜并且使得距离计算更快。</li><li id="d602" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">系统的延迟应该是低的，欧几里德距离在这里是简单、容易和有效的方法。</li><li id="4163" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">对象检测和裁剪也应该非常有效地完成，因为在我的情况下，需要推荐上装和下装，所以我使用了脸书·艾的detectron 2进行裁剪(“我很先进”)。</li><li id="4fb1" class="jx jy hi is b it kg ix kh jb ki jf kj jj kk jn kc kd ke kf bi translated">对于detectron 2，deepfashion 2用于多目标检测。</li></ol><h1 id="472b" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">深度学习和数据工程</h1><p id="7dfc" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">这部分涉及到项目最复杂的方面，即获得嵌入(数学向量)。</p><p id="5bd5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你不知道计算机视觉的基础知识，我很抱歉，我有另一个博客给你，将在描述中提供。</p><p id="24eb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在计算向量之前，我们需要从图像中裁剪出下穿和上穿图像。我们将使用detectron:</p><p id="9488" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">步骤1:-预处理深度时尚2:-</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="1e58" class="lt km hi lp b fi lu lv l lw lx"><strong class="lp hj">from</strong> <strong class="lp hj">PIL</strong> <strong class="lp hj">import</strong> Image<br/><strong class="lp hj">import</strong> <strong class="lp hj">numpy</strong> <strong class="lp hj">as</strong> <strong class="lp hj">np</strong><br/><strong class="lp hj">import</strong> <strong class="lp hj">json</strong><br/><br/>dataset = {<br/>    "info": {},<br/>    "licenses": [],<br/>    "images": [],<br/>    "annotations": [],<br/>    "categories": []<br/>}<br/><br/>lst_name = ['short_sleeved_shirt', 'long_sleeved_shirt', 'short_sleeved_outwear', 'long_sleeved_outwear',<br/>            'vest', 'sling', 'shorts', 'trousers', 'skirt', 'short_sleeved_dress',<br/>            'long_sleeved_dress', 'vest_dress', 'sling_dress']<br/><br/><strong class="lp hj">for</strong> idx, e  <strong class="lp hj">in</strong> enumerate(lst_name):<br/>    dataset['categories'].append({<br/>        'id': idx + 1,<br/>        'name': e,<br/>        'supercategory': "clothes",<br/>        'keypoints': ['<strong class="lp hj">%i</strong>' % (i) <strong class="lp hj">for</strong> i <strong class="lp hj">in</strong> range(1, 295)],<br/>        'skeleton': []<br/>    })<br/><br/>num_images = 32153 <em class="ly">#191961 </em><br/>sub_index = 0  <em class="ly"># the index of ground truth instance</em><br/><strong class="lp hj">for</strong> num <strong class="lp hj">in</strong> range(1, num_images + 1):<br/>    json_name = '/content/validation/annos/' + str(num).zfill(6) + '.json'<br/>    image_name = '/content/validation/image/' + str(num).zfill(6) + '.jpg'<br/><br/>    <strong class="lp hj">if</strong> (num &gt;= 0):<br/>        imag = Image.open(image_name)<br/>        width, height = imag.size<br/>        <strong class="lp hj">with</strong> open(json_name, 'r') <strong class="lp hj">as</strong> f:<br/>            temp = json.loads(f.read())<br/>            pair_id = temp['pair_id']<br/><br/>            dataset['images'].append({<br/>                'coco_url': '',<br/>                'date_captured': '',<br/>                'file_name': str(num).zfill(6) + '.jpg',<br/>                'flickr_url': '',<br/>                'id': num,<br/>                'license': 0,<br/>                'width': width,<br/>                'height': height<br/>            })<br/>            <strong class="lp hj">for</strong> i <strong class="lp hj">in</strong> temp:<br/>                <strong class="lp hj">if</strong> i == 'source' <strong class="lp hj">or</strong> i == 'pair_id':<br/>                    <strong class="lp hj">continue</strong><br/>                <strong class="lp hj">else</strong>:<br/>                    points = np.zeros(294 * 3)<br/>                    sub_index = sub_index + 1<br/>                    box = temp[i]['bounding_box']<br/>                    w = box[2] - box[0]<br/>                    h = box[3] - box[1]<br/>                    x_1 = box[0]<br/>                    y_1 = box[1]<br/>                    bbox = [x_1, y_1, w, h]<br/>                    cat = temp[i]['category_id']<br/>                    style = temp[i]['style']<br/>                    seg = temp[i]['segmentation']<br/>                    landmarks = temp[i]['landmarks']<br/><br/>                    points_x = landmarks[0::3]<br/>                    points_y = landmarks[1::3]<br/>                    points_v = landmarks[2::3]<br/>                    points_x = np.array(points_x)<br/>                    points_y = np.array(points_y)<br/>                    points_v = np.array(points_v)<br/>                    case = [0, 25, 58, 89, 128, 143, 158, 168, 182, 190, 219, 256, 275, 294]<br/>                    idx_i, idx_j = case[cat - 1], case[cat]<br/><br/>                    <strong class="lp hj">for</strong> n <strong class="lp hj">in</strong> range(idx_i, idx_j):<br/>                        points[3 * n] = points_x[n - idx_i]<br/>                        points[3 * n + 1] = points_y[n - idx_i]<br/>                        points[3 * n + 2] = points_v[n - idx_i]<br/><br/>                    num_points = len(np.where(points_v &gt; 0)[0])<br/><br/>                    dataset['annotations'].append({<br/>                        'area': w * h,<br/>                        'bbox': bbox,<br/>                        'category_id': cat,<br/>                        'id': sub_index,<br/>                        'pair_id': pair_id,<br/>                        'image_id': num,<br/>                        'iscrowd': 0,<br/>                        'style': style,<br/>                        'num_keypoints': num_points,<br/>                        'keypoints': points.tolist(),<br/>                        'segmentation': seg,<br/>                    })<br/><br/>json_name = '/content/deepfashion2_train.json'<br/><strong class="lp hj">with</strong> open(json_name, 'w') <strong class="lp hj">as</strong> f:<br/>    json.dump(dataset, f)</span></pre><p id="dfde" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">步骤2 :-在深度时尚2上培训侦探2:-</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="cac4" class="lt km hi lp b fi lu lv l lw lx">cfg = get_cfg()<br/><br/>cfg.merge_from_file(model_zoo.get_config_file("COCO-Detection/faster_rcnn_R_101_FPN_3x.yaml"))<br/>cfg.DATASETS.TRAIN = ("deepfashion_train",)<br/>cfg.DATASETS.TEST = ()<br/>cfg.MODEL.WEIGHTS = model_zoo.get_checkpoint_url("COCO-Detection/faster_rcnn_R_101_FPN_3x.yaml")  <em class="ly"># Let training initialize from model zoo</em><br/><br/>cfg.SOLVER.IMS_PER_BATCH = 4<br/>cfg.SOLVER.BASE_LR = 0.001<br/>cfg.SOLVER.WARMUP_ITERS = 1000<br/>cfg.SOLVER.MAX_ITER = 1500<br/>cfg.SOLVER.STEPS = (1000,1500)<br/>cfg.SOLVER.GAMMA = 0.05<br/>cfg.MODEL.ROI_HEADS.BATCH_SIZE_PER_IMAGE = 64<br/>cfg.MODEL.ROI_HEADS.NUM_CLASSES = 13<br/><br/>cfg.TEST.EVAL_PERIOD = 500</span><span id="2f03" class="lt km hi lp b fi lz lv l lw lx">os.makedirs(cfg.OUTPUT_DIR, exist_ok=<strong class="lp hj">True</strong>)<br/>trainer = DefaultTrainer(cfg) <br/>trainer.resume_or_load(resume=<strong class="lp hj">False</strong>)<br/>trainer.train()</span></pre><p id="57e8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">步骤3:-将准备好的模型和配置保存在zip文件中</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="3757" class="lt km hi lp b fi lu lv l lw lx"><strong class="lp hj">import</strong> <strong class="lp hj">shutil</strong><br/>shutil.make_archive('fashion_model', 'zip', '/content/output')<br/>%<strong class="lp hj">cp</strong> "/content/fashion_model.zip" "/content/drive/My Drive/"</span></pre><p id="9bf4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，让我们开发一个裁剪功能，在训练有素的detectron模型的帮助下，将任何图像裁剪成上装和下装。</p><p id="ad54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们已经把上衣和下装的图像分开了，我们必须为嵌入训练模型。</p><p id="a978" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个适当的深度学习项目。使用一个resnet 50型号的keras，在Deepfashion上微调最后几层。现在，为了有更好的效果，我们将添加2层的边界框，最后在深度时尚上进行分类检测。</p><h2 id="77d8" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">model _ resnet = resnet 50(weights = ' imagenet '，include_top=False，pooling='avg ')</h2><h2 id="8070" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">对于model_resnet.layers[:-12]中的层:</h2><h2 id="0f79" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">layer.trainable = False</h2><h2 id="82d0" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">x =模型_resnet .输出</h2><h2 id="99bd" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">x = Dense(512，activation='elu '，kernel _ regulator = L2(0.001))(x)#这里是elu，不是RELU</h2><h2 id="9599" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">y = Dense(46，activation='softmax '，name='img')(x)</h2><h2 id="a505" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">x_bbox =模型_resnet .输出</h2><h2 id="51ef" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">x_bbox = Dense(512，activation='relu '，kernel _ regulator = L2(0.001))(x _ bbox)</h2><h2 id="3aec" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">x_bbox = Dense(128，activation='relu '，kernel _ regulator = L2(0.001))(x _ bbox)</h2><h2 id="254f" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">bbox = Dense(4，kernel_initializer='normal '，name='bbox')(x_bbox)</h2><h2 id="c4a7" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">final _ Model = Model(inputs = Model _ resnet . input，</h2><h2 id="3423" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">输出=[y，bbox])</h2><h2 id="1a97" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">以前的建筑</h2><p id="347d" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ con V5 _ block 3 _ 3 _ bn(BatchNormali(无，无，无，2 8192 con V5 _ block 3 _ 3 _ conv[0][0]_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ con V5 _ block 3 _ Add(Add)(无，无，无，2 0</p><p id="65ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">该架构在deepfashion数据集上的gpu上训练了120个时代。</p><h2 id="1390" class="lt km hi bd kn ma mb mc kr md me mf kv jb mg mh kz jf mi mj ld jj mk ml lh mm bi translated">之后的建筑:-</h2><p id="419b" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">con V5 _ block 3 _ 3 _ bn(BatchNormali(None，None，None，2 8192 con V5 _ block 3 _ 3 _ conv[0][0]_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ con V5 _ block 3 _ Add(Add)(None，None，None，2 0 con V5 _ block 2 _ out[0][0]con V5 _ block 3 _ 3 _ bn[0]_ _ _ _ _ _ _ _ _ _ _ _ _ _ _</p><p id="d0c6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">训练后从这个修改的模型输出的2048长度向量将被用作图像的嵌入。</p><p id="fc0c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">深度学习部分在这里完成，现在我们将转移到后端编码部分。</p><h1 id="9073" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">后端编码和API开发</h1><p id="ca4e" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">让我们首先使用我们在对象检测部分所做的检测器硬件来获得裁剪图像功能</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="5737" class="lt km hi lp b fi lu lv l lw lx">def crop_images(image):<br/>  config_file_path = "config.yaml"<br/>  model_path = "model_final.pth"<br/>  <br/>  lst_name = ['short_sleeved_shirt', 'long_sleeved_shirt', 'short_sleeved_outwear', 'long_sleeved_outwear',<br/>              'vest', 'sling', 'shorts', 'bottom_wear', 'skirt', 'short_sleeved_dress',<br/>              'long_sleeved_dress', 'vest_dress', 'sling_dress']<br/>  <br/>  bottom = ['shorts', 'bottom_wear', 'skirt']<br/>  top = ['short_sleeved_shirt', 'long_sleeved_shirt', 'short_sleeved_outwear', 'long_sleeved_outwear','vest','short_sleeved_dress',<br/>              'long_sleeved_dress', 'vest_dress']<br/><br/><br/>  cfg = get_cfg()<br/>  cfg.merge_from_file(config_file_path)<br/>  cfg.MODEL.WEIGHTS =  model_path<br/>  cfg.DATASETS.TEST = ("deepfashion_val", )<br/>  cfg.MODEL.ROI_HEADS.SCORE_THRESH_TEST = 0.55   # set the testing threshold for this model<br/>  predictor = DefaultPredictor(cfg)<br/><br/>  im = cv2.imread(image)<br/>  outputs = predictor(im)<br/> <br/><br/>  boxes = {}<br/>  for coordinates in outputs["instances"].to("cpu").pred_boxes:<br/>    coordinates_array = []<br/>    for k in coordinates:<br/>      coordinates_array.append(int(k))<br/>  <br/>    boxes[uuid.uuid4().hex[:].upper()] = coordinates_array<br/><br/>  image_batch = []<br/>  image_details = []<br/>  for k,v in boxes.items():<br/>    crop_img = im[v[1]:v[3], v[0]:v[2], :]<br/>    image_batch.append(crop_img)<br/><br/>  for i in range(0,len(boxes)):<br/>      image_details.append(lst_name[outputs['instances'][i].pred_classes.item()])<br/><br/>  botret = []<br/>  topret = []<br/>  for i in np.arange(0,len(image_batch)):<br/>    if image_details[i] in bottom:<br/>      botret.append(image_batch[i])<br/>    if image_details[i] in top:<br/>      topret.append(image_batch[i])<br/><br/>  print("Cropping Successful")<br/>  return topret,botret</span></pre><p id="b330" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">得到裁剪后的图像后，它的嵌入时间。</p><p id="8491" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看在裁剪图像和这个模型的帮助下生成嵌入数据库的代码</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="9b7e" class="lt km hi lp b fi lu lv l lw lx">for items in os.listdir('images'):<br/>    if items in rotten:<br/>        continue<br/>    else:<br/>        top,bottom = crop.crop_images('images/'+items)<br/>        <br/>        for img in top[:1]:<br/>            img = img.reshape(1,img.shape[0],img.shape[1],img.shape[2])<br/>            topwear_database[items] = embed(img).numpy()[0]<br/><br/>        for img in bottom[:1]:<br/>            img = img.reshape(1,img.shape[0],img.shape[1],img.shape[2])<br/>            bottomwear_database[items] = embed(img).numpy()[0]<br/><br/>        im = cv2.imread('images/'+items)<br/>        img = im.reshape(1,im.shape[0],im.shape[1],im.shape[2])<br/>        main_database[items] = embed(img).numpy()[0]</span></pre><p id="518f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过这个漫长的过程，数据库已经准备好了。</p><p id="2ded" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，我们只需要获取用户图像，并根据嵌入向量的距离推荐相似的图像。</p><p id="b981" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">用于获得k个相似推荐的函数:-</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="670b" class="lt km hi lp b fi lu lv l lw lx">def similar_k(image_id,k):<br/><br/>  toprecommended = []<br/>  bottomrecommended = []<br/>  output1 = topwear_database[image_id]<br/>  output2 = bottomwear_database[image_id]<br/>  <br/>  dis_dict = {}<br/>  for key in topwear_database:<br/>    dis_dict[key] = euclidean_distance(topwear_database[key],output1)<br/><br/>  sorted_dis_dict = dict(sorted(dis_dict.items(), key=lambda item: item[1]))<br/>  i = 0<br/><br/>  for key in sorted_dis_dict:<br/>    if i == k:<br/>      break<br/>    if key == image_id:<br/>      continue;<br/>    else:<br/>        toprecommended.append(key)<br/><br/>    i = i+1<br/><br/>  dis_dict = {}<br/>  for key in bottomwear_database:<br/>    dis_dict[key] = euclidean_distance(bottomwear_database[key],output2)<br/><br/>  sorted_dis_dict = dict(sorted(dis_dict.items(), key=lambda item: item[1]))<br/>  i = 0<br/><br/>  for key in sorted_dis_dict:<br/>    if i == k:<br/>      break<br/>    if key == image_id:<br/>      continue;<br/>    else:<br/>        bottomrecommended.append(key)<br/><br/>    i = i+1<br/>  <br/><br/>  return toprecommended,bottomrecommended</span></pre><p id="4c15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在fastAPI的帮助下开发的API中使用了以下所有代码功能。fastapi的代码工作非常简单，无需讨论。</p><h1 id="d2c7" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">部署:</h1><p id="4601" class="pw-post-body-paragraph iq ir hi is b it lj iv iw ix lk iz ja jb ll jd je jf lm jh ji jj ln jl jm jn hb bi translated">我必须将api部署到docker上，以便其他开发人员可以使用它来集成。</p><p id="45fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Docker是一种可以在服务器和系统之间转移的虚拟容器。</p><p id="2009" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我将我的所有需求设置到requirements.txt文件中，然后创建一个docker文件。</p><p id="0697" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">API可以直接使用和集成，但是对于数据库制作和嵌入生成我们当然需要Docker。</p><pre class="jp jq jr js fd lo lp lq lr aw ls bi"><span id="d7c7" class="lt km hi lp b fi lu lv l lw lx">FROM ubuntu:20.04<br/><br/><br/>RUN apt update &amp;&amp; apt install -y htop python3<br/>RUN apt install -y python3-pip<br/><br/>RUN pip install torch==1.5.0+cpu torchvision==0.6.0+cpu -f https://download.pytorch.org/whl/torch_stable.html<br/>RUN pip install detectron2==0.1.3+cpu -f https://dl.fbaipublicfiles.com/detectron2/wheels/cpu/index.html<br/><br/>COPY requirements.txt ./requirements.txt<br/><br/>RUN pip install -r requirements.txt<br/>COPY . .<br/><br/>RUN python3 database.py &amp;&amp; python3 test.py</span></pre><p id="bbfd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">将构建上下文发送到Docker守护进程613.5MB <br/>步骤1/9:从Ubuntu:20.04<br/>—&gt;7 E0 aa 2d 69 a 15<br/>步骤2/9:运行apt更新&amp;&amp;apt install-y htop python 3<br/>—&gt;使用缓存<br/>—&gt;75031337 f4ce<br/>步骤3/9:运行apt install -y python3-pip 【T6 缓存<br/>—&gt;CB 2 ab 85 a 33 c 0<br/>第5/9步:运行pip安装检测器2 = = 0 . 1 . 3+CPU-f<a class="ae jt" href="https://dl.fbaipublicfiles.com/detectron2/wheels/cpu/index.html" rel="noopener ugc nofollow" target="_blank">https://dl . fbaipublicfiles . com/detectron 2/wheels/CPU/index . html</a><br/>—&gt;使用缓存<br/>—&gt;1059 CFF 99453<br/>第6/9步:复制需求. txt。 /requirements.txt <br/> — - &gt;使用缓存<br/> — - &gt; 1ef1b3763905 <br/>第7/9步:运行pip install-r requirements . txt<br/>—-&gt;使用缓存<br/>—&gt;54 aafe 521 f90<br/>第8/9步:复制。。<br/>—&gt;4f 991 a 474 a 99<br/>第9/9步:运行python 3 database . py&amp;&amp;python 3 test . py<br/>—&gt;运行于391ab8cfe128</p><h1 id="5377" class="kl km hi bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">《我们准备好了》</h1><figure class="jp jq jr js fd ij er es paragraph-image"><div class="er es mn"><img src="../Images/77486788546fb8cc0048763d131205ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*OlNapGY-JxythFEMsC6BJA.jpeg"/></div></figure><p id="5d54" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">任何疑问，评论，建议，感谢将不胜感激</p><p id="f72f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的whatsapp号码:- 8292098293</p><p id="32e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">电子邮件Id:-adityaraj20008@gmail.com</p><p id="efc8" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目标检测和计算机视觉基础的博客链接:-<a class="ae jt" href="https://aditya007.medium.com/research-summary-object-detection-upto-fast-rcnn-43d5944f4f6f" rel="noopener">https://aditya 007 . medium . com/research-summary-object-detection-up-fast-rcnn-43d 5944 F4 f6f</a></p><p id="a87d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">不要忘记喜欢和分享我的内容，谢谢…</p></div></div>    
</body>
</html>