<html>
<head>
<title>Examining System Performance Based on Real-Life Load Conditions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于实际负载条件检查系统性能</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/examine-system-performance-based-on-real-life-load-conditions-8054521fefc7?source=collection_archive---------20-----------------------#2021-05-24">https://medium.com/nerd-for-tech/examine-system-performance-based-on-real-life-load-conditions-8054521fefc7?source=collection_archive---------20-----------------------#2021-05-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="8f03" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">考虑以下场景:在节日或促销期间，电子商务可能会经历访问量的增加；登记或注册更新活动，有截止日期；当博客被主流报纸引用时。这些和其他场景可能会将您的系统推向极限，甚至超过极限。识别和防止这种问题的最有效的方法之一是执行性能测试。这个术语指的是测量应用程序性能的测试。存在不同的方法来实现这个目标。本文的目的是考察基于实际负载条件确定系统稳定性的可能性。</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es jh"><img src="../Images/2fb7b7a15ea5b720cb33f8b71cd6ed65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3VIo4ReYa4Srulh96UZzA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">性能测试服务— <a class="ae jt" href="https://www.qrapp.org.uk/performance-testing" rel="noopener ugc nofollow" target="_blank"> Qrapp 技术</a></figcaption></figure><p id="ef0b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">你可能已经经历过这样一种情况，你看到一个在线销售的广告，折扣高达 80%。想象一下，你想买的产品也在促销活动中做了广告。立刻，你拿起手机，在谷歌上搜索，试图访问它，但网站无法加载。您刷新页面，认为问题出在您的连接上，但您仍然无法访问。你会不断尝试，直到你厌倦了等待，放弃购买。</p><p id="9455" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">上面的情况比你想象的更普遍。这是一个影响各种网站的性能问题的例子。识别和防止这种问题的最有效的方法之一是执行性能测试。通过这样做，可以确定哪些事务可能影响应用程序的执行，定义允许软件满足指定要求的最低架构配置，从而最大限度地降低与性能要求相关的风险。</p><p id="c14a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">本文的目的是检验基于实际负荷条件确定系统稳定性的可能性。我们将提出一个使用 k6 作为负载测试引擎的解决方案。</p><h1 id="f84b" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">性能试验</h1><p id="47da" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ju kx iw ix jv ky ja jb jw kz je jf jg hb bi translated">术语“峰值”、“耐久性”、“负载”和“压力”通常用于描述测试，这些测试试图理解软件在执行给定任务期间的表现。一般来说，所有这些术语都是指测量应用程序性能的测试，但是它们都使用不同的方法来实现这个目标。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es la"><img src="../Images/d178e39044ff85338634b5406bbfc591.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zyWKN4hA0MHlN2ifDJO83g.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">性能测试的类型—摘自<a class="ae jt" href="https://abstracta.us/blog/performance-testing/types-performance-tests/attachment/why-perf-testing-is-nec-chart-2/" rel="noopener ugc nofollow" target="_blank">摘要</a></figcaption></figure><p id="056e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">这些性能测试各有其优点。确定测试的目的以确定应用哪种类型很重要:</p><ul class=""><li id="3a7c" class="lf lg hi il b im in iq ir ju lh jv li jw lj jg lk ll lm ln bi translated"><strong class="il hj">负载测试:</strong>包括评估系统在预期工作负载下的性能。</li><li id="b842" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated"><strong class="il hj">耐久性测试:</strong>确定系统是否能够长期承受持续的预期负载。</li><li id="d51b" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated"><strong class="il hj">压力测试:</strong>评估应用程序在远高于预期工作负载的负载下的性能。</li><li id="0216" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated"><strong class="il hj">峰值测试:</strong>分析用户数量突然增加时系统的行为。</li></ul><h1 id="4e59" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">负载测试</h1><p id="55ea" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ju kx iw ix jv ky ja jb jw kz je jf jg hb bi translated">执行负载测试是为了确定系统在正常和预期峰值负载条件下的行为。它有助于确定应用程序的最大运行容量以及任何可能导致性能下降的瓶颈。当施加在系统上的负载超过正常使用模式时，测试系统在异常高或峰值负载下的响应，这就是所谓的压力测试。</p><p id="78c6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">流行的负载测试工具提供了对缓慢性能原因的洞察。系统性能缓慢有许多可能的原因，包括但不限于以下原因:</p><ul class=""><li id="29af" class="lf lg hi il b im in iq ir ju lh jv li jw lj jg lk ll lm ln bi translated">应用服务器或软件</li><li id="60c7" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">数据库服务器</li><li id="5a8b" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">网络(延迟、拥塞等)</li><li id="ee71" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">客户端处理</li><li id="ef93" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">多台服务器之间的负载平衡</li></ul><p id="833a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">成功的负载测试的先决条件是有目标。例如，<strong class="il hj"> <em class="ik">高于什么水平的响应时间是不可接受的，和/或什么是可接受的请求失败率</em> </strong>。确保您的负载测试在功能上是正确的也是一个很好的实践。</p><h1 id="8eca" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak"> K6 </strong></h1><p id="ad36" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ju kx iw ix jv ky ja jb jw kz je jf jg hb bi translated">k6 是一个开源的负载测试工具，旨在使负载测试变得简单易行。使用它，您将能够更早地发现性能退化和问题，允许您构建有弹性的系统和健壮的应用程序。主要特性包括:</p><ul class=""><li id="7c79" class="lf lg hi il b im in iq ir ju lh jv li jw lj jg lk ll lm ln bi translated">CLI 工具</li><li id="1e47" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">JavaScript 中的脚本</li><li id="36d4" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">自动负载测试的可能性</li></ul><p id="1bb7" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">k6 用户通常是开发人员、QA 和 DevOps 工程师。他们使用 k6 测试 API、微服务和网站的性能。常见的 k6 用例有:</p><ul class=""><li id="6b1f" class="lf lg hi il b im in iq ir ju lh jv li jw lj jg lk ll lm ln bi translated">负载测试:设计用于在预生产和 QA 环境中运行高负载测试。</li><li id="4adb" class="lf lg hi il b im lo iq lp ju lq jv lr jw ls jg lk ll lm ln bi translated">监控:您可以在少量负载的情况下运行测试，以持续监控您的生产环境的性能。</li></ul><p id="fe9f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">这项服务背后的公司也有一个在云中运行的商业选项。借助该 SaaS，可以从多个位置扩展测试，获得可操作的性能洞察并安排测试。</p><h1 id="c1e7" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">用例</h1><p id="4d8c" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ju kx iw ix jv ky ja jb jw kz je jf jg hb bi translated">最基本类型的负载测试用于确定 Web 在正常条件和高负载水平下的行为。随着负载测试的开始，建议从少量虚拟用户开始，然后逐渐增加负载，从正常增加到峰值。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div class="er es lt"><img src="../Images/3e988ea8b0ca453660fe7b3b7c22a697.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*RRZz6fXJAihghsE9L0I-QA.jpeg"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">负载测试工作流—从<a class="ae jt" href="http://www.linhadecodigo.com.br/artigo/3259/testes-de-performance-testes-de-carga-stress-e-virtualizacao-parte-3.aspx" rel="noopener ugc nofollow" target="_blank"> linhadecodigo </a>中检索</figcaption></figure><p id="02ee" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">我们将展示一些使用 k6 作为工具的负载测试场景。我们的测试将在本地进行。首先，你需要<a class="ae jt" href="https://k6.io/docs/getting-started/installation/" rel="noopener ugc nofollow" target="_blank">安装二进制文件</a>。这将是一个简单的 HTTP 请求测试。正如你在下面的方块中看到的，我们建造了一个<strong class="il hj"> <em class="ik">。js </em> </strong>脚本，包含我们测试所需的配置。我们可以通过 options 对象来规定测试的阶段(上升/下降模式)。性能和功能目标可以使用<a class="ae jt" href="https://k6.io/docs/using-k6/thresholds" rel="noopener ugc nofollow" target="_blank">阈值</a>和<a class="ae jt" href="https://k6.io/docs/using-k6/checks" rel="noopener ugc nofollow" target="_blank">检查</a>进行编码。另外，请注意，我们正在保存对<strong class="il hj"> <em class="ik"> res </em> </strong>的响应，稍后可以访问。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="e103" class="lz jy hi lv b fi ma mb l mc md">import http from 'k6/http';</span><span id="6d45" class="lz jy hi lv b fi me mb l mc md">import { sleep, check } from 'k6';</span><span id="9353" class="lz jy hi lv b fi me mb l mc md">import { Counter } from 'k6/metrics';<br/></span><span id="3886" class="lz jy hi lv b fi me mb l mc md">export const requests = new Counter('http_reqs');</span><span id="b5f4" class="lz jy hi lv b fi me mb l mc md">export const options = {</span><span id="49b7" class="lz jy hi lv b fi me mb l mc md">  stages: [</span><span id="7257" class="lz jy hi lv b fi me mb l mc md">    { target: 20, duration: '1m' },</span><span id="18f7" class="lz jy hi lv b fi me mb l mc md">    { target: 15, duration: '1m' },</span><span id="4fd4" class="lz jy hi lv b fi me mb l mc md">    { target: 0, duration: '1m' },</span><span id="a954" class="lz jy hi lv b fi me mb l mc md">  ],</span><span id="5b41" class="lz jy hi lv b fi me mb l mc md">  thresholds: {</span><span id="05bf" class="lz jy hi lv b fi me mb l mc md">    requests: ['count &lt; 100'],</span><span id="9843" class="lz jy hi lv b fi me mb l mc md">  },</span><span id="9408" class="lz jy hi lv b fi me mb l mc md">};</span><span id="f0c5" class="lz jy hi lv b fi me mb l mc md">export default function () {</span><span id="8dcd" class="lz jy hi lv b fi me mb l mc md">  const res = http.get('http://test.k6.io');</span><span id="c246" class="lz jy hi lv b fi me mb l mc md">  sleep(1);</span><span id="73af" class="lz jy hi lv b fi me mb l mc md">  const checkRes = check(res, {</span><span id="64f4" class="lz jy hi lv b fi me mb l mc md">    'status is 200': (r) =&gt; r.status === 200,</span><span id="2099" class="lz jy hi lv b fi me mb l mc md">    'response body': (r) =&gt; r.body.indexOf('Feel free to browse') !== -1,</span><span id="36d6" class="lz jy hi lv b fi me mb l mc md">  });</span><span id="3d04" class="lz jy hi lv b fi me mb l mc md">}</span></pre><p id="f984" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">要开始实验，只需运行以下命令:</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="1b01" class="lz jy hi lv b fi ma mb l mc md">$ k6 run single-request.js</span><span id="7b40" class="lz jy hi lv b fi me mb l mc md">          /\      |‾‾| /‾‾/   /‾‾/<br/>     /\  /  \     |  |/  /   /  /<br/>    /  \/    \    |     (   /   ‾‾\<br/>   /          \   |  |\  \ |  (‾)  |<br/>  / __________ \  |__| \__\ \_____/ .io</span><span id="93aa" class="lz jy hi lv b fi me mb l mc md">execution: local<br/> script: single-request.js<br/> output: -</span><span id="0d23" class="lz jy hi lv b fi me mb l mc md">scenarios: (100.00%) 1 scenario, 20 max VUs, 3m30s max duration (incl. graceful stop):<br/> * default: Up to 20 looping VUs for 3m0s over 3 stages (gracefulRampDown: 30s, gracefulStop: 30s)</span></pre><p id="94ed" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">最后，它会显示结果:</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="143d" class="lz jy hi lv b fi ma mb l mc md">default ✓ [======================================] 00/20 VUs  3m0s</span><span id="630b" class="lz jy hi lv b fi me mb l mc md">     ✓ status is 200<br/>     ✗ response body<br/>      ↳  0% — ✓ 0 / ✗ 1871</span><span id="3e17" class="lz jy hi lv b fi me mb l mc md">     checks.........................: 50.00% ✓ 1871 ✗ 1871<br/>     data_received..................: 21 MB  117 kB/s<br/>     data_sent......................: 142 kB 788 B/s<br/>     http_req_blocked...............: avg=1.64ms   min=2µs      med=4µs      max=192.17ms p(90)=6µs      p(95)=8µs<br/>     http_req_connecting............: avg=1.62ms   min=0s       med=0s       max=192.11ms p(90)=0s       p(95)=0s<br/>     http_req_duration..............: avg=156.27ms min=138.97ms med=152.57ms max=426.66ms p(90)=167.92ms p(95)=172.34ms<br/>       { expected_response:true }...: avg=156.27ms min=138.97ms med=152.57ms max=426.66ms p(90)=167.92ms p(95)=172.34ms<br/>     http_req_failed................: 0.00%  ✓ 0    ✗ 1871<br/>     http_req_receiving.............: avg=236.51µs min=43µs     med=116µs    max=21.17ms  p(90)=425µs    p(95)=801.5µs<br/>     http_req_sending...............: avg=21.6µs   min=8µs      med=20µs     max=158µs    p(90)=27µs     p(95)=32µs<br/>     http_req_tls_handshaking.......: avg=0s       min=0s       med=0s       max=0s       p(90)=0s       p(95)=0s<br/>     http_req_waiting...............: avg=156.01ms min=138.83ms med=152.32ms max=426.18ms p(90)=167.71ms p(95)=171.52ms<br/>     http_reqs......................: 1871   10.374419/s<br/>     iteration_duration.............: avg=1.15s    min=1.13s    med=1.15s    max=1.42s    p(90)=1.17s    p(95)=1.17s<br/>     iterations.....................: 1871   10.374419/s<br/>     vus............................: 1      min=1  max=20<br/>     vus_max........................: 20     min=20 max=20</span></pre><p id="af1a" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it ju iv iw ix jv iz ja jb jw jd je jf jg hb bi translated">正如我们所看到的，默认情况下，服务已经收集了有助于评估应用程序性能的相关信息。有了它，我们可以确定延迟、并发虚拟用户的数量以及与请求相关的数据。在其官方文档中，你可以找到更多的<a class="ae jt" href="https://k6.io/docs/examples/" rel="noopener ugc nofollow" target="_blank">教程和示例</a>。</p><h1 id="e57a" class="jx jy hi bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">结论</h1><p id="5296" class="pw-post-body-paragraph ii ij hi il b im kv io ip iq kw is it ju kx iw ix jv ky ja jb jw kz je jf jg hb bi translated">本文的目的是考察基于实际负荷条件确定系统稳定性的可能性。术语“峰值”、“耐久性”、“负载”和“压力”通常用于描述测试，这些测试试图理解软件在执行给定任务期间的表现。更具体地说，执行负载测试是为了确定系统在正常和预期峰值负载条件下的行为。我们使用开源负载测试工具 k6 提出了一个解决方案。使用它，开发人员、QA 和 DevOps 工程师可以更早地拦截性能问题，允许他们构建弹性系统和健壮的应用程序。</p></div></div>    
</body>
</html>