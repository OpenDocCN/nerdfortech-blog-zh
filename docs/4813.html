<html>
<head>
<title>Event Handling — PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">事件处理— PHP</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/event-handling-php-334dbf9916e4?source=collection_archive---------7-----------------------#2021-08-08">https://medium.com/nerd-for-tech/event-handling-php-334dbf9916e4?source=collection_archive---------7-----------------------#2021-08-08</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5b030a516f9157d70683f4779be68de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AedDTMg670311uZO138_g.jpeg"/></div></div></figure><p id="9ef4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">John被指派处理用户注册问题。他想避免这个问题，因为这与代码的复杂程度有关。他在这个项目中工作了两年，已经修复了好几次，但是每当他打开代码，就好像他第一次看到它一样。</p><p id="3fec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">约翰在挑其他问题，把注册问题拖到最后一刻。每当他的主管询问这个问题时，他都在冒汗。所以几天后，他决定重构代码，使他的工作更容易。</p><p id="163e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你曾经做过的代码<em class="jo">做了太多，以至于改变它</em>都让人害怕？或者<em class="jo">你每次打开它的时候都从头分析过吗</em>？</p><p id="b921" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这通常来自于充满子流程的<strong class="is hj">代码，这些子流程已经与<strong class="is hj">主流程合并。</strong></strong></p><h1 id="8d4e" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">主流和支流</h1><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d598878aefb8198adaaedb8cf443be84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MZaHrh_6U3_Uze5qHKtBhA.jpeg"/></div></div></figure><p id="e5fe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在注册<strong class="is hj">的情况下，主流程将创建一个用户并将其保存</strong>到数据库。<br/>另一方面，<strong class="is hj">子流程</strong> <strong class="is hj">可以是</strong> : <br/> -发送欢迎或确认电子邮件<br/> -创建关于用户注册的审计日志<br/> -将注册用户同步到外部服务</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="8b2b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们将注册(创建和保存用户)视为主流程，那么<strong class="is hj">子流程将作为主流程成功</strong>的结果而发生。</p><p id="5829" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么我们如何判断主流是成功的呢？<br/> <strong class="is hj">我们正在通过<em class="jo">事件</em>来做这件事！</strong></p><p id="504f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事件是描述过去发生的事情。在注册的情况下，<em class="jo">用户已经注册。</em> <br/> <strong class="is hj">通过订阅事件，我们能够运行任何子流。</strong></p><h1 id="a4f8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">发布和订阅事件</h1><div class="kt ku ez fb kv kw"><a href="https://docs.ecotone.tech/install-php-service-bus" rel="noopener  ugc nofollow" target="_blank"><div class="kx ab dw"><div class="ky ab kz cl cj la"><h2 class="bd hj fi z dy lb ea eb lc ed ef hh bi translated">装置</h2><div class="ld l"><h3 class="bd b fi z dy lb ea eb lc ed ef dx translated">提供商应自动注册。2.由于需要访问依赖容器，您必须在…中选择一个</h3></div><div class="le l"><p class="bd b fp z dy lb ea eb lc ed ef dx translated">docs . econtero . tech</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk io kw"/></div></div></a></div><p id="e86d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们从定义事件类开始。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><blockquote class="ll lm ln"><p id="6c0d" class="iq ir jo is b it iu iv iw ix iy iz ja lo jc jd je lp jg jh ji lq jk jl jm jn hb bi translated"><em class="hi"/><strong class="is hj"><em class="hi">事件是任何框架相关接口或抽象类</em> </strong> <em class="hi">的类清除。</em></p></blockquote><p id="7f82" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将使用来自<em class="jo">PersonRegistrationService</em>的事件总线发布PersonWasRegistered事件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><blockquote class="ll lm ln"><p id="0123" class="iq ir jo is b it iu iv iw ix iy iz ja lo jc jd je lp jg jh ji lq jk jl jm jn hb bi translated"><em class="hi">安装生态区后，事件总线自动注册到依赖容器中</em></p></blockquote><p id="39c1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在可以将所有的逻辑转移到事件处理程序中，事件处理程序订阅特定的事件。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><blockquote class="ll lm ln"><p id="840b" class="iq ir jo is b it iu iv iw ix iy iz ja lo jc jd je lp jg jh ji lq jk jl jm jn hb bi translated"><em class="hi"/><strong class="is hj"><em class="hi">事件处理程序根据第一个参数类型提示</em> </strong> <em class="hi">订阅特定事件。</em></p><p id="6b40" class="iq ir jo is b it iu iv iw ix iy iz ja lo jc jd je lp jg jh ji lq jk jl jm jn hb bi translated">我们在这里使用了一个包含三个事件处理程序的类。如果您觉得有必要，您可以自由地为每个事件处理程序创建单独的类。</p></blockquote><p id="c268" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能会注意到，我们将特定的服务直接注入到事件处理程序的方法中。</p><figure class="kn ko kp kq fd ij"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="769c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">由于econtero的方法调用机制，这是可能的。您可以将任何服务传递给给定的<em class="jo">命令/事件/查询处理程序的</em>方法，而econtero将通过<strong class="is hj">为您注入这些服务来完成这项工作。</strong></p><h1 id="0ba3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">快乐的约翰</h1><figure class="kn ko kp kq fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/fd2e77e899b82da5d524d48796e60d1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9H1dEXmIc6TNh7i22f_QQw.jpeg"/></div></div></figure><p id="5cd3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">John现在确信，分离子流将使他的代码更具可读性、可测试性和可靠性。<br/>他发现<strong class="is hj">改变给定功能的代码只会影响现在的给定流程</strong>。他可以想到更简单的测试方法，因为他可以单独测试事件处理程序。并且确信，将来当新的子流程到来时，团队维护代码会变得更加容易。</p><p id="e255" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想了解更多关于事件处理的信息，请阅读<a class="ae lr" href="https://docs.ecotone.tech/modelling/event-handling" rel="noopener ugc nofollow" target="_blank">生态交错区的文档</a>。</p></div></div>    
</body>
</html>