<html>
<head>
<title>Stream Real-Time Forex Data With NodeJS Websocket</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用NodeJS Websocket传输实时外汇数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/stream-real-time-forex-data-with-nodejs-websocket-9fb9b1c2e048?source=collection_archive---------6-----------------------#2021-03-16">https://medium.com/nerd-for-tech/stream-real-time-forex-data-with-nodejs-websocket-9fb9b1c2e048?source=collection_archive---------6-----------------------#2021-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/261f414731d7b3150cc53d138476447f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Pj2rtZCIHhho1_cMBjvMg.jpeg"/></div></div></figure><p id="4763" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您发现了这一点，我假设您对使用Websockets获取实时数据感兴趣。至少本教程应该能够帮助你在NodeJS中运行你的第一个WebSocket客户端。本教程假设几乎没有Nodejs知识，但是有编程经验，尤其是Javascript，将会有所帮助。Javascript和Nodejs不是你的茶，但是，如果你有兴趣，其他的Websocket实现如<a class="ae jo" href="https://rahul-khanna.medium.com/your-first-python-socketio-client-506b3c2e9187" rel="noopener"> Python </a>、<a class="ae jo" href="https://khanna-rahul.medium.com/your-first-c-websocket-client-5e7acc30681d" rel="noopener"> C# </a>和<a class="ae jo" href="https://rahul-khanna.medium.com/your-first-golang-websocket-fx-data-fc1eb7db35f0" rel="noopener"> Golang </a>也是可用的。</p><p id="0f3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你愿意，你也可以阅读我们的<a class="ae jo" href="https://khanna-rahul.medium.com/your-first-nodejs-rest-api-client-59467659ab99" rel="noopener"> NodeJS REST API实现</a>。</p><p id="6298" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们开始设置和代码之前，快速浏览一下我们要实现的目标会很有意思。我们将下载Nodejs并设置我们的环境，通过连接到TraderMade Websocket API(服务器端)通过Websocket接收实时外汇和CFD(指数)数据。</p><p id="b7b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了简化，有三个步骤:</p><ul class=""><li id="8901" class="jp jq hi is b it iu ix iy jb jr jf js jj jt jn ju jv jw jx bi translated">下载节点并设置环境</li><li id="4236" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">安装免费试用版并获取API密钥</li><li id="29a2" class="jp jq hi is b it jy ix jz jb ka jf kb jj kc jn ju jv jw jx bi translated">设置NodeJs Websocket客户端并接收数据</li></ul><p id="82dc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们开始吧！</p><h2 id="e63d" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">下载节点并设置环境</h2><p id="8083" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">Windows和Mac:</p><p id="ab96" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下载并安装<a class="ae jo" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank">节点j</a></p><p id="177c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Linux:</p><p id="f278" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">apt-get安装节点js</p><p id="5415" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦安装了Nodejs，打开命令提示符或终端，获取运行我们的客户机所需的依赖项(库)。我们将使用“ws ”,因此运行以下命令:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="bc5b" class="kd ke hi li b fi lm ln l lo lp">npm install ws</span></pre><h2 id="3d26" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">这就是我们设置所需的全部内容，接下来让我们获取密钥。</h2><h2 id="b9d4" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">设置试用版并获取API密钥</h2><p id="f83d" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">你可以按照关于如何开始14天免费试用的<a class="ae jo" href="https://tradermade.com/tutorials/how-to-start-a-websocket-trial-and-subscription-plan/" rel="noopener ugc nofollow" target="_blank">文章</a>来做。一旦你有了钥匙，请妥善保管。</p><h2 id="7d6d" class="kd ke hi bd kf kg kh ki kj kk kl km kn jb ko kp kq jf kr ks kt jj ku kv kw kx bi translated">设置NodeJs Websocket客户端并接收数据</h2><p id="f260" class="pw-post-body-paragraph iq ir hi is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn hb bi translated">完成环境设置后，转到Nodejs的安装目录，创建一个文件并将其命名为forexWsClient.js。现在使用Atom或VS代码打开该文件，如果没有安装，只需在windows或vi Linux上使用记事本打开即可。</p><p id="5d32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在是时候写一些代码了。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="3709" class="kd ke hi li b fi lm ln l lo lp">const WebSocket = require ('ws');</span><span id="8397" class="kd ke hi li b fi lq ln l lo lp">const ws = new WebSocket ('wss://marketdata.tradermade.com/feedadv');</span></pre><p id="50ee" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将首先导入WebSocket对象，然后使用wss URL将其连接到Tradermade。一旦建立了连接，我们将发送我们的API密匙(我们通过签署WebSocket试用版获得)以及我们希望从服务器接收的符号。在这种情况下，GBPUSD和英国100(代码为FTSE100 CFD)。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="2bd6" class="kd ke hi li b fi lm ln l lo lp">ws.on('open', function open() {<br/>     ws.send("{"userKey":"streaming_api_key", "symbol":"GBPUSD,UK100"}");<br/>  });</span><span id="7394" class="kd ke hi li b fi lq ln l lo lp">ws.on('message', function incoming(data) {<br/>    if(data != "Connected"){<br/>            data = JSON.parse(data)<br/>            console.log(data)<br/>    }<br/>  });</span></pre><p id="143f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过身份验证后，我们将开始获取JSON消息的数据。真的就这么简单。</p><p id="319e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要启动该程序，只需保存forexWsClient.js文件，并从文件所在的位置在终端中写入以下内容:</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="3b7f" class="kd ke hi li b fi lm ln l lo lp">node forexWsClient.js</span></pre><p id="7c15" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧啊。我们有实时的外汇数据流。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="b99f" class="kd ke hi li b fi lm ln l lo lp">{<br/>    symbol: 'UK100',<br/>    ts: '1615913144126',<br/>    bid: 6795,<br/>    ask: 6798,<br/>    mid: 6796.5<br/>  }<br/>  {<br/>    symbol: 'GBPUSD',<br/>    ts: '1615913144331',<br/>    bid: 1.38967,<br/>    ask: 1.38969,<br/>    mid: 1.38968<br/>  }</span></pre><p id="b312" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，还有一些事情我们想做，使它更稳定，如重新连接，如果服务器或错误下降的连接，否则我们将不知道何时连接中断。</p><p id="4b55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，为了做到这一点，我们将只做一些更改，如下面的完整代码所示。我们将ws对象和事件包装在一个名为connect的函数中，这个函数是在运行程序时启动的。我们还设置了一个连接关闭时的超时功能，以便建立连接。</p><pre class="ld le lf lg fd lh li lj lk aw ll bi"><span id="5d19" class="kd ke hi li b fi lm ln l lo lp">const WebSocket = require ('ws');</span><span id="4bda" class="kd ke hi li b fi lq ln l lo lp">var reconnectInterval = 1000 * 10<br/>var ws;<br/></span><span id="92a1" class="kd ke hi li b fi lq ln l lo lp">var connect = function(){<br/></span><span id="e860" class="kd ke hi li b fi lq ln l lo lp">  const ws = new WebSocket ('wss://marketdata.tradermade.com/feedadv');<br/></span><span id="aa81" class="kd ke hi li b fi lq ln l lo lp">  ws.on('open', function open() {<br/>     ws.send("{"userKey":"streaming_api_key", "symbol":"GBPUSD,UK100"}");<br/>  });<br/></span><span id="5367" class="kd ke hi li b fi lq ln l lo lp">  ws.on('close', function() {<br/>    console.log('socket close : will reconnect in ' + reconnectInterval );<br/>    setTimeout(connect, reconnectInterval)<br/>  });<br/></span><span id="cfc7" class="kd ke hi li b fi lq ln l lo lp">  ws.on('message', function incoming(data) {<br/>    if(data != "Connected"){<br/>            data = JSON.parse(data)<br/>            console.log(data)<br/>    }<br/>  });<br/>};<br/>connect();</span></pre><p id="8c93" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们运行上面的程序，我们的客户机不会退出，只要服务器推送数据，它就会建立一个连接。</p><p id="29e7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您需要更多信息，请访问<a class="ae jo" href="https://marketdata.tradermade.com/docs/restful-api" rel="noopener ugc nofollow" target="_blank"> TraderMade </a> docs了解更多信息，或者留言。</p></div></div>    
</body>
</html>