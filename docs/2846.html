<html>
<head>
<title>What breed is my dog?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我的狗是什么品种？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-breed-is-my-dog-91b9376586d8?source=collection_archive---------28-----------------------#2021-05-21">https://medium.com/nerd-for-tech/what-breed-is-my-dog-91b9376586d8?source=collection_archive---------28-----------------------#2021-05-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="d0eb" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">基于CNN和迁移学习的犬种自动检测</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/eef29f9a528be547728237e0e2eddd99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I37FBoCgCosnMYZu9L9Eqg.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">照片由<a class="ae jn" href="https://unsplash.com/photos/UcUROHSJfRA" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jn" href="https://unsplash.com/@momentsbygabriel" rel="noopener ugc nofollow" target="_blank">Gabriel Crismariu</a><strong class="bd jo">T3】拍摄</strong></figcaption></figure><p id="7b32" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">我一直认为我的狗是比熊犬，直到上周一些朋友质疑它的品种:虽然大多数比熊犬是白色的，但我的狗是杏色的。颜色是决定品种的关键标志吗？杏色狗就不能还是比熊犬吗？</p><p id="675b" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">幸运的是，根据狗的品种对狗进行分类对于深度学习模型来说是一项非常简单的任务。虽然这项练习即使对人类来说仍然具有挑战性(也是许多激烈辩论的焦点)，但在这个项目中，我们证明了具有迁移学习技术的卷积神经网络可以在这项任务中实现大于80%的测试准确度。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="e22c" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">首先:我们想要实现什么？问题陈述</h2><p id="4985" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">这个项目的目标是在给定一张狗图片的情况下准确预测狗的品种。预测狗的品种是一项具有挑战性的任务，对人类来说甚至更困难。涉及的主要困难如下:</p><ol class=""><li id="3f99" class="lr ls hi jr b js jt jv jw jy lt kc lu kg lv kk lw lx ly lz bi translated"><strong class="jr hj">最小的类间差异(不同犬种之间的相似性):</strong>例如，在颜色和大小方面。例如，考虑一只布列塔尼和一只威尔士矮脚猎犬:</li></ol><div class="iy iz ja jb fd ab cb"><figure class="ma jc mb mc md me mf paragraph-image"><img src="../Images/df81b4e411ee036a2441df4badfbe773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*jjQz55i5I6bFzqg2a9zpKQ.jpeg"/></figure><figure class="ma jc mg mc md me mf paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><img src="../Images/c8f81b3229a2b7f9749e0753b4cb2a81.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*pw-lbAgJd85vcmK7CgY16g.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx mh di mi mj translated">类间变异:布列塔尼犬种(左)vs威尔士史宾格猎犬(右)</figcaption></figure></div><p id="8899" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj"> 2)类内变异:</strong>例如，考虑不同颜色或大小(黄色、巧克力色、黑色……)的不同种类拉布拉多犬。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mk"><img src="../Images/c59f05d2242c8f5d22f2bb4c0dd1dae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vih8w_GCzEamZmCt-dUJhw.jpeg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">类内变异:拉布拉多犬种</figcaption></figure></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="07d7" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">我们将如何解决这个问题？分析方法</h2><p id="819a" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">给定一张狗或人的图片，我们首先想要识别该图片对应的是狗还是人。接下来，如果是狗，我们要准确预测它的品种。另一方面，如果它是一个人，我们会有一些乐趣，并向用户展示其类似的狗品种！</p><p id="231f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">如果我们的算法既不能检测到图片上的狗，也不能检测到图片上的人，那么我们会抛出一个错误消息。</p><p id="af0a" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">为了解决所定义的问题，我们采取以下步骤:</p><ol class=""><li id="ef88" class="lr ls hi jr b js jt jv jw jy lt kc lu kg lv kk lw lx ly lz bi translated">数据探索:加载数据集和了解定型数据集</li><li id="b1dd" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk lw lx ly lz bi translated">利用哈尔级联建立人脸检测器</li><li id="c1ba" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk lw lx ly lz bi translated">使用预训练的ResNet50模型构建狗检测器</li><li id="c0b2" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk lw lx ly lz bi translated">了解从头开始创建的CNN模型的局限性</li><li id="cab7" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk lw lx ly lz bi translated">使用迁移学习和微调预训练的ResNet50模型来预测对狗来说最准确的狗品种和对人类来说最相似的狗品种</li><li id="616d" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk lw lx ly lz bi translated">构建算法以根据输入图像的内容返回不同的预测</li></ol></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="a5d0" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">韵律学</h2><p id="41f7" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">为了评估分类模型的性能，我们将使用准确性度量，即正确预测在检查的案例总数中所占的比例。虽然在评估不平衡数据集中的性能时，准确性通常不是一个公平的指标，但在我们的情况下，随机机会呈现出一个非常低的标准:随机猜测将提供大约1/133的正确答案，这相当于不到1%的准确性。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="2309" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">数据探索和预处理:我们使用什么数据？</h2><p id="e7cb" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">为了对犬种进行分类，我们使用了来自<a class="ae jn" href="https://www.udacity.com/course/data-scientist-nanodegree--nd025?gclid=CjwKCAjwtJ2FBhAuEiwAIKu19nWOnIOcSVjRjKOGvBpY_x54xB4-CSNLbzG_yR6HyLcWvmbi_7F4IxoC2AYQAvD_BwE&amp;utm_campaign=12906460312_c&amp;utm_keyword=data%20scientist%20udacity_e&amp;utm_medium=ads_r&amp;utm_source=gsem_brand&amp;utm_term=121838873459" rel="noopener ugc nofollow" target="_blank"> Udacity </a>的犬种数据集。在这个数据集中，我们有133个不同的狗品种(包括比熊犬弗里斯！)和总共8351张狗图像，由一组6680张训练图像、835张验证图像和836张测试狗照片组成:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mq"><img src="../Images/e56f2ff1350f2de27f55c5cfc4f27b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ci8TBhQkTB4CrnRlfMSWDg.png"/></div></div></figure><p id="9f5f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在将数据输入任何模型之前，我们需要对其进行预处理。当使用TensorFlow作为后端时，Keras CNNs需要一个4D张量作为输入，因此，我们使用函数<em class="mr"> path_to_tensor </em>将数据整形为4D张量。我们还将图像调整为正方形图像，以便CNN模型可以使用(224像素x 224像素)。因为我们处理的是彩色图像，每张图片都有三个颜色通道，所以给定图像的最终张量的形状是:(1，224，224，3)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ms"><img src="../Images/d856258abda62ee74c651d7ddb7a7ca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfre5RkT1YujEGfljeoBtg.png"/></div></div></figure></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="a8a8" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">为什么选择CNN和迁移学习？建模方法</h2><p id="4d21" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">卷积神经网络是广泛用于图像分类的强大的深度学习神经网络。与MLPs等其他建模技术相比，<strong class="jr hj">CNN能够提取多维数据中的复杂模式，并通过在训练过程中应用过滤器来学习空间不变特征</strong>。</p><p id="b696" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在尝试更先进的方法之前，为了预测狗的品种，我们首先使用卷积和最大池层从头开始构建一个小的CNN，然后是一个平坦层、一个下降层和几个密集层:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mt"><img src="../Images/2a54d2f5e2b2e134914b4d68413f0965.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZverktX3DzGnrxglBWOEg.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">一个白手起家的小CNN</figcaption></figure><p id="cf5f" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">在这个网络中，我们使用8层(卷积和最大池)，在后续步骤中增加过滤器大小，以允许模型捕捉更复杂的特征模式(我们从32个过滤器开始，然后增加到128个)。通过卷积和最大池化图层提取空间要素后，我们展平输出并应用丢弃以防止过度拟合(我们将其设置为0.5，因此我们随机丢弃一半的图层)。展平后的输出被送入密集层，以捕捉非线性并提高模型的准确性。最后，最后一层的输出大小为133，因为这是要学习的不同犬种的数量。</p><p id="271d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">虽然这个小网络不够深，而且只是在这个项目可用的小训练数据集(6680张图像)上进行训练，因此，它达到较低的测试精度(大约13%)并不奇怪。</p><p id="6215" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">为了提高品种分类模型的性能，我们利用迁移学习:<strong class="jr hj">迁移学习的关键思想是导入瓶颈特征</strong>(在我们的例子中，首先从预训练的VGG16模型，然后是ResNet50模型)<strong class="jr hj">，冻结这些层的权重，只训练最后一个密集层，以根据给定的分类任务对模型进行微调</strong>。按照这些步骤，模型在测试数据集中的准确性提高到13%到80%以上(ResNet50模型)。</p><p id="050e" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated"><strong class="jr hj">模型评估、验证&amp;论证</strong></p><p id="39d3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">为了理解不同模型的表现，我们来看看20个时期的精确度和损失。正如我们在下面看到的，<strong class="jr hj">CNN从头开始训练过拟合数据:</strong>虽然在训练数据集上精度有所提高，但在验证集上保持平稳。此外，在第5个时期之后，验证损失增加，而训练损失减少:这表明该模型不能很好地概括，因此，对于这项任务来说不够稳健。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mu"><img src="../Images/2817efcab7df262368cbb68e1aa62e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EKdys5n4q-mKw7t1Lpt8mA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">模型评测:从头构建的CNN，VGG16，ResNet50</figcaption></figure><p id="d050" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">另一方面，VGG16和ResNet50模型在利用迁移学习时，提高了模型的泛化能力:提高了每个时期的验证集的准确性，并在测试数据集上实现了更好的测试准确性(VGG16模型&gt; 40%，ResNet50架构&gt; 80%)。</p><p id="910d" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">由于ResNet50模型在测试数据集上实现了最佳的准确性，因此在本练习中，我们选择此方法来构建犬种分类算法。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="cc19" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">那又怎样？那我的狗是比熊犬吗？</h2><p id="05cc" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">当然是啦！<strong class="jr hj">但是网络是怎么知道的？是因为颜色吗？眼睛？尺寸？</strong></p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mv"><img src="../Images/be1cbe6263be4d30199eca16869bb8c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lulV4dV4qDLVKOTZihIphQ.png"/></div></div></figure><p id="46d3" class="pw-post-body-paragraph jp jq hi jr b js jt ij ju jv jw im jx jy jz ka kb kc kd ke kf kg kh ki kj kk hb bi translated">现实是<strong class="jr hj">CNN模型无法解释为什么它预测了一个给定的品种，或者告诉我们任何关于影响给定预测的关键特征的事情</strong>。因此，虽然我们已经确认了这个品种，<strong class="jr hj">我们还没有能够了解到任何关于我们在评估一个狗品种时应该考虑的具体特征</strong>:换句话说，我仍然没有一个逻辑论点来解释为什么我的狗是比熊犬，而不是<em class="mr">“训练数据集中相似的狗被标记为比熊犬”</em>。</p></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="f76d" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">结论和警告</h2><ul class=""><li id="645d" class="lr ls hi jr b js lm jv ln jy mw kc mx kg my kk mz lx ly lz bi translated"><strong class="jr hj">深度神经网络</strong>的<strong class="jr hj"> </strong>值是<strong class="jr hj">高效匹配和识别多维数据</strong>中的模式，而不是解释<strong class="jr hj">为什么</strong>一个给定的实例对应一个给定的分类。</li><li id="c340" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk mz lx ly lz bi translated"><strong class="jr hj">迁移学习是强大的:</strong>深度网络是数据饥渴的，当训练数据集不够大时，迁移学习可以显著提高网络的性能。在这个项目中，我们成功地利用了迁移学习，因为我们的数据集与用于预训练ResNet50模型的训练集有很大的重叠。在其他情况下，<strong class="jr hj">可能很难找到合适的预培训组合</strong>。</li><li id="6956" class="lr ls hi jr b js ml jv mm jy mn kc mo kg mp kk mz lx ly lz bi translated"><strong class="jr hj">我该如何向他人解释为什么我的狗是比熊犬，有哪些具体和独特的特征来证实这一事实？</strong>在未来的文章中，我将探索<strong class="jr hj">可解释的白盒方法</strong>，这些方法可以清楚地回答不同的特征和信号如何影响给定的预测。</li></ul></div><div class="ab cl kl km gp kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="hb hc hd he hf"><h2 id="756d" class="ks kt hi bd jo ku kv kw kx ky kz la lb jy lc ld le kc lf lg lh kg li lj lk ll bi translated">什么要多学甚至自己去尝试？</h2><p id="e76f" class="pw-post-body-paragraph jp jq hi jr b js lm ij ju jv ln im jx jy lo ka kb kc lp ke kf kg lq ki kj kk hb bi translated">查看这个Github库。</p></div></div>    
</body>
</html>