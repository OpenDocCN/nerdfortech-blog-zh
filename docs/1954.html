<html>
<head>
<title>Custom Lookups in Django</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 中的自定义查找</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/custom-lookups-in-django-69fd13e35bdb?source=collection_archive---------5-----------------------#2021-04-14">https://medium.com/nerd-for-tech/custom-lookups-in-django-69fd13e35bdb?source=collection_archive---------5-----------------------#2021-04-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8984" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们检查自定义查找之前，让我们先看看基础知识，了解什么是查找</p><h2 id="a8b6" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">那么什么是查找呢…</h2><p id="146e" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">根据 Django 文件</p><blockquote class="kd ke kf"><p id="9715" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">字段查找是指定 SQL <code class="du kk kl km kn b"><strong class="ih hj">WHERE</strong></code>子句内容的方式。它们被指定为<code class="du kk kl km kn b"><strong class="ih hj">QuerySet</strong></code>方法<code class="du kk kl km kn b"><a class="ae ko" href="https://docs.djangoproject.com/en/3.1/ref/models/querysets/#django.db.models.query.QuerySet.filter" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">filter()</strong></a></code>、<code class="du kk kl km kn b"><a class="ae ko" href="https://docs.djangoproject.com/en/3.1/ref/models/querysets/#django.db.models.query.QuerySet.exclude" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">exclude()</strong></a></code>和<code class="du kk kl km kn b"><a class="ae ko" href="https://docs.djangoproject.com/en/3.1/ref/models/querysets/#django.db.models.query.QuerySet.get" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">get()</strong></a></code>的关键字参数。</p></blockquote><p id="a482" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不是很清楚，但一个例子会使它变得容易得多</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="9652" class="jd je hi kn b fi kx ky l kz la">Entry.objects.filter(id__in=[1, 3, 4])</span></pre><p id="bd15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，‘中的<strong class="ih hj">’就是所谓的查找，上面的查询所做的是过滤所有的<strong class="ih hj">条目</strong>数据，其中它们的<strong class="ih hj">id</strong>属于列表<strong class="ih hj">【1，3，4】</strong>中的任意<strong class="ih hj"> </strong>值</strong></p><p id="68fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我希望您对如何以及在哪里使用查找有所了解</p><p id="e09b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Django 有许多内置的查找，如果没有指定，那么默认为 exact:</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="91a8" class="jd je hi kn b fi kx ky l kz la">Entry.objects.get(id=14)</span></pre><p id="0bef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与相同</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="bb43" class="jd je hi kn b fi kx ky l kz la">Entry.objects.get(id__exact=14)</span></pre><p id="119f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">内置查找的几个例子是[<code class="du kk kl km kn b">in</code>、<code class="du kk kl km kn b">iexact,</code>、<code class="du kk kl km kn b">contains</code>、<code class="du kk kl km kn b">gt</code>、<code class="du kk kl km kn b">gte</code>、T10、<code class="du kk kl km kn b">startswith</code>…。]</p><p id="211d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以查看其余内容的链接:<a class="ae ko" href="https://docs.djangoproject.com/en/3.1/ref/models/querysets/#field-lookups" rel="noopener ugc nofollow" target="_blank">https://docs . django project . com/en/3.1/ref/models/query sets/# field-lookups</a></p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lb"><img src="../Images/00683adc584b5c7bdfe9d6f068571b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dDUNiGmvAfXKhUVvuFUtkw.png"/></div></div></figure><h1 id="577f" class="lj je hi bd jf lk ll lm jj ln lo lp jn lq lr ls jq lt lu lv jt lw lx ly jw lz bi translated">让我们跳到并解决🐘在……里🏠— — — —习俗👀👆🏻</h1><p id="4db8" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">哈哈抱歉，我被表情符号冲昏了头脑，</p><h1 id="16e0" class="lj je hi bd jf lk ll lm jj ln lo lp jn lq lr ls jq lt lu lv jt lw lx ly jw lz bi translated">那么我们需要定制查找是为了什么呢？</h1><p id="cee5" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">为什么，答案很简单，因为根据你的复杂需求，可能没有可以获取数据的查找</p><p id="5861" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们来看一个来自 Djangodocs 的非常简单的例子，它会给你足够的信息来开始定制查找</p><p id="357d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将编写一个与<code class="du kk kl km kn b"><strong class="ih hj">exact</strong></code>相反的自定义查找<code class="du kk kl km kn b"><strong class="ih hj">ne</strong></code>。<code class="du kk kl km kn b"><strong class="ih hj">Author.objects.filter(name__ne='Jack')</strong></code>会翻译成 SQL:</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="5c1f" class="jd je hi kn b fi kx ky l kz la">"author"."name" &lt;&gt; 'Jack'</span></pre><p id="dd0e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个 SQL 是后端独立的，所以我们不需要担心不同的数据库。</p><p id="1a17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要做到这一点，有两个步骤。首先我们需要实现查找，然后我们需要告诉 Django:</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="d4a0" class="jd je hi kn b fi kx ky l kz la"><strong class="kn hj">from</strong> <strong class="kn hj">django.db.models</strong> <strong class="kn hj">import</strong> Lookup</span><span id="f60a" class="jd je hi kn b fi ma ky l kz la"><strong class="kn hj">class</strong> <strong class="kn hj">NotEqual</strong>(Lookup):<br/>    lookup_name = 'ne'</span><span id="3d36" class="jd je hi kn b fi ma ky l kz la">    <strong class="kn hj">def</strong> as_sql(self, compiler, connection):<br/>        lhs, lhs_params = self.process_lhs(compiler, connection)<br/>        rhs, rhs_params = self.process_rhs(compiler, connection)<br/>        params = lhs_params + rhs_params<br/>        <strong class="kn hj">return</strong> '<strong class="kn hj">%s</strong> &lt;&gt; <strong class="kn hj">%s</strong>' % (lhs, rhs), params</span></pre><p id="3e92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了注册<code class="du kk kl km kn b"><strong class="ih hj">NotEqual</strong></code>查询，我们需要在我们希望查询可用的字段类上调用<code class="du kk kl km kn b"><strong class="ih hj">register_lookup</strong></code>。在这种情况下，查找对所有的<code class="du kk kl km kn b"><strong class="ih hj">Field</strong></code>子类都有意义，所以我们直接用<code class="du kk kl km kn b"><strong class="ih hj">Field</strong></code>注册它:</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="5e6c" class="jd je hi kn b fi kx ky l kz la"><strong class="kn hj">from</strong> <strong class="kn hj">django.db.models</strong> <strong class="kn hj">import</strong> Field<br/>Field.register_lookup(NotEqual)</span></pre><p id="3d67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查找注册也可以使用装饰模式来完成:</p><pre class="kp kq kr ks fd kt kn ku kv aw kw bi"><span id="25a9" class="jd je hi kn b fi kx ky l kz la"><strong class="kn hj">from</strong> <strong class="kn hj">django.db.models</strong> <strong class="kn hj">import</strong> Field</span><span id="bbaf" class="jd je hi kn b fi ma ky l kz la">@Field.register_lookup<br/><strong class="kn hj">class</strong> <strong class="kn hj">NotEqualLookup</strong>(Lookup):</span></pre><p id="10d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">查看更多信息:<a class="ae ko" href="https://docs.djangoproject.com/en/3.1/howto/custom-lookups/" rel="noopener ugc nofollow" target="_blank">https://docs.djangoproject.com/en/3.1/howto/custom-lookups/</a></p><p id="91f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所有人都到此为止了，如果你一直读到这里，那么…..</p><figure class="kp kq kr ks fd lc er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es mb"><img src="../Images/dcf21bddde5fc157c9aac93e9c15ed20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Jf6hf9EonuGzdIN5JeZObQ.gif"/></div></div></figure></div></div>    
</body>
</html>