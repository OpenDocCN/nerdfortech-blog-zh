<html>
<head>
<title>Classifying Cats and Dogs: Deep Learning Hello World</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">给猫和狗分类:深度学习 Hello World</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/classifying-cats-and-dogs-deep-learning-hello-world-b8d7b8c027e5?source=collection_archive---------24-----------------------#2021-05-28">https://medium.com/nerd-for-tech/classifying-cats-and-dogs-deep-learning-hello-world-b8d7b8c027e5?source=collection_archive---------24-----------------------#2021-05-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/712f1e18c96ba3bf1509b68c959dcd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYc25SL22Cn1ouXaRXXirA.jpeg"/></div></div></figure><p id="d2d4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这个简短的教程中，我们将研究如何实现一个简单的深度学习分类算法来对猫和狗进行分类，然后导出模型，该模型可以部署在服务器上，以便在移动应用程序或 web 应用程序中使用。将使用的数据集是一个开源数据集，包含猫和狗的训练和验证图片。</p><h1 id="87b2" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">概述</h1><ul class=""><li id="fc2e" class="km kn hi is b it ko ix kp jb kq jf kr jj ks jn kt ku kv kw bi translated">检查猫/狗数据集</li><li id="4769" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">导入模块</li><li id="b376" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">定义培训/验证路径</li><li id="b61e" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">定义训练和验证图像生成器</li><li id="15ab" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">创建模型</li><li id="3d6d" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">编译模型</li><li id="40f8" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">将数据拟合到模型</li><li id="c226" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">将损失与准确性相对比</li><li id="b478" class="km kn hi is b it kx ix ky jb kz jf la jj lb jn kt ku kv kw bi translated">导出模型</li></ul><h2 id="7174" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">检查数据集</h2><p id="d94b" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">如前所述，本项目中使用的数据集是 Kaggle 提供的开源数据集。目录的结构将帮助我们理解如何加载数据:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="2bfa" class="lc jp hi ly b fi mc md l me mf">— cats_and_dogs_filtered -&gt; train/validation<br/>— train -&gt; cats/dogs (1000 images for each class)<br/>— validation -&gt; cats/dogs (500 images for each class)</span></pre><p id="381b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，从目录结构来看，总共有 3000 张图像，模型将在这些图像上进行训练。</p><h2 id="53c2" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">导入模块</h2><p id="555c" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">接下来，我们导入将在本项目中使用的所有模块:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="9f3d" class="lc jp hi ly b fi mc md l me mf">import tensorflow as tf<br/>import numpy as np<br/>from tensorflow.keras.layers import Dense, Conv2D, MaxPooling2D, Flatten<br/>from tensorflow.keras.preprocessing.image import ImageDataGenerator<br/>from tensorflow.keras.preprocessing import image<br/>from tensorflow import keras<br/>import os</span><span id="84e5" class="lc jp hi ly b fi mg md l me mf">import time<br/>import matplotlib.pyplot as plt<br/>import pickle<br/>import requests<br/>import cv2</span></pre><h2 id="58c5" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">定义培训/验证路径</h2><p id="770a" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">下一步是创建指向要使用的图像位置的目录路径:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="8b40" class="lc jp hi ly b fi mc md l me mf"># specify dogs and cats train directory<br/>train_dogs_dir = 'cats_and_dogs_filtered/train/dogs'<br/>train_cats_dir = 'cats_and_dogs_filtered/train/cats'</span><span id="d0a6" class="lc jp hi ly b fi mg md l me mf"># specify validation directory<br/>val_dogs_dir = 'cats_and_dogs_filtered/validation/dogs'<br/>val_cats_dir = 'cats_and_dogs_filtered/validation/cats'</span></pre><h2 id="7ffe" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">定义训练和验证图像生成器</h2><p id="ae9c" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">接下来，我们为训练数据集和验证数据集创建图像数据生成器，这将加快图像的导入速度，并执行一些预处理，如在导入图像之前，将图像像素值重新缩放到 0 和 1 之间，并将图像大小调整为 300x300:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="e437" class="lc jp hi ly b fi mc md l me mf"># define validator generator and training generator<br/>validator_datagen = ImageDataGenerator(rescale=1./255, shear_range=0.2, zoom_range=0.2, horizontal_flip=True)</span><span id="98a0" class="lc jp hi ly b fi mg md l me mf">training_datagen = ImageDataGenerator(rescale=1./255, shear_range=0.2, zoom_range=0.2, horizontal_flip=True)</span><span id="1cc1" class="lc jp hi ly b fi mg md l me mf"># training generator<br/>training_datagen = training_datagen2.flow_from_directory(<br/>    'cats_and_dogs_filtered/train',<br/>    batch_size=128,<br/>    target_size=(300, 300),<br/>    class_mode='binary'<br/>)</span><span id="75d9" class="lc jp hi ly b fi mg md l me mf"># validation generator<br/>validator_datagen = validator_datagen.flow_from_directory(<br/>    'cats_and_dogs_filtered/validation',<br/>    batch_size=32,<br/>    target_size=(300, 300),<br/>    class_mode='binary'<br/>)</span></pre><h2 id="93a6" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">创建模型</h2><p id="1235" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">我们现在继续创建我们的顺序模型，它将基本上包含隐藏层和输出层。这个神经网络将包含 13 层，12 个隐藏层。卷积和最大池将添加到模型中，以改进特征提取并提高模型性能:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ce4e" class="lc jp hi ly b fi mc md l me mf"># first convolution with max pooling<br/>model3.add(Conv2D(16, (3, 3), activation='relu', input_shape=(300, 300, 3)))<br/>model3.add(MaxPooling2D(2, 2))</span><span id="f119" class="lc jp hi ly b fi mg md l me mf"># second convolution with max pooling<br/>model3.add(Conv2D(32, (3, 3), activation='relu'))<br/>model3.add(MaxPooling2D(2, 2))</span><span id="3fbb" class="lc jp hi ly b fi mg md l me mf"># third convolution with max pooling<br/>model3.add(Conv2D(64, (3, 3), activation='relu'))<br/>model3.add(MaxPooling2D(2, 2))</span><span id="cc8a" class="lc jp hi ly b fi mg md l me mf"># fourth convolution with max pooling<br/>model3.add(Conv2D(64, (3, 3), activation='relu'))<br/>model3.add(MaxPooling2D(2, 2))</span><span id="bd9a" class="lc jp hi ly b fi mg md l me mf"># fifth convolution with max pooling<br/>model3.add(Conv2D(64, (3, 3), activation='relu'))<br/>model3.add(MaxPooling2D(2, 2))</span><span id="43cf" class="lc jp hi ly b fi mg md l me mf"># flatten layer<br/>model3.add(Flatten())</span><span id="de71" class="lc jp hi ly b fi mg md l me mf"># dense layers<br/>model3.add(Dense(512, activation='relu'))<br/>model3.add(Dense(1, activation='sigmoid'))</span></pre><h2 id="d57c" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">编译模型</h2><p id="96f0" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">创建模型后，下一步是编译它，添加一些参数来提高它的性能。将使用 Adam 优化器，因为它已被证明在分类问题上具有更好的性能:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="ed69" class="lc jp hi ly b fi mc md l me mf"># compile second model with adam optimizer<br/>model3.compile(<br/>    optimizer=tf.keras.optimizers.Adam(learning_rate=learning_rate),<br/>    loss='binary_crossentropy',<br/>    metrics=['accuracy']<br/>)</span></pre><h2 id="b358" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">将数据拟合到模型</h2><p id="e58f" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">作为构建模型的最后一步，我们将使训练和验证生成器适合模型，指定时期、每个时期的步骤和验证步骤:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="6c96" class="lc jp hi ly b fi mc md l me mf">history = model3.fit(<br/>    train_gen,<br/>    steps_per_epoch=8,<br/>    epochs=70,<br/>    validation_data=validation_gen,<br/>    validation_steps=8<br/>)</span></pre><p id="2742" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">运行这行代码后，模型将开始训练过程。训练时间约为 5 小时，模型准确率为 92.19%，验证准确率为 77.90%</p><h2 id="1ce9" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">将损失与准确性相对比</h2><p id="2575" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">训练模型后，我们将从其历史中提取损失和相应的准确性，然后通过绘制损失与准确性的关系图，直观显示模型的表现:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="cf5a" class="lc jp hi ly b fi mc md l me mf"># plot loss againts accuracy<br/>loss = history.history.get('loss')<br/>acc = history.history.get('accuracy')</span><span id="e56d" class="lc jp hi ly b fi mg md l me mf">plt.plot(loss, acc)<br/>plt.xlabel('Accuracy')<br/>plt.ylabel('Loss')<br/>plt.title('Loss Against Accuracy')<br/>plt.show()</span></pre><p id="cfcd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">得到的图形是:</p><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/8add9bd545b400a6b91a0fd3f9181caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEupmxH0FAeQHpmZOWjE4w.png"/></div></div></figure><h2 id="14e7" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">导出模型</h2><p id="c372" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">成功训练模型并获得良好的精度性能后，接下来是提取模型，然后可以将模型部署在服务器上，以便在 web 应用程序或移动应用程序中使用:</p><pre class="lt lu lv lw fd lx ly lz ma aw mb bi"><span id="a0a6" class="lc jp hi ly b fi mc md l me mf"># save model using h5 format<br/>model3.save('cat_dog_model.h5')</span><span id="95b2" class="lc jp hi ly b fi mg md l me mf"># load model from disk when needed<br/>model_loaded = keras.models.load_model("cat_dog_model.h5")</span></pre><h2 id="a4c5" class="lc jp hi bd jq ld le lf ju lg lh li jy jb lj lk kc jf ll lm kg jj ln lo kk lp bi translated">结论</h2><p id="f1df" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb lq jd je jf lr jh ji jj ls jl jm jn hb bi translated">深度学习为我们呈现了无数的可能性，应用的领域也是无限的。从本教程中，您可以对代码进行微调，以满足他或她的需求，适应任何用例。万事如意！</p></div></div>    
</body>
</html>