<html>
<head>
<title>ML based Color Detection with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Python 实现基于 ML 的颜色检测</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/ml-based-color-detection-with-python-3f067baa9e36?source=collection_archive---------5-----------------------#2021-06-17">https://medium.com/nerd-for-tech/ml-based-color-detection-with-python-3f067baa9e36?source=collection_archive---------5-----------------------#2021-06-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/2f0916aa48d07fd5b972718205e19eb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SwG7wQfOcOu17AO3APBpGw.jpeg"/></div></div></figure><div class=""/><p id="aaad" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将学习基于 ML 的颜色检测和一个基本的应用程序，它将帮助我们检测图像中的颜色。我们的应用程序的工作流程如下:</p><p id="4579" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">选择图像文件的路径&gt;打开一个窗口选择部分&gt;返回名称和 RGB 颜色代码</p><p id="bd92" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">网页开发者和设计者都知道 RGB 值的重要性。因此，这将是一个简单但非常有用的计算机视觉和颜色识别的实现。现在，让我们开始吧…</p><p id="a925" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">对于我们的项目，我们将使用 OpenCV 和 Pandas 库。</p><h1 id="6308" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">OpenCV</h1><p id="3839" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated"><strong class="is hu"><em class="kr">OpenCV</em></strong><em class="kr">(开源计算机视觉库)是一个主要针对实时计算机视觉的编程函数库。最初由英特尔开发，后来由 Willow Garage 然后是 Itseez(后来被英特尔收购)提供支持。该库是跨平台的，在开源 Apache 2 许可下可以免费使用。从 2011 年开始，OpenCV 为实时操作提供了 GPU 加速。</em></p><p id="0b19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">简单来说，OpenCV 是一个帮助我们处理图像和视频的项目。许多流行的软件公司在他们的应用程序中使用它。希望有一个针对 python 的标准 OpenCV 库。你可以很容易地安装它与 pip 安装程序。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="2d2f" class="lb jp ht kx b fi lc ld l le lf">pip install opencv-python</span></pre><p id="0caf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它将安装最新版本的 Opencv 库。如果您的电脑中尚未安装 pip，请访问此链接<a class="ae lg" href="https://www.geeksforgeeks.org/how-to-install-pip-on-windows/" rel="noopener ugc nofollow" target="_blank">https://www . geeks forgeeks . org/how-to-install-pip-on-windows/</a></p><h1 id="a36c" class="jo jp ht bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">熊猫</h1><p id="81a2" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">"<strong class="is hu"> <em class="kr"> pandas </em> </strong> <em class="kr">是一款快速、强大、灵活且易于使用的开源数据分析和操纵工具，<br/>构建在 Python 编程语言之上。</em></p><p id="6179" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Panda 是一个用于数据分析的开源库。这是一个在专家和专业开发人员中非常受欢迎的工具。我们要用它来分析数据集。您可以在 pip 安装程序的帮助下安装它</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6a91" class="lb jp ht kx b fi lc ld l le lf">pip install pandas</span></pre><p id="eddc" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的应用程序中实现 OpenCV 库之前，最好先了解一下它的基础知识。因此，我们将使用 OpenCV 构建一个相机应用程序。首先，我们将 cv2 导入到库中，然后我们将使用它的 VideoCapture()函数来捕获视频。然后我们将使用 while 循环读取每一帧，并在默认的 OpenCV 窗口中显示它。用户必须按 Esc 键结束程序。让我们一起写。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6d47" class="lb jp ht kx b fi lc ld l le lf">#importing OpenCV<br/>import cv2 as opencv</span><span id="5314" class="lb jp ht kx b fi lh ld l le lf">#capturing video<br/>capture = opencv.VideoCapture(0)</span><span id="4eb7" class="lb jp ht kx b fi lh ld l le lf">while(1):</span><span id="025b" class="lb jp ht kx b fi lh ld l le lf">#reading every frame of video<br/>r, f = capture.read()</span><span id="3642" class="lb jp ht kx b fi lh ld l le lf">#showing each frame in a OpenCV Window<br/>opencv.imshow('frame',f)</span><span id="ce3f" class="lb jp ht kx b fi lh ld l le lf">#defining exit key as Esc as it's code is 27<br/>if opencv.waitKey(1) &amp; 0xFF== 27:</span><span id="c4d1" class="lb jp ht kx b fi lh ld l le lf">break</span><span id="ca4b" class="lb jp ht kx b fi lh ld l le lf">capture.release()</span><span id="bc8a" class="lb jp ht kx b fi lh ld l le lf">#destroying OpenCV windows<br/>opencv.destroyAllWindows()</span></pre><p id="5677" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我认为代码通过注释就能很好地自我解释。让我们跳到实际的程序</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="5b7e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们需要一个数据集来识别颜色名称和十六进制代码。出于演示目的，我们将使用一个包含 1000 个示例的 csv 文件。你可以从<a class="ae lg" href="https://github.com/satadeep3927/color-recognization/blob/master/dataset.csv" rel="noopener ugc nofollow" target="_blank">这里</a>下载。</p><ol class=""><li id="dcfa" class="lp lq ht is b it iu ix iy jb lr jf ls jj lt jn lu lv lw lx bi translated">导入所需的库，如 NumPy、Pandas 和 OpenCV。</li></ol><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="db4d" class="lb jp ht kx b fi lc ld l le lf">import numpy</span><span id="5e6e" class="lb jp ht kx b fi lh ld l le lf">import pandas</span><span id="64a5" class="lb jp ht kx b fi lh ld l le lf">import cv2 as opencv</span></pre><p id="7793" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.获取图像文件位置的用户输入，并使用 OpenCV imread()函数读取它。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="0d83" class="lb jp ht kx b fi lc ld l le lf">image = opencv.imread(input("Input a File location: "))</span></pre><p id="585d" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.我们将非结构化数据集作为 csv 文件。让我们用熊猫 read_csv()函数让它更具可读性。为了使用它，我们必须定义一个带有列名的列表。然后我们将这个列表作为 read_csv()函数的一个参数传递。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c9e8" class="lb jp ht kx b fi lc ld l le lf">#defining column names<br/>index = ["color","color_name","hex","R","G","B"]</span><span id="dce8" class="lb jp ht kx b fi lh ld l le lf">#reading dataset file and structuring it<br/>dataset = pandas.read_csv("dataset.csv", names=index, header=None)</span></pre><p id="7ff6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">4.现在我们要为函数准备一些全局变量。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="f560" class="lb jp ht kx b fi lc ld l le lf">clickstate = False</span><span id="ce81" class="lb jp ht kx b fi lh ld l le lf">r=0</span><span id="9d9a" class="lb jp ht kx b fi lh ld l le lf">g=0</span><span id="c09a" class="lb jp ht kx b fi lh ld l le lf">b=0</span><span id="f5e4" class="lb jp ht kx b fi lh ld l le lf">position_x = 0</span><span id="68df" class="lb jp ht kx b fi lh ld l le lf">position_y = 0</span></pre><p id="0383" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">5.我们将创建一个函数，它接受 R，G，B 值的参数，并为这些值找到一个名称。熊猫 loc()函数将帮助我们找到颜色名称。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="188e" class="lb jp ht kx b fi lc ld l le lf">def recognizer(R,G,B):</span><span id="1314" class="lb jp ht kx b fi lh ld l le lf">minimum = 1000</span><span id="5518" class="lb jp ht kx b fi lh ld l le lf">for i in range(len(dataset)):</span><span id="0e55" class="lb jp ht kx b fi lh ld l le lf">d = abs(R - int(dataset.loc[i,"R"])) + abs(G - int(dataset.loc[i, "G"])) + abs(B - int(dataset.loc[i, "B"]))</span><span id="5873" class="lb jp ht kx b fi lh ld l le lf">if(d&lt;=minimum):</span><span id="b629" class="lb jp ht kx b fi lh ld l le lf">minimum = d</span><span id="e5ee" class="lb jp ht kx b fi lh ld l le lf">cname = dataset.loc[i, "color_name"]</span><span id="3824" class="lb jp ht kx b fi lh ld l le lf">return cname</span></pre><p id="9d99" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">6.我们需要创建一个鼠标点击处理程序来处理用户双击图像并获得点击的位置。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5fca" class="lb jp ht kx b fi lc ld l le lf">def clickhandler(event, x, y,f,p):</span><span id="13f4" class="lb jp ht kx b fi lh ld l le lf">if event == opencv.EVENT_LBUTTONDBLCLK:</span><span id="022c" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">global</em> b,g,r,position_x,position_y, clickstate</span><span id="fdfb" class="lb jp ht kx b fi lh ld l le lf">clickstate = True</span><span id="524a" class="lb jp ht kx b fi lh ld l le lf">position_x = x</span><span id="7879" class="lb jp ht kx b fi lh ld l le lf">position_y = y</span><span id="9fcc" class="lb jp ht kx b fi lh ld l le lf">b,g,r = image[y,x]</span><span id="bd13" class="lb jp ht kx b fi lh ld l le lf">b = int(b)</span><span id="c309" class="lb jp ht kx b fi lh ld l le lf">g = int(g)</span><span id="ed96" class="lb jp ht kx b fi lh ld l le lf">r = int(r)</span></pre><p id="907f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">7.我们将创建一个 OpenCV 窗口来打开图像，并将 clickhandler 函数设置为鼠标单击处理程序，它将由用户的双击触发。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="699f" class="lb jp ht kx b fi lc ld l le lf">opencv.namedWindow('Color Recognition Application')</span><span id="236d" class="lb jp ht kx b fi lh ld l le lf">opencv.setMouseCallback('Color Recognition Application', clickhandler)</span></pre><p id="0416" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">8.现在我们将编写一个 while 循环来检测图像的颜色。注释是自我解释的。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="229c" class="lb jp ht kx b fi lc ld l le lf">while(1):</span><span id="c9cc" class="lb jp ht kx b fi lh ld l le lf">opencv.imshow("Color Recognition Application",image)</span><span id="a778" class="lb jp ht kx b fi lh ld l le lf">if (clickstate):</span><span id="080f" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#opencv.rectangle(image, startpoint, endpoint, color, thickness)-1. It fills entire rectangle</em></span><span id="f9a5" class="lb jp ht kx b fi lh ld l le lf">opencv.rectangle(image,(20,20), (750,60), (b,g,r), -1)</span><span id="d01b" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#Creating a text string to display color name and RGB value</em></span><span id="ead4" class="lb jp ht kx b fi lh ld l le lf">text = recognizer(r,g,b) + "  RGB("+str(r)+","+str(g)+","+str(b)+")"</span><span id="7a57" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#opencv.putText() function will write data on image</em></span><span id="7501" class="lb jp ht kx b fi lh ld l le lf">opencv.putText(image, text,(50,50),2,0.8,(255,255,255),2,opencv.LINE_AA)</span><span id="5c37" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#For light colors we will choose black color</em></span><span id="71aa" class="lb jp ht kx b fi lh ld l le lf">if(r+g+b&gt;=600):</span><span id="f38d" class="lb jp ht kx b fi lh ld l le lf">opencv.putText(image, text,(50,50),2,0.8,(0,0,0),2,opencv.LINE_AA)</span><span id="ceeb" class="lb jp ht kx b fi lh ld l le lf">clickstate=False</span><span id="8f32" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#Ends the function when Esc is clicked</em></span><span id="52ec" class="lb jp ht kx b fi lh ld l le lf">if opencv.waitKey(20) &amp; 0xFF ==27:</span><span id="b548" class="lb jp ht kx b fi lh ld l le lf">break</span></pre><p id="0e90" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">9.用 destroyAllWindows()函数关闭 OpenCV 窗口。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="29d7" class="lb jp ht kx b fi lc ld l le lf">opencv.destroyAllWindows()</span></pre><p id="a011" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有这些看起来像…</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="be9a" class="lb jp ht kx b fi lc ld l le lf">import numpy</span><span id="dc68" class="lb jp ht kx b fi lh ld l le lf">import pandas</span><span id="2e9a" class="lb jp ht kx b fi lh ld l le lf">import cv2 as opencv</span><span id="f21d" class="lb jp ht kx b fi lh ld l le lf">image = opencv.imread(input("Input a File location: "))</span><span id="2a71" class="lb jp ht kx b fi lh ld l le lf">index = ["color","color_name","hex","R","G","B"]</span><span id="3d87" class="lb jp ht kx b fi lh ld l le lf">dataset = pandas.read_csv("dataset.csv", names=index, header=None)</span><span id="1749" class="lb jp ht kx b fi lh ld l le lf">clickstate = False</span><span id="b78d" class="lb jp ht kx b fi lh ld l le lf">r=0</span><span id="6b05" class="lb jp ht kx b fi lh ld l le lf">g=0</span><span id="a0f2" class="lb jp ht kx b fi lh ld l le lf">b=0</span><span id="608c" class="lb jp ht kx b fi lh ld l le lf">position_x = 0</span><span id="8462" class="lb jp ht kx b fi lh ld l le lf">position_y = 0</span><span id="0667" class="lb jp ht kx b fi lh ld l le lf">def recognizer(R,G,B):</span><span id="d10f" class="lb jp ht kx b fi lh ld l le lf">minimum = 1000</span><span id="9d50" class="lb jp ht kx b fi lh ld l le lf">for i in range(len(dataset)):</span><span id="ef02" class="lb jp ht kx b fi lh ld l le lf">d = abs(R - int(dataset.loc[i,"R"])) + abs(G - int(dataset.loc[i, "G"])) + abs(B - int(dataset.loc[i, "B"]))</span><span id="8bd5" class="lb jp ht kx b fi lh ld l le lf">if(d&lt;=minimum):</span><span id="7ccd" class="lb jp ht kx b fi lh ld l le lf">minimum = d</span><span id="8d16" class="lb jp ht kx b fi lh ld l le lf">cname = dataset.loc[i, "color_name"]</span><span id="3ab8" class="lb jp ht kx b fi lh ld l le lf">return cname</span><span id="1469" class="lb jp ht kx b fi lh ld l le lf">def clickhandler(event, x, y,f,p):</span><span id="3c3a" class="lb jp ht kx b fi lh ld l le lf">if event == opencv.EVENT_LBUTTONDBLCLK:</span><span id="c069" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">global</em> b,g,r,position_x,position_y, clickstate</span><span id="1ce2" class="lb jp ht kx b fi lh ld l le lf">clickstate = True</span><span id="a6f7" class="lb jp ht kx b fi lh ld l le lf">position_x = x</span><span id="376d" class="lb jp ht kx b fi lh ld l le lf">position_y = y</span><span id="4317" class="lb jp ht kx b fi lh ld l le lf">b,g,r = image[y,x]</span><span id="cc48" class="lb jp ht kx b fi lh ld l le lf">b = int(b)</span><span id="b7ec" class="lb jp ht kx b fi lh ld l le lf">g = int(g)</span><span id="d82b" class="lb jp ht kx b fi lh ld l le lf">r = int(r)</span><span id="6a00" class="lb jp ht kx b fi lh ld l le lf">opencv.namedWindow('Color Recognition Application')</span><span id="f552" class="lb jp ht kx b fi lh ld l le lf">opencv.setMouseCallback('Color Recognition Application', clickhandler)</span><span id="6bce" class="lb jp ht kx b fi lh ld l le lf">while(1):</span><span id="4d86" class="lb jp ht kx b fi lh ld l le lf">opencv.imshow("Color Recognition Application",image)</span><span id="b70d" class="lb jp ht kx b fi lh ld l le lf">if (clickstate):</span><span id="baae" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#opencv.rectangle(image, startpoint, endpoint, color, thickness)-1. It fills entire rectangle</em></span><span id="058e" class="lb jp ht kx b fi lh ld l le lf">opencv.rectangle(image,(20,20), (750,60), (b,g,r), -1)</span><span id="2a4f" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#Creating a text string to display color name and RGB value</em></span><span id="b4e8" class="lb jp ht kx b fi lh ld l le lf">text = recognizer(r,g,b) + "  RGB("+str(r)+","+str(g)+","+str(b)+")"</span><span id="d2ab" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#opencv.putText() function will write data on image</em></span><span id="3769" class="lb jp ht kx b fi lh ld l le lf">opencv.putText(image, text,(50,50),2,0.8,(255,255,255),2,opencv.LINE_AA)</span><span id="3c39" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#For light colors we will choose black color</em></span><span id="723f" class="lb jp ht kx b fi lh ld l le lf">if(r+g+b&gt;=600):</span><span id="645b" class="lb jp ht kx b fi lh ld l le lf">opencv.putText(image, text,(50,50),2,0.8,(0,0,0),2,opencv.LINE_AA)</span><span id="6a3b" class="lb jp ht kx b fi lh ld l le lf">clickstate=False</span><span id="c31f" class="lb jp ht kx b fi lh ld l le lf"><em class="kr">#Ends the function when Esc is clicked</em></span><span id="8036" class="lb jp ht kx b fi lh ld l le lf">if opencv.waitKey(20) &amp; 0xFF ==27:</span><span id="89a6" class="lb jp ht kx b fi lh ld l le lf">break</span><span id="deb9" class="lb jp ht kx b fi lh ld l le lf">opencv.destroyAllWindows()</span></pre><p id="a5a9" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在运行程序，看看魔术。</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><h1 id="ba1c" class="jo jp ht bd jq jr ly jt ju jv lz jx jy jz ma kb kc kd mb kf kg kh mc kj kk kl bi translated">结论</h1><p id="59ef" class="pw-post-body-paragraph iq ir ht is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">这篇文章描述了一个非常基本的强大的 OpenCV 和 Pandas 库的应用。我们可以对它进行研究，并用这些库创建更强大、更棒应用程序。</p><p id="03c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">编码快乐！！！</p></div></div>    
</body>
</html>