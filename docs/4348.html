<html>
<head>
<title>FragmentTransaction.hide()- findings</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FragmentTransaction.hide()-结果</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/fragmenttransaction-hide-findings-5b998e959c82?source=collection_archive---------1-----------------------#2021-07-17">https://medium.com/nerd-for-tech/fragmenttransaction-hide-findings-5b998e959c82?source=collection_archive---------1-----------------------#2021-07-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/0be5aebc36fefcfadb0cd8807a5c840b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-SJS6XXMBMoX83pOAsDuWw.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">故事标题</figcaption></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="8af4" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">今天，我们将了解隐藏碎片比替换碎片的隐藏成本。</p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="7e64" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">最近，我在我的一个示例项目中发现了以下代码的问题，所以我决定与您分享它。</p><figure class="jv jw jx jy fd ij"><div class="bz dy l di"><div class="jz ka l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">片段事务</figcaption></figure></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="4205" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">当我们对任何</strong> <code class="du kz la lb lc b"><strong class="ak">fragment </strong></code> <strong class="ak">事务调用</strong> <code class="du kz la lb lc b"><strong class="ak">hide</strong></code> <strong class="ak">时会发生什么:</strong></h1><ul class=""><li id="98ae" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">它隐藏了一个现有的片段。</li><li id="29ac" class="ld le hi iz b ja lo je lp ji lq jm lr jq ls ju lk ll lm ln bi translated">这将导致视图被添加到容器中的<code class="du kz la lb lc b">fragment</code>的<code class="du kz la lb lc b">view to be hidden</code>。</li><li id="2091" class="ld le hi iz b ja lo je lp ji lq jm lr jq ls ju lk ll lm ln bi translated">它在<code class="du kz la lb lc b">fragment</code>触发<code class="du kz la lb lc b">onHiddenChanged(hidden: Boolean)</code>方法</li></ul><figure class="jv jw jx jy fd ij"><div class="bz dy l di"><div class="jz ka l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">onHiddenChanged方法</figcaption></figure><blockquote class="lt lu lv"><p id="1fc5" class="ix iy lw iz b ja jb jc jd je jf jg jh lx jj jk jl ly jn jo jp lz jr js jt ju hb bi translated">它只是隐藏了视图，<strong class="iz hj">片段</strong>仍处于<code class="du kz la lb lc b"><strong class="iz hj">RESUMED</strong></code> <strong class="iz hj">状态</strong>🤯🤯🤯🤯</p></blockquote></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="9062" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">它如何影响应用程序的性能:</strong></h1><ul class=""><li id="0236" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">假设您通过从<code class="du kz la lb lc b">ViewModel</code>观察<code class="du kz la lb lc b">livedata</code>来更新<code class="du kz la lb lc b">Textview’s text</code>，那么它将继续向UI发送更改，因为<code class="du kz la lb lc b">fragment</code>处于<code class="du kz la lb lc b">RESUMED</code>状态。</li></ul><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es ma"><img src="../Images/7b4bdd49c32d5518e3ea6f9cd20c1bd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hsCu1_MnaDA2PIWGUdI_Vg.gif"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">基于livedata值更新UI</figcaption></figure><p id="c72a" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">正如你所看到的,<code class="du kz la lb lc b">MainFragment</code>对用户来说不是<code class="du kz la lb lc b">visible</code>,但是我们没有用<code class="du kz la lb lc b">SecondFragment</code>来代替它，而是调用了<code class="du kz la lb lc b">hide on fragment transaction</code>,它只是隐藏了它的视图。它仍然处于<code class="du kz la lb lc b">RESUMED</code>状态，并继续向UI发送更新</p><ul class=""><li id="0059" class="ld le hi iz b ja jb je jf ji mf jm mg jq mh ju lk ll lm ln bi translated">正如我们所讨论的，因为fragment仍然处于<code class="du kz la lb lc b">RESUMED</code>状态，这意味着它为<code class="du kz la lb lc b">all the resources</code>保留了<code class="du kz la lb lc b">references</code>，这导致了内存泄漏/浪费问题。<br/> <strong class="iz hj">例如:</strong> ViewBinding保持存活，并保留对其所有视图、资源等的引用。</li><li id="5794" class="ld le hi iz b ja lo je lp ji lq jm lr jq ls ju lk ll lm ln bi translated">在有1或2个片段的小应用程序中，它可能不会显示大规模的影响，但想象一下，如果你有一个带<code class="du kz la lb lc b">100+ fragments </code>的应用程序，而你只有<code class="du kz la lb lc b">hide the current fragment and add new fragment on top of it</code>。最终会因为<code class="du kz la lb lc b"> memory or resource consumption</code>而导致<code class="du kz la lb lc b">ANR’s</code>或者<code class="du kz la lb lc b">crashes</code>。</li></ul></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="c2d7" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">popBackStack:</h1><ul class=""><li id="e818" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">从管理器的片段后堆栈中弹出<strong class="iz hj">最后一个片段过渡</strong></li><li id="ac76" class="ld le hi iz b ja lo je lp ji lq jm lr jq ls ju lk ll lm ln bi translated">从后面的堆栈中弹出顶部状态。</li><li id="263b" class="ld le hi iz b ja lo je lp ji lq jm lr jq ls ju lk ll lm ln bi translated">它是异步的——它将请求排入pop队列，但是直到应用程序返回到它的事件循环时才会执行操作。</li></ul><figure class="jv jw jx jy fd ij"><div class="bz dy l di"><div class="jz ka l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">popBackStack</figcaption></figure><ul class=""><li id="bee3" class="ld le hi iz b ja jb je jf ji mf jm mg jq mh ju lk ll lm ln bi translated">查看<code class="du kz la lb lc b">POP BACK STACK</code> <strong class="iz hj">按下</strong>时的日志，可以看到它触发了<code class="du kz la lb lc b">MainFragment</code>的<code class="du kz la lb lc b">onHiddenChanged</code>，由<strong class="iz hj">将</strong>的<strong class="iz hj">可见度</strong>设置为<code class="du kz la lb lc b">TRUE</code></li></ul><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es mi"><img src="../Images/0090c2d6ca72fddb741425d2036b0984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0RRctdUIXMFa1JMU2aXyZQ.gif"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">popBackStack日志</figcaption></figure><h1 id="8bac" class="kb kc hi bd kd ke mj kg kh ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky bi translated">重叠内容问题:</h1><p id="692f" class="pw-post-body-paragraph ix iy hi iz b ja lf jc jd je lg jg jh ji mo jk jl jm mp jo jp jq mq js jt ju hb bi translated">在某些时候，如果你想加载全屏片段，那么你可以将它加载到<code class="du kz la lb lc b">android.R.id.content</code>而不是添加到现有的容器中，但是此时在现有的容器中(<code class="du kz la lb lc b">R.id.container</code> ) <code class="du kz la lb lc b">RESUMED</code>片段仍然是可访问的，尽管它被添加到<code class="du kz la lb lc b">android.R.id.content</code>的片段所覆盖。</p><figure class="jv jw jx jy fd ij er es paragraph-image"><div role="button" tabindex="0" class="mb mc di md bf me"><div class="er es mr"><img src="../Images/f8ecf94e13c61c1f129dda69610e4024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*WmMYFD-YK7HuEYH1fgTKug.gif"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">重叠内容可访问</figcaption></figure><p id="a522" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">正如你在日志中看到的<code class="du kz la lb lc b">fragment</code>的<code class="du kz la lb lc b">content</code>是<code class="du kz la lb lc b">android.R.id.content</code>下的<code class="du kz la lb lc b">hidden</code>仍然是<code class="du kz la lb lc b">accessible.</code></p><h1 id="70af" class="kb kc hi bd kd ke mj kg kh ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky bi translated">解决这一问题的巧妙方法是:</h1><ul class=""><li id="c5cb" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">你可能会耍花招让<code class="du kz la lb lc b">add background color </code>到最上面的<code class="du kz la lb lc b">fragment’s layout’s parent tag</code>，这样<code class="du kz la lb lc b">underlying content</code>就会<code class="du kz la lb lc b">not be visible</code>但是任何<code class="du kz la lb lc b">random click on UI</code>都会把你置于一个你意想不到的境地。</li></ul><h2 id="217c" class="ms kc hi bd kd mt mu mv kh mw mx my kl ji mz na kp jm nb nc kt jq nd ne kx nf bi translated">或者</h2><ul class=""><li id="de87" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">将<code class="du kz la lb lc b">parent tag of fragment’s layout</code>上的<code class="du kz la lb lc b">clickListener</code>设置为加载到<code class="du kz la lb lc b">android.R.id.content</code>中，这样屏幕上的任何点击都不会超出其内容。</li></ul><figure class="jv jw jx jy fd ij"><div class="bz dy l di"><div class="jz ka l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">parentTag点击监听器</figcaption></figure><h1 id="2012" class="kb kc hi bd kd ke mj kg kh ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky bi translated">建议解决此问题的解决方案:</h1><ul class=""><li id="e703" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated">在将片段加载到<code class="du kz la lb lc b">android.R.id.content</code>之前，清除<code class="du kz la lb lc b">backStack</code>，这样只有<code class="du kz la lb lc b">required content </code>是<code class="du kz la lb lc b">visible</code></li></ul><figure class="jv jw jx jy fd ij"><div class="bz dy l di"><div class="jz ka l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">清除背景</figcaption></figure><h2 id="88d3" class="ms kc hi bd kd mt mu mv kh mw mx my kl ji mz na kp jm nb nc kt jq nd ne kx nf bi translated"><strong class="ak">或</strong></h2><ul class=""><li id="1d46" class="ld le hi iz b ja lf je lg ji lh jm li jq lj ju lk ll lm ln bi translated"><strong class="iz hj">隐藏所有以前的片段</strong>，因为<code class="du kz la lb lc b">2 different fragments </code>在<code class="du kz la lb lc b">2 different containers</code>中处于<code class="du kz la lb lc b">RESUMED</code>状态</li></ul></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><p id="29f3" class="pw-post-body-paragraph ix iy hi iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju hb bi translated">因此，无论何时处理多个片段，你都需要小心确保自己没有浪费资源，并且在特定情况下，只有需要的内容可见，而不是不重要或与当前流无关的内容。</p></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><blockquote class="lt lu lv"><p id="d768" class="ix iy lw iz b ja jb jc jd je jf jg jh lx jj jk jl ly jn jo jp lz jr js jt ju hb bi translated">这完全取决于你<strong class="iz hj">无论什么工作(隐藏/替换)</strong>你去做吧。</p></blockquote></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="5adf" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">检查完整的示例代码:</h1><div class="ng nh ez fb ni nj"><a href="https://github.com/navczydev/FragmentHideReplaceDemo" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">navczydev/FragmentHideReplaceDemo</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">示例应用程序用于与隐藏/替换片段相关的演示目的-navczydev/FragmentHideReplaceDemo</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">github.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx ik nj"/></div></div></a></div></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="b906" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">😊😊 👏👏👏👏快乐编码👏👏👏👏 😊😊</h1><h1 id="19fc" class="kb kc hi bd kd ke mj kg kh ki mk kk kl km ml ko kp kq mm ks kt ku mn kw kx ky bi translated">参考</h1><p id="04d8" class="pw-post-body-paragraph ix iy hi iz b ja lf jc jd je lg jg jh ji mo jk jl jm mp jo jp jq mq js jt ju hb bi translated"><a class="ae ny" href="https://developer.android.com/reference/android/app/FragmentTransaction#hide(android.app.Fragment)" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/reference/Android/app/fragment transaction # hide(Android . app . fragment)</a></p><div class="ng nh ez fb ni nj"><a rel="noopener follow" target="_blank" href="/androiddevelopers/the-android-lifecycle-cheat-sheet-part-iii-fragments-afc87d4f37fd"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">Android生命周期备忘单——第三部分:片段</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">在本系列中:*第一部分:活动—单个活动生命周期*第二部分:多个活动—导航和返回…</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">medium.com</p></div></div><div class="ns l"><div class="nz l nu nv nw ns nx ik nj"/></div></div></a></div></div><div class="ab cl iq ir gp is" role="separator"><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv iw"/><span class="it bw bk iu iv"/></div><div class="hb hc hd he hf"><h1 id="42ad" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">保持联系</h1><div class="ng nh ez fb ni nj"><a href="https://github.com/navczydev" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">navczydev -概述</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">GDG-蒙特娄Android开发者组织者。navczydev有86个存储库可用。在GitHub上关注他们的代码。</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">github.com</p></div></div><div class="ns l"><div class="oa l nu nv nw ns nx ik nj"/></div></div></a></div><div class="ng nh ez fb ni nj"><a href="https://www.linkedin.com/in/navczydev/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">纳夫·辛格-作家-媒体| LinkedIn</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">在世界上最大的职业社区LinkedIn上查看Nav Singh的个人资料。Nav列出了7个职位…</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">www.linkedin.com</p></div></div></div></a></div><div class="ng nh ez fb ni nj"><a href="https://twitter.com/navczydev" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hj fi z dy no ea eb np ed ef hh bi translated">JavaScript不可用。</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">编辑描述</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">twitter.com</p></div></div><div class="ns l"><div class="ob l nu nv nw ns nx ik nj"/></div></div></a></div></div></div>    
</body>
</html>