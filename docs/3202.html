<html>
<head>
<title>Use useEffect hook effectively as a callback for state changes.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">有效地使用useEffect钩子作为状态改变的回调。</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/useref-with-usestate-handling-the-dependency-array-nightmare-35e6418fdd75?source=collection_archive---------17-----------------------#2021-06-01">https://medium.com/nerd-for-tech/useref-with-usestate-handling-the-dependency-array-nightmare-35e6418fdd75?source=collection_archive---------17-----------------------#2021-06-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="2d63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">跟我说说，让我先解释一下这个场景。</p><p id="48e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设你需要做一些事情，比如当一个状态更新时调用一个函数，在React中最简单的方法是使用<code class="du jd je jf jg b">React.useEffect</code>并使用状态作为依赖，这样钩子在每次状态更新时触发。</p><p id="93d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是根据文档，依赖数组应该包含在钩子内部使用的、在钩子主体外部声明的东西，即函数和状态，以便钩子具有它正在使用的更新的依赖。</p><p id="fcb3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果我们不希望每次其余的依赖关系改变时都调用<code class="du jd je jf jg b">React.useEffect</code>怎么办，为此我们可以使用<code class="du jd je jf jg b">React.useRef</code>来创建对其余依赖关系的引用，并使用引用而不是值本身。</p><p id="d935" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">嵌入式沙箱包含一个React应用程序来处理这种情况。</p><h1 id="0ca6" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">方案</h1><p id="a278" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">当计数器更新时，我们通过使用其引用调用一个函数来更新名为<code class="du jd je jf jg b">someTextState</code>的状态。该功能简单地更新了<code class="du jd je jf jg b">someTextState</code></p><h1 id="3d38" class="jh ji hi bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke bi translated">代码走查</h1><h2 id="c4f8" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">州</h2><p id="4e8f" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">以下是我们正在使用的状态，<code class="du jd je jf jg b">counter</code>将在按下按钮时更新。<code class="du jd je jf jg b">someTextState</code>将在计数器更新后更新。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="ld le l"/></div></figure><h2 id="3597" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">按钮点击的回调</h2><p id="c0e9" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">如果按钮被按下，下面的函数将被调用，这将简单地增加计数器的状态。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/0ed51ae7cd8b027c2683a3dd09627806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pnXkTN10f3DGH6v32tfnDQ.png"/></div></div></figure><h2 id="d8bd" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">更新另一个状态的函数</h2><p id="b0ea" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">以下函数更新<code class="du jd je jf jg b">someTextState</code>状态。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lm"><img src="../Images/67a1c7c39ac711a1e10be611d2346981.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nuv6B70whIl_OOnRmblXaQ.png"/></div></div></figure><h2 id="3140" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">上述功能的参考</h2><p id="abcf" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">为上述函数创建一个引用，并在函数更新时使用<code class="du jd je jf jg b">React.useEffect</code>钩子更新引用。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/a1b7da0286119982915371d3278ba6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UfUDB6bUTB_4h0oAE9pZBA.png"/></div></div></figure><h2 id="01be" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">当计数器状态改变时更新另一个状态</h2><p id="5eee" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">当<code class="du jd je jf jg b">counter</code>状态改变时，由于<code class="du jd je jf jg b">updateSomeTextStateRef.current</code>包含对最新/更新的<code class="du jd je jf jg b">updateSomeTextState</code>的引用，下面的钩子将调用<code class="du jd je jf jg b">updateSomeTextState</code>函数。</p><p id="dd76" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意，我们没有使用<code class="du jd je jf jg b">updateSomeTextState</code>或<code class="du jd je jf jg b">updateSomeTextStateRef</code>作为依赖项。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/c2994fea93b38510bc356cb792a020f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4C-bFV5KY9MC4iLOK6F6Q.png"/></div></div></figure><h2 id="5fa8" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">呈现组件</h2><p id="f126" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">我们只是呈现包含两种状态内容的按钮，当按下按钮时调用<code class="du jd je jf jg b">incrementCounter</code>函数。</p><figure class="ky kz la lb fd lc er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lm"><img src="../Images/3473a5fbc871c9b17188480c315c544c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrYMnNClimSIvBRl20mhnA.png"/></div></div></figure><h2 id="da91" class="kk ji hi bd jj kl km kn jn ko kp kq jr iq kr ks jv iu kt ku jz iy kv kw kd kx bi translated">沙箱</h2><p id="51a4" class="pw-post-body-paragraph if ig hi ih b ii kf ik il im kg io ip iq kh is it iu ki iw ix iy kj ja jb jc hb bi translated">你可以看看下面的沙盒，看看所有的东西是如何连接在一起的。</p><figure class="ky kz la lb fd lc"><div class="bz dy l di"><div class="lo le l"/></div></figure></div></div>    
</body>
</html>