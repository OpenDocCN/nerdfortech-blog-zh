<html>
<head>
<title>ELK: Initiation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">麋鹿:启蒙</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/elk-initiation-3f9cdd814b6a?source=collection_archive---------7-----------------------#2021-03-05">https://medium.com/nerd-for-tech/elk-initiation-3f9cdd814b6a?source=collection_archive---------7-----------------------#2021-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/b546660b532db68fd97f351007ee8351.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ix_i-srWU2s-dc5zId9Q5w.jpeg"/></div></div></figure><p id="e9e3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这篇文章中，我们将看到在 Java 应用程序中面向日志管理的 ELK 操作，为此，我们将使用 Apache Camel 应用程序，这是我们以前见过的。</p><p id="6078" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">ELK 是一系列应用程序所熟知的，特别是:Elasticsearch、Logstash 和 Kibana。都是 Elastics 开发的开源工具。它们允许您从任何类型的来源以任何格式收集数据，以便实时搜索、分析和可视化数据。</p><ul class=""><li id="3a2a" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">Logstash 是一个服务器端数据处理管道，它同时使用来自多个不同来源的数据。这些数据被转换并发送到数据存储库。</li><li id="ab00" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Elasticsearch 是一个搜索和分析你存储的数据的引擎。</li><li id="d699" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Kibana 允许我们根据 Elasticsearch 拥有的信息为用户创建图表和仪表盘。</li></ul><p id="a219" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">目前，这一堆应用程序也是由 Beat 组成的。但是我们不会在这篇文章中谈论它。</p><p id="c0e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在整篇文章中，我们将看到如何组装它，如何配置它，以及如何利用 Java 应用程序的信息。让栈可用的最简单的方法是通过 Docker Compose。</p><p id="c471" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们从弹性搜索开始。它是最重要的组件，也是需要更多资源的组件。在生产环境中，建议创建一个集群来保持高可用性和完整的性能。但是在我们的例子中，作为主要特性，它只有一个节点。否则，这将是一个常见的 Docker 配置:</p><ul class=""><li id="b52e" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">我们将指定一个本地文件夹作为容器卷，这将允许我们即使删除容器也能保留信息。</li><li id="b785" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">容器使用的公共网络。</li><li id="3d79" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">暴露的端口:9200 和 9300。</li><li id="3853" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">检查实例是否仍正常工作的运行状况检查。为此，我们将简单地检查公开的端口在被调用时是否得到响应。</li></ul><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="6027" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一部分是 Kibana 容器的创建。这个工具会读取存储在 Elasticsearch 中的信息，所以它必须知道它的位置。但是这不会在 Docker Compose 中指出，对于这个工具来说，Docker Compose 有一个非常基本的配置。但是它将在 YAML 配置文件中指出，我们称之为输入卷。</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="6709" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在配置文件中，我们必须指出服务的名称、IP 地址，最重要的是，Elasticsearch 的位置。</p><pre class="kc kd ke kf fd ki kj kk kl aw km bi"><span id="c0f9" class="kn ko hi kj b fi kp kq l kr ks">server.name: kibana<br/>server.host: 0.0.0.0<br/>elasticsearch.hosts: [ "http://elasticsearch:9200" ]<br/>monitoring.ui.container.elasticsearch.enabled: true<br/>## X-Pack security credentials<br/>elasticsearch.username: elastic<br/>elasticsearch.password: changeme</span></pre><p id="b779" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要完成 Docker Compose 的配置，我们只需要配置 Logstash。此配置会稍微复杂一些，由以下几部分组成:</p><ul class=""><li id="0e2d" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">一个卷，指示我们将在其中配置 Logstash 的文件。</li><li id="a99c" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">在这个卷中，我们将配置不同的管道，这些管道将作为由 Logstash 发送到 Elasticsearch 的数据的输入。</li><li id="f65b" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Logstash 可以访问应用程序创建的日志的卷。</li><li id="97d6" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">服务公开的端口。</li><li id="f3d5" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">要使用的 JVM 的内存配置。</li></ul><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="f3cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">logstash.yml 文件将允许我们配置该工具。在这个例子中，它不会包含很多值。至于 Kibana，我们将设置我们的 IP 和 Elasticsearch 的位置:</p><pre class="kc kd ke kf fd ki kj kk kl aw km bi"><span id="f03e" class="kn ko hi kj b fi kp kq l kr ks">http.host: 0.0.0.0<br/>xpack.monitoring.elasticsearch.hosts: ["http://elasticsearch:9200"]<br/>## X-Pack security credentials<br/>xpack.monitoring.enabled: true<br/>xpack.monitoring.elasticsearch.username: elastic<br/>xpack.monitoring.elasticsearch.password: changeme</span></pre><p id="e900" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">pipeline 文件夹将存储不同的配置文件，这些文件将允许 Logstash 管理不同的信息源，并将它们发送到 Elasticsearch。这些文件分为三个部分:</p><ul class=""><li id="5407" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">输入:指明数据来源的地方。在我们的例子中，它将是应用程序生成的日志文件。那些安装在卷上的。</li><li id="c2a5" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">Filter:我们可以对数据执行任何过滤操作。对于我们的例子，我们不会执行任何。</li><li id="97c6" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">输出:在这里，我们指明要将它发送到哪个存储库。在这种情况下，弹性搜索。</li></ul><p id="330c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦我们配置了 Docker Compose，我们就可以通过访问路径<a class="ae kt" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank"> http://localhost:9200 </a>来启动它并检查它是否正常工作。</p><p id="fcba" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步将是我们的应用程序的配置。最重要的是，我们将使用 logback。并且通过 LogstashEncoder 类，我们将被允许指示某些特征。例如输出格式、添加自定义字段或排除某些包。</p><figure class="kc kd ke kf fd ij"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="bbfc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们将启动应用程序并执行几个查询，例如对<a class="ae kt" href="http://localhost:9090/book/1" rel="noopener ugc nofollow" target="_blank">http://localhost:9090/book/1</a>的查询。</p><p id="f20c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步将是配置 Kibana，使其能够可视化所有数据。为此，我们访问<a class="ae kt" href="http://localhost:5601/app/home" rel="noopener ugc nofollow" target="_blank">http://localhost:5601/app/home</a>。一旦进入，我们必须执行两个步骤。</p><ul class=""><li id="4d45" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">创建索引</li></ul><p id="ae7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们创建一个索引，首先访问“管理空间”菜单选项，然后在左侧菜单中访问“索引管理”选项。在这个屏幕中，我们创建了与我们在 logstash 管道中指示的标识符相关联的索引。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ku"><img src="../Images/b13573bf96108ccea087b1dcfa3318cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*87g8v__AWm6Pm-NiFpinyw.png"/></div></div></figure><ul class=""><li id="8595" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">查看信息</li></ul><p id="fa3c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从主菜单的 Discover 选项，我们可以访问 Logstash 发送给 Elasticsearch 的日志。</p><figure class="kc kd ke kf fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/2a2cf81267d5e3ef99e22f000b20f94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r5larzHFWTgcxbvbFS6yMg.png"/></div></div></figure><p id="692d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这样，我们就已经通过日志监控了我们的应用程序。我们将能够通过 Kibana 更好地利用它们。我们可以根据向我们发送信息的应用程序、消息内容或日期和时间范围进行搜索。当您的应用程序具有一定的规模或产生大量消息时，这是非常重要的。</p><p id="1a7f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你想看完整的例子，这里有<a class="ae kt" href="https://github.com/deesebc/PostExamples/tree/master/ApacheCamel/ApacheCamelRestELK" rel="noopener ugc nofollow" target="_blank">和</a>。</p></div></div>    
</body>
</html>