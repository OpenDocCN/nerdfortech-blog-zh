<html>
<head>
<title>Hide upstream identity providers with the Auth Facade</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用身份验证外观隐藏上游身份提供者</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hide-upstream-identity-providers-with-the-auth-facade-bf70e4fdfaba?source=collection_archive---------21-----------------------#2021-03-05">https://medium.com/nerd-for-tech/hide-upstream-identity-providers-with-the-auth-facade-bf70e4fdfaba?source=collection_archive---------21-----------------------#2021-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/d2b272a9a60d8b04ad030a241ed02d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kltVKKC-N8VKxkZH.png"/></div></div></figure><p id="d031" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在与FusionAuth客户的交谈中，我看到了一种常见的部署模式，我称之为“Auth Facade”。在将软件部署到异构环境时，这种体系结构非常有用。您和您的团队正在构建一个将在现场部署的应用程序。这可能是数据中心、隔离网络或私有云。这些环境由您的客户运行，您对他们的配置了解有限。</p><p id="b93e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">出于各种原因，您可能会选择这种部署模型:</p><ul class=""><li id="e64b" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">数据重力，当您的应用程序需要访问数据时，因为有太多的数据由于成本或性能原因而没有提供给您。</li><li id="b731" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">机密数据的安全性；客户需要将数据保留在手中。</li><li id="7c76" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">由于部署位置的原因，与互联网的连接时断时续或有损耗。</li></ul><p id="41cc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所有这些都源于客户需求；你在顾客所在的地方会见他们。您的生产部署环境不受您的控制。这种情况在“软件即服务”兴起之前很常见，其复杂性导致了SaaS的泛滥。但是，对于这些环境，典型的SaaS解决方案，无论是监控、身份验证还是分析，都无法发挥作用。</p><p id="382a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">同时，您的企业客户不希望再维护一个用户数据库。相反，利益相关者希望您的应用程序根据现有的数据存储对用户进行身份验证。这可能是Azure Active Directory、Okta或其他身份提供商。此身份提供商由您客户的员工运营，可能支持OIDC或SAML。</p><p id="948a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是，您希望确保您的开发人员专注于构建和扩展您的应用程序，而不是构建auth集成。您尤其希望避免在不受您控制的prod环境中调试身份验证。</p><p id="c9c3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，您的应用程序也需要用户数据。无论是基于角色的授权、审计访问还是显示“欢迎”消息，您的应用程序都需要访问和修改用户数据。</p><h1 id="3f39" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">处理上游授权的选项</h1><p id="75ba" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">作为一名企业软件开发人员，您有几种选择来解决这个问题:</p><ul class=""><li id="15d3" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">测试并记录如何配置您的应用程序以使用上游提供程序。这是一个自行解决方案，需要了解客户的部署环境。您需要为所有主要的提供者提供并测试配置选项。</li><li id="116a" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">代码符合OIDC和SAML规范，因为大多数企业提供商都支持这些规范。您将把您的用户数据需求限制在这些所能提供的范围内。这是纯联盟选项。</li><li id="09a0" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">使用验证外观。</li></ul><p id="40ec" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">像任何<a class="ae lf" href="https://en.wikipedia.org/wiki/Facade_pattern" rel="noopener ugc nofollow" target="_blank">外观</a>一样，auth外观隐藏了一个子系统。在这种情况下，子系统是您的客户端的身份提供者。当使用这种模式时，作为应用程序的一部分，您将拥有一个嵌入式授权和用户管理系统。所有授权功能都通过此进行路由；它被配置为与上游身份验证提供者通信。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lg"><img src="../Images/f9a5a1213aae5c8de28e98de2456001a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J5oZ9s_1Wjth-TSybIDdPQ.jpeg"/></div></div></figure><h1 id="0e2b" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">身份验证门面与联盟</h1><p id="e8a7" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">但是，auth facade提供的不仅仅是身份验证和授权联邦。联合是一个好的开始，但是有时你需要比标准提供的更多的功能、支持和文档。</p><p id="dd87" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当您使用auth facade时，您会得到以下内容:</p><ul class=""><li id="1a4f" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">开发人员可以通过单一界面访问和管理用户数据</li><li id="01e8" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">一个简单的，可部署的，紧凑的认证系统，可以在任何地方运行</li><li id="e613" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">一组丰富的API和数据模型</li><li id="fc84" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">各种上游供应商的大量文档</li></ul><p id="8e79" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们更详细地讨论一下其中的每一项。</p><h1 id="2b84" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">开发者界面</h1><p id="ecbc" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">您的开发人员需要某种认证系统，以便知道哪些用户可以访问应用程序，以及用户可以使用哪些特定的功能。通过使用auth facade，您的开发人员可以学习如何只与一个系统集成，而不是与您的客户可能要求您使用的每个系统集成。这使得开发变得更加容易，并且也解放了对应用程序特性的工程关注。</p><p id="3a92" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，当身份验证系统中存在错误时，有两个常见位置:</p><ul class=""><li id="ed4c" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">在应用程序和外观之间</li><li id="e4bb" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">在身份验证门面系统和上游提供者之间</li></ul><p id="b05f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在前一种情况下，您拥有调试导致客户问题的原因所需的一切。在后一种情况下，您将利用auth facade系统维护人员的故障排除和bug修复专业知识。在任何一种情况下，分离关注点都可以更容易地跟踪问题。</p><p id="784b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当问题出现时，您需要在auth facade系统后面有一个响应团队。您不想让您的客户等待解决方案。</p><h1 id="624c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">可部署授权系统</h1><p id="e780" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">在评估auth facade解决方案时，确保您可以将提供facade的系统部署到各种客户环境中。这排除了任何典型的SaaS解决方案，除非SaaS提供商部署到他们的网络中。能够支持气隙或隔离网络对您的应用来说是一个很大的优势，尤其是在访问敏感数据时。</p><p id="ac02" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">确保您的应用程序和auth facade系统可以使用相同的技术进行部署。这样做降低了安装的复杂性。根据客户的需求，您可能希望部署一个unix友好的包，如RPM或DEB，一个通用的软件包，如zip文件，或者，对于使用kubernetes的尖端客户端，一个容器解决方案，如Docker。</p><p id="6121" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为auth是应用程序的必要组成部分，但不是区分器，所以最好是一个隐藏在后台的auth系统。这应该发生在字面意义上，一个用户界面是不可识别的，与你的应用程序分离，和比喻意义上，你的工程师尽可能减少花费在担心或维护它的时间。</p><p id="a296" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您还需要一个友好的许可证来将身份验证系统嵌入到您的代码中。我不是律师，但请确保您理解任何第三方应用程序或库的许可分支。一些开源项目提供双重许可，这可能是一个可行的选择。</p><h1 id="894c" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">API和数据模型</h1><p id="66ec" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">如果您能够使用认证和授权信息的最小公分母，严格遵循OIDC和SAML标准，您将会很高兴。</p><p id="e8f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但是通常您正在构建的应用程序需要比这些标准所能提供的更多的用户信息。例如，您可能希望存储对您的应用程序有用的自定义域特定属性。</p><p id="0bb3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">与标准相比，任何auth facade解决方案都必须提供更好的数据模型，这样才值得实现。如果没有，就使用标准与上游供应商接口。</p><h1 id="03d7" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">证明文件</h1><p id="47b3" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">当我与客户交谈时，他们指出了文档的好处，这让我很惊讶。虽然文档通常很有用，但为什么它对auth facade如此重要呢？</p><p id="3dbe" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">文档允许您将auth facade和上游系统之间的连接配置卸载给了解和维护这些上游系统的人。你客户的这些员工不会熟悉你的应用程序。</p><p id="c318" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">事实上，他们可能会对应用程序安装要求他们做的额外工作感到不满。使auth facade的配置有良好的文档记录并尽可能简单，将使您的应用程序更容易在客户的环境中工作。</p><p id="2a86" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，您有两个选择:</p><ul class=""><li id="3d48" class="jo jp hi is b it iu ix iy jb jq jf jr jj js jn jt ju jv jw bi translated">自己维护这些文件</li><li id="5876" class="jo jp hi is b it jx ix jy jb jz jf ka jj kb jn jt ju jv jw bi translated">依靠auth facade提供者来创建和提供优秀的文档</li></ul><p id="497b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">猜猜哪个对你的工程团队来说更容易？</p><h1 id="d86e" class="kc kd hi bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">如何用FusionAuth实现auth facade</h1><p id="ece4" class="pw-post-body-paragraph iq ir hi is b it la iv iw ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn hb bi translated">FusionAuth是auth facade的最佳选择。它可以在任何地方运行，与SAML和OIDC以及其他上游供应商集成，为您的开发人员提供单一、丰富的界面，并且有很好的文档记录。</p><p id="d1a9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要开始使用FusionAuth实现auth facade，请查看FusionAuth <a class="ae lf" href="https://fusionauth.io/docs/v1/tech/identity-providers/" rel="noopener ugc nofollow" target="_blank">身份提供者</a>和<a class="ae lf" href="https://fusionauth.io/docs/v1/tech/connectors/" rel="noopener ugc nofollow" target="_blank">连接器</a>文档，以确保您的客户端的身份提供者受到支持。<a class="ae lf" href="https://fusionauth.io/contact/" rel="noopener ugc nofollow" target="_blank">如果不是，请联系我们</a>；我们很想了解更多。你也可以阅读客户以这种方式使用FusionAuth的案例研究，比如这个来自<a class="ae lf" href="https://fusionauth.io/resources/unsupervised-case-study.pdf" rel="noopener ugc nofollow" target="_blank"> Unsupervised </a> (PDF)。</p><p id="b28b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您认为FusionAuth符合您的需求，请<a class="ae lf" href="https://fusionauth.io/download/" rel="noopener ugc nofollow" target="_blank">下载FusionAuth </a>，尝试一下并构建一个概念验证。</p><p id="7deb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您有兴趣将其打包为您的应用程序的一部分，请<a class="ae lf" href="https://fusionauth.io/contact/" rel="noopener ugc nofollow" target="_blank">联系我们</a>讨论经销商协议。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="83ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="ls">最初发布于</em><a class="ae lf" href="https://fusionauth.io/blog/2021/01/27/auth-facade-pattern/" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://fusion auth . io</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>