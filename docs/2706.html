<html>
<head>
<title>API Testing with Cypress</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Cypress进行API测试</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/api-testing-with-cypress-136ffdc2520f?source=collection_archive---------5-----------------------#2021-05-17">https://medium.com/nerd-for-tech/api-testing-with-cypress-136ffdc2520f?source=collection_archive---------5-----------------------#2021-05-17</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8a9c2c757644bc58e90e7f1a400cdfa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1iXZEdAGJkPsyGcpuOzwYQ.png"/></div></div></figure><p id="5dd7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">作为测试自动化工程师，我们通常开发两组测试。UI和API的测试。命令行通常用于进行API测试，UI由浏览器执行。每次我们执行用户界面和API测试的项目时，我们总是利用我个人经验中不同的工具。这可能很好，因为我们必须不断确保我们的测试工具箱不断增长，以便我们知道哪一个最适合我们的需求，但是市场上有如此多的工具可以帮助我们进行API测试。我认为Postman可能是最受欢迎的，因为我们可以根据请求播放图形。例如，如果您必须在CI管道上进行邮差测试，您必须利用Newman，它是它的可比测试运行器。SuperTest和Chai-HTTP是其他著名的JavaScript测试框架。放心吧，空手道只是在Java星球上的几个例子。</p><p id="3f6a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我说我们可以使用相同的UI工具来测试我们的API呢？我们可以在命令行上为我们的API测试添加一个可视化测试运行程序吗？</p><p id="3f9e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它开发了对服务器请求的支持，这在Cypress中很棒。因为我们可以访问测试运行器，所以调试我们的API测试很简单。我们总是可以再次检查我们的API的状态，并且可以访问DevTools，它可以提供额外的信息来帮助我们的测试。</p><p id="80d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> cy.request() </strong></p><p id="616d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">默认情况下，cy.request()表示一个GET应用程序。然而，这是非常通用的，支持所有的HTTP操作，比如POST、DELETE和PUT。</p><p id="3525" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看一些例子:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="8a66" class="jx jy hi jt b fi jz ka l kb kc">describe('http://jsonplaceholder.typicode.com/',()=&gt;{<br/>    it('GET', ()=&gt;{<br/>        cy.request('http://jsonplaceholder.typicode.com/todos')<br/>            .its('headers')<br/>            .its('content-type')<br/>            .should('include','application/json');<br/>    })<br/>})</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/d11b2d2ce92318394eb40185cbbc3c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hqjJ9aR9IWKV3xOCPwrgtQ.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/945160834df53cd2f09500bbf94f8089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fm2ptkegv_1YZD5JabbShw.png"/></div></div></figure><p id="4b03" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们看看如何利用Cypress中的别名来引用请求。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="dff8" class="jx jy hi jt b fi jz ka l kb kc">describe('http://jsonplaceholder.typicode.com/',()=&gt;{<br/>    beforeEach('UserAPI',()=&gt;cy.request('http://jsonplaceholder.typicode.com/users').as('users'))<br/>    it('GET', ()=&gt;{<br/>        cy.get('@users').its('status').should('be.equal',200);<br/>        cy.get('@users').its('body').should('have.length',10);<br/>    })<br/>})</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/fa4be101f9266c25e25946ee8ec15a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*btyXlsAK-vDgc6Qae5874g.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kg"><img src="../Images/3ddedf6e4a58670d17a71048fbce86a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UtR553ihIhuj34U4FhNj8w.png"/></div></div></figure><p id="3ebb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们给测试添加更多的验证</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="4a3e" class="jx jy hi jt b fi jz ka l kb kc">describe('http://jsonplaceholder.typicode.com/',()=&gt;{<br/>    beforeEach('UserAPI',()=&gt;cy.request('http://jsonplaceholder.typicode.com/users').as('users'))<br/>    it('GET', ()=&gt;{<br/>        cy.get('@users').its('status').should('be.equal',200);<br/>        cy.get('@users').its('body').should('have.length',10);<br/>        cy.get('@users').its('body').its('0').should('include', { email: "Sincere@april.biz" });<br/>        cy.get('@users').its('body').its('7').its('phone').should('be.equal','586.493.6943 x140');<br/>    })<br/>})</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kh"><img src="../Images/8cc39ed45b89f92a70b73aeb6728c261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5Vbib9MO-uzUqi0BGzhfg.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ki"><img src="../Images/075ed93921f98c56661fa2aff114fbf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bCPWPZ0-DXLoK6XsAgXU-w.png"/></div></div></figure><p id="5aef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">使用cy-api插件</strong></p><p id="b788" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您不想自动加载DevTools控制台，另一种方法是利用cy-api插件。这个插件将返回对测试运行程序的请求和响应，它通常提供应用程序预览。这个插件的使用非常简单，只需要一些修改。</p><p id="3d37" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您需要通过运行以下命令来安装插件:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="b661" class="jx jy hi jt b fi jz ka l kb kc">npm install --save <a class="ae kj" href="http://twitter.com/bahmutov/cy-api" rel="noopener ugc nofollow" target="_blank">@bahmutov/cy-api</a></span></pre><p id="c02e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后在support/index.js文件中，添加以下行:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e1ce" class="jx jy hi jt b fi jz ka l kb kc">import '@bahmutov/cy-api/support';</span></pre><p id="8a5e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后将这一行添加到cypress.json中</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="cfaf" class="jx jy hi jt b fi jz ka l kb kc">"baseUrl": "http://jsonplaceholder.typicode.com"</span></pre><p id="a8f9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后将文件修改如下:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="3a97" class="jx jy hi jt b fi jz ka l kb kc">describe('Post API', () =&gt; {  it('loads all the posts successfully', () =&gt; {    cy.api({ url: '/posts' }).then((res) =&gt; {      expect(res.status).to.equal(200);      expect(res.body.length).to.equal(100);    });  });   it('loads the correct amount of posts per user', () =&gt; {    cy.api({ url: '/posts?userId=1' }).its('body').should('have.length', 10);  });   it('should add a new post successfully', () =&gt; {    cy.api({      method: 'POST',      url: '/posts?userId=1',      body: {        userId: 1,        title: 'foo',        body: 'var',      },    }).then((response) =&gt; {      expect(response.status).to.equal(201);      expect(response.body.id).to.equal(101);    });  });   it('should delete a post successfully', () =&gt; {    cy.api({ method: 'DELETE', url: '/posts/1' })      .its('status')      .should('be.equal', 200);  });});</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kk"><img src="../Images/27dba4b61c86eea19be431633d9ef0be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hGd0WYOqp8X7Ssv0Z3ENxQ.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kl"><img src="../Images/e02d48ca27e442abf233fdb9a63ec5fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LvxMr1zLd5mR-nTK5td6Zw.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/91b0c187bb9c523df2f5bf83efa28890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46rroGAocVV7r-2LoJKLuw.png"/></div></div></figure><p id="4acf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后，您可以在UI测试运行器中看到没有开发工具的结果</p><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kn"><img src="../Images/376b7d6f8516f7213ef10a5c29f7b690.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l_HV4jAlDK7aTzBRQ2fN6g.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/525e09da498172957f270a3df4d7257b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RWNprlPFfNcvinXxAbGk2A.png"/></div></div></figure><p id="1d04" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，让我们使用终端运行代码</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="34a7" class="jx jy hi jt b fi jz ka l kb kc">npx cypress run --spec cypress/integration/cyapiexample-api.spec.js</span></pre><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ko"><img src="../Images/8c3d3cc51310e87f47ac4c9d63fa3d15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xykYSBmm7A0eGQ0hxGH9QA.png"/></div></div></figure><figure class="jo jp jq jr fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kp"><img src="../Images/cf06f4d0a5a222179cfae22db21c9e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d7yfMDZzlOHB4LEqZV4KEQ.png"/></div></div></figure></div></div>    
</body>
</html>