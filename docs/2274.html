<html>
<head>
<title>A Kaggle Competition: Allstate Claims Severity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一场卡格尔竞赛:好事达声称严重性</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/a-kaggle-competition-allstate-claims-severity-a32f4635c849?source=collection_archive---------8-----------------------#2021-04-29">https://medium.com/nerd-for-tech/a-kaggle-competition-allstate-claims-severity-a32f4635c849?source=collection_archive---------8-----------------------#2021-04-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/239b330457e61e99b755c93052d72b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/1*vsJehpDTJ4uMUdjAEUPlow.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">好事达标志</figcaption></figure><h1 id="4123" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">关于数据集</h1><p id="c387" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">好事达(Allstate)是一家美国保险公司，它在 2016 年 10 月组织了一次招聘 Kaggle 比赛。当时，好事达正在开发自动预测保险索赔成本的方法。</p><p id="47fa" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">给出了一个表格数据集，大约有 188k 行，每行代表一个保险索赔[ <a class="ae kr" href="https://www.kaggle.com/c/allstate-claims-severity" rel="noopener ugc nofollow" target="_blank"> Kaggle 数据集</a> ]。</p><h1 id="1876" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">商业目标</h1><p id="ca14" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">给定索赔记录的任务是尽可能准确地预测特定索赔的损失价值。</p><p id="8465" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">将商业问题映射到机器学习</strong></p><p id="5b08" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">好事达可能以两种方式面临损失:</p><ol class=""><li id="b62c" class="ks kt hi jq b jr km jv kn jz ku kd kv kh kw kl kx ky kz la bi translated">不向客户少收保费，以便在发生实际索赔时能够支付索赔金额。</li><li id="f10d" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">不向客户多收保费，让客户转投下一家保险公司。最终好事达会失去客户，这是潜在业务的损失。</li></ol><h2 id="5b20" class="lg ir hi bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt bi translated"><strong class="ak">绩效指标的选择</strong></h2><p id="8244" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">由于我们的任务是尽可能接近地预测损失值，我们将选择<em class="lu">平均绝对误差(MAE) </em>作为我们的性能指标。</p><p id="3f7f" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"><em class="lu">【MAE】</em></strong>=它是(实际值和预测值)之差的平均绝对值。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/f111e6ee3ae6b0600d76ba53bb68357e.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*Ql-3A30yABGMUIjPS718rg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">信用:<a class="ae kr" href="https://www.statisticshowto.com/absolute-error/" rel="noopener ugc nofollow" target="_blank">statisticshowto.com</a></figcaption></figure><h1 id="9f84" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">探索性数据分析</h1><p id="b57a" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在数据集中，我们有 116 个分类特征和 14 个连续值特征<br/>，在训练数据集中有 188318 条索赔记录，在测试数据集中有 125546 条索赔记录。对于测试记录，我们没有目标变量(损失)。</p><p id="5f26" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">整个数据集中没有缺失值。</p><p id="bc92" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是每个分类特征中类别数量的分布。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><figure class="lw lx ly lz fd ij er es paragraph-image"><div class="er es mc"><img src="../Images/b193742652b49b5df4e6231f337da8d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*y-oisGRGemjfecQnlNlNKA.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">类别数量的分类特征分布</figcaption></figure><p id="7f05" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">分类变量的分布有一个多数类，这可以从下面的饼图中看出</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es md"><img src="../Images/35a7b85fda14a45759be5a4ca24b1e6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_k-GE-kEA16h00WoG83Njw.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">分类特征之间的分布。</figcaption></figure><p id="7bfa" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">下面是目标类别(即损失)的分布，我们可以看到这是幂律分布，因此我们使用 Box-Cox 变换将其转换为正态分布。这种后期的改造，给了车型性能足够的提升。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mi"><img src="../Images/5417caf9ec56d9077513447091b00120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*28iDptx6wJZrFwfbOw737Q.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">将目标变量损失转换为正态分布。</figcaption></figure><p id="64f0" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">因为它们有许多特征，对每个特征进行分析是不合适的。所以选择了几个重要的特征。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mj"><img src="../Images/61911cfbff9b86e47e918f0f8bb56355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*atPJUbjkYHGJVdNJS-TFSA.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">80 类、79 类和 87 类箱线图</figcaption></figure><p id="2145" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于 cat80，如果一项索赔属于 A 类和 C 类，那么损失值不会高很多。并且 B 类与其他类相比具有更高的损耗。<br/>对于类别 79，同样，如果索赔属于 A 类和 C 类，则损失异常值比其他类小得多。D 类的损失高于其他类，B 类在中间值附近的偏差较小。<br/>对于 cat87，A 类的损耗小于其他类。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es mk"><img src="../Images/a0befab4035af0b234f627ada52b64b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BqXPCbf28IR3EjZWb1fc1A.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">第 10 类、第 12 类和第 57 类的箱线图</figcaption></figure><p id="8019" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于第 10 类，B 类比 A 类有更高的损失和更大的中值方差。<br/>对于第 12 类，B 类也比 A 类有更高的损失。B 类也有更多的方差。<br/>对于 cat57，A 类的中位数方差远小于 B 类。相比之下，B 类的损失更大。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es ml"><img src="../Images/27ae883f260955803594a2a5a7ede855.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_hpL048Xc3ooDKzbULtOw.png"/></div></div><figcaption class="im in et er es io ip bd b be z dx translated">7 类、81 类、89 类箱线图</figcaption></figure><p id="47da" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">对于第 7 类，B 类比 A 类具有更高的损失和更大的损失扩散。<br/>对于第 81 类，D 类和 A 类的大部分损失比 B 类和 c 类要小。<br/>或第 89 类，E 类和 G 类的损失很小，没有任何异常值。H 类的损耗明显高于其他类。</p><p id="8902" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj">连续特征的关联热图</strong></p><figure class="lw lx ly lz fd ij er es paragraph-image"><div class="er es mm"><img src="../Images/e6a41b4e940ca389556f4dcdfdacf631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*M70cgv4C4nkXM7ex8kAK4g.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated"><strong class="bd is">关联热图</strong></figcaption></figure><p id="7319" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated"><strong class="jq hj"> <em class="lu">观察:</em> </strong></p><p id="3812" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">特征之间非常强的相关性</p><ol class=""><li id="a03c" class="ks kt hi jq b jr km jv kn jz ku kd kv kh kw kl kx ky kz la bi translated">cont11 和 cont12</li><li id="a4fd" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">cont1 和 cont9</li></ol><p id="9887" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">也有一些负相关特征对</p><ol class=""><li id="cfb5" class="ks kt hi jq b jr km jv kn jz ku kd kv kh kw kl kx ky kz la bi translated">cont13 和 cont3</li><li id="a1d2" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">cont9 和 cont3</li><li id="48ed" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">控制 1 和控制 3</li></ol><h1 id="38ac" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">特征工程和编码</h1><p id="ef53" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">我尝试了各种方法来编码分类数据，如标签编码、一键编码。在一次热编码中，维数有了很大程度的增加。最后，基于字典顺序的编码<br/>产生了最高的性能增益。<br/>对于数字特征，应用了诸如 log1p、log2、平方、平方根的变换。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><h2 id="4e0c" class="lg ir hi bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt bi translated"><strong class="ak"> PCA:主成分分析</strong></h2><p id="7eaa" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">找出是否有任何组件比其他组件包含更多的差异。</p><pre class="lw lx ly lz fd mn mo mp mq aw mr bi"><span id="becd" class="lg ir hi mo b fi ms mt l mu mv">from sklearn.decomposition import PCA<br/>X_pca = np.hstack((X_con,X_cat))  <br/>pca = PCA(n_components=20)<br/>pca.fit(X_pca)<br/>print(pca.explained_variance_)<br/>print(pca.explained_variance_ratio_)</span><span id="f48a" class="lg ir hi mo b fi mw mt l mu mv"># output<br/>[2.35154011 2.0085094  1.33360039 1.07081709 0.93789653 0.85301854<br/> 0.78585513 0.73253702 0.57646378 0.52337216 0.50127435 0.47667501<br/> 0.4375088  0.42108877 0.39689408 0.32907901 0.31447881 0.30535877<br/> 0.28352583 0.26869016]<br/>[0.08142671 0.0695486  0.04617854 0.03707915 0.03247652 0.02953745<br/> 0.02721178 0.02536554 0.01996119 0.01812279 0.01735761 0.01650581<br/> 0.0151496  0.01458103 0.01374324 0.01139501 0.01088945 0.01057365<br/> 0.00981764 0.00930393]</span></pre><p id="dd90" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">我们可以看到前 2 个主成分的解释方差大于 2，前 4 个主成分只有方差大于 1。不存在具有大的解释方差的主成分。此外，最高的主成分在 20 个成分中具有 8.14%的方差。</p></div><div class="ab cl mx my gp mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="hb hc hd he hf"><h1 id="cba6" class="iq ir hi bd is it ne iv iw ix nf iz ja jb ng jd je jf nh jh ji jj ni jl jm jn bi translated">第 2 部分:建模</h1><h1 id="36e5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">1.基线模型</h1><p id="3f71" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">该模型将预测所有输入的中值。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><pre class="lw lx ly lz fd mn mo mp mq aw mr bi"><span id="6a7c" class="lg ir hi mo b fi ms mt l mu mv">Mean absolute error on test data for baseline mode 1796.9614807242938</span></pre><h1 id="8722" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">2.定制集成模型</h1><p id="b0ba" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">总的训练数据被分成两个数据集 D1 和 D2。D1 包含 D2 中 80%的训练数据，而包含 20%的训练数据，这是一个维持集，稍后将用于测试最终定制集合模型的性能。从 D1 集中，我们采样(替换)N 个不同的数据集，用于训练 N 个基本回归元(决策树)。使用 N 个基本模型的预测来训练元回归模型，该模型将预测我们对于一个数据点的最终损失。这个元模型的性能最终在 D2 数据集上进行了测试。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div class="er es nj"><img src="../Images/4ddf5df384dea78272e44db8b66327a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*KHyw_5QNJLY9VvRL02YTCw.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">自定义集合模型流程图</figcaption></figure><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div></figure><h1 id="01cc" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">模型比较</h1><p id="5053" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">在这里，我训练了 6 个模型，其中自定义集合模型的表现优于其他模型。我使用了一个决策树作为我的基础模型，并且使用定制的集合，性能比基础模型有了显著的提高。</p><figure class="lw lx ly lz fd ij"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="im in et er es io ip bd b be z dx translated">模型比较。</figcaption></figure><h1 id="a5e5" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Kaggle 提交结果</h1><p id="756b" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">提交材料是在 Kaggle 比赛结束后提交的。</p><figure class="lw lx ly lz fd ij er es paragraph-image"><div role="button" tabindex="0" class="me mf di mg bf mh"><div class="er es nk"><img src="../Images/ec9db3ce390f0679746f021d02dfab2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWeRK1PHNNceP_JIUf86mw.png"/></div></div></figure><p id="2070" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">取得了公分 1203，私分 1216.24 的成绩。</p><h1 id="8c59" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">未来的工作</h1><ol class=""><li id="d61b" class="ks kt hi jq b jr js jv jw jz nl kd nm kh nn kl kx ky kz la bi translated">尝试不同的堆叠架构并减少 MAE。</li><li id="ece8" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">包括不同的特征工程方式。</li><li id="afaf" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">使用 optuna 之类的库进行超参数调优。</li><li id="e657" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">神经网络可以试用。</li></ol><h1 id="fbf2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">参考</h1><ol class=""><li id="89f7" class="ks kt hi jq b jr js jv jw jz nl kd nm kh nn kl kx ky kz la bi translated"><a class="ae kr" href="https://www.appliedaicourse.com/course/11/Applied-Machine-learning-course" rel="noopener ugc nofollow" target="_blank">https://www . Applied ai course . com/course/11/Applied-Machine-learning-course</a></li><li id="eb9f" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated">【https://notendur.hi.is/heh89/Allstate_Claims_Severity.pdf T2】号</li><li id="805e" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated"><a class="ae kr" href="http://cs229.stanford.edu/proj2017/final-reports/5242012.pdf" rel="noopener ugc nofollow" target="_blank">http://cs 229 . Stanford . edu/proj 2017/final-reports/5242012 . pdf</a></li><li id="ceb8" class="ks kt hi jq b jr lb jv lc jz ld kd le kh lf kl kx ky kz la bi translated"><a class="ae kr" href="https://www.kaggle.com/sharmasanthosh/exploratory-study-on-ml-algorithms" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/sharmasanthosh/explorative-study-on-ml-algorithms</a></li></ol><h1 id="e932" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">代码库和部署。</h1><p id="6bcb" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><strong class="jq hj"> Github 仓库:</strong>包含了这个项目的全部代码。[ <a class="ae kr" href="https://github.com/tushifire/kaggle-allstate-project" rel="noopener ugc nofollow" target="_blank">好事达</a></p><p id="dd86" class="pw-post-body-paragraph jo jp hi jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl hb bi translated">试用该模型的网站:[ <a class="ae kr" href="https://allstate-claim-severity-kaggle.herokuapp.com/" rel="noopener ugc nofollow" target="_blank"> herokuapp </a> ]</p><h2 id="b7b1" class="lg ir hi bd is lh li lj iw lk ll lm ja jz ln lo je kd lp lq ji kh lr ls jm lt bi translated"><strong class="ak">联系人:</strong><a class="ae kr" href="https://www.linkedin.com/in/tushar-tiwari-8ab70548/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>| |<a class="ae kr" href="mailto:tushi.fire@gmail.com" rel="noopener ugc nofollow" target="_blank">邮箱</a></h2></div></div>    
</body>
</html>