<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/your-first-python-socketio-client-506b3c2e9187?source=collection_archive---------1-----------------------#2021-03-03">https://medium.com/nerd-for-tech/your-first-python-socketio-client-506b3c2e9187?source=collection_archive---------1-----------------------#2021-03-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><p id="8377" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">您的第一个 Python SocketIO 客户端</strong></p><figure class="ih ii ij ik fd il er es paragraph-image"><div role="button" tabindex="0" class="im in di io bf ip"><div class="er es ig"><img src="../Images/d6321823c8599255912e4d455b82b260.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_bD9woMZIVzpEC5O81FS6A.png"/></div></div></figure><p id="4789" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在 GO  中写了一个<a class="ae is" href="https://rahul-khanna.medium.com/your-first-golang-websocket-fx-data-fc1eb7db35f0" rel="noopener"> <strong class="hj if"> WebSocket 之后，我决定也提供一个 Python WebSocket 才公平。不过这个已经被 TraderMade <a class="ae is" href="https://tradermade.medium.com/python-websocket-tutorial-live-forex-rates-de8e6d78a75c" rel="noopener"> <strong class="hj if">这里</strong> </a>做了。所以我决定专注于 SocketIO。如果你正在寻找 Python REST API 或 SDK，请参见<a class="ae is" rel="noopener" href="/nerd-for-tech/python-sdk-for-forex-data-77e4ea728413">文章</a></strong></a></p><p id="2692" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">我不会用 Websocket 和 SocketIO 之间的区别来烦你，但是如果你感兴趣，这里有一篇详细的文章<a class="ae is" href="https://tradermade.com/data/streaming-examples" rel="noopener ugc nofollow" target="_blank"><strong class="hj if"/></a>。随着我们对教程的学习，您将会明白为什么 Socketio 是一个受欢迎的选择。</p><p id="3e23" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">为了简单起见，在我们继续之前，我们只使用客户端代码和推送外汇数据的实时 Socketio 服务器(在本例中为 TraderMade)。你为什么这么问？如果你刚开始，在深入研究这个主题之前，最好先从例子的某一方面着手。此外，它给出了一个实际使用的真实例子。</p><p id="f309" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">那么让我们开始吧</strong></p><p id="7fc6" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">获取插座键</strong></p><p id="f271" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">你首先需要一个 API 密匙从 Socketio 服务器获取实时外汇数据，你可以在 https://marketdata.tradermade.com/signup 注册并选择如下所示的 SocketIO 试用版。拿到钥匙后，请妥善保管。</p><figure class="ih ii ij ik fd il er es paragraph-image"><div role="button" tabindex="0" class="im in di io bf ip"><div class="er es it"><img src="../Images/8aa291c0a321eef7a8fb760b8d68de3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*frgyYs3ClxohhPWN.jpeg"/></div></div></figure><figure class="ih ii ij ik fd il er es paragraph-image"><div role="button" tabindex="0" class="im in di io bf ip"><div class="er es iu"><img src="../Images/1ab17f1990bc45216cb8346a3ee0c69a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5oVAOtaLSxkMFW_V8my_g.png"/></div></div></figure><p id="a5b9" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">设置代码</strong></p><p id="c46b" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">首先，安装要设置的密钥库</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="1892" class="ja jb hi iw b fi jc jd l je jf">python-engineio==3.14.2<br/>python-socketio==4.3.1</span></pre><p id="8330" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">您可能还需要其他的依赖项，但是上面两个需要准确无误，示例才能正常工作。</p><p id="539b" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">快速插座简介</strong></p><p id="4bfb" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在我们进一步讨论之前，先快速概括一下 Socketio 在 python 中实际上做了什么。</p><ol class=""><li id="496d" class="jg jh hi hj b hk hl ho hp hs ji hw jj ia jk ie jl jm jn jo bi translated">在 SocketIO 中，消息由客户端和服务器作为事件发送和接收。</li><li id="6899" class="jg jh hi hj b hk jp ho jq hs jr hw js ia jt ie jl jm jn jo bi translated">事件有助于双方在不冲突的情况下进行交流。</li></ol><p id="a822" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">好了，不需要担心第二点，随着我们对代码的研究，它会变得更加清晰。详细了解可以在这里阅读更多<a class="ae is" href="https://python-socketio.readthedocs.io/en/stable/client.html#installation" rel="noopener ugc nofollow" target="_blank"><strong class="hj if"/></a>。</p><p id="c2b9" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated"><strong class="hj if">客户端代码</strong></p><p id="b927" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">我们将逐一查看代码的每一部分。首先我们将导入 Socketio，然后创建一个名为“sio”的对象，如下所示。这将完成创建客户端并连接到 URL 的工作。</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="dd0e" class="ja jb hi iw b fi jc jd l je jf">import socketio<br/><br/># standard Python<br/>sio = socketio.Client()</span></pre><p id="038d" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">一旦我们有了对象，我们将设置一个事件来最初连接到 Socketio 服务器(TraderMade)。如下所示，我们可以设置一个具有 def connect()的事件，它将在我们连接到服务器时被调用。</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="c830" class="ja jb hi iw b fi jc jd l je jf">@sio.event<br/>def connect():<br/>    print("I'm connected!")<br/>    sio.emit('login', {'userKey': 'Your Streaming API Key'})<br/></span></pre><p id="f32b" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">在连接时，我们将在服务器上发出一个事件，在本例中是“登录”。因此，本质上，我们是以 JSON 格式发送用户密钥，这是我们之前在注册服务器时获得的，用来标识我们自己。</p><p id="610f" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">现在，有些事件正在监听某种信息，这一点已经变得更加清楚了。让我们看看接下来会发生什么。</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="3398" class="ja jb hi iw b fi jc jd l je jf">@sio.even<br/>def connect_error():<br/>    print("The connection failed!")<br/><br/>@sio.on('handshake')<br/>def on_message(data):<br/>    print('HandShake', data)<br/>    sio.emit('symbolSub', {'symbol': 'EURUSD'})<br/></span></pre><p id="8509" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">Connect_error 是不言自明的，所以让我们分析一下握手事件。所以握手是服务器(TraderMade)向其发出(send to)的事件。所以我们需要在 SocketIO 客户端代码中使用它，否则我们会错过通信链，永远得不到数据。</p><p id="73d0" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">现在，一些事件正在推动数据变得更加清晰。在收到握手时，我们将打印发送给我们的数据。</p><p id="10a4" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">从服务器接收</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="d6b1" class="ja jb hi iw b fi jc jd l je jf">Welcome to the TMS Data Feed</span></pre><p id="4458" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">现在我们可以要求外汇数据，但服务器如何知道我们想要什么。为此，我们将通过发出一个名为“symbolSub”的事件来订阅 Symbol，并且我们将从客户端发送{'symbol': 'EURUSD'}作为数据。</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="9818" class="ja jb hi iw b fi jc jd l je jf">@sio.on('price')<br/>def on_message(data):<br/>    print('Price Data ', data)</span><span id="6f4a" class="ja jb hi iw b fi ju jd l je jf">sio.connect('https://marketdata.tradermade.com')</span></pre><p id="1ed0" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">好了，现在我们来看看在上面的事件中发生了什么。一旦我们理解了代码，最终连接需要末尾的 URL。</p><p id="9bfc" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">瞧啊。我们正在获取带有时间戳的欧元兑美元的汇率。</p><p id="973c" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">从服务器接收</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="3d41" class="ja jb hi iw b fi jc jd l je jf">Price Data EURUSD 1.20543 1.20543 1.20543 20210303–14:27:59.496</span></pre><p id="5c83" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">这是完整的代码。</p><pre class="ih ii ij ik fd iv iw ix iy aw iz bi"><span id="91a7" class="ja jb hi iw b fi jc jd l je jf">import socketio<br/><br/># standard Python<br/>sio = socketio.Client()<br/><br/>@sio.event<br/>def connect():<br/>    print("I'm connected!")<br/>    sio.emit('login', {'userKey': 'streaming_api_key'})<br/><br/>@sio.event<br/>def connect_error():<br/>    print("The connection failed!")<br/><br/>@sio.event<br/>def message(data):<br/>    print('I received a message!')<br/><br/>@sio.on('handshake')<br/>def on_message(data):<br/>    print('HandShake', data)<br/>    sio.emit('symbolSub', {'symbol': 'USDJPY'})<br/>    sio.emit('symbolSub', {'symbol': 'GBPUSD'})<br/>    sio.emit('symbolSub', {'symbol': 'EURUSD'})<br/><br/>@sio.on('price')<br/>def on_message(data):<br/>    print('Price Data ', data)<br/><br/><br/>sio.connect('https://marketdata.tradermade.com')</span></pre><p id="af4e" class="pw-post-body-paragraph hg hh hi hj b hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie hb bi translated">希望这有所帮助。请留下您的意见和建议。我将在以后跟进一个服务器示例。</p></div></div>    
</body>
</html>