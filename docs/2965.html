<html>
<head>
<title>Action and Func Delegates</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">动作和功能委托</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/action-and-func-delegates-d60fe913e26c?source=collection_archive---------9-----------------------#2021-05-25">https://medium.com/nerd-for-tech/action-and-func-delegates-d60fe913e26c?source=collection_archive---------9-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1c43" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在下一篇文章中实现观察者模式和委托之前，本文将简要讨论它们。</p><p id="a509" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.microsoft.com/en-us/dotnet/standard/events/observer-design-pattern" rel="noopener ugc nofollow" target="_blank">观察者模式</a>在C#和Unity中很常见，尤其是在GUI(图形用户界面)和Unity事件系统中。该模式提供了一种对其他对象上的变化或事件做出反应的方式，而无需耦合到它们的类。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/39fa7967d0d15fd9996da4b392fefe8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1250/format:webp/1*_ZaM5Bw1TiGS-floXYOOIg.jpeg"/></div></div></figure><p id="7151" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代替接口，我们将使用委托来实现设计模式——特别是Action和Func委托类型。委托是保存对方法的引用的变量，用于事件和回调方法。委托引用的方法需要有匹配的数据类型。</p><p id="7397" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.microsoft.com/en-us/dotnet/api/system.action-1?view=net-5.0" rel="noopener ugc nofollow" target="_blank">一个动作委托</a>持有对一个方法的引用，该方法可以接受一个值，但不必也不返回值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/c0a18ae3220927528b484920668e115d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y2Ta6j8FfJbqe_EQ884ELw.png"/></div></div></figure><p id="7498" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae jd" href="https://docs.microsoft.com/en-us/dotnet/api/system.func-1?view=net-5.0" rel="noopener ugc nofollow" target="_blank">Func委托</a>就像一个动作，它保存了一个对方法的引用，该方法可以接受一个值，但它必须返回值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jr"><img src="../Images/f7b6350415acc72fbce3e15dcdbfab3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TM_QXmUHYUxafARNE5ygew.png"/></div></div></figure><p id="05af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">event关键字将委托锁定到该类，因此不能从任何其他脚本调用它，即使是那些从它继承的脚本。</p><p id="9004" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">向委托添加或注册方法时，您希望确保移除或注销该方法；如果不这样做，它会抛出一个错误。在Unity中，分别在OnEnable和OnDisable中注册和注销是很常见的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es js"><img src="../Images/9af6cee7da8104b81c2317952e658472.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6C07Kr6Ctm3Tl6QnRQKlpg.png"/></div></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="938d" class="ka kb hi bd kc kd ke kf kg kh ki kj kk iq kl km kn iu ko kp kq iy kr ks kt ku bi translated">示例:动作</h2><p id="fbb3" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在这个例子中，我们想在点击按钮时将立方体变成随机的颜色，但是我们不想将两个脚本结合在一起。所以我们将使用委托，因为我们不想要返回值，所以我们将使用动作委托。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es la"><img src="../Images/452cac3649e79d8515cd51a1d77c4f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YNJqUQRruaSmwji88X268A.gif"/></div></div></figure><p id="b540" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">菜单脚本是动作委托所在的地方，所以我们需要使用系统名称空间，并定义在使用Random时我们想要使用哪个Random。这个动作会将菜单脚本生成的随机颜色发送给任何正在收听OnButtonClick的人。当调用OnButtonClick时，我们使用三元运算符(？)来检查是否有人在听这个动作，如果有，我们调用或调用委托并传入随机颜色。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es js"><img src="../Images/823bc9d5759c55c3a903386108b275a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAY5IvL73Qb88-D9q_qeFg.png"/></div></div></figure><p id="1ae8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在多维数据集脚本中，我们创建了一个方法，该方法接受一个颜色参数，并将多维数据集设置为该颜色。然后，我们注册和取消注册菜单脚本的OnButtonClick操作，以侦听何时调用该操作。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jr"><img src="../Images/2e78c2dbad269cd8c0bc6c80f81c5042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Anvf17-m453q1O0ddrFJiA.png"/></div></div></figure><p id="9a54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每次点击按钮，立方体会变成随机的颜色。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lb"><img src="../Images/3360f05b1bce44d42bf6397fadbafc4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Up64URm-hhxvf359SOn0QA.gif"/></div></div></figure></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><h2 id="bc6f" class="ka kb hi bd kc kd ke kf kg kh ki kj kk iq kl km kn iu ko kp kq iy kr ks kt ku bi translated">示例:Func</h2><p id="39a9" class="pw-post-body-paragraph if ig hi ih b ii kv ik il im kw io ip iq kx is it iu ky iw ix iy kz ja jb jc hb bi translated">在这个例子中，我们希望立方体落在按钮click上，然后返回一个bool来告诉按钮它是否成功落下并禁用按钮。我们不想将这两个脚本结合在一起。所以我们将使用委托，但是因为我们想要返回值，所以我们需要使用Func委托。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es la"><img src="../Images/0c9204eacd975885e0e21f5cf3be52a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*PwfhlfWOTLIQcS0P2TioDw.gif"/></div></div></figure><p id="daed" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在菜单脚本中，我们现在将使用返回布尔值的Func委托来确定脚本是否应该停用按钮并将颜色更改为红色。当使用OnButtonClick时，我们检查任何侦听器，然后根据返回值更改按钮。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lc"><img src="../Images/09ef6548e5556c2b80c304805a0962c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G2gcZg6bzDqbhtBb_5zWHQ.png"/></div></div></figure><p id="596e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在立方体脚本中，我们将创建一个返回布尔值的方法，并通过添加一个Rigibody组件并启用gravity来使立方体下落。如果脚本成功添加了组件，返回值将为true，否则为false。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/449c5af06e07f5134cfb447f915d812a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y8wn-Tsq7Tcibo8IYKGgLQ.png"/></div></div></figure><p id="eae3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击按钮，立方体有一个刚体组件加入，开始下落；该按钮会变成红色并被禁用。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es la"><img src="../Images/ea61de89ad6224f9eee500ed94c96aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ojiVGQEEi1aNaDJRBDv3PA.gif"/></div></div></figure></div></div>    
</body>
</html>