<html>
<head>
<title>Let a Thousand Flowers Bloom</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让百花齐放</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/the-surprisingly-competitive-world-of-engineering-productivity-tooling-in-large-software-companies-f81ad308e81a?source=collection_archive---------3-----------------------#2021-06-30">https://medium.com/nerd-for-tech/the-surprisingly-competitive-world-of-engineering-productivity-tooling-in-large-software-companies-f81ad308e81a?source=collection_archive---------3-----------------------#2021-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9bf3" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">大型软件公司中工程生产力工具的竞争异常激烈</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/d3499a00dc6a776cd249b1608b1cf08a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*85n4R-y0PRxUKGQH.jpg"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">工具让您的工作更轻松！</figcaption></figure><p id="ca33" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在我24年的职业生涯中，大部分时间我都专注于<strong class="jp hj">工程生产力工具</strong>，也就是帮助软件开发人员提高效率和减少工作量的工具。特别是，我花了很多时间痴迷地思考如何简化软件测试。根据我在微软、亚马逊和谷歌的经验，这是对大型软件公司(5万到10万名软件工程师)如何运作的一种洞察。</p><p id="783c" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我在微软工作了11年，在亚马逊工作了11年，现在在谷歌工作。当你在这样的大型软件公司工作时，如果每个开发人员都做了一点点效率低下的事情，没有一个人会感到痛苦，但是当你后退一步，合计整个公司的成本时，它会复合到令人惊讶的程度。事情按比例增加，软件开发人员是极其昂贵的资源。此外还有机会成本——他们不仅浪费了时间，而且他们本可以利用这些时间创造一些令人惊叹的面向客户的功能，让世界变得更美好，并为公司赚取数百万美元。所以，在谷歌、亚马逊和微软，小事情是复合的。在其中一家公司，我做了一些计算，确定我们每年花费十亿美元测试我们的软件(是的，十亿美元加一个“b”)。我的整个职业生涯都围绕着用工具耐心地切割十亿美元的小块。</p><p id="6035" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">结合[a]在一个可以用工具解决小问题的环境中工作，以获得数百万美元的效率提升机会，和[b]在一个雇佣非常聪明和积极的人的公司中工作，你得到[c]工具扩散！</p><p id="dbb4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">随便找一家大型软件公司，随便找一个问题，我可以向你保证，现在有N个独立的、平行的努力来解决它。一切都是善意的。有人会成功，有人会失败。有些是资助的。有些只是一个工程师在周末和晚上做。有些人会竞争。有些会相交。有些人会合作。大多数人都懒得和空间里的其他人说话。在这些工具的背后，有相当一部分人将该工具视为他们晋升的途径，因此是一件需要积极捍卫的事情。真是一团糟。</p><p id="b33d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当你拥有一个工程生产力工具时，它归结为:要么你<em class="kj">合作</em>(你创造了一个整体大于部分之和的生态系统)，要么你<em class="kj">竞争</em>(因为你竞争有限数量的开发者来采用你的工具，这是一个零和游戏)。随着我<a class="ae kk" href="https://carloarg02.medium.com/how-i-grew-an-engineering-productivity-tool-to-impact-thousands-of-engineers-at-amazon-and-how-28a990091207" rel="noopener"> <strong class="jp hj"> <em class="kj">的创建和成长，我不得不在这个混乱中导航，这成为了亚马逊(TPS generator)</em></strong></a><strong class="jp hj"><em class="kj">的内部负载和性能测试。我有一个关于合作和竞争的故事来说明这一点。</em></strong></p><h1 id="a3b6" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated"><strong class="ak">一个关于<em class="ld">协作</em>的故事</strong></h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es le"><img src="../Images/f0e55ad35362f0a6afc47cfc74328fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*7DTFbuVV52XS0WN8.jpg"/></div></figure><p id="4545" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Amazon有一个名为Coral的内部服务框架，许多工程师使用它来创建他们的服务(这不是一个大秘密，在网上搜索“com.amazon.coral ”,您会看到许多使用它的服务的堆栈跟踪！).Coral抽象了许多服务创建、请求/回复数据编码、日志、度量、节流、警报等的样板文件。当您创建一个全新的服务时，您可以使用Coral，这样所有的东西都会自动为您处理。你不必使用珊瑚，但如果你这样做，你的生活通常会更容易。</p><p id="6f94" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">当我在2013年创建我的负载测试框架(“TPSGenerator”)的第一个版本时，我正在使用非Coral服务，所以我专注于创建一个可以为任何web服务工作的通用东西。我后来发现，Coral团队本身也在努力提供一个工具，供Coral客户用于负载测试(“Colony”)。两者都非常类似于JMeter或其他负载生成器。</p><p id="5b0f" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">所以我处在一个尴尬的位置:我有一个工具，对珊瑚和非珊瑚都有效。但是有一种竞争的努力对珊瑚更有效。两个工具都应该活下去吗？我不认为我应该停止我正在做的事情，因为有很多非珊瑚服务可以从中受益，而Colony永远不会帮助他们。我也不认为Coral团队应该停止他们正在做的事情，因为他们的功能客观上更适合Coral服务。我和他们团队的首席工程师喝了一杯友好的咖啡，我们聊了聊这个。我们有很多共同点，但不太清楚如何合并，所以我们暂时就空间的划分达成一致，建议将TPSGenerator用于非Coral服务，将Colony用于Coral服务。</p><p id="4809" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我的客户开始要求能够生成非常大的负载，每秒数百万次交易。当时，TPSGenerator和CoralColony都是单主机解决方案。您可以轻松地从单个主机中获得每秒十万个事务(TPS ),这对于测试一个临时环境来说已经足够了。如果您想通过ssh获得更大的负载，您可以在多个主机中启动TPSGenerator或CoralColony，但是当您谈论非常大的负载时，这是很麻烦的，而且容易出错。因此，我创造了一种在多主机模式下运行TPSGenerator的方法，在这种模式下，潜在的数千台主机可以协调应用数百万TPS的负载(<a class="ae kk" href="https://patents.google.com/patent/US9507681B2/en" rel="noopener ugc nofollow" target="_blank">专利</a>)，并及时推出该功能，供我的客户使用，以确保Amazon.com为黑色星期五和网络星期一的高峰流量做好准备。这让我在殖民地的处境更加尴尬。我的工具现在有了一个杀手级的特性，这也是使用Coral的工程师们想要的。</p><p id="c0be" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让整个事情更加尴尬的是，Colony和TPSGenerator是在同一个主管之下。因此，每个月我都要回答一个问题“为什么我们要资助同一个主任领导下的两个相互竞争的项目？”越来越难回答了。</p><p id="7166" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">整件事让我很困扰。我喜欢并尊重来自殖民地的工程师。然而，我觉得我们正处在一个意想不到的碰撞过程中。我和他们都不打算退出。我们还能找到一种方法来联合起来，创造一个双赢的局面吗？我花了3天时间钻研他们的源代码。我阅读、调试并理解了五千行代码中的每一行。我又见到了他们的首席工程师。我认为我能够证明我已经花时间阅读了他的整个代码库，并真诚地思考我们如何才能集成，这一事实赢得了他的信任。我们拿着咖啡、一间空的会议室和一块白板，疯狂地画出一盒又一盒的Java类，以及它们如何相互交流。我们以一条良好的前进道路结束了那次会议。TPSGenerator要去前端工具，入口点。但在引擎盖下，它将运行殖民地类。这就是我们所期待的双赢。我们能够联合为Coral客户提供他们所习惯的所有Coral特有的产品，但同时拥有TPSGenerator坚如磐石的高吞吐量。最终，作为独立产品的Colony消亡了，但是Colony功能(和Java类)在TPSGenerator中继续存在。</p><p id="68b6" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我还确保多次给他的经理发电子邮件，尤其是在评估期间，以确保他得到认可。很多人认为他们需要创造自己的工具来获得提升或成功。将工具结合起来做更大的事情，并与多个利益相关者协商界限，有很多价值——这也应该得到同样的认可和补偿。我们把自我放在一边，专注于为客户做正确的事情。</p><h1 id="bf38" class="kl km hi bd kn ko kp kq kr ks kt ku kv io kw ip kx ir ky is kz iu la iv lb lc bi translated"><strong class="ak">一个关于竞争的故事</strong></h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lf"><img src="../Images/39d4417f30bdd073a32fc9689264fa1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*q1bp_6qeLZNhnZH3.jpg"/></div></figure><p id="ba02" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我在亚马逊做了十年的负载和性能测试专家，咨询了数百个团队，建立了公司范围的标准。有两种基本方法可以对产品进行负载测试。最常见的方法是您可以创建一个负载生成器，它执行假装为真实流量的合成事务。然后，您可以使用这个合成流量来增加测试环境中的流量(有时甚至是生产环境中的流量！)并观察额外负载如何影响资源消耗、延迟等。这就是TPSGenerator所做的，以及JMeter等外部行业标准工具所做的。但是还有另一种方法可以达到类似的效果，这种方法很聪明也很优雅，但是也有一些缺点。你可以<em class="kj">减少</em>交通流量，避免必须创建一个负载生成器。降档通过调整负载平衡器的重量来实现。标准的web服务在一个负载均衡器后面可以有数千个主机，负载均衡器的工作是确保负载均匀分布。假设您在一个负载均衡器后面有4台主机；负载均衡器将把25%的流量分配给每台主机(对于本文来说，这是一个很大的简化)。您可以调整负载平衡器中的算法，使四台主机中的一台获得40%的流量，其他三台获得20%的流量。这允许您观察一台主机与其他主机相比，如何应对双倍的负载。</p><p id="2ae7" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这种降档的想法是如此的简单，如此的美好。很优雅。首先，您不需要编写负载生成器。毫不夸张地说，您可以在2秒钟内通过负载均衡器调整来重新路由现有的生产流量。它不仅节省了开发人员编写负载生成器的工作量，还保证了事务具有生产保真度(因为您使用的是生产事务)。对于运行合成负载的更经典的方式，一个显著的风险是您的合成流量将不会正确地模拟生产流量。最后，因为您只是转移了当前的流量，而没有产生额外的流量，所以不会增加依赖项的负载。对于运行合成负载的更经典的方式，您需要将任何重要的测试与您的依赖项协调起来，因为您也将增加它们的吞吐量。所以降档有很多让人喜欢的地方。</p><p id="4c79" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">问题是，降低流量作为一种产品负载测试的方式，有很大的缺陷。您看到的是一台主机如何处理流量的增加，并且有一个潜在的假设，即如果您了解一台主机如何扩展，您就会了解N台主机如何扩展。这太天真了。我断言，当您观察到成千上万的主机与成千上万的主机交互时，高吞吐量、高度分布式系统中最有趣的故障就会出现。仅仅测试一台主机如何在亚马逊、微软或谷歌这样的公司中扩展是非常懒惰的，你的工程师应该渴望做得更好。事情线性扩展，直到他们没有。降档狭隘地孤立地看待一个主机，给你一种错误的安全感。还有其他瑕疵。当您将实际生产流量转移到一台主机时，该主机将开始不堪重负，这些事务将开始经历更长的延迟和更多的错误率。嘿！这些是真实的生产客户，你给他们带来了不便。因为您使用的是真实的生产客户，所以您永远无法真正测试到它的临界点，但是另一方面，使用负载生成器，您可以将它指向一个登台环境并增加负载，直到登台环境爬行并死亡。而且你可以看着它死去，详细分析死亡的原因。当你降低交通流量时，你永远不会对你的系统有这样的洞察力。你永远无法建立一个理论情景的模型(“如果我的写作翻倍会发生什么？”)，您只能测试当前的流量模式。使用合成流量，您可以随心所欲地模拟理论流量模式。并不是每个服务都有负载均衡器(大多数批处理或异步服务都没有)，所以降级并不是一个普遍适用于整个公司的通用方法。最后，当你从一个负载均衡器上弄乱算法时，事情可能会简单地出错(而且它们确实出错了好几次，相当惊人)。</p><p id="87ff" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">底线是，为了负载测试的目的而降级表面上看起来简单优雅，但如果你深入研究并运用批判性思维，这真的不是一个好主意。但因为它表面上看起来如此优雅，有时人们不会花一分钟来意识到它的缺陷。在我的职业生涯中，我已经在多家公司看到过四次让生活降下来的尝试。每一次，这个人都相信自己一手发明了一个令人惊奇的东西，并且故意对过去一无所知。</p><p id="4b77" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">有个人决定创造另一种降档工具。我和他一起喝了些咖啡，并耐心地解释为什么这是个坏主意，以及为什么之前的许多尝试都失败了。他微笑着点点头，表示认可，并在我们聊天后立即在全公司范围内加倍宣传这款工具。这是相当被动的攻击。接下来的一个月，在一个工具展览会上，他制作了一个巨大的表格，展示了我的工具TPSGenerator和他的工具的对比。该表具有误导性，提供了一个非常有选择性的、狭隘的事实。那也感觉相当被动-侵略性。在制作这张桌子时没有人和我商量。</p><p id="9106" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我再次面临选择:竞争还是合作？这两种方法之间根本没有共同点。生成合成负载和降级是思考负载测试的两种截然相反的方式。我能做的最好的事情就是为工程师创造一个单一的事实来源，让他们决定哪一个最适合他们的场景，并给他们选择的自由。</p><p id="7ac4" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我礼貌地给他发了封电子邮件，对他在表格中提出的一些比较点进行了澄清。他无视我的邮件。然后，我开始自己创建一个更客观、更全面的表格。为了消除主观性，我和身边的十名首席工程师一起对它进行了审核。然后我给他发了一封电子邮件，询问他我们是否可以就一个比较表达成一致，并从我们两个工具的文档站点链接到这个比较表。他再次无视我的电子邮件。我通过和他导演抢咖啡升级，得到了想要的效果。他反对我桌子上的一些东西，我们谈判了一会儿，最后我们同意了一个单一的事实来源，双方都同意。我们显然都有强烈的不同意见，但我们在相互尊重和为亚马逊整体做正确事情的愿望的基础上达成了共识。</p><p id="aff3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">你不能总是让人们与你合作。但是，当您的文档声称您的工具很棒，而他们的文档声称他们的工具很棒时，这为成千上万需要完成某项任务的工程师创造了一个混乱的生态系统，他们现在不得不花费数小时来找出哪种工具最适合他们的情况。尊重你的顾客。</p><p id="71f3" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我选择走这条路的原因不是因为我觉得降档是一个严重的“竞争对手”——毕竟，TPSGenerator处理的流量要多1000倍。但是我真的觉得放慢生活节奏对公司来说是错误的，亚马逊的领导原则之一就是所有权。作为公司的所有者，当有东西坏了时，你应该采取行动，即使它不在你的直接控制范围内。我没有权力否决另一个项目，但有时，你能做的最好的事情就是同意一个官方的、单一的客观事实来源，让你的客户来决定。工程师是聪明的，给定适当的数据，他们会做出正确的决定。</p></div></div>    
</body>
</html>