<html>
<head>
<title>Face Similarity Using Azure API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Azure API 的人脸相似度</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/face-similarity-using-azure-api-a918efab366d?source=collection_archive---------4-----------------------#2021-10-19">https://medium.com/nerd-for-tech/face-similarity-using-azure-api-a918efab366d?source=collection_archive---------4-----------------------#2021-10-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="286c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将考虑使用 Azure API 的人脸相似性的样本应用程序。</p><h2 id="ed34" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">很久以前…</h2><p id="201f" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">我曾经是。NET 开发人员很久以前。老实说，考虑到那是大约 10 年前的事情，MS Visual Studio 给我的印象比 Xcode 好得多。令我惊喜的是，我有机会使用微软 Azure Cognitive API 进行人脸相似度测试。</p><p id="2738" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">从字面上来说，我们将使用<strong class="ih hj">检测</strong>和<strong class="ih hj">验证</strong>休息方法:</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div class="er es kd"><img src="../Images/8098427123341854a89b61011e86f8b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*vA-B0okcLqFTfpjNtQvQnA.png"/></div><figcaption class="kl km et er es kn ko bd b be z dx translated">Face API</figcaption></figure><p id="1c68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kp" href="https://azure.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank">蔚蓝</a>提供一年试用期。只需提供一些信用卡，你会得到每月 20K 请求，每天 20。足够审判的费用..</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kq"><img src="../Images/2daba3c316f6659d22f8db8b5516979f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3Cli7ZusAU7cEs84yZC9Hw.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">Azure 菜单</figcaption></figure><p id="43f1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以在创建资源、选择主机之后测试 API。(点击 API 控制台)。</p><p id="c106" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">只是不要忘记提供密钥，更准确地说是<em class="kv">Ocp-Apim-Subscription-Key。</em></p><h2 id="3f8f" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">共同点:</h2><p id="1166" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">首先我们调用<strong class="ih hj"> Detect </strong>方法，它在提供的图像中检测人脸并返回给我们 IDs &amp;一些特征。然后我们用 id 调用<strong class="ih hj">验证</strong>方法。标识符(id)保存在一天后到期的会话的后端。</p><p id="ed68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了减少流量，因为 azure 有一些大小限制(如果我没有弄错的话，大约在 3MB 附近)，我将图像转换为<strong class="ih hj">灰度</strong> &amp;试图缩小它的大小，使其大约为<strong class="ih hj"> 300KB </strong>。</p><p id="f9df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看<a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample/blob/main/FaceMatch/Services/ImageProcessor.swift" rel="noopener ugc nofollow" target="_blank">图像处理器</a>。“灰度”是由单色环境完成的:</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kw"><img src="../Images/e60a7ecad088503c589fa7579d937946.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8nRepO1zck2SoD2UthSmXQ.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">单色背景</figcaption></figure><p id="d226" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">CoreImage 被用作人脸特征检测器，只是为了比较 Azure &amp; CIDetector 返回的情绪，并在前端验证任何图片，以避免浪费 API 调用。看看 GitHub 上服务文件夹下的<a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample/blob/main/FaceMatch/Services/FaceFeaturesDetector.swift" rel="noopener ugc nofollow" target="_blank"> FaceFeaturesDetector </a>:</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kx"><img src="../Images/194fa5e4c563d10dc6405d4c923e51ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Urk1bhDZkSUvC4R_Xcg9TA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">CIDetector 配置</figcaption></figure><p id="a860" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">面部检测精度可能很高，最大特征数为 10。</p><h2 id="aec2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">建筑:</h2><p id="84fd" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">这个例子只有一个屏幕(两个按钮&amp;总是“启用”复选框)，我可以说这是 MVVM+协调员。MVVM(因为<strong class="ih hj"> SwiftUI </strong>)。仅用于呈现 UIImagePickerController 和创建根 ViewController 的协调器(AppCoordinator):</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es ky"><img src="../Images/2388dcc5cf6ef00232653da461071a62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCYt13ZBPo1S8OGBCXcrOg.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">根协调员</figcaption></figure><p id="aa99" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我更喜欢使视图被动，因此将功能委托给视图模型。</p><h2 id="b9a4" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">型号:</h2><p id="b31e" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">在示例 app api 中，错误由<a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample/blob/main/FaceMatch/Models/Azure/AzureError.swift" rel="noopener ugc nofollow" target="_blank"><strong class="ih hj">azure error</strong></a><strong class="ih hj">:</strong>表示</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es kz"><img src="../Images/04e55ea27df32ad58bef805e87154fdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GL62G5CNePRJBUb4dfSbHg.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">Azure 错误表示</figcaption></figure><p id="54fa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了处理所有错误情况，创建了适当的包装器(enum <a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample/blob/main/FaceMatch/Models/HTTPError.swift" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> HTTPError </strong> </a>):</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es la"><img src="../Images/8ef2cf4f874921ab4d3f6e6d7990455c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaJjVh8Nm48mqhxCucvycg.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">HTTPError 枚举</figcaption></figure><h2 id="39a2" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">Azure JSONs:</h2><p id="9a4a" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">代表 API 响应的模型由适当的<a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample/blob/main/FaceMatch/Models/Azure/CognitiServiceModels.swift" rel="noopener ugc nofollow" target="_blank">实体</a>表示</p><figure class="ke kf kg kh fd ki er es paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="er es lb"><img src="../Images/a28f776a20d685a57ffe1ab09992d0d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EYN48icqD6gbsh_oY-tVvw.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">响应实体</figcaption></figure><p id="0967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">例如，FaceModel 表示人脸的信息(在我们的例子中是矩形和情感)。</p><h2 id="39df" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">检测:</h2><p id="ee51" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">此外，具有二进制正文数据的方法接受 URL 查询参数:</p><pre class="ke kf kg kh fd lc ld le lf aw lg bi"><span id="1f19" class="jd je hi ld b fi lh li l lj lk"><strong class="ld hj">let</strong> queryItems: [String: <strong class="ld hj">Any</strong>] = ["returnFaceId": <strong class="ld hj">true</strong>,<br/>"returnFaceLandmarks": <strong class="ld hj">false</strong>,<br/>"recognitionModel": "recognition_02",<br/>"returnFaceAttributes": "emotion",<br/>"returnRecognitionModel": <strong class="ld hj">false</strong>,<br/>"detectionModel": "detection_01"]</span></pre><p id="bae7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有不同的识别和检测模型(如果参数错误，您将得到一个错误)。我们也探测情感:恐惧，或者快乐..</p><h2 id="acc6" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">识别:</h2><p id="2f11" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">该方法接收 face1 &amp; face2 IDs 并返回概率(0…1)。代码在<a class="ae kp" href="https://github.com/yakushevichsv/FaceMatchSample" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p></div><div class="ab cl ll lm gp ln" role="separator"><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq lr"/><span class="lo bw bk lp lq"/></div><div class="hb hc hd he hf"><p id="dd87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个模型(识别 _01，检测 _01)在样本图像和我的照片上很好地检测到了 6 年的差异。然而<a class="ae kp" href="https://www.yaplakal.com/forum2/topic2136203.html" rel="noopener ugc nofollow" target="_blank">参战男子的照片</a>被认定为相同的概率很低(0.4)。嗯，但这对于神经网络来说是一个“异常值”。这对于一个人的生活和外表来说确实是巨大的改变。</p></div></div>    
</body>
</html>