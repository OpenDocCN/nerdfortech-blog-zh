<html>
<head>
<title>Spring boot series — Creating a Web Socket to send real time market data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring boot 系列—创建一个 Web 套接字来发送实时市场数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/spring-boot-series-creating-a-web-socket-to-send-real-time-market-data-ee5273b3204b?source=collection_archive---------6-----------------------#2021-06-10">https://medium.com/nerd-for-tech/spring-boot-series-creating-a-web-socket-to-send-real-time-market-data-ee5273b3204b?source=collection_archive---------6-----------------------#2021-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/3e86835f3ba3cc3ee5f89e0de927dac6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*CjbHL_i7alkQ2Eh9dPPuHA.png"/></div></figure><p id="8254" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嗨，伙计们，我们已经完成了创建一个很酷的股票市场应用程序，它用一组符号显示真实的股票市场信息。在本教程中，我们将看到如何使用 web 套接字将实时股票市场数据发送到前端。</p><p id="4b9a" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">为了创建 web 套接字，首先我们必须向 build.gradle 文件添加一些依赖项。所以在添加了 web socket 依赖项之后，现在我们的 build.gradle 文件的依赖项应该是这样的。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="fd55" class="jt ju hi jp b fi jv jw l jx jy">dependencies <strong class="jp hj">{<br/>   </strong>implementation 'org.springframework.boot:spring-boot-starter'<br/>   implementation 'org.springframework.boot:spring-boot-starter-websocket'<br/>   implementation 'com.yahoofinance-api:YahooFinanceAPI:3.15.0'<br/>   implementation 'org.projectlombok:lombok'<br/>   testImplementation 'org.apache.httpcomponents:httpclient'<br/>   testImplementation 'org.springframework.boot:spring-boot-starter-test'<br/><strong class="jp hj">}</strong></span></pre><p id="dbb3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">到目前为止，关于该项目的代码和细节可以找到，如果你访问本教程。</p><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/flutter-series-connecting-ui-to-spring-boot-backend-f9874dc3dcd5" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">Flutter 系列—将 UI 连接到 spring boot 后端</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">嗨，伙计们，这是股市应用程序创建教程的最后一个教程。将来如果可能的话，我会努力…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div><div class="kl l"><div class="km l kn ko kp kl kq ik kc"/></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/flutter-series-implementing-stock-market-watch-list-ui-dccd37a9ef34" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">Flutter 系列—实现股票市场观察列表 UI</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">嗨伙计们。在上一个教程中，我告诉你们，我们将使用 Flutter 来创建一个前端应用程序，以便…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div><div class="kl l"><div class="kr l kn ko kp kl kq ik kc"/></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/flutter-series-creating-the-first-flutter-application-793e5816f816" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">颤振系列——创造第一个颤振应用</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">嗨伙计们。所以在我们的系列教程中，现在你应该已经创建了一个 spring boot 应用程序，它有一个获取股票的端点…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div><div class="kl l"><div class="ks l kn ko kp kl kq ik kc"/></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/spring-boot-series-sending-stock-market-data-in-json-form-cce978a9a90d" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">Spring boot 系列—以 JSON 形式发送股票市场数据</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">嗨伙计们。因此，我们创建了股票数据服务来获取单只股票的数据，在本教程中，我将…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/spring-boot-series-unit-testing-basics-3ce566250465" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">弹簧靴系列—单元测试基础</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">嗨伙计们。所以到目前为止，我们已经开发了一个基本的 spring boot 应用程序，它从 Yahoo finance API 获取数据并显示…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div><div class="kl l"><div class="kt l kn ko kp kl kq ik kc"/></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/spring-boot-series-stock-market-data-end-point-356592487254" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">春靴系列—股市数据终点</h2><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div></div></a></div><div class="jz ka ez fb kb kc"><a href="https://billa-code.medium.com/create-the-first-spring-boot-app-4e930d812a22" rel="noopener follow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">创建第一个春季启动应用程序</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">我不打算深入了解许多功能和描述，而只是深入了解 Spring boot 的世界…</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">billa-code.medium.com</p></div></div><div class="kl l"><div class="ku l kn ko kp kl kq ik kc"/></div></div></a></div><p id="567b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在我们必须创建一个 web 套接字消息配置器来配置我们的 Web 套接字端点。因此，我将创建 web 套接字作为“/ws-message”，然后对于应用程序前缀，我将使用值“/app”。此外，我还将创建一个名为“/topic”的目的地前缀。现在，文件 WebSocketMessageConfig.java 的代码应该是这样的。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="8f00" class="jt ju hi jp b fi jv jw l jx jy">import org.springframework.context.annotation.Configuration;<br/>import org.springframework.messaging.simp.config.MessageBrokerRegistry;<br/>import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;<br/>import org.springframework.web.socket.config.annotation.StompEndpointRegistry;<br/>import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;<br/><br/>@Configuration<br/>@EnableWebSocketMessageBroker<br/>public class WebSocketMessageConfig implements WebSocketMessageBrokerConfigurer {<br/>    @Override<br/>    public void registerStompEndpoints(StompEndpointRegistry registry) {<br/>        registry.addEndpoint("/ws-message").setAllowedOriginPatterns("*").withSockJS();<br/>    }<br/><br/>    @Override<br/>    public void configureMessageBroker(MessageBrokerRegistry registry) {<br/>        registry.setApplicationDestinationPrefixes("/app");<br/>        registry.enableSimpleBroker("/topic");<br/>    }<br/>}</span></pre><p id="9886" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里，我们使用了 withStockJs()方法，所以将来当我们使用我们的 Flutter 应用程序访问它时，它将很容易处理。现在我将创建另一个文件作为套接字连接的控制器，并将其命名为 SocketController.java。在这里，我将创建一个调度程序，定期发送我们的市场数据。所以代码如下。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="5ac3" class="jt ju hi jp b fi jv jw l jx jy">import com.billa.code.stockMarket.service.StockService;<br/>import org.springframework.beans.factory.annotation.Autowired;<br/>import org.springframework.messaging.handler.annotation.MessageMapping;<br/>import org.springframework.messaging.simp.SimpMessagingTemplate;<br/>import org.springframework.stereotype.Controller;<br/>import java.util.concurrent.Executors;<br/>import java.util.concurrent.ScheduledExecutorService;<br/><br/>import static java.util.concurrent.TimeUnit.<em class="kv">SECONDS</em>;<br/><br/>@Controller<br/>public class SocketController {<br/>    @Autowired<br/>    SimpMessagingTemplate template;<br/><br/>    @Autowired<br/>    StockService stockService;<br/><br/>    private static final ScheduledExecutorService <em class="kv">scheduler </em>= Executors.<em class="kv">newScheduledThreadPool</em>(10);<br/><br/>    @MessageMapping("/hello")<br/>    public void greeting() {<br/>        <em class="kv">scheduler</em>.scheduleAtFixedRate(() -&gt; {<br/>            template.convertAndSend("/topic/message", stockService.getStockResponse());<br/>        }, 0, 2, <em class="kv">SECONDS</em>);<br/>    }<br/>}</span></pre><p id="21eb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里，我在我们的股票服务类中添加了一个名为 getStockResponse 的新方法，因此修改后的 StockService.java 的代码如下所示。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="bc9c" class="jt ju hi jp b fi jv jw l jx jy">import com.billa.code.stockMarket.model.StockModel;<br/>import com.billa.code.stockMarket.model.StockResponseModel;<br/>import com.billa.code.stockMarket.wrapper.StockWrapper;<br/>import org.springframework.stereotype.Service;<br/>import yahoofinance.Stock;<br/>import yahoofinance.YahooFinance;<br/>import java.util.ArrayList;<br/>import java.util.List;<br/><br/>@Service<br/>public class StockService {<br/>    public StockWrapper findStock(String symbol) {<br/>        try {<br/>            return new StockWrapper(YahooFinance.<em class="kv">get</em>(symbol));<br/>        } catch (Exception e) {<br/>            System.<em class="kv">out</em>.println(e.getMessage());<br/>        }<br/><br/>        return null;<br/>    }<br/><br/>    public StockResponseModel getStockResponse() {<br/>        List&lt;StockModel&gt; stocks = new ArrayList&lt;&gt;();<br/>        String[] symbolArr = {"A", "AA", "AAC", "GOOG", "AMZN", "AAT", "AAN", "T", "TD", "TARO", "TM"};<br/><br/>        for (String s : symbolArr) {<br/>            Stock stock = findStock(s).getStock();<br/>            StockModel stockModel = new StockModel(s, stock.getName(), stock.getQuote().getAsk().toString(), stock.getQuote().getChangeInPercent().toString());<br/>            stocks.add(stockModel);<br/>        }<br/><br/>        StockResponseModel res = new StockResponseModel();<br/>        res.setStock(stocks);<br/>        res.setStockExg("US");<br/><br/>        return res;<br/>    }<br/>}</span></pre><p id="dbe6" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以逻辑是这样的。使用 StockJS 的前端应用程序可以在<strong class="io hj"><em class="kv">ws://localhost:8080/ws-message 上创建到我们的 web 套接字的连接。</em> </strong> <em class="kv"> </em>现在它将连接到我们的 web socket，在连接创建方法的回调函数的前端应用程序中，我们必须订阅我们的 web socket 的<strong class="io hj"> /topic/message </strong>目的地。然后，当我们从我们的前端应用程序向我们的 web 套接字的<strong class="io hj"> /app/hello </strong>端点发送消息时，后端应用程序将通过 web 套接字每 2 秒钟向前端发送一次市场数据。</p><p id="450c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这个项目的家伙代码基础是在以下链接。分叉的项目，请启动它，如果你觉得有用。在 Github 上关注我，你会收到我新的酷项目的通知。</p><div class="jz ka ez fb kb kc"><a href="https://github.com/debilla-academy/yahoo-stock-backend" rel="noopener  ugc nofollow" target="_blank"><div class="kd ab dw"><div class="ke ab kf cl cj kg"><h2 class="bd hj fi z dy kh ea eb ki ed ef hh bi translated">debilla-学院/雅虎-股票-后端</h2><div class="kj l"><h3 class="bd b fi z dy kh ea eb ki ed ef dx translated">在 GitHub 上创建一个帐户，为 debilla-academy/Yahoo-stock-back end 开发做贡献。</h3></div><div class="kk l"><p class="bd b fp z dy kh ea eb ki ed ef dx translated">github.com</p></div></div><div class="kl l"><div class="kw l kn ko kp kl kq ik kc"/></div></div></a></div><p id="b671" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，在下一个教程中，我们将从 web socket 获取数据，并将其显示在我们的 Flutter 应用程序中。编码快乐！！！</p></div></div>    
</body>
</html>