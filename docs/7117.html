<html>
<head>
<title>Redefining service mesh with Cilium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用纤毛重新定义服务网格</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/redefining-service-mesh-with-cilium-4738cdfb9899?source=collection_archive---------0-----------------------#2022-07-31">https://medium.com/nerd-for-tech/redefining-service-mesh-with-cilium-4738cdfb9899?source=collection_archive---------0-----------------------#2022-07-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="0fe9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能听说过 CNI 世界的纤毛。你还会发现它坐落在 CNCF 风景中的其他 CNI 之中。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/3b3d595c99b8ab60e47c1d0920c6ef9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Ctu_ijKJXXSuaujJXioxw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:https://landscape.cncf.io/</figcaption></figure><p id="9fa4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是，现在还有更多。它已经演变成一个服务网，只是与你过去看到的有些不同。在我们开始之前，如果您对服务网格完全陌生，我建议您访问我以前的博客，了解什么是基本的服务网格</p><div class="ju jv ez fb jw jx"><a href="https://levelup.gitconnected.com/untangling-the-service-mesh-24797e29eb92" rel="noopener  ugc nofollow" target="_blank"><div class="jy ab dw"><div class="jz ab ka cl cj kb"><h2 class="bd hj fi z dy kc ea eb kd ed ef hh bi translated">解开服务网格</h2><div class="ke l"><h3 class="bd b fi z dy kc ea eb kd ed ef dx translated">简化服务网格，以便您能够为您的架构做出正确的网络决策</h3></div><div class="kf l"><p class="bd b fp z dy kc ea eb kd ed ef dx translated">levelup.gitconnected.com</p></div></div><div class="kg l"><div class="kh l ki kj kk kg kl jn jx"/></div></div></a></div><h2 id="5776" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">那么这次有什么不同呢？</h2><p id="dcff" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">我们习惯于为网格提供服务，这些网格在您的应用程序 pod 旁边运行边车，并代理所有进出流量。它们管理 TLS、服务发现、重试、负载平衡等。总而言之，它们让我们的生活变得更加轻松，因为我们不需要在应用程序代码中管理所有这些逻辑。考虑到它们是容器化的，你可以独立于 sidecar 代码语言编写你的代码。</p><p id="1a96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，如果我们看看数据包是如何在这里传输的，它看起来会像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/8f6b2e9071b7a8418933581f008dbb43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ehY0IPDRz0b5OncgOxu1Xw.png"/></div></div></figure><p id="5836" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将这段代码从应用程序中分离出来，放在一个 sidecar 中。这种脱钩改变了我们的生活。那么，可以进一步解耦吗？可以放在内核里吗？</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ln"><img src="../Images/c24bab2a79e8e33522386e12faf3c453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eMOtMRUyZse0jossQzliPg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源:https://cilium.io/get-started/<a class="ae jt" href="https://cilium.io/get-started/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="8713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以节省资源，因为您不必按单元运行它，而是按节点运行它。而且，由于流量会像这样移动，您还会降低延迟和复杂性</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/fcd4ef3c9f9f84226baac55a572624a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECcEjKNY0RTy-J5CNUqWCQ.png"/></div></div></figure><p id="17b3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，如果我们不需要第 7 层信息来传输某些流量，我们可以完全跳过代理 pod，直接进入网络接口</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/5a4bcb2dd2b5c11e4833dbeac5c5d0e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xlpeG_p_7DK43_uUCER1vg.png"/></div></div></figure><p id="4c7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">通过消除标准服务网格的复杂性，您将面临显著的延迟和吞吐量改进<a class="ae jt" href="https://cilium.io/blog/2021/05/11/cni-benchmark/" rel="noopener ugc nofollow" target="_blank">，这就是证据</a>。</p><h2 id="a170" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">听起来太棒了，为什么我们一直没有这样做呢？</h2><p id="a2a3" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">嗯，我们实际上非常接近 kube-proxy，它非常接近 Linux 内核，但不完全是，但有点像服务网格，同时依赖于用 iptables 实现的传统的基于网络的功能。</p><p id="2fa9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们缺少的是第 7 层上下文，因为 kube-proxy 只需要专门在网络数据包级别上运行。它不能满足应用层流量管理、跟踪、认证等现代应用需求。</p><p id="8b9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">纤毛通过 eBPF 带来了解决方案。</p><h2 id="105b" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">这个 eBPF 是什么？</h2><p id="0b31" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">从历史上看，由于内核具有监督和控制整个系统的特权，操作系统一直是实现可观察性、安全性和网络功能的理想场所。</p><p id="08eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">eBPF 可以在特权上下文(如操作系统内核)中安全有效地运行沙盒程序。它扩展了内核的功能，而不需要改变内核源代码或加载内核模块。这不仅安全，而且便于携带。</p><h2 id="d010" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">明白了，那么这个设置有什么帮助呢？</h2><p id="d968" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">通过这种设置，您可以获得以下好处</p><ul class=""><li id="3b51" class="lo lp hi ih b ii ij im in iq lq iu lr iy ls jc lt lu lv lw bi translated">在利用 BGP、XDP 和 eBPF 的同时，安全可靠地实施负载平衡</li><li id="b055" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">简单、高性能的跨集群连接</li><li id="dda1" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">使用纤毛的哈勃框架的分布式的，有身份意识的可观测性。它为 L3/L4 和 L7 网络流数据提供了 Prometheus 兼容指标，并公开了上下文，如 pod 中的哪个应用程序进行了这些连接</li><li id="6340" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">支持几乎任何网络协议</li><li id="838e" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">更快的 pod 启动时间，因为不需要运行额外的边车</li><li id="6318" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">透明加密功能，它使用 Linux 内核中内置的高效 IPsec 功能来自动加密 Kubernetes 集群内部或集群之间的所有工作负载之间的通信</li><li id="24e8" class="lo lp hi ih b ii lx im ly iq lz iu ma iy mb jc lt lu lv lw bi translated">通过启用 DNS 感知策略(例如允许*.google.com)和应用感知策略(例如允许 HTTP GET /foo)，超越基本的 Kubernetes 网络策略</li></ul><h2 id="cb7b" class="km kn hi bd ko kp kq kr ks kt ku kv kw iq kx ky kz iu la lb lc iy ld le lf lg bi translated">离别赠言</h2><p id="e835" class="pw-post-body-paragraph if ig hi ih b ii lh ik il im li io ip iq lj is it iu lk iw ix iy ll ja jb jc hb bi translated">纤毛是一种看待服务网格的新方式，它带来了大量的额外好处。当然，它不像 Istio 这样的老玩家那样成熟，但考虑到他们的路线图，我相信会有新的浪潮到来。</p></div></div>    
</body>
</html>