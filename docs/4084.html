<html>
<head>
<title>Retrieving &amp; Decoding Stored Data from AWS S3 in Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Unity中检索和解码来自自动气象站S3的存储数据</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/retrieving-decoding-stored-data-from-aws-s3-in-unity-58891089134e?source=collection_archive---------5-----------------------#2021-07-06">https://medium.com/nerd-for-tech/retrieving-decoding-stored-data-from-aws-s3-in-unity-58891089134e?source=collection_archive---------5-----------------------#2021-07-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="9343" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">如何倾倒你的水桶</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/81339bb4ab19fff00f2538017ed5587e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_t6ZlUPsyZEr56TK"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">我知道我的数据就在这里的某个地方…</figcaption></figure><p id="3eb8" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">昨天我们讨论了如何将数据转换成二进制文件并上传到S3桶中。今天我们将做相反的事情:找到存储的数据，解码它，并让用户可以访问它。</p><p id="084b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们开始工作吧。</p><h2 id="4afb" class="kk kl hi bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">抓住要点并列出清单</h2><p id="a014" class="pw-post-body-paragraph jn jo hi jp b jq lf ij js jt lg im jv jw lh jy jz ka li kc kd ke lj kg kh ki hb bi translated">这里的任务是让用户在移动保险索赔报告应用程序中查找提交的索赔数据。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lk"><img src="../Images/396a57d47e699731cbdb68ada7f20ce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ULJ5c7Cf-Em0PsT5qqFQg.png"/></div></div></figure><p id="1453" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">Amazon有一大堆有用的C#方法，Unity可以访问这些方法来处理检索数据的工作。完整的细节可以在<a class="ae kj" href="https://docs.aws.amazon.com/mobile/sdkforunity/developerguide/s3.html" rel="noopener ugc nofollow" target="_blank">这里找到</a>；我们将大幅修改他们的例子，以适应我们的用例。</p><p id="3180" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">我们不想下载整个存储桶—只下载我们正在寻找的特定文件。我们需要做的第一件事是获得我们的S3桶中的项目列表。然后我们可以在列表中搜索我们需要的项目，并下载它。然后，我们必须将它从二进制文件转换成可以填充到Case类实例中的数据。</p><p id="2ab9" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">下面是GetList方法的伪代码，它接受一个caseNumber字符串和一个可选的onComplete操作方法:</p><blockquote class="ll lm ln"><p id="0d56" class="jn jo lo jp b jq jr ij js jt ju im jv lp jx jy jz lq kb kc kd lr kf kg kh ki hb bi translated">声明ListObjectsRequest类的一个名为“request”<br/>的新实例调用S3Client ListObjectsAsync方法，传入请求和一个名为“responseObject”的内联委托:<br/> …如果没有异常<br/> …声明一个bool，该bool对bucket中的对象列表运行LINQ查询<br/> …如果bool为真(找到了案例)</p><p id="4b1e" class="jn jo lo jp b jq jr ij js jt ju im jv lp jx jy jz lq kb kc kd lr kf kg kh ki hb bi translated">……[此处为数据解码]</p><p id="7cf4" class="jn jo lo jp b jq jr ij js jt ju im jv lp jx jy jz lq kb kc kd lr kf kg kh ki hb bi translated">……否则，如果没有找到案例，则记录它<br/>……否则，如果有异常，则记录它们</p></blockquote><p id="624b" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">在这一点上，我们已经有了一个项目列表，我们已经瞄准了我们想要的。接下来，我们需要让数据对我们有用。</p><h2 id="5fc6" class="kk kl hi bd km kn ko kp kq kr ks kt ku jw kv kw kx ka ky kz la ke lb lc ld le bi translated">解码数据</h2><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ls"><img src="../Images/669144bfdcff4a8230d4be86fafab03a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LmSKuceRVAthtPmY"/></div></div></figure><p id="c22a" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">从我们停止伪代码的地方继续，我们需要引入一些内存流来处理我们的数据:</p><blockquote class="ll lm ln"><p id="365e" class="jn jo lo jp b jq jr ij js jt ju im jv lp jx jy jz lq kb kc kd lr kf kg kh ki hb bi translated">调用S3Client GetObjectAsync方法，传入bucket、目标文件和另一个名为“responseObject”的内联委托:<br/>…检查响应是否为null —如果不是:<br/>……创建一个字节数组来存储来自文件<br/>的数据……使用StreamReader类的新实例， 传入响应流:<br/>…………使用MemoryStream类的新实例:<br/>…………创建一个字节数组(大小为512)作为数据的缓冲区<br/>…………创建一个变量来跟踪读取的字节<br/>…………当读取的字节大于0时<br/> …………调用MemoryStream Write方法，传入缓冲区和字节跟踪器<br/>…………使用MemoryStream的另一个新实例将内存流传入数据字节数组<br/>……… 传入数据字节数组:<br/>………声明BinaryFormatter类的新实例<br/>………声明Case类的新实例，并将其等同于对BinaryFormatter的反序列化方法的调用，传入内存流。 <br/>………将UI管理器的活动案例等同于下载的案例<br/>………如果调用此方法的类有onComplete动作，则运行它</p></blockquote><p id="285d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">哇哦。这是很多嵌套操作。简单概括一下:我们向AWS请求一个条目列表，我们查询列表中我们要搜索的条目，我们为数据创建一个容器，打开一个流读取器，它打开一个内存流，在将输入的数据放入我们的容器之前下载并缓冲它。最后，我们用二进制格式化程序反序列化数据，并将结果加载到我们的活动案例中。</p><p id="b76d" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">咻。</p><p id="d984" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">下面是GetList方法的C#:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es lt"><img src="../Images/5f3a565e27b18542abe1ae9ccf73e54a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Hxu7V-wRcIleC3LabdN-A.png"/></div></div></figure><p id="f473" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">让我们看看效果如何:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es lu"><img src="../Images/6c96ca0ee4e455f698c03a6069da05a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/1*p5F1cbSkzeJUdkGkVdGODw.gif"/></div></figure><p id="0dba" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">太棒了。</p><p id="3e1e" class="pw-post-body-paragraph jn jo hi jp b jq jr ij js jt ju im jv jw jx jy jz ka kb kc kd ke kf kg kh ki hb bi translated">这就是我今天的全部内容。明天我将通过实现命令模式来完善应用程序的导航功能。一定要去看看！</p></div></div>    
</body>
</html>