<html>
<head>
<title>MlOps: Machine learning Pipelines using kubeflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MlOps:使用 kubeflow 的机器学习管道</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/mlops-machine-learning-pipelines-using-kubeflow-fc06508a3f0d?source=collection_archive---------0-----------------------#2022-08-31">https://medium.com/nerd-for-tech/mlops-machine-learning-pipelines-using-kubeflow-fc06508a3f0d?source=collection_archive---------0-----------------------#2022-08-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1d66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用 Kubeflow 对 Kubernetes 进行有效的 MLOps</p><p id="aeb8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">机器学习！！机器学习！！机器学习！！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/36dd502d6b0f50b81528ae480ddd7ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ocQd8pq_95fZLJZX.png"/></div></div></figure><p id="26b2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是的，这是目前的情况。无论我走到哪里，我都能看到机器学习。嗯，AI 和 ML 现在已经成为任何应用程序最重要的组件。一个电子商务网站需要一个 ML 模型，像网飞这样的网站使用 ML 模型向他们的客户推荐内容。有很多这样的例子，ML 在促进业务发展中扮演着非常重要的角色。但是构建 ML 模型的生命周期有多简单呢？在集装箱化的生态系统中也是这样吗？唷，真是一场噩梦。对于典型的 ML 模型，这些是基本步骤</p><p id="afec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">a)培训</p><p id="946e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">b)测试</p><p id="e93e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">c)上菜</p><p id="6799" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设上述所有步骤都是独立的工作流。将它们收集到一个管道中是非常不可能的。别担心，库伯流来救我们了！！Kubeflow 项目致力于使在 Kubernetes 上部署机器学习(ML)工作流变得简单、可移植和可扩展。Kubeflow 是 Kubernetes 的 ML 工具包。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/67d1d4a67a8000f992e7fb5ad6e29eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UVpzcbMrgRrsDxtUhfJSLA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">Kubeflow 组件</figcaption></figure><p id="dae0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将在本文中重点介绍的一个组件是 Kubeflow 管道。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jv"><img src="../Images/b80007f45fbe87f29ba8cfec3caf69fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*TsXw4YQqmJb8NMmsEAuVzQ.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">Kubeflow 组件</figcaption></figure><h1 id="d01c" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">整个故事是关于什么的？(TLDR)</h1><ol class=""><li id="dfef" class="ku kv hi ih b ii kw im kx iq ky iu kz iy la jc lb lc ld le bi translated">了解 Kubeflow 管道。</li><li id="7b18" class="ku kv hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">开发一个样本模型。</li></ol><h1 id="7ca8" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">先决条件</h1><ol class=""><li id="58d7" class="ku kv hi ih b ii kw im kx iq ky iu kz iy la jc lb lc ld le bi translated">一个 Kubernetes 集群(EKS、AKS、Kind 等)。</li><li id="8c17" class="ku kv hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">安装 Kubeflow 管道。</li></ol><h1 id="80b8" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">故事资源</h1><ol class=""><li id="3c75" class="ku kv hi ih b ii kw im kx iq ky iu kz iy la jc lb lc ld le bi translated">GitHub 链接:【https://github.com/pavan-kumar-99/medium-manifests T2】</li><li id="c7fe" class="ku kv hi ih b ii lf im lg iq lh iu li iy lj jc lb lc ld le bi translated">GitHub 分支:<a class="ae lk" href="https://github.com/pavan-kumar-99/medium-manifests/tree/kubeflow" rel="noopener ugc nofollow" target="_blank"> kubeflow </a></li></ol><h2 id="9f1b" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">安装 Kubeflow</h2><p id="6d78" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">您可以根据您的 Kubernetes 发行版<a class="ae lk" href="https://www.kubeflow.org/docs/started/installing-kubeflow/#install-a-packaged-kubeflow-distribution" rel="noopener ugc nofollow" target="_blank">在这里</a>选择最合适的安装 kubeflow 的方式。我有一个本地集群，我只使用这里的文档<a class="ae lk" href="https://github.com/kubeflow/manifests#install-individual-components" rel="noopener ugc nofollow" target="_blank">安装了 Kubeflow 管道。</a></p><p id="2e17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了 Kubeflow 管道，用户界面看起来就会像这样</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/b06c59dc36012a15d889e4de224a3e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R1vh4VgZWGVtgHzgbj_EmA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">Kubeflow UI</figcaption></figure><p id="9c5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在运行您的第一个 kubeflow 管道之前，您应该了解一些重要的术语。现在让我们来理解它们。</p><h2 id="5b3f" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">管道:</h2><p id="a384" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">kubeflow <em class="jp"> pipeline </em>是对 ML 工作流的描述，包括工作流中的所有组件以及它们如何以图形的形式组合。管道包括运行管道所需的输入(参数)以及每个组件的输入和输出的定义。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/e86303acb170e20906fd263290c57ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xlg_rTUcNSlEUStqlGaAZA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">已经在 Kubeflow 示例目录中创建的示例管道</figcaption></figure><h2 id="33af" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">组件:</h2><p id="621e" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">一个<em class="jp">管道组件</em>是一个自包含的代码集，执行 ML 工作流(管道)中的一个步骤，比如数据预处理、数据转换、模型训练等等。组件类似于函数，因为它有名称、参数、返回值和主体。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es me"><img src="../Images/e00b6b92702dbe2c16381c023ce625b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*7yfjpggoEyKpVGu5G1dhpA.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">样本组件</figcaption></figure><h2 id="9294" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">图表:</h2><p id="2671" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated"><em class="jp">图</em>是管道运行时执行的 Kubeflow 管道 UI 中的图形表示。该图显示了管道运行已经执行或正在执行的步骤，箭头指示了每个步骤所代表的管道组件之间的父/子关系。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mf"><img src="../Images/0b98844a68f8747563551cb27e7acfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCPzhLV8CNGqOxqoP2VgbA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">库伯流图示例</figcaption></figure><h2 id="5739" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">运行:</h2><p id="7837" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">一次<em class="jp">运行</em>是流水线的一次执行。运行包括您尝试的所有实验的不可变日志，并且设计为独立的，以允许再现性。您可以通过查看 Kubeflow Pipelines UI 上的详细信息页面来跟踪运行的进度，在这里您可以看到运行时图、输出工件以及运行中每个步骤的日志。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mg"><img src="../Images/6e8f306d83864469c1cb9f5c096d243d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuWoDaoqwoA2uE97IXYE3w.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">库贝夫流程运行</figcaption></figure><p id="79d1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，我们现在对库伯流中的术语有了一个基本的理解。现在让我们运行我们的第一个 kubeflow 管道。</p><h2 id="74cd" class="ll jx hi bd jy lm ln lo kc lp lq lr kg iq ls lt kk iu lu lv ko iy lw lx ks ly bi translated">运行 Kubeflow 管道</h2><p id="b344" class="pw-post-body-paragraph if ig hi ih b ii kw ik il im kx io ip iq lz is it iu ma iw ix iy mb ja jb jc hb bi translated">所有 ML Kubeflow 管道都是使用 Kubeflow 管道 SDK 构建的。<a class="ae lk" href="https://kubeflow-pipelines.readthedocs.io/en/stable/source/kfp.html" rel="noopener ugc nofollow" target="_blank"> Kubeflow Pipelines SDK </a>提供了一组 Python 包，您可以使用它们来指定和运行您的机器学习(ML)工作流。一个<em class="jp">管道</em>是一个 ML 工作流的描述，包括组成工作流中步骤的所有<em class="jp">组件</em>以及这些组件如何相互作用。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="mh mi l"/></div></figure><p id="11dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好吧，让我们现在理解代码。我们正在创建 2 个组件作为该代码的一部分，即 process_data_op、train_op(目前只打印了一些语句)。如上所述<strong class="ih hj">一个<em class="jp">管道组件</em>是一个自包含的代码集，它执行 ML 工作流(管道)中的一个步骤，比如数据预处理、数据转换、模型训练等等。</strong></p><p id="2ef3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">之后，我们使用 sequential_pipeline 函数创建一个 Kubeflow 管道。在该功能中，我们通过调用前面创建的组件来定义管道所需的步骤。我们还通过在函数之后使用<strong class="ih hj">来定义依赖关系。</strong></p><pre class="je jf jg jh fd mj mk ml mm aw mn bi"><span id="314c" class="ll jx hi mk b fi mo mp l mq mr">$ git clone <a class="ae lk" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b kubeflow</span><span id="89e8" class="ll jx hi mk b fi ms mp l mq mr">$ cd medium-manifests</span><span id="c5de" class="ll jx hi mk b fi ms mp l mq mr">$ python3 <a class="ae lk" href="https://github.com/pavan-kumar-99/medium-manifests/blob/kubeflow/medium-pipeline.py" rel="noopener ugc nofollow" target="_blank">medium-pipeline.py</a> </span></pre><p id="35e9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就是这样。我们现在正在编译管道并生成管道 yaml。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mt"><img src="../Images/142570b21d684733287becc55b884564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QH-qsBOF4OMzPn-sGOOo_A.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">YAML 从库伯弗洛管道产生的管道</figcaption></figure><p id="7c1d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们现在上传这个管道 YAML。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mu"><img src="../Images/20768384c0387e57bafde5142177e884.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRPgw-8dKBi7jl6YUSPCig.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">上传管道 Yaml</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mv"><img src="../Images/5044254b8973899ddd04c80898debfce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qobc91y4TqdnKJF6_CCbHA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">将管道上传到 Kubeflow</figcaption></figure><p id="a8ad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦上传了管道，您就可以从 Kubeflow 管道 UI 运行管道。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mw"><img src="../Images/c0aaba0409356e632d09cfe4e41c6b78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uPMrzVLGyQZoOg1VDkajzA.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">Kubeflow 管道输出</figcaption></figure><p id="7dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是我们的管道在图表中的样子。所有的事件。日志，可视化(如果创建的话)现在也可以在控制台上看到。</p><p id="2c03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是一个非常简单的库伯流管道。本文将确保在开始使用 Kubeflow 管道之前有足够的知识。在我关于 Kubeflow 系列的下一篇文章中，我将采用一个实时用例，解释我们如何使用 Kubeflow 来设计一个 E2E ML 解决方案(也包括使用 TFServing 的模型服务)。</p><p id="8f8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">直到下一次…..</p><h1 id="3239" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">被推荐的</h1><div class="mx my ez fb mz na"><a href="https://pavan1999-kumar.medium.com/hashicvault-secrets-in-kubernetes-with-csi-driver-ec917d4a2672" rel="noopener follow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">与 CSI 驱动程序在 Kubernetes 中的哈希 cVault 秘密</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">使用 Vault CSI 驱动程序向 Kubernetes Pods 注入秘密</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">pavan1999-kumar.medium.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no jn na"/></div></div></a></div><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/pki-certs-injection-to-k8s-pods-with-vault-agent-injector-d97482b48f3d"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">使用保险库代理注入器向 K8s Pods 注入 PKI 证书</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">使用保管库代理注入器将 PKI 证书动态注入到 Kubernetes Pods</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="np l nl nm nn nj no jn na"/></div></div></a></div><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/terraforming-the-gitops-way-9417cf4abf58"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">地球化吉托普斯之路！！！</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">使用 Atlantis(拉式请求自动化)通过 GitOps 建立 Terraform。</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nq l nl nm nn nj no jn na"/></div></div></a></div><div class="mx my ez fb mz na"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/deep-dive-into-thanos-part-i-f72ecba39f76"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hj fi z dy nf ea eb ng ed ef hh bi translated">深入灭霸——第一部分</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">使用灭霸和普罗米修斯操作员监控 Kubernetes 的工作负载</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">medium.com</p></div></div><div class="nj l"><div class="nr l nl nm nn nj no jn na"/></div></div></a></div></div></div>    
</body>
</html>