<html>
<head>
<title>Common Kubernetes Errors Made by Beginners [2023]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">初学者常犯的Kubernetes错误[2023]</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/common-kubernetes-errors-made-by-beginners-274b50e18a01?source=collection_archive---------1-----------------------#2021-07-21">https://medium.com/nerd-for-tech/common-kubernetes-errors-made-by-beginners-274b50e18a01?source=collection_archive---------1-----------------------#2021-07-21</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/df6b35b60ad6819503a92041bf9d2adb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rjP_OyXCyWz_qQnRgYBwXQ.png"/></div></div></figure><p id="41f0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Kubernetes采用的大多数问题最终源于技术本身的复杂性。实施和操作中存在不明显的困难和细微差别，并且存在未充分利用的优势。此外，随着你使用Kubernetes越来越频繁，你可能会成为<a class="ae jo" href="https://komodor.com/blog/alert-fatigue-a-practical-guide-to-managing-alerts/" rel="noopener ugc nofollow" target="_blank">疲劳</a>的受害者。结果是，你赔钱。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="b420" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">经过几年的Kubernetes经验和对各种客户的几次咨询，我注意到了一些常见的Kubernetes错误。因此，我想选择并讨论这6个常见的问题。</p><ol class=""><li id="c2bc" class="jv jw hi is b it iu ix iy jb jx jf jy jj jz jn ka kb kc kd bi translated"><strong class="is hj">服务上标签的选择器与pod不匹配</strong></li></ol><p id="9aab" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了正确发挥网络平衡器的功能，服务通常会指定选择器，这些选择器允许您找到属于平衡池的pod。如果不匹配，则服务没有转发流量的端点，并且会发生错误。请记住，对pod的负载平衡是随机类型的。</p><p id="78ce" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 2。映射到服务的错误容器端口</strong></p><p id="f0b4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">每个服务都有两个基本参数，“T6”target port和“<em class="ke"> port </em>”，这两个参数经常被混淆和误用。这种混淆会导致错误消息，声称连接被拒绝或者请求没有响应。</p><p id="9df7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了避免这种错误，请记住"<em class="ke"> targetPort </em>"是pod中的目的端口，服务会将流量转发到该端口。另一方面，“<em class="ke"> port </em>”参数指的是服务向客户端公开的端口。</p><p id="9b24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">它们可以是相同的，所以了解它们的含义是必不可少的！</p><p id="ca32" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 3。CrashLoopBackOff </strong></p><p id="27df" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个常见的Kubernetes错误是<em class="ke"> crashloopbackoff </em>错误。当一个pod <em class="ke"> </em>正在运行，但是它的一个容器由于终止(通常是错误的方式)而重新启动时，就会发生这种情况。换句话说，集装箱陷入了启动-崩溃-启动-崩溃的循环中。</p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/5142193e2926011695d1181195a66bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EwrIDK6K6NVn96r7"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated"><em class="kk">crashloopback错误日志</em></figcaption></figure><p id="f114" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">CrashLoopBackOff错误可能是由各种原因造成的Kubernetes的错误部署、活动探测器的错误配置以及init-container的错误配置。解决这个错误的一个简单方法是正确配置和部署Kubernetes。但是，您也可以通过在blocking命令的帮助下创建单独的部署来绕过该错误。</p><p id="d02d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 4。活性和准备就绪探测</strong></p><p id="3127" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于探针有几个错误。第一个是不为应用程序定义任何健康检查，应用程序在出现问题时永远不会重新启动，并且将始终保持在服务的负载平衡池中。</p><p id="b54d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，第二种错误涉及通过联系同一个HTTP端点来定义相同的活跃度和就绪性探测。这可能是由于对这些类型的测试的误解。活性探测与健康应用程序的概念相关联，因此如果它失败了，pod将被重新启动。</p><figure class="jp jq jr js fd ij"><div class="bz dy l di"><div class="kl ju l"/></div></figure><p id="b8ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">就绪探测与在pod的整个生命周期中是否将pod插入负载平衡池有关。将它们定义为相等可能会有风险，例如，重新启动一个由于流量过大而暂时变慢的应用程序。</p><p id="24c4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一个关键的方面是，如果服务的一个依赖项关闭，不要让探测失败。这只会使问题复杂化，必须在适当的服务中发现这一问题。</p><p id="cf24" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 5。资源—请求和限制</strong></p><p id="9639" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一般新手都会忘记设置对CPU和内存的请求和限制。该错误导致在一些工作节点上安排了太多的应用程序，导致它们“过载”。最终结果是一个低性能的应用程序。</p><p id="42b6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">另一方面，如果限制设置得太低，CPU的性能会很差。如果你以前见过<a class="ae jo" href="https://www.netice9.com/blog/guide-to-oomkill-alerting-in-kubernetes-clusters/" rel="noopener ugc nofollow" target="_blank"> OOMkill </a>错误信息，这就是问题所在。理想的策略是分配适量的CPU和内存，可能将请求设置为与关键应用程序的限制(有保证的QoS)相等。</p><p id="84b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">了解必要的资源基本上就是用普罗米修斯这样的工具进行测试和监控。</p><p id="b741" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> 6。太多负载平衡器类型的服务</strong></p><figure class="jp jq jr js fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es km"><img src="../Images/8f49b6b94a53d79b6fff1f1ffeae9bbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Acqi2X9DAa3-eALp"/></div></div><figcaption class="kg kh et er es ki kj bd b be z dx translated"><a class="ae jo" href="https://avinetworks.com/glossary/udp-load-balancer/" rel="noopener ugc nofollow" target="_blank">来源</a></figcaption></figure><p id="08d5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">初学者经常会使用负载平衡器类型向外部公开太多的服务。在这种情况下，由云提供商提供的特定控制器在集群外的<a class="ae jo" href="https://www.ibm.com/cloud/learn/vpc" rel="noopener ugc nofollow" target="_blank"> VPC </a>内创建一个负载平衡器。这些资源会变得非常昂贵，主要是如果它们与静态IP地址相关联的话。</p><p id="fb70" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最佳解决方案是使用单个负载均衡器来公开集群，该负载均衡器将流量转发到集群节点，集群节点通常具有使用入口资源进行路由的入口控制器。</p><h1 id="9a1b" class="kn ko hi bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">最后的话</h1><p id="011c" class="pw-post-body-paragraph iq ir hi is b it ll iv iw ix lm iz ja jb ln jd je jf lo jh ji jj lp jl jm jn hb bi translated">不要期望所有的事情都能神奇地解决:Kubernetes不是万能的。一个糟糕的应用程序甚至在Kubernetes中也会如此(甚至可能变得更糟)。如果您不小心，控制层将变得越来越复杂、缓慢和艰巨。此外，没有灾难恢复策略可能会使您易受攻击。Kubernetes平台不能自动确保隔离和冗余。花些时间让您的应用程序真正成为云原生的。</p></div></div>    
</body>
</html>