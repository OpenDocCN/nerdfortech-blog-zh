<html>
<head>
<title>Rocket.Chat Desktop: No valid server found at the URL…wait what?!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">火箭。聊天桌面:在 URL 上没有找到有效的服务器…等等什么？！</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/rocket-chat-desktop-no-valid-server-found-at-the-url-wait-what-bde80748152a?source=collection_archive---------1-----------------------#2020-10-12">https://medium.com/nerd-for-tech/rocket-chat-desktop-no-valid-server-found-at-the-url-wait-what-bde80748152a?source=collection_archive---------1-----------------------#2020-10-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/4c86ca8ab8b1a052f78e062c318ccbff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BmpDJDsYhUWCWUs6Y8e1gQ.png"/></div></div></figure><p id="88e5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi jo translated">T2，奥克特。聊天桌面最近<a class="ae jx" href="https://github.com/RocketChat/Rocket.Chat.Electron/pull/1770" rel="noopener ugc nofollow" target="_blank">发布了 3.0.2 版本</a>。在这个释放火箭里。聊天团队引入了<strong class="is hj">服务器验证</strong>，并硬编码了最低要求的 Rocket。聊天服务器版本为 2.0.0 <strong class="is hj">。</strong></p><p id="8959" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">有了这个突破性的改变，火箭。聊天桌面将不再在火箭上工作。运行版本&lt; 2.0.0. If you try connecting to Rocket.Chat server running on older version, you’ll be prompted with the following message.</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div class="er es jy"><img src="../Images/7b22255e36be2442ed6971739d05cbed.png" data-original-src="https://miro.medium.com/v2/resize:fit:732/format:webp/1*G8ieh_UzxBJ5g8IpZCLAug.png"/></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">Fig: No valid server found at the URL</figcaption></figure><p id="cedd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Firstly, the message is vague and unclear, and at first, the user will try to double-check if they have entered the correct URL. Secondly, this message has nothing to do with the server version. A more appropriate message would have been:</p><blockquote class="kh ki kj"><p id="eec9" class="iq ir kk is b it iu iv iw ix iy iz ja kl jc jd je km jg jh ji kn jk jl jm jn hb bi translated">“Y<!-- -->的聊天服务器您正在连接运行旧版本且不再受支持的服务器。请升级你的火箭。聊天服务器。"</p></blockquote><p id="e888" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">很多运行 Rocket 的用户和公司。聊天服务器版本&lt; 2.0.0 in production is suddenly left with one option, <strong class="is hj">升级！</strong></p><p id="519d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然而，一夜之间升级服务器对任何生产软件来说都是不可能的，当然，除非是<a class="ae jx" href="https://en.wikipedia.org/wiki/Heartbleed" rel="noopener ugc nofollow" target="_blank"> Heartbleed </a>。</p><p id="c3e4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一个可能的解决方法是要求最终用户重新安装一个旧版本的 Rocket。聊天桌面&lt; 3.0.0, which doesn’t perform the Server Validation. But in reality, this is not feasible when you have 100s of users!</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="d5e6" class="kv kw hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">Let’s buy us some time!</h1><p id="cdf2" class="pw-post-body-paragraph iq ir hi is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hb bi translated">Alright, we know the upgrade is mandatory but not possible overnight. So now what!</p><p id="d598" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">I began drilling into the Rocket.Chat Desktop source code to figure out how Server validation is actually performed under the hood.</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ly"><img src="../Images/45504f83727e3500c1f09221fa70a9ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3q04IoeYhbfwROYu6tjzNg.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">Source: <a class="ae jx" href="https://github.com/RocketChat/Rocket.Chat.Electron/blob/master/src/servers/renderer.ts#L18" rel="noopener ugc nofollow" target="_blank">Rocket.Chat.Electron/src/servers/renderer.ts</a></figcaption></figure><p id="e571" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在第 18 行，通过请求<code class="du lz ma mb mc b">api/info</code>端点获取服务器版本信息。如果您<code class="du lz ma mb mc b">curl</code>这个端点，它将返回服务器版本信息作为 JSON 响应:</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/42ccc99260d47702bb9412902c7b389e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ySpR2zNDpzAU3JlEXhNzpA.png"/></div></div></figure><p id="c1ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">嗯…那很有趣。然后从 JSON 响应中解析版本信息，并与硬编码的<strong class="is hj">REQUIRED _ SERVER _ VERSION _ RANGE 进行比较。</strong></p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/2992e37480bf41341aa62fcb560bca9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7vTixZ-_ASWnXGToIqK1KQ.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">来源:<a class="ae jx" href="https://github.com/RocketChat/Rocket.Chat.Electron/blob/master/src/servers/main.ts#L18" rel="noopener ugc nofollow" target="_blank">Rocket.Chat.Electron/src/servers/main.ts</a></figcaption></figure><p id="8e7d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么，如果我们在不升级服务器的情况下，动态修改 JSON 响应，返回一个版本≥ 2.0.0 会怎么样呢？如果你部署了火箭。AWS 负载均衡器后面的聊天服务器，然后我们可以添加一个自定义规则，并使用 AWS ALB 的固定响应特性创建一个自定义 JSON 响应。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/01bd31c63b1b211fe64fed07ef30c3e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYbed4wOwQVwtHKttfx_Mg.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated"><em class="mg">图 AWS ALB 增加的固定响应规则</em></figcaption></figure><p id="2941" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">瞧啊。我们升级了火箭眼中的服务器。聊天桌面。</p><figure class="jz ka kb kc fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/f902f9759509657b393f7729f41f9adf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g8VrxGeiSnoZFhtA9ChCcg.png"/></div></div></figure><p id="5e55" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过这个简单的改变，如果你现在尝试使用最新的 Rocket 连接到服务器。聊天桌面版。毫不奇怪，即使服务器仍在运行旧版本，它也会连接。</p><p id="dad2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您的用户现在应该能够连接到服务器并使用最新的 Rocket。正常聊天桌面。</p><p id="d435" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">警告！</strong>不要将这种“破解”作为永久的解决方案。当你开始计划升级火箭时，这种“入侵”可以给你的团队一些喘息的机会。聊天服务器版本。</p></div><div class="ab cl ko kp gp kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hb hc hd he hf"><h1 id="5dc3" class="kv kw hi bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="18fe" class="pw-post-body-paragraph iq ir hi is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn hb bi translated">火箭。聊天团队应该保持与旧服务器版本的向后兼容性，并给出行动的最后期限。相反，他们走了另一条路线，强迫所有人立即升级。无论如何，如果你还在运行一个旧的服务器版本，那么现在是你计划升级的时候了！</p><p id="9388" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> P.S. </strong>火箭。聊天是一个非常好的开源交流和协作工具。如果你还没有查看:<a class="ae jx" href="https://rocket.chat" rel="noopener ugc nofollow" target="_blank"> https://rocket.chat </a></p></div></div>    
</body>
</html>