<html>
<head>
<title>How Client Application Interact with Kafka Cluster — Made Easy with Kafka Java API’s</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">客户端应用程序如何与Kafka集群交互——通过Kafka Java API简化</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-client-application-interact-with-kafka-cluster-made-easy-with-java-apis-58f29229d992?source=collection_archive---------4-----------------------#2021-02-28">https://medium.com/nerd-for-tech/how-client-application-interact-with-kafka-cluster-made-easy-with-java-apis-58f29229d992?source=collection_archive---------4-----------------------#2021-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f7cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我们将看到如何利用Kafka客户端库(REST Api)与Kafka集群进行交互。让我们从3部分系列的第1部分开始</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/fa7409349f7daf4bc17f40b39e6b018f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*synaakr8Vu72WHHjQLS9Tw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">Kafka客户端API —取自Kafka官方网站的Kafka徽标</figcaption></figure><p id="785d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jt"> Part-1: </em> </strong> <em class="jt">我们会看到3个Java Api的</em><br/>-admin client Api<br/>-Producer Api<br/>-Consumer Api</p><p id="90a5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jt">Part-2:</em></strong><em class="jt">Kafka Streams(进行中—即将推出)</em><br/>—Streams API</p><p id="a2e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jt"> Part-3: </em> </strong> <em class="jt">卡夫卡连接</em> <em class="jt">(进行中——即将推出)</em><br/>——连接API</p><p id="597b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">在local/Docker中设置Kafka集群:</strong></p><p id="9816" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ju" rel="noopener" href="/me/stats/post/ae84324cde86">通过创建主题“数字”设置Kafka集群</a></p><p id="8b42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">先决条件:</strong></p><blockquote class="jv jw jx"><p id="7b8c" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">- Kafka集群(在本地/docker中配置并运行)<br/> - IntelliJ社区(或您选择的任何IDE)<br/>-Maven/grad le(构建工具)<br/> - Java 8+</p></blockquote><p id="edda" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> Maven/Gradle依赖关系:</strong></p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="6c39" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">MAVEN:</strong></span><span id="0b4e" class="kg kh hi kc b fi km kj l kk kl"><em class="jt">&lt;!-- For Producer and Consumer API --&gt;</em><br/>&lt;dependency&gt;<br/>    &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;<br/>    &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;<br/>    &lt;version&gt;2.7.0&lt;/version&gt;<br/>&lt;/dependency&gt;<br/><br/><strong class="kc hj">GRADLE:</strong><br/><br/>implementation group: 'org.apache.kafka', name: 'kafka-clients', version: '2.7.0'</span></pre><blockquote class="jv jw jx"><p id="ee9d" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">管理客户端API: </strong></p></blockquote><p id="d644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">kafka的管理客户端，支持管理和检查主题、代理、配置和ACL。这里我们看到了</p><p id="6dc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">-创建新主题<br/> -删除主题<br/> -描述主题<br/> -列出主题<br/> -获取控制器和集群节点详细信息</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="e213" class="kg kh hi kc b fi ki kj l kk kl">@Slf4j<br/>@SpringBootApplication<br/><strong class="kc hj">public class </strong>KafkaAdminApplication <strong class="kc hj">implements </strong>CommandLineRunner {<br/><br/>    <strong class="kc hj">private static final </strong>String <strong class="kc hj"><em class="jt">TOPIC_NAME </em></strong>= <strong class="kc hj">"shasr-new-topic"</strong>;<br/><br/>    <strong class="kc hj">public static void </strong>main(String[] args) {<br/>        SpringApplication.<em class="jt">run</em>(KafkaAdminApplication.<strong class="kc hj">class</strong>, args);<br/>    }<br/><br/>    @Override<br/>    <strong class="kc hj">public void </strong>run(String... args) <strong class="kc hj">throws </strong>Exception {<br/><br/>        <strong class="kc hj"><em class="jt">//Create Admin Client</em></strong><em class="jt"><br/>        </em>AdminClient adminClient = getAdminClient();<br/><br/>        <strong class="kc hj"><em class="jt">// Topic information</em></strong><em class="jt"><br/>        </em>deleteTopic(adminClient);<br/>        createNewTopic(adminClient);<br/>        listTopics(adminClient);<br/>        describeTopics(adminClient);<br/><br/>        <strong class="kc hj"><em class="jt">// Cluster information</em></strong><em class="jt"><br/>        </em>fetchClusterId(adminClient);<br/>        fetchClusterController(adminClient);<br/>        fetchClusterNodes(adminClient);<br/>    }<br/>}</span></pre><ul class=""><li id="f370" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> <em class="jt">用Kafka配置创建AdminClient实例</em> </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="9a18" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private </strong>AdminClient getAdminClient() {<br/>    Properties kafkaProperties = <strong class="kc hj">new </strong>Properties();<br/>    kafkaProperties.put(AdminClientConfig.<strong class="kc hj"><em class="jt">BOOTSTRAP_SERVERS_CONFIG</em></strong>, <strong class="kc hj">"192.168.99.100:29092"</strong>);<br/>    AdminClient adminClient = AdminClient.<em class="jt">create</em>(kafkaProperties);<br/>    <strong class="kc hj">return </strong>adminClient;<br/>}</span></pre><ul class=""><li id="74f9" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> <em class="jt">创建新主题并列出主题</em> </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="a561" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>createNewTopic(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Create new topic ---------------"</strong>);<br/>    NewTopic createTopic = <strong class="kc hj">new </strong>NewTopic(<strong class="kc hj"><em class="jt">TOPIC_NAME</em></strong>, 3, (<strong class="kc hj">short</strong>) 2);<br/>    adminClient.createTopics(Collections.<em class="jt">singleton</em>(createTopic));<br/>}<br/><br/><strong class="kc hj">private void </strong>listTopics(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Topics List ---------------"</strong>);<br/>    Collection&lt;TopicListing&gt; topicList = adminClient.listTopics().listings().get();<br/>    topicList.stream().forEach(topic -&gt; {<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Topic Name : {} "</strong>, topic.name());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Is-internal Topic : {} "</strong>, topic.isInternal());<br/>    });<br/>}</span></pre><p id="bd7a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">输出</em>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/d6cf36309cab755c0a21d40fbe0fe2bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*MRV51Q5v8z66G7BHqTHS2A.png"/></div></figure><ul class=""><li id="d6ee" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj">描述主题细节:领导者、分区、ISR、副本</strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="b986" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>describeTopics(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Describe topics ---------------"</strong>);<br/>    DescribeTopicsResult describeTopicsResult = adminClient.describeTopics(Collections.<em class="jt">singleton</em>(<strong class="kc hj"><em class="jt">TOPIC_NAME</em></strong>));<br/>    Map&lt;String, TopicDescription&gt; topicDescriptionMap = describeTopicsResult.all().get();<br/><br/>    List&lt;TopicPartitionInfo&gt; topicPartitionInfoList = topicDescriptionMap.get(<strong class="kc hj"><em class="jt">TOPIC_NAME</em></strong>).partitions();<br/>    topicPartitionInfoList.stream().forEach(topicInfo -&gt; {<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Leader : {}"</strong>, topicInfo.leader());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Partitions : {}"</strong>, topicInfo.partition());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Replicas : {}"</strong>, topicInfo.replicas());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"ISR : {}"</strong>, topicInfo.isr());<br/>    });<br/>}</span></pre><p id="6888" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jt">输出</em> </strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kx"><img src="../Images/47e8c37c39a6f95a92752c8c7d32cf70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_l-huO1j-Isi-N_c9t02Tg.png"/></div></div></figure><ul class=""><li id="6f2c" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj">删除主题:deleteTopics() </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="cb00" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>deleteTopic(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    Collection&lt;TopicListing&gt; topicList = adminClient.listTopics().listings().get();<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Delete topic ---------------"</strong>);<br/>    <strong class="kc hj">if </strong>(topicList.contains(<strong class="kc hj"><em class="jt">TOPIC_NAME</em></strong>)) {<br/>        adminClient.deleteTopics(Collections.<em class="jt">singleton</em>(<strong class="kc hj"><em class="jt">TOPIC_NAME</em></strong>));<br/>    }<br/>}</span></pre><ul class=""><li id="a006" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> <em class="jt">访问集群信息:Cluster-Id </em> </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="0efe" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>fetchClusterId(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Cluster-Id ---------------"</strong>);<br/>    String clusterId = adminClient.describeCluster().clusterId().get();<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Cluster-Id : {}"</strong>, clusterId);<br/>}</span></pre><ul class=""><li id="36ce" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> <em class="jt">访问集群信息:控制器详情</em> </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="730f" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>fetchClusterController(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    Node controllerNode = adminClient.describeCluster().controller().get();<br/><br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"--------------- Controller Node Details ---------------"</strong>);<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-Id: {}"</strong>, controllerNode.id());<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-String: {}"</strong>, controllerNode.idString());<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-host:{}"</strong>, controllerNode.host());<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-Port: {}"</strong>, controllerNode.port());<br/>    <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-hasRack: {}"</strong>, controllerNode.hasRack());<br/>}</span></pre><ul class=""><li id="e601" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> <em class="jt">访问集群信息:所有集群节点</em> </strong></li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="c4a8" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private void </strong>fetchClusterNodes(AdminClient adminClient) <strong class="kc hj">throws </strong>Exception {<br/><br/>    Collection&lt;Node&gt; clusterNodes = adminClient.describeCluster().nodes().get();<br/><br/>    clusterNodes.stream().forEach(node -&gt; {<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"------------- Node Details ---------------"</strong>);<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-Id: {}"</strong>, node.id());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-String: {}"</strong>, node.idString());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-host:{}"</strong>, node.host());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-Port: {}"</strong>, node.port());<br/>        <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"Node-hasRack: {}"</strong>, node.hasRack());<br/>    });<br/>}</span></pre><p id="52b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jt">输出</em> </strong> <em class="jt">:集群详情</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ky"><img src="../Images/c7970ee863d15ef4ad918fcb33ef8962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*khiqIJafoeu1vmBDpkyAJA.png"/></div></figure></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><blockquote class="jv jw jx"><p id="dc71" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">生产者API: </strong></p></blockquote><p id="02de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Producer API帮助我们构建向Kafka集群发布记录的生产者。</p><ul class=""><li id="c307" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> bootstrap.servers: </strong>主机名/ip形式的kafka代理/服务器列表，带有要连接的端口详细信息。</li><li id="bd9f" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> key.serializer: </strong>为键配置序列化程序类(例如:StringSerializer)。</li><li id="6b86" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> value.serializer: </strong>为键配置序列化程序类(例如:StringSerializer)。</li></ul><p id="d678" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Kafka客户端库有几个帮助与Kafka集群交互的类。在这里，我们创建了带有生产者配置(代理细节、键和值序列化程序)的KafkaProducer实例</p><p id="34fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种情况下，KafkaProducer 'send '方法接受带有主题详细信息、键(可选)和值的ProducerRecord。</p><p id="0b2e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们用producer.close()方法优雅地关闭了生成器。</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="00ed" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">public void </strong>generateNumber() {</span><span id="43ca" class="kg kh hi kc b fi km kj l kk kl">   Properties kafkaProperties = <strong class="kc hj">new </strong>Properties();</span><span id="c9c0" class="kg kh hi kc b fi km kj l kk kl">   <em class="jt">// Set the brokers (bootstrap servers)<br/>   </em>kafkaProperties.setProperty(<strong class="kc hj">"bootstrap.servers"</strong>, <strong class="kc hj">"localhost:9091"</strong>);</span><span id="2656" class="kg kh hi kc b fi km kj l kk kl">   <em class="jt">// Set how to serialize key/value pairs<br/>   </em>kafkaProperties.setProperty(<strong class="kc hj">"key.serializer"</strong>, <strong class="kc hj">"org.apache.kafka.common.serialization.StringSerializer"</strong>);<br/>   kafkaProperties.setProperty(<strong class="kc hj">"value.serializer"</strong>, <strong class="kc hj">"org.apache.kafka.common.serialization.StringSerializer"</strong>);</span><span id="1323" class="kg kh hi kc b fi km kj l kk kl">   <em class="jt">// Create Kafka Producer<br/>   </em>Producer&lt;String, String&gt; producer = <strong class="kc hj">new </strong>KafkaProducer&lt;&gt;(kafkaProperties);</span><span id="c091" class="kg kh hi kc b fi km kj l kk kl">   <strong class="kc hj">for </strong>(<strong class="kc hj">int </strong>i = 100; i &lt; 200; i++) {</span><span id="3bee" class="kg kh hi kc b fi km kj l kk kl">      <em class="jt">//Create Producer Record with topic-name, key(optional), value<br/>      </em>ProducerRecord producerRecord = <strong class="kc hj">new </strong>ProducerRecord(<strong class="kc hj">"numbers"</strong>, Integer.<em class="jt">toString</em>(i));</span><span id="6f62" class="kg kh hi kc b fi km kj l kk kl">      <em class="jt">// Send producer record to kafka<br/>      </em>producer.send(producerRecord);<br/>   }<br/>   producer.close();<br/>}</span></pre></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><blockquote class="jv jw jx"><p id="223c" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">消费者API: </strong></p></blockquote><p id="6713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">消费者API帮助我们构建从Kafka集群读取数据的消费者。让我们配置消费者属性以从Kafka集群中读取数据，如下所示</p><ul class=""><li id="799d" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><strong class="ih hj"> bootstrap.servers </strong>:主机名/ip形式的kafka代理/服务器列表，带有要连接的端口详细信息。</li><li id="3e73" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> group.id </strong>:消费者的消费群id。</li><li id="823d" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> key.deserializer </strong>:配置key的反序列化类(例如:StringDeserializer)。</li><li id="66ed" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> value.deserializer </strong>:为value配置反序列化器类(例如:StringDeserializer)。</li><li id="9542" class="kn ko hi ih b ii lg im lh iq li iu lj iy lk jc ks kt ku kv bi translated"><strong class="ih hj"> auto.offset.reset </strong>:定义当没有提交位置或偏移量超出范围时消费者的行为(可以取“最早”、“最晚”——默认，“无”——手动处理)。</li></ul><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="45fe" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">private </strong>Properties getKafkaProperties() {</span><span id="b23e" class="kg kh hi kc b fi km kj l kk kl">    <em class="jt">// Configure the consumer<br/>    </em>Properties kafkaProperties = <strong class="kc hj">new </strong>Properties();</span><span id="90b6" class="kg kh hi kc b fi km kj l kk kl">    <em class="jt">// Point it to the brokers<br/>    </em>kafkaProperties.setProperty(<strong class="kc hj">"bootstrap.servers"</strong>, <strong class="kc hj">"localhost:9091"</strong>);</span><span id="d1b0" class="kg kh hi kc b fi km kj l kk kl">    <em class="jt">// Set the consumer group (all consumers must belong to a group).<br/>    </em>kafkaProperties.setProperty(<strong class="kc hj">"group.id"</strong>, <strong class="kc hj">"SHASR-NUMBERS"</strong>);</span><span id="abfc" class="kg kh hi kc b fi km kj l kk kl">    <em class="jt">// Set how to serialize key/value pairs<br/>    </em>kafkaProperties.setProperty(<strong class="kc hj">"key.deserializer"</strong>, <strong class="kc hj">"org.apache.kafka.common.serialization.StringDeserializer"</strong>);<br/>    kafkaProperties.setProperty(<strong class="kc hj">"value.deserializer"</strong>, <strong class="kc hj">"org.apache.kafka.common.serialization.StringDeserializer"</strong>);</span><span id="c9f8" class="kg kh hi kc b fi km kj l kk kl">    <em class="jt">// Read messages from the start.<br/>    </em>kafkaProperties.setProperty(<strong class="kc hj">"auto.offset.reset"</strong>, <strong class="kc hj">"earliest"</strong>);<br/>    <strong class="kc hj">return </strong>kafkaProperties;<br/>}</span></pre><p id="0e91" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">订阅(..)</em>:消费者订阅的主题列表。</p><p id="33b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">poll(Duration . of millis(100))</em>:poll方法接受以毫秒为单位的持续时间，以从订阅的主题中读取消息。</p><p id="aed6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt"> close() </em>:优雅地关闭消费者</p><pre class="je jf jg jh fd kb kc kd ke aw kf bi"><span id="a444" class="kg kh hi kc b fi ki kj l kk kl"><strong class="kc hj">public void </strong>readData() {</span><span id="7e67" class="kg kh hi kc b fi km kj l kk kl">    Properties kafkaProperties = getKafkaProperties();<br/>    <br/>    <strong class="kc hj">final </strong>KafkaConsumer&lt;String, String&gt; consumer = <strong class="kc hj">new </strong>KafkaConsumer&lt;&gt;(kafkaProperties);<br/>    consumer.subscribe(Collections.<em class="jt">singletonList</em>(<strong class="kc hj">kafkaTopic</strong>));</span><span id="91df" class="kg kh hi kc b fi km kj l kk kl">    <strong class="kc hj">try </strong>{<br/>        <strong class="kc hj">while </strong>(<strong class="kc hj">true</strong>) {<br/>            ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.<em class="jt">ofMillis</em>(100));<br/>            records.forEach(record -&gt; {<br/>                <em class="jt">// print the offset,key and value for the consumer records.<br/>                </em><strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"RECEIVED_TOPIC : {} "</strong>, record.topic());<br/>                <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"RECEIVED_PARTITION_ID : {} "</strong>, record.partition());<br/>                <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"OFFSET : {} "</strong>, record.offset());<br/>                <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"KEY : {} "</strong>, record.key());<br/>                <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"VALUE: {} "</strong>, record.value());<br/>                <strong class="kc hj"><em class="jt">log</em></strong>.info(<strong class="kc hj">"TIME: {}"</strong>, record.timestamp());<br/>            });<br/>        }<br/>    } <strong class="kc hj">finally </strong>{<br/>        consumer.close();<br/>    }<br/>}</span></pre><p id="358c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jt">输出:</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/64c61fe099f467e1c5016f3cf02000f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bgO2ri8SO8r8WtiGqnb6oA.png"/></div></div></figure><blockquote class="jv jw jx"><p id="2f84" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">完整代码库:<a class="ae ju" href="https://github.com/shashirl9/kafka-client-api" rel="noopener ugc nofollow" target="_blank"> GITHUB </a></p></blockquote></div><div class="ab cl kz la gp lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="hb hc hd he hf"><blockquote class="jv jw jx"><p id="6633" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">总结</strong>:</p></blockquote><p id="bb72" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我很高兴你坚持到最后，希望这个系列的第1部分有所帮助，我们经历了3个Kafka客户端API</p><ul class=""><li id="e23b" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><em class="jt">管理客户端API </em>:</li></ul><p id="6517" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">kafka的管理客户端，支持管理和检查主题、代理、配置和ACL。我们创建了新主题，描述了分区-领导者-副本-isr详细信息的主题，删除了主题。</p><ul class=""><li id="20f7" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><em class="jt">生产商API </em>:</li></ul><p id="639f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Producer API帮助我们构建基于代理和主题细节向Kafka集群发布记录的生产者。</p><ul class=""><li id="0001" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><em class="jt">消费者API </em>:</li></ul><p id="d1a8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">消费者API帮助我们构建消费者，这些消费者基于代理、主题和偏移重置细节从Kafka集群中读取数据。</p><blockquote class="jv jw jx"><p id="0079" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated"><strong class="ih hj">卡夫卡系列</strong>:</p></blockquote><ul class=""><li id="3a4b" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><a class="ae ju" rel="noopener" href="/nerd-for-tech/apache-kafka-quick-start-1edeef53773e"> Apache Kafka:快速启动</a> <br/> - <a class="ae ju" rel="noopener" href="/nerd-for-tech/kafka-connect-quick-start-e9249ec2bbaa"> Kafka Connect:快速启动</a> <br/> - <a class="ae ju" rel="noopener" href="/nerd-for-tech/steps-to-setup-kafka-cluster-on-local-and-docker-ae84324cde86">在Local/Docker中设置Kafka集群</a></li></ul><blockquote class="jv jw jx"><p id="9e1c" class="if ig jt ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">参考资料:</p></blockquote><ul class=""><li id="fed5" class="kn ko hi ih b ii ij im in iq kp iu kq iy kr jc ks kt ku kv bi translated"><a class="ae ju" href="https://kafka.apache.org/documentation.html#api" rel="noopener ugc nofollow" target="_blank">https://kafka.apache.org/documentation.html#api</a></li></ul></div></div>    
</body>
</html>