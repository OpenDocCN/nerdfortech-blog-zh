<html>
<head>
<title>PARTITION BY Clause in PostgreSQL The Easy Way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PostgreSQL中PARTITION BY子句的简单方法</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/partition-by-clause-in-postgresql-the-easy-way-10772ac41dfd?source=collection_archive---------2-----------------------#2021-02-14">https://medium.com/nerd-for-tech/partition-by-clause-in-postgresql-the-easy-way-10772ac41dfd?source=collection_archive---------2-----------------------#2021-02-14</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/5e5c663e4f04d94e4f94757ab6f3c164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g23FoWPA1YgI0UHSe_0pEg.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">米切尔·卡万在<a class="ae iu" href="https://unsplash.com/s/photos/light-background?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="fae7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当您使用数据库时，当您想要删除数据中的重复项时，通常会遇到这种情况。在本教程中，我们将了解如何通过选择最高值来删除重复项。</p><h1 id="3b0d" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h1><p id="602f" class="pw-post-body-paragraph iv iw hi ix b iy kr ja jb jc ks je jf jg kt ji jj jk ku jm jn jo kv jq jr js hb bi translated">假设我们有一个商店的顾客列表，我们想要每个顾客支付的最高价格。开始之前，让我们先来看看数据:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/215cb7abfe2e6c4b2ea26f33cdafbfa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*kDSxPS5txVPVARRacVt3Zw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">带有购买价格(购买)和购买日期(购买日期)的客户列表</figcaption></figure><p id="bb84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果我们以名为William的客户为例，他出现在第二行和第十二行。现在，我们希望筛选该表，使其只包含一个客户名称和他的最高价格。下一步是使用PARTITION BY子句。</p><h1 id="74f2" class="jt ju hi bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">分区依据子句</h1><figure class="kx ky kz la fd ij"><div class="bz dy l di"><div class="lb lc l"/></div></figure><p id="7e84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您在这个查询中看到的，我们按照从大到小的降序选择购买，然后我们只选择值为<strong class="ix hj"> 1 </strong>的行号。</p><p id="34c8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> ROW_NUMBER() OVER </strong>将给每一行一个连续的整数。由于我们使用的是<strong class="ix hj"> PARTITION BY (client_name) </strong>它将使用客户端名称，并在每次找到相同的客户端时分配一个唯一的整数。为了更好地理解整数是如何分配的，请看下图:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ld"><img src="../Images/bea1430c5a5608badb065db287772b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OeNYm3TkdPNWCLAFA6Ew1g.png"/></div></div></figure><p id="3d0b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您所看到的，对于同一个客户，基于<strong class="ix hj">购买列</strong>，我们有不同的<strong class="ix hj">row _ number</strong>。如果我们以名为<strong class="ix hj"> Santiago Pronto </strong>的客户为例，他的最大购买额是99.15美元。<strong class="ix hj">row _ number</strong>为1，因为我们对<strong class="ix hj">购买列</strong>进行了降序排序。他的第二大购买量是2辆，第三大购买量是3辆。</p><p id="00c9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">通过使用上面的查询，我们获得了没有重复值的最大购买量的客户名称:</p><figure class="kx ky kz la fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es le"><img src="../Images/d7f6646c02c266295e7daf1c0432c7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*LLWpmpgT1eEOP-uAtGYJVQ.png"/></div></div></figure><p id="dcbd" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以通过使用带有<strong class="ix hj"> max()函数</strong>的<strong class="ix hj"> group by </strong>来获得最高的购买，但是如果您想只按一列对您的值进行分组，并且仍然获得所有其他的值(例如<strong class="ix hj"> purchase_date </strong>，您将需要使用PARTITION BY子句。</p><p id="615c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">祝贺你完成这篇教程，我希望它至少能帮助你学到一两件事😃。</p></div></div>    
</body>
</html>