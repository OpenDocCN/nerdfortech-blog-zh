<html>
<head>
<title>Floating Point Rounding problem in Programming World</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编程世界中的浮点舍入问题</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/floating-point-rounding-problem-in-programming-world-86c5639c102c?source=collection_archive---------14-----------------------#2021-05-15">https://medium.com/nerd-for-tech/floating-point-rounding-problem-in-programming-world-86c5639c102c?source=collection_archive---------14-----------------------#2021-05-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/6be85d2e259bb927a283506d16e53158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JHz0PqvwkU1XUJ1d"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">由<a class="ae iu" href="https://unsplash.com/@volkanolmez?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">沃尔坎·奥尔梅斯</a>在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="3cf9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在开始任何事情之前，请看下面的java程序，</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="8063" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如何看待这段代码，当我打到0的时候会结束吗？。让我们看看输出，</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="925a" class="ke kf hi ka b fi kg kh l ki kj">10.0                                                                                                                    9.9                                                                                                                     9.799999                                                                                                                9.699999                                                                                                                9.599998                                                                                                                9.499998                                                                                                                9.399998                                                                                                                9.299997                                                                                                                9.199997                                                                                                                9.099997                                                                                                                8.999996                                                                                                                8.899996                                                                                                                8.799995                                                                                                                8.699995                                                                                                                8.599995                                                                                                                8.499994                                                                                                                8.399994                                                                                                                8.2999935                                                                                                               8.199993                                                                                                                8.099993                                                                                                                7.999993                                                                                                                7.899993                                                                                                                7.799993                                                                                                                7.699993                                                                                                                7.599993                                                                                                                7.4999933                                                                                                               7.3999934                                                                                                               7.2999935                                                                                                               7.1999936                                                                                                               7.0999937                                                                                                               6.999994                                                                                                                6.899994                                                                                                                6.799994                                                                                                                6.699994                                                                                                                6.599994                                                                                                                6.4999943                                                                                                               6.3999944                                                                                                               6.2999945                                                                                                               6.1999946                                                                                                               6.0999947                                                                                                               5.9999948                                                                                                               5.899995                                                                                                                5.799995                                                                                                                5.699995                                                                                                                5.599995                                                                                                                5.499995                                                                                                                5.3999953                                                                                                               5.2999954                                                                                                               5.1999955                                                                                                               5.0999956                                                                                                               4.9999957                                                                                                               4.899996                                                                                                                4.799996                                                                                                                4.699996                                                                                                                4.599996                                                                                                                4.499996                                                                                                                4.3999963                                                                                                               4.2999964                                                                                                               4.1999965                                                                                                               4.0999966                                                                                                               3.9999967                                                                                                               3.8999968                                                                                                               3.7999969                                                                                                               3.699997                                                                                                                3.599997                                                                                                                3.4999971                                                                                                               3.3999972                                                                                                               3.2999973                                                                                                               3.1999974                                                                                                               3.0999975                                                                                                               2.9999976                                                                                                               2.8999977                                                                                                               2.7999978                                                                                                               2.699998                                                                                                                2.599998                                                                                                                2.499998                                                                                                                2.3999982                                                                                                               2.2999983                                                                                                               2.1999984                                                                                                               2.0999985                                                                                                               1.9999985                                                                                                               1.8999984                                                                                                               1.7999984                                                                                                               1.6999984                                                                                                               1.5999984                                                                                                               1.4999983                                                                                                               1.3999983                                                                                                               1.2999983                                                                                                               1.1999983                                                                                                               1.0999982                                                                                                               0.9999982                                                                                                               0.8999982                                                                                                               0.79999816                                                                                                              0.69999814                                                                                                              0.5999981                                                                                                               0.49999812                                                                                                              0.39999813                                                                                                              0.29999813                                                                                                              0.19999814                                                                                                              0.09999814                                                                                                              -1.861155E-6                                                                                                            -0.100001864                                                                                                            -0.20000187                                                                                                             -0.30000186                                                                                                             -0.40000185                                                                                                             -0.50000185                                                                                                             -0.6000019                                                                                                              -0.7000019                                                                                                              -0.8000019                                                                                                              -0.90000194                                                                                                             -1.0000019                                                                                                              -1.1000019<br/>.<br/>.<br/>.<br/>.</span></pre><p id="4870" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这应该是10.0，9.9，9.8，…对吗？。然后发生了什么？。这一跑不停。我刚刚复制了几行输出显示在这里。这是因为IEEE 754浮点表示法。</p><h2 id="5cb4" class="ke kf hi bd kk kl km kn ko kp kq kr ks jg kt ku kv jk kw kx ky jo kz la lb lc bi translated">IEEE 754浮点表示法</h2><p id="c0f3" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">在计算机中，有一个技术标准叫做IEEE 754 ，用来表示浮点数。它有以下三个主要组成部分:</p><p id="5ba0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">符号— </strong>仅由二进制符号的一位组成，如果为1，则值为负，0为正。</p><p id="486d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">指数</strong> —表示指数时，应包括正值和负值。并且可以用2⁸位数来表示。<br/>范围是-128到127(这个127被称为<strong class="ix hj">指数偏差</strong>)，这意味着，如果科学记数法值中2的幂是正的，那么它必须加上as指数偏差并接受指数。</p><p id="da62" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj">尾数— </strong>尾数是以2为基数的科学记数法的二进制表示。在这里，只有科学记数法小数点后的值会被去掉。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es li"><img src="../Images/b3fc84cdbb01e8612abbfd8bc02acfa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1222/format:webp/1*4sSkhZ4EODs-iiVKvMZXHA.jpeg"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">IEEE的组件</figcaption></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/9f55d94e3d74934822c3538220f48a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JWfskpWlUQTgnZniAnYMzw.png"/></div></div></figure><p id="cbd2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们看一个例子，</p><p id="a37e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我将把<strong class="ix hj"> 9.1 </strong>转换成二进制，因为我们已经把<strong class="ix hj"> 9 </strong>转换成二进制，这给出了值<strong class="ix hj"> 1001。</strong>现在让我们转换0.1，这就是事情变得有趣的地方。它需要乘以2，直到两次变成1.0，所以让我们看看它是如何进行的，(这应该重复，直到你在系列中找到一个模式)。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lk"><img src="../Images/9251e8444d62fff7a76102edacdd8f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ek0kkFXzAemrHHOOg-IECw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">将0.1转换为二进制</figcaption></figure><p id="f3f5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我在上面的图中所示，它永远不会结束。所以阴影部分将作为一个集合重复。所以让我们写二进制格式，</p><p id="ac6a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于0.1👇</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="194d" class="ke kf hi ka b fi kg kh l ki kj">0001100110011001100…………</span></pre><p id="5acb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于9👇</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="0a46" class="ke kf hi ka b fi kg kh l ki kj">1001</span></pre><p id="7869" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以对于9.1👇</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="44e1" class="ke kf hi ka b fi kg kh l ki kj">1001.0001100110011001100…………</span></pre><p id="fa32" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是它在科学记数法中的样子，</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="3a14" class="ke kf hi ka b fi kg kh l ki kj">1.0010001100110011001100…… x 2³</span></pre><p id="31a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们用IEEE表示法来展示它。根据理论，如果功率为正，则应加上<strong class="ix hj">指数偏差(127) </strong>。在我们的例子中，它是3，也是正的。那么如果我们加上3+127就是130。现在让我们把它转换成二进制来得到指数部分。</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="523c" class="ke kf hi ka b fi kg kh l ki kj">10000010</span></pre><p id="fcc6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们看看尾数，它只需要23位，所以9.1的二进制值是1.0010001100110011001100……x ^ 2，尾数是<code class="du ll lm ln ka b">00100011001100110011001</code></p><p id="aa7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们写这个值，因为9.1是正数，所以符号位是零</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="1abc" class="ke kf hi ka b fi kg kh l ki kj"><strong class="ka hj">0 | 10000010 | 00100011001100110011001</strong></span></pre><p id="90fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，根据IEEE标准的表示是<strong class="ix hj">010000010001100110011001100110011001。</strong>但计算机做的是，如果第24位是1，它会在第23位加1(如果是0没关系)并存储。</p><p id="9d57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此答案将是<strong class="ix hj">01000001000100011001100110011010</strong>(因为在我们的例子中，第24位是1，所以它被添加到第23位)。即使你用计算器检查，你也会得到这个答案。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lo"><img src="../Images/ce0dfcf69f9b0103515a573b47865a1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qIz47mHlBpUaVB_quYzHEw.png"/></div></div></figure><p id="e45f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们看看，当我们把这个值转换回十进制时，答案是什么，</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lp"><img src="../Images/6e6db7faf89fc28698921e5f2498e259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyBqDCFSFvwYduqN6EvN3A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">二进制到十进制转换</figcaption></figure><p id="f119" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以这就是浮点舍入问题。这个问题有多种解决方案，一种是使用合适数据类型。在Java中(因为我是Java开发人员😏)我们可以用<strong class="ix hj"> BigDecimal </strong>来讨论一下。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h1 id="8847" class="lx kf hi bd kk ly lz ma ko mb mc md ks me mf mg kv mh mi mj ky mk ml mm lb mn bi translated">Java中的BigDecimal</h1><p id="fef8" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated"><code class="du ll lm ln ka b">BigDecimal</code>类是一个任意精度的有符号十进制数，提供算术、小数位数操作、舍入、比较、散列和格式转换等操作。这由两部分组成，</p><ul class=""><li id="cf7d" class="mo mp hi ix b iy iz jc jd jg mq jk mr jo ms js mt mu mv mw bi translated">未缩放的值—任意精度的整数。</li><li id="2a89" class="mo mp hi ix b iy mx jc my jg mz jk na jo nb js mt mu mv mw bi translated">小数位数—一个32位整数，表示小数点右侧的位数。</li></ul><p id="0b10" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们使用<strong class="ix hj"> <em class="nc"> BigDecimal </em> </strong>进行高精度运算。我们还将它用于需要控制比例和舍入行为的计算。在处理大浮点值和小浮点值时，它也有很好的准确性。为了初始化BigDecimal，它有许多构造函数。要构建BigDecimal对象，可以将整数、字符串或双精度值作为参数传递。</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="9755" class="ke kf hi ka b fi kg kh l ki kj">BigDecimal<!-- -->(int val)<br/>BigDecimal(String val)<br/>BigDecimal(double val)<br/>BigDecimal(BigInteger val)</span><span id="6282" class="ke kf hi ka b fi nd kh l ki kj">and more</span></pre><p id="2c85" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">它有很多我们可以使用的方法，</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="79dc" class="ke kf hi ka b fi kg kh l ki kj">add(<!-- -->BigDecimal <!-- -->augend)<br/>divide(<!-- -->BigDecimal <!-- -->divisor)<br/>compareTo(<!-- -->BigDecimal <!-- -->val)</span><span id="1980" class="ke kf hi ka b fi nd kh l ki kj">and more</span></pre><p id="e5f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们用BigDecimal来解决这个问题，</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="abf2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这里，我导入了<code class="du ll lm ln ka b">math</code>库，因为它有BigDecimal类。所以当我运行这个程序时，我得到了如下的输出，</p><pre class="jt ju jv jw fd jz ka kb kc aw kd bi"><span id="9b3d" class="ke kf hi ka b fi kg kh l ki kj">10<br/>9.9<br/>9.8<br/>9.7<br/>9.6<br/>9.5<br/>9.4<br/>9.3<br/>9.2<br/>9.1<br/>9.0<br/>8.9<br/>8.8<br/>8.7<br/>8.6<br/>8.5<br/>8.4<br/>8.3<br/>8.2<br/>8.1<br/>8.0<br/>7.9<br/>7.8<br/>7.7<br/>7.6<br/>7.5<br/>7.4<br/>7.3<br/>7.2<br/>7.1<br/>7.0<br/>6.9<br/>6.8<br/>6.7<br/>6.6<br/>6.5<br/>6.4<br/>6.3<br/>6.2<br/>6.1<br/>6.0<br/>5.9<br/>5.8<br/>5.7<br/>5.6<br/>5.5<br/>5.4<br/>5.3<br/>5.2<br/>5.1<br/>5.0<br/>4.9<br/>4.8<br/>4.7<br/>4.6<br/>4.5<br/>4.4<br/>4.3<br/>4.2<br/>4.1<br/>4.0<br/>3.9<br/>3.8<br/>3.7<br/>3.6<br/>3.5<br/>3.4<br/>3.3<br/>3.2<br/>3.1<br/>3.0<br/>2.9<br/>2.8<br/>2.7<br/>2.6<br/>2.5<br/>2.4<br/>2.3<br/>2.2<br/>2.1<br/>2.0<br/>1.9<br/>1.8<br/>1.7<br/>1.6<br/>1.5<br/>1.4<br/>1.3<br/>1.2<br/>1.1<br/>1.0<br/>0.9<br/>0.8<br/>0.7<br/>0.6<br/>0.5<br/>0.4<br/>0.3<br/>0.2<br/>0.1</span></pre><p id="c8ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">哒哒🥳.我们得到了答案。</p></div><div class="ab cl lq lr gp ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hb hc hd he hf"><h1 id="0691" class="lx kf hi bd kk ly lz ma ko mb mc md ks me mf mg kv mh mi mj ky mk ml mm lb mn bi translated">参考</h1><p id="6a14" class="pw-post-body-paragraph iv iw hi ix b iy ld ja jb jc le je jf jg lf ji jj jk lg jm jn jo lh jq jr js hb bi translated">我参考了下面的YouTube播放列表来写这篇文章，它是由<a class="ne nf ge" href="https://medium.com/u/26403c4bd160?source=post_page-----86c5639c102c--------------------------------" rel="noopener" target="_blank"> Krishantha Dinesh </a>制作的。</p><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ng jy l"/></div></figure><figure class="jt ju jv jw fd ij"><div class="bz dy l di"><div class="ng jy l"/></div></figure><p id="cabb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我还引用了以下内容来完成这篇文章，</p><div class="nh ni ez fb nj nk"><a href="https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab dw"><div class="nm ab nn cl cj no"><h2 class="bd hj fi z dy np ea eb nq ed ef hh bi translated">BigDecimal (Java平台SE 8)</h2><div class="nr l"><h3 class="bd b fi z dy np ea eb nq ed ef dx translated">为了简洁明了，在BigDecimal方法的描述中使用了伪代码。的…</h3></div><div class="ns l"><p class="bd b fp z dy np ea eb nq ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><div class="nh ni ez fb nj nk"><a href="https://www.baeldung.com/java-bigdecimal-biginteger" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab dw"><div class="nm ab nn cl cj no"><h2 class="bd hj fi z dy np ea eb nq ed ef hh bi translated">Java中的BigDecimal和big integer | bael dung</h2><div class="nr l"><h3 class="bd b fi z dy np ea eb nq ed ef dx translated">在本教程中，我们将演示BigDecimal和BigInteger类。我们将描述这两种数据类型，它们的…</h3></div><div class="ns l"><p class="bd b fp z dy np ea eb nq ed ef dx translated">www.baeldung.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny io nk"/></div></div></a></div></div></div>    
</body>
</html>