<html>
<head>
<title>Hacking your application may be easier than you think</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">入侵你的应用程序可能比你想象的要容易</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hacking-your-application-may-be-easier-than-you-think-c822d77ec58b?source=collection_archive---------7-----------------------#2021-02-18">https://medium.com/nerd-for-tech/hacking-your-application-may-be-easier-than-you-think-c822d77ec58b?source=collection_archive---------7-----------------------#2021-02-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c3e13a10be375d54dee27beea24a3982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2toPRoXlSmpVBCUoUoUWQ.jpeg"/></div></div></figure><p id="d3ef" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj">TL；博士</strong> : <br/>我注意到咖啡店订阅的每周邮件中有一个可疑的行为；它让我可以通过一个专用链接直接编辑我的偏好。我能够绕过cookie和认证令牌(没有诡计)，并能够达到一个帐户详情面板更改密码/帐户电子邮件等。从本质上来说，该商店暴露于严重的认证和授权问题，导致<a class="ae jo" href="https://portswigger.net/web-security/access-control/idor" rel="noopener ugc nofollow" target="_blank">IDOR<a class="ae jo" href="https://en.wikipedia.org/wiki/Personal_data" rel="noopener ugc nofollow" target="_blank">PII</a>的</a>(暴露私人身份信息)。最重要的是，CORS和CSRF都没有采取缓解措施，允许我创建一个恶意链接，导致一次点击账户接管。</p><p id="afac" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">免责声明:我不是建议任何人在没有明确同意的情况下做任何测试。作为我最喜欢的一家商店的<em class="jp">快乐的</em>顾客，我注意到了一个漏洞，并对我的账户被操纵的容易程度感到好奇。从那以后，好奇心驱使我进一步寻找这些漏洞。我努力保持尽可能少的“攻击性”行为，并向商店详细报告一切，以帮助他们减轻风险，提供我的帮助。</p><h1 id="c20f" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">这一切是如何开始的</h1><p id="072d" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我预订了伦敦最好的咖啡店之一。我每周都会收到一袋新烤的咖啡豆，还会收到一封电子邮件，建议我改变对咖啡豆的偏好或送货时间表。<br/>链接我用过很多次；当我想跳过一个递送，或者把它向前推，它是一个快速和简单的访问我的帐户。没有登录障碍或干扰—流畅而轻松的客户体验。<br/>出于某种原因，上周当我没有咖啡时，我将我的偏好更新为更早的发货，我注意到一些奇怪的事情:<strong class="is hj">意外删除链接令牌的一个字符没有关系。我仍然可以查看我的首选项的内容，进行更改和更新我的帐户。</strong></p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="7a39" class="lc jr hi ky b fi ld le l lf lg"># Original request leading to the panel<br/>https://coffee.shop/api/recurring/customers/&lt;user-hash&gt;/?token=1111111</span><span id="a6dc" class="lc jr hi ky b fi lh le l lf lg"># Using a different token (any token or none at all for that matter)<br/>https://coffee.shop/api/recurring/customers/&lt;user-hash&gt;/?token=qqqqqqq</span></pre></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><p id="797d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一点背景:这个商店是一个web应用程序，基于一个非常著名的使用Ruby的电子商务平台(试图避免完全公开，假设那些错误配置/bug在许多其他商店都存在)。网站本身并不是我见过的最漂亮的，但它完成了工作。基本的用户管理和一个方便的方式来改变我的首选交付非常容易和可定制的方式。</p><p id="a5e0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">回到故事:当我删除令牌时，我不仅可以访问我的帐户的交付首选项，还可以从匿名浏览器访问它。实质上意味着cookie验证也不存在。所以我从令牌和cookie中剥离了<code class="du lp lq lr ky b">GET</code>请求，并且能够从任何我想要的地方获取信息。这可能是第一个漏洞:<strong class="is hj">缺少对这个特定端点</strong>的认证。</p><p id="5d4b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">重要的是，这个bug对任何客户都是不可见的。对非经常性帐户(没有自动每周定期订单)和退订用户的更改需要经过身份验证过程。这是链接中的端点，它被设置为支持具有重复订单的订阅付费客户，使他们能够快速访问更改。端点看起来像这样:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="3437" class="lc jr hi ky b fi ld le l lf lg">https://coffee.shop/api/recurring/customers/&lt;unique-hash&gt;/?token=&lt;token&gt;</span></pre><p id="7369" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在这一点上，我试图将我的思维从一个担心的客户转移到一个攻击者身上— <em class="jp">如果我有恶意，我该怎么办？</em></p><p id="cd6d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我在preferences菜单上找到了一个<code class="du lp lq lr ky b">edit</code>链接，把我带到了一个可以更改我的详细信息的表单:<code class="du lp lq lr ky b">name</code>、<code class="du lp lq lr ky b">address</code>、<code class="du lp lq lr ky b">phone_number</code>，当然还有我的<code class="du lp lq lr ky b">email</code>地址(！).我强调电子邮件地址的原因是，这是通常会导致账户接管的领域。个人信息永远不应该被泄露，但它并不总是被认为是一个安全漏洞，而不受保护的电子邮件更改可能会破坏帐户。电子邮件地址是事实上的web应用程序帐户标识符。如果您控制了一个帐户的电子邮件地址，您就拥有它。控制地址可以用来重置密码，并从本质上控制帐户。</p><p id="b40f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">关于电子邮件地址保护的重要说明。更准确地说— <em class="jp">电子邮件地址更新</em>保护。更改帐户的电子邮件地址应该受到密码的保护。是的，即使用户已经通过<strong class="is hj">验证并登录。正是出于上述原因。API是不断变化的，它们中的大多数已经或将要在某个时候公开某些东西。对密码和电子邮件的更改设置另一层保护是一种常见且良好的做法。一旦这些受到保护，为了确保用户是“真实的”，他将被要求确认个人邮箱中的更改。无论这些是密码还是电子邮件更改，我们都认为对电子邮件地址和密码的控制是用户真实性的良好标识。</strong></p><p id="711b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">继续我的“旅程”，我请求更改我的电子邮件地址，将<code class="du lp lq lr ky b">+1</code>添加到用户名中，这样我就不会失去对帐户的控制(更改地址或使用同一个邮箱的多个帐户的常见做法是使用<code class="du lp lq lr ky b">+1</code>)。果然，请求通过了，我的账号也更新了。这意味着，任何有“咖啡偏好更新”链接的人，都可以接管我的账户信息，用我的信用卡买任何他们想要的东西。</p><p id="8e9b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">那么我该如何利用这一点呢？我试图通过展示POC向店主说明风险。为了利用CSRF攻击，我必须创建某种HTML表单并发送给客户，这样他们的cookie就会被添加到请求中。但是——不仅表单没有CSRF令牌，我还记得它根本没有被验证过。<br/>也没有合适的CORS接头。这意味着来自任何地方<strong class="is hj"/>的任何人<strong class="is hj">都可以使用<code class="du lp lq lr ky b">recurring/customer/edit</code>链接向商店的API发送一个<code class="du lp lq lr ky b">POST</code>请求，对账户进行修改。这是巨大的，因为CSRF通常通过危险的<code class="du lp lq lr ky b">GET</code>请求被利用。为了利用<code class="du lp lq lr ky b">POST</code>改变请求，必须用<a class="ae jo" href="https://portswigger.net/web-security/cross-site-scripting/stored" rel="noopener ugc nofollow" target="_blank"> <em class="jp">存储的XSS </em> </a> <em class="jp">(一种代码注入的形式，在这种情况下，可能会在应用程序中出现恶意链接)</em>链接攻击，供用户查看/点击。</strong></p><p id="82bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://omerxx.com/csrf-attacks/" rel="noopener ugc nofollow" target="_blank">查看我关于CSRF攻击和缓解的帖子</a></p><p id="2224" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因为饼干在这里没有作用，所有这些都不重要。这只是为了说明，如果是的话，单靠cookie验证并不是万无一失的解决方案。它是应该在顶层实现的不同安全层的基线。</p><h1 id="8e23" class="jq jr hi bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">报告</h1><p id="6186" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">我正在努力自学写<a class="ae jo" rel="noopener" href="/swlh/how-to-write-a-better-vulnerability-report-20163ab913fb">更好的漏洞报告</a>，所以我干净利落地向店主们透露了我所能透露的一切。我假设技术细节会被转发，所以强调<strong class="is hj">影响</strong>和漏洞带来的风险是很重要的。这让我想到了“为什么重要”这一部分。</p><figure class="kt ku kv kw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/0ac1c8a616b00775b7a08ae423c8733d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*avDvs4SolYFPIaGz.jpg"/></div></div></figure></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><h1 id="2fc5" class="jq jr hi bd js jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn bi translated">为什么重要！</h1><p id="3f94" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">互联网是海量的，并且呈指数级增长。随之而来的是用户和应用程序的增长，当然还有缺陷。作为一名开发人员，了解常见的风险以及如何测试它们，有助于我们作为一个社区构建更好的应用程序来支持更快乐(和更安全)的客户。在这种情况下，没有人想要任何伤害，但在完善客户体验的道路上，开发人员和产品所有者应该将风险与他们的利用的影响一起牢记在心。</p><p id="dae1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://www.ted.com/talks/keren_elazari_hackers_the_internet_s_immune_system" rel="noopener ugc nofollow" target="_blank">正如一个聪明的女人曾经说过的</a>:</p><blockquote class="ly lz ma"><p id="71d6" class="iq ir jp is b it iu iv iw ix iy iz ja mb jc jd je mc jg jh ji md jk jl jm jn hb bi translated"><em class="hi">黑客是互联网的免疫系统。</em></p></blockquote><p id="b3b3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">虽然我不能称自己为一个，但有许多高质量的bug bounty平台，拥有高技能的研究人员。我想鼓励有资源和方法的团队考虑开放他们的程序，私人的或有平台的。利用(并补偿)专业技能来发现安全漏洞并修复它们。</p><p id="586b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我真的希望这篇文章能启发其他人保护他们的客户。我也希望这能成为一个行动号召，让用户留意他们是如何与他们认为值得信赖的服务提供商沟通的。最后，我呼吁任何认为自己发现了什么的人到兔子洞里去报告。最坏的情况是什么都不会发生。另一方面，你可能挽救了信息泄露、盗用，甚至生命。</p></div><div class="ab cl li lj gp lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="hb hc hd he hf"><h1 id="40f8" class="jq jr hi bd js jt lt jv jw jx lu jz ka kb lv kd ke kf lw kh ki kj lx kl km kn bi translated">测试自己的漏洞</h1><p id="005a" class="pw-post-body-paragraph iq ir hi is b it ko iv iw ix kp iz ja jb kq jd je jf kr jh ji jj ks jl jm jn hb bi translated">开发人员经常过度信任安全管道、QA系统和他们自己导入的库。虽然这些都是发布过程的功能层，但是开发人员应该知道如何思考和运行针对他们自己的产品的基本测试。</p><p id="b09c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">思维过程大致如下:</p><ul class=""><li id="2b9e" class="me mf hi is b it iu ix iy jb mg jf mh jj mi jn mj mk ml mm bi translated">防止恶意参与者发出特定请求的安全机制是什么？</li><li id="57eb" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">如果我是一个黑客(或者是一个空闲时间太多的好奇工程师)，我会怎么绕过它？</li><li id="7bd2" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">我能简单地<em class="jp">而不是</em>使用饼干吗？我可以删除认证头吗？我能操纵饼干吗？我可以仅仅通过操作请求的端点/头/体/参数来改变我的角色吗？</li><li id="8885" class="me mf hi is b it mn ix mo jb mp jf mq jj mr jn mj mk ml mm bi translated">有没有其他有创意但显而易见的方法可以让人们以意想不到的方式使用系统？</li></ul><p id="f070" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是任何开发人员都应该问的部分问题，尤其是在构建和保护用户帐户时。添加了新的认证库？测试一下。更改了cookie加密？向您的应用程序管理系统添加角色？测试变化，尝试操纵系统，这不仅有趣而且健康。更进一步，在一次自我安全“戳”的冲刺中奉献半天。我知道这是我提高自己技能的一种方式，甚至曾经找到了一种方法，使我们的系统，建立在内部并服务于客户，是可以妥协的。但这是另一篇文章的另一个故事。</p><p id="ab3a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您的阅读！</p></div></div>    
</body>
</html>