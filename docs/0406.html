<html>
<head>
<title>Secure SharedPreferences Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">安全共享首选 Android</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/secure-sharedpreferences-android-9ba1e59f4250?source=collection_archive---------0-----------------------#2020-11-29">https://medium.com/nerd-for-tech/secure-sharedpreferences-android-9ba1e59f4250?source=collection_archive---------0-----------------------#2020-11-29</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="348f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇文章中，我们将学习如何使用<strong class="ih hj"> Jetpack 的安全库</strong>来加密我们在 Android 中的<strong class="ih hj"> SharedPreferences </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/2e7f0bf126538ff093f4792074ee0ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vZN1Tq_ecF69wDSPrJfreQ.png"/></div></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><p id="fbf0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">定义</strong>:一个<strong class="ih hj">加密密钥和值的<code class="du jw jx jy jz b"><a class="ae ka" href="https://developer.android.com/reference/android/content/SharedPreferences.html" rel="noopener ugc nofollow" target="_blank">SharedPreferences</a></code>实现。</strong></p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><ul class=""><li id="f9c2" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">首先，您需要在 app 模块的<strong class="ih hj"> build.gradle </strong>文件中添加以下依赖项。</li></ul><p id="d044" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">检查最新版本<a class="ae ka" href="https://developer.android.com/jetpack/androidx/versions" rel="noopener ugc nofollow" target="_blank">这里</a>为这个<strong class="ih hj">库</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/cc4a38a7593bd4c3c350a9217382df0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQpPdjzFO_UgWbhy-fm1zA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">安全库的依赖性</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><blockquote class="kp kq kr"><p id="dcf8" class="if ig ks ih b ii ij ik il im in io ip kt ir is it ku iv iw ix kv iz ja jb jc hb bi translated">只需同步您的项目，我们就可以开始了。</p></blockquote><ul class=""><li id="45d9" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">现在您可以轻松地创建<strong class="ih hj">加密的 SharedPrefernces 实例</strong>:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kw"><img src="../Images/91ad4d17131266146446284858a1256e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A0ovao4L135vn8U7iGbcoQ.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">创建加密的共享引用</figcaption></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><ul class=""><li id="809b" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">万能钥匙<strong class="ih hj">:</strong></li></ul><pre class="je jf jg jh fd kx jz ky kz aw la bi"><span id="6f95" class="lb lc hi jz b fi ld le l lf lg">val masterKey = MasterKey.Builder(<em class="ks">applicationContext</em>)<br/>    .build()</span></pre><p id="06d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它用于生成用于加密密钥和值的加密密钥。</p><ul class=""><li id="1507" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated"><strong class="ih hj"> PrefKeyEncryptionScheme。AES256_SIV : </strong>用来加密<strong class="ih hj">密钥🔑</strong></li><li id="5712" class="kb kc hi ih b ii lh im li iq lj iu lk iy ll jc kg kh ki kj bi translated"><strong class="ih hj"> PrefValueEncryptionScheme。AES256_GCM : </strong>用于加密数值</li></ul></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><ul class=""><li id="6b58" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">现在我们有了<strong class="ih hj">个共享的优先级</strong>。我们在里面加一些<strong class="ih hj">值</strong>吧。我们将使用<strong class="ih hj"> Android-KTX 库</strong>编写更简洁的代码:</li><li id="453a" class="kb kc hi ih b ii lh im li iq lj iu lk iy ll jc kg kh ki kj bi translated">你可以在这里了解更多关于<strong class="ih hj"> Android-KTX </strong> <a class="ae ka" href="https://developer.android.com/kotlin/ktx?gclid=Cj0KCQiAqo3-BRDoARIsAE5vnaL5EHH48WnqZFlq2DIbzKaqWv8NYeqJ2C67TaRKeGuLusWtxAzJdqsaAt0CEALw_wcB&amp;gclsrc=aw.ds" rel="noopener ugc nofollow" target="_blank">的信息。</a></li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lm"><img src="../Images/9c32169bfe56a1d242bc3ca59bdecc32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9V0CBi8m_Rozgbn7tUrvYA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx translated">在 SharedPreferences 中保存字符串值</figcaption></figure><ul class=""><li id="37b1" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">我们已经在我们的<strong class="ih hj">加密共享引用</strong>中保存了字符串类型的<strong class="ih hj">名称。</strong></li></ul><p id="e9d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们检查保存的 sharedPreferences 的<strong class="ih hj">内容，以确保值被保存为<strong class="ih hj">加密的</strong>。</strong></p><ul class=""><li id="2209" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">在<strong class="ih hj"> AndroidStudio </strong>中，你可以使用<strong class="ih hj">设备文件浏览器</strong>看到你连接的设备的数据/仿真器的<strong class="ih hj">数据。</strong></li></ul><p id="cdd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在<strong class="ih hj">data/data/your _ package _ name</strong>下，可以看到你的 app 的内容。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ln"><img src="../Images/204f7b117e975787e7989f89c43f1880.png" data-original-src="https://miro.medium.com/v2/resize:fit:328/format:webp/1*0bJQI797O1Q8iEWOLbwQyA.png"/></div></figure></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><ul class=""><li id="89a9" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">下面是<strong class="ih hj">加密共享偏好文件</strong>的<strong class="ih hj">内容</strong>:</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/9cc5772bbc928bfbff458544ca1742ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iBdHcAELLU221GHCOnqPNg.png"/></div></div></figure><p id="c203" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能想知道为什么存储了 3 个值，因为我们只输入了名字。</p><ul class=""><li id="5979" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated"><strong class="ih hj">EncryptedSharedPreferences</strong>存储<strong class="ih hj">键值</strong>，该键值用于<strong class="ih hj">加密<strong class="ih hj"> SharedPreference 文件</strong>中的<strong class="ih hj">值</strong>。</strong></li></ul></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h2 id="f9d0" class="lb lc hi bd lp lq lr ls lt lu lv lw lx iq ly lz ma iu mb mc md iy me mf mg mh bi translated">今天到此为止。我希望你能学到新东西。</h2><ul class=""><li id="848e" class="kb kc hi ih b ii mi im mj iq mk iu ml iy mm jc kg kh ki kj bi translated">下面是与本文相关的<strong class="ih hj">示例代码</strong>:</li></ul><div class="mn mo ez fb mp mq"><a href="https://github.com/navczydev/EncryptedPreferences" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">navczydev/EncryptedPreferences</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">Jetpack 的安全库实现 GitHub 是超过 5000 万开发者的家园，他们一起工作来托管和…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">github.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne jn mq"/></div></div></a></div></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="d262" class="nf lc hi bd lp ng nh ni lt nj nk nl lx nm nn no ma np nq nr md ns nt nu mg nv bi translated">保持联系:</h1><ul class=""><li id="5dc4" class="kb kc hi ih b ii mi im mj iq mk iu ml iy mm jc kg kh ki kj bi translated"><a class="ae ka" href="https://www.linkedin.com/in/navczydev/" rel="noopener ugc nofollow" target="_blank">领英</a></li><li id="ba01" class="kb kc hi ih b ii lh im li iq lj iu lk iy ll jc kg kh ki kj bi translated"><a class="ae ka" href="https://twitter.com/navczydev" rel="noopener ugc nofollow" target="_blank">推特</a></li></ul></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="392b" class="nf lc hi bd lp ng nh ni lt nj nk nl lx nm nn no ma np nq nr md ns nt nu mg nv bi translated">参考资料:</h1><div class="mn mo ez fb mp mq"><a href="https://developer.android.com/topic/security/data?authuser=1" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">安卓开发者</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">安全库提供了与在…上读写数据相关的安全最佳实践的实现</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">developer.android.com</p></div></div><div class="mz l"><div class="nw l nb nc nd mz ne jn mq"/></div></div></a></div><div class="mn mo ez fb mp mq"><a href="https://developer.android.com/kotlin/ktx?gclid=Cj0KCQiAqo3-BRDoARIsAE5vnaL5EHH48WnqZFlq2DIbzKaqWv8NYeqJ2C67TaRKeGuLusWtxAzJdqsaAt0CEALw_wcB&amp;gclsrc=aw.ds" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hj fi z dy mv ea eb mw ed ef hh bi translated">Android KTX | Android 开发者</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">Android KTX 是一组 Kotlin 扩展，包含在 Android Jetpack 和其他 Android 库中。KTX…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">developer.android.com</p></div></div><div class="mz l"><div class="nx l nb nc nd mz ne jn mq"/></div></div></a></div><h1 id="41e4" class="nf lc hi bd lp ng ny ni lt nj nz nl lx nm oa no ma np ob nr md ns oc nu mg nv bi translated">👏👏👏👏快乐编码👏👏👏👏</h1></div></div>    
</body>
</html>