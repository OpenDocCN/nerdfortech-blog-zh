<html>
<head>
<title>Resolve reusable Cell problem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决可重用单元问题</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/resolve-reusable-cell-problem-47476d17a0ed?source=collection_archive---------0-----------------------#2020-10-05">https://medium.com/nerd-for-tech/resolve-reusable-cell-problem-47476d17a0ed?source=collection_archive---------0-----------------------#2020-10-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><figure class="hh hi ez fb hj hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es hg"><img src="../Images/27e8cafff3802392903b0ff521726c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6wpKU33nShtKatAbZG2XgQ.jpeg"/></div></div></figure><div class=""/><p id="93ce" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你好，读者！</p><p id="4902" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天我想讨论一个大家都很熟悉的问题…那就是在一个<strong class="is hu"> UITableView </strong>或<strong class="is hu"> UICollectionView中重用不同类型的<strong class="is hu"> UITableViewCell </strong>或<strong class="is hu"> UICollectionViewCell </strong>。</strong></p><p id="4b69" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我见过多种方法，从差的(我认为它们是差的)依赖于<strong class="is hu"> <em class="jo"> if </em> </strong>或<strong class="is hu"> <em class="jo"> switch </em> </strong>语句，并检查实际上应该重用什么索引，然后<strong class="is hu">根据该索引将</strong>转换为类型，到更好的方法，其中出列被很好地分开。</p><p id="a681" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">糟糕的方法是这样的:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es jv"><img src="../Images/1f9420b49e5d24dfc78cbd5da343cf24.png" data-original-src="https://miro.medium.com/v2/resize:fit:550/format:webp/1*Ykl9zYyTPIarLjaTurPm8g.jpeg"/></div><figcaption class="jw jx et er es jy jz bd b be z dx translated">每当我看到上面这样的代码时，我的表情</figcaption></figure><p id="d604" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我有了一个想法:“这不可能是实现目标的唯一方法…”。</p><p id="39b5" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我开始在网上搜索不同的解决方案。我发现了非常好的解决方案，所以我不明白为什么开发者仍然使用这种非常不好的方法？我想到的唯一答案是因为这是<strong class="is hu">简单</strong>和<strong class="is hu">快写</strong>！<br/>你知道什么指标会是具体的那种类型那么为什么不这样做呢？</p><p id="c93e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我觉得这有点<strong class="is hu"> <em class="jo">【懒惰做法】</em> </strong></p><p id="c91a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这段代码的问题是它不容易修改，所以维护它是一件痛苦的事情……它很难维护，并且不允许我们重用一些特性。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="958a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在本文中，我想向您展示一种基于简单协议将不同种类的单元出队的方法。我想向您展示这种方法的主要概念，也许它会帮助您解决项目中的一些问题。</p><p id="658c" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们开始吧:</p><h2 id="7c3e" class="kh ki ht bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated"><strong class="ak">首先:</strong></h2><p id="6d02" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">创建一个解决上述情况的方案:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><h2 id="9ec7" class="kh ki ht bd kj kk kl km kn ko kp kq kr jb ks kt ku jf kv kw kx jj ky kz la lb bi translated"><strong class="ak">第二:</strong></h2><p id="e335" class="pw-post-body-paragraph iq ir ht is b it lc iv iw ix ld iz ja jb le jd je jf lf jh ji jj lg jl jm jn hb bi translated">声明我们的<strong class="is hu"> UICollectionView </strong>类:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="a4d6" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">到目前为止，我们已经有了<strong class="is hu"> CollectionView </strong>，当indexPath.item为偶数时显示<strong class="is hu"> FirstAmazingCell </strong>，否则显示<strong class="is hu"> SecondAmazingCell </strong>。</p></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="0d19" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">是时候使用我们的<strong class="is hu">collectionviewdequeue protocol</strong>来解开这个条件了。让我们添加一个方法来注入它，并将出列单元方法和numberOfItemsInSection的主体替换为CollectionView模型，该模型将包含我们的协议的实例:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure></div><div class="ab cl ka kb gp kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="hb hc hd he hf"><p id="5dc4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们现在需要一些数据来检验它是否有效。为此，我将使用我最喜欢的迷因角色之一<a class="ae lh" href="https://en.wikipedia.org/wiki/Pepe_the_Frog" rel="noopener ugc nofollow" target="_blank">佩佩悲伤青蛙。</a></p><figure class="jp jq jr js fd hk er es paragraph-image"><div class="er es li"><img src="../Images/b153708c31e655b33d45a76dbfbc112d.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*Cn-rLUBJSaB2KaERlgbVEg.jpeg"/></div></figure><p id="b85a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我已经在资产中添加了三个不同的Pepe图像，并模仿一些服务层来获取包含这些图像的数据以及应该显示多少元素。</p><p id="d5da" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">我的模拟:</strong></p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="7a2f" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我将在接下来的步骤中做什么:</p><ul class=""><li id="8812" class="lj lk ht is b it iu ix iy jb ll jf lm jj ln jn lo lp lq lr bi translated">创建三个<strong class="is hu"> UICollectionViewCell </strong>类来显示正确的佩佩图像，</li><li id="f48d" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">创建一个构建器，该构建器将初始化三种不同类型的实例<strong class="is hu">集合视图出列协议</strong>，</li><li id="10aa" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">将这些实例传递给<strong class="is hu"> CollectionView。</strong></li></ul><p id="11b8" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">建造者:</strong></p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="d6c2" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在将所有这些收集在一起并展示:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="7e57" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在，如果我们运行上面的代码，模拟器应该显示佩佩。一个例子:</p><figure class="jp jq jr js fd hk er es paragraph-image"><div role="button" tabindex="0" class="hl hm di hn bf ho"><div class="er es lx"><img src="../Images/2d1fdd0b3b5c34ad2d4beecc7e1e2fa8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IlmKAuWtYcTELlnD31X5Tw.png"/></div></div></figure><p id="bbff" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们还可以做更多的事情:</p><p id="63cb" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在<code class="du ly lz ma mb b"><a class="ae lh" href="https://developer.apple.com/documentation/uikit/uicollectionviewdatasource/1618029-collectionview" rel="noopener ugc nofollow" target="_blank">func collectionView(UICollectionView, cellForItemAt: IndexPath) -&gt; UICollectionViewCell</a></code>中，我们需要做的只是尽快返回出列的单元。设置<strong class="is hu"> CollectionView </strong>项将在UICollectionViewDelegate方法中进行:</p><p id="b940" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><code class="du ly lz ma mb b"><a class="ae lh" href="https://developer.apple.com/documentation/uikit/uicollectionviewdelegate/1618087-collectionview" rel="noopener ugc nofollow" target="_blank">func collectionView(UICollectionView, willDisplay: UICollectionViewCell, forItemAt: IndexPath)</a></code>。这一变化使得我们的单元在出队和显示时性能更好。</p><p id="24f4" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们为此创建另一个协议:</p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="6ccf" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">更新我们的课程:</p><p id="21db" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">集合视图:</strong></p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="dc0e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hu">建造者:</strong></p><figure class="jp jq jr js fd hk"><div class="bz dy l di"><div class="jt ju l"/></div></figure><p id="222b" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">仅此而已。搞定了。</p><h1 id="e047" class="mc ki ht bd kj md me mf kn mg mh mi kr mj mk ml ku mm mn mo kx mp mq mr la ms bi translated">结论:</h1><ul class=""><li id="dc1e" class="lj lk ht is b it lc ix ld jb mt jf mu jj mv jn lo lp lq lr bi translated">很好地将出队和项目设置与数据源分开，</li><li id="c395" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated"><strong class="is hu"> UICollectionDataSource </strong>和<strong class="is hu"> Delegate </strong>现在可以重用，</li><li id="a9a0" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">现在我们可以很容易地扩展新功能，</li><li id="1916" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">单元格与<strong class="is hu">uicollectionview data source</strong>或<strong class="is hu"> Delegate、</strong>之间没有紧密耦合</li><li id="5cdf" class="lj lk ht is b it ls ix lt jb lu jf lv jj lw jn lo lp lq lr bi translated">每个项目都有一个构建器，因此我们可以改变它的实现，而不用担心我们在其他项目的实现中改变了一些东西。</li></ul><p id="a59e" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">感谢您花时间阅读本文。</p><p id="469a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">祝你好运！</p><p id="a02a" class="pw-post-body-paragraph iq ir ht is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">完整代码:<a class="ae lh" href="https://github.com/Rafal-Prazynski/ReusableCell.Medium" rel="noopener ugc nofollow" target="_blank">https://github.com/Rafal-Prazynski/ReusableCell.Medium</a></p></div></div>    
</body>
</html>