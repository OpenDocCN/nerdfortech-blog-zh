<html>
<head>
<title>Hands-On Time-Series Forecasting in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python 中的实践时间序列预测</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hands-on-time-series-forecasting-in-python-33356389865d?source=collection_archive---------4-----------------------#2021-06-15">https://medium.com/nerd-for-tech/hands-on-time-series-forecasting-in-python-33356389865d?source=collection_archive---------4-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="f905" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">“预测的目标不是预测未来，而是告诉你你需要知道什么，以便在现在采取有意义的行动”~保罗·萨福</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/3dd67c12e163e7df4e01d294cb605009.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DX8_vgQIMIxjDrMq"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">图片由<a class="ae jn" href="https://unsplash.com/@chrisliverani" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在 Unsplash 上拍摄</figcaption></figure><p id="86a2" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">时间序列预测是统计学和数据科学中的一个重要概念。在这篇文章中，我将涉及时间序列分析的深入实践。</p><p id="ee75" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在开始 Python 代码之前，让我们讨论一些非常基本的时间序列分析要点。对于那些不熟悉它的人，我在参考资料中附加了一些链接，以获得时间序列分析的完整概述。</p><p id="691b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">众所周知，统计数据有三种类型:</p><ol class=""><li id="9693" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated"><strong class="jq hj">时间序列数据:</strong>一个变量在不同时间取值的一组观测值。</li><li id="032e" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">横截面数据:</strong>在同一时间点收集的一个或多个变量的数据。</li><li id="790f" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><strong class="jq hj">汇集数据:</strong>时间序列数据和横截面数据的组合。</li></ol><p id="d682" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，在一段时间内对一个变量的研究被称为时间序列分析。</p><p id="f487" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">时间序列分析的目标是理解产生序列的过程，并预测所研究变量的未来值。</p><p id="af6e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">时间序列有<strong class="jq hj"> 4 个组成部分</strong>:</p><ol class=""><li id="2986" class="kk kl hi jq b jr js ju jv jx km kb kn kf ko kj kp kq kr ks bi translated">趋势(T):这是数据随时间增加或减少的一般长期趋势。</li><li id="af60" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">季节性:它是非随机成分，定期重复出现。</li><li id="d83e" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">周期性[C]:周期超过一年的振荡运动是周期性变化。</li><li id="1d20" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">Random (R):时间序列的任何变动，如果不能用上述三个部分来解释，都被认为是随机变化。这些是无法预料的事件，饥荒等。</li></ol><p id="609e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们总是将时间序列分解成不同的部分，因为我们可能对某个特定的部分感兴趣。</p><h2 id="6b99" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated"><strong class="ak">时间序列的数学模型</strong></h2><ol class=""><li id="b996" class="kk kl hi jq b jr lt ju lu jx lv kb lw kf lx kj kp kq kr ks bi translated">加法:由-&gt;T+S+C+R 给出</li><li id="47fd" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated">乘法:它由-&gt;T*S*C*R 给出</li></ol><p id="456b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要了解这些型号的更多信息，请点击<a class="ae jn" href="https://www.toppr.com/guides/fundamentals-of-business-mathematics-and-statistics/time-series-analysis/models-of-time-series-analysis/" rel="noopener ugc nofollow" target="_blank">此处</a></p><p id="c708" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">一次，我们分解一个时间序列，基于数学模型的类型，我们可以分离各种成分。在本文的后面，我将展示如何使用 Python 来实现这一点。</p><p id="3ce4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ARIMA 和 ARMA 是时间序列数据分析和预测中常用的两种模型。</p><h1 id="d5a8" class="ly kz hi bd la lz ma mb le mc md me li io mf ip ll ir mg is lo iu mh iv lr mi bi translated"><strong class="ak"> ARMA </strong></h1><p id="24d1" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated">自回归移动平均线。它用 ARMA(p，q)表示。</p><p id="d8a4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在 AR 模型中，当前值被表示为有限个先前值和随机冲击的线性函数。</p><p id="d306" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在 MA 模型中，当前值被表示为当前和有限数量的先前冲击的线性函数。</p><p id="7d47" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">因此，ARMA 是这两者的结合。</p><p id="68b7" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">为了得到 p(滞后阶数)的值，我们使用 PACF(部分自相关函数)，对于 q(移动平均阶数)，我们使用 ACF(自相关函数)。</p><h1 id="172f" class="ly kz hi bd la lz ma mb le mc md me li io mf ip ll ir mg is lo iu mh iv lr mi bi translated"><strong class="ak"> ARIMA </strong></h1><p id="fcc0" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated">自回归综合移动平均。它由 ARIMA(p，d，q)表示。</p><p id="7a9e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">这个模型有 AR 和 MA，以及“I”部分。在这里,“整合”意味着差异。它的阶用 d 表示，称为“差分阶”。求差是为了使数列平稳。</p><p id="e51d" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">要阅读关于这些模型的更多内容，请转到本文的“参考资料”部分，并打开第二个链接。</p><h1 id="0c18" class="ly kz hi bd la lz ma mb le mc md me li io mf ip ll ir mg is lo iu mh iv lr mi bi translated">现在，让我们开始编码。</h1><p id="9691" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated"><strong class="jq hj">数据集信息:</strong>该数据集由 Cheenta 为他们的课程数据科学项目免费提供。他们正在建立一个数据科学社区，供每个人免费成长和学习。如果你想加入这个社区，<a class="ae jn" href="https://www.cheenta.com/data-science-projects-made-easy/" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><p id="62da" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">(附:这是<strong class="jq hj">不是</strong>一个推广帖或者评论。任何人都可以免费加入这个社区，与成员互动，做这些项目。所以，如果你想做项目并向他人学习，那就试试吧！)</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="34ab" class="ky kz hi mn b fi mr ms l mt mu">Description of dataset:</span><span id="13b8" class="ky kz hi mn b fi mv ms l mt mu">This dataset shows traffic to and from the Airport as a Percentage of the Traffic volume during the baseline period. The baseline period used for computing this metric is from 1st Feb to 15th March 2020.</span></pre><p id="602e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">导入必要的库</strong></p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="69ff" class="ky kz hi mn b fi mr ms l mt mu">import pandas as pd<br/>import numpy as np<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import warnings<br/>warnings.filterwarnings("ignore")</span></pre><p id="11a8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">获取数据</strong></p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="c715" class="ky kz hi mn b fi mr ms l mt mu">data = pd.read_excel('F:\Cheenta\Project1\covid_impact_on_airport_traffic.xlsx')<br/>data.head(2)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/f73d0a8cb93cad060c905f0e35d62033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wC9tOJYS3hXjDUeoKkLoAw.png"/></div></div></figure><p id="d1f5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">了解数据</strong></p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="2e49" class="ky kz hi mn b fi mr ms l mt mu">data.tail(2)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/10b5bba4f13251fc1e29d0e33b3c91f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DRVeTitSzbGlYgpO4fZqA.png"/></div></div></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="72c7" class="ky kz hi mn b fi mr ms l mt mu">data.describe(include='all')</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/c85115f24fa441cb935f7eae31862008.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9E9FkjDsT4VOmEBr1C7bHQ.png"/></div></div></figure><p id="b45b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">数据集中有 4 个国家、23 个州、27 个城市和 28 个机场。从 2010 年 3 月 16 日到 2010 年 2 月 12 日，共收集了 262 天的数据。</p><p id="e8b5" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">质心和国家是点和多边形结构，告诉我们它们是地理位置。</p><p id="0dd3" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，从计数中，我们可以看到，所有功能都没有丢失值。</p><h2 id="bee7" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated">删除不重要的功能</h2><p id="f78f" class="pw-post-body-paragraph jo jp hi jq b jr lt ij jt ju lu im jw jx mj jz ka kb mk kd ke kf ml kh ki kj hb bi translated">“地理”是一个多边形特征，这意味着它类似于形状。因此，我们可以得出结论，地理告诉我们一个机场的形状。因为我们的分析不需要它。我们会放弃的。</p><p id="1cca" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">同样的推理也适用于“质心”。质心可能告诉我们机场中心的纬度和经度。因为我们不需要那个。我们也会放弃。</p><p id="ee70" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">ISO_3166_2 是每个状态的唯一值。我们不需要它来进行时间序列分析。</p><p id="4489" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">AggregationMethod 始终是“每日”，因此，它不提供任何信息。我们可以移除它。</p><p id="f011" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">没有提供关于版本的信息。因此，我们将把它从我们的分析中剔除。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="497e" class="ky kz hi mn b fi mr ms l mt mu">data.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mx"><img src="../Images/ea557e11c3619e7301668395444fa2ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*ORC479sIVsV4klJHGhaSHw.png"/></div></figure><p id="c7f8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">单变量分析</strong></p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="4a1a" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(20,6))<br/>fig1 = sns.countplot(x = 'AirportName', data = data , palette='rainbow_r')<br/>fig1.set_xticklabels(fig1.get_xticklabels(), rotation=90)<br/>fig1.set_title("Count for various Airports")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es my"><img src="../Images/35569c30deef550c0961400d23ba6de4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V3Pw5bOlPCPGCDpkOWv0zA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">这表明除圣地亚哥国际机场和埃德蒙顿国际机场外，每个机场大约有 250 个数据点。</figcaption></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="6c43" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(20,6))<br/>fig2 = sns.countplot(x = 'City', data = data , palette='viridis')<br/>fig2.set_xticklabels(fig2.get_xticklabels(), rotation=90)<br/>fig2.set_title("Count for various City")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mz"><img src="../Images/efd4fae3c14328dc0d01e94511905a55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8UxMUipP9BYmlRgceXw5cA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">这表明除了纽约以外，所有城市在数据中的计数都或多或少相等。最有可能的原因是它有更多的机场。</figcaption></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="04dd" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(20,6))<br/>fig3 = sns.countplot(x = 'State', data = data , palette='cividis')<br/>fig3.set_xticklabels(fig3.get_xticklabels(), rotation=90)<br/>fig3.set_title("Count for various State")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/2ab0781886eec6b5b4b9f2f9f82a441c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ct8dERGILCVkRbj9C4kOuw.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">在这里，除了阿尔伯塔省、魁北克省、加利福尼亚州和纽约州，所有州的数据都相等。最有可能的原因还是机场的数量。我们将在对各国的深入分析中再次谈到这一点。</figcaption></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="f571" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(8,4))<br/>fig4 = sns.countplot(x = 'Country', data = data , palette='summer')<br/>fig4.set_xticklabels(fig4.get_xticklabels())<br/>fig4.set_title("Count for various Country")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nb"><img src="../Images/a1a608708676a896784fada26ce1282e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*y3u2BAO3j6sNdGCZ4XFbUA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">最大数据点是美国，其次是加拿大。这是因为美国和加拿大的机场数量可能比澳大利亚和智利多。</figcaption></figure><p id="4870" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated"><strong class="jq hj">检查我们对单变量图的推断</strong></p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="e850" class="ky kz hi mn b fi mr ms l mt mu">data.groupby("Country")['State','City','AirportName'].nunique()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nc"><img src="../Images/eb12a4bd6ea251246f5d990c05af8984.png" data-original-src="https://miro.medium.com/v2/resize:fit:698/format:webp/1*SUbRUF1Hixo-1Y7pmArdWA.png"/></div><figcaption class="jj jk et er es jl jm bd b be z dx translated">查看某个国家机场的表格</figcaption></figure><h2 id="00c7" class="ky kz hi bd la lb lc ld le lf lg lh li jx lj lk ll kb lm ln lo kf lp lq lr ls bi translated">双变量分析</h2><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="c5c8" class="ky kz hi mn b fi mr ms l mt mu">fig5 = sns.pairplot(data,hue='Country',height=5,palette='husl',aspect=1)<br/>fig5._legend.remove()<br/>plt.title("Distribution of Percent of Baseline for different countries")<br/>plt.legend(loc = 'upper right',bbox_to_anchor=(1.2, 0., 0.5, 0.5))<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nb"><img src="../Images/fa7f7c8798d92d3b8dca2323fe8f9753.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*Onb4b3Jyc0M8blJGIZ-u6A.png"/></div></figure><h1 id="76bf" class="ly kz hi bd la lz ma mb le mc md me li io mf ip ll ir mg is lo iu mh iv lr mi bi translated">智利分析</h1><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="92d6" class="ky kz hi mn b fi mr ms l mt mu"># Data on Chile is based on only one state which has one city with one airport named Santiago International airport.</span><span id="b46e" class="ky kz hi mn b fi mv ms l mt mu">data_chile <strong class="mn hj">=</strong> data_chile.sort_values(by<strong class="mn hj">=</strong>"Date")</span><span id="9358" class="ky kz hi mn b fi mv ms l mt mu">data_chile.set_index('Date',inplace<strong class="mn hj">=True</strong>)<br/>data_chile = data_chile.drop(columns=['AirportName','City','State','Country'])</span><span id="321c" class="ky kz hi mn b fi mv ms l mt mu">data_chile.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nd"><img src="../Images/1141fc03b63025a4aee1ac35ddf3e651.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*HtwOCpRJH_mCaAz1Q-m6dA.png"/></div></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="cef1" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(20,10))<br/>plt.plot(data_chile['PercentOfBaseline'])<br/>plt.title("Plot for PercentOfBaseline Vs Time for Chile")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/0822d2cd0798334408fe2f4e1709ca5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p711ZujRwzM4dHJJcbkLxA.png"/></div></div></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="7bc9" class="ky kz hi mn b fi mr ms l mt mu">from statsmodels.tsa.stattools import adfuller<br/>print('Results of Dickey-Fuller Test:')<br/>dftest = adfuller(data_chile['PercentOfBaseline'], autolag='AIC')<br/>dfoutput = pd.Series(dftest[0:4], index=['Test Statistic','p-value','#Lags Used','Number of Observations Used'])<br/>for key,value in dftest[4].items():<br/>    dfoutput['Critical Value (%s)'%key] = value<br/>print(dfoutput)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ne"><img src="../Images/3b060a925ac0aeb17eddb505ff5e3d6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*91-ZRfdgCDxwGHq1HjT_zQ.png"/></div></figure><p id="7517" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">Dickey-Fuller 检验:这是检验平稳性的统计检验之一。这里的零假设是 TS 是非平稳的。如果“检验统计量”小于“临界值”，我们可以拒绝零假设，说序列是平稳的。</p><p id="d554" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我们可以得出结论，我们的数据不是平稳的，因此，我们需要使它平稳，因为所有的时间序列模型都是平稳的。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="9afd" class="ky kz hi mn b fi mr ms l mt mu">#define function for kpss test<br/>from statsmodels.tsa.stattools import kpss<br/>#define KPSS<br/>print ('Results of KPSS Test:')<br/>kpsstest = kpss(data_chile['PercentOfBaseline'], regression='c')<br/>kpss_output = pd.Series(kpsstest[0:3], index=['Test Statistic','p-value','Lags Used'])<br/>for key,value in kpsstest[3].items():<br/>    kpss_output['Critical Value (%s)'%key] = value<br/>print (kpss_output)</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nf"><img src="../Images/188092be0b6bde836cfc06ce3a3432fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*y2LAHt-BViJT8Yp1IypBvg.png"/></div></div></figure><p id="ed23" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">KPSS 测试的作者定义了零假设，因为过程是趋势文具，到一个单位根序列的替代假设。KPSS 检验也表明我们的序列不是平稳的。</p><p id="4f58" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">有关更多信息，请参考本文的参考文献 4。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="ddcb" class="ky kz hi mn b fi mr ms l mt mu">data_chile['diff'] = data_chile['PercentOfBaseline'] - data_chile['PercentOfBaseline'].shift(1)<br/>plt.figure(figsize=(20,10))<br/>plt.plot(data_chile['diff'])<br/>plt.title("Plot for lagged PercentOfBaseline Vs Time for Chile")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/e7bd6a591ec03b03b9c8e78043871151.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vc4kwYI91R2P-OLZYHuhag.png"/></div></div></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="da62" class="ky kz hi mn b fi mr ms l mt mu">from statsmodels.tsa.seasonal import seasonal_decompose<br/>decomposition = seasonal_decompose(x=data_chile['PercentOfBaseline'].dropna(),model='multiplicative',freq=9)<br/>trend = decomposition.trend<br/>seasonal = decomposition.seasonal<br/>residual = decomposition.resid<br/>plt.figure(figsize=(10,10))<br/>plt.subplot(411)<br/>plt.plot(data_chile['PercentOfBaseline'], label='Original')<br/>plt.legend(loc='best')<br/>plt.subplot(412)<br/>plt.plot(trend, label='Trend')<br/>plt.legend(loc='best')<br/>plt.subplot(413)<br/>plt.plot(seasonal,label='Seasonality')<br/>plt.legend(loc='best')<br/>plt.subplot(414)<br/>plt.plot(residual, label='Residuals')<br/>plt.legend(loc='best')<br/>plt.tight_layout()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ng"><img src="../Images/3781034f00e7e414398fc73e362e32b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*5LOcngpEe8-mmzrOJMhO3A.png"/></div></figure><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="1401" class="ky kz hi mn b fi mr ms l mt mu">from statsmodels.graphics.tsaplots import plot_acf,plot_pacf<br/>plot_acf(data_chile['diff'].dropna(),zero=False)<br/>plt.xlim(0,20)<br/>plt.xticks(np.arange(0,20,1))<br/>plt.show() #q=1 or q=0</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nh"><img src="../Images/9c15a23383243af8b31ba0ebaafb58dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*FVeaEGQsyUmV8IAykHSoPw.png"/></div></figure><p id="c78b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">q 值由第一个显著滞后确定，在此之后，acf 值落在限值内(蓝色阴影)或变得不重要。这里 q=1。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="a4f8" class="ky kz hi mn b fi mr ms l mt mu">plot_pacf(data_chile['diff'].dropna(),zero=False,lags=40,method='ols',alpha=0.05)<br/>plt.xticks(np.arange(0,40,2))<br/>plt.show() # p=3,5</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es ni"><img src="../Images/42ce9c5a11e741091d7017057b0ce949.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Kag6PJNv_EY-D7sVjHmdZw.png"/></div></figure><p id="35e9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">同样，p 的值是 3。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="6bb6" class="ky kz hi mn b fi mr ms l mt mu">df = pd.DataFrame(data_chile['diff'])<br/>df.dropna(inplace=True)<br/>from statsmodels.tsa.arima_model import ARMA<br/># Create Training and Test<br/>train = df.iloc[:212]<br/>test = df.iloc[212:]<br/># Build Model<br/>model = ARMA(train, order=(6,0))  <br/>fitted = model.fit()  <br/>print(fitted.summary())</span><span id="a414" class="ky kz hi mn b fi mv ms l mt mu"># Forecast<br/>fc, se, conf = fitted.forecast(25, alpha=0.05)  # 95% conf</span><span id="45bb" class="ky kz hi mn b fi mv ms l mt mu"># Make as pandas series<br/>fc_series = pd.Series(fc, index=test.index)<br/>lower_series = pd.Series(conf[:, 0], index=test.index)<br/>upper_series = pd.Series(conf[:, 1], index=test.index)</span><span id="b80f" class="ky kz hi mn b fi mv ms l mt mu"># Plot<br/>plt.figure(figsize=(12,5), dpi=100)<br/>plt.plot(train, label='training')<br/>plt.plot(test, label='actual',color='r')<br/>plt.plot(fc_series, label='forecast',color='g')<br/>plt.fill_between(lower_series.index, lower_series, upper_series,color='g', alpha=.05)<br/>plt.title('Forecast vs Actuals')<br/>plt.legend(loc='best', fontsize=8)<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nj"><img src="../Images/d1deefab626254006cf3fa94c0a8a897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*qJez6xCtk3nAlAWFJD1kxg.png"/></div></figure><p id="c787" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">p 和 q 的值给了我们一个概念。我们必须运行接近这些值的各种模型，并选择最佳模型。最佳模型是具有最低 AIC、最高对数似然的模型，并且模型的系数必须是显著的。</p><p id="612f" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">提示:你可以在智利的基线百分比上使用 ARIMA(6，1，0)得到相同的模型。因为我之前已经区分了这个系列，所以在这里我没有使用 ARIMA。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nk"><img src="../Images/b7553f7b395136de5f464eacc098932a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WrzgM7LWD7GjjPuOWWjUpw.png"/></div></div></figure><h1 id="a1a0" class="ly kz hi bd la lz ma mb le mc md me li io mf ip ll ir mg is lo iu mh iv lr mi bi translated">针对美国的分析</h1><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="cb14" class="ky kz hi mn b fi mr ms l mt mu">data_US = data[data['Country']=='United States of America (the)']<br/>df1 = pd.DataFrame(data_US.groupby('Date',as_index=True)['PercentOfBaseline'].mean())<br/>df1.head()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es nl"><img src="../Images/44f4eff84f3409b9edae239bce5a3385.png" data-original-src="https://miro.medium.com/v2/resize:fit:416/format:webp/1*EMymGM3SjVbO1sd3fb3aFw.png"/></div></figure><p id="7c61" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">在这里，我们将意味着所有，因为在美国，我们有 16 个机场。因此，我们将取所有值的平均值，并对数据进行建模。</p><pre class="iy iz ja jb fd mm mn mo mp aw mq bi"><span id="ae20" class="ky kz hi mn b fi mr ms l mt mu">plt.figure(figsize=(20,10))<br/>plt.plot(df1)<br/>plt.title("Plot of USA's average PercentOfBaseline Vs Time")<br/>plt.show()</span></pre><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nm"><img src="../Images/b9bc5fe8d30e0f997260ba99a9e618be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nLwbailzQhT8jURLePikhg.png"/></div></div></figure><p id="8b7e" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">根据 ADF 测试，该序列随时间是平稳的。所以，我们直接建模，不需要差分。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nn"><img src="../Images/27d494ed3e2d15b7e915e4f6d923c5dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_Eb6TMEvnr0vsNdkFfoCYw.png"/></div></div></figure><p id="f751" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">该模型最好用 ARMA(1，2)来表示。</p><p id="8fc8" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">图表看起来像这样:</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es no"><img src="../Images/0a4afe9a68c8f1437017a42446e0e8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F1D5cA1rHa-hRYkZ4m2SxA.png"/></div></div></figure><p id="d3d9" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">我已经按顺序展示了分析中的主要步骤。要查看分析的所有步骤，请点击<a class="ae jn" href="https://github.com/Anjali001/Cheenta_DS_Projects/blob/c1e2a98d3e9b0b8271925d950798433c28be8db3/Project%201-%20Time%20Series%20Analysis%20for%20COVID%20Flights/code.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>查看我的知识库。</p><p id="0a24" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">此外，作为练习，您可以对澳大利亚和加拿大进行类似的分析。</p><p id="a4d4" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">希望你喜欢这篇文章。欢迎发表评论。</p></div><div class="ab cl np nq gp nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="hb hc hd he hf"><p id="bd0b" class="pw-post-body-paragraph jo jp hi jq b jr js ij jt ju jv im jw jx jy jz ka kb kc kd ke kf kg kh ki kj hb bi translated">更多关于数据科学的文章，请关注我的媒体。</p></div><div class="ab cl np nq gp nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="hb hc hd he hf"><h1 id="6069" class="ly kz hi bd la lz nw mb le mc nx me li io ny ip ll ir nz is lo iu oa iv lr mi bi translated">参考资料:</h1><ol class=""><li id="8014" class="kk kl hi jq b jr lt ju lu jx lv kb lw kf lx kj kp kq kr ks bi translated"><a class="ae jn" href="https://www.statisticssolutions.com/free-resources/directory-of-statistical-analyses/time-series-analysis/" rel="noopener ugc nofollow" target="_blank">https://www . statistics solutions . com/free-resources/directory-of-statistical-analyses/time-series-analysis/</a></li><li id="0c39" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="https://towardsdatascience.com/time-series-models-d9266f8ac7b0" rel="noopener" target="_blank">https://towards data science . com/time-series-models-d 9266 f 8 AC 7 b 0</a></li><li id="9e49" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="https://www.toppr.com/guides/fundamentals-of-business-mathematics-and-statistics/time-series-analysis/models-of-time-series-analysis/" rel="noopener ugc nofollow" target="_blank">https://www . toppr . com/guides/fundamentals-of-business-mathematics-and-statistics/time-series-analysis/models-of-time-series-analysis/</a></li><li id="4c17" class="kk kl hi jq b jr kt ju ku jx kv kb kw kf kx kj kp kq kr ks bi translated"><a class="ae jn" href="https://www.analyticsvidhya.com/blog/2018/09/non-stationary-time-series-python/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2018/09/non-stationary-time-series-python/</a></li></ol></div></div>    
</body>
</html>