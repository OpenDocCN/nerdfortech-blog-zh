<html>
<head>
<title>Play Bach: Let a Neural Network Play For You. Part 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">演奏巴赫:让一个神经网络为你演奏。第四部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/play-bach-let-a-neural-network-play-for-you-part-4-aec253deb385?source=collection_archive---------7-----------------------#2021-07-18">https://medium.com/nerd-for-tech/play-bach-let-a-neural-network-play-for-you-part-4-aec253deb385?source=collection_archive---------7-----------------------#2021-07-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cb6a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不知道如何演奏音乐。但是我仍然可以玩音乐。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/dea385b93a86fd12faf702dcd6d70c6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:496/format:webp/1*EYZGWrB6fMFUULNCrkmumQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">来源<a class="ae jt" href="https://www.wfmt.com/2017/05/31/composers-smile/" rel="noopener ugc nofollow" target="_blank">wfmt.com</a></figcaption></figure><blockquote class="ju jv jw"><p id="1c17" class="if ig jx ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">这是一系列文章的一部分，探讨了该项目的许多方面，包括静态MIDI文件生成、实时流、Tensorflow/Keras顺序和功能模型、LSTM、过拟合和欠拟合、注意机制、嵌入层、多头模型、概率分布、向TensorflowLite的转换、TPU/硬件加速器的使用、在多个平台(Raspberry PI、edge设备)上运行应用程序……</p></blockquote><p id="8ca4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">参见<a class="ae jt" href="https://pboudalier.medium.com/play-bach-let-a-neural-network-play-for-you-part-1-596e54b1c912" rel="noopener">第一部分</a>。第二部分。<a class="ae jt" rel="noopener" href="/nerd-for-tech/play-bach-let-a-neural-network-play-for-you-part-3-9f59c9a5d57f">第三部</a>。</p><p id="51dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">github 上有完整的代码<a class="ae jt" href="https://github.com/pabou38/play_bach" rel="noopener ugc nofollow" target="_blank"/></p><p id="ae36" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">到目前为止，我们已经生成了一个MIDI文件，并在我们的桌面上播放了它。有点无聊？</p><p id="ded4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们构建一个稍微好一点的用户界面，我们可以使用任何设备(智能手机、平板电脑、..)，<strong class="ih hj">从互联网上的任何地方</strong></p><p id="55da" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用例是跟你朋友吹牛，“看我造的”。</p><p id="fab8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你也可以听(希望)有趣的音乐，这是正在生成的，此时此刻，只为你。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kb kc l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">实时预测/流应用的高层架构。两个线程，通过队列通信。</figcaption></figure><p id="a66d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实时预测和流式应用程序由两个Python线程构成，通过队列通信，并由GUI(图形用户界面)控制</p><ul class=""><li id="3689" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated"><strong class="ih hj">预测线程</strong>加载已经训练好的模型，运行推理，并将预测的MIDI音符/和弦转换为<a class="ae jt" href="https://en.wikipedia.org/wiki/Pulse-code_modulation" rel="noopener ugc nofollow" target="_blank"> PCM </a>音频样本。PCM是一种对模拟声音信号进行数字编码的技术。这个“声音块”被放在一个队列中，预测线程继续进行下一个推理。</li><li id="edff" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">流媒体线程从队列中读取音频样本，并发送到智能手机的浏览器。浏览器将数据识别为PCM，并使用智能手机/平板电脑/桌面音频系统播放。然后，流式线程从队列中读取下一个音频样本。</li><li id="aadb" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated"><strong class="ih hj">GUI</strong>用于配置推理参数，启动预测线程，开始播放音乐。</li></ul><p id="6ae9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GUI、预测和流线程运行在功能强大到足以运行推理的服务器上。客户只需要一个浏览器和一个音响系统。</p><p id="34aa" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种双线程方法的目标是最大化并行性并提高服务器的整体性能。我们将在以后的文章中讨论低端平台上的性能和运行。</p><p id="6d30" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">预测线程使用<a class="ae jt" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> Tensorflow </a>进行推理，使用python F <a class="ae jt" href="https://www.fluidsynth.org/" rel="noopener ugc nofollow" target="_blank"> luidSynth </a>模块将midi代码转换成PCM。</p><p id="cc2a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">流媒体线程使用<a class="ae jt" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>，一个python微型网络服务器。</p><p id="e5ae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">GUI是使用REMI开发的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kr"><img src="../Images/6bba811d5d30f85dbb0a2b7209b53470.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*eaQjIwISSe-I_tNsWZCflw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GUI主屏幕</figcaption></figure><p id="8951" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">智能手机浏览器上的GUI允许:</p><ul class=""><li id="d338" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated">加载一个训练好的模型。到目前为止，我们根据<em class="jx">大提琴独奏组曲</em>训练了一个模型，但是<em class="jx">F大调第一勃兰登堡协奏曲</em> — BWV 1046，或者<em class="jx">圣诞清唱剧BWV 248……</em>怎么样</li><li id="e6b8" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">选择一种乐器来播放音乐。典型的SoundFont将带有10种乐器。</li><li id="9821" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">选择速度，即音乐的“速度”，单位为BPM(每分钟节拍数)。</li><li id="dfd8" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated">选择一个“温度”,这在某种程度上增加了网络预测的随机性。这可能会产生有趣、令人惊讶或怪异的音乐。</li></ul><p id="e069" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击播放，瞧…音乐将在您的设备上播放</p><p id="3d80" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还包括一些监控功能:<em class="jx">服务器测试</em>以“ping”推理/流服务器，<em class="jx">音频测试</em>以测试服务器上的音频子系统，以及Flask web服务器上的一些<em class="jx">统计数据</em>。</p><p id="8269" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">播放音乐时可以更改推断参数。当所有先前的预测都被播放时，更新的参数将被考虑。</p><blockquote class="ju jv jw"><p id="f4cb" class="if ig jx ih b ii ij ik il im in io ip jy ir is it jz iv iw ix ka iz ja jb jc hb bi translated">JSON文件用于配置GUI:GUI和web服务器的凭证、IP地址或DNS名称和端口</p></blockquote><pre class="je jf jg jh fd ks kt ku kv aw kw bi"><span id="cab3" class="kx ky hi kt b fi kz la l lb lc">{"user": "bach38",<br/>"password": "xxxxxx",<br/>"remi_port": 5012,<br/>"flask_port": 5011,<br/>"dns" : "<a class="ae jt" href="http://192.168.1.61" rel="noopener ugc nofollow" target="_blank">http://192.168.1.61</a>:"</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kr"><img src="../Images/b5f581b213451456ac296563f6481e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*snjntx6FO03kUr7PgTMBzw.jpeg"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">一些其他的GUI功能:快速指南、有用的链接(包括到本文的链接)</figcaption></figure><p id="125a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要启动推理/流/GUI服务器，请运行:</p><h2 id="1c3c" class="kx ky hi bd ld le lf lg lh li lj lk ll iq lm ln lo iu lp lq lr iy ls lt lu lv bi translated">p<strong class="ak">ython-m play _ Bach . py-ST</strong></h2></div><div class="ab cl lw lx gp ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="hb hc hd he hf"><p id="28d0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的经验是，这种应用程序的大部分复杂性(和代码行)不在深度学习模型定义中，而在准备数据以便它们可以馈入模型中，以及在设计如何在“现实世界应用程序”中使用预测中。获得一个预测(一个softmax —见第3部分)是好的，但是使用一个预测来驱动一个影响真实世界和“接触”最终用户的应用程序要好得多。当然，除非音乐真的很糟糕。</p><p id="3a85" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下一篇文章将讨论这个项目的另一个方面。</p><p id="c7fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与此同时，敬请关注！！！</p><p id="b759" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果你对细节不感兴趣，请不要越过这条线</p><p id="d782" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这一系列文章都是关于<em class="jx">监督学习的。</em>即用实例训练模型。在训练一个模型从猫中识别狗的情况下，将会有许多猫和狗的照片，每张<strong class="ih hj">标上</strong>为“猫”或“狗”。这意味着在某个时间，某个地方，有人做了给照片贴标签的工作，而这项工作必须由人看着照片来完成。当然，标记图片的数据库现在已经存在。</p><p id="37e2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们的案例确实是<em class="jx">监督学习</em>，但是我们足够幸运，不必显式标记训练数据。我们的数据结构会自动为我们提供标签(即正确答案)，因为这只是第41个注释。</p><p id="b436" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其他类型的学习(此处未涉及)包括:</p><ul class=""><li id="bcd7" class="kd ke hi ih b ii ij im in iq kf iu kg iy kh jc ki kj kk kl bi translated"><em class="jx">无监督学习</em>:当没有标签可用时，因为创建它们的成本太高，或者因为它们根本不存在，模型可以使用无监督学习方法来提取有关原始数据的信息，即，将数据聚类到具有共同特征的组中</li><li id="c027" class="kd ke hi ih b ii km im kn iq ko iu kp iy kq jc ki kj kk kl bi translated"><em class="jx">强化学习</em>:一个婴儿会很快学会‘火烧’。他/她试图(可能是随机地)与环境互动，并得到一个反馈，在这种情况下，一个负面的反馈，他/她会记住。在强化学习中，模型与环境交互，采取影响环境的行动，并作为回报获得“奖励”，奖励可以是积极的，也可以是消极的。该模型被训练成使奖励的长期价值最大化。一个典型的例子就是训练一个模型去玩一个游戏。迷人的东西…</li></ul><p id="e507" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，越界值得吗？</p></div></div>    
</body>
</html>