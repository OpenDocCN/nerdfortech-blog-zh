<html>
<head>
<title>Analyse the distribution of ages — Python Data Analysis series part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分析年龄分布Python数据分析系列第1部分</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/analyse-the-distribution-of-ages-python-data-analysis-series-part-1-cc0fb2ca7f36?source=collection_archive---------1-----------------------#2021-01-25">https://medium.com/nerd-for-tech/analyse-the-distribution-of-ages-python-data-analysis-series-part-1-cc0fb2ca7f36?source=collection_archive---------1-----------------------#2021-01-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/8fd35236e95adcddac06f9e5e5041f54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1arF95evqZMdGuhf"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">封面图片(<a class="ae iu" href="https://unsplash.com/photos/jD6eRgBpE0c" rel="noopener ugc nofollow" target="_blank">来源</a>)</figcaption></figure><p id="b310" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在发表了几篇关于使用Python进行数据分析的独立文章后，我决定以适当系列的形式分享我在以前个人项目中所做的一些工作。</p><p id="4b01" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个“Python数据分析”系列将由五篇文章组成，使用2020堆栈溢出开发者调查结果数据集解决不同的数据问题。我将向您展示如何使用pandas来解决数字和分类数据的问题，并在最后使用Plotly (Express)创建漂亮的可视化效果。</p><p id="6454" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">虽然我在这里只展示了一个Python脚本，但是每篇文章都有自己的Jupyter笔记本，上面有相同的代码和解释。在第5部分中，我们将把这些笔记本上传到Azure DataBricks workspace的云中。</p><p id="820e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">到本系列结束时，您将掌握数据转换和可视化的新概念，并开始使用云中数据科学的强大工具。</p><p id="3141" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">如果您想自己运行代码，您需要一些先决条件:</p><ul class=""><li id="255b" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">安装Python库:<a class="ae iu" href="https://pypi.org/project/pandas/" rel="noopener ugc nofollow" target="_blank">熊猫</a>、<a class="ae iu" href="https://pypi.org/project/plotly/" rel="noopener ugc nofollow" target="_blank"> Plotly </a>和<a class="ae iu" href="https://pypi.org/project/jupyter/" rel="noopener ugc nofollow" target="_blank"> Jupyter </a>(最后一个是运行笔记本用的)</li><li id="5797" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">下载2020年堆栈溢出开发者调查结果<a class="ae iu" href="https://insights.stackoverflow.com/survey" rel="noopener ugc nofollow" target="_blank">数据集</a></li></ul><p id="9110" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于代码本身，您可以使用本文提供的脚本，或者从<a class="ae iu" href="https://github.com/Ze1598/medium-articles/tree/master/Python%20Data%20Analysis%20series%20with%202020%20Stack%20Overflow%20survey" rel="noopener ugc nofollow" target="_blank"> my GitHub repository </a>下载Jupyter笔记本。这些笔记本本质上是这些文章的替代品，因为它们包含相同的代码和解释。主要的区别是文章有到系列的每个部分的链接。</p><p id="4d53" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于这些文章，我将首先解释目标，即最终目标和达到该解决方案所需的数据转换。之后，我将展示完整的Python脚本。此时，您可以单独通读一遍，或者看一下脚本并继续阅读文章中的解释。</p><p id="0a02" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，请记住，本系列不一定是针对熊猫和Python数据分析的完全初学者。当然，如果有解释，代码会更简单，但是我认为如果您已经对pandas和可视化库(如Matplotlib或Plotly)有了一定程度的了解，您会从这些系列中获得更多。</p><p id="f671" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，这里有一些方便的链接来浏览本系列的内容:</p><ul class=""><li id="712a" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">第2部分:<a class="ae iu" href="https://soulsinporto.medium.com/plot-an-histogram-of-annual-compensations-python-data-analysis-series-part-2-24d5d3bc4ed8" rel="noopener">绘制年度薪酬直方图</a></li><li id="dc43" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第3部分:<a class="ae iu" href="https://soulsinporto.medium.com/analyse-the-education-level-of-respondents-python-data-analysis-series-part-3-39fee072aba" rel="noopener">分析受访者的教育水平</a></li><li id="a506" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第4部分:<a class="ae iu" href="https://soulsinporto.medium.com/unpivot-delimited-data-python-data-analysis-series-part-4-145c06ab75ad" rel="noopener"> Unpivot分隔数据</a></li><li id="73d3" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第5部分:<a class="ae iu" href="https://soulsinporto.medium.com/move-your-jupyter-notebooks-to-an-azure-databricks-workspace-python-data-analysis-series-part-5-693f5de36450" rel="noopener">将您的Jupyter笔记本移动到Azure DataBricks工作区</a></li><li id="7b6d" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><a class="ae iu" href="https://github.com/Ze1598/medium-articles/blob/master/Python%20Data%20Analysis%20series%20with%202020%20Stack%20Overflow%20survey/Age%20of%20Respondents.ipynb" rel="noopener ugc nofollow" target="_blank">本文Jupyter笔记本</a></li></ul><p id="d21c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">事不宜迟，让我们开始今天的演示吧。</p><h1 id="d08b" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">分析受访者的年龄</h1><figure class="lg lh li lj fd ij er es paragraph-image"><div class="er es lf"><img src="../Images/3550d4702fe8d63d769649594d3d723f.png" data-original-src="https://miro.medium.com/v2/resize:fit:158/format:webp/1*qFwrj17xgRcslrhdd_BNqg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">数据预览</figcaption></figure><p id="6f04" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">对于第一篇文章，目标是绘制一个条形图，展示受访者年龄的频率。为此，我们需要过滤异常值/坏数据点的数据，并删除浮点年龄(是的，有年龄，如15.5岁)。还有一行用于删除空白的代码，尽管在应用过滤器后并不需要，但我还是将它包含在内，以向您展示未来工作中可能遇到的更多选项。剧情之前最不需要的就是得到每个年代的频率。</p><figure class="lg lh li lj fd ij"><div class="bz dy l di"><div class="lk ll l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">受访者的年龄</figcaption></figure><p id="e36e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这些演示的前8行代码完全相同。我们总是要从相同的位置导入相同的库和相同的数据集(当然，根据您在机器上的位置来更改CSV的位置)。</p><p id="5607" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">由于我们使用的是一列数据，完全没有调查中其他问题和答案的上下文，因此我们可以删除所有其他列，只保留年龄的一列(第10行)。</p><p id="3f44" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第12行和第13行用于一些探索性的数据分析。目标是找到数据的极限和异常值，即过滤掉哪些响应。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/603ab9c87287f2802f191664b3346caa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kdDNnUddw__iyZ2Gx80e9A.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">年龄的探索性数据分析</figcaption></figure><p id="3b33" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">散点图显示，接近100岁或更老的受访者可能不完全代表准确的数据点。此外，有一个门槛，在这个门槛上，儿童将太小而不能回答调查。</p><p id="b469" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，在第15行，我们只保留年龄在10到75岁之间的受访者。</p><pre class="lg lh li lj fd ln lo lp lq aw lr bi"><span id="7ed9" class="ls ki hi lo b fi lt lu l lv lw">data = data.query("(Age &gt;= 10) and (Age &lt;= 75)")</span></pre><p id="caf5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在第二幅图(第18行)中，我们可以看到年龄的分布更加均匀。</p><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/e8292b58d41e02a835d17d599e6f36c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UWvgEmGNMdqXOUNFBConCQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">过滤后年龄的探索性数据分析</figcaption></figure><p id="dd71" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步是删除浮点年龄(第21和22行)。通常，年龄被记录为整数值，所以我们将简单地删除那些浮点值。请记住，删除数据应始终经过仔细考虑。在这些文章中，为了简单起见，我们采取了简单的方法，但是在一个实际的项目中，还有其他的选择，比如向上/向下取整，用平均值代替，等等。</p><pre class="lg lh li lj fd ln lo lp lq aw lr bi"><span id="2e9e" class="ls ki hi lo b fi lt lu l lv lw">is_integer = lambda row: int(row["Age"]) == row["Age"]<br/>data = data[data.apply(is_integer, axis="columns")]</span></pre><p id="4349" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">列中的值表示为float，所以如果我们逐行进行，我们可以将整数表示与当前的数字表示进行比较。如果它们相同，则该数字是整数(例如23.0或45.0)；否则年龄是一个浮点数，我们丢弃它(例如15.5不同于15)。</p><p id="3ce0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">第25行使用<code class="du lx ly lz lo b">dropna</code>函数删除空白值，即使该列中没有空白(当我们过滤10–75范围时，它们被删除)。我使用该函数的目的是展示其潜力。有了这个电话</p><pre class="lg lh li lj fd ln lo lp lq aw lr bi"><span id="e92b" class="ls ki hi lo b fi lt lu l lv lw">data = data.dropna(axis="rows", how="any", subset=["Age"])</span></pre><p id="4a56" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">您了解到可以从两个轴(行或列)中删除空白，可以仅基于列的子集进行删除，并且可以选择如何删除:轴是否有任何空白值，或者轴是否需要所有数据点都为空白。</p><p id="04ff" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了获得年龄频率，在第28行用<code class="du lx ly lz lo b">value_counts</code>实现。</p><pre class="lg lh li lj fd ln lo lp lq aw lr bi"><span id="72b7" class="ls ki hi lo b fi lt lu l lv lw">age_counts = data["Age"].value_counts()</span></pre><p id="5d90" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">该方法返回一个熊猫序列，其中指数是“年龄”值，数据点是各自的频率。</p><p id="2bd1" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们可以将这个系列直接传递给Plotly，它能够将年龄和频率分配给绘图的正确维度。</p><pre class="lg lh li lj fd ln lo lp lq aw lr bi"><span id="2dda" class="ls ki hi lo b fi lt lu l lv lw">fig = px.bar(age_counts, title="Age of respondents")<br/>fig.update_layout(<br/>    xaxis_title = "Age",<br/>    yaxis_title = "Frequency",<br/>    title_x = 0.5, <br/>    showlegend = False<br/>)<br/>fig.show()</span></pre><figure class="lg lh li lj fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lm"><img src="../Images/9781eb0dd82b2a53d5be0f278ef94848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NqBaKV7dircUSa4u_cTfTw.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">结果</figcaption></figure><h1 id="0e8e" class="kh ki hi bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h1><p id="4a1d" class="pw-post-body-paragraph iv iw hi ix b iy ma ja jb jc mb je jf jg mc ji jj jk md jm jn jo me jq jr js hb bi translated">我们已经到了第一部分的结尾。“年龄”是一个相当简单的例子，但它适合第一部分。我们了解了“真实”数据的局限性，清理了这些数据，最终获得了我们想要的视觉效果。</p><p id="0f6e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在第2部分中，我们将使用另一列数字数据，但用于连续数据。换句话说，我们将查看宁滨数据来创建直方图。</p><p id="fcae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我离开您之前，这里是本系列的一些方便的链接:</p><ul class=""><li id="4e65" class="jt ju hi ix b iy iz jc jd jg jv jk jw jo jx js jy jz ka kb bi translated">第二部分:<a class="ae iu" href="https://soulsinporto.medium.com/plot-an-histogram-of-annual-compensations-python-data-analysis-series-part-2-24d5d3bc4ed8" rel="noopener">绘制年度薪酬直方图</a></li><li id="04c6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第3部分:<a class="ae iu" href="https://soulsinporto.medium.com/analyse-the-education-level-of-respondents-python-data-analysis-series-part-3-39fee072aba" rel="noopener">分析受访者的教育水平</a></li><li id="c4db" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第4部分:<a class="ae iu" href="https://soulsinporto.medium.com/unpivot-delimited-data-python-data-analysis-series-part-4-145c06ab75ad" rel="noopener"> Unpivot分隔数据</a></li><li id="5136" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated">第5部分:<a class="ae iu" href="https://soulsinporto.medium.com/move-your-jupyter-notebooks-to-an-azure-databricks-workspace-python-data-analysis-series-part-5-693f5de36450" rel="noopener">将你的Jupyter笔记本转移到Azure DataBricks工作区</a></li><li id="ebd6" class="jt ju hi ix b iy kc jc kd jg ke jk kf jo kg js jy jz ka kb bi translated"><a class="ae iu" href="https://github.com/Ze1598/medium-articles/tree/master/Python%20Data%20Analysis%20series%20with%202020%20Stack%20Overflow%20survey" rel="noopener ugc nofollow" target="_blank"> Jupyter系列笔记本</a></li></ul></div></div>    
</body>
</html>