<html>
<head>
<title>JIT Java | Just In Time (JIT) Compiler</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JIT Java |实时(JIT)编译器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/jit-java-just-in-time-jit-compiler-af1cc86fe53b?source=collection_archive---------3-----------------------#2021-09-20">https://medium.com/nerd-for-tech/jit-java-just-in-time-jit-compiler-af1cc86fe53b?source=collection_archive---------3-----------------------#2021-09-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/145fe490bc34d248faeb5ca3899a42ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pOLFirS0yJ2s28QpIQu6cA.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来自<a class="ae iu" href="https://www.pexels.com/photo/female-software-engineer-coding-on-computer-3861972/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> Pexels </a>的<a class="ae iu" href="https://www.pexels.com/@thisisengineering?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> ThisIsEngineering </a>摄影</figcaption></figure><p id="53ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">读者们，你们好！今天，我将在本文中讨论Java JIT编译器。其实这个JIT编译器是什么？和我们已经知道的正常编译一样吗？如果你很好奇，请务必阅读这篇文章。</p></div><div class="ab cl jt ju gp jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="hb hc hd he hf"><p id="74a8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我们进入JIT编译器之前，理解一个程序如何在我们的计算机上运行是至关重要的。我们可以把程序在计算机上的运行分为两种类型。</p><ol class=""><li id="9032" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">直接在我们的操作系统上执行程序。</li><li id="6250" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">在我们的操作系统上运行的虚拟机上执行程序</li></ol><p id="0d00" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">让我们谈一谈直接在OS上执行程序的问题。</p><p id="f041" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">假设你正在写一个C程序。所以在你写完之后，你就有了C代码或者源代码。接下来，您将使用cmd或您的IDE运行该代码。在这种情况下，运行在操作系统上的C编译器会将源代码转换成. exe文件。</p><blockquote class="ko kp kq"><p id="7596" class="iv iw kr ix b iy iz ja jb jc jd je jf ks jh ji jj kt jl jm jn ku jp jq jr js hb bi translated">编译器是一种软件程序，它将一种编程语言编写的计算机代码翻译成另一种语言。编译器用于将源代码从高级编程语言翻译成低级语言的程序。</p></blockquote><p id="6b7c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以我们终于有了一个可以直接运行我们操作系统的可执行文件。这个可执行文件是平台相关的。换句话说，如果您在Linux系统上运行C编译器，它将生成与Linux兼容的可执行文件。如果在Windows机器上执行，C编译器会生成一个与Windows兼容的可执行文件。(所以，我们可以把这个命名为原生代码)。所以在程序执行之后，我们可以得到由我们的OS直接运行的可执行文件。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kv"><img src="../Images/1f3c4416cc8f5ee8717029b0d0eeca69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*en_M-_NReaSnuO7LZwGfxg.jpeg"/></div></div></figure><h1 id="9da9" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">一个程序如何在虚拟机上运行？</h1><p id="6240" class="pw-post-body-paragraph iv iw hi ix b iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">我们将通过使用Java虚拟机(JVM)继续这一过程。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es md"><img src="../Images/30109067ebe412f96bcb725d4a538197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZAzYxBXnTKl6RGZ9jvZmvg.jpeg"/></div></div></figure><p id="9474" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是Java程序的完整执行。如你所见，与C程序不同，Java程序是编译和解释的。首先，我们来看看java代码的编译。</p><p id="fd7d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编译时有3个步骤。</p><ol class=""><li id="013f" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">编写Java代码(如图中的abc.java)</li><li id="c9f1" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">汇编</li><li id="d646" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">编译后获取字节码(abc。如图中的类文件)</li></ol><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/b354d5ea7f0283bce25fc1dd02909f61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NJdGKj43QMRf8qOSBht9Ew.jpeg"/></div></div></figure><p id="52f7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这个过程中，我们将首先编写我们的java代码，并将其保存为一个. java文件(abc.java)。因此，使用命令<code class="du mf mg mh mi b">javac abc.java</code>，接下来，我们将调用javac编译器，它将java代码转换成字节码。在这里我们可以得到。编译后的类文件(abc.class)。实际上，这个<strong class="ix hj">字节码</strong>不能被我们的操作系统直接理解。这只有我们RAM上的Java虚拟机才能理解。</p><p id="69d3" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">按照这个类比，虚拟机就是一个程序，让你在这个机器上运行一个程序(字节码)，而不是直接在操作系统上运行。当我们直接在操作系统上运行代码时，我们称之为本机代码，当我们在虚拟机上运行代码时，我们称之为字节码。</p><p id="94e6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这是java编译期的结束。现在接下来我们将转移到java程序的运行时间。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/b9fb2f5ff407e08f4f29a9e8ac4ecceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NsPJ7_X39F1SX1trZ3TcIA.jpeg"/></div></div></figure><p id="a2d6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在编译结束时，我们得到的字节码是一个. class文件。所以，接下来用<code class="du mf mg mh mi b">java abc</code>命令我们将加载<strong class="ix hj">。类</strong>文件/ <strong class="ix hj">字节码</strong>到JVM内部的<strong class="ix hj">类加载器</strong>中。</p><p id="235b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><em class="kr">了解一下JVM(java虚拟机)</em></p><div class="mk ml ez fb mm mn"><a href="https://en.wikipedia.org/wiki/Java_virtual_machine" rel="noopener  ugc nofollow" target="_blank"><div class="mo ab dw"><div class="mp ab mq cl cj mr"><h2 class="bd hj fi z dy ms ea eb mt ed ef hh bi translated">Java虚拟机-维基百科</h2><div class="mu l"><h3 class="bd b fi z dy ms ea eb mt ed ef dx translated">Java虚拟机(JVM)是一种虚拟机，它使计算机能够运行Java程序以及其他程序…</h3></div><div class="mv l"><p class="bd b fp z dy ms ea eb mt ed ef dx translated">en.wikipedia.org</p></div></div><div class="mw l"><div class="mx l my mz na mw nb io mn"/></div></div></a></div><p id="0397" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，JVM中的字节码验证器验证字节码，并确保它不会违反安全需求。紧接着，解释器或JIT(即时)编译器的调用发生了。(在这一节之后，我们将更详细地讨论JIT编译器。)当我们谈到解释器时，它通过逐行读取将字节码转换成机器码(原生代码)。</p><p id="1538" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编译器和解释器的主要区别在于，编译器一次将整个代码编译成机器码(本机代码)。而解释器通过逐行读取将代码转换成机器代码。所以我们可以说Java程序比其他语言如C慢，因为它在运行时使用解释器。</p><p id="6d3d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在解释程序解释完代码后，它被传送到操作系统并被执行。这就是程序如何在虚拟机中运行，而不是直接在操作系统上运行。</p><p id="f65b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在让我们进入主题，</p><h1 id="b012" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">实时(JIT)编译器</h1><p id="d8fb" class="pw-post-body-paragraph iv iw hi ix b iy ly ja jb jc lz je jf jg ma ji jj jk mb jm jn jo mc jq jr js hb bi translated">JIT编译器将重复出现的字节码代码块转换成解释器可以立即使用的机器码。在Java中，JIT是JVM的重要组成部分。与前一级相比，它将执行性能提高了10倍。换句话说，这是一个长期运行的计算机密集型应用程序，可以优化性能。它提高了Java应用程序在编译或执行过程中的性能。</p><p id="e3f8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">JIT编译器位于JVM内部。让我们看看JVM是如何组织的。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nc"><img src="../Images/656a92e9a8c4c60dcab9949bdbc1c4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jr9u4kZidlDWg4Q0FrILrw.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">JVM架构</figcaption></figure><p id="aaa9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">java虚拟机由3个组件组成</p><ol class=""><li id="b346" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">类加载器</li><li id="bc9c" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">运行时内存</li><li id="cf58" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">执行引擎</li></ol><p id="d33a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">JIT编译器位于执行引擎内部。在JVM中，执行引擎有几个子组件。对于JIT编译器的学习，我们只需要以下组件。</p><ol class=""><li id="2b74" class="ka kb hi ix b iy iz jc jd jg kc jk kd jo ke js kf kg kh ki bi translated">解释者</li><li id="4e31" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">JIT编译器</li><li id="92a8" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js kf kg kh ki bi translated">仿形铣床</li></ol><p id="3249" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我前面提到的，JIT编译器识别循环的程序块，并将它们转换成机器码。所以解释器不会一个接一个地转换那些重复出现的字节码。JIT编译器将把循环字节码的机器码提供给解释器执行。同样，JIT编译器优化了Java应用程序的性能。那么JIT编译器是如何识别循环代码块的呢？</p><p id="def0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为此，让我们看看执行引擎的组织。</p><figure class="kw kx ky kz fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es nd"><img src="../Images/68b237e31e49afaf4a6d54356851862b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lKGUU43M7YqhCl2ev0k2Sw.jpeg"/></div></div></figure><p id="41d5" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如您在图中看到的，profiler是负责识别重复代码块的组件。让我们看一个例子。</p><pre class="kw kx ky kz fd ne mi nf ng aw nh bi"><span id="0680" class="ni lb hi mi b fi nj nk l nl nm">public class Main {<br/>  static void myMethod() {<br/>    System.out.println("Hello World!");<br/>  }</span><span id="3b76" class="ni lb hi mi b fi nn nk l nl nm">public static void main(String[] args) {</span><span id="960f" class="ni lb hi mi b fi nn nk l nl nm">        do{<br/>             myMethod();<br/>          }while(true);    <br/>  }<br/>}</span></pre><p id="4861" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在javac编译器编译了这个java代码之后，我们得到了字节码。上述代码的字节码由解释器逐行执行。所以我们可以看到<code class="du mf mg mh mi b">myMethod()</code>正在多次调用。在这种情况下，探查器会将它识别为整个程序中重复出现的代码块。执行机器中的分析器维护一个计数器，该计数器对方法调用的次数进行计数。当这个计数超过JVM中预定义的<strong class="ix hj">阈值</strong>时，JIT编译器将其编译成本机代码，以便解释器在下一个<code class="du mf mg mh mi b">myMethod()</code>调用中使用该本机代码。如果特定的代码块通过了下一个阈值，JIT编译器不会在此时停止，JIT编译器会再次优化该代码块。这个过程分4个阶段进行。JIT编译器为此提供了两个编译器。C1和C2编译器是两种不同的编译器。对于C1编译器，我们称之为客户端编译器，对于C2编译器，我们称之为服务器编译器。</p><p id="689b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">1级、2级和3级的编译和优化由C1编译器处理。第4级编译和优化由C2编译器处理。</p><p id="52dc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，这并不是结束。JVM做了更多的努力来减少完成一项任务所需的时间。存在称为代码缓存的内存部分。它类似于我们计算机的高速缓冲存储器。它的内存有限，JVM标志可用于修改代码缓存。当一个代码块被多次调用时，JIT编译器将该方法放在代码缓存中，以便解释器可以快速访问该代码块。但是，由于这是一种折衷，JIT编译器不会将所有代码都添加到这个代码缓存中。JIT编译器在这方面很聪明，因为它可以实现最高的效率。</p><p id="b03e" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">简单来说，这就是JIT编译器优化java代码的方式。JIT编译既有优点也有缺点。</p><h1 id="d4ca" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">优势:</h1><ul class=""><li id="cd1b" class="ka kb hi ix b iy ly jc lz jg no jk np jo nq js nr kg kh ki bi translated">JIT编译器需要更少的内存。</li><li id="dd2d" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">程序启动后，JIT编译器运行。</li><li id="0595" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">当代码运行时，可以对其进行优化。</li><li id="2f38" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">可以最小化任何页面错误。</li><li id="c1b4" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">在同一页面上，一起使用的代码将被本地化。</li><li id="c0c4" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">可以使用不同级别的优化。</li></ul><h1 id="683b" class="la lb hi bd lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx bi translated">缺点:</h1><ul class=""><li id="cc37" class="ka kb hi ix b iy ly jc lz jg no jk np jo nq js nr kg kh ki bi translated">您的计算机可能需要很长时间才能启动。</li><li id="86dd" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">高速缓存被大量使用。</li><li id="a083" class="ka kb hi ix b iy kj jc kk jg kl jk km jo kn js nr kg kh ki bi translated">在Java应用程序中，这增加了复杂性。</li></ul><p id="e278" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">所以我的文章到此结束。这是我到目前为止学到的JIT编译器的一个小描述。我希望你能在我的文章中找到有用的东西。非常感谢💖。</p></div></div>    
</body>
</html>