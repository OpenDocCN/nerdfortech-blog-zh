<html>
<head>
<title>Going Serverless in Kubernetes using Kubeless</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Kubeless 在 Kubernetes 中实现无服务器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/going-serverless-in-kubernetes-using-kubeless-8ef83b3f2f89?source=collection_archive---------4-----------------------#2021-06-19">https://medium.com/nerd-for-tech/going-serverless-in-kubernetes-using-kubeless-8ef83b3f2f89?source=collection_archive---------4-----------------------#2021-06-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="a30d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用 Kubeless 的 Kubernetes 中的无服务器</p><p id="6060" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那么，你们中有多少人在 IT 之旅中至少遇到过一次“无服务器”这个术语呢？Boom，我猜你们中的很多人可能听说过这个术语，他们中的大多数人也在使用这些概念来运行他们的生产环境。您的应用程序也在 Kubernetes 上运行吗？如果是的话，无服务器和 Kubernetes 是一个致命的组合。我从我的一些同行那里听说，将 Kubernetes 与任何与云无关的无服务器组件集成真的很难，因为这可能会使他们更难迁移到不同的云。因此，他们专注于 Kubernetes 的本地使用的解决方案，并且可以在 Kubernetes 集群上运行。市场上有许多在 Kubernetes 上运行无服务器工作负载的选择。Ex Openfaas、knative、kubeless 等。在这篇文章中，我将带你了解比特纳米的《无知识的世界》。是一个 Kubernetes-native 无服务器框架，允许您部署少量代码，而不必担心底层基础设施管道。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/d82f466a95c253c8ee8b26c05f2f84ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7tDfJxvdS67oFOEHHg-Z1A.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图片来源:<a class="ae jd" href="https://github.com/kubeless/kubeless" rel="noopener ugc nofollow" target="_blank">无袖</a></figcaption></figure><h1 id="d0c5" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">整个故事是关于什么的？(TLDR)</h1><ol class=""><li id="eea3" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">理解 kubeless 的概念。</li><li id="6f61" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">使用 Golang 编写一个无库函数。</li><li id="fcdf" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">使用 HTTP 触发器来触发无库 Golang 函数。</li></ol><h1 id="82c0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">先决条件</h1><ol class=""><li id="73a6" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">Kubernetes 集群(可以是本地、AKS、EKS、GKE、Kind)。</li><li id="564e" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">头盔，已安装 kubectl。</li></ol><h1 id="9628" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">故事资源</h1><ol class=""><li id="f465" class="ks kt hi ih b ii ku im kv iq kw iu kx iy ky jc kz la lb lc bi translated">GitHub 链接:【https://github.com/pavan-kumar-99/medium-manifests T4】</li><li id="03ed" class="ks kt hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">GitHub 分支:<a class="ae jd" href="https://github.com/pavan-kumar-99/medium-manifests/tree/kubeless" rel="noopener ugc nofollow" target="_blank">kubless</a>。</li></ol><h2 id="d3d9" class="li jv hi bd jw lj lk ll ka lm ln lo ke iq lp lq ki iu lr ls km iy lt lu kq lv bi translated">安装无库设备</h2><p id="d161" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq lw is it iu lx iw ix iy ly ja jb jc hb bi translated">Kubeless 附带了多个 yaml 文件来支持 RBAC 和非 RBAC 集群。你可以在这里找到 yaml 文件<a class="ae jd" href="https://github.com/kubeless/kubeless/releases" rel="noopener ugc nofollow" target="_blank"/>。默认情况下，Kubeless 安装在<strong class="ih hj"> kubeless </strong>名称空间中。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="c1ff" class="li jv hi ma b fi me mf l mg mh">$ kubectl create ns kubeless</span><span id="6107" class="li jv hi ma b fi mi mf l mg mh">$ kubectl create -f https://github.com/kubeless/kubeless/releases/download/v1.0.8/kubeless-v1.0.8.yaml</span></pre><p id="a897" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了 yaml 文件，您应该可以找到在 kubless 名称空间中创建的 kubless 控制器管理器。你还应该找到 CRD 的类似功能，HTTP 触发器，cronjob 触发器创建。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mj"><img src="../Images/33ba20e1cee8e47402a3e4bf7a1470b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QgDHCgVC3eZbdYvPeBRbjA.png"/></div></div></figure><p id="e35d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们在这里安装无库二进制文件<a class="ae jd" href="https://github.com/kubeless/kubeless/releases" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/5d97ad4fde93819237e7ee2fdcfe25e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rrz8vi0EOURsqipJsqLHzw.png"/></div></div></figure><p id="d258" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一旦安装了无库二进制文件，您就可以通过以下方式找到服务器配置和运行时配置</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="f88f" class="li jv hi ma b fi me mf l mg mh"><strong class="ma hj">$ kubeless get-server-config</strong></span><span id="8434" class="li jv hi ma b fi mi mf l mg mh">INFO[0000] Current Server Config:</span><span id="59c8" class="li jv hi ma b fi mi mf l mg mh">INFO[0000] Supported Runtimes are: ballerina0.981.0, dotnetcore2.0, dotnetcore2.1, dotnetcore2.2, dotnetcore3.1, go1.13, go1.14, java1.8, java11, nodejs10, nodejs12, nodejs14, php7.2, php7.3, php7.4, python3.6, python3.7, python3.8, ruby2.3, ruby2.4, ruby2.5, ruby2.6, jvm1.8, nodejs_distroless8, nodejsCE8, vertx1.8</span></pre><p id="ae66" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，我们现在已经准备好了所有的安装工作。让我们现在行动起来。在我们开始触发第一个无库函数之前，让我们先了解一下无库函数的基本术语和贯穿本文的 Go 代码。</p><p id="89cb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">无功能</strong></p><p id="fb41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">函数是无库的主要单位。Kubeless 中的函数可以用 java、python、ruby、go 等多种语言编写。每当一个函数通过 HTTP 调用、cron 触发器等被触发时，它接收两个参数。事件和背景。事件可以被认为是常规功能的输入。而上下文可以被认为是包含元数据的属性。</p><p id="d5a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">触发</strong></p><p id="7926" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">触发器是一段代码，它将自动响应(或调用一个函数)事件，如 HTTP 调用、生命周期事件或某个时间表。kubeless 目前可用的触发器有<br/> a) HTTP 触发器<br/> b) CronJob 触发器<br/> c) Kafka 触发器<br/> d) NATS 触发器</p><p id="0cbc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文的范围内，我们将使用带有 HTTP 触发器的 Go 函数。下面是样例 Go 代码，它将一个环境变量键作为输入，并打印其相应的值。在实时场景中，您可能有许多更复杂的用例。我们将这篇文章限制为初学者理解概念，然后在我后面的文章中涵盖许多其他复杂的用例。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">样本 Go 代码</figcaption></figure><p id="2898" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建第一个无库函数</strong></p><p id="797c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">无库函数可以用两种方法创建。使用 Kubeless 二进制文件，另一个是通过 Yaml 文件。让我们在本文中涵盖这两种方法。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="0835" class="li jv hi ma b fi me mf l mg mh">$<strong class="ma hj"> </strong>git clone <a class="ae jd" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b kubeless </span><span id="2a1e" class="li jv hi ma b fi mi mf l mg mh">$ cd medium-manifests/env-go </span><span id="374f" class="li jv hi ma b fi mi mf l mg mh">$ kubeless function deploy env-get-go --runtime go1.13 --handler env-check.Foo --from-file env-check.go</span><span id="d291" class="li jv hi ma b fi mi mf l mg mh"><strong class="ma hj">INFO[0000] Deploying function...<br/>INFO[0000] Function env-get-go submitted for deployment<br/>INFO[0000] Check the deployment status executing 'kubeless function ls env-get-go'</strong></span></pre><p id="baba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Yaas，你的第一个函数现在已经部署好了。您可以使用命令检查创建的函数</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="907f" class="li jv hi ma b fi me mf l mg mh">$<strong class="ma hj"> </strong>kubeless function ls </span><span id="3881" class="li jv hi ma b fi mi mf l mg mh">$ kubectl get all -l function=env-get-go</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mm"><img src="../Images/39b05eb3d7153d3edcf2d0fdbc64b126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vxh2mmxvxVt485X_87sjwg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">由 kubeless 创建的组件</figcaption></figure><p id="f87b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">好了，你的函数正在运行。下一步做什么？让我们使用 HTTP 触发器来调用这个函数。你需要一个入口控制器来让公众使用你的功能。您可以使用任何入口控制器。我们将在本文中使用 Nginx 入口控制器。现在让我们使用 Helm 安装入口控制器。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="5248" class="li jv hi ma b fi me mf l mg mh">$<strong class="ma hj"> </strong>helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx</span><span id="e165" class="li jv hi ma b fi mi mf l mg mh">$ helm repo update<br/><br/>$ helm install ingress-nginx ingress-nginx/ingress-nginx</span><span id="f786" class="li jv hi ma b fi mi mf l mg mh">$ kubectl get pods -l app.kubernetes.io/name=ingress-nginx </span></pre><p id="fd93" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，Kubernetes 集群中应该运行了一个入口控制器。</p><p id="ae37" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们使用 kubes 命令创建一个 HTTP 触发器。如果您仔细观察我的命令，我会创建一个名为<strong class="ih hj">env-get-go-HTTP-trigger</strong>的 HTTP 触发事件，路径为 env。这意味着我们将能够通过向端点<strong class="ih hj">HTTP://&lt;ingress-IP&gt;/env 发送 HTTP 请求来调用该函数。</strong></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">无库命令</figcaption></figure><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="75a0" class="li jv hi ma b fi me mf l mg mh"><strong class="ma hj">##Create a HTTP trigger</strong></span><span id="680b" class="li jv hi ma b fi mi mf l mg mh">$<strong class="ma hj"> </strong>kubeless trigger http create env-get-go-http-trigger --function-name env-get-go --path env </span><span id="c9f0" class="li jv hi ma b fi mi mf l mg mh"><strong class="ma hj">##Get the IP of the Ingress resource</strong></span><span id="0bb0" class="li jv hi ma b fi mi mf l mg mh">$ ip=$(kubectl get ing env-get-go-http-trigger -o jsonpath='{.status.loadBalancer.ingress[0].ip}')</span><span id="9df8" class="li jv hi ma b fi mi mf l mg mh"><strong class="ma hj">##Get the hostname of the Ingress resource</strong></span><span id="1e5f" class="li jv hi ma b fi mi mf l mg mh">$ host=$(kubectl get ing env-get-go-http-trigger -o jsonpath='{.spec.rules[0].host}')</span><span id="86be" class="li jv hi ma b fi mi mf l mg mh"><strong class="ma hj">##Invoke the function by triggering a HTTP request</strong></span><span id="272d" class="li jv hi ma b fi mi mf l mg mh">$ curl --data 'HOSTNAME'   --header "Host: $host"   --header "Content-Type:application/json" $ip/env;echo</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mn"><img src="../Images/b63dbf9f44c974ab2997540acea895c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzxsEBZNMWq9m5qj7ClIlw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">无库 HTTP 触发器</figcaption></figure><p id="72fc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">厉害！！觉得有趣吗？欢迎在评论区发表评论。我们已经看到了如何使用无库命令。拥有清单并将它们存储在任何版本控制系统(可能是 Git)中怎么样？).是的，kubeless 提供了生成 YAML 清单的选项。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mo"><img src="../Images/d64637687cd0f98c7cbdee38d6db8ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*z1i-4ZHdCohndM4m.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">你是对的！！！</figcaption></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="mk ml l"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">生成无库清单的命令</figcaption></figure><p id="a572" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我还把清单上传到了我的 GitHub Repo。</p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="705c" class="li jv hi ma b fi me mf l mg mh">$ git clone <a class="ae jd" href="https://github.com/pavan-kumar-99/medium-manifests.git" rel="noopener ugc nofollow" target="_blank">https://github.com/pavan-kumar-99/medium-manifests.git</a> \<br/>-b kubeless</span><span id="425e" class="li jv hi ma b fi mi mf l mg mh">$ cd medium-manifests/ </span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es mp"><img src="../Images/1f75bd62edf8a8c4a4f81f4526b9c598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L5gBWccJ7ZiewIUOlt5V7g.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">样本无库布函数</figcaption></figure><p id="e2be" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">清理</strong></p><pre class="jf jg jh ji fd lz ma mb mc aw md bi"><span id="46d0" class="li jv hi ma b fi me mf l mg mh">$ kubeless function delete env-get-go </span><span id="75ab" class="li jv hi ma b fi mi mf l mg mh">$ kubeless trigger http delete env-get-go-http-trigger </span></pre><p id="2465" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望这涵盖了在 Kubernetes 中使用 kubeless 开始使用无服务器所需的概念和术语。请随时在 Kubernetes 上评论您的无服务器想法和您的无服务器最佳体验。</p><p id="c632" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不久之后……..</p><h1 id="3cb0" class="ju jv hi bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">被推荐的</h1><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/free-and-automatic-ssl-certificates-in-kubernetes-using-cert-manager-6fb65ac63d5"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">使用证书管理器在 Kubernetes 中免费提供自动 SSL 证书</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">使用证书管理器获得免费的自动 SSL 证书，让我们加密</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh jo mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/chaos-engineering-in-kubernetes-using-chaos-mesh-431c1587ef0a"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">基于混沌网格的 Kubernetes 混沌工程</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">基于混沌网格的 Kubernetes 混沌工程</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">用混沌 Meshmedium.com 研究库伯内特的混沌工程</p></div></div><div class="nc l"><div class="ni l ne nf ng nc nh jo mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/deep-dive-into-thanos-part-i-f72ecba39f76"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">深入灭霸——第一部分</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">使用灭霸和普罗米修斯操作员监控 Kubernetes 的工作负载</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nj l ne nf ng nc nh jo mt"/></div></div></a></div><div class="mq mr ez fb ms mt"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/network-policies-demystified-in-kubernetes-d57fc2548043"><div class="mu ab dw"><div class="mv ab mw cl cj mx"><h2 class="bd hj fi z dy my ea eb mz ed ef hh bi translated">Kubernetes 揭秘网络政策</h2><div class="na l"><h3 class="bd b fi z dy my ea eb mz ed ef dx translated">使用 Cilium 编辑器在 Kubernetes 中可视化网络策略</h3></div><div class="nb l"><p class="bd b fp z dy my ea eb mz ed ef dx translated">medium.com</p></div></div><div class="nc l"><div class="nk l ne nf ng nc nh jo mt"/></div></div></a></div></div></div>    
</body>
</html>