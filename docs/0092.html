<html>
<head>
<title>Home DevOps Pipeline: A junior engineer’s tale (4/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">家庭开发管道:一个初级工程师的故事(4/4)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e?source=collection_archive---------3-----------------------#2020-02-12">https://medium.com/nerd-for-tech/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e?source=collection_archive---------3-----------------------#2020-02-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="fa53" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">内容:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">，(</em><a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"><em class="jd">4</em></a><em class="jd">)</em></p><p id="3006" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这一系列文章中，我将解释我是如何使用几个 Raspberry Pis 和许多软件构建自己的家庭开发环境的。这些文章中引用的代码可以在这里找到<a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">。在本文中，我将介绍我的管道监控，并讨论几个问题。</a></p><blockquote class="jf"><p id="ac48" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">🔗在 Github 上获取 Home DevOps 管道代码📔</a></p></blockquote><h1 id="e5f8" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">监视</h1><p id="9ac5" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我最初想监控我的开发管道的正常运行时间是<a class="ae je" href="https://uptimerobot.com" rel="noopener ugc nofollow" target="_blank">upimerobot</a>，这是一个免费的服务，它会定期发出 pings，如果失败，会通过电子邮件发出警报。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ks"><img src="../Images/1f84882c38ebf353c9e7f1dbc6524201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P3Fo0Q2f0Lj6tdMc2jlp-g.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">示例电子邮件</figcaption></figure><p id="8476" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，能够在一个网络应用中监控和修复你的开发管道是非常棒的，portainer 在这一点上做得非常好。</p><p id="5e07" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个应用程序是伟大的，比我想解释的更多的功能。但是它允许检查容器日志、容器中的 ssh，甚至部署新的映像——控制和监视多个主机。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es li"><img src="../Images/ac1e47da22aa3dc0b19a9c96019b3ee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-xqPs9IjWgKjlfXLq1pxQ.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx translated">运行中的 Portainer</figcaption></figure><p id="27e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了运行 portainer，我将它添加到我的代码 docker-compose 模板中:</p><pre class="kt ku kv kw fd lj lk ll lm aw ln bi"><span id="d5d7" class="lo jq hi lk b fi lp lq l lr ls">portainer:<br/>  image: portainer/portainer<br/>  command: -H unix:///var/run/docker.sock<br/>  restart: always<br/>  networks:<br/>  - homereponet<br/>  ports:<br/>  - 9000:9000<br/>  - 8000:9000<br/>  volumes:<br/>  - /var/run/docker.sock:/var/run/docker.sock<br/>  - /mnt/hdd/portainer:/data<br/>  labels:<br/>  - "traefik.enable=true"<br/>  - traefik.backend=portainer<br/>  - traefik.portainer.frontend.rule=Host:portainer.&lt;domain&gt;<br/>  - traefik.docker.network=homereponet<br/>  - traefik.portainer.port=9000</span></pre><h2 id="b2f7" class="lo jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">结束了</h2><p id="002b" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">这个故事到此为止。我认为这是一个很好的开端，任何人都希望有一个行业风格的开发管道。概括一下，最后的设置是:</p><p id="c916" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae je" href="https://gitea.io/" rel="noopener ugc nofollow" target="_blank"> Gitea </a>仓库用于存储代码，使用<a class="ae je" href="https://git-lfs.github.com" rel="noopener ugc nofollow" target="_blank"> git LFS </a>用于大型媒体文件。<a class="ae je" href="https://docs.drone.io/" rel="noopener ugc nofollow" target="_blank">无人机 CI </a>构建容器，将它们存储在<a class="ae je" href="https://docs.docker.com/registry/deploying/" rel="noopener ugc nofollow" target="_blank"> Docker 注册表</a>，并使用<a class="ae je" href="http://plugins.drone.io/drone-plugins/drone-ansible/" rel="noopener ugc nofollow" target="_blank"> Ansible </a>插件部署到一组本地机器，以及<a class="ae je" href="https://hub.docker.com/r/t3chflicks/aws-cfn" rel="noopener ugc nofollow" target="_blank"> cloudformation 插件</a>用于 AWS 部署。<a class="ae je" href="https://www.portainer.io/" rel="noopener ugc nofollow" target="_blank"> Portainer </a>用于监视和控制 UI 中的容器。<a class="ae je" href="https://docs.traefik.io/" rel="noopener ugc nofollow" target="_blank"> Traefik </a>对于带有<a class="ae je" href="https://letsencrypt.org/docs/" rel="noopener ugc nofollow" target="_blank">的反向代理，让我们在一个自由的</a><a class="ae je" href="https://www.duckdns.org/" rel="noopener ugc nofollow" target="_blank"> duckdns </a>域上加密自由 https 证书。所有的存储都在硬盘上完成，并且会定期备份到 AWS s3 。</p><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mg"><img src="../Images/4955c3cba11b572c645ace9f8bbbf3c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GvyXyJ4Z3xJ4vIcN.png"/></div></div></figure><p id="ad73" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望您喜欢这一系列文章。我还在<a class="ae je" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w?view_as=subscriber" rel="noopener ugc nofollow" target="_blank"> T3chFlicks </a>上制作了更多的项目，包括其他硬件、3D 打印、智能家居应用和视频形式的机器学习——请查看我们的网站。</p><h2 id="e37c" class="lo jq hi bd jr lt lu lv jv lw lx ly jz iq lz ma kd iu mb mc kh iy md me kl mf bi translated">附录</h2><p id="fc7d" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">代号:<a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">https://gitlab.com/t3chflicks/home-repo</a></p><p id="2276" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我一路上学到的一些随机的事情:</p><ul class=""><li id="9b16" class="mh mi hi ih b ii ij im in iq mj iu mk iy ml jc mm mn mo mp bi translated">Docker-compose 必须在启动时所在的目录中进行控制</li><li id="80c2" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">需要为 aws s3 创建策略，因为您只希望 pi 和根 aws 用户能够访问 bucket 并添加加密</li><li id="3ff1" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">需要更多地研究备份技术</li><li id="6b86" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">s3 在 10 天后备份到 glacier，这意味着存储成本保持较低</li><li id="ce0a" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">树莓 Pi 4 有两个 usb 3.0 接口和两个 2.0 接口。</li><li id="1d1a" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">使用 EXFAT 驱动器而不是 HFS+会导致 Postgres 容器失败</li><li id="5537" class="mh mi hi ih b ii mq im mr iq ms iu mt iy mu jc mm mn mo mp bi translated">Gitea 上的 ssh 无法使用端口 22，因为我还没有解决权限问题。为了解决这个问题，我更改了路由器的转发端口，允许 ssh 端口在可接受的范围内(1065+)</li></ul><p id="c99f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">内容:</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-1-4-336ed07a6ec0"> <em class="jd"> 1 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-2-4-7be3e3c292c"> <em class="jd"> 2 </em> </a> <em class="jd">，</em> <a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-3-4-5f61c5245934"> <em class="jd"> 3 </em> </a> <em class="jd">，(</em><a class="ae je" rel="noopener" href="/@t3chflicks/home-devops-pipeline-a-junior-engineers-tale-4-4-5db7c1610e3e"><em class="jd">4</em></a><em class="jd">)</em></p><blockquote class="jf"><p id="b1c3" class="jg jh hi bd ji jj jk jl jm jn jo jc dx translated"><a class="ae je" href="https://github.com/sk-t3ch/home-repo" rel="noopener ugc nofollow" target="_blank">🔗在 Github 上获取 Home DevOps 管道代码📔</a></p></blockquote><h1 id="e13b" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">感谢阅读</h1><p id="83b2" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我希望你喜欢这篇文章。如果你喜欢这种风格，可以去看看<a class="ae je" href="https://t3chflicks.org/Projects/home-devops-pipeline" rel="noopener ugc nofollow" target="_blank">T3chFlicks.org</a>了解更多以科技为中心的教育内容(<a class="ae je" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>，<a class="ae je" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>，<a class="ae je" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">脸书</a>，<a class="ae je" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>)。</p></div></div>    
</body>
</html>