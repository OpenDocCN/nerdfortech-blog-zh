<html>
<head>
<title>Run, Build &amp; Deploy Stencil and Storybook From One Repository</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从一个存储库运行、构建和部署模板和故事书</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/run-build-deploy-stencil-and-storybook-from-one-repository-5f398c4070dc?source=collection_archive---------9-----------------------#2021-03-25">https://medium.com/nerd-for-tech/run-build-deploy-stencil-and-storybook-from-one-repository-5f398c4070dc?source=collection_archive---------9-----------------------#2021-03-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/1dce3d6b2e563363ec97de208618ffe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ySA3MOHkJDdynolz.jpg"/></div></div></figure><p id="69ae" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我最近加入了一个项目，团队基于<a class="ae jo" href="https://stenciljs.com/" rel="noopener ugc nofollow" target="_blank">模板</a>和<a class="ae jo" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank">故事书</a>为他们的web组件使用了两个独立的Git存储库。但是Storybook的想法是，所谓的“故事”存在于组件源代码的旁边。因此，将这两个工具放在不同的存储库中对我来说毫无意义，我将它们合并在一个存储库中。</p><p id="934b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我的目标是开发人员也可以在开发过程中通过热重载来使用故事书故事。此外，应该仍然可以将web组件分别部署到一个<a class="ae jo" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>注册表，并将Storybook部署到一个公共URL。</p><p id="007b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">本文描述了将故事书和模板结合到一个存储库中的必要步骤。我写这篇文章是因为目前还没有关于如何使用模板故事书的官方文档。让我们从一些基本的开始。</p><h1 id="e3e3" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">蜡纸</h1><blockquote class="kn ko kp"><p id="0eac" class="iq ir kq is b it iu iv iw ix iy iz ja kr jc jd je ks jg jh ji kt jk jl jm jn hb bi translated">Stencil是一个工具链，用于构建可重用、可扩展的设计系统。生成运行在每个浏览器上的小型、超快的、100%基于标准的Web组件。</p></blockquote><p id="5a1b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Stencil将“最流行的框架的最佳概念结合到一个简单的构建时工具中”，例如:</p><ul class=""><li id="8650" class="ku kv hi is b it iu ix iy jb kw jf kx jj ky jn kz la lb lc bi translated">类型脚本支持</li><li id="a971" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">JSX支持</li><li id="e5da" class="ku kv hi is b it ld ix le jb lf jf lg jj lh jn kz la lb lc bi translated">单向数据绑定</li></ul><p id="b2ea" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">从这些精选的概念中可以看出，Stencil是一个受<a class="ae jo" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>启发的web组件库。我以前使用过<a class="ae jo" href="https://lit-element.polymer-project.org/" rel="noopener ugc nofollow" target="_blank"> lit-element </a>，但是由于上面提到的特性，我更喜欢使用模板，尤其是在React项目中。</p><p id="682d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建一个新的模板项目，它将成为本文演示项目的基础，该项目可从<a class="ae jo" href="https://github.com/Mokkapps/stencil-storybook-demo" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="7e65" class="lr jq hi ln b fi ls lt l lu lv">npm init stencil</span></pre><p id="0f7e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们选择了<code class="du lw lx ly ln b">component</code> starter，因为我们想要构建一个可以通过npm共享的web组件库:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="e8c8" class="lr jq hi ln b fi ls lt l lu lv">? Pick a starter › - Use arrow-keys. Return to submit.</span><span id="0c00" class="lr jq hi ln b fi lz lt l lu lv">ionic-pwa     Everything you need to build PWAs</span><span id="8db9" class="lr jq hi ln b fi lz lt l lu lv">app           Minimal starter for building a Stencil app or website</span><span id="7415" class="lr jq hi ln b fi lz lt l lu lv">❯ component   Collection of web components that can be used anywhere</span></pre><p id="c632" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们将自动创建的<code class="du lw lx ly ln b">my-component.tsx</code>修改得更复杂一些:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="6313" class="lr jq hi ln b fi ls lt l lu lv">export interface CompOption {<br/>  value: string;<br/>  displayText: string;<br/>}<br/><br/>@Component({<br/>  tag: 'my-component',<br/>  styleUrl: 'my-component.css',<br/>  shadow: true,<br/>})<br/>export class MyComponent {<br/>  /**<br/>   * The text which is shown as label<br/>   */<br/>  @Prop() label: string;<br/><br/>  /**<br/>   * Is needed to reference the form data after the form is submitted<br/>   */<br/>  @Prop({ reflect: true }) name: string;<br/><br/>  /**<br/>   * If true, the button is displayed as disabled<br/>   */<br/>  @Prop({ reflect: true }) disabled = false;<br/><br/>  /**<br/>   * Define the available options in the drop-down list<br/>   */<br/>  @Prop() options: CompOption[] = [];<br/><br/>  render() {<br/>    return (<br/>      &lt;div&gt;<br/>        &lt;label htmlFor={this.name}&gt;{this.label}&lt;/label&gt;<br/><br/>        &lt;select name={this.name} id={this.name} disabled={this.disabled}&gt;<br/>          {this.options.map(o =&gt; (<br/>            &lt;option value={o.value}&gt;{o.displayText}&lt;/option&gt;<br/>          ))}<br/>        &lt;/select&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span></pre><p id="0867" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我们的演示组件是一个本地HTML select组件，它通过属性传递选项。一些值，如标签文本、组件名称，以及组件是否被禁用，也通过props传递给web组件。</p><p id="ef69" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">为了能够在本地测试我们的演示组件，我们需要调整<code class="du lw lx ly ln b">src/index.html</code>,它在我们启动模板时使用:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="defc" class="lr jq hi ln b fi ls lt l lu lv">&lt;!DOCTYPE html&gt;<br/>&lt;html dir="ltr" lang="en"&gt;<br/>  &lt;head&gt;<br/>    &lt;meta charset="utf-8" /&gt;<br/>    &lt;meta<br/>      name="viewport"<br/>      content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0"<br/>    /&gt;<br/>    &lt;title&gt;Stencil Component Starter&lt;/title&gt;<br/><br/>    &lt;script type="module" src="/build/ui-kit.esm.js"&gt;&lt;/script&gt;<br/>    &lt;script nomodule src="/build/ui-kit.js"&gt;&lt;/script&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;my-component<br/>      id="my-comp"<br/>      label="Label"<br/>      name="MyComp"<br/>      disabled="false"<br/>    &gt;&lt;/my-component&gt;<br/>  &lt;/body&gt;<br/>  &lt;script&gt;<br/>    document.getElementById('my-comp').options = [<br/>      {<br/>        value: 'Item 1',<br/>        displayText: 'Item 1',<br/>      },<br/>      {<br/>        value: 'Item 2',<br/>        displayText: 'Item 2',<br/>      },<br/>      {<br/>        value: 'Item 3',<br/>        displayText: 'Item 3',<br/>      },<br/>    ];<br/>  &lt;/script&gt;<br/>&lt;/html&gt;</span></pre><p id="f148" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们可以通过运行<code class="du lw lx ly ln b">npm run start-stencil</code>来本地测试我们的演示组件，这是一个从Stencil自动生成的npm脚本。组件现在应该在<code class="du lw lx ly ln b"><a class="ae jo" href="http://localhost:3333:" rel="noopener ugc nofollow" target="_blank">http://localhost:3333</a></code> <a class="ae jo" href="http://localhost:3333:" rel="noopener ugc nofollow" target="_blank"> : </a>处可见</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/e2906f3a1f5191d207cd2fa670275877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*NxDU2h3cDyYPpV1b.jpg"/></div></figure><p id="0125" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是将我们的组件部署到npm注册中心。对于这个演示，我使用的是“轻量级开源私有npm代理注册表”。首先，它需要全球安装</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="42d4" class="lr jq hi ln b fi ls lt l lu lv">npm install -g verdaccio</span></pre><p id="1570" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后可以在本地启动:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="5cf6" class="lr jq hi ln b fi ls lt l lu lv">▶ verdaccio <br/>warn --- config file - /Users/mhoffman/.config/verdaccio/config.yaml warn --- Verdaccio started <br/>warn --- Plugin successfully loaded: verdaccio-htpasswd <br/>warn --- Plugin successfully loaded: verdaccio-audit <br/>warn --- http address - http://localhost:4873/ - verdaccio/4.12.0</span></pre><p id="162c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们在<code class="du lw lx ly ln b">http://localhost:4873/</code>有一个本地的npm注册中心，所以我们需要告诉npm使用这个注册中心，例如，通过修改<code class="du lw lx ly ln b">.npmrc</code>:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="9d1f" class="lr jq hi ln b fi ls lt l lu lv">registry=http://localhost:4873</span></pre><p id="79f1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">此外，我们需要在注册表中创建一个用户:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="52ab" class="lr jq hi ln b fi ls lt l lu lv">npm adduser --registry <a class="ae jo" href="http://localhost:4873" rel="noopener ugc nofollow" target="_blank">http://localhost:4873</a></span></pre><p id="755d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们可以打包软件包并将其发布到npm注册表:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="cbb5" class="lr jq hi ln b fi ls lt l lu lv">npm pack<br/>npm publish</span></pre><p id="5334" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在应该可以在我们的私有注册中心<code class="du lw lx ly ln b"><a class="ae jo" href="http://localhost:4873/:" rel="noopener ugc nofollow" target="_blank">http://localhost:4873/</a></code> <a class="ae jo" href="http://localhost:4873/:" rel="noopener ugc nofollow" target="_blank"> : </a>看到它了</p><figure class="li lj lk ll fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ma"><img src="../Images/42e150c0256434e0bcce26ec8473fa1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*pPIQVEDyNeczmZ0z.jpg"/></div></div></figure><p id="0385" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">至此，我们有了一个可以部署到任何npm注册表的工作模板web组件库。下一步是将故事书集成到我们的知识库中。</p><h1 id="9c74" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">故事书</h1><blockquote class="kn ko kp"><p id="b540" class="iq ir kq is b it iu iv iw ix iy iz ja kr jc jd je ks jg jh ji kt jk jl jm jn hb bi translated"><em class="hi"> Storybook是一个开源工具，用于为React、Vue、Angular等开发独立的UI组件</em></p></blockquote><p id="cd3d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae jo" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank"> Storybook </a>的一个典型用例是拥有一个web组件库的可视化表示。这使得任何开发人员或设计人员都可以看到哪些组件是当前可用的，以及它们的外观和行为。</p><p id="4788" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当模板组件被编译成web组件时，我们可以使用HTML的<a class="ae jo" href="https://storybook.js.org/docs/guides/guide-html/" rel="noopener ugc nofollow" target="_blank">故事书</a>项目类型:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="e331" class="lr jq hi ln b fi ls lt l lu lv">npx -p @storybook/cli sb init -t html</span></pre><p id="df4f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在运行<code class="du lw lx ly ln b">npm run storybook</code>，它会在<code class="du lw lx ly ln b">http://localhost:6006</code>打开一个浏览器窗口，显示一些自动生成的组件&amp;故事:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/7acc8e0d4e56a8368e9f31df76805b19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*oQxjQdGnhERP5Rc1.jpg"/></div></figure><p id="66a4" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们为我们的<code class="du lw lx ly ln b">&lt;my-component&gt;</code>演示web组件写一个故事:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="578d" class="lr jq hi ln b fi ls lt l lu lv">export default {<br/>  title: 'Demo/MyComponent',<br/>  argTypes: {<br/>    label: { type: 'text', description: 'The text which is shown as label' },<br/>    name: {<br/>      type: 'text',<br/>      description:<br/>        'Is needed to reference the form data after the form is submitted',<br/>    },<br/>    disabled: {<br/>      type: 'boolean',<br/>      description: 'If true, the button is displayed as disabled',<br/>      defaultValue: { summary: false },<br/>    },<br/>  },<br/>};<br/><br/>const defaultArgs = {<br/>  disabled: false,<br/>};<br/><br/>const Template = args =&gt; {<br/>  return &lt;my-component {...args}&gt;&lt;/my-component&gt;;<br/>};<br/><br/>export const MyComponent = Template.bind({});<br/>Default.MyComponent = { ...defaultArgs };</span></pre><p id="e9ff" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们的故事中，我们定义了<a class="ae jo" href="https://storybook.js.org/docs/react/essentials/controls#gatsby-focus-wrapper" rel="noopener ugc nofollow" target="_blank">控件</a>来操作Storybook中的组件属性。我们还添加了一些默认值和描述。</p><p id="5b39" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但不幸的是，我们无法在Storybook中看到我们的组件，需要对项目设置做一些进一步的调整。</p><p id="ba21" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">首先，我们需要在<code class="du lw lx ly ln b">.storybook/preview.js</code>中加载并注册我们的web组件，以便将它们包含在webpack的依赖图中。这段JavaScript代码被添加到每个故事书故事的预览画布上，因此可用于webpack构建:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="4e22" class="lr jq hi ln b fi ls lt l lu lv">// highlight-start<br/>import { defineCustomElements } from '../dist/esm/loader';<br/><br/>defineCustomElements();<br/>// highlight-end<br/><br/>export const parameters = {<br/>  actions: { argTypesRegex: '^on[A-Z].*' },<br/>};</span></pre><p id="adcc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要添加<a class="ae jo" href="https://www.npmjs.com/package/@storybook/react" rel="noopener ugc nofollow" target="_blank"> @storybook/react </a>以便能够在故事中使用我们的组件:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="8ce3" class="lr jq hi ln b fi ls lt l lu lv">npm add -D @storybook/react</span></pre><p id="e82f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">下一步是修改我们的<code class="du lw lx ly ln b">my-component.stories.js</code>:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="a96f" class="lr jq hi ln b fi ls lt l lu lv">//highlight-next-line<br/>import React from 'react';<br/>//highlight-next-line<br/>import MyComponent from '../../../dist/collection/components/my-component/my-component';<br/><br/>export default {<br/>  title: 'Demo/MyComponent',<br/>  //highlight-next-line<br/>  component: MyComponent,<br/>  argTypes: {<br/>    label: { type: 'text', description: 'The text which is shown as label' },<br/>    name: {<br/>      type: 'text',<br/>      description:<br/>        'Is needed to reference the form data after the form is submitted',<br/>    },<br/>    disabled: {<br/>      type: 'boolean',<br/>      description: 'If true, the button is displayed as disabled',<br/>      defaultValue: { summary: false },<br/>    },<br/>  },<br/>};<br/><br/>const defaultArgs = {<br/>  disabled: false,<br/>};<br/><br/>const Template = args =&gt; {<br/>  return &lt;my-component {...args}&gt;&lt;/my-component&gt;;<br/>};<br/><br/>export const Default = Template.bind({});<br/>Default.args = { ...defaultArgs };</span></pre><p id="b719" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们需要添加两个新的npm脚本:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="3681" class="lr jq hi ln b fi ls lt l lu lv">"scripts": {<br/>  "build-stencil:watch": "stencil build --docs-readme --watch --serve",<br/>  "start-storybook": "start-storybook -p 6006 -s dist"<br/>},</span></pre><p id="afb6" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过用<code class="du lw lx ly ln b">--watch</code>标志运行Stencil的构建过程，它用我们在<code class="du lw lx ly ln b">preview.js</code>文件中引用的<code class="du lw lx ly ln b">esm/loader.mjs</code>文件生成正确的输出。然后我们只需要告诉Storybook使用模板构建命令生成的<code class="du lw lx ly ln b">dist</code>文件夹，并禁用其缓存机制。</p><p id="893a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果我们现在在单独的终端中运行<code class="du lw lx ly ln b">build-stencil:watch</code>，然后再运行<code class="du lw lx ly ln b">start-storybook</code>，我们可以在Storybook中看到我们的组件:</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es ma"><img src="../Images/c38fb8ec3b029d8acdfcfec481290309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/0*f7yDHRcOgHsexNyF.jpg"/></div></figure><p id="158f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您现在还可以修改您的模板web组件，由于热重新加载，您可以立即在Storybook中看到您的更改。</p><p id="cf71" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可能还想知道我们如何通过属性设置选项？通过使用<code class="du lw lx ly ln b">my-component.stories.js</code>中模板函数内的<code class="du lw lx ly ln b">setTimeout</code>可以确保组件已经加载:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="a4fd" class="lr jq hi ln b fi ls lt l lu lv">const Template = args =&gt; {<br/>  args.id = args.id ? args.id : 'my-component';<br/>  setTimeout(() =&gt; {<br/>    document.getElementById(args.id).options = [<br/>      {<br/>        value: 'Item 1',<br/>        displayText: 'Item 1',<br/>      },<br/>      {<br/>        value: 'Item 2',<br/>        displayText: 'Item 2',<br/>      },<br/>      {<br/>        value: 'Item 3',<br/>        displayText: 'Item 3',<br/>      },<br/>    ];<br/>  });<br/>  return &lt;my-component {...args}&gt;&lt;/my-component&gt;;<br/>};</span></pre><p id="f42f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">最后，我们希望将Storybook部署到一个公共URL，因此我们使用了<a class="ae jo" href="https://github.com/storybookjs/storybook-deployer" rel="noopener ugc nofollow" target="_blank"> storybook-deployer </a>，它提供了一种将它部署到GitHub Pages或AWS S3的好方法。我们将通过安装该工具将其部署到AWS S3</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="0540" class="lr jq hi ln b fi ls lt l lu lv">npm i @storybook/storybook-deployer --save-dev</span></pre><p id="3409" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">并且给<code class="du lw lx ly ln b">package.json</code>添加了一些新的脚本:</p><pre class="li lj lk ll fd lm ln lo lp aw lq bi"><span id="1ea6" class="lr jq hi ln b fi ls lt l lu lv">"scripts": {<br/>  "build-storybook": "build-storybook -o ./distStorybook",<br/>  "predeploy-storybook": "npm run build-storybook",<br/>  "deploy-storybook": "storybook-to-aws-s3 --existing-output-dir ./distStorybook --bucket-path &lt;AWS_BUCKET_PATH&gt;",<br/>},</span></pre><p id="038a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们部署Storybook之前，我们触发一个构建，这是通过使用<code class="du lw lx ly ln b">build-storybook</code>作为<a class="ae jo" href="https://docs.npmjs.com/cli/v7/using-npm/scripts#pre--post-scripts" rel="noopener ugc nofollow" target="_blank">前脚本</a>来完成的。您还需要确保您的<a class="ae jo" href="https://havecamerawilltravel.com/photographer/how-allow-public-access-amazon-bucket/" rel="noopener ugc nofollow" target="_blank"> AWS S3允许公众访问</a>。</p><p id="4de9" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">例如，我的演示项目位于<a class="ae jo" href="http://mokkapps-stencil-storybook-demo.s3-website.eu-central-1.amazonaws.com" rel="noopener ugc nofollow" target="_blank">http://mokkapps-stencil-story book-demo . S3-website . eu-central-1 . amazonaws . com</a>。</p><h1 id="70d6" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="f7f0" class="pw-post-body-paragraph iq ir hi is b it mb iv iw ix mc iz ja jb md jd je jf me jh ji jj mf jl jm jn hb bi translated">将模板和故事书结合起来有点棘手，最好有这个主题的官方文档。</p><p id="cec5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">但我认为这是值得努力的，而且由于Storybook的特性，它还可以改进本地组件开发。</p><p id="1eb2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">演示项目的代码可从GitHub 获得。</p><p id="2776" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果你喜欢这篇文章，请在<a class="ae jo" href="https://twitter.com/mokkapps" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我，从我这里获得关于新博客文章和更多内容的通知。</p><figure class="li lj lk ll fd ij er es paragraph-image"><div class="er es mg"><img src="../Images/68a38c68054760bcbed2aa0af10da3a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*72WEM0ZK7AJh3M7t.jpg"/></div></figure></div><div class="ab cl mh mi gp mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hb hc hd he hf"><p id="f4bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><em class="kq">最初发布于</em><a class="ae jo" href="https://www.mokkapps.de/blog/run-build-and-deploy-stencil-and-storybook-from-one-repository/" rel="noopener ugc nofollow" target="_blank"><em class="kq">https://www . mokkapps . de</em></a><em class="kq">。</em></p></div></div>    
</body>
</html>