<html>
<head>
<title>Galaxy Shooter 2D — Laser Beam</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">银河射手 2D——激光束</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/galaxy-shooter-2d-laser-beam-22-21e317363941?source=collection_archive---------29-----------------------#2021-05-31">https://medium.com/nerd-for-tech/galaxy-shooter-2d-laser-beam-22-21e317363941?source=collection_archive---------29-----------------------#2021-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="87bc" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated">我是一个“开火”的人！！</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/553be161427ecab38f0525eb960d36ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Rg9Vhpo8QQ6AhXIo2Cf5aw.gif"/></div></div></figure><p id="d21c" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">是时候让大人物上场了！今天，我要展示我的游戏中最新加入的:<strong class="jl hj"> <em class="kf">激光束</em> </strong>！一种强大的大规模杀伤性武器，可以迅速消灭任何挡路的实体(包括激光)，因此优化后的游戏甚至不会丢一帧！</p><p id="2432" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这里有很多东西要打开。不幸的是，我将不得不删除一些多余的内容，以保持这篇文章简单。尽管如此，我还是实现了这个特性:</p><ul class=""><li id="4c27" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated"><a class="ae kp" href="#0abb" rel="noopener ugc nofollow"> <strong class="jl hj">激光束设计</strong> </a> <strong class="jl hj"> <br/> - </strong> <a class="ae kp" href="#430c" rel="noopener ugc nofollow"> <strong class="jl hj">加电</strong></a><strong class="jl hj"><br/>-</strong><a class="ae kp" href="#30ff" rel="noopener ugc nofollow"><strong class="jl hj">组件</strong></a><strong class="jl hj"><br/>-</strong><a class="ae kp" href="#749b" rel="noopener ugc nofollow"><strong class="jl hj">【无碰撞器】</strong></a><strong class="jl hj"><br/>-</strong><a class="ae kp" href="#a5b8" rel="noopener ugc nofollow"><strong class="jl hj">状态</strong> </a></li><li id="bfce" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><a class="ae kp" href="#58ff" rel="noopener ugc nofollow"> <strong class="jl hj">激光束代码</strong></a><strong class="jl hj"><br/></strong><a class="ae kp" href="#7ed1" rel="noopener ugc nofollow"><strong class="jl hj">-光束对撞机检测协程</strong></a><strong class="jl hj"><br/></strong><a class="ae kp" href="#d0df" rel="noopener ugc nofollow"><strong class="jl hj">-主光束协程</strong> </a></li><li id="ce82" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><a class="ae kp" href="#1fc7" rel="noopener ugc nofollow"> <strong class="jl hj">游戏内成绩</strong> </a></li></ul></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="0abb" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">激光束设计</h1><h2 id="430c" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">通电</h2><p id="003c" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">激光束是一个无限保持时间的加电拾取器(意味着玩家将保持加电，除非玩家开始使用它或者已经拾取了另一个武器加电)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mn"><img src="../Images/768d3a6014789a25584076fcf4b2abad.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/1*ero9L7v342rPOK7pqu1gFw.gif"/></div></figure><h2 id="30ff" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">激光束组件</h2><p id="8c67" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">横梁由以下材料制成:</p><ul class=""><li id="3f32" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated">(<strong class="jl hj"> PlayerBeam </strong>)一个带有切片精灵的精灵渲染器(你需要安装<strong class="jl hj"> <em class="kf"> 2D 精灵</em> </strong>包来制作一个)，激光束脚本将被附加到这里，下一个组件将成为其父组件。</li><li id="5b61" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated">(<strong class="jl hj">fakedbiamarealight</strong>)一个假的 2D 灯光区雪碧。因为我没有在我的项目中使用 2D 照明，我需要伪造它。我们游戏开发者称之为纸板把戏。只要玩家没有注意到他们，你就能侥幸逃脱！</li><li id="2946" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated">(<strong class="jl hj"> BeamChargeUpPS </strong>)一个粒子系统，它会给光束增加更多的冲击力或感觉。</li><li id="30a3" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated">(<strong class="jl hj"> BeamForceFieldPS </strong>)粒子系统力场，用粒子系统创建轨道效果。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mo"><img src="../Images/9de34110d764f8aad19972913d716583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ECLS125237dVd96d_Yt9jw.png"/></div></div></figure><p id="9899" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">我还在<strong class="jl hj"> PlayerBeam </strong> GameObject 中添加了一个动画师，让精灵在光束变得可见时发光，并添加了一个<strong class="jl hj"> <em class="kf">音频源</em> </strong>来添加声音！</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mp"><img src="../Images/ff8c5931eb9ac38bc4bf3c0e441017fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:288/1*dHit00IPNaoRc7obsxTu_g.gif"/></div></figure><h2 id="749b" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">“没有碰撞器”</h2><p id="f7de" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">我知道调整碰撞器的大小会导致性能下降，这是非常不幸的，因为光束会不断地调整大小，即使光束已经完全退出了屏幕。我本来可以忽略这一点，使用标准的 2D 盒碰撞器，但是因为我关心性能，我决定使用物理的。OverlapBoxNonAlloc  检查光束体积内的敌人。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mq"><img src="../Images/04edf6bbfa6573466099b43524afbbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/1*CDBZDKHtrUeHNyMWhr0DUg.gif"/></div><figcaption class="mr ms et er es mt mu bd b be z dx translated">灰色的盒子是激光束对撞机探测器，全部由代码组成。此外，为了避免 spawn killing，Beam sprite 不断调整大小，以避免超过我设置的 Y 值。</figcaption></figure><p id="9da0" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">后来，它对我产生了反作用，因为我意识到我不能实现特定类型的敌人，因为代码冲突查询不能被其他查询检测到(不能检测到一个<strong class="jl hj"> <em class="kf">与另一个</em> </strong>重叠)。因此，我最终使用了一个碰撞器，只有当激光束开始/停止调整大小时，我才启用和禁用它(另一个纸板把戏，允许其他功能注册碰撞器)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mv"><img src="../Images/e549ae7aab12078e59ac9e435f08e0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:150/format:webp/1*J7SsKRx0VUnzWfUuV_yLjQ.png"/></div></figure><h2 id="a5b8" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">光束状态</h2><p id="0c98" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">一旦玩家通过按下“<strong class="jl hj"> <em class="kf">火</em> </strong>输入决定使用它，激光束将经历 3 个状态，由一个<strong class="jl hj"> <em class="kf">协程</em> </strong>处理:</p><ul class=""><li id="2f4c" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">充电(阶段 1) </em> </strong>:从 0–25%的激光束充电开始，<strong class="jl hj"> FakedBeamAreaLight </strong>将慢慢点亮(通过将 alpha 值设置为最大)。超过该百分比后，灯将闪烁，直到<strong class="jl hj"> <em class="kf">上紧</em> </strong>状态。</li><li id="25ef" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">充电(阶段 2) </em> </strong>:充电到 50%时，<strong class="jl hj"> BeamChargeUpPS </strong>开始发射粒子。</li><li id="5595" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">光束发射</em></strong>:100%时，<strong class="jl hj"> PlayerBeam </strong>开始增长，一旦接触到最大 Y 值，光束持续时间开始倒计时，并开始检查碰撞器(通过<strong class="jl hj"> <em class="kf">协程</em> </strong>)。</li><li id="daf6" class="kg kh hi jl b jm kq jp kr js ks jw kt ka ku ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">上紧</em></strong>:<strong class="jl hj">player beam</strong>将开始倒退，<strong class="jl hj">fakedbamarealight</strong>将慢慢淡出，<strong class="jl hj">beam charge PPS</strong>将停止发射粒子。一旦<strong class="jl hj"> PlayerBeam </strong>完全倒退，激光束状态将切换到<strong class="jl hj"> <em class="kf">非活动</em> </strong>状态，并停止检查碰撞器(停止两个<strong class="jl hj"> <em class="kf">协程</em> </strong>)。</li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/12f635afc512199d4a69f053c7f4f3da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kp4IJOrETtEGDuh9WdSTJA.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mw"><img src="../Images/38b93d08ab9f6daad45ca6e5eb2cf31e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y23WsPuuA5n5RQI8vPU9Kw.png"/></div></div></figure></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="58ff" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">激光束代码</h1><p id="2ad3" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">有大量的代码需要检查。为了简单起见，我将只展示其中最重要的片段，大部分描述/解释将在下面的代码图片中进行注释。</p><h2 id="7ed1" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">束对撞机检测程序</h2><p id="41fe" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">就像我的<a class="ae kp" rel="noopener" href="/nerd-for-tech/galaxy-shooter-2d-heat-seeking-lasers-20-a8347dfde1b4"> <strong class="jl hj"> <em class="kf">热寻激光</em> </strong> </a>，它会检查对撞机的每一次更新帧(这在任何情况下都可以随时更改)。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es mx"><img src="../Images/d775a37e98642d4a186a78b9d9030a0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwFAlZaL0UG8HUM3-fXYew.png"/></div></div></figure><h2 id="d0df" class="lu ld hi bd le lv lw lx li ly lz ma lm js mb mc lo jw md me lq ka mf mg ls mh bi translated">主光束协程</h2><p id="f1c2" class="pw-post-body-paragraph jj jk hi jl b jm mi ij jo jp mj im jr js mk ju jv jw ml jy jz ka mm kc kd ke hb bi translated">我决定做一个小 a <strong class="jl hj"> <em class="kf">有限状态机</em> </strong>，其中激光束的每一个状态都有一个<strong class="jl hj">启动、执行和退出</strong>的方法。<strong class="jl hj"> <em class="kf"> FSM </em> </strong>多用于开发 ai，但也可以应用于其他游戏玩法机制。</p><p id="ee47" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">唯一的区别是这些状态是硬编码的(不会为一个小项目编写一个灵活的<strong class="jl hj"> <em class="kf"> FSM </em> </strong>框架，你知道吗？)在一个协程中，都遵循一个序列。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es my"><img src="../Images/d959521a41f12bb22835450169e5b0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:906/format:webp/1*B0IGYdXi-M9vFJgipNcA8w.png"/></div></figure><p id="c040" class="pw-post-body-paragraph jj jk hi jl b jm jn ij jo jp jq im jr js jt ju jv jw jx jy jz ka kb kc kd ke hb bi translated">这篇文章很长，如果我要解释 LaserBeam 脚本中的每一个方法和行为，这篇文章会拖得更长。所以，为了结束这篇文章，下面是注释代码的<strong class="jl hj"> <em class="kf">电荷</em> </strong>和<strong class="jl hj"> <em class="kf">光束火</em> </strong>状态。</p><ul class=""><li id="4f92" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">充电</em> </strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mz"><img src="../Images/191cfe7776ec2238951ed7e46e2a430b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*e4LRw1YdpLaYucm39FXkEA.png"/></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es na"><img src="../Images/a3cbe33bc2ddd76905b52217a98df420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q24iXbmjbam_p09_neBFPw.png"/></div></div></figure><ul class=""><li id="46ef" class="kg kh hi jl b jm jn jp jq js ki jw kj ka kk ke kl km kn ko bi translated"><strong class="jl hj"> <em class="kf">火光束</em> </strong></li></ul><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nb"><img src="../Images/8406f966bf933ce601b801c6a46f22ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKfZFlflYEF59ZnlVfk4Mg.png"/></div></div></figure><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nc"><img src="../Images/1e852e20e92c60c1f40780c5366768e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JjxXj_EL6gDTMpjU16_Lag.png"/></div></div></figure></div><div class="ab cl kv kw gp kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="hb hc hd he hf"><h1 id="1fc7" class="lc ld hi bd le lf lg lh li lj lk ll lm io ln ip lo ir lp is lq iu lr iv ls lt bi translated">游戏中的结果</h1><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es nd"><img src="../Images/0a9f2054ef86853a21b3d50714901295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MUxZEmoo--RSDk43EFMlLQ.gif"/></div></div></figure></div></div>    
</body>
</html>