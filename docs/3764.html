<html>
<head>
<title>Setup ktlint with your Android app and using Github hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用你的Android应用程序和Github钩子设置ktlint</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/setup-ktlint-with-your-android-app-and-using-github-hooks-2cfc42a2cf2?source=collection_archive---------3-----------------------#2021-06-23">https://medium.com/nerd-for-tech/setup-ktlint-with-your-android-app-and-using-github-hooks-2cfc42a2cf2?source=collection_archive---------3-----------------------#2021-06-23</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="41bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">项目林挺是任何团队在整个开发阶段面临的主要问题之一。因此，在这里我们将讨论如何启用lint检查，并将它们与git挂钩一起使用。</p><blockquote class="jd je jf"><p id="3ede" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">我们将使用代码林挺最著名的库之一，即<a class="ae jk" href="https://github.com/pinterest/ktlint" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> ktlint </strong> </a>。</p></blockquote><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/eac9309596ac0236d49d562de938d5f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8T8PYf0QF9cgXWlybvDjhg.png"/></div></div></figure><p id="978e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，让我们从创建一个简单的应用程序开始。注意:示例项目不会遵循任何架构模式等。它将只关注代码林挺以及我们如何在我们的项目中使用ktlint。</p></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><h1 id="9271" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">设置</strong></h1><p id="ecab" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">因此，从设置开始，有许多方法可以将ktlint添加到项目中。你可以把它作为一个单独的Gradle文件添加进来(如果你想知道的话，可以加上注释)，或者我们可以用最简单的方法使用一个<a class="ae jk" href="https://github.com/jlleitschuh/ktlint-gradle" rel="noopener ugc nofollow" target="_blank"> Gradle插件</a>。我将向你展示如何使用gradle插件。</p><h2 id="d1b0" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">第一步</h2><p id="c06e" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">让我们在<strong class="ih hj">项目gradle中添加依赖关系。</strong></p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="4f89" class="lh kf hi lw b fi ma mb l mc md">classpath "org.jlleitschuh.gradle:ktlint-gradle:10.1.0"</span></pre><h2 id="c6b4" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">第二步</h2><p id="5eb0" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">然后在所有项目下应用上面的插件</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="c415" class="lh kf hi lw b fi ma mb l mc md">apply plugin: "org.jlleitschuh.gradle.ktlint"</span></pre><h2 id="87c9" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">可选(步骤3)</h2><p id="448c" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">这一步是可选的，但是非常方便。默认情况下，Ktlint不允许通配符导入。因此，使用这个代码片段，我们将覆盖这些设置。</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="9e03" class="lh kf hi lw b fi ma mb l mc md">// Optionally configure plugin<br/>ktlint <strong class="lw hj">{<br/>    </strong>debug.set(true)<br/>    disabledRules.set(["no-wildcard-imports"])<br/>}</span></pre><p id="a983" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已。完成了。您已经成功地在项目中设置了ktlint。下面是我的gradle的样子。</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="495e" class="lh kf hi lw b fi ma mb l mc md">// Top-level build file where you can add configuration options common to all sub-projects/modules.<br/>buildscript <strong class="lw hj">{<br/>    </strong>ext.kotlin_version = "1.5.0"<br/>    repositories <strong class="lw hj">{<br/>        </strong>google()<br/>        mavenCentral()<br/>        maven <strong class="lw hj">{ </strong>url "https://plugins.gradle.org/m2/" <strong class="lw hj">}<br/>        </strong>jcenter()<br/>    <strong class="lw hj">}<br/>    </strong>dependencies <strong class="lw hj">{<br/>        </strong>classpath "com.android.tools.build:gradle:4.2.1"<br/>        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"<br/><br/>        classpath "org.jlleitschuh.gradle:ktlint-gradle:10.1.0"<br/><br/>        // NOTE: Do not place your application dependencies here; they belong<br/>        // in the individual module build.gradle files<br/>    <strong class="lw hj">}<br/>}<br/><br/></strong>allprojects <strong class="lw hj">{<br/>    </strong>repositories <strong class="lw hj">{<br/>        </strong>google()<br/>        mavenCentral()<br/>    <strong class="lw hj">}<br/><br/>    </strong>apply plugin: "org.jlleitschuh.gradle.ktlint"<br/><br/>    // Optionally configure plugin<br/>    ktlint <strong class="lw hj">{<br/>        </strong>debug.set(true)<br/>        disabledRules.set(["no-wildcard-imports"])<br/>    <strong class="lw hj">}<br/>}<br/><br/></strong>task clean(type: Delete) <strong class="lw hj">{<br/>    </strong>delete rootProject.buildDir<br/><strong class="lw hj">}</strong></span></pre><p id="3a7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要检查其有效性，请打开终端并点击以下命令。</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="731e" class="lh kf hi lw b fi ma mb l mc md">./gradlew ktlintCheck</span></pre><p id="4b32" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将在您的整个项目上运行ktlint，并列出项目中的所有问题。现在，继续进行一些代码更改，然后运行上面的命令并检查输出。如果您遇到构建失败，您可以跟踪日志并检查不符合lint proof的文件，或者您可以简单地使用下面的命令，该命令将一次性修复所有问题。</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="e53c" class="lh kf hi lw b fi ma mb l mc md">./gradlew ktlintFormat</span></pre><p id="b905" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">恭喜你！！！。您已经成功地将ktlint集成到您的项目中。现在，让我们讨论一下，如果您正在进行一个大项目，您希望每个开发人员在向git提交任何东西之前都进行lint检查，那么您如何能够实施lint检查。在下一节中，我们将讨论如何使用预提交钩子来运行ktlintCheck并为开发人员抛出错误。</p></div><div class="ab cl jx jy gp jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="hb hc hd he hf"><h1 id="46e0" class="ke kf hi bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">对KtLint使用预提交挂钩</h1><h2 id="8648" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">第一步</h2><p id="5290" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">让我们在项目根文件夹中添加一个文件预提交，内容如下。</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="990b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这基本上是在每次用户尝试提交时运行ktlintCheck。现在我们将把这个预提交挂钩添加到我们的项目中，并在其上添加构建依赖项。</p><h2 id="539e" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated">第二步</h2><p id="a3a3" class="pw-post-body-paragraph if ig hi ih b ii lc ik il im ld io ip iq le is it iu lf iw ix iy lg ja jb jc hb bi translated">打开项目gradle文件，让我们添加一个任务，将它添加到git挂钩中。</p><pre class="jm jn jo jp fd lv lw lx ly aw lz bi"><span id="2b23" class="lh kf hi lw b fi ma mb l mc md">task installGitHook(type: Copy) <strong class="lw hj">{<br/>    </strong>from new File(rootProject.rootDir, 'pre-commit')<br/>    into <strong class="lw hj">{ </strong>new File(rootProject.rootDir, '.git/hooks') <strong class="lw hj">}<br/>    </strong>fileMode 0777<br/><strong class="lw hj">}<br/></strong>tasks.getByPath(':app:preBuild').dependsOn installGitHook</span></pre><p id="6d6c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在清理并构建您的项目。这将在<code class="du mg mh mi lw b">.git/hooks</code>文件夹下添加一个同名的预提交钩子。仅此而已。</p><h2 id="62b6" class="lh kf hi bd kg li lj lk kk ll lm ln ko iq lo lp ks iu lq lr kw iy ls lt la lu bi translated"><strong class="ak">恭喜你！！！</strong>您现在可以开始了。现在，每当有人试图向您的项目提交任何东西时，您就站在一边，让ktlint为您施展魔法。</h2><blockquote class="jd je jf"><p id="2b68" class="if ig jg ih b ii ij ik il im in io ip jh ir is it ji iv iw ix jj iz ja jb jc hb bi translated">这是到我的存储库的<a class="ae jk" href="https://github.com/ashishuniyal90/KtlinSetup/tree/main" rel="noopener ugc nofollow" target="_blank">链接</a>。在下一篇文章中，我们将讨论在ktlint之上创建定制规则。</p></blockquote><div class="mj mk ez fb ml mm"><a href="https://github.com/ashishuniyal90/KtlinSetup" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab dw"><div class="mo ab mp cl cj mq"><h2 class="bd hj fi z dy mr ea eb ms ed ef hh bi translated">ashishuniyal90/KtlinSetup</h2><div class="mt l"><h3 class="bd b fi z dy mr ea eb ms ed ef dx translated">该项目是一个虚拟项目，我们可以看到如何将ktlint与项目以及预提交挂钩集成在一起…</h3></div><div class="mu l"><p class="bd b fp z dy mr ea eb ms ed ef dx translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na jv mm"/></div></div></a></div></div></div>    
</body>
</html>