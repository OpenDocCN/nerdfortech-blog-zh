<html>
<head>
<title>Using custom hooks to handle keyboard shortcuts in React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 React 中使用自定义钩子处理键盘快捷键</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/using-custom-hooks-to-handle-keyboard-shortcuts-in-react-a91649a81c87?source=collection_archive---------2-----------------------#2021-02-16">https://medium.com/nerd-for-tech/using-custom-hooks-to-handle-keyboard-shortcuts-in-react-a91649a81c87?source=collection_archive---------2-----------------------#2021-02-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/aa18ff022892835086687d4066a4aed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qi7hBhq1xggL_hkRqWrKAA.jpeg"/></div></div></figure><p id="d961" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">在我们的团队中，我们最近需要在 React 的输入字段中添加一些键盘快捷键。按下“e”进行<em class="jw">编辑</em>，特定字段将从只读变为输入字段。按 escape 键会再次将它变回只读版本。</p><p id="49e5" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们最初的方法是将<em class="jw"> keydown 监听器</em>添加到组件的<code class="du jx jy jz ka b">useEffect</code>钩子中，如下所示:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kb kc l"/></div></figure><p id="7cbe" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">(长边注:你可能会奇怪为什么我们的<code class="du jx jy jz ka b">useEffect</code>回调函数会返回另一个函数。<code class="du jx jy jz ka b">useEffect</code>是一个钩子，当一个组件加入队伍时，它允许我执行某些指令。就像在现实生活中一样，当某些人几个小时后离开家时，我们有时不得不收拾残局。从<code class="du jx jy jz ka b">useEffect</code>钩子返回一个函数就是这么做的。由于我们的组件将事件侦听器添加到全局窗口对象中，所以当不再使用这些侦听器时，我们必须再次删除它们。否则，如果这是一个有条件地呈现的组件，并且多次显示和从 DOM 中移除，我们将最终得到一堆过时的按键监听器，这可能会给我们的应用程序带来麻烦，并且肯定会降低速度。)</p><p id="c9b3" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">不幸的是，这个解决方案在我看来并不优雅。有许多样板文件只是简单地处理关键事件的添加和删除，这将注意力从组件的核心功能上转移开了。现在，我最近开始探索 React 的一些更险恶的部分，并在一个黑暗的小巷里偶然发现了<em class="jw">定制钩子</em>。也许是时候往我们沸腾的大锅里加一把了？</p><h2 id="c1a2" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">什么是定制挂钩？</h2><blockquote class="ky kz la"><p id="aa14" class="iy iz jw ja b jb jc jd je jf jg jh ji lb jk jl jm lc jo jp jq ld js jt ju jv hb bi translated">自定义挂钩就像一个组件，但它不返回 JSX，也不被呈现。相反，它可以返回变量或函数。</p></blockquote><p id="4d93" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">那么，我听到你坐在不太舒服的 Covid 19 家庭办公椅上问，自定义钩子和导出函数和变量的简单 Javascript 文件之间有什么区别？好问题。不同的是自定义钩子可以使用其他钩子。文件中的一个简单函数超出了 React 的魔法范围，所以你不能用<code class="du jx jy jz ka b">useState</code>定义状态或者调度 Redux 动作，这在很大程度上限制了它们的有用性。</p><h2 id="d871" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">输入用户按键</h2><p id="abd0" class="pw-post-body-paragraph iy iz hi ja b jb le jd je jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv hb bi translated">所有的定制钩子都应该以单词<em class="jw"> use </em>开始，所以我们的逻辑名称是 useKeyPress。我们启动我们的 IDE 并创建了一个同名的新文件。然后，我们向它添加了以下代码:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kb kc l"/></div></figure><p id="1055" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">如你所见，钩子本身非常简单。当被调用时，我们传递一个回调和一个要监听的键码数组(这两个值由 useKeyPress 函数中的参数定义:<code class="du jx jy jz ka b">callback</code>和<code class="du jx jy jz ka b">keyCodes).</code>)，然后钩子设置一个函数<code class="du jx jy jz ka b">handler,</code>，它检查被按下的键是否在我们想要操作的键之列，如果是，就执行回调。<code class="du jx jy jz ka b">useEffect</code>块添加 keydown 监听器，并在钩子被移除时再次移除它，就像在原始组件中一样。</p><p id="1761" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">正如你所看到的，我们称<code class="du jx jy jz ka b">useEffect</code>为非组件内部的东西。这就是自定义钩子与常规 Javascript 函数的区别。在这个场景中，与其他类似的解决问题的方法相比，自定义钩子允许我们将更多的逻辑从组件中移出，放到一个单独的文件中。</p><h2 id="3f8e" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">回到组件</h2><p id="4773" class="pw-post-body-paragraph iy iz hi ja b jb le jd je jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv hb bi translated">然后，我们回到最初的组件，并修改它以使用我们的新钩子，产生了这个极其优雅和可读的代码:</p><figure class="in io ip iq fd ir"><div class="bz dy l di"><div class="kb kc l"/></div></figure><h2 id="2e7e" class="kd ke hi bd kf kg kh ki kj kk kl km kn jj ko kp kq jn kr ks kt jr ku kv kw kx bi translated">结论</h2><p id="5d03" class="pw-post-body-paragraph iy iz hi ja b jb le jd je jf lf jh ji jj lg jl jm jn lh jp jq jr li jt ju jv hb bi translated">在很短的时间内，我们就能够构建一个灵活的定制钩子，减少组件中的样板代码，从而使其更易于阅读。自定义挂钩现在可以很容易地在我们项目的其他地方重用。</p></div></div>    
</body>
</html>