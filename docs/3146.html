<html>
<head>
<title>Labelling Areas of Coordinates with GeoPandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 GeoPandas 标记坐标区域</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/labelling-areas-of-coordinates-with-geopandas-74d25c8aada6?source=collection_archive---------1-----------------------#2021-05-31">https://medium.com/nerd-for-tech/labelling-areas-of-coordinates-with-geopandas-74d25c8aada6?source=collection_archive---------1-----------------------#2021-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5ec9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在空间分析中处理空间数据可能很麻烦。空间数据通常以可在地图中表示的点、线或多边形坐标的形式存储。值得庆幸的是，有一个名为 GeoPandas 的 python 包，旨在更容易地使用 python 处理地理空间数据。</p><p id="88ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最近从事空间数据分析。在那个项目中，GeoPandas 帮我标注了坐标和它们对应的区域。标注区域对于识别数据中是否存在空间模式确实很重要。在这篇文章中，我将特别讨论如何在给定的坐标上放置区域标签。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/54f63ad89c0ff4bae74e7dbd3c531223.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*28ReZO2LVgUY-qdZ"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">蒂莫·维林克在<a class="ae jt" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="1431" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">什么是 Geopandas？</strong></h1><p id="25bf" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">GeoPandas 是一个开源项目，旨在帮助使用 python 处理地理空间数据。它结合了 pandas 和 shapely 的功能，在 pandas 中提供地理空间操作，并为 shapely 提供多种几何图形的高级接口。该包可以读取几乎任何基于矢量的空间数据格式、GeoJSON 文件等，然后返回地理数据框架对象。当你在做你的项目时，你可以查看这个文档，因为它提供了关于如何使用 GeoPandas 的全面解释。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="dbf6" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">识别区域</h1><p id="9628" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">在本文中，我将以我最新的空间数据分析项目为例。该数据集提供印度尼西亚大城市万隆的街道坐标。这是数据集的预览:</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="687b" class="lj kc hi lf b fi lk ll l lm ln">df.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lo"><img src="../Images/e6e3659081ceb42e0700d04cff573c1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RF8xN1J8wyyShc8cLYT0fw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">数据集。作者图片</figcaption></figure><p id="3294" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">转换成合适的几何数据</strong></p><p id="972e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">坐标位于几何区域。该列的值应该形成为<em class="lp">形状良好的</em>对象，例如点/多点、线/多线和多边形/多多边形。我们需要<em class="lp">形状优美的</em>对象的原因是我们需要创建一个地理数据框架对象。GeoDataFrame 类实现了<em class="lp"> shapely </em>对象的几乎所有属性和方法，包括检查坐标是否位于某个区域内。</p><p id="eca3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此数据集只有一行/多行，因此我们需要转换，因为值仍然是字典格式。使用这段代码来转换它们。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="12e2" class="lj kc hi lf b fi lk ll l lm ln">from shapely.geometry import LineString, MultiLineString</span><span id="7124" class="lj kc hi lf b fi lq ll l lm ln">df[‘geometry’] = df[‘geometry’].apply(lambda x : (json.loads(x)[‘type’] == ‘LineString’ and LineString(json.loads(x)[‘coordinates’]) or json.loads(x)[‘type’] == ‘MultiLineString’ and MultiLineString(json.loads(x)[‘coordinates’])))</span><span id="b122" class="lj kc hi lf b fi lq ll l lm ln">df.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lr"><img src="../Images/840053152b68c5e9b4d5b0e0db674892.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2E3jKDzh6WtaC6p5iAP62w.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">变形几何。作者图片</figcaption></figure><p id="d075" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">创建地理数据框架对象</strong></p><p id="5b03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经将我们的几何值转换成了<em class="lp">形状优美的</em>物体。下一步是创建地理数据框架对象。地理数据框架对象是熊猫。具有带几何图形的列的数据帧。我们可以指定将哪一列用作几何对象的几何和坐标参考系统(CRS ),如“EPSG:4326”或 WKT 字符串。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="ba67" class="lj kc hi lf b fi lk ll l lm ln">d = {‘street’: list(df[‘street’]), ‘geometry’: list(df[‘geometry’])}</span><span id="3bca" class="lj kc hi lf b fi lq ll l lm ln">gdf = geopandas.GeoDataFrame(d, crs=”EPSG:3395")</span><span id="7b41" class="lj kc hi lf b fi lq ll l lm ln">gdf.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ls"><img src="../Images/25a01f878e0e40d0c3a2a44a35000fe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*Xau4SHruB3R0nA6U0ILKNQ.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">地理数据框架对象。作者图片</figcaption></figure><p id="f0d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">尽管普通数据框和地理数据框之间似乎没有区别，但区别在于适用于地理数据框的方法，因为它几乎实现了<em class="lp"> shapely </em>对象的所有属性和方法。</p><p id="2b79" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">获取万隆市地图的子区域</strong></p><p id="a12c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然我们已经将数据框转换为地理数据框，我们可以暂时保留它，因为我们将获得区域标签数据。由于数据边界在一个城市内，那么我们可以根据子区域、地区、子地区或城市内的任何相关事物来标记观察值。在我的上一个项目中，我使用了亚维利亚科塔(等同于亚区，缩写为 SWK)来标记观察结果。</p><p id="6284" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">万隆市政府在其网页上提供了这些数据。数据存储在 JSON 类型的文件中，但它通常被称为 GeoJSON 类型，因为它包含地理属性。我们可以在<a class="ae jt" href="http://data.bandung.go.id/dataset/fbec5a0e-2efe-4d37-99ee-7a55d32beb20/resource/0a9aefc2-c849-4fb5-b393-b1687dbe8d70/download/3273-kota-bandung-level-kewilayahan.json" rel="noopener ugc nofollow" target="_blank">这个链接</a>找到 GeoJSON 数据。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="6438" class="lj kc hi lf b fi lk ll l lm ln">url = “http://data.bandung.go.id/dataset/fbec5a0e-2efe-4d37-99ee-7a55d32beb20/resource/0a9aefc2-c849-4fb5-b393-b1687dbe8d70/download/3273-kota-bandung-level-kewilayahan.json"</span><span id="279f" class="lj kc hi lf b fi lq ll l lm ln">gdf_swk = geopandas.read_file(url)</span><span id="a11f" class="lj kc hi lf b fi lq ll l lm ln">gdf_swk</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lt"><img src="../Images/47e64b37be1f1a585ebcb0fe785161a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qg7IMTdfeujWGOnMF7-euQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">SWK 数据。作者图片</figcaption></figure><p id="6779" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以看到，SWK 数据的几何类型为多边形，这意味着这些值表示面积。我们可以通过这个映射看到:</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="75b1" class="lj kc hi lf b fi lk ll l lm ln">import matplotlib.pyplot as plt</span><span id="27c3" class="lj kc hi lf b fi lq ll l lm ln">gdf_swk[‘coords’] = gdf_swk[‘geometry’].apply(lambda x: x.representative_point().coords[:])</span><span id="bedb" class="lj kc hi lf b fi lq ll l lm ln">gdf_swk[‘coords’] = [coords[0] for coords in gdf_swk[‘coords’]]</span><span id="1538" class="lj kc hi lf b fi lq ll l lm ln">fig, ax = plt.subplots(figsize = (10,10))</span><span id="82f6" class="lj kc hi lf b fi lq ll l lm ln">gdf_swk.plot(ax=ax, color=’yellow’, edgecolor=’black’)</span><span id="74dc" class="lj kc hi lf b fi lq ll l lm ln">for idx, row in gdf_swk.iterrows():</span><span id="0463" class="lj kc hi lf b fi lq ll l lm ln">   plt.annotate(s=row[‘nama_wilayah’], xy=row[‘coords’], horizontalalignment=’center’, color=’blue’)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lu"><img src="../Images/79074785d1319df64ad6366769d69d82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aOAmHxsYZkmh7wlsA2hJrQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">万隆市地图按亚省(SWK)划分。作者图片</figcaption></figure><p id="5bd7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">标签区</strong></p><p id="41ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们吃主菜:标记区域！现在我们有了一个区域标签地图，我们可以使用<code class="du lv lw lx lf b">gdf.within</code>。</p><p id="a90b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该方法将检查点/多点或线/多线是否位于所选区域内。检查区域要花很长时间，因为我们要检查每一行和每一个可用的区域。这将为每个被检查的区域返回一个二进制响应。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="64c5" class="lj kc hi lf b fi lk ll l lm ln">swk_list = list(gdf_swk[‘nama_wilayah’])</span><span id="3db2" class="lj kc hi lf b fi lq ll l lm ln">for i in range(len(swk_list)):</span><span id="fa4a" class="lj kc hi lf b fi lq ll l lm ln">   gdf[“wilayah_”+swk_list[i]] = gdf[“geometry”].within(gdf_swk[‘geometry’][i]).astype(‘int’)</span><span id="69e0" class="lj kc hi lf b fi lq ll l lm ln">gdf.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ly"><img src="../Images/a72ff36a59cfd94d002e18451da833ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C8uTTG2oiNB0HIc2JCr2rg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">每个检查区域的二进制响应。作者图片</figcaption></figure><p id="4100" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后我们可以把所有的信息放入一个单独的列中表示区域。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="dea4" class="lj kc hi lf b fi lk ll l lm ln">def get_wilayah(row):</span><span id="98fe" class="lj kc hi lf b fi lq ll l lm ln">   for c in gdf.iloc[:, 3:].columns:</span><span id="bff9" class="lj kc hi lf b fi lq ll l lm ln">      if row[c]==1:</span><span id="4fad" class="lj kc hi lf b fi lq ll l lm ln">         return c[8:]</span><span id="aa4d" class="lj kc hi lf b fi lq ll l lm ln">gdf[“wilayah”] = gdf.iloc[:, 3:].apply(get_wilayah, axis=1)</span><span id="f136" class="lj kc hi lf b fi lq ll l lm ln">gdf.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/8f0d18099556c26cef26d6d7d77af397.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3mGFbddlGDawKmJWyk6Sg.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">作者图片</figcaption></figure><p id="a7d4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以删除二进制响应列以获得更清晰的结果。</p><pre class="je jf jg jh fd le lf lg lh aw li bi"><span id="efc0" class="lj kc hi lf b fi lk ll l lm ln">gdf = gdf[[‘street’, ‘geometry’, ‘wilayah’]]</span><span id="d7f4" class="lj kc hi lf b fi lq ll l lm ln">gdf.head(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ma"><img src="../Images/1f14d5296b82311c535cafaddec71f7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h3j9CGY4JUcyWa2nJiaEZw.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">最终结果。作者图片</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><h1 id="29cd" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="0398" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">GeoPandas 软件包是一个方便的空间数据分析工具。它使我们能够根据特定区域标记坐标。我希望这篇文章能帮助那些正在或将要从事空间数据分析的人。如果你发现它令人困惑，不要犹豫，在评论区问我。</p></div></div>    
</body>
</html>