<html>
<head>
<title>How to Create a List in a Custom Editor Window in Unity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Unity的自定义编辑器窗口中创建列表</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-create-a-list-in-a-custom-editor-window-in-unity-e6856e78adfc?source=collection_archive---------1-----------------------#2021-05-25">https://medium.com/nerd-for-tech/how-to-create-a-list-in-a-custom-editor-window-in-unity-e6856e78adfc?source=collection_archive---------1-----------------------#2021-05-25</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="be8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如我在以前关于<a class="ae jd" href="https://novusxdev.medium.com/creating-a-custom-editor-menu-item-in-unity-483ec5ea15c4" rel="noopener">菜单项和编辑器</a>的文章中提到的，创建自定义窗口的想法还没有足够的文档记录。如果您想在自定义编辑器窗口中创建一个列表，该怎么办？这个话题越来越少了。</p><p id="18d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最近，我有机会为我所在地区的一个游戏工作室完成一项技术任务，该工作室需要一个自定义编辑器窗口中的列表，以便在需要时将一些物理应用到该列表中的游戏对象。我是这样解决这个问题的。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/37a293eef70cd2cfea227c23630d09f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r_TvipbsYvvEXjqsXDJHFw.png"/></div></div></figure><blockquote class="jq jr js"><p id="add2" class="if ig jt ih b ii ij ik il im in io ip ju ir is it jv iv iw ix jw iz ja jb jc hb bi translated"><strong class="ih hj">目标:</strong>在自定义编辑器窗口中创建一个列表，将物理应用到这个列表的游戏对象中。</p></blockquote><p id="c6d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在解释我是如何做到的之前，我需要快速解释两个非常重要的概念:<em class="jt">序列化对象</em>和<em class="jt">可重新排序列表</em>。</p><p id="6733" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jt">serialized object</em></strong>类允许unity处理unity对象上的序列化。这将帮助我们告诉编辑器窗口我们想要将哪个属性或对象序列化到列表中。</p><p id="8eb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"><em class="jt">ReorderableList</em></strong>类将允许我们在自定义编辑器中制作列表。它必须知道我们要列出哪个序列化对象。这个类没有任何来自Unity的官方文档(至少我没有发现)，这就是为什么没有多少人知道它。</p><h2 id="0582" class="jx jy hi bd jz ka kb kc kd ke kf kg kh iq ki kj kk iu kl km kn iy ko kp kq kr bi translated">解决办法</h2><p id="e3d4" class="pw-post-body-paragraph if ig hi ih b ii ks ik il im kt io ip iq ku is it iu kv iw ix iy kw ja jb jc hb bi translated">首先，我们需要两个脚本:</p><ol class=""><li id="3fb6" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">编辑器脚本我们称之为PhysicalSimulator，并将其添加到编辑器文件夹中(这是必须做的，否则将无法工作)。此类将从EditorWindow类而不是MonoBehaviour继承，并且必须使用以下命名空间:UnityEditor和UnityEditorInternal。</li><li id="23e4" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">保存我们将分配给SerializedObject的数组的脚本。这个脚本将保持一个MonoBehaviour，并且必须添加到场景中的游戏对象。</li></ol><p id="4dd8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里的想法是，我们将从MonoBehaviour脚本进行反射，并将该数组赋给编辑器脚本中的SerializedObject变量，以便我们可以在ReorderableList中使用。</p><p id="a83f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">单行为脚本:</strong></p><p id="1f4d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个脚本很简单，也很短(我们姑且称之为:PhysicalSimulatorList)，它会持有一个公共数组和一个引用这个数组的公共方法。我们将在编辑器脚本中使用这个公共方法。创建这个脚本后，附加到场景中的一个空游戏对象，并确保预设它，并始终将其保留在场景中。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/0693a7705776183292e955d3263a2553.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyfpGC4FWhtURlYdv3KwDA.png"/></div></div></figure><p id="6c42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> PhysicalSimulator编辑器窗口脚本:</strong></p><p id="eaee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">A.创建一些变量:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/a078399ed9fccb5587af46e448d0fe6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TIx1v5fJofdivMbVSoqedw.png"/></div></div></figure><p id="35d8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">B.向顶栏添加一个菜单项，并使用EditorWindow。GetWindow方法，以便创建可拖动和可关闭的编辑器窗口</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lm"><img src="../Images/35dae1da437c50ce07f26206ed807a0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5hjWyfaxxti4KWZQFYtkWQ.png"/></div></div></figure><p id="60eb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">C.脚本初始化:</p><ol class=""><li id="d164" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">在场景中找到保存数组脚本的对象</li><li id="8e22" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">从数组脚本创建新的SerializedObject</li><li id="e6fa" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">创建一个新的ReorderableList，它将采用上述SerializedObject并将引用您在数组脚本中分配的数组的名称。在我们的例子中，它是“objectsToSimulate”。将其draggable bool、display header bool、display add button和display remove button都设置为true。</li><li id="5dc5" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">最后处理重新排序列表的绘制</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/7def7132c005c5a6f20c0c3233092653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SncVsYSNuIIFb2hfkNGbCA.png"/></div></div></figure><p id="eced" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">D.将绘制编辑器窗口的OnGUI方法</p><ol class=""><li id="f822" class="kx ky hi ih b ii ij im in iq kz iu la iy lb jc lc ld le lf bi translated">如果你没有将数组脚本添加到场景中的游戏对象，那么我们将显示一条警告消息并停止代码运行。</li><li id="176e" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">否则，我们将更新ReorderableList，创建它，并对它和它所反映的数组应用任何修改。</li><li id="651a" class="kx ky hi ih b ii lg im lh iq li iu lj iy lk jc lc ld le lf bi translated">最后添加两个按钮，一个运行物理模拟，将刚体和网格渲染器添加到列表中的对象，另一个按钮删除这些组件。</li></ol><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/0f8a27de41c345baa85df79d22653e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lox3I32lC3Pmqowr6lWRJA.png"/></div></div></figure><p id="0154" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">E.运行和停止模拟方法。</p><p id="3cc3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在创建这个的时候遇到的一个大问题是，我能在我们刚刚创建的重新排序列表中引用和迭代游戏对象吗？现在我们可以将场景中的任何游戏对象添加到我们的重新排序列表中，但是我们不能直接引用它们。</p><p id="505c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">举个例子，如果你用下面的例子</p><pre class="jf jg jh ji fd ln lo lp lq aw lr bi"><span id="1545" class="jx jy hi lo b fi ls lt l lu lv">foreach(var obj in _listRE) //_listRE is our ReorderableList</span></pre><p id="00b6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您尝试运行此代码，将会遇到空引用异常。这是因为ReorderableList只引用列表本身，而不能引用附加到它的对象。</p><p id="5945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就是为什么我们在MonoBehaviour数组类中创建了公共getter方法。ReorderableList基本上是该数组的一个反映，所以我们在ReorderableList中所做的每一件事都发生在该数组上。因此，我们将引用数组，而不是引用ReorderableList。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lw"><img src="../Images/531243cbe313aab922ca57d4107c1414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OriLTWPlNtyaumnhXXbNdg.png"/></div></div></figure><p id="de17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在你有了它，按照这个方法，现在你在一个自定义编辑器中有了一个列表，你可以从场景中添加任何对象并操纵它。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lx"><img src="../Images/67ca7034a03379e0a1f17d2c89995e5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*0dO05-oROLdEio-Wum-6Cw.gif"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">带有列表的自定义编辑器窗口</figcaption></figure><p id="a547" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可以在这里找到完整的代码:<a class="ae jd" href="https://pastebin.com/1MnAc1TV" rel="noopener ugc nofollow" target="_blank">list _ custom _ editor—Pastebin.com</a></p></div></div>    
</body>
</html>