<html>
<head>
<title>Make Your Own Widgets Easily — Speedy BPM Counter in OSX Dashboard</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">轻松制作自己的小部件——OSX仪表板中的快速BPM计数器</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/make-your-own-widgets-easily-speedy-bpm-counter-in-osx-dashboard-87756edfa4e4?source=collection_archive---------2-----------------------#2020-09-09">https://medium.com/nerd-for-tech/make-your-own-widgets-easily-speedy-bpm-counter-in-osx-dashboard-87756edfa4e4?source=collection_archive---------2-----------------------#2020-09-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3388" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Web应用程序很常见，但不需要互联网接入的web应用程序则不常见。</p><p id="63d7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在本文中，我将向您展示如何在一个简单的HTML页面中使用普通的javascript创建BPM计数器。如果下载的话，这个小工具可以离线使用——非常适合那些想要创作但不总是能上网的音乐人。更好的是，通过使用OSX仪表板应用程序(它以前似乎从来没有这么有用)，我们可以让这个BPM计数器使用起来非常快。</p><blockquote class="je"><p id="35e7" class="jf jg hi bd jh ji jj jk jl jm jn jc dx translated"><a class="ae jd" href="https://github.com/sk-t3ch/BPM_Counter" rel="noopener ugc nofollow" target="_blank">🔗在Github上获取BPM计数器代码📔</a></p></blockquote><figure class="jp jq jr js jt ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jo"><img src="../Images/d6da06ee182877b99885a16515b3e0dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U10lZ1OTd9RZpRxj.png"/></div></div></figure><h1 id="d45b" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">应该是什么样子？</h1><p id="3daf" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">显然，问题的答案见仁见智。我的立场是，它应该超级简单，只做BPM计数器需要做的事情:计算每分钟的心跳数。因此，它所需要的只是一个按钮和一个计数值</p><figure class="lf lg lh li fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es le"><img src="../Images/e3f819065d96b07d8eb344a6ebc37c0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fwxw3vi6b7Qs2MMrWo_EOQ.png"/></div></div></figure><h1 id="c7c4" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">逻辑</h1><p id="3961" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">估计BPM就像测量两次连续心跳之间的时间，并计算一分钟内你可以完成多少次一样简单。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="682a" class="lo kc hi lk b fi lp lq l lr ls">let prev_click = new Date(); </span><span id="ea9a" class="lo kc hi lk b fi lt lq l lr ls">const getBPM = function (){<br/> const currentTime = new Date();<br/> const interval = (currentTime - prev_click)/1000;<br/> const bpm = 60/interval;<br/> prev_click = currentTime;<br/> return bpm;<br/>} </span><span id="1153" class="lo kc hi lk b fi lt lq l lr ls">get_bpm(); // e.g. 120</span></pre><p id="bc5b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我进一步对之前的3个节拍进行平均，如下所示:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="688d" class="lo kc hi lk b fi lp lq l lr ls">const averaging = 3;<br/>const prev_bpms = [60];</span><span id="e90e" class="lo kc hi lk b fi lt lq l lr ls">const getBPM = function() {<br/> const currentTime = new Date();<br/> const interval = (currentTime - prev_click) / 1000;<br/> const bpm = 60 / interval;<br/> prev_click = currentTime;<br/> while (prev_bpms.length &gt; prev_bpm_list_max_length) {<br/>    prev_bpms.shift();<br/> }<br/> prev_bpms.push(bpm);<br/> average_bpm = prev_bpms.reduce((acc, cVal) =&gt; acc + cVal) / prev_bpms.length;<br/> return bpm;<br/>} <br/><br/>get_bpm(); // e.g. 120</span></pre><p id="6d3b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，不是每个人都想按下按钮，而是按下一个键:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0d59" class="lo kc hi lk b fi lp lq l lr ls">// space bar trigger<br/>window.addEventListener('keypress', (e) =&gt; {<br/> if(e.code === 32) getBPM();<br/>});<br/>// instant ability<br/>document.querySelector('.clicker button').focus();</span></pre><p id="1d6e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，一旦页面加载完毕，用户也可以使用空格键点击。</p><h1 id="c99a" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">听到你的BPM</h1><p id="3ada" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">你已经输入了BPM，但现在你想回放它，这样你就可以跟着你最喜欢的节奏一起演奏了。</p><p id="80e8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为此，我们必须发出声音。但是怎么做呢？我们在浏览器<a class="ae jd" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API" rel="noopener ugc nofollow" target="_blank">音频</a> API中内置了两个选项，使用声音文件或者创建一个合成器。</p><p id="f89c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将首先使用合成器创建一个蜂鸣声:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0fb7" class="lo kc hi lk b fi lp lq l lr ls">const AudioContext = window.AudioContext || window.webkitAudioContext;</span><span id="696e" class="lo kc hi lk b fi lt lq l lr ls">let context, oscillator;<br/>const bpm = 60;<br/>const bpmInterval = 60/bpm * 1000; //ms</span><span id="c378" class="lo kc hi lk b fi lt lq l lr ls">setInterval(beep, bpmInterval);</span><span id="be68" class="lo kc hi lk b fi lt lq l lr ls">const beep = function (){<br/>      if(!context) context = new AudioContext();<br/>      oscillator = context.createOscillator();<br/>      oscillator.type = "sine";<br/>      oscillator.start(0);<br/>      oscillator.connect(context.destination);<br/>      setTimeout(oscillator.disconnect, 150, context.destination);<br/>    }</span></pre><p id="a348" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在让我们用一个音频文件来做类似的事情:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5f03" class="lo kc hi lk b fi lp lq l lr ls">const click = new Audio('./cowbell.mp3');<br/>const bpm = 60;<br/>const bpmInterval = 60/bpm * 1000; //ms</span><span id="3d58" class="lo kc hi lk b fi lt lq l lr ls">setInterval(beep, bpmInterval);</span><span id="52d8" class="lo kc hi lk b fi lt lq l lr ls">const beep = function (){<br/>      click.play();<br/>      setTimeout(()=&gt;{ <br/>          click.pause(); <br/>          click.currentTime = 0.0;<br/>        }, 150);<br/>    };</span></pre><p id="ad6b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后添加控制它们的逻辑:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="8823" class="lo kc hi lk b fi lp lq l lr ls">// HTML<br/>&lt;div class="player"&gt;<br/>        &lt;button class="controler" onclick="togglePlayerOutput()"&gt;<br/>          &amp;#9654;<br/>        &lt;/button&gt;<br/>&lt;/div&gt;<br/></span><span id="b982" class="lo kc hi lk b fi lt lq l lr ls">// JS<br/>let isPlayerPlaying = false;<br/>let bpmRepeaterId;</span><span id="2ab5" class="lo kc hi lk b fi lt lq l lr ls">const togglePlayerOutput = function (){<br/>        const button = document.querySelector('.player button');<br/>        if (!isPlayerPlaying){<br/>          button.innerHTML = '&amp;#9724;';<br/>          bpmRepeaterId = setInterval(beep, bpmInterval);<br/>        }<br/>        else{<br/>          button.innerHTML = '&amp;#9654;';<br/>          clearInterval(bpmRepeaterId);<br/>        }<br/>        isPlayerPlaying = !isPlayerPlaying;<br/>    };</span></pre><h1 id="d4b6" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">把所有的放在一起</h1><figure class="lf lg lh li fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es lu"><img src="../Images/ae4e98aa4d7359bd755d0f16198cb88c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqL2RCN9LeI9DV0KGUstoA.png"/></div></div></figure><p id="59c8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在把所有的功能放在一起，再加上一点点造型(我不打算解释)，我们就有了这个最终产品:</p><p id="6c57" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我不知道有多少代码人们真的想直接在文章中看到，所以在<a class="ae jd" href="https://github.com/sk-t3ch/BPM_Counter" rel="noopener ugc nofollow" target="_blank"> Github </a>找到完整代码。</p><h1 id="0583" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">有效使用(仅限OSX用户)</h1><p id="fff6" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">如果你以前使用过mac，你可能会偶然发现原生的Dashboard应用程序，但你可能不会停留很久。</p><p id="27e7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我从来没有真正用过它…直到现在。</p><p id="ea3c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在Safari中，你可以右击页面，有时会弹出一个操作选项，包括<em class="lv">在仪表板中打开… </em></p><figure class="lf lg lh li fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es lw"><img src="../Images/5a7be58a89f99614a820983d00c28729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0HBoMjMJGgw5wdYAl6AXDg.png"/></div></div></figure><p id="1120" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击这里，你会看到一个网页小工具的创建者。您可以选择要添加到仪表板中的页面部分。这是一个非常酷的特性，但是对于我们来说，这是一个超级酷的特性。</p><p id="ab25" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">打开我们刚刚制作的BPM计数器，您可以像这样选择框:</p><figure class="lf lg lh li fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es lx"><img src="../Images/5f943d0e8e42865b228da3d941eb4b2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C3xxvy9tDqPTcb2aRTJ8Xg.png"/></div></div></figure><p id="f90b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在使用F12键的快捷键。嘣。自己快速、轻松地创建小部件从未如此容易。</p><figure class="lf lg lh li fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es lx"><img src="../Images/4d69467065894a64c7149b14917bc8eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2GcGa7Qx7TcAQTKBow9eXg.png"/></div></div></figure><p id="e8d6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你可能想知道为什么这个没有节拍器回放功能。当我试图在仪表板中使用它时，程序不能可靠地播放音频:(但至少逻辑可以很容易地做到这一点。</p><p id="6aba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我向你们展示如何用两种不同的方式创造声音的原因是，使用合成器的<code class="du ly lz ma lk b">Audio Context</code>版本在仪表盘内无法工作。</p><p id="4d21" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，你不能简单地点击F12并继续使用空格键来获得速度，你必须直接点击按钮，这是一个降级。</p><p id="733e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但我想这可能是我从现在开始制作小部件的方式。如果你对此有什么很酷的想法，当你实现的时候给我看看:)</p><blockquote class="je"><p id="a537" class="jf jg hi bd jh ji jj jk jl jm jn jc dx translated"><a class="ae jd" href="https://github.com/sk-t3ch/BPM_Counter" rel="noopener ugc nofollow" target="_blank">🔗在Github上获取BPM计数器代码📔</a></p></blockquote><h1 id="3e7d" class="kb kc hi bd kd ke kf kg kh ki kj kk kl km mb ko kp kq mc ks kt ku md kw kx ky bi translated">感谢阅读</h1><p id="6b43" class="pw-post-body-paragraph if ig hi ih b ii kz ik il im la io ip iq lb is it iu lc iw ix iy ld ja jb jc hb bi translated">查看<a class="ae jd" href="https://t3chflicks.org/Projects/bpm-counter" rel="noopener ugc nofollow" target="_blank">T3chFlicks.org</a>获得更多以科技为中心的教育内容(<a class="ae jd" href="https://www.youtube.com/channel/UC0eSD-tdiJMI5GQTkMmZ-6w" rel="noopener ugc nofollow" target="_blank"> YouTube </a>、<a class="ae jd" href="https://www.instagram.com/t3chflicks/" rel="noopener ugc nofollow" target="_blank"> Instagram </a>、<a class="ae jd" href="https://www.facebook.com/t3chflicks" rel="noopener ugc nofollow" target="_blank">脸书</a>、<a class="ae jd" href="https://twitter.com/t3chflicks" rel="noopener ugc nofollow" target="_blank"> Twitter </a>)。</p></div></div>    
</body>
</html>