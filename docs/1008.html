<html>
<head>
<title>golangci-lint and the GoLand IDE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">戈兰奇-林特和戈兰德</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/golangci-lint-and-the-goland-ide-42aabc14f7d5?source=collection_archive---------4-----------------------#2021-03-01">https://medium.com/nerd-for-tech/golangci-lint-and-the-goland-ide-42aabc14f7d5?source=collection_archive---------4-----------------------#2021-03-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f29a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">即使这篇文章是用 GoLand IDE 作为最终游戏编写的，我想这里的思想也适用于任何现代 IDE。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/a890a009087d7d06920c910f11fe9554.png" data-original-src="https://miro.medium.com/v2/resize:fit:460/format:webp/1*w4VRpAM-3wCP1BbotSXV0Q.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">基于雷尼·弗伦奇的原创作品</figcaption></figure><p id="9d52" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在你的 golang 程序上运行静态代码分析(又名<em class="jd">林挺</em>)是对抗糟糕编码的第一道防线，也是开始你的 golang 代码审查实践的一种廉价方式。这也是持续集成管道中的第一道质量关。本文讲的是前者。</p><p id="c048" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那里有一个 golang linters 的完整列表，单独运行每个列表并不是很有趣。于是<a class="ae jq" href="https://golangci-lint.run/" rel="noopener ugc nofollow" target="_blank"> golangci-lint </a>诞生了。与单独运行每个 linter 相比，这个软件将以一种非常高效的方式运行您喜欢的 linter(可能借助于 shell 脚本)。此外，习惯上只在 CI 管道中运行 linters，而不在开发环境中运行。通常，最终会配置对“有问题的”lint 错误的抑制，甚至更糟:一起禁用 liting。</p><h1 id="c8d0" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">当林挺成为敌人时</h1><p id="acec" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">从命令行运行 golangci-lint(或任何 linter)可能会导致一系列问题，然后您需要在一个窗口中列出这些问题，并在编辑器中手动修复这些问题。</p><p id="0c3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">雪上加霜的是，如果您使用的是 Unix 衍生的操作系统，那么关于如何在 JetBrains GoLand IDE 下运行 linter 的文档可能就足够了。事实上，golangci-lint 文档中提出的设置一切都很好。<strong class="ih hj">然而</strong>，当受限于企业环境开发设置时，安全歇斯底里使您的 CPU 花费太多的周期来实时扫描所有和每个文件系统操作…嗯…事情变慢了，您的 IDE 感觉就像 PTFE 覆盖的垂直杆上的鼻涕虫。</p><p id="7cad" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，让 linter 在编码时抛出 lint 错误会分散对实际编码的关注。我想这可能是人们喜欢编辑器(vim、Emacs、Sublime Text 等)和更简单的 IDE(比如 VS Code)而不是成熟的 IDE 产品的一个原因。</p><p id="804d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这种干扰类似于违背你的意愿或超出你的控制的强制<a class="ae jq" href="https://www.linkedin.com/pulse/context-switching-developers-paul-graham" rel="noopener ugc nofollow" target="_blank">上下文切换</a>。</p><p id="b206" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">很有可能你会说<em class="jd">去他妈的</em>然后一起禁用林挺。</p><h1 id="3f3b" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">按需运行棉绒机</h1><p id="fb24" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">任何 IDE 最酷的地方就是它的构建配置(也称为。<em class="jd">运行/调试配置</em>。大多数情况下，这些只是用于这个目的:设置运行&amp;调试配置。但是，您瞧，通常您可以设置一个运行/调试配置来运行 shell 脚本(Powershell 脚本确实属于这一类)。</p><p id="7cb2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> NB </strong>:在下面的示例设置中，我将使用<em class="jd"> Gorm </em>包。这篇文章并不反映软件包的质量，它在这里只是作为一个例子。我喜欢这个套餐并且用过，不止一次推荐。</p><p id="fa7e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我喜欢使用 GoLand IDE，它有足够的智能来检测我的程序正在产生什么样的输出。其中，它将检测给定文件的路径以及相应的行号和列号。当点击链接时，编辑者的光标将被放置在文件的相应位置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/c747f8ffdc60089b14fe31e8c7ab2d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fv50DN6aKDS7BkDoRQ-iNA.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">在 GoLand IDE 中使用 tab 格式运行 golangci-lint 的输出示例。</figcaption></figure><p id="e58e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可能更喜欢 golangci-lint 产生的其他输出之一。我喜欢这种输出格式(名为<em class="jd">标签</em>，因为它清晰明了，减少了信息过载。我发现这个输出中缺少的是 lint 问题的严重性(默认情况下，golangci-lint 将所有内容都视为严重错误)。</p><p id="4ea4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">另一方面，默认输出过于冗长，我不喜欢。</p><pre class="jf jg jh ji fd kz la lb lc aw ld bi"><span id="c925" class="le js hi la b fi lf lg l lh li">F:\gorm/callbacks\callbacks.go:28:24: Error return value of `queryCallback.Register` is not checked (errcheck)<br/> queryCallback.Register(“gorm:preload”, Preload)<br/> ^<br/>F:\gorm/callbacks\callbacks.go:29:24: Error return value of `queryCallback.Register` is not checked (errcheck)<br/> queryCallback.Register(“gorm:after_query”, AfterQuery)<br/> ^<br/>F:\gorm/callbacks\callbacks.go:32:50: Error return value of `(*gorm.io/gorm.callback).Register` is not checked (errcheck)<br/> deleteCallback.Match(enableTransaction).Register(“gorm:begin_transaction”, BeginTransaction)</span></pre><p id="4899" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您首先需要的是一个包装器 shell 脚本。写这篇文章时，考虑到了 Windows 的烦恼。这就是 Powershell。我们把这个文件叫做 linting.ps1:</p><pre class="jf jg jh ji fd kz la lb lc aw ld bi"><span id="b1f9" class="le js hi la b fi lf lg l lh li">$location = "$(Get-Location)"<br/>golangci-lint.exe run --out-format tab --path-prefix $location $args[0]</span></pre><p id="24e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">$args[0]允许您向脚本传递一个目录名，这样就可以一次只 lint 一个子程序包。</p><p id="22dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您需要的第二件事是在 Powershell 脚本上调用运行/调试配置(或者您可以在 shell 脚本上调用，并将 Powershell 作为解释器使用)。当然，Jetbrains IDEs 提供了 Powershell 配置。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es lj"><img src="../Images/a6d6dfff0b824f0bbcc276daf296f08e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgYaAC62QFzgMh4u8YIseg.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx translated">Powershell 运行/调试配置示例。</figcaption></figure><p id="f032" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您现在可以按需运行林挺了。</p><p id="5ed1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用运行/调试配置中的<em class="jd">脚本参数</em>字段，通过传递相应的目录名来分析子包。</p><h1 id="0880" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">关于下一步去哪里的建议</h1><p id="3ca2" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我发现的一些更好的做法<em class="jd">你可以考虑使用:</em></p><ul class=""><li id="8fcf" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated">定义要使用的棉绒。有几个可用的棉绒，启用一切和厨房水槽可能会适得其反，所以从默认开始。使用什么样的 linters 可以作为命令行选项传递给 golangci-lint 程序。看看<a class="ae jq" href="https://golangci-lint.run/usage/linters/" rel="noopener ugc nofollow" target="_blank">https://golangci-lint.run/usage/linters/</a>的可用棉绒概览。</li><li id="518b" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">命令行选项太多，生活一团糟。请改用配置文件。一个很好的起点是 https://golangci-lint.run/usage/configuration/#config-file。</li><li id="87ea" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">通过修改配置文件来调整 linters 的行为。您的团队可能会发现，如果函数超过 60 行或 40 条语句，并且行长度超过 120 个字符，那么函数仍然是可读的。</li><li id="9f75" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">林挺整个存储库可能很吸引人，但由于可能返回大量 lint 错误，很快就会变得令人不知所措。Lint 一次一个包是更好的方法。</li></ul><h1 id="a304" class="jr js hi bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">关于配置文件选项的几点注意事项</h1><p id="40f9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">我不会详细说明使用哪种 linters 等等，因为本文的范围是 IDE 中的<em class="jd">林挺。我将触及的唯一配置与此主题相关。</em></p><pre class="jf jg jh ji fd kz la lb lc aw ld bi"><span id="0138" class="le js hi la b fi lf lg l lh li">output:<br/><em class="jd">  </em>path-prefix: ""<em class="jd"><br/>  </em>sort-results: true<br/> <em class="jd"> </em>format: tab</span><span id="bed7" class="le js hi la b fi ly lg l lh li"><em class="jd">  </em>print-issued-lines: false<br/><em class="jd">  </em>print-linter-name: true<em class="jd"><br/>  </em>uniq-by-line: false<em class="jd"><br/></em></span></pre><p id="0cbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">前三个选项对我们的<em class="jd">按需上市最重要。</em></p><ul class=""><li id="8635" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated"><strong class="ih hj"> path-prefix: "" </strong>这个值无关紧要，因为它被(Power)shell 文件中相应的命令行选项所覆盖。但是为了清楚起见，空白和任何东西一样好。</li><li id="5632" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated">sort-results: true 你想让每个文件都分组在一起，而不是到处都是。</li><li id="e083" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated"><strong class="ih hj">格式:标签</strong>如上所述，我发现<em class="jd">标签</em>-格式比其他格式更容易阅读。</li></ul><p id="d860" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">请自行决定使用以下选项:</p><ul class=""><li id="5ab5" class="lk ll hi ih b ii ij im in iq lm iu ln iy lo jc lp lq lr ls bi translated"><strong class="ih hj">print-issued-lines:false</strong>如果设置为<em class="jd"> true </em>并使用任何其他格式化程序，将产生非常冗长的输出。</li><li id="6138" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated"><strong class="ih hj"> print-linter-name: true </strong>知道哪些棉绒对什么有反应是有帮助的。</li><li id="f4ce" class="lk ll hi ih b ii lt im lu iq lv iu lw iy lx jc lp lq lr ls bi translated"><strong class="ih hj"> uniq-by-line: false </strong>进一步减少了可能的信息过载。</li></ul></div></div>    
</body>
</html>