<html>
<head>
<title>Vaccine Booking System — Dealing with our Glastonbury</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">疫苗预订系统——应对我们的格拉斯顿伯里</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/vaccine-booking-system-dealing-with-our-glastonbury-4d9875eb2477?source=collection_archive---------7-----------------------#2021-06-09">https://medium.com/nerd-for-tech/vaccine-booking-system-dealing-with-our-glastonbury-4d9875eb2477?source=collection_archive---------7-----------------------#2021-06-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="5601" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">本文简要介绍了疫苗国家预订系统是如何应对需求高峰的。2021 年 6 月 8 日是预订量最大的一天，预订量超过 100 万。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/2419f99be199081160596113feeced49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*p67f0LP8XujvgdhAHT7ckA.jpeg"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">西蒙·史蒂文斯爵士在格拉斯顿伯里</figcaption></figure><p id="14fe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在设计这个系统的时候，我们不知道人们会对疫苗有什么反应，也不知道他们会被邀请去接种疫苗。疯狂的非功能性需求开始被抛出——它必须处理 5000 万同时想要疫苗的人！事实上，这是不现实的，整个国家不会在预定的时候停下来预定疫苗。然而，我们有两件事要考虑:</p><p id="de01" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">1)我们如何保护系统免受流量激增的影响<br/> 2)我们如何使进入系统的流量平稳</p><p id="7090" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为英国人，答案必须是排队！</p><p id="ddf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，从架构的角度来看，我不希望人们排队，我希望人们尽快得到他们的预订。如果有排队，晚点再来总比等好。总的来说，该系统被设计得尽可能快，让尽可能多的人预订。</p><h1 id="52b9" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">防止浪涌</h1><p id="d0d4" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">NHS 内部。英国我们已经使用 Akamai 作为 Web 应用防火墙(WAF)和内容交付网络(CDN ),并在过去首次宣布测试时，为我们构建的 covid 测试解决方案成功实施了访问者优先化 Cloudlet<a class="ae ks" href="https://www.akamai.com/uk/en/products/performance/cloudlets/visitor-prioritization.jsp" rel="noopener ugc nofollow" target="_blank">https://www . Akamai . com/UK/en/products/performance/Cloudlet/Visitor-priorization . JSP</a>。这利用了 Akamai 的巨大容量，根据我们控制的百分比将人们留在等待区。鉴于 Akamai 的规模，我们不担心它能处理我们可能看到的流量，也不担心它能为我们保持流量。由于这是基于%的，我们没有任何一次进入该系统的绝对人数。200 万的 0.1%是 2000 人每秒进入系统，这个数字太高了。此外，我们不能告诉人们这个页面会让他们停留多久，因为用户体验并不美妙，但它是为了保护系统而设计的。</p><p id="6e28" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 Akamai 中设置阈值非常容易，无论是通过门户还是 CLI。我们采取的方法是在 Azure DevOps 中创建一个管道来做到这一点，并随后将其链接到团队，以便它可以由执行监控的团队触发。这也意味着我们可以将部署推迟到以后的时间和日期。正如我们所知，当新的队列被邀请时，我们可以设置 Akamai 在早上的特定时间部署，以提供浪涌保护，而无需早起！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kt"><img src="../Images/26012363d4c320c98fafbe19cc825424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/1*SPSXvWs4q2DKCJ-OzEbbjA.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">Azure DevOps 管道</figcaption></figure><h1 id="2c3c" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">畅通交通</h1><p id="ca47" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">一旦我们处理了这种激增，我们就需要一种更细粒度的方法来控制任何时候预订旅程中的人数。这就是第二个队列出现的地方。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es ku"><img src="../Images/fd1b4d759a1be1beb108a8a41a694733.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3vMcz6o_yEhsa5hI"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">队列页面</figcaption></figure><p id="90b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在控制排队人数时，我们有两个杠杆可以利用。实际预订的人数和排队的人数。我们用上面的 Akamai 来控制进入队列的人数。我们通过调整区域大小来控制预订人数。</p><p id="2da6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们在 6 月 8 日经历的是，早上排队的人越来越多，而且还在以我们从未有过的速度增长。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="er es kz"><img src="../Images/c1b004881f91b7c726701205151a50a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6W6VV9pz0QnST2KnVdlSDg.png"/></div></div></figure><p id="9768" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">随着队列的增长，我们允许更多的人加入到预订的旅程中，直到我们达到一个提供足够吞吐量的水平，而不会过度增加部分架构的压力。一旦队列开始减少，我们就让更多的人从 Akamai 进入队列。第二队人在下午 2 点左右被清空。</p><h1 id="147d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么这次队伍更长？</h1><p id="8bf9" class="pw-post-body-paragraph if ig hi ih b ii kn ik il im ko io ip iq kp is it iu kq iw ix iy kr ja jb jc hb bi translated">我们采用这种双队列方法的原因是我们不知道人们将如何与系统交互。我们会看到大量的人涌入吗？人们会等到短信到达后再预订吗？或者有多少人听说可以预订，会马上去预订？根据交通状况，更有可能是后者。旅程分为两部分，资格检查和旅程的实际预订部分。队列需要保护这两者，在你被证明有资格后，中途出现第三个队列是相当奇怪的。一部分人昨天被告知他们不符合资格，这可能意味着他们在旅程的资格部分花费了比平时更多的时间。这对于不让更多的人进来有一个间接的影响，排队是一个接一个的方法。如果人们不能进去，他们就开始排队。这并不是说我们根本不会有队列，但它可能会更小。这就是我们开始使用杠杆的地方。增加 elgibility 的人数，其总容量大于预订量，知道某个百分比将无法通过，但能够实现预订的恒定吞吐量。监控系统的不同部分，确保没有过热的部分，然后尽可能增加人员的吞吐量。尽管关键的目标是让尽可能多的人预订疫苗。6 月 8 日我们做到了，超过 100 万剂被预订，对我们所有人来说都是破纪录的一天。</p></div></div>    
</body>
</html>