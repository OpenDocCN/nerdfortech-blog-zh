# 2005-2016 年法国 Kaggle 数据集事故的 Power BI 第一部分准备

> 原文：<https://medium.com/nerd-for-tech/power-bi-on-kaggle-dataset-accident-in-france-from-2005-to-2016-part-1-preparation-89842a8836e2?source=collection_archive---------6----------------------->

在这一部分中，我们将把 CSV 格式的数据集准备成 Power BI 上的现成数据。这里是数据集的[链接](https://www.kaggle.com/ahmedlahlou/accidents-in-france-from-2005-to-2016)和你需要知道的一切。到本文发表时，数据集的许可证是 [**CC0:公共域**](https://creativecommons.org/publicdomain/zero/1.0/) ，这意味着:

> 在法律允许的范围内，将作品与本契约相关联的人通过放弃其在版权法下对该作品的所有权利，包括所有相关和邻接权，将该作品奉献给公共领域。
> 
> 您可以复制、修改、分发和执行作品，即使是出于商业目的，都无需征得许可。参见下面的**其他信息**。

所以让我们开始吧！

正如我在标题中提到的，我们将在这个项目中使用的工具是 Power BI。所以在你的 Windows 操作系统上双击你的 Power BI 图标(很遗憾 Power BI 现在只能在 Windows 上使用)。

第一步是将数据集加载到 Power BI 中。这一步非常简单。在“主页”选项卡上，单击“获取数据”的底部，展开最常见的数据源，以便在 Power BI 上加载数据。选择文本/CSV。

![](img/58a200ed4410382026184f23cbb1cf47.png)

导入文本/CSV 文件

当您在“获取数据”窗格上选择“文本/CSV”时，会弹出以下选项卡。通常分隔符会在你加载数据时自动选择，所以就让它保持原样吧。但是，您可能希望使用文件来源来避免误解 Power BI 上的字符。通常我选择 65001:Unicode (UTF-8)作为开始，然后看看它会怎么样。正如我们所看到的，列 adr 并没有显示出许多怪异的字符，所以我们可以开始了。

![](img/0d78e84b114696cc7d0ff7d91b6ea740.png)

格式化导入的 CSV 文件

对数据集上的每个 CSV 重复这些步骤，并更改表名，以便可以容易地识别它。为此，右键单击查询窗格上的表名，单击重命名并键入所需的名称。结果将如下所示:

![](img/317982cc3583d2460613e911f1c21054.png)

加载所有数据

除了表名之外，我将列名改为一个更熟悉的术语，因为我将使用它来制作一个仪表板。这个重命名的步骤可能会让你感到厌烦(它确实让我感到厌烦)，但是你会很感激你这么做了。命名的参考可以在这个[链接](https://www.kaggle.com/ahmedlahlou/accidents-in-france-from-2005-to-2016)上找到。

你可能提到过一些字段包含代码而不是描述。这意味着我们需要创建一些维度表来让它变得可以理解。同样，这个[链接](https://www.kaggle.com/ahmedlahlou/accidents-in-france-from-2005-to-2016)提供了您可以参考的数据目录。这是其中一个数据目录。

![](img/a22a9af6ec974a71763b741b299bcf78.png)

在特性表的 lum 字段中，我们有 1 到 5 个事故发生时闪电条件的代码参考。所以让我们试着用它做一个维度表。

为此，请通过单击主页选项卡上的编辑查询图标转到超级查询编辑器。当超级查询编辑器窗口打开时，选择主页选项卡，单击输入数据。

![](img/2f42019ce8acd36932c796e7999dc1d8.png)

编辑查询以打开超级查询编辑器窗口(最右侧)

![](img/b36add22470e9f72a8c3f97965595c29.png)

输入数据以创建空表(右边第二个)

现在填写表名、列名和表行。单击确定完成。

![](img/a252836532257a6b6c7a06f3ed4af973.png)

创建维度表

另一个重复的任务是准备数据，因为你可能需要对其他维度做完全相同的事情。我至少创建了 20 个维度表。我知道，请拥抱它。

其中一个维度表有特殊处理，每个代码代表不同的含义。你可以通过两件事来解决这个问题:

1.  拆分代码，使每个维度表与前一个表完全相同，或者
2.  在一维表中，将安全设备存在表上的每个项目交叉连接到安全设备的使用上。桌子上总共有 5 x 3 行，包括腰带是、腰带否、腰带不确定、头盔是等。

![](img/45ef9ab88e40e2a77e05bdc9c4231975.png)

数据目录

我选择了第一种方法，将列一分为二。为此，在 Power Query Editor 上选择用户表并选择相应的列 secu。在主页选项卡上，选择拆分列，然后单击按字符数。我们选择按字符数分割，因为我们知道它正好由 2 个字符组成，我们希望将其分割成 1:1。

![](img/abe15d74aba308658d1d90f39bb2d577.png)

合并列

键入 1 作为字符数，并重复选择，因为我们确信不会有任何单元格包含超过 2 个字符。然后单击确定。

![](img/35ee597afaad6ec8d5b43d6c6562bd0b.png)

按字符数分割列设置

现在我们有了这些列，所以我们可以根据自己的需要对其进行重命名。

![](img/ef4492f87a491905fd93aaf35bc32eea.png)

拆分列结果

在特征表中，我们将事故日期分为三列。然而，我们有假日表，日期列在一个单独的列上。

![](img/4f09327e359a3a14e1b9df5cac71b8f7.png)

在特征中拆分日期列

![](img/f81d4c52ce6063d48b95814a7b273faa.png)

假日中日期的合并列

这个条件使得这两个表之间的关系是不可能的。为了实现表特征和假日之间的关系，我们将使日期格式统一，就像我们在假日表中看到的那样，它在一列中。为此，需要对特性表进行更改。

首先，我们需要为 YearOfAccident 列添加前缀 20，使其成为 YYY 格式。选择相应的列，然后在转换选项卡上，选择格式，单击添加前缀。

![](img/8f4137cf318c5088e1c3b47995854f1b.png)

添加前缀

因为数据集由 2000 年及以后的数据组成。我们在前缀值上填入 20，然后单击 OK。

![](img/fe924cef18a0d109c49ec1c447a643a6.png)

前缀设置

结果如下:

![](img/9b7729b6b2e3f3716cfde47c7a46377e.png)

前缀结果

现在我们需要在月份和日期列上制作 MM 和 DD。为此，我们在两列上都添加 0 作为前缀。

![](img/dde9893a19bc4dbd14f44ccf73153f20.png)

添加前缀

![](img/a1c5962678d35baf1d0943e23e0fb812.png)

前缀设置

不同之处在于，我们添加了另一个步骤，只获取最后两个字符，这样我们就可以在单个字符日期上有一个前导零，如 01、02、03 等。现在选择月份列。在转换选项卡上，选择提取，单击最后一个字符。

![](img/c8c8632e3da698cc5841826dce5c877f.png)

前缀结果

我们填入 2 作为计数，因为我们需要该列的最后两个字符。

![](img/27da1405e5bb11492966ffe1156e4148.png)

获取最后两个字符

![](img/e5d75c8a1c9151cba8879206a19ee03b.png)

月份的 MM 格式

![](img/c5f233857b0600bd725a94ea1872c033.png)

日期格式

因为我们在每一列上都有 YYYY、MM 和 DD 格式。现在我们将列合并为一列，列之间用“-”作为连接符。为此，请选择年、月和日期列。在添加列选项卡上，单击合并列。

![](img/0355c38f6f884e998d4fd22a38958315.png)

合并列

现在，我们添加“-”作为每列的分隔符，并单击“确定”。

![](img/e185b921ea4d25fa85dea3048c8671b8.png)

合并列设置

瞧啊。我们想要的日期格式列。

![](img/cc6772fe2b942373e408b8f7ffbd6a9e.png)

合并列

在超级查询编辑器窗口上要做的最后一件事是更改每个列的数据类型。数字和代码转换成整数，日期转换成日期。通常 Power BI 可以自己检测数据类型，但要确保您有正确的数据类型。这可以通过简单地点击列名旁边的小图标并选择你想要的数据类型来完成。

![](img/2d1b7a4aadab7b6f0e03e245ca57e80d.png)

数据类型设置

![](img/be65753e8b45a76d2994e7025ca67e85.png)

数据类型设置

现在，我们已经准备好将所有的表相互连接起来。让我们逐一连接它们。现在，您可以通过单击主页选项卡上的关闭和应用来关闭超级查询编辑器窗口

![](img/206ff282a30a7dacb7a73a39e5b8e8ce.png)

关闭并应用以保存更改

加载过程完成后，在 Relationship 选项卡中，通过将列名拖动到其目标列来连接每个节点。请注意，它必须是源和目标的正确列。例如，要将性别维度表连接到用户表，您需要将包含代码的性别维度表上的性别 Id 拖动到用户表上的性别列。所以这是我几乎最终的感情观。

![](img/a6e32f42ee8facb477776a2b41d54bf0.png)

几乎结束关系

该死。我在创建关系时发现了一个错误！这是因为两列都没有唯一值列表。事故可能一天发生两次，两个假期也可能在同一天。基本上这两个表之间的关系是多对多的。为了克服这种多对多的问题，我们需要一个包含日期的唯一值的辅助表。

![](img/182cf5280bec86dc014422a27ab079a7.png)

多对多关系上的错误

我在这里找到了一个很棒的教程。我将步骤简化为 3 步。

首先，通过单击主页选项卡上的编辑查询打开超级查询编辑器。然后，通过单击“主页”选项卡上“新建源”的下部区域来创建一个空白查询。点击空白查询。

![](img/4d21b223d942718b927d240cc52f4c81.png)

创建空白查询

其次，添加开始日期和结束日期两个参数。通过点击管理参数并选择新参数。

![](img/5d5f4d19f9fe676117f981605e3893d8.png)

添加新参数

填写 StartYear 参数的名称。将数据类型更改为十进制数，并将当前值填写为 2000。

![](img/21c4d27e9db96d9fe598f0a5b1a3c5e5.png)

设置 StartYear 参数

对 EndYear 做同样的操作，除了用 2030 填充当前值，因为我们要列出从 2000 年到 2030 年的日期。如果你愿意，可以改变年份。

![](img/0f0c4076006eb0648c7532cc2945533c.png)

设置年末参数

第三，从链接[这里](https://radacad.com/create-a-date-dimension-in-power-bi-in-4-steps-step-1-calendar-columns)复制完整的脚本到 advance editor，你就可以开始了。

> 设
> StartDate = #date(StartYear，1，1)，
> EndDate = #date(EndYear，12，31)，
> NumberOfDays = Duration。天数(EndDate - StartDate)，
> 日期=列表。Dates(StartDate，NumberOfDays+1，#duration(1，0，0，0))，
> # "转换为表格" =表格。FromList(日期，拆分器。SplitByNothing()，null，null，ExtraValues。错误)，
> # "重命名的列" =表。RenameColumns(# "已转换为表"，{{"Column1 "，" FullDateAlternateKey"}})，
> # "已更改类型" =表。TransformColumnTypes(# "重命名的列"，{{"FullDateAlternateKey "，type date}})，
> # "插入的年份" =表。AddColumn(# "已更改类型"，"年份"，每个日期。年份([FullDateAlternateKey])，类型号)，
> # "插入的月份" =表。AddColumn(# "插入的年份"，"月份"，每个日期。月([FullDateAlternateKey])，类型号)，
> # "插入的月名" =表。AddColumn(# "插入的月份"，"月份名称"，每个日期。month name([FullDateAlternateKey])，type text)，
> # "插入的季度" =表。AddColumn(# "插入的月份名称"，"季度"，每个日期。QuarterOfYear([FullDateAlternateKey])，类型号)，
> # "插入的一年中的周" =表。AddColumn(# "插入的季度"，"一年中的星期"，每个日期。WeekOfYear([FullDateAlternateKey])，类型号)，
> # "插入的月份周" =表。AddColumn(# "插入的一年中的星期"，"一月中的星期"，每个日期。WeekOfMonth([FullDateAlternateKey])，键入数字)，
> # "插入的日期" =表。AddColumn(# "插入一个月中的第几周"，"第几天"，每个日期。日([FullDateAlternateKey])，类型号)，
> # "插入的星期几" =表。AddColumn(# "插入的日期"，"星期几"，每个日期。Day ofweek([FullDateAlternateKey])，类型号)，
> # "插入的一年中的某一天" =表。AddColumn(# "插入星期几"，"一年中的某一天"，每个日期。Day ofyear([FullDateAlternateKey])，类型号)，
> # "插入的日名" =表。AddColumn(# "插入的一年中的某一天"，"天名称"，每个日期。DayOfWeekName([FullDateAlternateKey])，在
> #“插入的日期名称”中键入 text)

结果如下:

![](img/377862419d8cf60157d7b751c279e7ca.png)

创建空查询结果

最后，我们可以通过刚刚创建的表 DimDate 来创建特征和假日之间的关系。

![](img/e75a68c3e7be01ee791b55faee58a62b.png)

多对多表上的最终关系

第一部分“准备”到此结束。总而言之，我们已经加载了数据，创建了维度表，准备了数据，并创建了表之间的关系。现在我们可以开始处理周围的数据了。在本章中，我将尝试从什么、谁和为什么来设计仪表板。下次见。如果您已经完成了本教程，请分享您的仪表板！另外，请在社交媒体上联系我，与我聊聊天。这里是我的 [Instagram](https://www.instagram.com/edwinfachri/) 和 [LinkedIn](https://www.linkedin.com/in/edwin-fachri-wicaksono-5b007a164/) 。