<html>
<head>
<title>Hands on Introducing to Apache Kafka</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">阿帕奇卡夫卡入门</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hands-on-introducing-to-apache-kafka-d93e836e781c?source=collection_archive---------5-----------------------#2021-08-15">https://medium.com/nerd-for-tech/hands-on-introducing-to-apache-kafka-d93e836e781c?source=collection_archive---------5-----------------------#2021-08-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="3976" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">寻找的人找不到，不寻找的人会被找到。</p><p id="b7be" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">福兰兹·卡夫卡</p></blockquote><p id="762f" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">这是一个完全不相关的引用，来自一个德国作家，他的名字也是卡夫卡</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/4308f8eae630cfe87b81c1e9c362eac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8bQVvPlLDCly6-PHeVARrA.png"/></div></div></figure><p id="436e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">在我们开始学习卡夫卡之前，我们首先要理解为什么我们需要一个信息系统</p><h2 id="2ef4" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jh kh ki kj ji kk kl km jj kn ko kp kq bi translated">为什么我们需要一个信息系统？</h2><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kr"><img src="../Images/86096053053fbad36e1855960c29ddeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lh3jT2UkqtKZ95Ik2MPCYw.png"/></div></div></figure><p id="0270" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">让我们考虑上面的图像，其中系统1和系统2是使用数据管道相互通信的两个服务器，我们只希望真实世界的应用程序具有如上的简单设计。</p><p id="aec3" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">实际上，大多数真实世界的应用程序都有</p><ul class=""><li id="902e" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">多个系统相互通信，需要复杂的数据管道</li><li id="1c5d" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">每个数据管道都有自己的规范和要求</li><li id="055e" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">添加/删除数据管道可能会变得复杂</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lg"><img src="../Images/d1f27167a43473227c1d7365b9ae8490.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9uIVAWZq7U6J-OFpvP0n-w.png"/></div></div></figure><h2 id="e513" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jh kh ki kj ji kk kl km jj kn ko kp kq bi translated">消息系统:</h2><ul class=""><li id="c053" class="ks kt hi il b im lh iq li jh lj ji lk jj ll jg kx ky kz la bi translated">它降低了数据管道的复杂性</li><li id="af1a" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">使系统之间的通信更易于管理</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lm"><img src="../Images/87b55d93c19f120f63c23d1dd23d540d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaYPJ9wW5ib1Z_Q_8X4Kaw.png"/></div></div></figure><ul class=""><li id="a7ca" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">它可以提供独立于平台/语言的通信</li><li id="6dbe" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">它提供了一个通用的范例</li><li id="822b" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">可以建立异步通信</li></ul><p id="d686" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">我希望我能够说服你为什么我们需要一个信息系统</p><p id="6fc1" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">接下来，我们将看到卡夫卡的基础知识和它的简单实现</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es ln"><img src="../Images/0c6ff06489c27357dac4d00d396b7766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*m3mqfgkYCHnZXkMd.jpg"/></div></figure><h2 id="9a26" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jh kh ki kj ji kk kl km jj kn ko kp kq bi translated">卡夫卡是什么？</h2><p id="8ada" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">Kafka是一个分布式发布-订阅消息系统。在发布-订阅系统中，消息保存在主题中。消息生产者称为发布者，消息消费者称为订阅者。消费者可以订阅一个或多个主题，并使用该主题中的所有消息</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es lr"><img src="../Images/57d0eeca210f9a4cf6cc58f5e718a50d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoFIBQwIEWkX_Lm2uXh2yQ.png"/></div></div></figure><h2 id="ee15" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jh kh ki kj ji kk kl km jj kn ko kp kq bi translated">卡夫卡的特征:</h2><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ls"><img src="../Images/67c2334a5abd51749670cab01cd2c441.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BY3dw-KlnrR19kLDDx56hg.png"/></div></div></figure><h1 id="4411" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">卡夫卡基础</h1><p id="3649" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">Apache.org表示:</p><ul class=""><li id="a439" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">Kafka作为一个集群在一个或多个服务器上运行。</li><li id="c1a8" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">Kafka集群按称为主题的类别存储记录流。</li><li id="6bb2" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg kx ky kz la bi translated">每个记录由一个键、一个值和一个时间戳组成。</li></ul><h1 id="5b5f" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">主题和日志</h1><p id="062b" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">主题是记录发布到的提要名称或类别。Kafka中的主题总是多订户的——也就是说，一个主题可以有零个、一个或多个消费者来订阅写入其中的数据。对于每个主题，Kafka集群维护一个如下所示的分区日志:</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div class="er es mk"><img src="../Images/6d5c881204cff0448b0875111bdf2120.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/0*C0DNWtMvs56zlxf5.png"/></div></figure><h1 id="4908" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">划分</h1><p id="264c" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">一个主题可能有许多分区，因此它可以处理任意数量的数据。在上图中，主题被配置为三个分区(分区{0，1，2})。分区0有13个偏移量，分区1有10个偏移量，分区2有13个偏移量。</p><h1 id="6d75" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">分区偏移</h1><p id="b25f" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">每个分区消息都有一个唯一的序列ID，称为偏移量。例如，在Partition1中，偏移量标记为从0到9。</p><h1 id="e0a1" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">复制品</h1><p id="c190" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">副本只不过是分区的备份。如果上述主题的复制因子设置为4，那么Kafka将为每个分区创建四个相同的副本，并将它们放在集群中，以使它们可用于其所有操作。副本从不用于读取或写入数据。它们用于防止数据丢失。</p><h1 id="621f" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">经纪人</h1><p id="fee7" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">代理是负责维护发布数据的简单系统。Kafka代理是无状态的，所以它们使用ZooKeeper来维护它们的集群状态。每个代理对于每个主题可以有零个或多个分区。例如，如果一个主题有10个分区和10个代理，那么每个代理将有一个分区。但是，如果有10个分区和15个代理，那么开始的10个代理将各有一个分区，剩下的5个代理将没有该特定主题的任何分区。但是，如果分区是15个，而代理是10个，那么代理将在它们之间共享一个或多个分区，导致代理之间的负载分布不均衡。尽量避免这种情况。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es ml"><img src="../Images/5fbfb8e4604176201482bc0c0da908b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IJ7avslMW2W-6k4kxKEMKQ.png"/></div></div></figure><h1 id="e1a6" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">动物园管理员</h1><p id="f6ce" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">ZooKeeper用于管理和协调Kafka经纪人。ZooKeeper主要用于通知生产者和消费者Kafka系统中任何新代理的存在或Kafka系统中任何代理的失败。ZooKeeper通知生产者和消费者某个代理的存在或失败，生产者和消费者根据这个代理做出决定，并开始与其他代理协调他们的任务。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mm"><img src="../Images/237551ba978314770b8e70942c5ccb0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eH-y6aNNY1DPPHq2te7RvA.png"/></div></div></figure><h1 id="b0ad" class="lt jx hi bd jy lu lv lw kc lx ly lz kg ma mb mc kj md me mf km mg mh mi kp mj bi translated">串</h1><p id="b0a7" class="pw-post-body-paragraph ii ij hi il b im lh io ip iq li is it jh lo iw ix ji lp ja jb jj lq je jf jg hb bi translated">当Kafka有一个以上的经纪人时，它被称为Kafka集群。Kafka集群可以在不停机的情况下进行扩展。这些集群用于管理消息数据的持久性和复制。</p><p id="c86b" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">Kafka有四个核心API:</p><ol class=""><li id="9623" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg mn ky kz la bi translated"><strong class="il hj"> Producer API </strong>允许应用程序向一个或多个Kafka主题发布记录流。</li><li id="1168" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg mn ky kz la bi translated"><strong class="il hj">消费者API </strong>允许应用程序订阅一个或多个主题，并处理产生给它们的记录流。</li><li id="8358" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg mn ky kz la bi translated"><strong class="il hj">流API </strong>允许应用程序充当流处理器，从一个或多个主题消费输入流，并产生一个或多个输出主题的输出流，有效地将输入流转换为输出流。</li><li id="637c" class="ks kt hi il b im lb iq lc jh ld ji le jj lf jg mn ky kz la bi translated"><strong class="il hj">连接器API </strong>允许构建和运行可重用的生产者或消费者，将Kafka主题连接到现有的应用程序或数据系统。例如，关系数据库的连接器可能捕获表的每一次更改。</li></ol><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mo"><img src="../Images/222a1f382ed2ee89552cb61915de6b01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3O5BpnUI8ejq58urixlOiw.png"/></div></div></figure><h2 id="c464" class="jw jx hi bd jy jz ka kb kc kd ke kf kg jh kh ki kj ji kk kl km jj kn ko kp kq bi translated">卡夫卡集群的类型:</h2><ul class=""><li id="fcef" class="ks kt hi il b im lh iq li jh lj ji lk jj ll jg kx ky kz la bi translated">单节点—单代理集群</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mp"><img src="../Images/09d6a34096b4568b4a2cc1d0106c1494.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZtUDG9-vfSqLSLU2Xxiggg.png"/></div></div></figure><ul class=""><li id="2c26" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">单节点—多代理集群</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mq"><img src="../Images/567791ef222a1eda4a8966ff22914578.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6uFRXGqswQxBjL_jOYg9NQ.png"/></div></div></figure><ul class=""><li id="7d9d" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">多节点—多代理集群</li></ul><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es mr"><img src="../Images/3d7d00f6274a6543d34aa1d3a7dc35a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*exnxpGPyf_etz7gON98S-Q.png"/></div></div></figure><p id="1b1e" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated">到目前为止，我们已经讨论了理论概念来熟悉卡夫卡。现在，我们将在设置单个代理集群时使用其中的一些概念。</p><ul class=""><li id="07b7" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">下载并安装Kafka</li></ul><pre class="jl jm jn jo fd ms mt mu mv aw mw bi"><span id="ba66" class="jw jx hi mt b fi mx my l mz na">Download:<br/><br/>```shell<br/>$ wget https://mirrors.estointernet.in/apache/kafka/2.8.0/kafka_2.13-2.8.0.tgz<br/>```</span><span id="c74b" class="jw jx hi mt b fi nb my l mz na">Install:<br/><br/>```<br/>$ tar -xzf kafka_2.13-2.8.0.tgz<br/>$ cd kafka_2.13-2.8.0<br/>```</span></pre><ul class=""><li id="4888" class="ks kt hi il b im in iq ir jh ku ji kv jj kw jg kx ky kz la bi translated">启动动物园管理员</li></ul><pre class="jl jm jn jo fd ms mt mu mv aw mw bi"><span id="140b" class="jw jx hi mt b fi mx my l mz na">QuickStart:<br/><br/>```bash<br/># Start the ZooKeeper service<br/># Note: Soon, ZooKeeper will no longer be required by Apache Kafka.<br/>$ bin/zookeeper-server-start.sh config/zookeeper.properties<br/>```</span><span id="7c70" class="jw jx hi mt b fi nb my l mz na">```shell<br/># Start the Kafka broker service<br/>$ bin/kafka-server-start.sh config/server.properties<br/>```</span><span id="243a" class="jw jx hi mt b fi nb my l mz na">Create topics:<br/><br/>```bash<br/>$ bin/kafka-topics.sh --create --topic events --bootstrap-server localhost:9092<br/>```<br/><br/>```shell<br/>$ bin/kafka-topics.sh --describe --topic events --bootstrap-server localhost:9092<br/>```</span><span id="a06c" class="jw jx hi mt b fi nb my l mz na">Ingest Events:<br/><br/>```shell<br/>$ bin/kafka-console-producer.sh --topic events --bootstrap-server localhost:9092<br/>My first event<br/>My second event<br/>```<br/><br/>Read Events:<br/><br/>```shell<br/>$ bin/kafka-console-consumer.sh --topic events --from-beginning --bootstrap-server localhost:9092<br/>```<br/><br/>Server Props:<br/><br/>```java<br/>export KAFKA_HEAP_OPTS="-Xmx256M -Xms128M"<br/>```<br/><br/>Get offsets:<br/><br/>```shell<br/>$ bin/kafka-run-class.sh kafka.tools.GetOffsetShell --broker-list localhost:9092 --topic events --time -1<br/>```<br/></span><span id="c0ff" class="jw jx hi mt b fi nb my l mz na">Consumer groups:<br/><br/>```shell<br/># List consumers<br/>$ bin/kafka-consumer-groups.sh --list --bootstrap-server localhost:9092<br/>```<br/><br/>Read Events with Consumer Group:<br/><br/>```shell<br/># With config<br/>$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic events --from-beginning --consumer.config config/consumer.properties<br/># With group.id<br/>$ bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic events --from-beginning --group my-cg<br/>```<br/><br/>Describe Topic:<br/><br/>```shell<br/>$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --group my-cg --describe<br/>```<br/><br/>Inflate Partitions:<br/><br/>```shell<br/>$ bin/kafka-topics.sh --topic events --alter --partitions 4 --zookeeper localhost:2181<br/>```<br/><br/>Describe Consumers:<br/><br/>```shell<br/>$ bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group myconsumer --offsets<br/>```</span></pre><p id="9531" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jh iv iw ix ji iz ja jb jj jd je jf jg hb bi translated"><strong class="il hj">这就是所有的人，如果你一直读到这里，那么…..</strong></p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es nc"><img src="../Images/dcf21bddde5fc157c9aac93e9c15ed20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Jf6hf9EonuGzdIN5JeZObQ.gif"/></div></div></figure></div></div>    
</body>
</html>