<html>
<head>
<title>Explain about a Selectivity and Cardinality in oracle|Interview Q&amp;A</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解释 oracle |访谈问答中的选择性和基数</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/explain-about-a-selectivity-and-cardinality-in-oracle-c4417213b6f3?source=collection_archive---------0-----------------------#2021-12-16">https://medium.com/nerd-for-tech/explain-about-a-selectivity-and-cardinality-in-oracle-c4417213b6f3?source=collection_archive---------0-----------------------#2021-12-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="347b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，我们将了解 oracle 中的选择性和基数</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ed010da012da8cfe1258a1ac55648f35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YM4Gxun8GRs6UK25x4Dgjg.png"/></div></div></figure><p id="3772" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是选择性？</strong></p><ul class=""><li id="ee19" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">选择性是基于该表的全部行，从我们的查询中返回的行的估计比例。</li><li id="14d5" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">假设我们有一个包含 9700 条记录的销售表。</li></ul><blockquote class="kd ke kf"><p id="fa62" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> select * from cust_sales 其中 promo _ id = 55</strong></p></blockquote><ul class=""><li id="2fef" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">它返回的行数大约是 8100。所以我们的查询返回了大量的记录。</li></ul><blockquote class="kd ke kf"><p id="ffa2" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj"> select * from cust_sales 其中 promo _ id = 33</strong></p></blockquote><ul class=""><li id="8594" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">它返回 2000 行。</li><li id="aebd" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">所以优化器很可能会为这两个查询选择不同的执行计划。</li><li id="c38a" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">如您所见，即使我们编写相同的语句，查询的选择性也会改变执行计划。</li></ul><blockquote class="kd ke kf"><p id="3cfe" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated">选择性将通过下面的公式计算。<br/> <br/> <strong class="ih hj">选择性=查询返回的行数/总行数</strong></p></blockquote><ul class=""><li id="b5e0" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">从这里我们可以理解，选择性是通过我们期望从查询中返回的行数除以总行数来计算的。</li><li id="d8bb" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">如果选择性为 0，则表示我们的查询是“高选择性”的，这将返回较低的行数；如果选择性为 1，则表示查询是“低选择性”的，这将返回大量的行。</li></ul><p id="362d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是基数？</strong></p><ul class=""><li id="b214" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">基数是我们的查询返回的预期行数。</li></ul><blockquote class="kd ke kf"><p id="af8a" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">基数=总行数*选择性</strong></p></blockquote><ul class=""><li id="aa1d" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">估计器估计我们执行的 I/O 成本。选择性影响分类成本。如果返回的行数太多，那么排序成本就会很高。因此在创建执行计划时会考虑这一点。</li><li id="70ef" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">基数用于确定连接、排序和过滤成本。通过使用基数，优化器决定使用哪种连接方法，它将在使用索引时过滤和减少数据，等等。不正确的选择性和基数=不正确的计划</li><li id="803b" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">有时，优化器无法预测给定操作符将返回的行数(因为缺少表统计信息)。这可能会阻止 Oracle 正确估计查询计划的成本，从而导致选择次优的计划。</li><li id="ca48" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">基数估计错误会导致查询运行缓慢。</li><li id="a695" class="jp jq hi ih b ii jy im jz iq ka iu kb iy kc jc ju jv jw jx bi translated">让我们假设这里有两个例子</li></ul><p id="5b96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例 1: </strong></p><p id="83ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这些有 10 行的表中，您想从 EMP 表中知道最大的 EMP_NO。</p><blockquote class="kd ke kf"><p id="0255" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">从 EMP 中选择 MAX(EMP _ NO)；</strong></p></blockquote><ul class=""><li id="a0cc" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">在上面这些具有选择性和基数细节的查询中</li></ul><blockquote class="kd ke kf"><p id="1e38" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">选择性= 10/10 = 1 </strong></p></blockquote><ul class=""><li id="4ba9" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">根据选择性规则，如果结果接近 1，则是“低选择性”</li></ul><blockquote class="kd ke kf"><p id="e789" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">基数=被访问的行数= 10 </strong></p></blockquote><p id="a7fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">例 2: </strong></p><p id="7775" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在同一个示例中，我在查询中添加了过滤器</p><blockquote class="kd ke kf"><p id="cb1e" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">SELECT MAX(EMP _ NO)from EMP where LAST _ NAME = ' DHONI '；</strong></p></blockquote><ul class=""><li id="1c40" class="jp jq hi ih b ii ij im in iq jr iu js iy jt jc ju jv jw jx bi translated">假设只有 2 名雇员的姓氏是“DHONI”</li></ul><blockquote class="kd ke kf"><p id="980a" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">选择性=被访问的行数/总行数= 2/10 = 0.2 (40%的行被访问)</strong></p><p id="f44e" class="if ig kg ih b ii ij ik il im in io ip kh ir is it ki iv iw ix kj iz ja jb jc hb bi translated"><strong class="ih hj">基数=被访问的行数= 2 </strong></p></blockquote></div></div>    
</body>
</html>