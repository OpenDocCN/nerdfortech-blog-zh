<html>
<head>
<title>Consume JMS Messages with ActiveMQ and SpringBoot In No Time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用ActiveMQ和SpringBoot立即消费JMS消息</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/consume-jms-messages-with-activemq-and-springboot-in-no-time-41cf413eac3a?source=collection_archive---------2-----------------------#2020-06-30">https://medium.com/nerd-for-tech/consume-jms-messages-with-activemq-and-springboot-in-no-time-41cf413eac3a?source=collection_archive---------2-----------------------#2020-06-30</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3925" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我希望你很清楚什么是ActiveMQ和SpringBoot，那么这篇文章可能对你有用。我想在一个spring boot应用程序中使用一些ActiveMQ消息，但是我从来没有想到会这么容易。正如你可能已经体验过的，spring boot有一些黑魔法(是的，它有它的理由，我们可以破解它)。既然它是神奇的，我们应该正确地了解它，以便在更短的时间内启动和运行。所以根据我的经验，这是食谱。注意，我不会把它和Artemis(ActiveMQ的后继者)混为一谈。</p><h1 id="8d71" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">项目设置</h1><p id="c722" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">前往https://start.spring.io/的<a class="ae kg" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank"/>。选择您的构建风格和运行时设置。然后添加ActiveMQ5和Web依赖项，如果你想跟着做<a class="ae kg" href="https://start.spring.io/#!type=maven-project&amp;language=java&amp;platformVersion=2.3.1.RELEASE&amp;packaging=jar&amp;jvmVersion=1.8&amp;groupId=com.aptkode&amp;artifactId=spring-boot-activemq-demo&amp;name=spring-boot-activemq-demo&amp;description=Demo%20project%20for%20Spring%20Boot%20and%20ActiveMQ&amp;packageName=com.aptkode.&amp;dependencies=web,activemq" rel="noopener ugc nofollow" target="_blank">抓住我的</a>。</p><h1 id="aa97" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">我们需要的豆子</h1><p id="e75c" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们需要提供一个名为<strong class="ih hj"> MessageListenerContainer </strong>的接口来实现spring boot。不要担心，spring-jms构件中有一个默认的实现。但是我们需要配置它(目的地、qos、主题/队列等)。不是直接创建<code class="du kh ki kj kk b">MessageListnerContainer</code>，我们必须用特定的配置创建<strong class="ih hj">JMS listenercontainerfactory</strong>的实现。此外，对于这个接口，它有默认的实现，我们可以使用没有任何麻烦。这是我们唯一需要启动并运行的bean。下面是最终的引导应用程序类的样子。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="ff7c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">看看我用来创建容器工厂的方法。参数配置器负责该容器工厂的自动布线。</p><p id="3802" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这个设置和第一次运行之后，我对日志感到有点惊讶。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ks"><img src="../Images/b526b0743d75e333d54b660ce702f210.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCEWEMS8ZnQmGERChegKYA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">嵌入式ActiveMQ代理日志</figcaption></figure><p id="9114" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">是因为我没有在application.properties(你的情况下可能是yml)文件中添加<code class="du kh ki kj kk b">spring.activemq.broker-url</code>属性。一旦我添加了属性，日志就消失了，这意味着没有嵌入式代理。</p><h1 id="4f10" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">消费话题</h1><p id="3657" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">虽然我之前没有提到，但在<code class="du kh ki kj kk b">jmsTopicContainerFactory</code>方法中，我设置了<code class="du kh ki kj kk b">factory.setPubSubDomain(true);</code>，它让容器消费主题。如果你想听队列，就避开这个。</p><p id="947e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们来看看<code class="du kh ki kj kk b">receiveMessage</code>方法。它用<code class="du kh ki kj kk b">@JmsListner</code>注释进行了注释，并使该方法被发送到destination属性中指定的主题的消息触发。还要注意，containerFactory属性值应该是containerFactory bean名称(这里是方法名称)。</p><p id="b5bd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在获取您的ActiveMQ代理url，并将其添加到application.properties中。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="afae" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置并启动应用程序后，它将显示在activemq broker ui的connections选项卡中，如下所示(默认情况下，webui在activemq主机上的端口8161上运行，默认用户名/密码是admin/admin)。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ld"><img src="../Images/9e760126189b53507f1d2b6a60bfef7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Eg5ahYRob8kEZB3LRyK9wQ.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">openwire协议连接到spring boot应用程序</figcaption></figure><p id="eb12" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里我用的是openwire协议，如果你用的是不同的协议，设置会有很大的不同。我创建了一个名为<code class="du kh ki kj kk b">aptkode</code>的主题，并通过web ui发送了一条消息。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es le"><img src="../Images/326554b878fbcb400b442a28079e6356.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zJbn4Rko7HOOgfhPJ_E35Q.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">ActiveMQ Broker Web UI发送JMS消息</figcaption></figure><p id="471e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这是应用程序日志。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lf"><img src="../Images/bede1776070b803627ca0da1156597a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0G3uFpObhcRSd4_zFgnvhA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx translated">应用程序日志中的jms消息</figcaption></figure><p id="a4d9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着文本类型的消息转换器正在开箱即用。</p><h1 id="296a" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将JSON消息作为类型使用</h1><p id="1334" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">有一个名为<code class="du kh ki kj kk b">MappingJackson2MessageConverter</code>的类，在包括官方教程在内的大多数教程中都有使用。但是我花了很长时间才弄明白它是如何工作的。如果你在spring中使用<code class="du kh ki kj kk b">JmsTemplate</code>并使用它发送消息，那么使用上面提到的类并让它工作会很容易。但在我的情况下，它是由一个我无法控制的不同应用程序发送的。所以下面的方法工作得很好。</p><p id="09c2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先我们需要实现<code class="du kh ki kj kk b">MessageConverter</code>类。因为我正在读取消息，所以我不打算实现<code class="du kh ki kj kk b">toMessage</code>方法。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="cd97" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">剩下的唯一一件事就是将<code class="du kh ki kj kk b">@JmsListener</code>注释方法的类型改为<code class="du kh ki kj kk b">Student</code>或任何你想要的类。</p><figure class="kl km kn ko fd kp"><div class="bz dy l di"><div class="kq kr l"/></div></figure><p id="1000" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">试一试，它开始工作了。</p><figure class="kl km kn ko fd kp er es paragraph-image"><div class="er es lg"><img src="../Images/8dd0e366a764ddbcbfa98a9a42aa5f08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1382/format:webp/1*PLeBu4baUkHxSLtxAZmvqQ.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx translated">已将邮件转换为pojo</figcaption></figure><p id="7191" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">但是请注意，您不能添加新的转换器并期望它转换另一种类型。如果你想转换多种类型，你必须配置工厂。它将产生新的<code class="du kh ki kj kk b">MessageListnerContainer</code>，并使用<code class="du kh ki kj kk b">factory.setMessageConverter(MessageConverter converter);</code>方法中已配置的转换器进行转换。</p><p id="456e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">就这样，我们很快就消费了ActiveMQ消息。感谢阅读。</p></div></div>    
</body>
</html>