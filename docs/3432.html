<html>
<head>
<title>Build a URL Shortener With Node.js, MongoDB And Vue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Node.js，MongoDB 和 Vue.js 构建一个 URL Shortener</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/build-a-url-shortener-with-node-js-mongodb-and-vue-js-8ee4af47ca0d?source=collection_archive---------3-----------------------#2021-06-10">https://medium.com/nerd-for-tech/build-a-url-shortener-with-node-js-mongodb-and-vue-js-8ee4af47ca0d?source=collection_archive---------3-----------------------#2021-06-10</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/></div><div class="ab cl if ig gp ih" role="separator"><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik il"/><span class="ii bw bk ij ik"/></div><div class="hb hc hd he hf"><figure class="in io ip iq fd ir er es paragraph-image"><div role="button" tabindex="0" class="is it di iu bf iv"><div class="er es im"><img src="../Images/6b7f8c0af39c97862bebfe69ebf93382.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbsAtVoxKLXSAqbJWFyDvg.png"/></div></div></figure><p id="0bf2" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">你可能以前用过网址缩写，比如<a class="ae jw" href="https://www.shorturl.at/" rel="noopener ugc nofollow" target="_blank"> shorturl </a>或者<a class="ae jw" href="https://bitly.com/" rel="noopener ugc nofollow" target="_blank"> bitly </a>。它们有助于将长的(难看的)网址缩短为短的(更吸引人的)链接，你可以很容易地与你的朋友、家人或同事分享。一个 URL 缩短器可以用不同的框架来构建。很难选择一个 JavaScript 框架——因为有太多这样的框架，而且它们之间的差异并不明显。在为一个项目选择框架时，我关注的是生产率("<em class="jx">我能以多快的速度完成任务("</em>")和性能("<em class="jx">我的 web 应用程序能以多快的速度完成任务("T10)，它们对我来说是最重要的标准。<br/> <br/>因此对于这个项目，我们将在前端使用 Vue.js 框架，在后端使用 Node.js 和 MongoDB 数据库。</em></p><h1 id="330b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">为什么我们需要一个网址缩写</h1><ol class=""><li id="aea7" class="kw kx hi ja b jb ky jf kz jj la jn lb jr lc jv ld le lf lg bi translated">有时，社交平台、位置等的链接变得如此之大，以至于很难管理它们。</li><li id="1417" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">较短的链接占用较少的空间，更容易共享和输入。</li><li id="a955" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">大多数网址缩写提供的功能可以让你追踪你的网址被点击的次数。</li></ol><p id="7d23" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">为了理解这是如何工作的，我们需要更仔细地看看 URL 缩短器——所以我们将构建一个简单的 URL 缩短器！在本文中，我们将使用 Node.js、MongoDB 和 Vue.js 构建一个简单的 URL 缩短器。</p><h1 id="d4d3" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">使用的技术</h1><p id="00b9" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">如前所述，我们将在前端使用 Vue.js 框架，在后端和 MongoDB 数据库上使用 Node.js。</p><h1 id="0e62" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">为什么要用 Vue.js</h1><p id="9ae6" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">我之所以选择 Vue.js 而不是这个项目的其他选项，是因为它:</p><ol class=""><li id="cd83" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">学习容易:Vue 的学习曲线相对容易，你只需要有开发 web 应用的 HTML 或 JavaScript 的基础知识。不像 React 或 Angular 等其他框架需要了解 JSX 和 typescript。</li><li id="73a5" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">易于理解的文档:Vue.js 框架<a class="ae jw" href="https://v3.vuejs.org/guide/introduction.html#what-is-vue-js" rel="noopener ugc nofollow" target="_blank">文档</a>定义良好，结构清晰，这使得开发人员编写和执行他们的应用程序更加简单。</li><li id="8a8a" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">更高的性能:与其他框架相比，这些框架提供了更好的性能，比如 React。</li><li id="08f6" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">简单易懂:简单是 Vue DNA 的一部分，我选择用 Vue 做这个项目的原因之一是因为它简单易懂，结构简单。</li><li id="5784" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">微小的尺寸:Vue.js 可以重约 20 KB 或更少，用户下载和使用它不需要时间。它击败了所有笨重的框架，如 React.js、Angular.js 和 Ember.js。</li></ol><p id="b466" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">Vue.js 与其他框架的经典对比可以在这里看到<a class="ae jw" href="http://A classic comparison of Vue.js" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="dc40" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">为什么对后端和 MongoDB 数据库使用 Node.js</h1><p id="0372" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">我选择 Node.js 作为后端和 MongoDB 数据库有几个原因。尽管 Node.js 与 MySQL 数据库配合得很好，但完美的组合是像 MongoDB 这样的 NoSQL，其中的模式不需要结构良好。<br/>我选择 Node.js 作为这个项目的后端是出于以下原因:</p><ol class=""><li id="38d1" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">一个代码库:通过为这个项目使用<a class="ae jw" href="https://nodejs.dev/" rel="noopener ugc nofollow" target="_blank"> Node.js </a>，我在这个应用程序的前端和后端使用相同的语言 javascript。这比使用不同的语言(如 Laravel 或 Python)更容易维护。</li><li id="a864" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">可重用代码:使用 Node.js 作为我的后端技术，在这个项目的前端和后端部分之间共享和重用代码更容易，这加快了开发过程。</li><li id="2ec2" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">它的 Javascript:使用 Node.js，我只需要理解后端背后的方法论，而不是一门全新的语言。</li><li id="a69a" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">它快如闪电<strong class="ja hj"> : </strong> Node.js 主要是一个由 V8 支持的<a class="ae jw" href="https://nodejs.dev/learn" rel="noopener ugc nofollow" target="_blank"> JavaScript 运行时，由谷歌开发用于 Chrome。这使得 Node.js 具有很高的性能。因此，对文件系统、网络连接和数据库的读/写在 Node 中执行得非常快。</a></li><li id="15fa" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">广泛的托管选项:使用 Node.js 时有更广泛的托管选项，我们可以用它来托管 URL shortener。</li></ol><h1 id="7f6c" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">先决条件</h1><p id="4035" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">以下是我们将在此项目中使用的先决条件和工具:</p><ul class=""><li id="61a4" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ls le lf lg bi translated">Vue.js(此处下载<a class="ae jw" href="https://vuejs.org/" rel="noopener ugc nofollow" target="_blank">或安装<code class="du lt lu lv lw b">npm install -g @vue/cli)</code></a></li><li id="aeb2" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><a class="ae jw" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS 代码</a>(此处下载<a class="ae jw" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"/>)</li><li id="660f" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">节点(此处下载<a class="ae jw" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"/>)</li><li id="229a" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">MongoDB(此处下载<a class="ae jw" href="https://docs.mongodb.com/manual/installation/" rel="noopener ugc nofollow" target="_blank"/>)</li></ul><p id="43bb" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">一旦你有一切，我们可以开始我们的项目！</p><h1 id="f3a5" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建项目</h1><p id="ae80" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">首先，我们将创建一个名为<strong class="ja hj"> server 的目录。</strong> <br/>在你的终端键入以下内容:</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="dae8" class="mb jz hi lw b fi mc md l me mf">mkdir server &amp;&amp; cd server<br/>npm init</span></pre><p id="e9de" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">第一个命令将创建我们的目录并移入其中，第二个命令初始化一个接受默认值的<strong class="ja hj"> package.json </strong>。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="8cfd" class="mb jz hi lw b fi mc md l me mf">{<br/> "name": "server",<br/> "version": "1.0.0",<br/> "main": "index.js",<br/> "license": "MIT"<br/>}</span></pre><p id="a6de" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们还需要安装一些依赖项。</p><ul class=""><li id="b405" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ls le lf lg bi translated">Axios→进行 API 调用；</li><li id="5820" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">mongose→连接我们的 MongoDB 数据库</li><li id="e86e" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">Shortid →创建短的唯一字符串，我们需要</li><li id="6ecd" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">Validate.js →验证收到的 URL</li><li id="84bd" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">Dotenv →加载环境变量</li><li id="92b6" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">CORS →允许从我们的客户端应用程序和 express 访问</li><li id="9430" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">快速→后端 web 框架</li></ul><p id="6ccf" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">安装下列依赖项。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="0286" class="mb jz hi lw b fi mc md l me mf">npm install axios --save </span><span id="709e" class="mb jz hi lw b fi mg md l me mf">npm install mongoose --save </span><span id="0978" class="mb jz hi lw b fi mg md l me mf">npm install shortid --save </span><span id="18cb" class="mb jz hi lw b fi mg md l me mf">npm install validate.js --save  </span><span id="0cd9" class="mb jz hi lw b fi mg md l me mf">npm install dotenv --save </span><span id="91d6" class="mb jz hi lw b fi mg md l me mf">npm install express --save</span><span id="c822" class="mb jz hi lw b fi mg md l me mf">npm install cors --save</span></pre><h1 id="df58" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置 Express</h1><ol class=""><li id="989f" class="kw kx hi ja b jb ky jf kz jj la jn lb jr lc jv ld le lf lg bi translated">在你最喜欢的编辑器上创建一个这样的文件夹结构(我的是 VS 代码)。</li><li id="5d2b" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ld le lf lg bi translated">为了设置我们的服务器，我们将首先向我们的<strong class="ja hj">添加一些环境变量。env </strong>文件。复制并粘贴下列内容。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="ff88" class="mb jz hi lw b fi mc md l me mf">port = 5050<br/>host = localhost</span></pre><p id="9af6" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们可以使用<code class="du lt lu lv lw b">process.env.</code> <strong class="ja hj"> variable_name </strong>在整个应用程序中访问这些变量。</p><ol class=""><li id="57f7" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">接下来，我们将设置我们的 express server open<strong class="ja hj">index . js</strong>并粘贴以下内容。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="abee" class="mb jz hi lw b fi mc md l me mf">const express = require('express');<br/>const app = express();<br/>const cors = require('cors');<br/>require('dotenv').config()<br/>const port = process.env.port;<br/>const host = process.env.host;<br/>const bodyParser = require("body-parser"); //use to parse incoming request bodies</span><span id="2eb6" class="mb jz hi lw b fi mg md l me mf">const services = require("./routes/service");<br/>const db = require("./data/db");<br/>const urlDb = require("./data/url");</span><span id="081b" class="mb jz hi lw b fi mg md l me mf">const corsOptions = {<br/>  origin: 'http://localhost:8080',<br/>  optionsSuccessStatus: 200<br/>}</span><span id="4fa1" class="mb jz hi lw b fi mg md l me mf">app.use(cors(corsOptions))<br/>app.use(bodyParser.urlencoded({ extended: true }));<br/>app.use(bodyParser.json());</span><span id="349d" class="mb jz hi lw b fi mg md l me mf">app.listen(port, () =&gt; console.log("listening port " + port));</span></pre><p id="464d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">此时，我们正在设置我们的基本服务器，并需要我们之前安装的所需的软件包和文件，例如:</p><ul class=""><li id="6828" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ls le lf lg bi translated"><strong class="ja hj"> dotenv → </strong>允许节点读入环境变量</li><li id="1b4e" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><strong class="ja hj"> body-parser → </strong>用于解析传入服务器的请求体</li><li id="bbee" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><strong class="ja hj">服务→ </strong>将包含一些处理 URL 的逻辑(比如验证)</li><li id="25e8" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><strong class="ja hj"> db → </strong>我们的数据库</li><li id="095e" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><strong class="ja hj"> urlDb → </strong>包含了我们存储和检索 URL 的函数</li><li id="4d27" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated"><strong class="ja hj"> cors → </strong>用于允许其他域(例如我们的前端)向我们的 API 发出请求</li></ul><p id="692d" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated"><strong class="ja hj"> corsOptions </strong>变量中的<code class="du lt lu lv lw b">origin: 'http://localhost:8080'</code>告诉我们的应用程序只接受来自该域的请求，该域将是我们的客户端。Vue.js 默认端口是 8080，我们的服务器被设置为监听我们的<strong class="ja hj">中指定的端口。env </strong>文件。</p><h1 id="6850" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置 MongoDB</h1><p id="a138" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">我假设 MongoDB 已经安装在您的本地机器上。使用以下命令检查 MongoDB 是否正在运行。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="a466" class="mb jz hi lw b fi mc md l me mf">mongod</span></pre><p id="c70e" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">如果 MongoDB 正确安装在您的机器上，它将启动您的<code class="du lt lu lv lw b">mongod server</code>。<br/> <br/>现在我们用 Mongoose 把 express app 和 MongoDB 连接起来。</p><ol class=""><li id="0b25" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">打开<strong class="ja hj"> db.js </strong>并粘贴以下内容。我们将把我们的 MongoDB 连接设置到一个名为<strong class="ja hj"> Url-Shortner 的本地数据库。</strong></li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="6bb7" class="mb jz hi lw b fi mc md l me mf">const mongoose = require("mongoose");<br/>mongoose.connect("mongodb://localhost/Url-Shortener", {<br/>  useNewUrlParser: true,<br/>  useUnifiedTopology: true<br/>});<br/>mongoose.set('useCreateIndex', true)</span></pre><p id="075c" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">2.接下来，我们为我们的 URL 创建一个模型。打开<strong class="ja hj"> url.js </strong>，粘贴以下内容。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="fc8e" class="mb jz hi lw b fi mc md l me mf">const mongoose = require("mongoose");<br/>const urlSchema = new mongoose.Schema({<br/>    longURL: {<br/>        type: String,<br/>        required: true<br/>    },<br/>    shortURL: {<br/>        type: String,<br/>        required: true,<br/>    },<br/>    shortUrlId: {<br/>        type: String,<br/>        required: true,<br/>        unique: true<br/>    }<br/>});</span><span id="d6f6" class="mb jz hi lw b fi mg md l me mf">module.exports = mongoose.model("URL", urlSchema);</span></pre><ol class=""><li id="00ba" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">接下来，我们将在我们的<strong class="ja hj"> dbUrl.js </strong>文件中添加保存和查找 URL 的逻辑。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="6748" class="mb jz hi lw b fi mc md l me mf">const Url = require("../models/Url");</span><span id="81d9" class="mb jz hi lw b fi mg md l me mf">const save = (longURL, shortURL, shortUrlId) =&gt; {<br/>    Url.create({ longURL, shortURL, shortUrlId })<br/>};</span><span id="d787" class="mb jz hi lw b fi mg md l me mf">const find = (shortUrlId) =&gt; Url.findOne({ shortUrlId: shortUrlId });</span><span id="f739" class="mb jz hi lw b fi mg md l me mf">module.exports = {<br/>    save,<br/>    find<br/>};</span></pre><h1 id="83aa" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">创建端点</h1><p id="d4fb" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">在这个阶段，我们将创建一个端点，该端点接受一个 URL，将它与缩短版本一起存储，并将缩短版本返回给用户。将以下内容添加到您的<strong class="ja hj"> index.js. </strong></p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="d531" class="mb jz hi lw b fi mc md l me mf">app.post("/url", async (req, res) =&gt; {<br/>    try {<br/>        if (!!services.validateUrl(req.body.url))<br/>            return res.status(400).send({ msg: "Invalid URL." });</span><span id="795e" class="mb jz hi lw b fi mg md l me mf">        const urlKey = services.generateUrlKey();<br/>        const shortUrl = `http://${host}:${port}/${urlKey}`</span><span id="7346" class="mb jz hi lw b fi mg md l me mf">        await urlDb.save(req.body.url, shortUrl, urlKey)<br/>        return res.status(200).send({ shortUrl });</span><span id="7553" class="mb jz hi lw b fi mg md l me mf">    } catch (error) {<br/>        return res.status(500).send({ msg: "Error. Please try again." });<br/>    }<br/>    app.get("/:shortUrlId", async (req, res) =&gt; {<br/>    try {<br/>        const url = await urlDb.find(req.params.shortUrlId);<br/>        return !url ? res.status(404).send("Not found") : res.redirect(301, url.longURL)</span><span id="cad6" class="mb jz hi lw b fi mg md l me mf">    } catch (error) {<br/>        return res.status(500).send("Error. Please try again.")<br/>    }<br/>}); <br/>});</span></pre><p id="58c7" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">现在正在进行许多工作，下面是这些步骤的细目分类:</p><ul class=""><li id="5e71" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ls le lf lg bi translated">这里，我们接收一个 URL 作为请求体的一部分，然后使用<strong class="ja hj"> service.js </strong>中的<strong class="ja hj"> validateUrl() </strong>函数对其进行验证。</li><li id="508a" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">我们还使用<strong class="ja hj"> generateUrlKey() </strong>函数为给定的 URL 生成一个 URL ID ( <strong class="ja hj"> shortUrlId </strong>)。</li><li id="3ff7" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">然后，我们使用我们的服务器主机名和<strong class="ja hj"> shortUrlId </strong>为 URL 创建一个短链接。</li><li id="7be9" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">然后，我们将 URL、短链接和<strong class="ja hj"> shortUrlId </strong>保存到数据库中。然后我们返回这个短链接。如果有错误，我们返回一个适当的错误消息。</li><li id="3350" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">接下来，我们创建一个端点，它接受一个<strong class="ja hj"> shortUrlId </strong>，在我们的数据库中找到<strong class="ja hj"> shortUrlId </strong>，并将浏览器重定向到与之相关联的长 URL。</li></ul><h1 id="c2b1" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">路线</h1><p id="1ac2" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">我们在<strong class="ja hj"> validateUrl() </strong>和<strong class="ja hj"> generateUrlKey() </strong>上面使用了两个还没有创建的函数。我们将在<strong class="ja hj"> services.js. </strong>中创建这些函数，将以下内容复制并粘贴到<strong class="ja hj"> services.js </strong>中。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="a888" class="mb jz hi lw b fi mc md l me mf">const validate = require("validate.js");<br/>const shortId = require("shortid");</span><span id="aa6a" class="mb jz hi lw b fi mg md l me mf">const validateUrl = (url = "") =&gt; {<br/>    return validate({ website: url }, {<br/>        website: {<br/>            url: {<br/>                allowLocal: true<br/>            }<br/>        }<br/>    });<br/>}</span><span id="d451" class="mb jz hi lw b fi mg md l me mf">const generateUrlKey = () =&gt; shortId.generate();</span><span id="d707" class="mb jz hi lw b fi mg md l me mf">module.exports = { validateUrl, generateUrlKey: generateUrlKey };</span></pre><p id="2015" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们的服务器现在准备好了。我们可以通过在终端上运行<code class="du lt lu lv lw b">node app.js</code>来启动您的服务器来进行测试。可以按<code class="du lt lu lv lw b">Ctrl+C</code>停止服务器。或者，你可以使用<a class="ae jw" href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en" rel="noopener ugc nofollow" target="_blank">邮递员</a>进行测试</p><h1 id="a16b" class="jy jz hi bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">开始前端</h1><p id="5411" class="pw-post-body-paragraph iy iz hi ja b jb ky jd je jf kz jh ji jj lm jl jm jn ln jp jq jr lo jt ju jv hb bi translated">我们现在开始创建应用程序的前端/客户端。我假设 Vue.js 已经安装在您的本地机器上。如果没有，您可以通过在终端上运行以下命令来安装 Vue.js。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="8536" class="mb jz hi lw b fi mc md l me mf">npm install -g @vue/cli</span></pre><p id="68a0" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">运行以下命令创建一个 vue 应用程序。</p><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="f980" class="mb jz hi lw b fi mc md l me mf">vue create client</span></pre><p id="f3e2" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">如果您愿意，您可以选择<strong class="ja hj">默认</strong>预设或<strong class="ja hj">手动</strong>功能选择。接下来，在你最喜欢的代码编辑器中打开客户端文件夹。删除<strong class="ja hj"> App 的内容。Vue </strong>并删除组件文件夹中的<strong class="ja hj"> HelloWorld.vue </strong>文件。<br/> <br/>我们将使用下面的文件夹结构。</p><ol class=""><li id="2c40" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">我们将使用 bootstrap 进行造型。在<strong class="ja hj">index.html</strong>文件的公共文件夹中，在开始和结束<code class="du lt lu lv lw b">&lt;head&gt;</code>标签之间添加以下链接。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="18c2" class="mb jz hi lw b fi mc md l me mf">&lt;link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous"&gt;</span></pre><ol class=""><li id="b8fc" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">我们将添加一个简单的导航条，并导入到<strong class="ja hj"> Home.vue </strong>组件中，并在我们的<code class="du lt lu lv lw b">container div.</code>中渲染它，复制并粘贴以下内容到<strong class="ja hj"> App.vue. </strong></li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="fca4" class="mb jz hi lw b fi mc md l me mf">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;nav class="navbar navbar-dark bg-dark"&gt;<br/>      &lt;a class="navbar-brand" href="#"&gt;Shortly&gt;&lt;/a&gt;<br/>    &lt;/nav&gt;<br/>    &lt;div class="container"&gt;<br/>     &lt;home /&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span><span id="1ec7" class="mb jz hi lw b fi mg md l me mf">&lt;script&gt;<br/>import Home from "./components/Home.vue";<br/>export default {<br/>  name: "App",<br/>  components: {<br/>    Home,<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><p id="cbff" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">在终端运行命令<code class="du lt lu lv lw b">npm run serve</code>来启动你的 vue 应用。Vue 使用热重新加载，所以你只需要运行这个命令一次，每次你做了更改并保存后，你的应用就会<strong class="ja hj">更新</strong>。您应该会看到与此类似的输出:</p><p id="5301" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">然后，访问<strong class="ja hj">本地</strong>链接查看您的应用。您应该会看到一个带有简单导航条的屏幕。</p><ol class=""><li id="1d10" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">组件将包含用户将与之交互的表单以及我们的应用程序逻辑。让我们给它一个简单的设计。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="ff83" class="mb jz hi lw b fi mc md l me mf">&lt;template&gt;<br/>  &lt;div&gt;<br/>    &lt;div class="row"&gt;<br/>     &lt;div class="col col-12 offset-0 mt-2"&gt;<br/>        &lt;h1 class="jumbotron text-center text-white bg-primary"&gt;Create Click-Worthy Links&lt;/h1&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;</span><span id="e697" class="mb jz hi lw b fi mg md l me mf">    &lt;div class="col col-8 align-middle mt-5 offset-2"&gt;<br/>      &lt;div class="card"&gt;<br/>        &lt;div class="card-body"&gt;<br/>          &lt;form @submit.prevent="submit(url)"&gt;<br/>            &lt;div class="form-group"&gt;<br/>              &lt;label for="url"&gt;Enter Url&lt;/label&gt;<br/>              &lt;textarea type="url" class="form-control" v-model="url" style="height:150px" /&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="for-group" v-show="shortUrl"&gt;<br/>              &lt;p&gt;<br/>                Short URL: :<br/>                &lt;a :href="shortUrl" class="text-primary"&gt;{{shortUrl}}&lt;/a&gt;<br/>              &lt;/p&gt;<br/>            &lt;/div&gt;<br/>            &lt;div class="form-group"&gt;<br/>              &lt;button class="btn btn-primary" type="submit"&gt;Shorten URl&lt;/button&gt;<br/>            &lt;/div&gt;<br/>          &lt;/form&gt;<br/>        &lt;/div&gt;<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/template&gt;</span></pre><p id="5fd3" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">我们在这里创建了一个简单的设计。注意在我们的标签上使用 Vue 的<strong class="ja hj"> v-model </strong>进行双向数据绑定。这将自动将用户输入存储在数据属性调用<strong class="ja hj"> url </strong>中。</p><ol class=""><li id="eb2e" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ld le lf lg bi translated">现在，我们将添加逻辑，向我们的服务器提交一个 URL，并接收一个缩短的 URL，我们还将使用 axios 进行 API 调用。</li></ol><pre class="in io ip iq fd lx lw ly lz aw ma bi"><span id="f2cf" class="mb jz hi lw b fi mc md l me mf">&lt;script&gt;<br/>import axios from "axios";<br/>export default {<br/>  data: () =&gt; {<br/>    return {<br/>      url: "",<br/>      shortUrl: "",<br/>    };<br/>  },<br/>  methods: {<br/>    submit: async function (url) {<br/>      try {<br/>        const api = "http://localhost:5050/url";<br/>        const response = await axios.post(api, {<br/>          url,<br/>        });<br/>        this.shortUrl = response.data.shortUrl;<br/>      } catch (error) {<br/>        console.log(error);<br/>      }<br/>    },<br/>  },<br/>};<br/>&lt;/script&gt;</span></pre><ul class=""><li id="c23d" class="kw kx hi ja b jb jc jf jg jj lp jn lq jr lr jv ls le lf lg bi translated">当用户提交一个 URL 时，方法<strong class="ja hj"> submit </strong>被调用。我们使用 Axios 向服务器发出请求。</li><li id="39a0" class="kw kx hi ja b jb lh jf li jj lj jn lk jr ll jv ls le lf lg bi translated">我们用从服务器返回的 Url 更新<strong class="ja hj"> shortUrl </strong>数据属性。对于错误，我们将它们记录到控制台。</li></ul><p id="0067" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">客户端应用程序完成后，我们现在可以全面测试我们的 URL shortener 应用程序了。我们需要我们的服务器和客户端应用程序都在运行。如果您的服务器不再运行，为您的服务器目录打开另一个终端并运行<code class="du lt lu lv lw b">node app.js</code>。<br/>您的浏览器中会有以下内容。</p><p id="81de" class="pw-post-body-paragraph iy iz hi ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hb bi translated">选择一个长 URL，通过表单提交，然后单击返回给您的 URL。您应该被重定向到原始站点。<br/> <br/>冤家路窄！您已经使用 javascript 构建了自己的简单 URL 缩短器。<br/> <br/> <em class="jx">如果你喜欢读这篇文章，别忘了分享。👏</em></p></div></div>    
</body>
</html>