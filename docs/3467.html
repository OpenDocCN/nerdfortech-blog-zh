<html>
<head>
<title>Proxy Microservice Design Pattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代理微服务设计模式</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/proxy-microservice-design-pattern-91d455b0d05a?source=collection_archive---------2-----------------------#2021-06-11">https://medium.com/nerd-for-tech/proxy-microservice-design-pattern-91d455b0d05a?source=collection_archive---------2-----------------------#2021-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8998" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">微服务设计模式(<strong class="ih hj">第3部分</strong>)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/48ace29abd73cd92f70afef803d6afb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8oJOBqcywxHUhTZCP4RBLw.jpeg"/></div></div></figure><p id="0324" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代理微服务设计模式与聚合器略有相似。但是根据代理设计模式，我们不需要消费者上的聚合器，而是创建一个微服务来基于业务需求调用其他服务。让我们通过下面的例子来理解代理模式。</p><p id="3fea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">举例:</strong></p><p id="588b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">️Assume您的公司目前有一个单一的应用程序。所以现在你需要转向微服务架构。因此，当您部署微服务时，可能需要改变服务。</p><p id="0873" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️考虑一下，你有一个微服务来获取员工的休假信息。因此，消费者需要通过empCode来获取休假信息。(图1)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jp"><img src="../Images/4f54658504da95b5d0691f651641788d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*imkGv40cp_RGgY9RI2UTIQ.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图1</figcaption></figure><p id="498f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️:但是在新的重组中，你决定保留empID作为所有记录的关系键。</p><p id="2bd6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️:现在你部署了新的重组员工服务(新版本)。但不幸的是，已经在消费你之前的员工服务的消费者将<strong class="ih hj">打破</strong>。😭</p><h2 id="189e" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">为什么？🧐</h2><p id="8ad9" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">▪️，因为那些消费者会通过“empCode”。但是新版本的服务需要empID。所以在那个时候，你把当前的服务更新到新的版本，你的消费者就会崩溃。</p><p id="02ba" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">🟡 <strong class="ih hj">作为一个解决方案，我们可以在这里使用代理设计模式。</strong></p><p id="f13a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️你可以通过创建一个单独的代理服务来解决这个问题，如下所示。(图2)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/9fcd85abd7dad781c204f383cdda86b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbnQ0bDEWzxQXV-ZqbgYIw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图2</figcaption></figure><p id="6769" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️相应地，消费者将调用代理服务。您可以将其修改为(图3):</p><blockquote class="kv kw kx"><p id="1056" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">如果消费者通过empID </em> <strong class="ih hj"> <em class="hi">调用版本2(新版本)</em> </strong></p><p id="2fc1" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><em class="hi">如果消费者通过empCode </em> <strong class="ih hj"> <em class="hi">调用版本1(旧版本)</em> </strong></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ku"><img src="../Images/f5a64963dee03814cd54589ace1c053f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LsyQhvMzHl0x8bTZASh7xQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">图3</figcaption></figure><p id="09a2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✹:这样，你就可以独立地部署服务，而不会影响消费者。当没有流量，schema 1没有收到来自消费者的请求时，您可以停止服务1，保留服务2(新版本)。在这里，语义版本控制非常重要。</p><p id="fe17" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✹然而，当谈到代理设计模式时，我们还必须考虑其他重要的事情。🡻</p><h2 id="883f" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">✨版本控制</h2><blockquote class="kv kw kx"><p id="e28f" class="if ig ky ih b ii ij ik il im in io ip kz ir is it la iv iw ix lb iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="hi">语义版本化</em> </strong></p></blockquote><p id="21cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">语义版本控制通过三个非负整数将每个版本显示为“<strong class="ih hj"> <em class="ky"> MAJOR”。MINOR.PATCH </em> </strong>”(如图4)而这些整数每一个都有自己的含义。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/c0c2cda7f11c4a09e466a7200eddc932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1048/format:webp/1*nA_oqbLDL1K-4hJSJtSmNA.png"/></div></figure><p id="0dcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">▪️我在我的“<a class="ae ld" rel="noopener" href="/geekculture/best-practices-for-microservices-microservices-part-2-a8646f3e1753"> <strong class="ih hj">微服务最佳实践</strong> </a>”博客中讨论了版本控制。更多详情请参考。(点击下面的链接)</p><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/geekculture/best-practices-for-microservices-microservices-part-2-a8646f3e1753"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hj fi z dy lm ea eb ln ed ef hh bi translated">微服务的最佳实践📳(微服务—第2部分)</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">微服务:✨最佳实践</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jn lh"/></div></div></a></div><h2 id="780c" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">✨服务发现</h2><p id="a539" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">✹:当你创建一个服务时，最好使用一个外部团体来发现你的服务。</p><p id="5267" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">为什么？</strong> 🧐</p><p id="26cd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为，如果基于微服务的系统中的基础架构发生变化，主机名、IP地址等。也可以改。。为了保持安全，消费者需要一种方法来识别可用服务的实例。因此，如果您有一个服务发现工具，代理可以调用服务发现工具，并可以获得更新的地址。这就是服务发现出现的方式。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lw"><img src="../Images/acb589fecdec1d3919839a998b2fa4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:494/format:webp/1*5KHWnVsD2CbDppCwSWKs8A.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lx"><img src="../Images/c8d22d85967aa6c453bdf12dae688389.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*VzmHwxr223tOK9V19VigCQ.png"/></div></figure><p id="ce9f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一些服务发现工具的例子:<strong class="ih hj"> WSO2治理注册中心，Hashicorp咨询，Zookeeper，smart stack…等等。</strong></p><p id="aef0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">笔记📝:</strong></p><p id="8b5f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✤:当你实现代理模式时，你需要注意线程池。因为如果没有实现适当的线程池功能，线程可能会被阻塞。(最好相应地使用多线程池或线程移交机制)</p><p id="4786" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✤代理位于消费者和新的微服务(新创建的微服务版本)之间。代理保留了原始的API，从而允许消费者与之交互。代理服务具有所需的逻辑来与新的微服务结合，以便向消费者提供数据和原始逻辑。</p><h2 id="77b4" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">✨暂停</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ly"><img src="../Images/b63475d2f904bfef2f3579c67065a4a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:626/format:webp/1*Kixac7z72O-ZNTpZNeyB7w.png"/></div></figure><p id="3a94" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当你有一个代理服务，并假设服务版本1.0被延迟。因此，如果您没有实现“超时”，它可能会阻塞线程，并可能会影响新的服务版本2.0。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lz"><img src="../Images/016cbbe671b53cd11486619e48b8da91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WlATTzP9o4c9ctJlYyLMLw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">ref:<a class="ae ld" href="https://dzone.com/articles/the-hardest-part-of-microservices-calling-your-ser" rel="noopener ugc nofollow" target="_blank">https://dzone . com/articles/the-hard-part-of-micro services-calling-your-ser</a></figcaption></figure><p id="b5a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我在博客“<a class="ae ld" rel="noopener" href="/nerd-for-tech/circuit-breaker-design-pattern-ce6378f5a929"> <strong class="ih hj">断路器模式</strong> </a>”中讨论过超时问题。更多详情请参考。(点击下面的链接)</p><div class="le lf ez fb lg lh"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/circuit-breaker-design-pattern-ce6378f5a929"><div class="li ab dw"><div class="lj ab lk cl cj ll"><h2 class="bd hj fi z dy lm ea eb ln ed ef hh bi translated">断路器设计模式🔩</h2><div class="lo l"><h3 class="bd b fi z dy lm ea eb ln ed ef dx translated">微服务设计模式—第2部分</h3></div><div class="lp l"><p class="bd b fp z dy lm ea eb ln ed ef dx translated">medium.com</p></div></div><div class="lq l"><div class="ma l ls lt lu lq lv jn lh"/></div></div></a></div><h1 id="951f" class="mb jv hi bd jw mc md me ka mf mg mh ke mi mj mk kh ml mm mn kk mo mp mq kn mr bi translated">代理设计模式的优缺点</h1><h2 id="9542" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">优势:</h2><p id="6b8c" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">✹这很容易实现。</p><p id="475e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✹简单。</p><p id="91cc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">可以实现与外部服务相关的✹验证和安全性，并且可以非常容易地封装在代理中。</p><h2 id="93d7" class="ju jv hi bd jw jx jy jz ka kb kc kd ke iq kf kg kh iu ki kj kk iy kl km kn ko bi translated">缺点:</h2><p id="faad" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated">✹瓶颈</p><p id="0624" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">✹不适宜改变反应</p></div><div class="ab cl ms mt gp mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="hb hc hd he hf"><h1 id="bd35" class="mb jv hi bd jw mc mz me ka mf na mh ke mi nb mk kh ml nc mn kk mo nd mq kn mr bi translated">参考</h1><p id="f131" class="pw-post-body-paragraph if ig hi ih b ii kp ik il im kq io ip iq kr is it iu ks iw ix iy kt ja jb jc hb bi translated"><a class="ae ld" href="https://www.youtube.com/watch?v=7mBvb7nKONg&amp;list=PLD-mYtebG3X9HaZ1T39-aF4ghEtWy9-v3&amp;index=7" rel="noopener ugc nofollow" target="_blank">微服务的设计模式—代理</a></p><p id="f754" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://www.geeksforgeeks.org/proxy-design-pattern/" rel="noopener ugc nofollow" target="_blank">https://www.geeksforgeeks.org/proxy-design-pattern</a></p><p id="13f6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://www.tutorialspoint.com/microservice_architecture/microservice_architecture_composition_patterns.htm" rel="noopener ugc nofollow" target="_blank">https://www . tutorialspoint . com/microservice _ architecture/microservice _ architecture _ composition _ patterns . ht</a>ml</p><p id="24ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://www.oreilly.com/library/view/microservice-patterns-and/9781788474030/5b4d76ce-184b-4480-a050-aec1582c8c83.xhtml" rel="noopener ugc nofollow" target="_blank">https://www . oreilly . com/library/view/microservice-patterns-and/9781788474030/5b 4d 76 ce-184 b-4480-a050-AEC 1582 c8 c 83 . html</a></p><p id="d924" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://8thlight.com/blog/colin-jones/2018/09/18/microservices-arent-magic-handling-timeouts.html" rel="noopener ugc nofollow" target="_blank">https://8 thlight . com/blog/Colin-Jones/2018/09/18/microservice sarent-magic-handling-time outs . html</a></p><p id="d9bb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://www.nginx.com/blog/service-discovery-in-a-microservices-architecture/" rel="noopener ugc nofollow" target="_blank">https://www . nginx . com/blog/service-discovery-in-a-micro services-architecture</a></p><p id="989c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae ld" href="https://searchapparchitecture.techtarget.com/tip/Navigate-service-discovery-in-a-microservices-architecture" rel="noopener ugc nofollow" target="_blank">https://search apparchitecture . tech target . com/tip/Navigate-service-discovery-in-a-micro services-architecture</a></p></div></div>    
</body>
</html>