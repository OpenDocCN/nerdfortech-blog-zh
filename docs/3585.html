<html>
<head>
<title>Build a machine learning model with PyCaret and corresponding user interface with Gradio</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用PyCaret建立机器学习模型，用Gradio建立相应的用户界面</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/build-a-machine-learning-model-with-pycaret-and-corresponding-user-interface-with-gradio-57ff09b7d262?source=collection_archive---------2-----------------------#2021-06-15">https://medium.com/nerd-for-tech/build-a-machine-learning-model-with-pycaret-and-corresponding-user-interface-with-gradio-57ff09b7d262?source=collection_archive---------2-----------------------#2021-06-15</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="c63d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">问题陈述和目标</h1><p id="f2a3" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">想象你在一家保险公司做数据科学家。您的经理要求您提出一个数据科学解决方案，以估算在机构中购买健康保险的个人的医疗成本。<strong class="jf hj">建立机器学习模型，估算个人的医疗成本</strong>。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/3e25afcc31bb4fb39219d4c939fad806.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adwubJb0X_uRisZjKHQyDA.jpeg"/></div></div></figure><h1 id="d261" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">PyCaret</h1><p id="4485" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kn" href="https://pycaret.org/" rel="noopener ugc nofollow" target="_blank"> PyCaret </a>是一个开源、低代码的机器学习库和端到端的模型管理工具，内置于Python中，用于自动化机器学习工作流。它因其易用性、简单性以及快速有效地构建和部署端到端ML原型的能力而广受欢迎。</p><p id="c54a" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">PyCaret是一个替代的低代码库，可以用来用几行代码替换数百行代码。这使得实验周期成倍地快速和有效。</p><p id="9c41" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">py caret<strong class="jf hj">简单</strong> <strong class="jf hj">好用</strong>。PyCaret中执行的所有操作都顺序存储在一个<strong class="jf hj">管道</strong>中，该管道对于<strong class="jf hj">部署是完全自动化的。</strong>无论是输入缺失值、一键编码、转换分类数据、特征工程，甚至是超参数调整，PyCaret都能实现自动化。</p><h1 id="2184" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">格拉迪欧</h1><p id="2950" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated"><a class="ae kn" href="https://www.gradio.app/getting_started" rel="noopener ugc nofollow" target="_blank"> Gradio </a>是一个开源的Python库，用于围绕你的机器学习模型创建可定制的UI组件。Gradio可以让您轻松地在浏览器中“摆弄”您的模型，方法是拖放您自己的图像、粘贴您自己的文本、录制您自己的声音等。，并查看模型输出的内容。</p><p id="24fe" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">Gradio适用于:</p><ul class=""><li id="b878" class="kt ku hi jf b jg ko jk kp jo kv js kw jw kx ka ky kz la lb bi translated">围绕您训练有素的ML渠道创建快速演示</li><li id="a92b" class="kt ku hi jf b jg lc jk ld jo le js lf jw lg ka ky kz la lb bi translated">获得关于模型性能的实时反馈</li><li id="5811" class="kt ku hi jf b jg lc jk ld jo le js lf jw lg ka ky kz la lb bi translated">在开发过程中交互式调试您的模型</li></ul><h2 id="54f2" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">正在安装Pycaret</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="e059" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">%%capture #suppresses the displays<br/># install the full version<br/>pip install pycaret[full]</strong></span></pre><p id="b9f6" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated"><em class="me">通过安装pycaret的完整版，此处</em>  <em class="me">列出的所有可选依赖项</em> <a class="ae kn" href="https://github.com/pycaret/pycaret/blob/master/requirements-optional.txt" rel="noopener ugc nofollow" target="_blank"> <em class="me">也被安装。</em></a></p><h2 id="3126" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">安装Gradio</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="ef7e" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">pip install gradio</strong></span></pre><h2 id="d23d" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">导入必要的包</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="bb81" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/># <br/>import pycaret<br/>from pycaret.regression import *</strong></span></pre><h2 id="c455" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">下载与问题陈述相关的数据</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="c685" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">train = pd.read_csv("train.csv")<br/>test = pd.read_csv("test.csv")<br/>sub = pd.read_csv("Sample_Submission.csv")<br/># display first 5 samples of the training data<br/>train.head()</strong></span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mf"><img src="../Images/59a89c536e9a158ef85ceac85e4d7485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*3UvIZzCsaWkCJ1zDXw8tig.png"/></div></figure><h2 id="ffd1" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">数据预处理</h2><ul class=""><li id="44dd" class="kt ku hi jf b jg jh jk jl jo mg js mh jw mi ka ky kz la lb bi translated"><em class="me">将主要受益人的年龄四舍五入至最接近的整数</em></li><li id="2f3c" class="kt ku hi jf b jg lc jk ld jo le js lf jw lg ka ky kz la lb bi translated"><em class="me">身体质量指数身体质量指数是体重与身高的比率。根据体重指数将人分为体重不足、正常、超重和肥胖。</em></li></ul><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="5a2d" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj"><em class="me">* Underweight: [0–18.5)</em></strong></span><span id="0963" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Normal : [18.5, 25)</em></strong></span><span id="af1d" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Overweight : [25, 30)</em></strong></span><span id="7bb1" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Obese : [30+]</em></strong></span></pre><ul class=""><li id="16f3" class="kt ku hi jf b jg ko jk kp jo kv js kw jw kx ka ky kz la lb bi translated"><em class="me">创建一个新的特征age_category来存储年龄</em></li></ul><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="79ee" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj"><em class="me">* Infant: [0–2)</em></strong></span><span id="e26b" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Toddler : [2, 5)</em></strong></span><span id="4737" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Child : [5, 13)</em></strong></span><span id="2a04" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Teen : [13- 20)</em></strong></span><span id="e17d" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Adult : [20, 40)</em></strong></span><span id="a143" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Middle Age : [40, 60)</em></strong></span><span id="b351" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj"><em class="me">* Senior : [60+]</em></strong></span></pre><h2 id="7ecb" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">密码</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="89e4" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">train[‘age’] = train[‘age’].round().astype(int)<br/>test[‘age’] = test[‘age’].round().astype(int)<br/>#<br/>#Define Function to define body category<br/>def group_bmi(x):<br/> if x &gt;= 0 and x &lt;= 18.5:<br/> return ‘underweight’<br/> elif x &gt; 18.5 and x &lt;= 25:<br/> return “normal”<br/> elif x &gt; 25 and x &lt;= 30:<br/> return “overweight”<br/> else:<br/> return “obese”<br/>#<br/>train[‘body_category’] = train[‘bmi’].apply(lambda x : group_bmi(x))<br/>test[‘body_category’] = test[‘bmi’].apply(lambda x : group_bmi(x))<br/>#<br/># Define function to define the age category<br/>def age_bin(x):<br/>  if x &gt;= 0 and x &lt; 2:<br/>    return "infant"<br/>  elif x &gt;= 2 and x&lt; 5:<br/>    return "toddler"<br/>  elif x &gt;=5 and x &lt; 13:<br/>    return "child"<br/>  elif x &gt;= 13 and x &lt; 20:<br/>    return "teen"<br/>  elif x &gt;= 20 and x &lt; 40 :<br/>    return "adult"<br/>  elif x &gt;= 40 and x &lt; 60:<br/>    return "middle_aged"<br/>  else:<br/>    return "senior"</strong></span><span id="c31a" class="lh ig hi lw b fi mj mb l mc md"><strong class="lw hj">train['age_group']  = train['age'].apply(lambda x : age_bin(x) )<br/>test['age_group'] = test['age'].apply(lambda x : age_bin(x) )</strong></span></pre><h2 id="9d1f" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">从数据可视化中获得洞察力</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="000e" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">sns.set_style(‘darkgrid’)<br/>plt.figure(figsize=(12,8))<br/>sns.lineplot(x=’age’,y=’charges’,data=train)</strong></span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mk"><img src="../Images/582e982169db7d46da00312dae4eea53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gcEKK_22OUDwh_6j8HbE5w.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">随着年龄的增长，医疗费用也在增加</figcaption></figure><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="5c22" class="lh ig hi lw b fi ma mb l mc md">sns.displot(train, x= “charges”, hue= “smoker”, kind=”kde”, fill=True)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mp"><img src="../Images/53331aeb570bc2fe9ffe309b7b3f3b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*xYSSLR1v6-yQPKqmKgKePw.png"/></div></figure><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="f22e" class="lh ig hi lw b fi ma mb l mc md">sns.set_style(‘darkgrid’)<br/>plt.figure(figsize=(12,8))<br/>sns.lineplot(x=’age’,y=’charges’,data=train,hue=’smoker’)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mq"><img src="../Images/36075801024b77ccb2783b3c39f6d365.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2e6bJKC9JdRvUaocKvdPQ.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">不吸烟者和吸烟者之间的医疗费用似乎有明显的界限</figcaption></figure><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="a1bb" class="lh ig hi lw b fi ma mb l mc md">plt.figure(figsize=(12,8))<br/>sns.countplot(x=’body_category’,data=train,hue=’sex’ )</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mr"><img src="../Images/7680649bc4bd65897cd0bcef973427fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Zd-aq7yYUr1zCywhVLPng.png"/></div></div></figure><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="ca21" class="lh ig hi lw b fi ma mb l mc md">sns.set_style(‘darkgrid’)<br/>plt.figure(figsize=(12,8))<br/>sns.lineplot(x=’age’,y=’charges’,data=train,hue=’age_group’)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ms"><img src="../Images/3e1543864446401aa2242aab16c5ba35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YH52hERIx1D2v7_-EPumRw.png"/></div></div></figure><h1 id="a40f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">pycaret建模和推理入门</h1><h2 id="e481" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">初始化设置</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="3bf8" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">reg = setup(data = train, <br/>            target = ‘charges’,<br/>            use_gpu =True,<br/>            preprocess=True,<br/>            log_data=True,<br/>            log_experiment=True,<br/>            normalize=True)</strong></span></pre><p id="aedd" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">PyCaret中的函数，对数据集进行剖析，并推断所有输入要素的数据类型。这是在PyCaret中开始任何机器学习实验的第一步，也是唯一的强制步骤。</p><h2 id="f2b1" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">比较模型</h2><p id="d0c5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">此函数使用默认超参数训练模型库中所有可用的模型，并使用交叉验证评估性能指标。可使用<code class="du mt mu mv lw b">fold</code>参数定义折叠次数(默认= 10次折叠)。表格按照选择的度量标准进行排序(从最高到最低)，选择的度量标准可以使用<code class="du mt mu mv lw b">sort</code>参数来定义(在本例中，我们在RMSE上对其进行了排序)</p><p id="13fd" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated"><code class="du mt mu mv lw b">n_select</code>设置功能中的参数控制已训练模型的返回。在本例中，我将它设置为15，这意味着以列表的形式返回前15个模型。第二行中的<code class="du mt mu mv lw b">pull</code>函数将<code class="du mt mu mv lw b">compare_models</code>的输出存储为<code class="du mt mu mv lw b">pd.DataFrame</code>。</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="7381" class="lh ig hi lw b fi ma mb l mc md">best = compare_models(n_select = 15,sort=’RMSE’)<br/>compare_model_results = pull()</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mw"><img src="../Images/2cbc1de46aeaddaf9b8b0cd75ad59fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6FSQx2NaOK96514ppfZ8NQ.png"/></div></div></figure><p id="84f2" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">因为RandomForestregressor被评估为具有相对较好的RMSE，所以让我们使用RandomForestregressor来构建模型</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="627c" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">rf = create_model(‘rf’)</strong></span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mx"><img src="../Images/8b3515443b3cff2083413be6e1fcbd2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*32LiOU8FnlIr-fmo-JEGCw.png"/></div></figure><h2 id="2282" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">超参数调谐</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="602b" class="lh ig hi lw b fi ma mb l mc md"><strong class="lw hj">tuned_rf = tune_model(rf,optimize = ‘RMSE’,search_library = ‘optuna’)</strong></span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es my"><img src="../Images/d7b3a6c97d19be4f5b71dccff5cc82a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*FTlldVmSw3Ufm6Mm56WN2A.png"/></div></figure><p id="39bf" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">利用Optuna选择最佳超参数</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es mz"><img src="../Images/908437b3a98280cf71dc41cd17677694.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*vrOlyHuLBKALYmJeqSVQsA.png"/></div></figure><h2 id="18a0" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">分析模型性能</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="3951" class="lh ig hi lw b fi ma mb l mc md">plot_model(tuned_rf)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es na"><img src="../Images/bed928a98689e81cc91c069c81ba00c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*9lS81IrbpoToYj0cpDrLhg.png"/></div></figure><h2 id="b7a0" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">解释结果</h2><p id="aab5" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">在PyCaret中，我们只用一行代码就可以通过SHAP值和相关图来解释模型</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="3b0f" class="lh ig hi lw b fi ma mb l mc md">interpret_model(tuned_rf)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nb"><img src="../Images/03b6c81dbffc9e910ef7ac07660a2c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*MLvbSrneFl-XYV2U6xJOUA.png"/></div></figure><h2 id="ba77" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">评估模型</h2><p id="180d" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">如果我们不想单独绘制所有这些可视化效果，那么PyCaret库有另一个惊人的功能—<strong class="jf hj"><em class="me">evaluate _ model</em></strong>。在这个函数中，您只需要传递模型对象，PyCaret将为您创建一个交互式窗口，以所有可能的方式查看和分析模型:</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="9f9d" class="lh ig hi lw b fi ma mb l mc md">evaluate_model(tuned_rf)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nc"><img src="../Images/c7900e88a90bd15164fdbb7543bc609c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n58Tls-ICu2CuS4CwbiAOQ.png"/></div></div></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nd"><img src="../Images/259d18147ec654d303734cfa12cf0d2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*1HlD6noqpDqC3fhneg63Ag.png"/></div></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ne"><img src="../Images/15729c179e9a0a87864e4e0b5ec20f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*62sCI_ggOEi-ml2heS0Q6Q.png"/></div></div></figure><h2 id="6f09" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">评估用于验证的维持集的模型</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="c2ea" class="lh ig hi lw b fi ma mb l mc md">val_rf_pred = predict_model(tuned_rf)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nf"><img src="../Images/e5bbf77a92300ea5001b200d61e0fe0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYq2_fVnQm1gBAFlCt9wZA.png"/></div></div></figure><p id="eb35" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">所做的预测(标签)如下</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ng"><img src="../Images/9ad34f9f5e817191bd5fecd37e451a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fivx-Wt-Q1RpnOtQciZYUQ.png"/></div></div></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nh"><img src="../Images/c12d3abc2858e9ec24f61770b20b4b66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eWm0OQB-Cf1gdQA8yQpVvA.png"/></div></div></figure><h2 id="645a" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">根据测试数据进行预测</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="0f95" class="lh ig hi lw b fi ma mb l mc md"># predictions on new dataset<br/>pred_new_rf = predict_model(tuned_rf, data = test) #new_data is pd dataframe<br/>pred_new_rf = pred_new_rf.rename(columns={‘Label’:’prediction’})<br/>pred_new_rf</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ni"><img src="../Images/56c6fbe1a1eca4d8ee6f8df7d02b60fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Geuc82nKqmMH6kazNRinFw.png"/></div></div></figure><p id="d21f" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">RandomForestRegressor提交分数(RMSE):53660 . 68668686666</p><h1 id="96bb" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用PyCaret构建集合模型</h1><p id="080a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">机器学习中的集成模型结合了来自多个模型的决策，以提高整体性能。<em class="me"> </em>在PyCaret中，我们只需要一行代码就可以创建打包、增强、混合和堆叠整体模型。在这里，我们将尝试混合。</p><p id="f83e" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">混合模型是一种集成方法，它使用估计者之间的共识来生成最终预测。混合背后的想法是结合不同的机器学习算法，并在分类的情况下使用多数投票或平均预测概率来预测最终结果。</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="fa41" class="lh ig hi lw b fi ma mb l mc md"># train a voting regressor dynamically<br/>blender_specific = blend_models(estimator_list = compare_models(n_select = 5))</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nj"><img src="../Images/91c47850797539da34275f08ad0a6f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*MVDgNX_bhkkeKj4zxh8roA.png"/></div></figure><p id="23cf" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">校准后的混合模型如下</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="f95a" class="lh ig hi lw b fi ma mb l mc md">blender_specific</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nk"><img src="../Images/dd3c98e46af27638cb3897c789a30781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*ow3ccbo3Paf_f7nnaA6FuQ.png"/></div></figure><h2 id="76f2" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">在PyCaret中分析模型性能</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="f262" class="lh ig hi lw b fi ma mb l mc md">plot_model(blender_specific)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nl"><img src="../Images/a63572f9e07dfcc4ccc3f9b97c56e72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/1*PgB0utggW_aMNJNDuVJVFQ.png"/></div></figure><h2 id="6f81" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">评估模型性能</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="3908" class="lh ig hi lw b fi ma mb l mc md">evaluate_model(blender_specific)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nm"><img src="../Images/fa3e840c9e7700eda71f03f17630fb9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nAvYM5apyxA8UWSmbBuJZw.png"/></div></div></figure><h2 id="885f" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">对验证集进行预测</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="ccbd" class="lh ig hi lw b fi ma mb l mc md">val_pred = predict_model(blender_specific)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div class="er es nn"><img src="../Images/21d63c19d3dae477880936f3946cb8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*PaQwa9UwTYbKAqNzuZPddw.png"/></div></figure><ul class=""><li id="0dd6" class="kt ku hi jf b jg ko jk kp jo kv js kw jw kx ka ky kz la lb bi translated">投票回归显示了改进的R2分数和RMSE</li></ul><h2 id="9bbe" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">根据看不见的数据做出预测</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="2272" class="lh ig hi lw b fi ma mb l mc md"># predictions on new dataset<br/>pred_new = predict_model(blender_specific, data = test) #new_data is pd dataframe<br/>pred_new = pred_new.rename(columns={‘Label’:’prediction’})<br/>pred_new</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es no"><img src="../Images/94786bdb0e575577cb63b5f653300da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4V0U5ehtjEIYAHriCtLFZg.png"/></div></div></figure><ul class=""><li id="a4ec" class="kt ku hi jf b jg ko jk kp jo kv js kw jw kx ka ky kz la lb bi translated">投票回归器提交分数为4084.5919179367957。与其他模型相比，该分数更好。</li></ul><h2 id="f8cc" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">保存并加载模型</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="90e9" class="lh ig hi lw b fi ma mb l mc md">save_model(blender_specific , ‘/content/drive/MyDrive/blender_specific_saved_06142021’)<br/># Loading the saved model<br/>blend_saved = load_model(‘/content/drive/MyDrive/blender_specific_saved_06142021’)<br/>pred = blend_saved.predict(test)<br/>pred[:5]</span></pre><h2 id="9829" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">使用Gradio为ML模型创建界面</h2><p id="b20b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们已经完成了建模过程，我们现在使用Gradio创建一个简单的UI来与我们的模型进行交互。</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="9721" class="lh ig hi lw b fi ma mb l mc md">import gradio as gr</span></pre><h2 id="d782" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">创建预处理函数</h2><p id="f259" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">该功能对数据进行预处理</p><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="7782" class="lh ig hi lw b fi ma mb l mc md">def encode_attributes(df): # Binning ages <br/> df[‘body_category’] = df[‘bmi’].apply(lambda x : group_bmi(x)) <br/> df[‘age_group’] = df[‘age’].apply(lambda x : age_bin(x) )<br/> return df</span></pre><h2 id="2ce2" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">创建预测函数</h2><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="33ed" class="lh ig hi lw b fi ma mb l mc md">def predict_charges(age, bmi,sex,smoker,region,children):<br/> df = pd.DataFrame.from_dict({‘sex’: [sex], ‘age’: [age], ‘smoker’: [smoker],’bmi’:[bmi],’region’:[region],’children’:[children]})<br/> df = encode_attributes(df)<br/> pred = blend_saved.predict(df).tolist()[0]<br/> return ‘charges : ‘+str(pred)+” in rupees”</span></pre><h2 id="b796" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">构建可共享的用户界面</h2><p id="b1b1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">Gradio可以用一个易于使用的接口包装几乎任何Python函数。该函数可以是任何东西，从简单的税收计算器到预先训练的模型。</p><p id="c0e7" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">核心<code class="du mt mu mv lw b">Interface</code>类用三个参数初始化:</p><ul class=""><li id="b73b" class="kt ku hi jf b jg ko jk kp jo kv js kw jw kx ka ky kz la lb bi translated"><code class="du mt mu mv lw b">fn</code>:换行功能</li><li id="e2a4" class="kt ku hi jf b jg lc jk ld jo le js lf jw lg ka ky kz la lb bi translated"><code class="du mt mu mv lw b">inputs</code>:输入组件类型</li><li id="e7ba" class="kt ku hi jf b jg lc jk ld jo le js lf jw lg ka ky kz la lb bi translated"><code class="du mt mu mv lw b">outputs</code>:输出组件类型</li></ul><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="714f" class="lh ig hi lw b fi ma mb l mc md">sex = gr.inputs.Radio([‘female’, ‘male’], label=”sex”)<br/>smoker = gr.inputs.Radio([‘no’, ‘yes’], label=”smoker”)<br/>children = gr.inputs.Radio([2, 3, 1, 4, 5, 0], label=”children”)<br/>region = gr.inputs.Radio([‘northeast’, ‘southeast’, ‘northwest’, ‘southwest’], label=”region”)<br/>age = gr.inputs.Slider(minimum=15, maximum=75, default=16, label=”age”)<br/>bmi = gr.inputs.Slider(minimum=15, maximum=60, default=16, label=”bmi”)</span></pre><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es np"><img src="../Images/14ad89a54aeb5deaa0a8f3bf800a18c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FaCKz2am45DjqMCswhwVkg.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">可定制的组件</figcaption></figure><pre class="kc kd ke kf fd lv lw lx ly aw lz bi"><span id="4e20" class="lh ig hi lw b fi ma mb l mc md">gr.Interface(predict_charges, inputs=[age, bmi,sex,smoker,region,children], <br/> outputs=”label”,<br/> title=”Medical Insurance Cost Prediction”,<br/> capture_session=True,<br/> live=True).launch();</span></pre><p id="6f69" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">上面的界面会自动出现在Python笔记本中，或者如果从脚本运行，会弹出一个带有url链接的浏览器。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nq"><img src="../Images/493eae0408e7b60783f35ee37667d761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4MnuM_2fu6x_VtxLSxzasg.png"/></div></div></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es nr"><img src="../Images/7009f627b941668e4399084510a2c364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNYGYqChg-5FtERkh1b06w.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">模型对用户界面中所选参数的预测</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ns"><img src="../Images/6a4f4de29135fbb2f61c7a9d78ec92d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yRJcXNe_uoxvgfpB1KTNfg.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">模型对用户界面中所选参数的预测</figcaption></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es np"><img src="../Images/4de586d74092ca5b83cda6f05fe2fb32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DgIj65ohAflYUhbuO9-ymA.png"/></div></div><figcaption class="ml mm et er es mn mo bd b be z dx translated">模型对用户界面中所选参数的预测</figcaption></figure><p id="1ef9" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated">在这里，只需几行代码，我们就可以开发一个下降UI，与开发的模型进行交互。又快又省事。</p><h2 id="406b" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">结束注释</h2><p id="1932" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">它真的很容易使用。我个人发现PyCaret对于在黑客马拉松或项目中快速生成结果非常有用，在这些项目中，我们有一个紧凑的时间表，并且需要比较不同的模型方法。它还有助于用几行代码更快地选择超参数和特性。所以所有的初始步骤都由Pycaret负责。</p><h2 id="57b4" class="lh ig hi bd ih li lj lk il ll lm ln ip jo lo lp it js lq lr ix jw ls lt jb lu bi translated">参考</h2><div class="nt nu ez fb nv nw"><a href="https://dphi.tech/challenges/data-sprint-37-medical-insurance-cost/127" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">数据冲刺#37:医疗保险费用| DPhi</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">通过解决模拟现实世界问题的数据科学和人工智能挑战来竞争和展示您的技能。组织…</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">dphi.tech</p></div></div><div class="of l"><div class="og l oh oi oj of ok kl nw"/></div></div></a></div><div class="nt nu ez fb nv nw"><a href="https://towardsdatascience.com/pycaret-2-2-is-here-whats-new-ad7612ca63b" rel="noopener follow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">PyCaret 2.2已经发布了，有什么新消息吗？</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">我们很高兴宣布py caret 2.2—2020年10月的更新。</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">towardsdatascience.com</p></div></div><div class="of l"><div class="ol l oh oi oj of ok kl nw"/></div></div></a></div><div class="nt nu ez fb nv nw"><a href="https://www.gradio.app/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab dw"><div class="ny ab nz cl cj oa"><h2 class="bd hj fi z dy ob ea eb oc ed ef hh bi translated">格拉迪欧</h2><div class="od l"><h3 class="bd b fi z dy ob ea eb oc ed ef dx translated">亲爱的#机器学习twitter，如果你还没有输入:$ 𝚙𝚒𝚙 𝚒𝚗𝚜𝚝𝚊𝚕𝚕 𝚐𝚛𝚊𝚍𝚒𝚘yet，现在将是一个该死的好…</h3></div><div class="oe l"><p class="bd b fp z dy ob ea eb oc ed ef dx translated">www.gradio.app</p></div></div><div class="of l"><div class="om l oh oi oj of ok kl nw"/></div></div></a></div><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="on oo l"/></div></figure><p id="3eda" class="pw-post-body-paragraph jd je hi jf b jg ko ji jj jk kp jm jn jo kq jq jr js kr ju jv jw ks jy jz ka hb bi translated"><a class="ae kn" href="https://www.linkedin.com/in/plaban-nayak-a9433a25/" rel="noopener ugc nofollow" target="_blank"> <em class="me">跟我联系</em> </a></p></div></div>    
</body>
</html>