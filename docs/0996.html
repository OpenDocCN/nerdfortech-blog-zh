<html>
<head>
<title>Solving CORS Errors Associated with Deploying a Node.js + PostgreSQL API to Heroku</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">解决与将Node.js + PostgreSQL API部署到Heroku相关的CORS错误</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/solving-cors-errors-associated-with-deploying-a-node-js-postgresql-api-to-heroku-229591a32ccd?source=collection_archive---------13-----------------------#2021-02-28">https://medium.com/nerd-for-tech/solving-cors-errors-associated-with-deploying-a-node-js-postgresql-api-to-heroku-229591a32ccd?source=collection_archive---------13-----------------------#2021-02-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><div class=""><h2 id="79c0" class="pw-subtitle-paragraph if hh hi bd b ig ih ii ij ik il im in io ip iq ir is it iu iv iw dx translated"><strong class="ak">第2部分:部署GraphQL API </strong></h2></div><p id="03dd" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本指南的第一部分中，我介绍了在将Node.js + PostgreSQL REST API部署到Heroku时如何解决CORS错误。</p><div class="jt ju ez fb jv jw"><a rel="noopener follow" target="_blank" href="/nerd-for-tech/solving-cors-errors-associated-with-deploying-a-node-js-postgresql-api-to-heroku-1afd94964676"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">解决与将Node.js + PostgreSQL API部署到Heroku相关的CORS错误</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">第1部分:部署REST API</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">medium.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk kl jw"/></div></div></a></div><p id="85b4" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">你可以通过上面的链接查看这篇文章，因为我会参考它，以避免重复我自己。</p><p id="23a0" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在第二部分中，我将详细介绍将GraphQL API部署到Heroku stress-free需要做的事情。但我们将采取不同的方法，即通过Docker将GraphQL API部署到Heroku。</p><p id="32f9" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">据opensource.com<a class="ae km" href="https://opensource.com/resources/what-docker" rel="noopener ugc nofollow" target="_blank">，</a><a class="ae km" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> Docker </a>介绍，Docker是一款DevOps工具，用于通过使用容器来创建、部署和运行应用程序。容器允许开发人员将应用程序与它需要的所有部分打包在一起，比如库和其他依赖项，并作为一个包进行部署。这个容器现在使得应用程序可以在任何其他Linux机器上运行，而不管该机器可能具有的任何定制设置是否与用于编写和测试代码的机器不同。</p><p id="f05f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我假设你了解GraphQL、Docker、Typescript以及本指南第1部分中提到的其他技术。我们将使用Apollo Server作为GraphQL服务器，Typeorm处理Postgres函数，Express-Session用于会话和cookie，Redis用于存储cookie。</p><p id="ed0f" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在本指南中，我们将介绍以下步骤:</p><ul class=""><li id="bae4" class="kn ko hi iz b ja jb jd je jg kp jk kq jo kr js ks kt ku kv bi translated">设置我们的服务器</li><li id="74db" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">在我们的服务器上配置CORS</li><li id="dcf7" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">设置Dockerfile</li><li id="ce79" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">配置环境变量</li><li id="ea33" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">部署到Heroku</li></ul><p id="6eae" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们将使用的依赖项:</p><ul class=""><li id="14cf" class="kn ko hi iz b ja jb jd je jg kp jk kq jo kr js ks kt ku kv bi translated">表达</li><li id="345a" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">阿波罗服务器快递</li><li id="7aab" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">类型-graphql</li><li id="3046" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">约尔迪什</li><li id="c950" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">连接-redis</li><li id="8b5e" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">快速会话</li><li id="b05c" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">字体</li><li id="ee18" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">heroku-cli全球安装</li><li id="03f1" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">dotenv-安全</li><li id="4dd3" class="kn ko hi iz b ja kw jd kx jg ky jk kz jo la js ks kt ku kv bi translated">克-奥二氏分级量表</li></ul><h2 id="189f" class="lb lc hi bd ld le lf lg lh li lj lk ll jg lm ln lo jk lp lq lr jo ls lt lu lv bi translated"><strong class="ak">设置我们的服务器</strong></h2><p id="3fec" class="pw-post-body-paragraph ix iy hi iz b ja lw ij jc jd lx im jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">如果我们想避免在生产中出现CORS错误，以正确的方式设置我们的服务器是非常重要的。CORS错误有时是由于错误的配置导致服务器无法设置cookies。为了解决这个问题，我们的服务器设置需要如下所示:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><h2 id="4e8e" class="lb lc hi bd ld le lf lg lh li lj lk ll jg lm ln lo jk lp lq lr jo ls lt lu lv bi translated">在我们的服务器上配置CORS</h2><p id="f772" class="pw-post-body-paragraph ix iy hi iz b ja lw ij jc jd lx im jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">建议显式配置CORS以允许特定的客户端URL。这可以通过以下方式实现:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="1692" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在这种情况下，我们的客户端也需要进行配置，然后才能访问我们的API。对于Apollo客户机，下面的配置就可以了:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><h2 id="fd40" class="lb lc hi bd ld le lf lg lh li lj lk ll jg lm ln lo jk lp lq lr jo ls lt lu lv bi translated">设置Dockerfile</h2><p id="6155" class="pw-post-body-paragraph ix iy hi iz b ja lw ij jc jd lx im jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">首先，我们需要下载安装Docker，并确保它在后台运行。如果你之前没有用过Docker，建议你看一下Academind的这个完整的Docker教程，帮助你入门。</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mi mh l"/></div></figure><p id="e48e" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下一步是创建Dockerfile和. dockerignore文件，将node_modules和我们的错误文件(yarn-error.log或package-error.log)添加到。dockerignore文件。我们的docker文件需要看起来像这样:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="6b22" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这包含了Docker为我们的API创建Docker映像所需要运行的一步一步的过程。你可以通过下面的链接阅读更多关于如何dockerize你的Node.js web应用的内容。</p><div class="jt ju ez fb jv jw"><a href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hj fi z dy kb ea eb kc ed ef hh bi translated">将Node.js web应用程序| Node.js归档</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">这个例子的目的是向你展示如何将Node.js应用程序放入Docker容器。的…</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">nodejs.org</p></div></div><div class="kf l"><div class="mj l kh ki kj kf kk kl jw"/></div></div></a></div><h2 id="9fc7" class="lb lc hi bd ld le lf lg lh li lj lk ll jg lm ln lo jk lp lq lr jo ls lt lu lv bi translated">配置环境变量</h2><p id="1ad9" class="pw-post-body-paragraph ix iy hi iz b ja lw ij jc jd lx im jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">我们的环境变量设置，无论是本地的还是Heroku上的，都将与<a class="ae km" rel="noopener" href="/nerd-for-tech/solving-cors-errors-associated-with-deploying-a-node-js-postgresql-api-to-heroku-1afd94964676"> part 1 </a>的情况相同。</p><h2 id="2071" class="lb lc hi bd ld le lf lg lh li lj lk ll jg lm ln lo jk lp lq lr jo ls lt lu lv bi translated">部署到Heroku</h2><p id="2d35" class="pw-post-body-paragraph ix iy hi iz b ja lw ij jc jd lx im jf jg ly ji jj jk lz jm jn jo ma jq jr js hb bi translated">现在我们已经完成了服务器的设置，最后一步是部署到Heroku。我们需要做的第一件事是通过heroku-cli登录Heroku和Heroku容器注册表:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="2220" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">接下来，我们需要创建一个Heroku应用程序，构建图像，将其推送到容器注册表，并将图像发布到我们的应用程序:</p><figure class="mb mc md me fd mf"><div class="bz dy l di"><div class="mg mh l"/></div></figure><p id="3cc2" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们完了。如果您已经在生产中启用了GraphQL playground，那么您可以在浏览器中打开您的API heroku URL:</p><blockquote class="mk ml mm"><p id="939a" class="ix iy mn iz b ja jb ij jc jd je im jf mo jh ji jj mp jl jm jn mq jp jq jr js hb bi translated">https://yourherokuurl.com/graphql<a class="ae km" href="https://yourherokuurl.com/graphql" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="ecef" class="pw-post-body-paragraph ix iy hi iz b ja jb ij jc jd je im jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">或者您可以通过客户端使用您的API。</p></div></div>    
</body>
</html>