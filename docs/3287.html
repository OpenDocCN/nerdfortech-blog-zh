<html>
<head>
<title>Dynamically create and merge pdfs in Angular or NodeJS using jspdf and pdf-lib</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 jspdf 和 pdf-lib 在 Angular 或 NodeJS 中动态创建和合并 pdf</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/dynamically-create-and-merge-pdfs-in-angular-using-jspdf-and-pdf-lib-aa82ae35f1e3?source=collection_archive---------1-----------------------#2021-06-05">https://medium.com/nerd-for-tech/dynamically-create-and-merge-pdfs-in-angular-using-jspdf-and-pdf-lib-aa82ae35f1e3?source=collection_archive---------1-----------------------#2021-06-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/a8d41cfd924356c1be9569ba491129f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*Tp6uIXQ-qYJyKiikEpXXSg.png"/></div><figcaption class="im in et er es io ip bd b be z dx translated">图片来源—<a class="ae iq" href="https://smallpdf.com/pdf-reader" rel="noopener ugc nofollow" target="_blank">https://smallpdf.com/pdf-reader</a></figcaption></figure><p id="5f92" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">最近，我试图从我的 angular 应用程序创建一个 pdf，基于用户输入的的<strong class="it hj">一些数据。我遇到了 jspdf，它可以<strong class="it hj">在按钮点击或其他用户事件上创建动态 pdf</strong>。我开始写代码，然后我想在旅途中将一些现有的 pdf 文件合并到我新创建的 pdf 文件中。在这里，我意识到 jspdf 不允许我们这样做，pdf-lib 允许，但是我已经习惯了 jspdf 和它从顶部到底部添加内容的方式，这与 pdf-lib(从底部到顶部)的情况不同。</strong></p><p id="7c48" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我按照下面的步骤分别使用两个文件<strong class="it hj"> jspdf &amp; pdf-lib </strong>到<strong class="it hj">创建和合并</strong>pdf。</p><blockquote class="jp jq jr"><p id="86bf" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated">相同的实现在 Angular 前端应用程序或 NodeJS 服务器中运行良好。</p></blockquote><h1 id="2650" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">jspdf</h1><p id="ff24" class="pw-post-body-paragraph ir is hi it b iu ku iw ix iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo hb bi translated">这里有一些使用 jspdf 的技巧，你可以在<a class="ae iq" href="https://mrrio.github.io/jsPDF/" rel="noopener ugc nofollow" target="_blank">https://mrrio.github.io/jsPDF/</a>找到基本的例子</p><ul class=""><li id="6a5b" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated"><strong class="it hj">使用<strong class="it hj"> npm 安装 jspdf </strong>在 angular 应用程序中安装 jspdf </strong>，然后使用<strong class="it hj">从‘jspdf’导入 js pdf 将其导入到组件文件中；</strong></li><li id="cf21" class="kz la hi it b iu li iy lj jc lk jg ll jk lm jo le lf lg lh bi translated">创建一个新的<strong class="it hj"> jspdf 文档</strong>来处理<strong class="it hj">(使其全局化，但在函数中初始化，以便在每次按钮点击/事件时生成一个新的 pdf，并且还可以通过不同的函数使用)</strong>:</li></ul><blockquote class="jp jq jr"><p id="98d6" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . doc = new jsPDF()；</em> </strong></p></blockquote><ul class=""><li id="87f4" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">设置高度，并在每次您在文档中写入一些文本时增加高度，以给出新的一行。</li></ul><blockquote class="jp jq jr"><p id="fe5d" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . height = 20；</em> </strong></p></blockquote><ul class=""><li id="188f" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">设置字体样式，然后编写文本:</li></ul><blockquote class="jp jq jr"><p id="90cc" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . doc . set fontsize(11)；<br/>this . doc . set font(" Helvetica "，"粗体")；<br/> this.doc.text('某文'，15，this . height)；</em> </strong> <em class="hi"> // 15 是左边距</em></p></blockquote><ul class=""><li id="be69" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">您也可以使用将图像添加到 pdf</li></ul><blockquote class="jp jq jr"><p id="d86b" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . doc . addimage(this . img，145，10，57，30)；</em>T47】</strong></p></blockquote><ul class=""><li id="92f9" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">为了获得上述步骤的图像</li></ul><blockquote class="jp jq jr"><p id="7f16" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . http . get('/assets/images/logo . png '，{ responseType: 'blob' }) <br/>。subscribe(RES =&gt;{<br/>const reader = new FileReader()；<br/>reader . onloadend =()=&gt;{<br/>this . img = reader . result . tostring()；<br/>}<br/>reader . readasdataurl(RES)；<br/>})；</em> </strong></p></blockquote><ul class=""><li id="ef94" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">当<strong class="it hj">当前页面已满</strong>时，您需要创建一个新页面，然后继续添加内容，否则<strong class="it hj">内容将从第一页溢出</strong>而不可见。为此，编写一个函数给<strong class="it hj">检查当前高度</strong>(即 this.height)，一旦超过页面高度(即~280) <strong class="it hj">在文档中创建一个新页面</strong>，使用</li></ul><blockquote class="jp jq jr"><p id="e66d" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . doc . add page()；</em>T11】</strong></p></blockquote><ul class=""><li id="2f0d" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">添加完所有内容后，您可以保存文档，这将<strong class="it hj">将 pdf 文件</strong>下载到用户的设备中。</li></ul><blockquote class="jp jq jr"><p id="d437" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">this . doc . save(' sample . pdf ')；</em> </strong></p></blockquote><ul class=""><li id="6f7b" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">如果您想将其他 pdf 合并到上面生成的 pdf 中，请跳过上述步骤。创建当前 pdf 的输出数组</li></ul><blockquote class="jp jq jr"><p id="fdf3" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">arrayB = This . doc . output(' array buffer ')</em></strong><em class="hi">//这将被</em> <strong class="it hj"> <em class="hi"> pdf-lib(下)</em> </strong></p></blockquote></div><div class="ab cl ln lo gp lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="hb hc hd he hf"><h1 id="c961" class="jw jx hi bd jy jz lu kb kc kd lv kf kg kh lw kj kk kl lx kn ko kp ly kr ks kt bi translated">pdf 库</h1><p id="d5a8" class="pw-post-body-paragraph ir is hi it b iu ku iw ix iy kv ja jb jc kw je jf jg kx ji jj jk ky jm jn jo hb bi translated">要将现有的 pdf 合并到您创建的 pdf(使用 jspdf，如上所述，或者 pdf-lib)，请在您的组件文件中导入 pdf-lib</p><blockquote class="jp jq jr"><p id="740e" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"> <em class="hi">从‘pdf-lib’导入{ pdf document }；</em> </strong></p></blockquote><ul class=""><li id="bf19" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">创建新文档</li></ul><blockquote class="jp jq jr"><p id="8304" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const pdf doc = await pdf document . create()；</em> </strong></p></blockquote><ul class=""><li id="4596" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">加载您创建的 pdf</li></ul><blockquote class="jp jq jr"><p id="00b1" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const first doc = await pdf document . load(arrayB)；</em> </strong> <em class="hi"> //arrayB 来自上面 jspdf 的</em> <strong class="it hj"> <em class="hi">最后一步。</em>T45】</strong></p></blockquote><ul class=""><li id="c84f" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">将<strong class="it hj">第一个文档</strong>转换为页面，并在<strong class="it hj"> pdfDoc </strong>中复印每一页</li></ul><blockquote class="jp jq jr"><p id="9398" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const first page = await pdf doc . copy pages(first doc，first doc . getpage indexes())；</em>T53】</strong></p><p id="fc75" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">first page . foreach((page)=&gt;pdfdoc . add page(page))；</em>T57】</strong></p></blockquote><ul class=""><li id="5671" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">现在，从您的资产/服务器获取现有 pdf 后，按照相同的步骤操作。</li></ul><blockquote class="jp jq jr"><p id="bc72" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const second pdfbytes = await fetch("/assets/pdf/"+pdf _ name)。然后(RES =&gt;RES . array buffer())；</em> </strong></p><p id="12ef" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const second doc = await pdf document . load(second pdfbytes)；</em> </strong></p><p id="5e47" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const second page = await pdf doc . copy pages(second doc，second doc . getpage indexes())；</em> </strong></p><p id="9e97" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">second page . foreach((page)=&gt;pdfdoc . add page(page))；</em>T73】</strong></p></blockquote><ul class=""><li id="7cb7" class="kz la hi it b iu iv iy iz jc lb jg lc jk ld jo le lf lg lh bi translated">现在你的 pdfDoc 已经有了第一个 pdf 的所有页面和第二个 pdf 的所有页面，你可以下载最终的 pdf 了。</li></ul><blockquote class="jp jq jr"><p id="86af" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">const pdf bytes = await pdf doc . save()；</em>T77】</strong></p><p id="1ed7" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">let file = new Blob([pdf bytes]，{ type:' application/pdf ' })；</em>T81】</strong></p><p id="6499" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">var fileURL = URL . createobjecturl(文件)；</em>T85】</strong></p><p id="4275" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hb bi translated"><strong class="it hj"><em class="hi">window . open(fileURL)；</em>T3】</strong></p></blockquote><p id="d021" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">搞定！</strong>完成上述步骤后，您已经成功地在 Angular 应用程序中创建和合并了用户事件的 pdf 文件，并将其下载到了用户的设备上。</p><p id="cf00" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果你认为有一些不正确的信息或者我错过了什么，或者如果你有任何疑问，请在下面评论。</p><h1 id="f951" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">谢谢大家！</h1></div></div>    
</body>
</html>