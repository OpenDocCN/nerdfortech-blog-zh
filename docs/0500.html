<html>
<head>
<title>Build a momentum trading strategy &amp; test the signal for alpha</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立动量交易策略&amp;测试阿尔法信号</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/build-a-momentum-trading-strategy-test-the-signal-for-alpha-b50731cadd89?source=collection_archive---------0-----------------------#2021-01-03">https://medium.com/nerd-for-tech/build-a-momentum-trading-strategy-test-the-signal-for-alpha-b50731cadd89?source=collection_archive---------0-----------------------#2021-01-03</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="ed64" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">什么是动量交易？</strong></p><p id="ebf9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">动量是量化交易中最流行的技术指标之一。动量就是一个特定时期内证券价格的变化率。动量投资者寻求利用短期头寸，在股票上涨时买入，在开始下跌时卖出。注意——这与著名的“低买高卖”投资策略形成了鲜明的对比。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/b4e27c9da16a5e9ba2062986b8d12d5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/1*PFs6tIri3VhEbmyilA49Xw.png"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">烛台动量轮廓</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jp"><img src="../Images/ab305eac7a01e62c7962303ae360137c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5v2cOaOHci0rZwJfzMpJOw.jpeg"/></div></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">SL =止损。TP =止盈。这是动量交易的一个例子。以下战略旨在利用这一双向运动。</figcaption></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="20ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">用 Python 实现</strong></p><ol class=""><li id="c5da" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">使用羊驼和多边形获取数据。羊驼是一个真正的算法交易精英平台，易于使用的 API 的。如果您不熟悉，这里有文档的链接。Polygon: <a class="ae kk" href="https://polygon.io/" rel="noopener ugc nofollow" target="_blank"> Polygon.io —股市数据 API</a>，羊驼:<a class="ae kk" href="https://alpaca.markets/docs/" rel="noopener ugc nofollow" target="_blank">文档|羊驼</a></li><li id="d434" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">建立动量交易策略——识别表现良好的股票并模拟多头，识别表现不佳的股票并模拟空头。计算预期收益。</li><li id="0d64" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">分析信号。执行单侧统计 t 检验，以确定该信号中是否有任何α。无效假设是，这个信号中没有α。记住，我们拒绝小于显著性水平(0.05)的 p 值的零假设。</li></ol></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="1096" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kq">第一步—取数据</em> </strong></p><p id="6bcf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">模块可以通过 conda / pip 安装。我推荐在康达建立一个虚拟环境。此处链接:</p><p id="1997" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kk" href="https://anaconda.org/quantopian/zipline" rel="noopener ugc nofollow" target="_blank">高空滑索::蟒蛇云</a></p><p id="4fb9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kk" href="https://pypi.org/project/pipeline-live/" rel="noopener ugc nofollow" target="_blank">管道-实时 PyPI </a></p><p id="0827" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><a class="ae kk" href="https://pypi.org/project/alpaca-trade-api/" rel="noopener ugc nofollow" target="_blank">羊驼-贸易-api PyPI </a></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><blockquote class="kt ku kv"><p id="be63" class="if ig kq ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated">在您成功导入上述模块后，我们就可以开始构建策略了！</p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="1c34" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这将返回一个空的数据框，其中包含我们希望用于我们的宇宙的证券作为索引。宇宙参数如下:前 100 名，<strong class="ih hj">平均美元成交量</strong>股票，在过去 120 天内。注意——这不要与每日交易量相混淆。<strong class="ih hj"> <em class="kq">平均美元成交量是一个比率，计算方法是一只股票的股价乘以其日成交量。</em> </strong></p><p id="f539" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">创建帐户后，您的 API 密钥可以在您的羊驼仪表板中找到。转到票据交易概述并选择“查看”。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es kz"><img src="../Images/1db3f38407ccc636f308892f064eb759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UiYUwtw-6q0y9IQSLTrZKQ.jpeg"/></div></div></figure><p id="4e8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">既然宇宙已经设定好了，我们有了想要交易的证券，是时候获取数据了。我们使用上面管道输出的索引。这就是我们的战略领域。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div><figcaption class="jl jm et er es jn jo bd b be z dx translated">注意—实例化 API REST 对象+在循环中使用函数</figcaption></figure><p id="9d3e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">不幸的是，polygon api 不允许您一次获取多个证券的数据。我构建了上面的函数来获取每个资产的数据，一次一个，并将所有数据合并到一个整洁的数据框中。输出是包含所有证券的多指数。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es la"><img src="../Images/4f99327ede6f5f5693e77c783489699f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_HtMNFnHXIS4kXjdkiN2EA.jpeg"/></div></div></figure></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="d2f8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kq">第二步——造势策略</em> </strong></p><blockquote class="kt ku kv"><p id="b3dc" class="if ig kq ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><strong class="ih hj">计算返回&amp;重采样频率。</strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="a598" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">细分:</strong></p><ol class=""><li id="519e" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">对数返回:当处理时间序列数据时，标准惯例是计算对数值，而不是算术值。因此有了上面的计算。这有很多原因，但归结起来就是:对于微积分/统计计算，对数值更容易处理。</li><li id="36ad" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">Returns:分解新计算的“Log_Returns”特征。这将创建一个新的数据框，以时间戳索引和符号作为列。</li><li id="aaa4" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">重采样:在月末对指数频率进行重采样，频率为每月一次。这将是投资组合再平衡的时间表，也称为“交易时间表”。</li><li id="940b" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">Shift 返回:创建两个新的数据帧；lookahead_returns 和 prev_returns，将收益向前移动一个月，向后移动一个月。这些将用于识别多头和空头头寸，并计算预期的投资组合回报。</li></ol><blockquote class="kt ku kv"><p id="fe5c" class="if ig kq ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><strong class="ih hj">识别表现最佳和表现最差的股票。</strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><p id="0d45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">细分:</strong></p><ol class=""><li id="aada" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">创建包含返回列(符号)和索引(日期)的空数据框</li><li id="85d0" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">用新的和空的数据框扫描以前的回报数据框，用 1 填充表现最好的 50 只股票，设置为“df_long”。对 50 个性能最差的重复此过程，设置为“df_short”</li></ol><blockquote class="kt ku kv"><p id="7953" class="if ig kq ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><strong class="ih hj">计算投资组合回报</strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lb"><img src="../Images/34042aa6d77ff36f79512a9d7cc734c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*n6KiOWO4Ygmin6KcufMfFg.jpeg"/></div></figure><p id="5c09" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">细分:</strong></p><ol class=""><li id="1321" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">计算长数据框和短数据框中的“模拟”/相等持仓。<em class="kq">(模拟，因为在生产中，您将在这里设计一个真正的优化)</em></li><li id="ea4c" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">将持有量和未来回报相乘，得到投资组合的预期回报。记住未来的收益，只是一个月前的收益。</li><li id="fc69" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">转置预期回报(翻转列和索引)，以获得每个日期的预期回报。获得平均投资组合回报。</li><li id="6e43" class="kb kc hi ih b ii kl im km iq kn iu ko iy kp jc kg kh ki kj bi translated">这是我们计算年化回报率的方法:</li></ol><p id="6334" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">年化收益率=((1+<em class="kq">r</em>1)×(1+<em class="kq">r</em>2)×(1+<em class="kq">r</em>3 )×⋯×(1+<em class="kq">rn</em>)<em class="kq">n</em>11</p><p id="62d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">(提示:这只是一个例子，说明为什么我们之前计算对数回报，而不是算术回报。上面的“n”变量对应于投资的持有时间，类似于回报的对数计算。)</p><p id="3665" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面代码片段的第 14 行，您可以看到这个公式在 Python 中的实现。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="2abd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="kq">第三步——分析信号</em> </strong></p><blockquote class="kt ku kv"><p id="c997" class="if ig kq ih b ii ij ik il im in io ip kw ir is it kx iv iw ix ky iz ja jb jc hb bi translated"><strong class="ih hj">进行单边 t 检验来回答零假设:这个信号中没有 alpha。</strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="kr ks l"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lc"><img src="../Images/66d1ef380f3b53f309fef8247841b011.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*2g-bIkUB1ZzYQJODnj1W7Q.jpeg"/></div></figure><p id="03ab" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">细分:</strong></p><ol class=""><li id="ebc8" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">“stats.ttest_1samp”函数进行双边 t 检验。我们需要单侧 t 检验的 p 值，所以我们将 p 除以 2。该函数的参数是预期的投资组合回报，以及我们的零假设或“参考值”。</li></ol><p id="a0a9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="kq">(提示:这样做的原因是因为我们不寻求发现一个平均值是否在两个值之间。我们想知道平均值是否在任一方向上不同于参考值，因此是零假设。因此我们做了单边 t 检验。)</em></p><p id="84e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">2.我们拒绝显著性水平小于 0.05 的 p 值的零假设，并推断该信号中存在α。直觉上，这是有道理的，因为年化回报率是正数。</p></div></div>    
</body>
</html>