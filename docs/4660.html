<html>
<head>
<title>Tutorial: How To Deploy Prometheus and Node Exporter as Containers on a Remote server (with $5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">教程:如何将Prometheus和Node Exporter作为容器部署在远程服务器上(5美元)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/tutorial-how-to-deploy-prometheus-and-node-exporter-as-containers-on-a-remote-server-with-5-af5b449be49b?source=collection_archive---------1-----------------------#2021-08-01">https://medium.com/nerd-for-tech/tutorial-how-to-deploy-prometheus-and-node-exporter-as-containers-on-a-remote-server-with-5-af5b449be49b?source=collection_archive---------1-----------------------#2021-08-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="ca98" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">介绍</h1><p id="ff98" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">本教程的目的是向您展示如何在远程服务器上设置Prometheus监控。不是笔记本电脑上的本地主机，而是实际的远程服务器。您仍然需要您的笔记本电脑，但我们将通过在不同的计算机上放置节点导出器来收集硬件/操作系统指标。然后将使用本地机器上的Grafana仪表板可视化我们收集的数据。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es kb"><img src="../Images/90c861f7d759161276b7539d1f68f2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*728HZD3ciDIvhlesDIUVhg.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx translated">代表我们将要做的事情的图表</figcaption></figure><h1 id="146e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">先决条件</h1><ul class=""><li id="61da" class="kr ks hi jf b jg jh jk jl jo kt js ku jw kv ka kw kx ky kz bi translated">你已经在电脑上安装了Docker，并且知道如何使用命令行界面</li><li id="85e1" class="kr ks hi jf b jg lb jk lc jo ld js le jw lf ka kw kx ky kz bi translated">对什么是<a class="ae la" href="https://prometheus.io/docs/introduction/overview/" rel="noopener ugc nofollow" target="_blank">普罗米修斯</a>和底层架构的高度理解</li><li id="c467" class="kr ks hi jf b jg lb jk lc jo ld js le jw lf ka kw kx ky kz bi translated">你知道什么是<a class="ae la" href="https://grafana.com/docs/" rel="noopener ugc nofollow" target="_blank"> Grafana </a>并且知道它被用来可视化来自数据源的分析</li><li id="9b3a" class="kr ks hi jf b jg lb jk lc jo ld js le jw lf ka kw kx ky kz bi translated">您之前已经编写了一个<a class="ae la" href="https://docs.docker.com/compose/gettingstarted/" rel="noopener ugc nofollow" target="_blank"> docker-compose </a>文件</li><li id="2a7b" class="kr ks hi jf b jg lb jk lc jo ld js le jw lf ka kw kx ky kz bi translated">您知道如何使用Linux命令行</li></ul><p id="8529" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">这不是一个初学者友好的教程。我假设你正在阅读这篇文章，因为你有上述所有的经验。</p><h1 id="4833" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">花5美元买一台Linode服务器</h1><p id="17f1" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">我们将使用托管公司Linode来设置我们的远程服务器。去<a class="ae la" href="https://www.linode.com/" rel="noopener ugc nofollow" target="_blank">Linode.com</a>注册一个账户(你不会马上收到账单)。点击Linodes &gt;创建一个Linode，并如下配置您的设置:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ll"><img src="../Images/5a70133e02621000a6049be1a92cb7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G38QAbBe6DBG6_8wtVm51A.png"/></div></div></figure><p id="9928" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">向下滚动，输入服务器的名称和root密码(保持简单)。然后选择一个离你最近的地区(对我来说是佐治亚州亚特兰大)。请确保您选择最便宜的选项，因为我们不需要任何强大的本教程。</p><h1 id="da36" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">SSH进入我们的服务器并安装Docker</h1><p id="0702" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">你可以通过点击你的节点找到你的服务器的IP地址。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ll"><img src="../Images/12246e4d11a1a90dd63b2ada7ee4df08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tR3J9LqchylxXq798HUb2w.png"/></div></div></figure><p id="c077" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">现在启动您的终端并通过ssh连接到服务器。请确保输入您在创建服务器时输入的密码。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es lm"><img src="../Images/29eea3db5b85cc65e5df64b677226042.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vY9UCS_zk61rpJPMaoKjaw.png"/></div></div></figure><p id="f84d" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">注意:通常您会创建一个拥有sudo特权的新用户，但是为了节省本文的篇幅，您现在可以作为root用户登录。</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="80b4" class="ls ig hi lo b fi lt lu l lv lw">apt-get update &amp;&amp; apt install docker.io</span></pre><p id="c209" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">现在在服务器上安装Docker。</p><h1 id="968f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用Docker compose安装Prometheus和节点导出器</h1><p id="e90e" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，对于下一部分，我们可以使用以下docker运行命令单独创建容器:</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="e302" class="ls ig hi lo b fi lt lu l lv lw">#start node-exporter container<br/>docker run -d \<br/>  --net="host" \<br/>  --pid="host" \<br/>  -v "/:/host:ro,rslave" \<br/>  prom/node-exporter:latest \<br/>  --path.rootfs=/host</span><span id="9a5d" class="ls ig hi lo b fi lx lu l lv lw"># start promethues container <br/>docker run \<br/>    -p 9090:9090 \<br/>    -v /path/to/prometheus.yml:/etc/prometheus/prometheus.yml \<br/>    prom/prometheus</span></pre><p id="c8c2" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">然而，由于这是一个<strong class="jf hj">多容器应用程序</strong>并且有许多运行时参数，使用docker-compose配置会更聪明。</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="aac9" class="ls ig hi lo b fi lt lu l lv lw">apt install docker-compose</span></pre><p id="185f" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">所以让我们安装docker-compose并创建一个YAML文件来处理我们的容器运行时。</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="991e" class="ls ig hi lo b fi lt lu l lv lw">vi docker-compose.yml</span></pre><p id="7846" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">让我们将以下内容添加到配置文件中，以设置多容器应用程序:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="fe32" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">如果你想知道更多关于每一个字段实际上是做什么的，我推荐阅读普罗米修斯和T2节点导出器的文档。</p><h1 id="ad9e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">创建Prometheus配置文件，然后运行容器</h1><p id="a27b" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在我们必须配置Prometheus来收集我们的节点导出器的指标。</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="ae1e" class="ls ig hi lo b fi lt lu l lv lw">vi prometheus.yml</span></pre><p id="0183" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">创建一个prometheus.yml文件，并将以下内容添加到其中:</p><figure class="kc kd ke kf fd kg"><div class="bz dy l di"><div class="ly lz l"/></div></figure><p id="2311" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">非常重要的一点是，你的目标是你的集装箱的名称，后跟它将监听的港口:<container_name: port=""/></p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="819c" class="ls ig hi lo b fi lt lu l lv lw">docker-compose up -d</span></pre><p id="7b35" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">在运行时，Compose会将单个prometheus.yml文件复制到我们的容器中。接下来，运行docker ps以确保容器正在运行。您应该得到以下输出:</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ma"><img src="../Images/bdd5eb4f327e711884ae7307cf7e6a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo422Lx-aI0uIElVgU_P2w.png"/></div></div></figure><p id="9f23" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">Compose还将为我们的应用程序设置默认网络。每个容器都加入该网络，并且可以被该网络上的其他容器访问，并且可以通过与该容器名称相同的主机名被它们发现。</p><h1 id="ff96" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">使用Prometheus作为数据源，将指标引入Grafana</h1><p id="fa0a" class="pw-post-body-paragraph jd je hi jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hb bi translated">现在，如果您的主要目标是将Prometheus和Node Exporter设置为容器，那么您可以到此为止。你可以在浏览器中输入你的服务器的IP地址，然后输入端口9090(<a class="ae la" href="http://45.79.207.223:9090/graph?g0.expr=&amp;g0.tab=1&amp;g0.stacked=0&amp;g0.show_exemplars=0&amp;g0.range_input=1h" rel="noopener ugc nofollow" target="_blank">http://45.79.207.223:9090</a>/)。这将把您带到Prometheus的默认React仪表板，在那里您可以使用PromQL查询指标。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mb"><img src="../Images/5ef095b3c81a934d8645d8afd8a4db5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tmXTOQAlHI5PKL9tAcPrDQ.png"/></div></div></figure><p id="74c7" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">然而，这些服务通常与Grafana等工具结合使用，以更好地阐明我们收到的指标。</p><p id="57c4" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">让我们在您的<strong class="jf hj">本地机器</strong>上运行Grafana作为Docker映像，并为信息存储指定一个卷。</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="7acc" class="ls ig hi lo b fi lt lu l lv lw"># create a persistent volume for your data in /var/lib/grafana <br/>docker volume create grafana-storage</span><span id="5792" class="ls ig hi lo b fi lx lu l lv lw"># start grafana<br/>docker run -d -p 3000:3000 --name=grafana -v grafana-storage:/var/lib/grafana grafana/grafana</span></pre><p id="0c49" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">转到您机器上的localhost:3000，使用“admin”作为用户名和密码登录。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es ll"><img src="../Images/692064cf365c27acbccb3ace45ae8dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNkGywyeU0rbKQPmPFNmzA.png"/></div></div></figure><p id="3816" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">然后导航到数据源，并单击添加新数据源。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mc"><img src="../Images/3e7339ed4732f158113166d3e353565c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-nqdjV0_4LrdkQ4e7iyLzA.png"/></div></div></figure><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es md"><img src="../Images/2ebe550802186f1ea3326a75fbc5992e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E529H_oE3CNKvj0F7ZVQKQ.png"/></div></div></figure><p id="5919" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">选择Prometheus，您将看到一个配置数据源的页面。你需要得到你的服务器的公共IP地址。重新登录到您的服务器，并输入以下命令:</p><pre class="kc kd ke kf fd ln lo lp lq aw lr bi"><span id="1c47" class="ls ig hi lo b fi lt lu l lv lw">hostname -I<br/># 45.79.207.223 172.17.0.1 172.20.0.1 2600:3c02::f03c:92ff:fe54:25ee</span></pre><p id="a931" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">复制第一个IP地址45.79.207.223，因为这是一个将被Grafana用来针对普罗米修斯。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es me"><img src="../Images/8e6175e46d2bacff826de64265413729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uzMwuYeqzYQMdvrOLVu_FA.png"/></div></div></figure><p id="78f5" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">输入完整的URL作为<a class="ae la" href="http://45.79.207.223" rel="noopener ugc nofollow" target="_blank">http://45.79.207.223</a>:9090，并确保访问设置为服务器。向下滚动并将您的HTTP方法设置为post。然后单击save &amp; test，您应该会看到一个横幅，说明数据源正在工作。</p><p id="332d" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">最后一步是配置我们实际的仪表板。为此，我们将使用专门设计的<a class="ae la" href="https://grafana.com/grafana/dashboards/13978" rel="noopener ugc nofollow" target="_blank">预构建仪表板</a>来显示节点导出器指标。</p><p id="5bca" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">导航至仪表板&gt;管理并选择导入。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mf"><img src="../Images/468edfc137f9b60230160e6b1baf2741.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pksTCrXI16KNlOCpXx-nsQ.png"/></div></div></figure><p id="83e9" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">13978是节点导出器快速启动仪表板的ID。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es me"><img src="../Images/4e3af619de1f6fb24b2efc253159f7f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFQYgdMdTFd3XWDzVnG0Ew.png"/></div></div></figure><p id="a25e" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">在这里填写你想要的任何信息。我将坚持使用生成的默认值。</p><figure class="kc kd ke kf fd kg er es paragraph-image"><div role="button" tabindex="0" class="kh ki di kj bf kk"><div class="er es mb"><img src="../Images/a957a4b833681a12eeb83c1ba1ce4988.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMtqV6kD5rQMTFrIU9df2Q.png"/></div></div></figure><p id="96f6" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">我们做到了！我们正在查看佐治亚州亚特兰大的一台计算机的硬件指标。</p><p id="e413" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">我希望这个简短的指南对你有所帮助。在我自己的搜索过程中，我发现在将这两个服务部署为容器而不是守护进程时，缺乏有见地的文档。</p><p id="5c1d" class="pw-post-body-paragraph jd je hi jf b jg lg ji jj jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka hb bi translated">也许在未来的教程中，我会向您展示如何使用Ansible playbook在多个服务器上部署这些容器。</p></div></div>    
</body>
</html>