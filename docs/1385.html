<html>
<head>
<title>Optimizing and Monitoring a Trading System with Quantiacs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Quantiacs优化和监控交易系统</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/optimizing-and-monitoring-a-trading-system-with-quantiacs-5ba099a16609?source=collection_archive---------8-----------------------#2021-03-16">https://medium.com/nerd-for-tech/optimizing-and-monitoring-a-trading-system-with-quantiacs-5ba099a16609?source=collection_archive---------8-----------------------#2021-03-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="d786" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">在本文中，我们描述了我们为</em><a class="ae je" href="http://www.quantiacs.com" rel="noopener ugc nofollow" target="_blank"><em class="jd">quanti ACS</em></a><em class="jd">Python工具箱发布的新工具的实现:一个用于测试交易系统健壮性的快速优化器。</em></p><p id="de2d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">正如Donald Knuth指出的，“过早优化是万恶之源。”这是软件开发人员的一句名言，在交易系统开发中也是如此。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/9c1cc69bc074de5d350151663c6c9c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZwQ3ZKff44MesgyrNOoA0w.jpeg"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">杰斐逊·桑托斯在<a class="ae je" href="https://unsplash.com/s/photos/software-development?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="13e6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">写一个算法，一个简单的趋势跟踪策略，或者一个更精确的基于机器学习的系统，然后搜索最优参数，通常是夏普比率，通常是T21。</p><p id="736e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">由于最佳参数是最大化过去选择的得分函数，并且金融数据非常嘈杂，参数优化的通常结果是<strong class="ih hj">过度拟合</strong>:交易系统对过去的数据工作得如此之好，以至于它对预测未来的市场走势变得无用。</p><p id="b498" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">夸大交易系统模拟性能的问题不仅限于回溯测试优化:例如，开发人员倾向于只关注和报告他们尝试的所有模型的积极结果，这个问题被称为选择偏差。关于这些问题的详细描述，我们可以参考Marcos Lopez de Prado2014年的文章。</p><p id="a1dd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然而，优化程序依赖于一个基本的功能，这个功能可以用来测试交易系统的<a class="ae je" href="https://en.wikipedia.org/wiki/Robust_statistics" rel="noopener ugc nofollow" target="_blank">健壮性</a>:对系统可能的参数组合进行<strong class="ih hj">网格扫描。扫描的结果可用于可视化和测试交易系统的性能对参数选择的敏感程度。一个<strong class="ih hj">健壮的</strong>系统对于大范围的独立参数将具有良好的夏普比率。</strong></p><h1 id="5614" class="jv jw hi bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">基于Quantiacs的交易系统优化</h1><p id="b03b" class="pw-post-body-paragraph if ig hi ih b ii kt ik il im ku io ip iq kv is it iu kw iw ix iy kx ja jb jc hb bi translated">您可以在您客户的发展领域的示例部分找到我们的优化器:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ky"><img src="../Images/4e3f1136ab6c9a98cb48d37266a66ffc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3YHeFz1JFLAoN86FNGSbQ.png"/></div></div></figure><p id="d319" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要运行该示例，只需单击克隆按钮，并在您最喜欢的环境中工作，Jupyter笔记本或JupyterLab。或者，您可以<a class="ae je" href="https://quantiacs.com/documentation/en/user_guide/local_development.html" rel="noopener ugc nofollow" target="_blank">在本地下载Quantiacs工具箱</a>，并在您自己的机器上利用<strong class="ih hj">并行化</strong>。</p><p id="a691" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们分析一下代码。首先，我们导入所需的库:</p><pre class="jg jh ji jj fd kz la lb lc aw ld bi"><span id="ed6e" class="le jw hi la b fi lf lg l lh li"><strong class="la hj">import</strong> qnt.data <strong class="la hj">as</strong> qndata<br/><strong class="la hj">import</strong> qnt.ta <strong class="la hj">as</strong> qnta<br/><strong class="la hj">import</strong> qnt.output <strong class="la hj">as</strong> qnout<br/><strong class="la hj">import</strong> qnt.stats <strong class="la hj">as</strong> qns<br/><strong class="la hj">import</strong> qnt.log <strong class="la hj">as</strong> qnlog<br/><strong class="la hj">import</strong> qnt.optimizer <strong class="la hj">as</strong> qnop<br/><strong class="la hj">import</strong> qnt.backtester <strong class="la hj">as</strong> qnbt<br/><br/><strong class="la hj">import</strong> xarray <strong class="la hj">as</strong> xr</span></pre><p id="acf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了在我们的<a class="ae je" href="https://github.com/Quantiacs" rel="noopener ugc nofollow" target="_blank"> GitHub页面</a>上免费提供的Quantiacs库，我们还导入了<a class="ae je" href="http://xarray.pydata.org/en/stable/" rel="noopener ugc nofollow" target="_blank"> xarray </a>来快速处理多维数据结构。</p><p id="f180" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们基于两个参数定义一个简单的交易规则。只有当线性加权移动平均线在过去<code class="du lj lk ll la b">wma_period</code>个交易日(在本例中为20个交易日)的最后<code class="du lj lk ll la b">roc_period</code>个交易日(在本例中为10个交易日)的变化率为正值时，该策略才会做多:</p><pre class="jg jh ji jj fd kz la lb lc aw ld bi"><span id="6abb" class="le jw hi la b fi lf lg l lh li"><strong class="la hj">def</strong> single_pass_strategy(data, wma_period<strong class="la hj">=</strong>20, roc_period<strong class="la hj">=</strong>10):<br/>    wma <strong class="la hj">=</strong> qnta<strong class="la hj">.</strong>lwma(data<strong class="la hj">.</strong>sel(field<strong class="la hj">=</strong>'close'), wma_period)<br/>    sroc <strong class="la hj">=</strong> qnta<strong class="la hj">.</strong>roc(wma, roc_period)<br/>    weights <strong class="la hj">=</strong> xr<strong class="la hj">.</strong>where(sroc <strong class="la hj">&gt;</strong> 0, 1, 0)<br/>    weights <strong class="la hj">=</strong> weights <strong class="la hj">/</strong> len(data<strong class="la hj">.</strong>asset)<br/>    <strong class="la hj">with</strong> qnlog<strong class="la hj">.</strong>Settings(info<strong class="la hj">=False</strong>, err<strong class="la hj">=False</strong>):<br/>        weights <strong class="la hj">=</strong> qnout<strong class="la hj">.</strong>clean(weights, data, debug<strong class="la hj">=False</strong>)<br/>    <strong class="la hj">return</strong> weights</span></pre><p id="8af2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该策略返回每天的分配权重(要投资的资本部分)。我们使用选择的参数来检查该策略的性能:</p><pre class="jg jh ji jj fd kz la lb lc aw ld bi"><span id="2f81" class="le jw hi la b fi lf lg l lh li">data <strong class="la hj">=</strong> qndata<strong class="la hj">.</strong>futures<strong class="la hj">.</strong>load_data(min_date<strong class="la hj">=</strong>'2004-01-01')<br/>single_pass_output <strong class="la hj">=</strong> single_pass_strategy(data)<br/>single_pass_stat <strong class="la hj">=</strong> qns<strong class="la hj">.</strong>calc_stat(data,\<br/>    single_pass_output<strong class="la hj">.</strong>sel(time<strong class="la hj">=</strong>slice('2006-01-01', <strong class="la hj">None</strong>)))<br/>display(single_pass_stat<strong class="la hj">.</strong>to_pandas()<strong class="la hj">.</strong>tail())</span></pre><p id="2b15" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该代码在表格中返回自样本期开始以来的相关统计指标值，包括夏普比率:</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lm"><img src="../Images/d6b1615f4a7939b83788f6e52304be07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KFp0KBqYsHnrsR_T9p9wZA.png"/></div></div></figure><p id="3848" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们运行<strong class="ih hj">优化代码</strong>，它在预定义的参数值范围内执行扫描:用户可以为每个参数选择起始值、最终值和步长:</p><pre class="jg jh ji jj fd kz la lb lc aw ld bi"><span id="bc2b" class="le jw hi la b fi lf lg l lh li">data <strong class="la hj">=</strong> qndata<strong class="la hj">.</strong>futures<strong class="la hj">.</strong>load_data(min_date<strong class="la hj">=</strong>'2004-01-01')<br/><br/>result <strong class="la hj">=</strong> qnop<strong class="la hj">.</strong>optimize_strategy(<br/>    data,<br/>    single_pass_strategy,<br/>    qnop<strong class="la hj">.</strong>full_range_args_generator(<br/>        wma_period<strong class="la hj">=</strong>range(10, 150, 5), <em class="jd"># min, max, step</em><br/>        roc_period<strong class="la hj">=</strong>range(5, 100, 5)   <em class="jd"># min, max, step</em><br/>    ),<br/>    workers<strong class="la hj">=</strong>1 <em class="jd"># you can set more workers on your PC</em><br/>)<br/><br/>qnop<strong class="la hj">.</strong>build_plot(result)<br/><br/>print("---")<br/>print("Best iteration:")<br/>display(result['best_iteration'])</span></pre><p id="0370" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码返回一个<strong class="ih hj">交互式</strong>图，用户可以在其中分析关键统计指标对参数的依赖性。在该图中，我们在x和y轴上显示两个独立的参数，在z轴上显示夏普比率值，并根据最大压降使用不同的颜色。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ln"><img src="../Images/bdc4c5e40500dcda18731d07d7c95b11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LL3ZgkSGR7gpkMsCGIN4tw.png"/></div></div></figure><p id="e53c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">作为参考，我们显示了使夏普比率最大化的参数的最佳值(小心过度拟合！):</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lo"><img src="../Images/a4ba53bb4601fe6c3cc4d650789bbcc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*W8B_mJdz_jhTYa6HsHIL1Q.png"/></div></div></figure><p id="3ac8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">一个稳健的交易系统将具有夏普比率对参数值的平滑依赖性，理想地，对于广泛的参数选择，具有大于1的良好值。对于独立参数的特定选择，过度拟合的系统通常会显示夏普比率峰值。</p><p id="f8d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">你有问题或建议吗？张贴在我们的<a class="ae je" href="https://quantiacs.com/community/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj">论坛</strong> </a>或写信给我们【info@quantiacs.com】<a class="ae je" href="mailto:info@quantiacs.com" rel="noopener ugc nofollow" target="_blank">！</a></p><p id="2ba4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在<a class="ae je" href="http://www.quantiacs.com" rel="noopener ugc nofollow" target="_blank"> Quantiacs </a>上尝试优化器。代码可以在您帐户的<strong class="ih hj">开发</strong>区域的<strong class="ih hj">示例</strong>部分找到。或者你可以<strong class="ih hj">从我们的<a class="ae je" href="https://github.com/quantiacs/strategy-futures-ta-global-optimizer/blob/master/strategy.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub库</a>下载完整代码</strong>。</p></div></div>    
</body>
</html>