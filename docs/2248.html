<html>
<head>
<title>10 tips to make a good Code Review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">做好代码评审的10个技巧</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/10-tips-to-make-a-good-code-review-2401f7e38790?source=collection_archive---------6-----------------------#2021-04-28">https://medium.com/nerd-for-tech/10-tips-to-make-a-good-code-review-2401f7e38790?source=collection_archive---------6-----------------------#2021-04-28</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/507ba4be63a78cb55b5f6e9d66498020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2r2fFR4WrUDlk2hm"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">李·坎贝尔在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="3a84" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在我4年的软件开发工作中，我已经做了数百次代码审查，这种在日常工作中反复出现的实践促使我创建了某种清单，列出了我必须对每个拉取请求进行评估的内容，以便判断某些代码是否适合投入生产环境。</p><p id="3c86" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">本文并不打算成为如何进行代码评审的“圣经”,因为我知道其他开发人员所做的许多其他实践与我将要列出的一样重要，但是它打算成为开始评审团队代码的人的基本指南。</p><p id="325f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">话虽如此，以下是我关于如何做好代码评审的建议:</p><p id="bf30" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 1。代码必须工作</strong></p><p id="ec15" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">拥有一个写得很好很漂亮却不能工作的代码是没有意义的。因此，当审查代码时，我喜欢评估的第一件事是代码是否工作，因为如果提交代码的开发人员不确切理解代码应该如何工作，所有其他必要的更改都将没有价值。</p><p id="2d72" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，每个软件开发人员都知道，开发软件并不总是一帆风顺的，有时为了更快地向客户交付价值，必须接受一些技术债务。因此，在这些情况下，代码审查的重点必须是代码的正常运行，而不是其他任何方面。</p><p id="67e9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 2。代码必须遵循编码良好实践</strong></p><p id="a29c" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">编码良好实践将您的代码标准化，因此它更容易理解，任何人都可以阅读和理解它。有一些独立于编程语言的全球流行的良好实践，例如DRY(不要重复自己)、SOLID、KISS(保持简单，笨蛋！)、YAGNI(你不会需要它)、注释不明显的代码行、不使用神奇的数字等等。</p><p id="f539" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">然而，编程语言还有其他固有的良好实践，因此代码也必须相应地进行评估。这些实践通常与变量和类的命名约定、缩进、换行符、代码文档、成员声明、语法、成员初始化以及其他方面有关。</p><p id="d00d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">考虑到这些好的实践来评审代码将会对你和将来可能接触你的代码的其他人有所帮助。</p><p id="46a6" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 3。代码必须遵循应用程序的模式</strong></p><p id="f3b7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在大多数情况下，代码将在应用程序的架构已经被选择或者至少被最小限度地讨论之后被提交审查。</p><p id="2b40" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，为了保持代码的组织性，每个开发人员遵循代码的现有组织是很重要的，因此不会创建许多具有相同含义的名称。</p><p id="95ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，让我们假设正在审查的应用程序有一个名为<em class="jt"> /utils </em>的文件夹，它是可以在整个应用程序中使用的通用函数所在的位置。在这种情况下，具有相同目标的函数必须放在同一个目录中，以便代码保持有组织和简洁。</p><p id="2793" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当然，如果提交的代码是代码重构，预计一些组织和命名可能会发生变化。在这种情况下，重要的是整个团队同意可能被建议的新术语。</p><p id="c0fb" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 4。日志也值得关注</strong></p><p id="3724" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当构建软件时，出错的场景也必须被考虑，因为你需要能够发现在生产环境中发生了什么。有一些方法可以做到这一点，最好的方法之一是使用日志记录。</p><p id="db57" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当检查代码时，确保日志消息是一致的，并且可以理解，以便于理解执行了哪个进程。此外，在出现异常的情况下，确保日志向您准确显示发生了什么以及发生在哪里，这样调试就可以更加精确。</p><p id="bff4" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，请记住，当主题是应用程序的日志记录时，想法并不总是“越多越好”。如果日志仍然写在文本文件中，很快您可能会遇到存储问题。如果您将日志发送到某个平台，如Splunk、Kibana或DataDog，您可能会遇到一些成本问题。</p><p id="60e7" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，要确保只记录必要的东西，用它来创造智慧会更容易、更便宜。</p><p id="1a94" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 5。测试您的代码</strong></p><p id="fbb8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">根据应用程序的编码方式，测试它可能会非常困难，这使得在生产环境中部署bug变得更加容易。因此，代码评审必须保证代码是可测试的，并且有相关的测试。</p><p id="5877" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">一些结构的错误使用，如静态方法、抽象类和全局状态，以及缺乏依赖注入，可能会降低代码的可测试性，因此了解它们是否被正确使用是很重要的。</p><p id="84d0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">此外，许多人过于担心代码覆盖率，而不太关心所执行测试的相关性。代码覆盖率很重要，但是要关注测试必须覆盖的许多场景，因为同一个代码块可能有许多可能的行为，因此需要许多不同的测试。</p><p id="abba" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 6。不要忘记基础设施</strong></p><p id="175a" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在审查代码时，还必须考虑应用程序的基础设施，因为计划不周的实现可能会由于基础设施的影响而导致代码故障。</p><p id="5248" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">例如，假设应用程序在一个容器中运行，预计它的CPU和RAM内存比虚拟机少。因此，更鼓励更好地利用资源。在这种情况下，如果要检查的实现涉及一个获取一些数据的新端点，则必须考虑数据库查询可以返回多少行。如果因为从一个域表中获取数据而期望它最多返回10行，那么没有理由担心，但是如果它可能返回数千或数百万行，为了不使用太多的RAM内存，分页端点可能是一个很好的方法。</p><p id="25f2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">更多地考虑数据库环境，想象一个新开发的特性，它在数据库中运行一个新的查询并接收许多连接，但是它的同源是针对几个要查询的行，而实际上在生产环境中它可以处理数百万行。在这种情况下，由于查询没有在实际场景中进行测试，因此它会使用数据库的大部分服务器资源，并影响来自其他应用程序的其他查询。</p><p id="e6b8" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">7.<strong class="ix hj">观察您应用的指标</strong></p><p id="15e0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当开发应用程序以更快地向客户交付价值时，监控可能不是首要任务，因为它可能涉及额外的运营和资金成本。然而，在软件生命周期的某个时间点，必须监控RAM内存、吞吐量、可用性、进程运行时间、错误、处理量等参数，以保持系统正常运行，在出现问题时向人们发出警报，或者仅显示数据。</p><p id="1c48" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">因此，检查开发的代码是否可监控是很重要的，也就是说，代码生成的数据可用于创建度量和智能。根据您使用的监控平台(New Relic、Splunk、Zabbix、Grafana等)，使用数据的方式会有所不同，因此您可能需要对所选平台有所了解。</p><p id="c79d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">总而言之，确保代码创建了与您的监控相关的有趣数据，这样您就能在客户之前知道问题发生了。</p><p id="5587" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 8。投资文件</strong></p><p id="f01d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开发软件的过程不仅仅是代码，还包括文档。它可能是UML图、业务需求、架构规范或一些其他类型的文档，但文档是软件生命周期中非常重要的一部分，因为它避免了返工，记录了旧的决策，帮助改进了应用程序并传播了知识。</p><p id="99ae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我知道，很难使文档保持最新，但是从长远来看，这样做的努力是值得的。</p><p id="499d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated"><strong class="ix hj"> 9。避免一次审查大量变更</strong></p><p id="c326" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当一个新特性涉及到大量的变更时，大量的代码被提交给代码评审是很常见的。谁从未审查过超过100个文件的拉取请求？</p><p id="950d" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">理想的方法是改进计划，这样大的变更可以被分解成小的可交付成果，但是如果一次进行大量的变更是绝对必要的，要求开发人员至少创建许多pull请求，将变更分成更多的部分，这样它们可以被单独审查。</p><p id="08c0" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这个建议的方法将有助于你组织回顾，并更加自信。</p><p id="9921" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">10。允许整个团队发表意见</p><p id="ef77" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">当审查代码时，不要试图按你的方式做事，要促进团队之间的讨论。证明要求改变的原因，但也询问团队的意见，好的见解可以由此而来，这为每个人创造了一个学习新东西的好机会。</p><p id="15fc" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">开发软件是一项集体工作，所以整个团队都需要参与其中。</p></div><div class="ab cl ju jv gp jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="hb hc hd he hf"><p id="3cea" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">嗯，我确信代码中有许多其他方面可以审查，这真的很大程度上取决于开发人员和每个公司创建的模式。然而，我希望这十个技巧可以成为帮助你更好地进行代码审查的基本指南。</p><p id="c01f" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">最后，很重要的一点是，这些技巧是基于我通过编写和审查大量代码而学到的十条经验，我在任何代码审查中都试图记住这些经验:</p><ol class=""><li id="5a74" class="kb kc hi ix b iy iz jc jd jg kd jk ke jo kf js kg kh ki kj bi translated">开发软件的主要目标是解决问题，所以你的代码必须这么做</li><li id="afbd" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">好的实践存在是有原因的，遵循它们</li><li id="ba47" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">事物的名称很重要</li><li id="e4f1" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">一个好的日志可以节省你很多时间</li><li id="fc90" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">测试每一个场景，这样您就可以确切地知道什么将进入生产环境</li><li id="ee63" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">开发软件时，必须考虑环境的每个细节</li><li id="0425" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">先于客户了解您的应用程序的问题</li><li id="710a" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">文档不是浪费时间</li><li id="0dc8" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">让拉取请求尽可能小</li><li id="1a2e" class="kb kc hi ix b iy kk jc kl jg km jk kn jo ko js kg kh ki kj bi translated">审查代码不仅仅是关于代码，也是关于人</li></ol></div></div>    
</body>
</html>