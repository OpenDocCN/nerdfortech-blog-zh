<html>
<head>
<title>An Introduction to DistSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DistSQL简介</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/intro-to-distsql-an-open-source-more-powerful-sql-bada4099211?source=collection_archive---------9-----------------------#2021-07-26">https://medium.com/nerd-for-tech/intro-to-distsql-an-open-source-more-powerful-sql-bada4099211?source=collection_archive---------9-----------------------#2021-07-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="1971" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们相信，如果你正在阅读这篇文章，那么你一定熟悉SQL(结构化查询语言)，这是一种数据查询和编程语言，也用作关系数据库管理系统的标准语言，用于访问数据、查询、更新和管理关系数据库系统。</p><p id="95ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">与标准SQL、DistSQL或分布式SQL类似，是ShardingSphere独有的内置SQL语言，提供了标准SQL之外的增量功能。利用ShardingSphere强大的SQL解析引擎，DistSQL提供了类似于标准SQL的语法结构和语法验证系统，使DistSQL更加灵活，同时保持了规律性。</p><p id="9cb4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ShardingSphere的Database Plus概念旨在创建一个开放源码的分布式数据库系统，该系统既实用又与实际的数据库业务相关。DistSQL构建在传统数据库之上，提供既符合标准又具有ShardingSphere功能的SQL功能，从而更好地激活传统数据库。</p><h2 id="d351" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">DistSQL的设计初衷</h2><p id="36b0" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">经过多年的快速发展，随着内核逐渐稳定，核心功能不断完善，ShardingSphere已经成为数据库中间件领域中独一无二的产品。作为亚洲尤其是中国的开源领导者，ShardingSphere并没有停止对分布式数据库生态系统的探索。</p><p id="0ec6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DistSQL的设计目标是重新定义中间件和数据库之间的界限，并允许开发人员像使用数据库一样使用Apache ShardingSphere。它也是ShardingSphere从面向开发者的框架和中间件转变为面向运营的基础设施产品的能力的一个组成部分。</p><h2 id="79be" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">DistSQL语法系统</h2><p id="d54b" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">考虑到数据库开发人员和操作人员的习惯，DistSQL从一开始就被设计成面向标准的。DistSQL的语法基于标准SQL语言，考虑到可读性和易用性，同时最大限度地保留了ShardingSphere自身的特性，并为用户提供了尽可能多的定制选项，以应对不同的业务场景。熟悉SQL和ShardingSphere的开发者可以快速上手。</p><p id="106f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">而标准SQL提供了不同类型的语法，如DQL、DDL、DML、DCL等。为了定义不同的函数SQL语句，DistSQL还定义了自己的语法系统。</p><p id="bf45" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在ShardingSphere中，DistSQL语法目前分为三种主要类型:RDL、RQL和RAL。</p><p id="544f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> RDL(资源&amp;规则定义语言)</strong>:用于创建、修改、删除资源和规则的资源规则定义语言。</p><p id="66e0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> RQL(资源&amp;规则查询语言)</strong>:资源规则查询语言，用于查询和展现资源和规则。</p><p id="0e7f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> RAL(资源&amp;规则管理语言)</strong>:提示、交易类型切换、分片执行计划查询等增量功能操作的资源规则管理语言。</p><p id="855c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DistSQL的语法为ShardingSphere走向分布式数据库搭建了一座桥梁，虽然随着更多想法的实现，它仍在不断改进，但DistSQL一定会变得更加强大。欢迎有兴趣的开发者加入ShardingSphere，为DistSQL贡献想法和代码。</p><p id="06ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">更详细的语法规则请参考官方文档:<a class="ae kd" href="https://shardingsphere.apache.org/document/current/cn/features/dist-sql/syntax/" rel="noopener ugc nofollow" target="_blank">https://sharding sphere . Apache . org/document/current/cn/features/dist-SQL/syntax/</a></p><p id="db46" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">项目社区请参考Slack官方频道:<a class="ae kd" href="https://join.slack.com/t/apacheshardingsphere/shared_invite/zt-sbdde7ie-SjDqo9~I4rYcR18bq0SYTg" rel="noopener ugc nofollow" target="_blank">https://join . Slack . com/t/Apache shardings sphere/shared _ invite/ZT-sbd de 7 ie-sjd qo 9 ~ I 4 rycr 18 bq 0 sytg</a></p><h2 id="1a60" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">实践中的DistSQL</h2><p id="43b5" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">了解了DistSQL的设计理念和语法体系，下面以数据分片为例，演示如何基于ShardingSphere构建数据分片服务。</p><h2 id="1a2b" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">环境准备:</h2><ol class=""><li id="30f7" class="ke kf hi ih b ii jy im jz iq kg iu kh iy ki jc kj kk kl km bi translated">启动MySQL服务</li><li id="6614" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">为分片创建一个MySQL数据库</li><li id="e841" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">启动动物园管理员服务</li><li id="ba2a" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">打开分布式治理配置并启动sharding sphere-Proxy(https://sharding sphere . Apache . org/document/current/cn/quick-start/sharding sphere-Proxy-quick-start/)</li></ol><h2 id="211c" class="jd je hi bd jf jg jh ji jj jk jl jm jn iq jo jp jq iu jr js jt iy ju jv jw jx bi translated">实际演示:</h2><ol class=""><li id="cbcb" class="ke kf hi ih b ii jy im jz iq kg iu kh iy ki jc kj kk kl km bi translated">使用MySQL命令行连接到启动的ShardingSphere-Proxy</li><li id="8a8c" class="ke kf hi ih b ii kn im ko iq kp iu kq iy kr jc kj kk kl km bi translated">创建和查询分布式数据库<code class="du ks kt ku kv b">sharding_db</code></li></ol><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es kw"><img src="../Images/178b5c45dcbc81e2468740a4bf4525ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3vAhLoJbAFGsXViF"/></div></div></figure><p id="6e69" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">3.使用新创建的数据库</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es li"><img src="../Images/61b2365e777a86a7ccf011537cb76662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xYEFj4HtH1xtXzAU"/></div></div></figure><p id="4aa6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.执行RDL为分片配置2个数据源资源<code class="du ks kt ku kv b">ds_1</code>和<code class="du ks kt ku kv b">ds_2</code></p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lj"><img src="../Images/32a3ee94e31c0811a7b28d2a4ea4f7f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WgMJZcWENaKV_DQQovRLqw.jpeg"/></div></div></figure><p id="f789" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">5.执行RQL来查询新添加的数据源资源</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lk"><img src="../Images/3533bbf0bf605eae3707d6635f27a7cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kb95t6r5ZOBsP4iPDGbjSg.jpeg"/></div></div></figure><p id="a30f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.执行RDL为<code class="du ks kt ku kv b">t_order</code>表创建一个分片规则</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ll"><img src="../Images/2745bd53530c772cd46310ede187254b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NZEFxk2R0nZuX8nc"/></div></div></figure><p id="1608" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.执行RQL来查询分片规则</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ll"><img src="../Images/e52a94f21ff71019352698ab7d8b0f21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cCdpKsQq1puEbOg5"/></div></div></figure><p id="f82d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了查询当前数据库下的所有分片规则，RQL还可以使用下面的语句<code class="du ks kt ku kv b">SHOW SHARDING TABLE RULE t_order FROM sharding_db</code>查询各个表的分片规则</p><ul class=""><li id="4e8b" class="ke kf hi ih b ii ij im in iq lm iu ln iy lo jc lp kk kl km bi translated">创建和查询<code class="du ks kt ku kv b">t_order</code>分片表</li></ul><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lq"><img src="../Images/6dbe61a1ceffb80a67f3fb8469247663.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lGMyGQ1uFFhjZ2VF"/></div></div></figure><ul class=""><li id="366d" class="ke kf hi ih b ii ij im in iq lm iu ln iy lo jc lp kk kl km bi translated">在sharing sphere-Proxy端成功创建分片表<code class="du ks kt ku kv b">t_order</code>后，sharing sphere通过客户端连接底层数据库<code class="du ks kt ku kv b">ds_1</code>和<code class="du ks kt ku kv b">ds_2</code>，根据<code class="du ks kt ku kv b">t_order</code>表的分片规则自动创建分片表。</li></ul><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lr"><img src="../Images/0f44c07fc771e79e855304cc56e3d4bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TFSg3n1KplzzKijl"/></div></div></figure><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ls"><img src="../Images/bff8f1ade3c1bf064f7141f767e552f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*COj7EQLUtGCUxMnY"/></div></div></figure><ul class=""><li id="5dd4" class="ke kf hi ih b ii ij im in iq lm iu ln iy lo jc lp kk kl km bi translated">一旦创建了分片表，就继续在sharing sphere-Proxy端执行SQL语句来插入数据</li></ul><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lt"><img src="../Images/87b95a7b25dc152554b3bbba90ffa889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*onUXalKs9RRGKfC8"/></div></div></figure><ul class=""><li id="c7d7" class="ke kf hi ih b ii ij im in iq lm iu ln iy lo jc lp kk kl km bi translated">通过RAL查询执行计划</li></ul><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ll"><img src="../Images/e21c653403c254dbda397e1215c93827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CdK5ESHZ8gzSHdPR"/></div></div></figure><p id="8078" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这就完成了使用DistSQL的ShardingSphere数据分片服务。与以前版本的配置文件驱动的ShardingSphere代理相比，DistSQL在管理资源和规则方面对开发人员更加友好，也更加灵活。此外，SQL驱动的方法支持DistSQL和标准SQL之间的无缝接口。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ll"><img src="../Images/38cee5c254ab9652a7e27458a4671c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*07xo2CGfVEEbEjJa"/></div></div></figure><p id="c9d5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的例子中，只演示了DistSQL语法的一小部分。除了通过<code class="du ks kt ku kv b">CREATE</code>和<code class="du ks kt ku kv b">SHOW</code>语句创建和查询资源和规则，DistSQL还提供了<code class="du ks kt ku kv b">ALTRE DROP</code>等附加操作，支持数据分片核心功能的配置控制、读写分离、数据加密和数据库发现。</p><h1 id="d286" class="lu je hi bd jf lv lw lx jj ly lz ma jn mb mc md jq me mf mg jt mh mi mj jw mk bi translated">结论</h1><p id="bf22" class="pw-post-body-paragraph if ig hi ih b ii jy ik il im jz io ip iq ka is it iu kb iw ix iy kc ja jb jc hb bi translated">作为Apache sharding sphere 5 . 0 . 0-beta中发布的新特性之一，DistSQL将继续在此版本的基础上提供改进的语法和日益强大的功能。</p><p id="95a0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">DistSQL为ShardingSphere在分布式数据库领域的探索开辟了无限可能，未来DistSQL将作为一个纽带连接更多功能，提供一键操作。比如我们会一键分析数据库整体状态，弹性迁移连接，提供一键数据伸缩，control连接，实现一键主从切换，改变数据库状态。</p><p id="11de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们热烈欢迎开源和Java脚本爱好者加入我们的Slack社区或查看我们的GitHub来了解更多关于ShardingSphere的最新发展。</p><h1 id="59fb" class="lu je hi bd jf lv lw lx jj ly lz ma jn mb mc md jq me mf mg jt mh mi mj jw mk bi translated">作者</h1><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es ml"><img src="../Images/41b487f58fab852954e0a89f875f81dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/format:webp/1*fIPA7uivjCbjD_xJaW-9Fg.jpeg"/></div></figure><p id="d477" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">孟浩然</strong></p><p id="2f3d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mm">spherex高级Java工程师</em></p><p id="87ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="mm"> Apache ShardingSphere提交者</em></p><p id="6f5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">他之前在京东科技负责数据库产品R&amp;D，对开源和数据库生态系统充满热情。目前，他专注于ShardingSphere数据库中间件生态系统的开发和开源社区建设。</p><p id="370c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">sharding sphere Github:<a class="ae kd" href="https://github.com/apache/shardingsphere" rel="noopener ugc nofollow" target="_blank">https://github.com/apache/shardingsphere</a></p><p id="37de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">推特:<a class="ae kd" href="https://twitter.com/ShardingSphere" rel="noopener ugc nofollow" target="_blank">https://twitter.com/ShardingSphere</a></p><p id="f613" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">ShardingSphere松弛通道:<a class="ae kd" href="https://bit.ly/3qB2GGc" rel="noopener ugc nofollow" target="_blank">https://bit.ly/3qB2GGc</a></p><p id="229e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浩然的Github:<a class="ae kd" href="https://github.com/menghaoranss" rel="noopener ugc nofollow" target="_blank">https://github.com/menghaoranss</a></p><p id="0d54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">浩然的推特:<a class="ae kd" href="https://twitter.com/HaoranMeng2" rel="noopener ugc nofollow" target="_blank">https://twitter.com/HaoranMeng2</a></p></div></div>    
</body>
</html>