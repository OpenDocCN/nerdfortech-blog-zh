<html>
<head>
<title>How to prepare time series data for LSTM/RNN? (Data windowing)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何准备LSTM/RNN的时间序列数据？(数据窗口)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-prepare-time-series-data-for-lstm-rnn-data-windowing-8d44b63a29d5?source=collection_archive---------3-----------------------#2021-05-18">https://medium.com/nerd-for-tech/how-to-prepare-time-series-data-for-lstm-rnn-data-windowing-8d44b63a29d5?source=collection_archive---------3-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="38b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">当我们处理LSTM或RNN模型时，我们经常使用多步输入。比如我们拿这个流行的天气数据<a class="ae jd" href="https://www.kaggle.com/gayathrirprog/jena-climate-from-2009-to-2016" rel="noopener ugc nofollow" target="_blank">【耶拿_气候】</a>。该数据集是时间序列数据，每隔10分钟测量一次。你可以在我的<a class="ae jd" href="https://github.com/pinakin9526/medium_01" rel="noopener ugc nofollow" target="_blank"> Github </a>找到完整的Jupyter笔记本。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/4d2f830d620e20b37df614c84a6d6afa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nc_ckJOguRpB-9TBWGgeeQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">耶拿气候数据</figcaption></figure><p id="d329" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这里，除了将Date time列转换为datetime64类型并使其成为索引之外，我不会对数据进行任何处理。然后通过取第一个值，将其重新采样为每小时的样本聚集数据。这种重采样是完全可选的，因为我只是减少了数据。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ju"><img src="../Images/acba5d175f5f8c2157cb0aed29a5efb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PE94H0WjFpw6ECVPQLSyUQ.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx translated">将日期时间列作为索引并重新采样后的数据</figcaption></figure><p id="6d92" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我必须建立一个LSTM模型，该模型采用过去30个样本(即本例中过去30小时的数据)，并预测接下来5个样本(即本例中接下来5个小时)的一些或所有参数。</p><p id="dd0a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">或者，输入来自<strong class="ih hj"> t-30，t-29，t-28，…，t-1 </strong>处的样本，输出来自<strong class="ih hj"> t，t+1，t+2，t+3，t+4 </strong>处的样本。</p><p id="c0c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">此外，有人可能需要预测5个样本，但不是立即预测，而是延迟一段时间，例如3小时后的下5个样本。这意味着输入是在<strong class="ih hj"> t-30，t-29，t-28，…，t-1 </strong>的样本，输出是<strong class="ih hj"> t+3，t+4，t+5，t+6 </strong>和<strong class="ih hj"> t+7 </strong>。</p><p id="4636" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让<strong class="ih hj"> l、m </strong>和<strong class="ih hj"> n </strong>分别作为<strong class="ih hj">延迟</strong>、<strong class="ih hj">延迟</strong>和<strong class="ih hj">下一步</strong>。</p><p id="d28e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，输入将是来自<strong class="ih hj">t-1，t-1+1，t-1+2，…，t-1 </strong>的样本，输出是来自<strong class="ih hj"> t+m，t+m+1，…，t+m+n-1 </strong>的样本。</p><p id="3ca3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，LSTM输入的一个示例将具有<strong class="ih hj"> (1，l，d) </strong>的形状，并且输出形状将具有<strong class="ih hj"> (1，n，d) </strong></p><p id="d386" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<strong class="ih hj"> d </strong> =数据的维度(即数据中的列数)</p><p id="c417" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，如果数据中总共有<strong class="ih hj"> N </strong>个样本，那么整个数据集的输入和输出形状将分别为<strong class="ih hj"> (k，l，d) </strong>和<strong class="ih hj"> (k，N，d) </strong>。</p><p id="16ac" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中，<strong class="ih hj"> k = N-(l+m+n) </strong></p><p id="abe4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">有几种方法可以做到这一点，但是，其中一些方法非常慢，因为使用了for循环。如果你有非常大的数据，高维数据，那么速度会很慢。这里我们可以利用numpy的高级索引来加速这个过程。</p><p id="ce96" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，通过迭代整个数据矩阵，我们可以创建包含索引片段的矩阵。我从TensorFlow 文章的这个<a class="ae jd" href="https://www.tensorflow.org/tutorials/structured_data/time_series#data_windowing" rel="noopener ugc nofollow" target="_blank">时间序列示例中得到灵感，但它是使用TensorFlow编写的。</a></p><p id="3901" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了使用numpy，我们可以实现如下</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jv jw l"/></div></figure><p id="3be9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">我说的指数切片是什么意思？</strong></p><p id="11dc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">考虑之前的例子，我们必须制作数据，使得<strong class="ih hj"> l=30，m = 3，n = 5 </strong></p><p id="1dbf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这意味着第一个输入将包含从<strong class="ih hj"> 0到29 </strong>的样本，输出将包含从<strong class="ih hj"> 33到37 </strong>的样本。</p><p id="d747" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，下一个输入将包含来自<strong class="ih hj"> 1至30 </strong>的样本和来自<strong class="ih hj"> 34至38 </strong>的输出样本</p><p id="f00c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">诸如此类…</p><p id="923b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以创建两个矩阵作为索引，分别获取输入和输出矩阵的窗口数据。</p><p id="e8ca" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">以下是输入，它将具有<strong class="ih hj"> (k，l) </strong>的形状</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jx"><img src="../Images/c289194f945fa3bcfe9a7a6562b5f44a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*QEI0OkRM2knTJnSODadPHg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">输入切片</figcaption></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jv jw l"/></div></figure><p id="19f2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是输出，它将具有(k，n)的形状</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es jy"><img src="../Images/3a4772201deedbf09b320f86bf424efc.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*-EOlRkzu8xsIAjchE0WKxg.png"/></div><figcaption class="jq jr et er es js jt bd b be z dx translated">输出切片</figcaption></figure><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="jv jw l"/></div></figure><p id="7f81" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以使用这个2矩阵为我们的LSTM/RNN输入创建输入。</p><p id="cc1b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您有任何疑问或发现任何差异或任何错误，请随时评论。</p><p id="b4df" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">希望这篇文章能对你有所帮助，如果有，那就分享吧…</p></div></div>    
</body>
</html>