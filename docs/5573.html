<html>
<head>
<title>Combining Infrastructure as Code Software Tools to Create and Manage your Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">结合基础设施作为代码软件工具来创建和管理您的应用程序</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/combining-infrastructure-as-code-software-tools-to-manage-and-provision-your-application-652e75eba235?source=collection_archive---------3-----------------------#2021-10-18">https://medium.com/nerd-for-tech/combining-infrastructure-as-code-software-tools-to-manage-and-provision-your-application-652e75eba235?source=collection_archive---------3-----------------------#2021-10-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><blockquote class="if ig ih"><p id="db94" class="ii ij ik il b im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg hb bi translated">作为代码的基础设施通常是指在文本文件中定义的声明性模型中定义基础设施的实践。如果与DevOps文化相结合，这将对公司有很大的帮助，因为它使得以简单可靠的方式在整个基础架构中编辑和分发配置变得更加容易。我们提出了一种将多个基础设施组合成代码工具来管理和供应您的应用程序的方法。</p></blockquote><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/acdb76b1702ef6b9e4eac18eb9db4a7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B8ydbmpXsRd51QzRnJve_g.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">信用:<a class="ae jx" href="https://bridgecrew.io/infrastructure-as-code-security/" rel="noopener ugc nofollow" target="_blank"> bridgecrew </a></figcaption></figure><p id="4459" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">基础设施即代码(IaC)是一种自动配置IT基础设施的方式。IaC使用一种高级描述性编码语言，旨在自动提供应用程序基础设施。这消除了开发人员手动配置和管理服务器、存储和云服务的需要。</p><p id="b1b0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">IaC概念非常类似于编程脚本。两者都实现了流程的自动化，但它们在调配和部署流程的能力上有所不同，这些流程更加通用，更能适应不同类型的环境。可以创建一个或一组服务器，所有这些都基于符合业务现实的脚本和逻辑。如果与<a class="ae jx" href="https://martinfowler.com/bliki/DevOpsCulture.html" rel="noopener ugc nofollow" target="_blank"> DevOps文化</a>相结合，这对公司会有很大的帮助。</p><p id="cc64" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">作为代码的基础设施的目标是通过消除手动过程和过程中的松弛来使事情变得更快。基于代码的方法更容易做到事半功倍。我们可以突出一些优势:</p><ul class=""><li id="3d10" class="kb kc hi il b im in iq ir jy kd jz ke ka kf jg kg kh ki kj bi translated"><strong class="il hj">敏捷性:</strong> IaC加速了为开发、测试和生产应用程序提供基础设施的过程。允许配置只运行一个脚本的完整环境。</li><li id="1221" class="kb kc hi il b im kk iq kl jy km jz kn ka ko jg kg kh ki kj bi translated">一致性:您的配置文件只有一个信息来源。这确保了能够一致地重复执行资源调配，并且不会出现信息差异。</li><li id="6f68" class="kb kc hi il b im kk iq kl jy km jz kn ka ko jg kg kh ki kj bi translated"><strong class="il hj">安全性:</strong>这些工具使我们能够快速修复错误并自动排除故障，从而在整个企业范围内建立更安全、更易于管理的基础设施。</li></ul><p id="aaa6" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">本文介绍了将基础设施作为代码软件工具来管理和供应应用程序的原因。</p><h1 id="653d" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">流程编排与配置管理</h1><p id="6e03" class="pw-post-body-paragraph ii ij hi il b im ln io ip iq lo is it jy lp iw ix jz lq ja jb ka lr je jf jg hb bi translated">IaC工具可以分为两类:<em class="ik">编排</em>和<em class="ik">配置管理</em>工具。当我们假设可以利用虚拟化和容器时，这是一个关键的区别。</p><p id="d8ad" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">第一个用于调配和管理环境的组件，比如云资源。AWS CloudFormation 和<a class="ae jx" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>是作为代码编排工具的基础设施的例子。另一个旨在安装和管理运行在服务器上的软件，如<a class="ae jx" href="https://puppet.com/" rel="noopener ugc nofollow" target="_blank">木偶</a>、<a class="ae jx" href="https://www.chef.io/products/chef-infra" rel="noopener ugc nofollow" target="_blank">厨师</a>和<a class="ae jx" href="https://www.ansible.com/" rel="noopener ugc nofollow" target="_blank"> Ansible </a>。我们不能选择单一的工具。</p><p id="b841" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">认识到部署过程中这两个步骤之间的差异并考虑到配置后配置对该过程的影响非常重要。根据配置方法的不同，这一步会对整个部署过程的速度和效率产生严重影响。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es ls"><img src="../Images/45a9833bd07e532b412494f6d34c2275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rlkOrR5mpnSACCgv.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">信用:<a class="ae jx" href="https://devops.com/provisioning-vs-configuration/" rel="noopener ugc nofollow" target="_blank">devops.com</a></figcaption></figure><h1 id="9396" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结合基础设施作为代码软件工具</h1><p id="901a" class="pw-post-body-paragraph ii ij hi il b im ln io ip iq lo is it jy lp iw ix jz lq ja jb ka lr je jf jg hb bi translated">尽管虚拟化和容器使得提供服务实例变得相对容易，但是仍然必须手动配置这些服务。部署新服务时，现有设置将不会完全有效。如果只是为了确保服务与正确的应用程序交互，那么总会有一些定制需要进行。</p><p id="bb27" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">流程编排满足了自动化环境生命周期的需求。这些工具确保环境持续处于其期望的状态。他关心基础设施的供应、规模和操作。例如，每当有任何系统故障时，Terraform会在充电后自动恢复并计算系统中的整个过程。它最适合需要恒定不变状态的情况。这将有助于有效解决所有异常情况。</p><p id="2256" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">这意味着一旦服务供应完成，仍有工作要做。例如，你不能在没有指导它如何分配负载和哪组服务器的情况下就启动负载平衡服务。</p><p id="0a72" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">配置管理(CM)工具在本地解决问题，而不是完全替换系统。它们自动配置应用程序或硬件。CM工具有助于配置每一个动作和仪器，并确保顺利操作，没有任何损坏或错误。因此，它倾向于针对特定的应用程序或领域进行高度专门化。</p><p id="37dc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">编排者将把配置经理委派给部署的元素。这种委托可以由Orchestrator触发，也可以完全委托给运营部门，具体取决于CM工具。从减少错误和缩短上市时间的角度来看，最终带来好处的是配置流程的优化，而不是资源调配。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es lt"><img src="../Images/cbc5c41c75ab89f213e5e8e83eeb78ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h7YH3Ft3ooby56x1.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx translated">信用:<a class="ae jx" href="https://www.golibrary.co/infrastructure-as-code-orchestration-provisioning-configuration-management-ansible-terraform/" rel="noopener ugc nofollow" target="_blank">高图书馆</a></figcaption></figure><h1 id="4824" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">用例-设置WordPress服务</h1><p id="b49e" class="pw-post-body-paragraph ii ij hi il b im ln io ip iq lo is it jy lp iw ix jz lq ja jb ka lr je jf jg hb bi translated">我们想给你提供一个现成的WordPress页面的路径。在这个旅程中，我们让您自由地加深对所用工具和资源的了解。首先，我们需要使用Terraform在云提供商上构建资源。对于这个例子，让我们使用谷歌云平台(GCP)。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="840e" class="lz kq hi lv b fi ma mb l mc md">provider "google" {<br/> project     = “google-demo”<br/> region      = "europe-west1"<br/>}</span></pre><p id="4e11" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">为了在我们的项目中使用虚拟机或者在web浏览器中显示我们的页面，我们需要一个虚拟网络，在其中可以添加其他GCP资源，比如节点、地址、防火墙规则。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="7f40" class="lz kq hi lv b fi ma mb l mc md">resource "google_compute_network" "this" {<br/>  auto_create_subnetworks = false<br/>  name                    = "example"<br/>  routing_mode            = "REGIONAL"<br/>}<br/><br/>resource "google_compute_subnetwork" "this" {<br/>  name          = "example"<br/>  ip_cidr_range = 192.168.24.0/24<br/>  region        = "europe-west1"<br/>  network       = google_compute_network.this.id<br/>}</span><span id="3228" class="lz kq hi lv b fi me mb l mc md">resource "google_compute_global_address" "this" {<br/>  provider = google-beta<br/><br/>  name          = "private-ip-db-address"<br/>  purpose       = "VPC_PEERING"<br/>  address_type  = "INTERNAL"<br/>  prefix_length = 16<br/>  network       = google_compute_network.this.id<br/>}<br/><br/>resource "google_service_networking_connection" "this" {<br/>  provider = google-beta<br/><br/>  network                 = google_compute_network.this.id<br/>  service                 = "servicenetworking.googleapis.com"<br/>  reserved_peering_ranges =[google_compute_global_address.this.name]<br/>}</span></pre><p id="ca00" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">为了正确启动一个功能性的WordPress实例，我们需要一个数据库。我们可以为数据库创建一个虚拟机，安装并配置它。我们还可以通过云利用托管服务，无需担心从头开始创建整个基础架构。只需几行代码，我们就可以部署一个新的、闪亮的MySQL实例。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="40ca" class="lz kq hi lv b fi ma mb l mc md">resource "google_sql_database_instance" "this" {<br/>  database_version = "MYSQL_5_7"<br/>  name             = example-wordpress<br/>  region           = "europe-west1"<br/><br/>  depends_on = [<br/>  google_service_networking_connection.this]<br/><br/>  settings {<br/>    availability_type = "REGIONAL"<br/>    disk_autoresize   = false<br/>    disk_size         = 50<br/>    disk_type         = "PD_HDD"<br/>    tier              = "db-g1-small"<br/><br/>    backup_configuration {<br/>      enabled            = true<br/>      start_time         = "04:00"<br/>      binary_log_enabled = true<br/>    }<br/><br/>    ip_configuration {<br/>      ipv4_enabled    = false<br/>      private_network = google_compute_network.this.id<br/>    }<br/><br/>    location_preference {<br/>      zone = "europe-west1-a"<br/>    }<br/><br/>    database_flags {<br/>      name  = "max_connections"<br/>      value = 500<br/>    }<br/>  }<br/>}<br/><br/>resource "google_sql_database" "this" {<br/>  name      = "wordpress"<br/>  instance  = google_sql_database_instance.this.name<br/>  charset   = "utf8"<br/>  collation = "utf8_general_ci"<br/>}</span></pre><p id="1955" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">最后，我们需要为我们的WordPress应用程序创建一个虚拟机。为此，我们需要一些关于以下方面的详细信息:</p><ul class=""><li id="d7cc" class="kb kc hi il b im in iq ir jy kd jz ke ka kf jg kg kh ki kj bi translated">我们选择了哪种类型的机器，</li><li id="ab1a" class="kb kc hi il b im kk iq kl jy km jz kn ka ko jg kg kh ki kj bi translated">我们选择了什么形象，</li><li id="34dc" class="kb kc hi il b im kk iq kl jy km jz kn ka ko jg kg kh ki kj bi translated">我们选择了多大的磁盘。</li></ul><p id="8980" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">我们可以在<a class="ae jx" href="https://cloud.google.com/compute/docs/machine-types" rel="noopener ugc nofollow" target="_blank"> GCP文档</a>中查看。出于教程的目的，我们不需要一台拥有大量vCPUs和RAM的大机器，所以我们选择了一台小机器。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="af3a" class="lz kq hi lv b fi ma mb l mc md">resource "google_compute_instance" "this" {<br/> name                    = "example-wordpress"<br/> machine_type            = "e2-standard-2"<br/> zone                    = "europe-west1-b"<br/>  metadata_startup_script = templatefile("${path.module}/init.sh", {<br/>    DB_USERNAME = random_string.this.result<br/>    DB_PASSWORD = random_password.this.result<br/>    DB_HOST     = google_sql_database_instance.this.private_ip_address<br/>  })<br/><br/> boot_disk {<br/>   initialize_params {<br/>     image = “debian-cloud/debian-10”<br/>     size  = 50<br/>   }<br/> }<br/><br/> network_interface {<br/>   subnetwork = google_compute_subnetwork.this.id<br/><br/>   access_config {<br/>     nat_ip = google_compute_address.this.address<br/>   }<br/> }<br/><br/> service_account {<br/>   scopes = ["userinfo-email", "compute-ro", "storage-ro"]<br/> }<br/>}</span></pre><p id="dcbb" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">之后，我们会调配整个环境。但是我们只有一般的功能。我们需要把这个基础设施变成一个WordPress应用程序。所以我们需要用WordPress来设置这个环境。为此，我们将使用Ansible。</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="1254" class="lz kq hi lv b fi ma mb l mc md">---<br/>- name: Download WordPress<br/>  get_url: url=http://wordpress.org/wordpress-{{ wp_version }}.tar.gz dest=/srv/wordpress-{{ wp_version }}.tar.gz<br/>           sha256sum="{{ wp_sha256sum }}"<br/><br/>- name: Extract archive<br/>  unarchive:<br/>    creates: /srv/wordpress<br/>    src: /srv/wordpress-{{ wp_version }}.tar.gz<br/>    dest: /srv/wordpress<br/><br/>- name: Add group "wordpress"<br/>  group: name=wordpress<br/><br/>- name: Add user "wordpress"<br/>  user: name=wordpress group=wordpress home=/srv/wordpress/<br/><br/>- name: Fetch random salts for WordPress config<br/>  get_url:<br/>    url: https://api.wordpress.org/secret-key/1.1/salt/<br/>  register: "wp_salt"<br/>  become: no<br/>  become_method: sudo<br/>  changed_when: true<br/>  delegate_to: localhost<br/><br/>- name: Create WordPress database<br/>  mysql_db: name={{ wp_db_name }} state=present<br/><br/>- name: Create WordPress database user<br/>  mysql_user: name={{ wp_db_user }} password={{ wp_db_password }} priv={{ wp_db_name }}.*:ALL host='localhost' state=present<br/><br/>- name: Copy WordPress config file<br/>  template: src=wp-config.php dest=/srv/wordpress/<br/><br/>- name: Change ownership of WordPress installation<br/>  file: path=/srv/wordpress/ owner=wordpress group=wordpress state=directory recurse=yes setype=httpd_sys_content_t<br/><br/>- name: Start php-fpm Service<br/>  service: name=php-fpm state=started enabled=yes</span></pre><p id="edd0" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">这个可行的剧本部署了一个简单的WordPress平台配置。使用时，将<code class="du mf mg mh lv b">hosts.example</code>文件复制到<code class="du mf mg mh lv b">hosts</code>并编辑<code class="du mf mg mh lv b">hosts</code>库存文件以包含必要的变量。然后，您只需运行行动手册，就像这样:</p><pre class="ji jj jk jl fd lu lv lw lx aw ly bi"><span id="e7d7" class="lz kq hi lv b fi ma mb l mc md">ansible-playbook -i hosts wordpress.yml</span></pre><p id="68dc" class="pw-post-body-paragraph ii ij hi il b im in io ip iq ir is it jy iv iw ix jz iz ja jb ka jd je jf jg hb bi translated">之后，你将拥有一个WordPress服务，所有的基础设施都是通过代码配置的。</p><h1 id="0cdb" class="kp kq hi bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="b66c" class="pw-post-body-paragraph ii ij hi il b im ln io ip iq lo is it jy lp iw ix jz lq ja jb ka lr je jf jg hb bi translated">基础设施即代码包括使用高级描述性编码语言，旨在自动化应用程序基础设施的供应。IaC的目标是通过消除手动过程和过程中的松弛来使事情变得更快。基于代码的方法更容易做到事半功倍。将基础设施组合成代码软件工具可以帮助您实现环境的一致性、敏捷性和安全性。我们展示了一个用例，其中使用了<em class="ik">编排</em>和<em class="ik">配置管理</em>工具来创建一个现成的WordPress页面。</p></div></div>    
</body>
</html>