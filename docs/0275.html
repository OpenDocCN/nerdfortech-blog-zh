<html>
<head>
<title>Deploying applications in Kubernetes using Argo CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Argo CD 在 Kubernetes 中部署应用程序</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploying-applications-in-kubernetes-using-argo-cd-ab004a8cdb5e?source=collection_archive---------0-----------------------#2020-09-01">https://medium.com/nerd-for-tech/deploying-applications-in-kubernetes-using-argo-cd-ab004a8cdb5e?source=collection_archive---------0-----------------------#2020-09-01</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="3d26" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">什么是 Argo CD？</p><p id="9860" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Argo CD 是一个用于 Kubernetes 的声明式 GitOps 连续交付工具。那么什么是 GitOps 呢？是市场上的新工具吗？GitOps 为开发人员提供了一种使用 Git 来管理 Kubernetes 操作工作流的方法。这完全是关于在 Kubernetes 中使用版本控制系统来部署应用程序。所以开发者可以直接把代码从 Git 这样的版本控制系统推到生产中。此外，任何更改都可以很容易地跟踪和恢复，以防出现任何混乱。市场上有多种运行 GitOps 的工具。今天在这篇文章中，我们将实验一种叫做 Argo CD 的工具。</p><p id="b12a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Argo CD 是一个用于 Kubernetes 的声明式 GitOps 连续交付工具。它支持在</p><ol class=""><li id="bd43" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">草泽</li><li id="0364" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">舵图</li><li id="79cf" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">YAML 货单</li><li id="734e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">ksonnet 应用</li><li id="ef07" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">jsonnet 文件</li></ol><p id="ea88" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们看看阿尔戈光盘的结构</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/50223a4ac89947b42d4f400b9173aed6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nhtY1pfhRQGzAnBE.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">Argo CD 架构</figcaption></figure><p id="1c2f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们已经熟悉了 Argo CD 的概念，让我们在 Kubernetes 集群中安装 Argo CD。</p><p id="3c54" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">按照 Argo CD   官方文档中指定的步骤在您的 Kubernetes 集群中安装和配置 Argo CD。</p><p id="a8b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在第一步中，让我们配置与我们的私有 Github 存储库相关的私有密钥。这一步使得我们的 Argo CD 服务器可以访问我们私有的 Github 库中的所有清单文件。这可以通过发出一个简单的 argocd 命令来完成</p><blockquote class="kj kk kl"><p id="5d83" class="if ig ki ih b ii ij ik il im in io ip km ir is it kn iv iw ix ko iz ja jb jc hb bi translated"><strong class="ih hj"> argocd repo 添加 git @ github . com:pavan-Kumar-99/lamp-k8-s-application . git—ssh-private-key-path id _ RSA ~/。ssh/argo_priavate_key </strong></p></blockquote><p id="c0a6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们也从 Argo CD 控制台验证这一点</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kp"><img src="../Images/343ffd654c1babf8d8b8d9baafca1392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PZHQCEigYwv_KgzsyNGnBA.png"/></div></div></figure><p id="529d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">亚斯。！到我们私有存储库的连接现在成功了。让我们继续将应用程序部署到我们的 Kubernetes 集群中。</p><p id="cb11" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 UI 中，通过单击新应用程序图标创建一个新应用程序。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kq"><img src="../Images/ec3fee23ff807d6597d00d362e9526a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8EGKzJmrAGHuagGPiXqh_A.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">阿尔戈 CD 用户界面</figcaption></figure><p id="055b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在上面的快照中，您可以看到配置应用程序的各种参数。</p><ol class=""><li id="7d1e" class="jd je hi ih b ii ij im in iq jf iu jg iy jh jc ji jj jk jl bi translated">应用程序名称:Argo CD 中应用程序的名称</li><li id="104e" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">项目:要在其中部署应用程序的项目</li><li id="327c" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">同步策略:从 GitHub 同步清单应该是自动的还是手动的。(现在让我们把它当作手动的，因为我们将在 Argo CD 中探索历史和回滚功能)</li><li id="5069" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">资源库 URL:您的 GitHub 资源库的 URL</li><li id="3355" class="jd je hi ih b ii jm im jn iq jo iu jp iy jq jc ji jj jk jl bi translated">修订版:GitHub 存储库中使用的分支。</li></ol><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kr"><img src="../Images/8fe100e6b6bbf218eb9f091c690487e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n2a_HRmZsAOdn5cr0CDgdA.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">集群的选择</figcaption></figure><p id="4dd5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">6.集群 URL:您希望将应用程序部署到的 Kubernetes 集群。</p><p id="bdd3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">7.名称空间:应用程序必须部署到的名称空间。</p><p id="4254" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我的 GitHub repo 中的 agro-cd 文件夹有一个简单的 Nginx 部署文件，其映像版本为<strong class="ih hj"> 1.18。</strong>现在让我们手动同步我们的应用程序。一旦同步成功，您将在 Argo CD 控制台中看到类似这样的内容</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es ks"><img src="../Images/ab12498e232d8a109d408d3524eb9ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UW7cwBXan_2TmHr4wDPZDw.png"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx translated">Argo CD 控制台</figcaption></figure><p id="fc63" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以在这里找到清单文件中定义的所有组件。同步输出表明应用程序与 GitHub 存储库同步。现在让我们尝试在 GitHub 中将 Nginx 镜像的版本改为<strong class="ih hj"> 1.19 </strong>。由于自动同步功能被禁用，更改不会立即复制。否则，一旦更改在 GitHub 中被更改，并被合并到项目中指定的分支，这些更改就会被立即复制到 Kubernetes 集群中。</p><p id="27fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">做出更改后，您会看到同步状态为<strong class="ih hj">不同步</strong>。让我们通过单击 App Diff 部分来查看 Argo CD 控制台中的更改。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kt"><img src="../Images/df89325a01a07bb3e941d39c4ce89b42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*27x6OxvVlhGBIGpnZKloPw.png"/></div></div></figure><p id="6230" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为可以清楚地看到图像已经被改变。让我们将这一变化与我们的集群同步。现在你可以看到同步状态回到了与 GitHub 同步。现在一切都很好，突然你的容器开始失效。当您发现您的代码在版本 1.19 中有问题，并且您想要回滚到应用程序的前一个版本时。单击控制台中的历史和回滚选项，并选择您想要回滚到的版本。现在，您可以看到您的应用程序回滚到旧版本，同步状态变为不同步。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kp"><img src="../Images/fa43b95556a0c256613cf81fb90f7e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vxWR6CQa9zp_-5Pxo_PjRg.png"/></div></div></figure><p id="e1ff" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">状态被设置为不同步，因为 Argo CD 的状态与 GitRepo 中的清单不一致。在 Git Repo 中进行更改将会改变 Argo CD UI 中的状态。</p><p id="567c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">还有一些其他场景，我将在下一篇文章中介绍。</p></div><div class="ab cl ku kv gp kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="hb hc hd he hf"><h1 id="6329" class="lb lc hi bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">被推荐的</h1><div class="lz ma ez fb mb mc"><a rel="noopener follow" target="_blank" href="/@pavan1999.kumar/introduction-to-istio-service-mesh-2bc68d2ffdac"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">Istio 服务网格简介</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">什么是 Istio 服务网格？</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">medium.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq kb mc"/></div></div></a></div><div class="lz ma ez fb mb mc"><a rel="noopener follow" target="_blank" href="/@pavan1999.kumar/securing-your-secrets-using-vault-k8s-in-kubernetes-part-1-de3d7378e226"><div class="md ab dw"><div class="me ab mf cl cj mg"><h2 class="bd hj fi z dy mh ea eb mi ed ef hh bi translated">在 Kubernetes 中使用 vault-k8s 保护您的秘密—第 1 部分</h2><div class="mj l"><h3 class="bd b fi z dy mh ea eb mi ed ef dx translated">Kubernetes secrets 允许您存储和管理敏感数据，如密码、ssh 密钥、Tls 证书等。然而…</h3></div><div class="mk l"><p class="bd b fp z dy mh ea eb mi ed ef dx translated">medium.com</p></div></div><div class="ml l"><div class="mr l mn mo mp ml mq kb mc"/></div></div></a></div></div></div>    
</body>
</html>