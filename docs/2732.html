<html>
<head>
<title>Grouping and Sampling Time Series Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列数据的分组和采样</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/grouping-and-sampling-time-series-data-2bafe98302ab?source=collection_archive---------1-----------------------#2021-05-18">https://medium.com/nerd-for-tech/grouping-and-sampling-time-series-data-2bafe98302ab?source=collection_archive---------1-----------------------#2021-05-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><h1 id="a08e" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">如何在Python Pandas中按时间间隔对数据进行分组</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/d69ff4fedfaf94778feebcdc54163371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9f9g_8aR874SwIb6"/></div></div></figure><p id="e7ba" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">图像参考:<a class="ae kn" href="https://unsplash.com/photos/bnZ8_95Q8NE" rel="noopener ugc nofollow" target="_blank">去飞溅</a></p><h1 id="e9f8" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">什么是时间序列数据:</h1><p id="9544" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><strong class="jr hj">时间序列数据</strong>也称<strong class="jr hj">时间</strong>-加盖<strong class="jr hj">数据</strong>，是<strong class="jr hj">数据</strong>的<strong class="jr hj">序列</strong>点按<strong class="jr hj">时间</strong>顺序索引。<strong class="jr hj">时间</strong>-盖章是在<strong class="jr hj">时间</strong>的不同点采集的<strong class="jr hj">数据。这些<strong class="jr hj">数据</strong>点通常由同一来源在<strong class="jr hj">时间</strong>间隔内进行的连续测量组成，用于跟踪<strong class="jr hj">时间</strong>内的变化。</strong></p><h1 id="d025" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们需要对时间序列数据进行什么样的分析？</h1><p id="0f35" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">在处理时间序列数据分析时，我们需要将数据组合成特定的间隔，比如每天、一周或一个月。</p><h1 id="882c" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们如何做到这一点？</h1><p id="efbf" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">我们将只使用两个熊猫API来解决这些问题，即resample()和GroupBy()。</p><h1 id="06fe" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">重新取样():</h1><p id="fed6" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><strong class="jr hj">重采样</strong>()函数用于<strong class="jr hj">重采样</strong>时序数据。时间序列的频率转换和<strong class="jr hj">重采样</strong>的便捷方法。该对象必须具有类似日期时间的索引(DatetimeIndex、PeriodIndex或TimedeltaIndex)，或者将类似日期时间的值传递给on或level关键字。</p><h1 id="7641" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">GroupBy():</h1><p id="392b" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><a class="ae kn" href="https://www.geeksforgeeks.org/pandas-groupby/" rel="noopener ugc nofollow" target="_blank"> <strong class="jr hj"> GroupBy </strong> </a>是一个相当简单的概念。我们可以创建一组类别，并对这些类别应用一个函数。我们在处理大量数据和反复尝试时需要它，因此为了提高效率，我们使用Groupby概念。GroupBy概念非常重要，因为它能够有效地对数据进行<strong class="jr hj">汇总、</strong> <strong class="jr hj">聚合、<strong class="jr hj">分组。</strong></strong></p><h1 id="9372" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">让我们把手弄脏:</h1><p id="ff73" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><strong class="jr hj">导入和安装:</strong></p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="40ab" class="ky ig hi ku b fi kz la l lb lc">#pip install openpyxl<br/>#pip install pandas_profiling</span><span id="797e" class="ky ig hi ku b fi ld la l lb lc">import pandas as pd <br/>import pandas_profiling</span><span id="5e6e" class="ky ig hi ku b fi ld la l lb lc">import matplotlib.pyplot as plt<br/>import seaborn as sns</span></pre><h1 id="2a93" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">关于数据集:</h1><p id="ae3c" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">我使用的数据集是印度新冠肺炎案例数据集。你可以在这里找到它。</p><h1 id="2a14" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><a class="ae kn" href="https://www.kaggle.com/sudalairajkumar/covid19-in-india?select=covid_19_india.csv" rel="noopener ugc nofollow" target="_blank">印度的新冠肺炎</a></h1><h1 id="9233" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated"><a class="ae kn" href="https://www.kaggle.com/sudalairajkumar/covid19-in-india?select=covid_19_india.csv" rel="noopener ugc nofollow" target="_blank">印度2019年新型冠状病毒疾病数据集</a></h1><p id="2b75" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated"><a class="ae kn" href="https://www.kaggle.com/sudalairajkumar/covid19-in-india?select=covid_19_india.csv" rel="noopener ugc nofollow" target="_blank">www.kaggle.com</a></p><p id="6818" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">读取数据库并组合日期-时间</p><p id="101e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">在读取CSV文件时，我们可以使用parse_dates直接组合数据和时间。</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="1bf6" class="ky ig hi ku b fi kz la l lb lc">data = pd.read_csv('covid-19 INDIA.csv',parse_dates=[['Date','Time']]) <br/>data.head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es le"><img src="../Images/3c0b7e3ae5d3b13b09f124a9eea54066.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*haiBgwS5bm2TtL6N.png"/></div></div></figure><h1 id="6a3d" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">转换为日期时间格式</h1><p id="485e" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">现在，处理任何时间序列数据的第一步是将日期列转换为日期时间格式:</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="9749" class="ky ig hi ku b fi kz la l lb lc">data['Date_Time'] = pd.to_datetime(data['Date_Time'])</span></pre><h1 id="8867" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">设置索引</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="df93" class="ky ig hi ku b fi kz la l lb lc">data.set_index("Date_Time",inplace=True)</span></pre><h1 id="1079" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">删除不必要的列</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="31c4" class="ky ig hi ku b fi kz la l lb lc">data.drop(axis=1, columns=["Sno","ConfirmedForeignNational","ConfirmedIndianNational"],inplace=True)data.tail()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/92651ab4917e9ae647506b4ed75fb0b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*-voFgRQ7j4glDdES.png"/></div></figure><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="ac64" class="ky ig hi ku b fi kz la l lb lc">data</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/df2304c8374b9cf97795f8234edd42f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*egzsUxIoYQddTDVk.png"/></div></figure><h1 id="f399" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">生成数据集报告:快速查看完整数据集</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="8004" class="ky ig hi ku b fi kz la l lb lc">report = pandas_profiling.ProfileReport(data)report</span></pre><p id="be0e" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">让我们自己按州和案例查看数据</p><h1 id="ba9b" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">我们可以使用matplotlib笔记本放大我们的数据</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="2929" class="ky ig hi ku b fi kz la l lb lc"># %matplotlib notebookplt.figure(figsize=(10,5));<br/>plt.scatter(x=data["State/UnionTerritory"],y=data.Confirmed);<br/>plt.show()</span></pre><h1 id="21e5" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">找出我们拥有的独特的州/UTs数据</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="a033" class="ky ig hi ku b fi kz la l lb lc">data["State/UnionTerritory"].unique()Output:array(['Kerala', 'Telengana', 'Delhi', 'Rajasthan', 'Uttar Pradesh',<br/>       'Haryana', 'Ladakh', 'Tamil Nadu', 'Karnataka', 'Maharashtra',<br/>       'Punjab', 'Jammu and Kashmir', 'Andhra Pradesh', 'Uttarakhand',<br/>       'Odisha', 'Puducherry', 'West Bengal', 'Chhattisgarh',<br/>       'Chandigarh', 'Gujarat', 'Himachal Pradesh', 'Madhya Pradesh',<br/>       'Bihar', 'Manipur', 'Mizoram', 'Andaman and Nicobar Islands',<br/>       'Goa', 'Unassigned', 'Assam', 'Jharkhand', 'Arunachal Pradesh',<br/>       'Tripura', 'Nagaland', 'Meghalaya',<br/>       'Dadra and Nagar Haveli and Daman and Diu',<br/>       'Cases being reassigned to states', 'Sikkim', 'Daman &amp; Diu',<br/>       'Lakshadweep', 'Telangana'], dtype=object)data["State/UnionTerritory"].nunique()Output: 40</span></pre><p id="8f55" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我不认为这些“案件被重新分配到各州”行是必要的。让我们望风</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="f8e3" class="ky ig hi ku b fi kz la l lb lc">data.loc[data["State/UnionTerritory"]=="Cases being reassigned to states"].head(10)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/2a6418ec4a1115f967635928acd5bbd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*_7vRKY7R9Ua00h2k.png"/></div></figure><h1 id="92a9" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">按州对案例数据进行分组</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="1910" class="ky ig hi ku b fi kz la l lb lc">data.groupby('State/UnionTerritory').sum().head()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/e4a5dffbeb0ad8af3f0ed3b6f67be64c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*gHSNJqU8ESIAwTTb.png"/></div></figure><h1 id="ac0f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">状态方面的实例总数</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="a27a" class="ky ig hi ku b fi kz la l lb lc">data.groupby('State/UnionTerritory').size().head(40)State/UnionTerritory<br/>Andaman and Nicobar Islands                 401<br/>Andhra Pradesh                              415<br/>Arunachal Pradesh                           393<br/>Assam                                       395<br/>Bihar                                       405<br/>Cases being reassigned to states             60<br/>Chandigarh                                  408<br/>Chhattisgarh                                408<br/>Dadra and Nagar Haveli and Daman and Diu    360<br/>Daman &amp; Diu                                   1<br/>Delhi                                       425<br/>Goa                                         401<br/>Gujarat                                     407<br/>Haryana                                     423<br/>Himachal Pradesh                            406<br/>Jammu and Kashmir                           418<br/>Jharkhand                                   395<br/>Karnataka                                   418<br/>Kerala                                      457<br/>Ladakh                                      420<br/>Lakshadweep                                 141<br/>Madhya Pradesh                              406<br/>Maharashtra                                 418<br/>Manipur                                     403<br/>Meghalaya                                   382<br/>Mizoram                                     402<br/>Nagaland                                    349<br/>Odisha                                      411<br/>Puducherry                                  409<br/>Punjab                                      418<br/>Rajasthan                                   424<br/>Sikkim                                      342<br/>Tamil Nadu                                  420<br/>Telangana                                     1<br/>Telengana                                   424<br/>Tripura                                     389<br/>Unassigned                                    3<br/>Uttar Pradesh                               423<br/>Uttarakhand                                 412<br/>West Bengal                                 409<br/>dtype: int64</span></pre><p id="f040" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">重采样根据实际数据生成唯一的采样分布。它根据一些时间或日期信息对行进行分组</p><p id="21f1" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们可以应用不同的频率对时间序列数据进行重采样。最常用的时间序列频率是</p><ul class=""><li id="3646" class="lg lh hi jr b js jt jw jx ka li ke lj ki lk km ll lm ln lo bi translated">女:每周一次</li><li id="d199" class="lg lh hi jr b js lp jw lq ka lr ke ls ki lt km ll lm ln lo bi translated">m:月末频率</li><li id="d496" class="lg lh hi jr b js lp jw lq ka lr ke ls ki lt km ll lm ln lo bi translated">SM:半月结束频率(15日和月末)</li><li id="4874" class="lg lh hi jr b js lp jw lq ka lr ke ls ki lt km ll lm ln lo bi translated">问:季度末频率</li><li id="f664" class="lg lh hi jr b js lp jw lq ka lr ke ls ki lt km ll lm ln lo bi translated">每小时一次</li><li id="ec54" class="lg lh hi jr b js lp jw lq ka lr ke ls ki lt km ll lm ln lo bi translated">d:每天</li></ul><h1 id="9488" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">抽样月度数据</h1><p id="ceec" class="pw-post-body-paragraph jp jq hi jr b js ko ju jv jw kp jy jz ka kq kc kd ke kr kg kh ki ks kk kl km hb bi translated">让我们根据每月案例数据对数据进行分组</p><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="d338" class="ky ig hi ku b fi kz la l lb lc">data.groupby('State/UnionTerritory').resample("M").sum()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/b04fdad0f470b2f7dc9e92fb2dcf90e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*6Rc8qkFAJlddk0Yi.png"/></div></figure><h1 id="5b2f" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">按天取样</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="11ff" class="ky ig hi ku b fi kz la l lb lc">data.groupby('State/UnionTerritory').resample("D").sum()</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/1f73dee74476b4ffd655ae546c026279.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*MSOG5pxneJLGnNkY.png"/></div></figure><h1 id="5244" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">四次抽样</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="b321" class="ky ig hi ku b fi kz la l lb lc">data_q = data.groupby('State/UnionTerritory').resample("Q").sum().head(30)<br/>data_q</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/d23df9c3ecd2ae561dd41c72d9e8d120.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*3-zWbLVpjFqedNAt.png"/></div></figure><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="db5f" class="ky ig hi ku b fi kz la l lb lc">data_q.columnsIndex(['Cured', 'Deaths', 'Confirmed'], dtype='object')</span></pre><h1 id="9b84" class="if ig hi bd ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc bi translated">按小时分组</h1><pre class="je jf jg jh fd kt ku kv kw aw kx bi"><span id="530f" class="ky ig hi ku b fi kz la l lb lc">data.groupby('State/UnionTerritory').resample("H").sum().tail(5)</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lf"><img src="../Images/058a4d103c59d62154a50e4971fcb987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1344/format:webp/0*YwxMMKIaofiodVx3.png"/></div></figure><p id="fb58" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我们在8:00点钟有数据，因此所有其他行的值都是0。</p><p id="4aab" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">这是关于时间序列数据集的重采样和分组的基础知识。尝试用一些很酷的时间序列数据集来试验你自己的数据集，包括天气更新、人口普查数据等</p><p id="1886" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">我希望这篇教程能帮助你理解这个概念！别忘了自己尝试，不断学习。</p><p id="dc40" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">….如果你喜欢这个博客，别忘了留下几个由衷的喜欢。</p><p id="2eef" class="pw-post-body-paragraph jp jq hi jr b js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km hb bi translated">学习愉快！</p></div></div>    
</body>
</html>