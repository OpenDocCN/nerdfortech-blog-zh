<html>
<head>
<title>Paxos algorithm in distributes systems</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">分布式系统中的 Paxos 算法</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/paxos-algorithm-a71d6fe7be97?source=collection_archive---------2-----------------------#2022-06-12">https://medium.com/nerd-for-tech/paxos-algorithm-a71d6fe7be97?source=collection_archive---------2-----------------------#2022-06-12</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/c96ca2312abf49123b7c0d9588e71d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LKlp4A9YwBtMdyRVSdxiIw.png"/></div></div></figure><h1 id="16f2" class="iq ir hi bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">问题</h1><p id="ba61" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">当多个节点共享状态时，它们通常需要在特定的值上达成一致。有了<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/leader-follower.html" rel="noopener ugc nofollow" target="_blank">领导者和</a>追随者，领导者决定并将其价值传递给追随者。但是如果没有领导者，那么节点需要自己确定一个值。(即使有领导者-追随者，他们也可能需要这样做来选举领导者。)</p><p id="faf8" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">领导者可以通过使用<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/two-phase-commit.html" rel="noopener ugc nofollow" target="_blank">两阶段提交</a>来确保副本安全地获得更新，但是如果没有领导者，我们可能会让竞争节点试图聚集<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html" rel="noopener ugc nofollow" target="_blank">法定人数</a>。这个过程更加复杂，因为任何节点都可能发生故障或断开连接。某个节点可能会在某个值上达到仲裁，但在能够将该值传递给整个集群之前会断开连接。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="692f" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">解决办法</h1><p id="0291" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">Paxos 算法是由 Leslie Lamport 开发的，发表在他 1998 年的论文兼职议会中。Paxos 分三个阶段工作，以确保尽管部分网络或节点出现故障，但多个节点仍同意相同的值。前两个阶段的作用是围绕一个价值建立共识，最后一个阶段将共识传达给剩余的复制品。</p><ul class=""><li id="678a" class="le lf hi jq b jr kn jv ko jz lg kd lh kh li kl lj lk ll lm bi translated">准备阶段:建立最新的<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/generation.html" rel="noopener ugc nofollow" target="_blank">生成时钟</a>并收集任何已经接受的值。</li><li id="db9e" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">接受阶段:为这一代提出一个值供副本接受。</li><li id="dd4f" class="le lf hi jq b jr ln jv lo jz lp kd lq kh lr kl lj lk ll lm bi translated">提交阶段:让所有副本知道已经选择了一个值。</li></ul><p id="081b" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在第一阶段(称为<strong class="jq hj">准备阶段</strong>，提议值的节点(称为<strong class="jq hj">提议者</strong>)联系集群中的所有节点(称为<strong class="jq hj">接受者</strong>)并询问它们是否会承诺考虑其值。一旦法定人数的接受者回复这样的承诺，提议者就进入第二阶段。在第二阶段(称为<strong class="jq hj">接受阶段</strong>)中，提议者发出提议值，如果法定人数<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/paxos.html#footnote-flexible-paxos" rel="noopener ugc nofollow" target="_blank">【1】</a>的节点接受该值，则该值被<strong class="jq hj">选择</strong>。在最后阶段(称为<strong class="jq hj">提交阶段</strong>，提议者可以将选择的值提交给集群中的所有节点。</p><p id="9bec" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">在最初的 paxos 论文(<a class="ae km" href="http://lamport.azurewebsites.net/pubs/pubs.html#lamport-paxos" rel="noopener ugc nofollow" target="_blank"> 1998 </a>和<a class="ae km" href="https://lamport.azurewebsites.net/pubs/paxos-simple.pdf" rel="noopener ugc nofollow" target="_blank"> 2001 </a>)中，没有提到提交阶段，因为算法的重点是证明只选择单个值就足够了，即使只有提议者集群节点知道所选择的值。但是在实践中，所有的集群节点都需要知道所选择的值，并且需要一个提交阶段，在该阶段中，提议者将决定传达给所有的集群节点。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="bebc" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">细节</h1><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ls"><img src="../Images/420f06802475759e0d1717ba6285f608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ikqzjF_VQ0o5qHggwA5i5g.png"/></div></div></figure><figure class="lt lu lv lw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lx"><img src="../Images/a1eb928aa6795486ce7f785677852f20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WzLEhzPSMkww2W9vuiybGw.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx translated">帕克索斯流</figcaption></figure><h2 id="3774" class="mc ir hi bd is md me mf iw mg mh mi ja jz mj mk je kd ml mm ji kh mn mo jm mp bi translated">协议流程示例为顺序图(<strong class="ak">必读)</strong></h2><p id="8222" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated"><a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/paxos.html" rel="noopener ugc nofollow" target="_blank">5 个分布式节点的 Paxos 算法</a>。我已经阅读了网上的多个链接，但发现这是最有帮助的，因为它使用序列图解释了流程并涵盖了多个场景。</p><p id="7e1b" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">这里解释的 Paxos 协议建立了对单一价值的共识(通常称为单法令 Paxos)。像<a class="ae km" href="https://docs.microsoft.com/en-us/azure/cosmos-db/introduction" rel="noopener ugc nofollow" target="_blank"> Cosmos DB </a>或<a class="ae km" href="https://cloud.google.com/spanner" rel="noopener ugc nofollow" target="_blank"> Spanner </a>这样的主流产品中使用的大多数实际实现都使用 paxos 的一种修改，称为 multi-paxos，它被实现为<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/replicated-log.html" rel="noopener ugc nofollow" target="_blank">复制日志</a>。</p><p id="895e" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><a class="ae km" href="http://cassandra.apache.org/" rel="noopener ugc nofollow" target="_blank">【Cassandra】</a>使用 Paxos 实现轻量级交易。</p><p id="4b93" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">所有的共识算法，如<a class="ae km" href="https://raft.github.io/" rel="noopener ugc nofollow" target="_blank"> Raft </a>(这将是未来的后 WIP)都使用类似于基本 Paxos 的基本概念。以类似的方式使用<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/two-phase-commit.html" rel="noopener ugc nofollow" target="_blank">两阶段提交</a>、<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/quorum.html" rel="noopener ugc nofollow" target="_blank">法定人数</a>和<a class="ae km" href="https://martinfowler.com/articles/patterns-of-distributed-systems/generation.html" rel="noopener ugc nofollow" target="_blank">生成时钟</a>。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="c82c" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">问题</h1><p id="1a95" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">有几个问题与 Paxos 算法有关。为了理解这一点，我假设您已经花了足够的时间在 Martin Fowler 的博客或其他材料上理解算法的示例工作。</p><p id="a477" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><strong class="jq hj">决斗领袖<br/> </strong>想象一下 2 个或 2 个以上节点同时发起提案的情况。这会导致死锁情况，其中 2 个节点/副本被选为提议者，并且每个都提议了一个具有给定数量的提交，但是失败了，并且都尝试了一个更大的数量并且再次失败？这可能会成为一个阻碍，我们的副本可能永远不会收敛。</p><p id="623c" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated"><strong class="jq hj">活锁<br/> </strong>假设集群中存在网络故障，每个接受者接受不同的值。如果没有能力在以后的回合中改变它们的值，就不会有任何进展，并且你有一个“活锁”。这是另一种死锁情况，其中复制品不能更新它们的值，因为提议者不能在提议中更新所有节点都能同意的公共值。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="6ccb" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">多 Pax OS:Pax OS 的另一个版本</h1><p id="768d" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">多 Paxos 选举一个首领，由首领发起提议。由于零竞争，活锁问题被消除。<br/>如果所有提案都是领导发起的，可以跳过准备阶段，将两阶段流程改为一阶段流程，提高了效率。<br/>多派克斯并没有一个独一无二的领导者。相反，它允许多个领导在不影响安全的情况下同时提出请求。在极端情况下，它会退化为基本的 Paxos。</p></div><div class="ab cl ks kt gp ku" role="separator"><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx ky"/><span class="kv bw bk kw kx"/></div><div class="hb hc hd he hf"><h1 id="93a8" class="iq ir hi bd is it kz iv iw ix la iz ja jb lb jd je jf lc jh ji jj ld jl jm jn bi translated">结尾注释</h1><p id="79f3" class="pw-post-body-paragraph jo jp hi jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl hb bi translated">通过这篇文章，我试图提供对 Paxos 算法的高层次理解。这是分布式系统世界中的一个重要算法。如上所述，实践中使用了不同的版本或临时版本，即 cassandra、spanner 和 cosmos 数据库。提供了一些相关的链接，但是在线参考资料非常丰富。</p><p id="3da8" class="pw-post-body-paragraph jo jp hi jq b jr kn jt ju jv ko jx jy jz kp kb kc kd kq kf kg kh kr kj kk kl hb bi translated">希望这有所帮助。如果你在帖子中发现任何不一致的地方，请在评论中告诉我。感谢阅读！！！</p></div></div>    
</body>
</html>