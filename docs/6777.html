<html>
<head>
<title>How To Create A Simple Nonce in PHP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在PHP中创建一个简单的随机数</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-create-a-simple-nonce-in-php-a5afe046beee?source=collection_archive---------0-----------------------#2022-05-09">https://medium.com/nerd-for-tech/how-to-create-a-simple-nonce-in-php-a5afe046beee?source=collection_archive---------0-----------------------#2022-05-09</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/62cafd67482c8aadabfc7b110e797c03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zXq2uNuCHwLWkcf6X0DJWA.png"/></div></div></figure><p id="0c2a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">随机数是仅使用一次的数字或令牌。</p><p id="ce74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你可以在你的页面或表格中使用Nonce来为你的应用程序增加额外的安全层，它的一个功能是<strong class="is hj">区分人类和机器人</strong>。</p><p id="f751" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">今天，我将向您展示如何用PHP创建一个简单的Nonce，以及如何验证它。</p><h1 id="b8c9" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">我们开始吧</h1><p id="b292" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">首先，我们将创建一个<strong class="is hj">类</strong>，它将拥有<strong class="is hj">私有和公共方法</strong>，这些方法将基于我们将要定义的秘密散列来生成和验证我们的Nonce。</p><h1 id="bc86" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">我们班</h1><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="990c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要设置一个<strong class="is hj">私有函数(方法)</strong>，它将生成随机字符，也就是我们的<strong class="is hj"> salt </strong>，直到我们将在其长度参数中指定的字符。</p><p id="903c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当我们测试运行代码时，让我们将这个方法作为一个公共函数。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="9582" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是完整的代码</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="2bbf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们使用new关键字创建该类的一个实例，并调用<strong class="is hj">generates salt()方法</strong>。</p><pre class="kr ks kt ku fd kx ky kz la aw lb bi"><span id="4536" class="lc jp hi ky b fi ld le l lf lg">$nonce = new Nonce();</span><span id="b58e" class="lc jp hi ky b fi lh le l lf lg">var_dump($nonce-&gt;generateSalt(22));</span></pre><p id="d595" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们的结果，注意随机字符是按照我们指定的长度生成的。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es li"><img src="../Images/19f47796fae701e83b8abac0182cf8c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/0*D9AiEzZC3rBX6Wsi.png"/></div></figure><p id="d5a3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要另一个私有方法来利用$_SESSION，使用表单ID存储生成的随机数。</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="044e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">接下来，我们需要创建另一个方法，将我们的salt、我们的秘密和特定的过期时间作为令牌进行散列<strong class="is hj">。然后我们将生成一个nonce，用冒号<strong class="is hj">分隔每个令牌</strong>并<strong class="is hj">使用<strong class="is hj"> storeNonce </strong>方法将它存储在一个会话变量</strong>中。</strong></p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="cac1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是完整的代码</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="9984" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">因此，让我们调用generateNonce()方法，传入<strong class="is hj"> 5作为第一个参数</strong>(这将用于生成我们的salt)，传入<strong class="is hj"> form_login </strong>作为第二个参数(这将是我们希望使用Nonce的表单)，传入<strong class="is hj"> 10作为第三个或最后一个参数</strong>(这将是我们的nonce将持续多长时间，以分钟为单位)。</p><pre class="kr ks kt ku fd kx ky kz la aw lb bi"><span id="8b95" class="lc jp hi ky b fi ld le l lf lg">$nonce = generateNonce();<br/>var_dump($nonce-&gt;generateNonce(5, "form_login", 10));</span><span id="9f37" class="lc jp hi ky b fi lh le l lf lg">var_dump($_SESSION);</span></pre><p id="ac56" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是我们的nonce和它在会话中存储的值。</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es lj"><img src="../Images/58a22131386410324e62d90036b90ba1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PoGu2ZlREm0GFCakL_Nl6Q.png"/></div></div></figure><p id="f530" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您可以看到，在生成的nonce中，我们用冒号<strong class="is hj">分隔每个<strong class="is hj">令牌</strong>，并通过使用<strong class="is hj"> md5() </strong>对其进行哈希运算，将它存储在会话中。</strong></p><p id="cdd2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在我们需要编写一个<strong class="is hj">公共方法</strong>，它将验证一个nonce并返回一个<strong class="is hj">布尔值(真或假)</strong>，这取决于nonce是否有效。</p><p id="5750" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">在我们编写这个方法之前，您需要理解:</p><ul class=""><li id="407a" class="lk ll hi is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls bi translated">我们的随机数存储在$_SESSION中</li><li id="0a18" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">我们的标记由冒号分隔($salt : $form_id : $time : $hash)</li><li id="3a9a" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">我们将使用与生成随机数相同的秘密来验证它。</li></ul><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="804c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们在上面的方法中有一些条件来检查随机数。该方法仅在检查成功时返回true，在一个或多个检查失败时返回false。</p><p id="168b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是支票:</p><ul class=""><li id="b84f" class="lk ll hi is b it iu ix iy jb lm jf ln jj lo jn lp lq lr ls bi translated">如果令牌不完整，随机数无效</li><li id="d20e" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">如果Nonce没有存储在会话中，则Nonce无效</li><li id="a921" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">如果存储了Nonce，但值不匹配，则Nonce无效</li><li id="70bb" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">如果时间已经过去，则nonce无效</li><li id="46b6" class="lk ll hi is b it lt ix lu jb lv jf lw jj lx jn lp lq lr ls bi translated">如果哈希有改动，随机数就无效</li></ul><p id="c2a7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">让我们创建一个nonce并验证它，以确认我们的类是否工作，我们也可以用私有函数替换<strong class="is hj">公共函数generates salt()</strong>，这样它就只能在我们的类中<strong class="is hj">访问</strong>。</p><p id="bd34" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是完整的代码</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="ce9f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我生成了一个nonce，并把它作为一个字符串传递给这个方法，它工作得非常好！</p><p id="d2f5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要验证你的nonce，注意如果返回<strong class="is hj">真</strong>，就意味着nonce是<strong class="is hj">仍然有效</strong>，但是如果返回<strong class="is hj">假</strong>，就意味着nonce <strong class="is hj">无效</strong>。</p><p id="f11c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以我们的功能运行得很完美！为了使用这个nonce，您需要将类放到一个文件中，并使用<strong class="is hj"> require() </strong>关键字将该文件包含到您的页面中。</p><p id="3d3b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">然后创建该类的新实例，并生成一个nonce</p><figure class="kr ks kt ku fd ij"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="8c33" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">所以你有它</p><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es ly"><img src="../Images/dc14328b7c2daa993d921dd98043da04.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/0*Z4fERegoqRjJtSes.png"/></div></figure><h1 id="ce2e" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">令人惊奇不是吗？</h1><figure class="kr ks kt ku fd ij er es paragraph-image"><div class="er es lz"><img src="../Images/24cf6fe8af5a67e716310d45b3ee97c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*4A-FV-cX5gAKosjL.png"/></div></figure><p id="b75c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">通过使用一个非常强大的秘密使它适合你的项目。</p><p id="e74f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">注意到<a class="ma mb ge" href="https://medium.com/u/1c56ff92f057?source=post_page-----a5afe046beee--------------------------------" rel="noopener" target="_blank">克里斯·史密斯</a>的回应，我能够更新这篇文章的安全性。谢谢你，克里斯！</p><p id="208a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请随意在下面留下您对本文的建议和/或回复。</p><p id="2b83" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">您已经到达我更新文章的结尾。</p><h1 id="6325" class="jo jp hi bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">额外的</h1><p id="e223" class="pw-post-body-paragraph iq ir hi is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn hb bi translated">我目前正在测试一个SAAS应用程序，我建立这个程序是为了帮助收集和管理你的网站或企业的客户评论和评级。你介意检查一下吗？我正在寻找这个大项目的合作伙伴。</p><p id="50fb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">非常感谢您的反馈。</p><p id="d84b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><a class="ae mc" href="https://givemeastar.com/" rel="noopener ugc nofollow" target="_blank">查看Givemeastar(GMAS) </a></p><p id="5614" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢你</p></div></div>    
</body>
</html>