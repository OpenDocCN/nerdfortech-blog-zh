<html>
<head>
<title>How to collect payments with PayPal in your React application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在 React 应用程序中使用 PayPal 收款</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/how-to-collect-payments-with-paypal-in-your-react-application-64ff46135d4d?source=collection_archive---------1-----------------------#2021-02-16">https://medium.com/nerd-for-tech/how-to-collect-payments-with-paypal-in-your-react-application-64ff46135d4d?source=collection_archive---------1-----------------------#2021-02-16</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="8b0c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我最近建立了一个项目，需要与贝宝集成，以收集用户付款。在花了几个小时尝试使用 Paypal JavaScript SDK 实现 Paypal 支付后，我意识到这将是一项艰巨的任务。谢天谢地，我找到了一个 NPM 包，它已经将 SDK 抽象成 React 组件供我们使用。在本文中，我将向您展示如何在 React 应用程序中使用 Paypal 收款。</p><h1 id="17c9" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">开始使用—设置您的 Paypal 帐户</h1><p id="d9c1" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">先迈出第一步。前往 P <a class="ae kg" href="https://paypal.com" rel="noopener ugc nofollow" target="_blank"> ayPal </a>创建一个帐户。一旦完成，前往 P <a class="ae kg" href="https://developer.paypal.com/developer/applications/" rel="noopener ugc nofollow" target="_blank"> ayPal 开发者屏幕</a>。</p><h1 id="f544" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">获取您的证书</h1><p id="054f" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">下一步是获取您的凭证，即您的客户端 Id。</p><p id="c6b8" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">导航至<strong class="ih hj">仪表盘&gt;我的应用&amp;凭证。</strong></p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kh"><img src="../Images/f87fb7522b0f2782f33d6c04e1b2385b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WBqud3gpF1Q1bi6t.png"/></div></div></figure><p id="c902" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">点击<strong class="ih hj">沙盒</strong>标签。然后点击<strong class="ih hj">默认应用</strong>链接。它会将您带到一个包含您的 clientId 的页面。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es kt"><img src="../Images/c07949bbbcd1593cc7924f171b85d945.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YgUP3YJha3yD_qfc.png"/></div></div></figure><p id="084b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的<strong class="ih hj">沙盒账户</strong>将是一个电子邮件地址，您可以使用它进行测试支付，而您的<strong class="ih hj">客户 ID </strong>是 PayPal 用来将您的应用程序连接到您的 Paypal 账户的。</p><h1 id="85e4" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">设置您的 react 项目</h1><p id="75c9" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">对于这个例子，我们的 React 项目将使用<a class="ae kg" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> NextJS </a>构建。</p><p id="e26b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">如果您愿意跟随，您可以通过简单地克隆我的 repo 来跳过接下来的几个步骤。运行<em class="ku">` git clone git @ github . com:one debos/nextjs-paypal-example . git `</em>命令来执行此操作。然后用 git checkout starter 签出到 starter 分支。如果您克隆 starter repo，您可以跳到<strong class="ih hj">设置项目结构</strong>部分。</p><p id="497b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">否则，下面是要遵循的步骤。</p><p id="bf40" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们将使用一个已经配置了<a class="ae kg" href="https://tailwindcss.com/" rel="noopener ugc nofollow" target="_blank"> tailwindcss </a>的 NextJS 示例项目。</p><p id="9f67" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">运行命令<em class="ku">yarn create next-app-example with-tailwindcss next-paypal-example</em>创建一个已经配置了 Tailwindcss 的 NextJS 应用程序。</p><h1 id="a930" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">设置项目结构</h1><p id="87ea" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">我们将在当前项目中创建一个名为 utils 的新文件夹。在 utils 文件夹中，我们将创建一个 constants 文件夹。在 constants 文件夹中，添加一个 index.js 文件。</p><p id="57e5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您的文件夹结构现在应该看起来像这样</p><p id="b7a1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du kv kw kx ky b">/utils/constants/index.js</code></p><p id="0172" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">安装 Paypal 包</strong></p><p id="dc9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用安装 react paypal 包</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="1354" class="ld je hi ky b fi le lf l lg lh">yarn add @paypal/react-paypal-js@4.1.0</span></pre><h1 id="9a0c" class="jd je hi bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">收取付款</h1><p id="2197" class="pw-post-body-paragraph if ig hi ih b ii kb ik il im kc io ip iq kd is it iu ke iw ix iy kf ja jb jc hb bi translated">是时候开始收款了！</p><p id="b988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的 utils/constants/index.js 文件中，添加您的<strong class="ih hj"> clientId。</strong></p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="7921" class="ld je hi ky b fi le lf l lg lh">export const PAYPAL_CLIENT_ID = {</span><span id="8d1d" class="ld je hi ky b fi li lf l lg lh">   clientId: 'YOUR_CLIENT_ID'</span><span id="9b40" class="ld je hi ky b fi li lf l lg lh">}</span></pre><p id="ca98" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在您的<strong class="ih hj"> _app.j </strong> s 文件中，使用</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="2eb7" class="ld je hi ky b fi le lf l lg lh">import { PayPalScriptProvider } from “@paypal/react-paypal-js”;</span></pre><p id="086c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，用那个标签包装你的组件。</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="c9fd" class="ld je hi ky b fi le lf l lg lh">import { PayPalScriptProvider } from "<a class="ae kg" href="http://twitter.com/paypal/react-paypal-js" rel="noopener ugc nofollow" target="_blank">@paypal/react-paypal-js</a>";<br/>import {PAYPAL_CLIENT_ID} from '../utils/constants'<br/>function MyApp({ Component, pageProps }) {<br/>  return(<br/>    &lt;PayPalScriptProvider options= {{"client-id": PAYPAL_CLIENT_ID.clientId }}&gt;<br/>        &lt;Component {...pageProps} /&gt;<br/>    &lt;/PayPalScriptProvider&gt;<br/>  ) <br/>}<br/>export default MyApp</span></pre><p id="3736" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，进入 pages/index.js 创建收款页面，并引入 PayPal 按钮。</p><p id="11bf" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们创建一些状态来保存数据。</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="af57" class="ld je hi ky b fi le lf l lg lh">const [succeeded, setSucceeded] = useState(false);</span><span id="fc29" class="ld je hi ky b fi li lf l lg lh">const [paypalErrorMessage, setPaypalErrorMessage] = useState("");</span><span id="1936" class="ld je hi ky b fi li lf l lg lh">const [orderID, setOrderID] = useState(false);</span><span id="4eaf" class="ld je hi ky b fi li lf l lg lh">const [billingDetails, setBillingDetails] = useState("");</span></pre><p id="7b41" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">orderId 是我们关心的最重要的状态。当用户点击<strong class="ih hj"> Pay with PayPal </strong>按钮时，PayPal 将为订单生成一个 orderId 并返回给我们。在下面的 createOrder 函数中，我们可以看到这一点。</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="2674" class="ld je hi ky b fi le lf l lg lh">// creates a paypal order<br/>  const createOrder = (data, actions) =&gt; {<br/>    return actions.order<br/>      .create({<br/>        purchase_units: [<br/>          {<br/>            amount: {<br/>              // charge users $499 per order<br/>              value: 499,<br/>            },<br/>          },<br/>        ],<br/>        // remove the applicaiton_context object if you need your users to add a shipping address<br/>        application_context: {<br/>          shipping_preference: "NO_SHIPPING",<br/>        },<br/>      })<br/>      .then((orderID) =&gt; {<br/>        setOrderID(orderID);<br/>        return orderID;<br/>      });<br/>  };</span></pre><p id="2988" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">除了 createOrder 函数，我们还需要另一个在付款被批准时运行的函数——on approve。</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="8381" class="ld je hi ky b fi le lf l lg lh">// handles when a payment is confirmed for paypal<br/>  const onApprove = (data, actions) =&gt; {<br/>    return actions.order.capture().then(function (details) {<br/>      const {payer} = details;<br/>      setBillingDetails(payer);<br/>      setSucceeded(true);<br/>    })<br/>  };</span><span id="5199" class="ld je hi ky b fi li lf l lg lh">// handles payment errors<br/>const onError = (data,actions)=&gt;{</span><span id="457a" class="ld je hi ky b fi li lf l lg lh">   setPaypalErrorMessage("Something went wrong with your payment");<br/>}</span></pre><p id="8a03" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们可以从我们的<strong class="ih hj"> react-paypal-js </strong>包中插入 PayPal 按钮来处理支付。</p><pre class="ki kj kk kl fd kz ky la lb aw lc bi"><span id="da38" class="ld je hi ky b fi le lf l lg lh">&lt;PayPalButtons<br/>            style={{<br/>              color: "blue",<br/>              shape: "pill",<br/>              label: "pay",<br/>              tagline: false,<br/>              layout: "horizontal",<br/>            }}<br/>            createOrder={createOrder}<br/>            onApprove={onApprove}<br/>    /&gt;</span></pre><p id="9d14" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Paypal 会将用户重定向到一个新窗口来完成支付。</p><figure class="ki kj kk kl fd km er es paragraph-image"><div role="button" tabindex="0" class="kn ko di kp bf kq"><div class="er es lj"><img src="../Images/4b1dc96c14ade3a2a9422c61d68fee02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vvFthJU9iHtP05Xq.png"/></div></div></figure><p id="4e87" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">您可以使用 Paypal 开发者仪表板上提供的沙盒电子邮件来测试这一点。</p><p id="9c9b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">代码的完整回购是这里的<a class="ae kg" href="https://github.com/onedebos/nextjs-paypal-example" rel="noopener ugc nofollow" target="_blank">和这里的</a>和一个工作示例<a class="ae kg" href="https://unruffled-kare-da0f38.netlify.app/" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>