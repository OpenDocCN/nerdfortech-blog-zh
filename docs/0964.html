<html>
<head>
<title>What is Attention in NLP?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">NLP 中的注意力是什么？</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/what-is-attention-in-nlp-f67411426e64?source=collection_archive---------2-----------------------#2021-02-26">https://medium.com/nerd-for-tech/what-is-attention-in-nlp-f67411426e64?source=collection_archive---------2-----------------------#2021-02-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="cf20" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">在这个博客中，我们将关注自然语言处理领域的关键研究，它改变了整个世界对自然语言处理的看法，即所谓的</em> <strong class="ih hj"> <em class="jd">注意力。</em> </strong></p><p id="67fb" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我之前的文章中我们已经看到了<a class="ae je" href="https://jaimin-ml2001.medium.com/understanding-rnn-91d548c86ac9?source=your_stories_page-------------------------------------" rel="noopener"> RNN </a>、<a class="ae je" href="https://jaimin-ml2001.medium.com/what-is-lstm-peephole-lstm-and-gru-77470d84954b?source=your_stories_page" rel="noopener"> LSTM </a>、<a class="ae je" href="https://jaimin-ml2001.medium.com/what-does-it-mean-by-bidirectional-lstm-63d6838e34d9?source=your_stories_page" rel="noopener">双向 RNN </a>、<a class="ae je" href="https://jaimin-ml2001.medium.com/encoder-decoder-model-for-machine-translation-8a90be12ac32?source=your_stories_page" rel="noopener">编码器解码器</a>。此外，所有这些体系结构都有自己的局限性。然而，在编码器/解码器结构中，解决了语义信息和与每个字的相互关系的问题，它仍然有一些局限性。首先，每当我们处理长句时，我们都会因为结构而丢失信息。其次，我们只允许作为最后一个编码器单元输出的上下文向量作为解码器的输入。这意味着我们可以在句子生成中释放语义信息和单词的依赖性。</p><p id="fecc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了解决以前方法的所有问题<a class="ae je" href="https://arxiv.org/pdf/1409.0473.pdf" rel="noopener ugc nofollow" target="_blank">，2016 年首次引入了注意力</a>。在这篇研究论文中，我们提到了如何使用<strong class="ih hj">注意力</strong>在输出生成中获取单词的语义信息和单词的相互关系。</p><p id="789a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们仔细比较一下传统编码器和解码器的架构。</p><p id="91db" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">编码器解码器架构</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/7530bac1f08216069985f0c6ea4a5ef2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-vXZQ5m-hLFExczc.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="http://www.wildml.com/2016/04/deep-learning-for-chatbots-part-1-introduction/" rel="noopener ugc nofollow" target="_blank">http://www . wild ml . com/2016/04/deep-learning-for-chatbots-part-1-introduction/</a></figcaption></figure><p id="2b70" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种架构中，以上下文向量的形式将最后一个编码器单元的输出提供给解码器。</p><p id="af16" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">关注编码器解码器架构</strong></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jv"><img src="../Images/482cc136bb59b372b663cc70d43c32c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*twMuiQiNSJr4l08l0l-3eQ.png"/></div></div></figure><p id="5610" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这种结构中，增加了关注层，编码器 RNN 单元每层的输出 Oi 给关注层，关注层的输出给解码器 RNN 单元。</p><p id="8498" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">第一个注意力是由 Dzmitry Bahdanau 引入的，这是附加注意力。目的改进 seq2seq 模型，增加注意事项。让我们一步步深入这个模型的实现。</p><h2 id="9fa0" class="jw jx hi bd jy jz ka kb kc kd ke kf kg iq kh ki kj iu kk kl km iy kn ko kp kq bi translated">1)编码器</h2><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kr"><img src="../Images/d842ab824e02676ea3adf25058394973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bWb8g_P7OlRrW1vNxnXU5w.png"/></div></div></figure><p id="ffef" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">编码器结构与 seq2seq 架构相同。在这里，根据上面提到的研究论文<a class="ae je" href="https://jaimin-ml2001.medium.com/what-does-it-mean-by-bidirectional-lstm-63d6838e34d9?source=your_stories_page" rel="noopener">双向</a> RNN 细胞被纳入架构。</p><p id="d8e3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">输入给每个 RNN 单元，每个 RNN 单元 Oi 的状态被发送到下一层，如下图所示。</p><p id="aa49" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">tensor flow 中编码器的代码实现</strong></p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="45ee" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们已经使用<strong class="ih hj"> tf.keras </strong>建立编码器模型。我们使用了<strong class="ih hj"> __init__ </strong>方法和<strong class="ih hj"> call </strong>方法来构建编码器架构。在 Encoder 类中，我们定义了一个初始化隐藏状态的方法。在 __init__ 方法中，我们定义了在这个架构中需要的层。例如，嵌入和 GRU 层。我们还添加了构建这一层所需的参数。我们添加了以下参数。</p><ol class=""><li id="6eb0" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated">batch_size:这是在每个时期传递的数据的大小。该参数会对模型性能产生很大影响</li><li id="0847" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">vocab_size:训练数据集中唯一单词的总数</li><li id="aa72" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">enc _ units:LSTM/GRU 单位总数</li><li id="4118" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated">embedding_dim:这个参数影响模型的计算能力。这表示嵌入层的尺寸，其在下一阶段被传递到 LSTM/ GRU 层。</li></ol><p id="9619" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 call 方法中，我们刚刚通过了遵循该方法的过程。在前向传播路径中，输入被获取并传递到嵌入层。然后嵌入数据和初始隐藏状态被传递到 LSTM/GRU 层。</p><p id="a233" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2)注意机制</strong></p><p id="8565" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意力的目标是为解码者获取上下文信息。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es li"><img src="../Images/f3e8219bba17d197052ccf377f2a1e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wUDagqYaaYoBJjgrJ5JRUQ.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">注意机制的前馈神经网络</figcaption></figure><p id="4ea5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该机制将识别每个输入 X1、X2、X3、X4 的权重。例如，上下文向量 C2 依赖于 X2 和 X4 输入，那么它将降低 X1 和 X3 的权重。这样，注意力就集中在输入数据上，并与解码器的隐藏状态一起传递给解码器。</p><p id="fd8d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们基于编码器的每个 RNN 单元处的权重α输入输出 O1 来计算上下文向量。上下文向量<strong class="ih hj"> C </strong>可以通过以下公式计算。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es lj"><img src="../Images/711de1c18ae0ecd7f93a6019820a4003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*Y0h9Azr9qBIKXRyZFaetaQ.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated">上下文向量 C1 计算</figcaption></figure><p id="113d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，yt 的上下文向量可以根据研究论文用下面的公式计算。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lk"><img src="../Images/8438462dcdfe81159d6b696ffa91f2ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*qfzWha60GG1MbQhWWt5wDg.png"/></div></div></figure><p id="eb9c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">Ci 是上下文向量</p><p id="33c4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">αij 是校准权重</p><p id="ba0b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">上下文向量是由对齐分数加权的隐藏状态的简单和。这里，我们讨论的是加法注意，称为 Bahdanau 的注意和另一个是乘法注意，称为 Luong 的注意。<strong class="ih hj">当我们开始关注时，需要注意的一点是，αij 应该≥ 0，因为不需要与负权重成负关系。此外，αij 的总和应该= 1 </strong>。每个注释 hj 的权重αij 计算如下</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es ll"><img src="../Images/605434a6433472c4f58125d076b9541e.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*Y2f_EhlQrJRTHNn9t54zLw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="https://arxiv.org/pdf/1409.0473.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1409.0473.pdf</a></figcaption></figure><p id="5b5c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个等式有点像<strong class="ih hj"> Softmax </strong>函数<strong class="ih hj">输出</strong> <strong class="ih hj">范围</strong>将从 0 到 1，所有概率的总和将等于一，满足上述规则。所以，下一个术语是起着举足轻重作用的 eij 被称为<strong class="ih hj">注意功能。</strong>注意函数的公式表示为</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es lm"><img src="../Images/1cc26ab832716623edc0f5b5ba1c7626.png" data-original-src="https://miro.medium.com/v2/resize:fit:516/format:webp/1*M1d5lYo47o6UCKdRHvohGQ.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="https://arxiv.org/pdf/1409.0473.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1409.0473.pdf</a></figcaption></figure><p id="e5d3" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">eij，它对第 j 个位置的输入和第 I 个位置的输出的匹配程度进行评分。编码器输出 hj 和前一单元 si-1 的解码器隐藏状态将计算注意力得分。根据研究论文，eij 实际上是用以下公式计算的。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es ln"><img src="../Images/89c07c03b55d2a7c7af45144017d4c49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*5MJDyH9bnjtefG_kEbLylQ.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx translated"><a class="ae je" href="https://arxiv.org/pdf/1409.0473.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1409.0473.pdf</a></figcaption></figure><p id="aafe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">其中，Wa，Ua 和 va ∈ R n 是权重矩阵。整个过程如下图所示。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lo"><img src="../Images/768374145b5b0ea75dc274e743a95a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y3SgeT2bnlujd5y4be3lLg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx translated">注意机制是如何一步步运作的</figcaption></figure><p id="eba2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">tensor flow</strong>中 Bahdanau 的 <strong class="ih hj">注意</strong> <strong class="ih hj">的代码实现</strong></p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="337c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在 BahdanauAtenntion 类中，与嵌入层一样，我们创建了 init 和 call 方法。在 init 方法中，创建了 3 个密集层，即 W1、W2 和 v。如上图所示，根据公式，这两个指标都用作 Wa 和 Ua。我们将编码器输出和解码器当前状态传递给 W1 和 W2。</p><p id="a66b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在调用方法 W1 和 W2 中给出了查询和值，它们分别是隐藏状态和编码器输出。然后使用 tanh 函数计算分数，并将该分数传递给 softmax 函数以生成注意力权重。最后，使用注意力权重和值来生成上下文向量 Ci。</p><p id="1e13" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3)解码器</strong></p><p id="ec27" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解码器模型与<a class="ae je" href="https://jaimin-ml2001.medium.com/encoder-decoder-model-for-machine-translation-8a90be12ac32?source=your_stories_page" rel="noopener">编码器解码器</a>文章中描述的相同，唯一不同的是添加了注意层，因此解码器的输入分别改变。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es lp"><img src="../Images/cabd8b9da8c96d60e4f87ada8a275536.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mZMuvC5-0Uuwzfwr0opZZQ.png"/></div></div></figure><p id="d95f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，根据编码器输出和解码器隐藏状态 St-1 计算输入上下文向量 Ci。然后，具有输出 Y 的上下文向量作为输入被提供给 RNN 单元。这就是解码器架构的不同。</p><p id="d35d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">tensor flow</strong>中解码器 <strong class="ih hj">的代码实现</strong></p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="ks kt l"/></div></figure><p id="121b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，我们创建了相同的 init 和 call 方法。在 init 方法中，我们按照通用解码器架构传递嵌入、GRU 和密集层。注意，在 call 方法中，我们使用上下文向量和 attention_weights 作为输出来启动注意力层。然后，上下文向量与解码器输入连接。这是给 GRU 和全连接层的最终输出。输出被给定为 x，state 和 attention_weights，它们将被用于调整反向传播中的权重。</p><p id="a6f7" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在这篇博客中，我们已经讨论了带注意机制的编码器和解码器。<strong class="ih hj">在</strong> <a class="ae je" href="https://jaimin-ml2001.medium.com/the-transformers-in-nlp-d0ee42c78e00?source=your_stories_page-------------------------------------" rel="noopener"> <strong class="ih hj">下一篇</strong> </a> <strong class="ih hj">中，我将在上面提到的架构基础上添加变压器架构。</strong></p><p id="a8d2" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> <em class="jd">随时欢迎建议。</em>T11】</strong></p><p id="947e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">参考文献</strong></p><ol class=""><li id="20e8" class="ku kv hi ih b ii ij im in iq kw iu kx iy ky jc kz la lb lc bi translated"><a class="ae je" href="https://www.tensorflow.org/tutorials/text/nmt_with_attention" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tutorials/text/NMT _ with _ attention</a></li><li id="6543" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae je" href="https://jalammar.github.io/visualizing-neural-machine-translation-mechanics-of-seq2seq-models-with-attention/" rel="noopener ugc nofollow" target="_blank">https://jalammar . github . io/visualizing-neural-machine-translation-mechanics-of-seq 2 seq-models-with-attention/</a></li><li id="0150" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae je" href="https://towardsdatascience.com/sequence-to-sequence-models-attention-network-using-tensorflow-2-d900cc127bbe" rel="noopener" target="_blank">https://towards data science . com/sequence-to-sequence-models-attention-network-using-tensor flow-2-d 900 cc 127 bbe</a></li><li id="61ad" class="ku kv hi ih b ii ld im le iq lf iu lg iy lh jc kz la lb lc bi translated"><a class="ae je" href="https://arxiv.org/pdf/1409.0473.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1409.0473.pdf</a></li></ol></div></div>    
</body>
</html>