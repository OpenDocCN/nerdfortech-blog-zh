<html>
<head>
<title>Deploying A Docker Container to an AWS Cluster Using Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Terraform将Docker容器部署到AWS集群</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/deploying-a-docker-container-to-an-aws-cluster-using-terraform-bffac19716d0?source=collection_archive---------0-----------------------#2022-05-31">https://medium.com/nerd-for-tech/deploying-a-docker-container-to-an-aws-cluster-using-terraform-bffac19716d0?source=collection_archive---------0-----------------------#2022-05-31</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/0cc16d1b8a0d1989a5bb32ce48242bb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/format:webp/1*JI0de16BwMvAqW72dsJpAA.png"/></div></div></figure><p id="98cd" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">这是一个初学者友好而广泛的使用Terraform将docker容器部署到AWS ECS集群的演练。但是在我们开始主要活动之前，我们必须先完成一些日常事务。</p><p id="7799" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">基础设施即代码:</em> </strong>顾名思义就是将您的基础设施部署为代码。更具体的可读代码。从某种意义上说，它不是一种编程语言，但更像是一套关于如何建立和维护基础设施的易于遵循的指令。这类似于说“嘿，Siri播放…”。抓住我的要点。</p><p id="9818" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo"> Terraform: </em> </strong>是一个开源的基础设施代码工具，用于提供完整的云基础设施。</p><p id="78d3" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo"> Docker: </em> </strong>是一个开源平台，允许开发者在可以在主机操作系统上运行的容器上轻松构建和部署他们的应用。简单地说，Docker解决了一个老问题:“它不能在我的操作系统或机器上运行”。</p><p id="40c2" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo"> AWS ECS: </em> </strong>据<a class="ae jp" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/ecs/</a>称，亚马逊ECS是一种完全托管的容器编排服务，让您可以轻松部署、管理和扩展容器化的应用程序。</p><p id="18da" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">既然我们已经讨论了细节，让我们开始我们的项目吧。</p><p id="c8b7" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">要求:</em> </strong></p><p id="5685" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.从Docker注册表中调出centos图像。</p><p id="f53c" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.使用docker映像和terraform创建ecs集群。</p><p id="ee66" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">先决条件:</em> </strong></p><p id="55bc" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">1.您选择的IDE。</p><p id="4080" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">2.AWS账户。</p><p id="bf08" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">3.已经安装并配置了Terraform。</p><p id="9d42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第0步:创建目录。</em>T29】</strong></p><p id="14ad" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">我假设和我一样，你们这些读者可能正在从事许多不同的项目。为了保持有序，必须创建一个新的文件夹或目录。如果使用Cloud9作为您的IDE，这可以通过两种方式完成:右键单击并选择“<strong class="is hj"> <em class="jo">新文件夹</em> </strong>”或在IDE的终端部分输入命令“<strong class="is hj"> <em class="jo"> mkdir </em> </strong>”。(参考下图)。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es jq"><img src="../Images/2556edc83c99310c6d24cb27cc6742e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*WG_4TAJyJpWJyhnoqcluTw.png"/></div></figure><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es jv"><img src="../Images/0b207a813cc755ba174df25c405f94c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*WBPMF560zObWSoBB25l-Vw.png"/></div></figure><p id="49c5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第一步:创建附带文件。</em>T41】</strong></p><p id="6664" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建文件夹或目录后，在所述目录中创建以下文件:providers.tf、variables.tf、vpc.tf、subnets.tf、main.tf、terraform.tfvars和last .gitignore。这些文件可以通过右键单击并选择“<strong class="is hj"> <em class="jo">新文件</em> </strong>”或通过在IDE的终端部分输入命令“<strong class="is hj"> <em class="jo">触摸filename.tf </em> </strong>”来创建。(参考下图)。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es jw"><img src="../Images/d2f8caae6c2169578a1daae00f65e15e.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*nVLsLJ32063Dt2rPl1lv2Q.png"/></div></figure><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/de683ff4ca09f2ab66867bc04f6abdaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKxV9qDFi9vbAV4iY7beaA.png"/></div></div></figure><p id="5acb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第二步:providers.tf. </em> </strong></p><p id="484b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">根据Terraform.io提供者是允许Terraform与服务、云提供者和其他API交互的插件。简单地说，可以把它看作是Terraform和其他服务之间的桥梁。考虑到我们从Docker中提取映像并将其部署到AWS集群，我们需要确保这两个服务都被列为我们的提供者。我们的访问密钥和秘密密钥是作为变量输入的，具体原因我们稍后会谈到。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="6c18" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第三步:variables.tf. </em> </strong></p><p id="842b" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">什么是变量。与大多数编程语言类似，变量是赋值或传递值的一种方式。在这个文件中，我们设置了我们的区域，我们的CIDR块，以及我们的访问和密钥。说到access和secret key，变量. tf将存放在我们的repo中，其他人可以看到，我们的access和secret的值不会在这个文件中赋值。相反，这些值将存储在terraform.tfvars中。Sensitive将设置为= true，以避免显示任何敏感信息。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="72cf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第四步:VPC . TF&amp;subnets . TF .</em></strong></p><p id="cfaf" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">当使用ECS部署容器时，强烈建议在vpc内部进行。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="0697" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第五步:main.tf </em> </strong></p><p id="ef51" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">要创建你的main.tf文件，点击下面的<a class="ae jp" href="https://registry.terraform.io/modules/umotif-public/ecs-fargate/aws/latest" rel="noopener ugc nofollow" target="_blank">链接</a>，并用作参考。</p><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="8b42" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第六步:terraform.tfvars &amp;。git ignore</em>T29】</strong></p><p id="8c74" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">。gitignore是一个文件文本，它告诉Git在向Github提交项目时要忽略哪些文件或目录。我们的terraform.tfvars文件将被忽略，因为它包含我们的密钥和访问密钥。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div class="er es ka"><img src="../Images/71bbecb460ff39272c9d3fdbe4dbea72.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/format:webp/1*_8lUvrcvbsOfaL-tbV4svw.png"/></div></figure><figure class="jr js jt ju fd ij"><div class="bz dy l di"><div class="jy jz l"/></div></figure><p id="c65e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">请注意，将我们的密钥和访问密钥添加到variable.tf文件中，并通过terraform.tfvars传递这些值，肯定会帮助您在尝试部署集群时避免IAM错误。</p><p id="6a3e" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第七步:命令</em> </strong></p><p id="4d22" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">创建完所有文件后，请从终端运行以下命令。</p><p id="096a" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform init —为了初始化包含Terraform代码的工作目录</p><p id="2fc5" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform计划—用于在执行我们的terraform代码之前预览我们的基础设施。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/2754ce92331e6b963f39010d66a5ac46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bhxcfI4LhWFvOu4ADHN8Hw.png"/></div></div></figure><p id="66d0" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">Terraform apply —用于将计划中指定的所有更改应用到motion中。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/da6628c86120921fd9023e98b4b01a9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oFGNCy58K-V8xbDykiGzPQ.png"/></div></div></figure><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/46d4382de6062149754fa4c976640f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1UcY7T1O71kepOy6UBmlcQ.png"/></div></div></figure><p id="eb8f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第八步:在</em>控制台再次检查</strong></p><p id="e074" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">现在让我们转向管理控制台，以确保我们所有的资源都已创建。在搜索栏上，键入ECS，在显示ECS控制面板后，单击“cluster”检查您的群集是否已创建。瞧啊。！！</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/1e6d2d4ab9a2a82ceb81b578a608e468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_J0L5x8NE1yHDL9Vd0r_A.png"/></div></div></figure><p id="8781" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated"><strong class="is hj"> <em class="jo">第九步:消灭。</em> </strong></p><p id="2454" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">一旦您确认成功创建了资源，为了避免不必要的费用，请确保销毁所有资源。这可以通过在终端中输入Terraform destroy命令来实现。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ke"><img src="../Images/8cec4b2808b439a2cce0febbca49357b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W-HlZTXYUlWmegeMhslEgQ.png"/></div></div></figure><p id="69b1" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">旁注:养成将代码提交给回购的习惯。从经验上来说，这样做的习惯肯定能帮你省下一些心痛和时间。这可以通过输入:git commit -m命令，然后输入git push命令来完成。</p><figure class="jr js jt ju fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kf"><img src="../Images/3ed3932c1c706f93760abca3966e7eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFu0YK0GWciggbQd-99dIA.jpeg"/></div></div></figure><p id="a20d" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">如果您已经做到了这一步，并且遵循了上面的步骤，那么您已经成功地并且应该知道如何使用Terraform将Docker容器部署到AWS ECS集群</p><p id="89cb" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">谢谢你的时间</p><p id="9396" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">直到下一次，</p><p id="6c0f" class="pw-post-body-paragraph iq ir hi is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn hb bi translated">你友好的邻居云开发工程师。</p></div></div>    
</body>
</html>