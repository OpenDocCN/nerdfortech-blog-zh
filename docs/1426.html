<html>
<head>
<title>Jetpack Compose — Curtain Effect</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">喷气背包组合—窗帘效果</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/jetpack-compose-curtain-effect-43323d537cc1?source=collection_archive---------7-----------------------#2021-03-18">https://medium.com/nerd-for-tech/jetpack-compose-curtain-effect-43323d537cc1?source=collection_archive---------7-----------------------#2021-03-18</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/2c85c641c34e7001ad36aea8024338bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*4aLXd7SzSUlwi13e5Dn9DA.png"/></div></figure><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es im"><img src="../Images/c3d117c27a7452b9e89dd18f963efd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*lEJZCnX_AOB4DFz0tWinrw.gif"/></div></figure><p id="ed1d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">在这篇文章中，我将向你展示如何用你想要的任何组件创建一个<strong class="it hj">窗帘效果</strong>。</p><h1 id="f1e4" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">重要方面</strong></h1><ul class=""><li id="ff7d" class="kn ko hi it b iu kp iy kq jc kr jg ks jk kt jo ku kv kw kx bi translated">默认状态下出现的主单元格</li><li id="bf64" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">您想用折叠效果动画显示多少单元格就显示多少单元格</li><li id="6267" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">满容器总是根据你给它的内容包装它的大小。</li></ul><h1 id="be7d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated"><strong class="ak">应该给用户提供多少定制？</strong></h1><p id="d6af" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">首先我做了一个简单的需求分析。</p><ol class=""><li id="2549" class="kn ko hi it b iu iv iy iz jc lg jg lh jk li jo lj kv kw kx bi translated">作为一个用户，我希望能够以手动方式<strong class="it hj">打开<em class="lk">窗帘</em>，从可组合的外部，或者通过点击它</strong>。</li><li id="0c31" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo lj kv kw kx bi translated">作为用户，我希望能够自定义<strong class="it hj">折叠动画的</strong> <strong class="it hj">持续时间的单元格</strong>；</li><li id="c337" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo lj kv kw kx bi translated">作为用户，我想自由地定制主单元格和所有的折叠单元格。</li></ol><p id="85dc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">因此，通过了解这些需求，我决定了窗帘上的参数应该是可组合的。</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><pre class="in io ip iq fd ln lo lp lq aw lr bi"><span id="2f19" class="ls jq hi lo b fi lt lu l lv lw">isOpenedFromOutside: Boolean? = null</span></pre><p id="9a39" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果该参数具有除 null 之外的任何值，则意味着用户正在从可组合组件之外控制窗帘。</p><pre class="in io ip iq fd ln lo lp lq aw lr bi"><span id="28a6" class="ls jq hi lo b fi lt lu l lv lw">foldingDuration: Int = 250</span></pre><p id="d862" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我想我真的不需要描述这个。</p><pre class="in io ip iq fd ln lo lp lq aw lr bi"><span id="aa8d" class="ls jq hi lo b fi lt lu l lv lw">mainCell: @Composable () -&gt; Unit</span></pre><p id="8089" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">主单元格可组合内容，可由用户自定义。</p><pre class="in io ip iq fd ln lo lp lq aw lr bi"><span id="4c97" class="ls jq hi lo b fi lt lu l lv lw">foldCells: List&lt;@Composable () -&gt; Unit&gt;</span></pre><p id="0edd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">所有的单元格，将出现在当窗帘打开，完全由用户定制。</p><h1 id="69f4" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">窗帘状态</h1><p id="92d7" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">为了通过打开和关闭窗帘来激活单元，我必须跟踪状态(<strong class="it hj">打开||关闭</strong>)。为了实现这一点，使用了<strong class="it hj"> <em class="lk">记住</em> </strong>函数，该函数在重新编译期间跟踪一个值。</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="b30f" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">主单元，应该在幕布“关闭”时显示。</p><p id="e3dc" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这意味着我需要让细胞知道窗帘的状态，窗帘可以打开或关闭。</p><h1 id="53d5" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">窗帘切换-非手动方式</h1><p id="ff4b" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">切换窗帘，就像<strong class="it hj">将</strong> <strong class="it hj">【等宽】</strong> <strong class="it hj">变量改为</strong> <strong class="it hj">假或真</strong>一样简单。</p><p id="9811" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，我需要考虑一些事情。</p><p id="c1b1" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">为了避免打开/关闭窗帘时出现任何错误，我需要<strong class="it hj">跟踪动画状态</strong>。因此，窗帘只能在<strong class="it hj">完全打开或完全关闭时打开。</strong></p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><ul class=""><li id="6618" class="kn ko hi it b iu iv iy iz jc lg jg lh jk li jo ku kv kw kx bi translated">只有当转换<strong class="it hj">没有运行</strong>时，窗帘才能打开。</li><li id="3765" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">如果过渡没有运行，我们通过切换<strong class="it hj">幕帘状态‘等开’</strong>来启动它。</li><li id="3991" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">为了将<strong class="it hj">过渡状态‘is transition running’</strong>变回 false，我们使用了一个<strong class="it hj">协程作用域‘fold scope’</strong>来延迟这个变化，延迟量为<strong class="it hj">每个单元的折叠持续时间*单元数量(窗帘效果的总持续时间)</strong>。</li></ul><h1 id="73a7" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">窗帘开关—手动方式</h1><p id="82c6" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">如果用户想从外面完全控制窗帘状态，我们只需要检查参数<strong class="it hj">‘isOpenedFromOutside’</strong>，如果它有值，我们就更新窗帘状态。</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="7c97" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">布局</h1><p id="9f1e" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">作为布局，我使用了一个带有自定义修改器功能的框。</p><p id="affd" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">这用于决定窗帘是否可点击。</p><p id="4218" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果参数<strong class="it hj"> 'isOpenedFromOutside' </strong>为<strong class="it hj"> not null </strong>，则意味着窗帘是外部控制的，所以窗帘是不可点击的。</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="cc4d" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">主电池</h1><p id="263c" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">我决定每当窗帘状态改变时，用一个<strong class="it hj">‘update transition’</strong>来改变它的 alpha。</p><blockquote class="lx ly lz"><p id="f74a" class="ir is lk it b iu iv iw ix iy iz ja jb ma jd je jf mb jh ji jj mc jl jm jn jo hb bi translated"><strong class="it hj">更新过渡:</strong></p><p id="bf48" class="ir is lk it b iu iv iw ix iy iz ja jb ma jd je jf mb jh ji jj mc jl jm jn jo hb bi translated">这将建立一个转换，并用 targetState 提供的目标更新它。当 targetState 更改时，Transition 将朝着为新 targetState 指定的目标值运行其所有子动画。</p></blockquote><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="f8c6" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">阿尔法动画:</strong></p><ul class=""><li id="fbc8" class="kn ko hi it b iu iv iy iz jc lg jg lh jk li jo ku kv kw kx bi translated"><strong class="it hj"> 0f (0%) Alpha 如果关闭；</strong></li><li id="3608" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated"><strong class="it hj"> 1f (100%) Alpha 如果打开；</strong></li><li id="6b35" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">持续时间为 100 毫秒；</li><li id="8080" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">如果正在拉开窗帘，则不会应用延迟；</li><li id="edf8" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">如果窗帘正在关闭，它将被延迟每个单元格*单元格数量的<strong class="it hj">折叠持续时间(窗帘效果的总持续时间)。</strong>这意味着只有当所有的单元格都被隐藏时才会出现；</li><li id="eb6a" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">应用于主单元格周围的框修饰符。</li></ul><h1 id="f8b4" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">折叠单元格</h1><p id="0f2f" class="pw-post-body-paragraph ir is hi it b iu kp iw ix iy kq ja jb jc ld je jf jg le ji jj jk lf jm jn jo hb bi translated">折叠的单元格位于可组合的列内(垂直方向)</p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="2c61" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">现在，最复杂的部分，每个<strong class="it hj">折叠细胞。</strong></p><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><p id="a29b" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">要显示每个折叠的单元格:</p><ul class=""><li id="6b0b" class="kn ko hi it b iu iv iy iz jc lg jg lh jk li jo ku kv kw kx bi translated">我们需要计算每个单元格的最大高度来控制它的大小；</li><li id="ca0c" class="kn ko hi it b iu ky iy kz jc la jg lb jk lc jo ku kv kw kx bi translated">我们再次使用<strong class="it hj">‘update transition’</strong>，根据窗帘是打开还是关闭来控制单元格的旋转、alpha 和大小值。</li></ul><p id="63ec" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">我决定使用布局 Composable，以便更好地控制每个单元格的最大高度。</p><p id="a862" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">测量内容后，<strong class="it hj"> 'cellMaxHeight' </strong>变量根据内容最大高度进行更新，这将影响最大尺寸动画。</p><h1 id="8a20" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用</h1><figure class="in io ip iq fd ij"><div class="bz dy l di"><div class="ll lm l"/></div></figure><h1 id="4a77" class="jp jq hi bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">决赛成绩</h1><figure class="in io ip iq fd ij er es paragraph-image"><div class="er es im"><img src="../Images/c3d117c27a7452b9e89dd18f963efd81.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/1*lEJZCnX_AOB4DFz0tWinrw.gif"/></div></figure><p id="a54e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">储存库:</strong></p><p id="fe54" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><a class="ae md" href="https://github.com/pauloaapereira/Medium_JetpackCompose_CurtainEffect" rel="noopener ugc nofollow" target="_blank">https://github . com/pauloaapereira/Medium _ JetpackCompose _ current effect</a></p><p id="691e" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">领英:</strong><br/><a class="ae md" href="https://www.linkedin.com/in/paulo-pereira-001615153/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/paulo-pereira-001615153/</a></p><p id="3916" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated"><strong class="it hj">推特:</strong><br/><a class="ae md" href="https://twitter.com/pauloppereiraa" rel="noopener ugc nofollow" target="_blank">https://twitter.com/pauloppereiraa</a></p><p id="9f61" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">如果你喜欢，如果这对你有帮助，你也可以考虑请我喝杯咖啡。:]</p><p id="aa6d" class="pw-post-body-paragraph ir is hi it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hb bi translated">谢谢大家！</p></div></div>    
</body>
</html>