<html>
<head>
<title>Nested RecyclerView In Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中的嵌套回收视图</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/nested-recyclerview-in-android-e5afb2b9771a?source=collection_archive---------0-----------------------#2021-05-26">https://medium.com/nerd-for-tech/nested-recyclerview-in-android-e5afb2b9771a?source=collection_archive---------0-----------------------#2021-05-26</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="057c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">实现嵌套recyclerview及其优化的完美指南。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4deb54218cebf3a7cd550713e7624bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqjP2dOzkxqs2iphhsxZ2Q.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">作者照片——尼泊尔甘德鲁克</figcaption></figure><p id="0424" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">💥你好，在这篇文章中我们将实现一个嵌套的<strong class="ih hj"> recyclerview。</strong>我们将学习如何在实时项目中精确地嵌套<strong class="ih hj"> recyclerview </strong>，并学习如何适当地优化它。</p><p id="ce42" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我们可以在另一个<strong class="ih hj">回收视图</strong>中使用一个<strong class="ih hj">回收视图</strong>。我们称之为嵌套<strong class="ih hj">回收视图</strong>。这里有一些嵌套的<strong class="ih hj">recycle view</strong>应用程序的图片。</p><div class="je jf jg jh fd ab cb"><figure class="jt ji ju jv jw jx jy paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/833b15c9ee748f2ce1701f339e6f3b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/0*qi6v5t5sxQxzsAs_"/></div></figure><figure class="jt ji jz jv jw jx jy paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/e9145e92fb13671a1deb3422500c35bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*iYg81RuLA4DTKLQpk8ghSQ.png"/></div></figure><figure class="jt ji jz jv jw jx jy paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/22023c5d1a5bc46d08c828c8b81dbc09.png" data-original-src="https://miro.medium.com/v2/resize:fit:650/format:webp/1*F3QJeaKvITM7wA-_p51N9w.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx ka di kb kc translated">嵌套回收查看样本的图片-电子图书馆、Spotify、网飞</figcaption></figure></div><h1 id="a220" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">先决条件</h1><ul class=""><li id="7919" class="lb lc hi ih b ii ld im le iq lf iu lg iy lh jc li lj lk ll bi translated">科特林语</li><li id="0e30" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">回收视图</li><li id="acce" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">句柄依赖注入</li><li id="3ce7" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated">翻新2</li><li id="b8a3" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc li lj lk ll bi translated"><strong class="ih hj">API _ URL</strong>:<a class="ae lr" href="https://game-of-thrones-quotes.herokuapp.com/v1/houses" rel="noopener ugc nofollow" target="_blank">https://game-of-thrones-quotes.herokuapp.com/v1/<strong class="ih hj">房屋</strong> </a></li></ul><p id="6dfe" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">给我所有的代码👇</p><div class="ls lt ez fb lu lv"><a href="https://github.com/iamnaran/template-recycler-view" rel="noopener  ugc nofollow" target="_blank"><div class="lw ab dw"><div class="lx ab ly cl cj lz"><h2 class="bd hj fi z dy ma ea eb mb ed ef hh bi translated">iam naran/template-recycler-view</h2><div class="mc l"><h3 class="bd b fi z dy ma ea eb mb ed ef dx translated">回收视图。在GitHub上创建一个帐户，为iam naran/template-recycler-view开发做贡献。</h3></div><div class="md l"><p class="bd b fp z dy ma ea eb mb ed ef dx translated">github.com</p></div></div><div class="me l"><div class="mf l mg mh mi me mj jn lv"/></div></div></a></div><h2 id="e7bd" class="mk ke hi bd kf ml mm mn kj mo mp mq kn iq mr ms kr iu mt mu kv iy mv mw kz mx bi translated">我们开始吧，</h2><h1 id="9247" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤1 —设置模型和API数据</h1><p id="19c9" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq my is it iu mz iw ix iy na ja jb jc hb bi translated">一个API，它有一个对象列表和另一个对象的嵌套列表。看一下下面的<strong class="ih hj"> API响应，</strong>那里我们有<strong class="ih hj">权力的游戏</strong> <strong class="ih hj"> API </strong> <strong class="ih hj">列表</strong>，它有一个列表，里面有<strong class="ih hj">房屋的名称</strong>和它们的<strong class="ih hj">成员</strong>列表作为嵌套对象。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">API响应</figcaption></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es nd"><img src="../Images/853cc6cd8b343f559d072350ea32d327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppSNczxcmXw1CNdUgehmHQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx translated">应用结构和用户界面</figcaption></figure><blockquote class="ne nf ng"><p id="f3c2" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated">理解API结构很重要。我发现许多开发人员不能分析所需的API数据结构，这导致了糟糕的开发实践。在开始处理任何功能或模块之前，请始终了解数组[]、对象{}、模型/数据。</p></blockquote><p id="bb24" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们跳过鼓舞士气的谈话，开始正确编码吧！👍</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es nl"><img src="../Images/7c996d91a51fa72e6ce6e7250f687f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/0*nePNyEsRPaVsxf35.gif"/></div></figure><p id="47f9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">要从<strong class="ih hj"> JSON </strong>生成<strong class="ih hj"> KOTLIN </strong>模型，你可以在Android Studio中下载这些插件。</p><ol class=""><li id="888d" class="lb lc hi ih b ii ij im in iq nm iu nn iy no jc np lj lk ll bi translated">(<a class="ae lr" href="https://plugins.jetbrains.com/plugin/9960-json-to-kotlin-class-jsontokotlinclass-" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> JSON到Kotlin类</strong> </a>)</li><li id="2b92" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc np lj lk ll bi translated">(<a class="ae lr" href="https://www.jsonschema2pojo.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ih hj"> JSON转Java类</strong> </a>)</li></ol><blockquote class="ne nf ng"><p id="dfe0" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj">gameoftrones . kt</strong>—型号</p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">GameOfThrones模型</figcaption></figure><p id="a128" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，创建API服务以从<strong class="ih hj"> API </strong>获得响应。</p><blockquote class="ne nf ng"><p id="6f10" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><a class="ae lr" href="https://game-of-thrones-quotes.herokuapp.com/v1/houses" rel="noopener ugc nofollow" target="_blank">https://game-of-thrones-quotes.herokuapp.com/v1/<strong class="ih hj">房屋</strong>T51】</a></p></blockquote><p id="fe3a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">首先将我们的URL分解成<strong class="ih hj"> BASE_URL </strong> &amp; <strong class="ih hj">端点。</strong></p><pre class="je jf jg jh fd nq nr ns nt aw nu bi"><span id="2351" class="mk ke hi nr b fi nv nw l nx ny">buildConfigField 'String', 'BASE_URL', "\"<strong class="nr hj">https://game-of-thrones-quotes.herokuapp.com/v1/</strong>\""</span></pre><blockquote class="ne nf ng"><p id="9d13" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> ApiEndPoints.kt </strong></p></blockquote><pre class="je jf jg jh fd nq nr ns nt aw nu bi"><span id="8c82" class="mk ke hi nr b fi nv nw l nx ny">object ApiEndPoints {<br/><br/>   const val GAME_OF_THRONES_URL = "houses"<br/><br/>}</span></pre><blockquote class="ne nf ng"><p id="bea1" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> ApiService.kt </strong></p></blockquote><pre class="je jf jg jh fd nq nr ns nt aw nu bi"><span id="2134" class="mk ke hi nr b fi nv nw l nx ny">interface ApiService {<br/><br/>    @GET(ApiEndPoints.GAME_OF_THRONES_URL)<br/>    suspend fun getGameOfThronesData():Response&lt;List&lt;GameOfThrones&gt;&gt;<br/>}</span></pre><p id="8007" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们创建<strong class="ih hj"> ViewModel </strong>来从上面的API服务获得响应。</p><blockquote class="ne nf ng"><p id="356e" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> HomeViewModel.kt </strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="a942" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这里，<strong class="ih hj"> HomeRepository </strong>作为一个存储库类来获取我们的响应&amp; <strong class="ih hj"> PreferencesHelper </strong>作为一个帮助器类来存储<strong class="ih hj"> SharedPreference </strong>中的数据。你可以看看项目资源库，更清楚地了解它。</p><blockquote class="ne nf ng"><p id="fe71" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated">为了简单起见，存储在共享pref中，您可以通过将当前模型映射到房间/领域DB实体中并使用Dao将其插入来保存在房间数据库中。</p></blockquote><h1 id="878f" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤2—用户界面设置<strong class="ak"> (XML) </strong></h1><p id="caef" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq my is it iu mz iw ix iy na ja jb jc hb bi translated">这里，我们需要三种布局，</p><ol class=""><li id="d435" class="lb lc hi ih b ii ij im in iq nm iu nn iy no jc np lj lk ll bi translated">活动UI，用于工具栏和父回收视图</li><li id="b3f6" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc np lj lk ll bi translated">父RecyclerView的布局行项目—由<strong class="ih hj">标题</strong> &amp; <strong class="ih hj">子</strong> <strong class="ih hj"> recyclerview </strong>组成。</li><li id="c630" class="lb lc hi ih b ii lm im ln iq lo iu lp iy lq jc np lj lk ll bi translated">子RecyclerView的布局行项目。</li></ol><div class="je jf jg jh fd ab cb"><figure class="jt ji nz jv jw jx jy paragraph-image"><img src="../Images/c57eee785743317442b66a212188937a.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*JfCQxGX0t0-ztIkWtGl0mg.png"/></figure><figure class="jt ji oa jv jw jx jy paragraph-image"><img src="../Images/b85aa8ad2b484f06359bcfc46dfa94d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:560/format:webp/1*PYIyIxgMVsWdRvZrKr_iBQ.png"/></figure><figure class="jt ji ob jv jw jx jy paragraph-image"><img src="../Images/a807e522205d308236351ef500b105d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:562/format:webp/1*Tnt4b2y7Gfek5-Ji7It_Uw.png"/><figcaption class="jp jq et er es jr js bd b be z dx oc di od kc translated">三种布局(1–2–3):活动、父项和子项</figcaption></figure></div><blockquote class="ne nf ng"><p id="4eea" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> 1。activity_home.xml </strong></p></blockquote><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="2a2a" class="oh ke hi nr b be oi oj l ok ny">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.core.widget.NestedScrollView<br/>    xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"&gt;<br/>    <br/>    &lt;androidx.constraintlayout.widget.ConstraintLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:layout_marginStart="8dp"<br/>        android:layout_marginEnd="8dp"<br/>        android:fitsSystemWindows="true"&gt;<br/><br/>        &lt;include<br/>            android:id="@+id/title_layout"<br/>            layout="@layout/item_title_profile"<br/>            android:layout_width="0dp"<br/>            android:layout_height="wrap_content"<br/>            app:layout_constraintEnd_toEndOf="parent"<br/>            app:layout_constraintStart_toStartOf="parent"<br/>            app:layout_constraintTop_toTopOf="parent" /&gt;<br/><br/>        &lt;androidx.recyclerview.widget.RecyclerView<br/>            android:id="@+id/parent_recycler_view"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:clipToPadding="false"<br/>            android:paddingTop="10dp"<br/>            android:paddingBottom="60dp"<br/>            app:layout_constraintBottom_toBottomOf="parent"<br/>            app:layout_constraintTop_toBottomOf="@+id/title_layout" /&gt;<br/>    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;<br/>&lt;/androidx.core.widget.NestedScrollView&gt;</span></pre><blockquote class="ne nf ng"><p id="5052" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> 2。item_row_parent.xml </strong></p></blockquote><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="fbf1" class="oh ke hi nr b be oi oj l ok ny">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:layout_margin="15dp"<br/>    app:cardCornerRadius="10dp"<br/>    app:cardElevation="1dp"&gt;<br/><br/>    &lt;androidx.constraintlayout.widget.ConstraintLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"&gt;<br/><br/>        &lt;TextView<br/>            android:id="@+id/content_title"<br/>            android:layout_width="0dp"<br/>            android:layout_height="wrap_content"<br/>            android:layout_marginTop="10dp"<br/>            android:layout_marginBottom="10dp"<br/>            android:includeFontPadding="false"<br/>            android:padding="10dp"<br/>            android:text="House of Stark"<br/>            android:textSize="18sp"<br/>            android:textStyle="bold"<br/>            app:layout_constraintBottom_toBottomOf="parent"<br/>            app:layout_constraintEnd_toEndOf="parent"<br/>            app:layout_constraintHorizontal_bias="1.0"<br/>            app:layout_constraintStart_toStartOf="parent"<br/>            app:layout_constraintTop_toTopOf="parent"<br/>            app:layout_constraintVertical_bias="0.0" /&gt;<br/><br/>        &lt;androidx.recyclerview.widget.RecyclerView<br/>            android:id="@+id/child_recycler_view"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:padding="8dp"<br/>            app:layout_constraintEnd_toEndOf="parent"<br/>            app:layout_constraintStart_toStartOf="parent"<br/>            app:layout_constraintTop_toBottomOf="@+id/content_title" /&gt;<br/><br/>    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;<br/><br/>&lt;/androidx.cardview.widget.CardView&gt;</span></pre><blockquote class="ne nf ng"><p id="1a9a" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj"> 3。item_row_child.xml </strong></p></blockquote><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="2dc4" class="oh ke hi nr b be oi oj l ok ny">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;androidx.cardview.widget.CardView xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="wrap_content"<br/>    android:layout_margin="15dp"<br/>    app:cardCornerRadius="30dp"<br/>    app:cardElevation="5dp"<br/>    android:layout_height="wrap_content"&gt;<br/><br/>    &lt;androidx.constraintlayout.widget.ConstraintLayout<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"&gt;<br/><br/>        &lt;TextView<br/>            android:id="@+id/name"<br/>            android:layout_width="match_parent"<br/>            android:layout_height="wrap_content"<br/>            android:layout_marginTop="200dp"<br/>            android:padding="20dp"<br/>            android:text="Jon Snow"<br/>            android:textColor="@color/colorPrimaryText"<br/>            app:layout_constraintBottom_toBottomOf="parent" /&gt;<br/><br/>    &lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;<br/><br/>&lt;/androidx.cardview.widget.CardView&gt;</span></pre><h1 id="82b6" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">步骤3-设置适配器类</h1><p id="b043" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq my is it iu mz iw ix iy na ja jb jc hb bi translated">几个不同的类一起工作来构建我们的动态列表。这里我们有两个<strong class="ih hj">回收视图</strong>，这意味着我们需要两个适配器。您通过扩展<code class="du ol om on nr b"><a class="ae lr" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter" rel="noopener ugc nofollow" target="_blank">RecyclerView.Adapter</a></code>来定义适配器。您通过扩展<code class="du ol om on nr b"><a class="ae lr" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.ViewHolder" rel="noopener ugc nofollow" target="_blank">RecyclerView.ViewHolder</a></code>来定义视图固定器。<em class="nh">布局管理器</em>排列列表中的单个元素。</p><p id="a733" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">记住<strong class="ih hj">亲子概念</strong>。父适配器持有子适配器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es oo"><img src="../Images/cd9db931ebe931559312284377059208.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*q9ZIKVL-SrcBKFxl.gif"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">亲子插画<strong class="bd kf">👉</strong></figcaption></figure><p id="60ec" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们从创建子成员适配器开始，在这里我们将绘制来自每个家族<strong class="ih hj">的<strong class="ih hj">成员</strong>的列表。</strong></p><blockquote class="ne nf ng"><p id="9fd4" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj">childmembersdadapter . kt</strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="8737" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，让我们来处理我们的<strong class="ih hj">parenthood adapter</strong>，父<strong class="ih hj"> recyclerview </strong>适配器，我们将从其中调用我们的子适配器，如下所示。</p><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="cf08" class="oh ke hi nr b be oi oj l ok ny">fun bind(result: GameOfThrones) {<br/>    itemView.content_title.text = result.name<br/>    val childMembersAdapter = ChildMembersAdapter(result.members)<br/>    itemView.child_recycler_view.layoutManager = LinearLayoutManager(itemView.context, LinearLayoutManager.HORIZONTAL,false)<br/>    itemView.child_recycler_view.adapter = childMembersAdapter<br/><br/>}</span></pre><blockquote class="ne nf ng"><p id="d151" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><strong class="ih hj">圆括号Adapter.kt </strong></p></blockquote><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div></figure><h1 id="9b85" class="kd ke hi bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">最后一步—在视图中集成适配器</h1><p id="6493" class="pw-post-body-paragraph if ig hi ih b ii ld ik il im le io ip iq my is it iu mz iw ix iy na ja jb jc hb bi translated">我们已经准备好了适配器，在我们的<strong class="ih hj">活动</strong>中，我们正在观察<strong class="ih hj"> API响应，</strong>我们将在收到响应后向适配器添加数据。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="nb nc l"/></div></figure><p id="02b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">最后，我们现在可以看到所有房屋及其成员，</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es op"><img src="../Images/7b6088c22c1e748ef84acd2e23277a1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*ipmaXSsl4gDx6Pw4jJSGKg.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx translated">嗯（表示踌躇等）..输出</figcaption></figure><p id="ba9d" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，您就实现了嵌套的recycler-view。恭喜你！现在，你可以为子/父回收器视图项目制作自己的<strong class="ih hj">精美UI </strong>。</p></div><div class="ab cl oq or gp os" role="separator"><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov ow"/><span class="ot bw bk ou ov"/></div><div class="hb hc hd he hf"><h1 id="9aad" class="kd ke hi bd kf kg ox ki kj kk oy km kn ko oz kq kr ks pa ku kv kw pb ky kz la bi translated">最后..让我们来谈谈优化</h1><blockquote class="ne nf ng"><p id="0e57" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated">如果实施不当，recycle view可能会非常滞后。它应该在它的peek性能上工作，否则我们会在滚动时感觉到故障。其性能取决于<strong class="ih hj">设计</strong>、<strong class="ih hj">数据</strong>、<strong class="ih hj">计算</strong>和<strong class="ih hj">实现</strong>。</p></blockquote><p id="882e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们找出一些在使用<strong class="ih hj"> RecyclerView </strong>保持其性能时需要记住的技巧。⚠️</p><ol class=""><li id="2009" class="lb lc hi ih b ii ij im in iq nm iu nn iy no jc np lj lk ll bi translated"><strong class="ih hj">切勿将Recyclerview与NestedScrollView一起使用。</strong></li></ol><p id="12c9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因为recycle view意味着在滚动时回收视图，只有可见的项目被呈现。但是当与NestedScrollView一起使用时，它将避免回收视图。您可以使用带有recyclerview或<a class="ae lr" href="https://developer.android.com/reference/androidx/recyclerview/widget/ConcatAdapter" rel="noopener ugc nofollow" target="_blank">T22】concat adapters</a>的多视图类型来完全删除NestedScrollView。</p><p id="16e4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 2。避免繁重的计算&amp;在Recyclerview项目中嵌套视图。</strong></p><p id="2403" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">onBindViewHolder中的计算逻辑不理想。在recyclerview中绘制数据之前，在模型中进行复杂的计算。使用最少的视图组/布局使你的用户界面尽可能简单。recycle view项目中嵌套视图过多&amp;计算会降低其性能，因为recycle view的可见项目中会出现大量渲染。</p><p id="20b5" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 3。将ListAdapter与DiffUtil/async different一起使用</strong></p><p id="bc1e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">使用DiffCallbacks将完全删除notifyDatasetChanged，这将避免重新计算和重新呈现所有视图，它只会更改需要更改的数据。</p><p id="b185" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="nh">还要告诉recyclerview你的物品有唯一ID。这将减少数据集通知上的闪烁效应，在数据集通知中，它只修改有更改的项目。</em></p><p id="aa8c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ol om on nr b">parentAdapter.setHasStableIds(true)</code></p><p id="4a95" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">4.<strong class="ih hj">使用RecycledViewPool </strong></p><p id="7709" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">它允许您在多个RecyclerViews之间共享视图。如果您想要跨recycle views回收视图，请创建RecycledViewPool的一个实例并使用<code class="du ol om on nr b"><a class="ae lr" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView#setRecycledViewPool(androidx.recyclerview.widget.RecyclerView.RecycledViewPool)" rel="noopener ugc nofollow" target="_blank">setRecycledViewPool</a></code>。</p><p id="f967" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ol om on nr b">viewHolder.childRecyclerView.setRecycledViewPool(viewPool)</code></p><p id="6193" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 5。使用项目视图缓存大小</strong></p><p id="9abc" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在将屏幕外视图添加到可能共享的回收视图池之前，设置要保留的屏幕外视图的数量。</p><p id="f592" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ol om on nr b">parentRecyclerView.setItemViewCacheSize(cacheSize)</code></p><p id="d50a" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 6。设置项目预取使能</strong></p><p id="801e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">设置collectInitialPrefetchPositions(int，LayoutPrefetchRegistry)中要预取的项数，它定义当此LayoutManager的recycle view嵌套在另一个recycle view中时应预取多少个内部项。</p><p id="b672" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><code class="du ol om on nr b">childRecyclerView.setItemPrefetchEnabled(true)</code></p><p id="17ce" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 7。如果scroll在垂直嵌套Recyclerview上截取，可以用layoutManger禁用它。</strong></p><pre class="je jf jg jh fd nq nr ns nt aw nu bi"><span id="e651" class="mk ke hi nr b fi nv nw l nx ny">linearLayoutManager {<br/>    @Override<br/>    public boolean canScrollVertically() {<br/>        return false;<br/>    }<br/>};</span></pre><p id="30ea" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 8。如果RecyclerView在更新时闪烁</strong></p><pre class="je jf jg jh fd nq nr ns nt aw nu bi"><span id="7268" class="mk ke hi nr b fi nv nw l nx ny">binding.recyclerViewContainer.setItemAnimator(null);</span></pre><p id="0a44" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj"> 9。如果您正在从房间数据库观察LiveData/Flowable并绘制嵌套的recyclerview视图。</strong></p><p id="397e" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">每当您观察到来自房间表&amp; recyclerview的数据列表滚动时，就会从房间中连续提取新数据，这将不得不更新整个recyclerview，在这种情况下，嵌套的recyclerview会再次初始化。这种<strong class="ih hj">“从房间连续获取”</strong>从未停止，这将降低recyclerview的性能。我们可以改进ListAdapter &amp;，但是在嵌套适配器上提交列表将是一项繁重的任务。</p><blockquote class="ne nf ng"><p id="9521" class="if ig nh ih b ii ij ik il im in io ip ni ir is it nj iv iw ix nk iz ja jb jc hb bi translated"><em class="hi">好的让我们用一个例子来理解如何解决。</em></p></blockquote><p id="f713" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">假设，我们有<strong class="ih hj">category entity</strong>&amp;<strong class="ih hj">book entity&amp;</strong>a<strong class="ih hj">category with books</strong>关系Pojo来获取所有带有书籍的类别，观察房间表的变化。</p><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="006f" class="oh ke hi nr b be oi oj l ok ny">@Entity(tableName = "category",<br/>        indices = {<br/>                @Index(value = "categoryId", unique = true),<br/>        }<br/>)<br/>class CategoryEntity{<br/>  private int categoryId;<br/>  private String categoryName;<br/>  private String categoryImage;<br/>  private Long createdAt;<br/>  // getter setter<br/>}<br/></span></pre><pre class="pc nq nr oe bn of og bi"><span id="fde2" class="oh ke hi nr b be oi oj l ok ny">@Entity(tableName = "book",<br/>        foreignKeys = @ForeignKey(<br/>                entity = CategoryEntity.class,<br/>                parentColumns = "categoryId",<br/>                childColumns = "categoryId",<br/>                onDelete = CASCADE,<br/>                onUpdate = NO_ACTION<br/>        ),<br/>        indices = {<br/>                @Index(value = "bookId", unique = true),<br/>                @Index(value = "categoryId")<br/>        }<br/>)<br/>class BookEntity{<br/>  private int bookId;<br/>  private int categoryId;<br/>  private String bookName;<br/>  private String bookAuthor;<br/>  private EntityMapType entityMapType = EntityMapType.BOOK;<br/>  // getter setter<br/>}</span></pre><pre class="pc nq nr oe bn of og bi"><span id="768a" class="oh ke hi nr b be oi oj l ok ny">class CategoryWithBooks{<br/><br/>  @Embedded<br/>  private CategoryEntity categoryEntity;<br/><br/>  @Relation(parentColumn = "categoryId",<br/>            entityColumn = "categoryId",<br/>            entity = BookEntity.class<br/><br/>  )<br/>  private List&lt;BookEntity&gt; bookEntities;<br/>  // getter setter<br/>}</span></pre><p id="8fa0" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了<strong class="ih hj">避免</strong>创建嵌套对象，我们可以将所有的<strong class="ih hj">类别对象</strong>映射为一个<strong class="ih hj">book对象</strong>并用类型来区分它。姑且称之为EntityMapType。</p><pre class="je jf jg jh fd nq nr oe bn of og bi"><span id="6baa" class="oh ke hi nr b be oi oj l ok ny">enum EntityMapType { CATEGORY, BOOK }</span></pre><pre class="pc nq nr oe bn of og bi"><span id="af37" class="oh ke hi nr b be oi oj l ok ny">@Transaction<br/>@Query("SELECT * FROM category ORDER BY createdAt DESC")<br/>public abstract LiveData&lt;List&lt;CategoryWithBooks&gt;&gt; getAllCategoryWithBooks();<br/><br/>getViewModel().getAllCategoryWithBooks().observe(getViewLifecycleOwner(), getAllCategoryObserver);<br/><br/>private final Observer&lt;List&lt;CategoryWithBooks&gt;&gt; getAllCategoryObserver = listBaseResource -&gt; {<br/>       <br/>        if (!listBaseResource.isEmpty()) {<br/>            List&lt;Book&gt; bookList = new ArrayList();<br/>            foreach(Category category: listBaseResource){<br/>              Book book = new Book();<br/>              book.setBookId(category.getCategoryId());<br/>              book.setEntityMapType(EntityMapType.CATEGORY);<br/>              ....<br/>              bookList.add(book);<br/>              bookList.addAll(category.getBookEntities())<br/>                <br/>            }<br/>            // plotting recyclerview with BookList Only.<br/>            recyclerView.submitList(bookList);<br/>            // make two view type for recyclerview - TYPE_BOOK &amp; TYPE_CATEGORY<br/>        }<br/>  </span></pre><p id="3313" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">因此，我们可以完全删除嵌套的recyclerview，这肯定会提高性能。<strong class="ih hj">一个缺点是</strong>，正在进行映射计算，这应该比在嵌套的recyclerview中提交列表更不是问题。😄</p><p id="665f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">今天就到这里，回答任何问题和建议..</p><p id="6527" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">谢谢你……梵拉·多哈尔斯</p></div></div>    
</body>
</html>