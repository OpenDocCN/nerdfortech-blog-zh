<html>
<head>
<title>Flutter series — Connecting the spring boot web socket market data (Real time market data)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振系列—连接弹簧靴网络插座市场数据(实时市场数据)</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/flutter-series-connecting-the-spring-boot-web-socket-market-data-real-time-market-data-976a07022109?source=collection_archive---------1-----------------------#2021-06-11">https://medium.com/nerd-for-tech/flutter-series-connecting-the-spring-boot-web-socket-market-data-real-time-market-data-976a07022109?source=collection_archive---------1-----------------------#2021-06-11</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/cf7c72943ce84e232185baa407679688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*6cv0I-UrsV4VnLuWHyyaLA.png"/></div></figure><p id="ef95" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">嗨伙计们。因此，在上一篇教程中，我向你们展示了如何使用 spring boot 应用程序创建 web socket，以便将市场数据实时发送到前端。因此，在本教程中，我将展示如何在我们的 flutter 应用程序中显示这些数据。为了了解到目前为止我们是如何创建我们的 flutter 应用程序的，你可以阅读 flutter 系列的最新帖子。</p><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/spring-boot-series-creating-a-web-socket-to-send-real-time-market-data-ee5273b3204b" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">Spring boot 系列—创建一个 Web 套接字来发送实时市场数据</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨，伙计们，我们已经完成了创建一个很酷的股票市场应用程序，显示真实的股票市场信息…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="jx l jy jz ka jw kb ik jn"/></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/flutter-series-connecting-ui-to-spring-boot-backend-f9874dc3dcd5" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">Flutter 系列—将 UI 连接到 spring boot 后端</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨，伙计们，这是股市应用程序创建教程的最后一个教程。将来如果可能的话，我会努力…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="kc l jy jz ka jw kb ik jn"/></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/flutter-series-implementing-stock-market-watch-list-ui-dccd37a9ef34" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">Flutter 系列—实现股票市场观察列表 UI</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨伙计们。在上一个教程中，我告诉你们，我们将使用 Flutter 来创建一个前端应用程序，以便…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="kd l jy jz ka jw kb ik jn"/></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/flutter-series-creating-the-first-flutter-application-793e5816f816" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">颤振系列——创造第一个颤振应用</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨伙计们。所以在我们的系列教程中，现在你应该已经创建了一个 spring boot 应用程序，它有一个获取股票的端点…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="ke l jy jz ka jw kb ik jn"/></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/spring-boot-series-sending-stock-market-data-in-json-form-cce978a9a90d" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">Spring boot 系列—以 JSON 形式发送股票市场数据</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨伙计们。因此，我们创建了股票数据服务来获取单只股票的数据，在本教程中，我将…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/spring-boot-series-unit-testing-basics-3ce566250465" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">弹簧靴系列—单元测试基础</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嗨伙计们。所以到目前为止，我们已经开发了一个基本的 spring boot 应用程序，它从 Yahoo finance API 获取数据并显示…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="kf l jy jz ka jw kb ik jn"/></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/spring-boot-series-stock-market-data-end-point-356592487254" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">春靴系列—股市数据终点</h2><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div></div></a></div><div class="jk jl ez fb jm jn"><a href="https://billa-code.medium.com/create-the-first-spring-boot-app-4e930d812a22" rel="noopener follow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">创建第一个春季启动应用程序</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">我不打算深入了解许多功能和描述，而只是深入了解 Spring boot 的世界…</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">billa-code.medium.com</p></div></div><div class="jw l"><div class="kg l jy jz ka jw kb ik jn"/></div></div></a></div><p id="a30c" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">您可能还记得我们以前的教程，我们创建了一个名为 HomePage 的类，然后在其中显示了 StockList 类，以显示从 Rest API 获取的股票数据。因此，在本教程中，我将在一个名为 home_stock_socket.dart 的文件中创建一个名为 HomeStockSocket 的新类。</p><p id="79c8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">因此，首先我们必须安装这项任务所需的依赖项。这里我们需要在我们的应用程序中有 StompCLient，所以我们必须将 stomp_dart_client 添加到我们的应用程序中。现在 pubsec.yaml 文件中的依赖部分会是这样的。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="7240" class="kq kr hi km b fi ks kt l ku kv">dependencies:<br/>     http: "0.13.3"<br/>     stomp_dart_client: ^0.3.8<br/>     intl: ^0.16.1<br/>     flutter:<br/>         sdk: flutter</span></pre><p id="6ffb" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以 HomeStockSocket 类被创建为有状态类，因为我们在状态中使用 stockList，所以来自 web socket 的更改应用于我们的 StockList 类。我们在 stateful 类的 initState()中连接到 web 套接字，在 onConnect 方法中我们订阅了<strong class="io hj"> /topic/message </strong>，然后我们向<strong class="io hj"> /app/hello </strong>发送消息。现在，web socket 将被触发，股票数据将使用调度程序以 2 秒的间隔实时发送。因此，我们将每 2 秒钟获得一次市场数据反馈到前端。如果你看一下上一个教程，你会看到我们已经创建了一个线程池，并在调度器中使用它，这样我们的后端就不会耗尽资源和崩溃。</p><p id="a7d8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">home_stock_socket.dart 的代码如下。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6571" class="kq kr hi km b fi ks kt l ku kv">import 'package:flutter/material.dart';<br/>import 'package:stock_ui/stock.dart';<br/>import 'package:stock_ui/stock_list.dart';<br/>import 'package:intl/intl.dart';<br/>import 'package:stomp_dart_client/stomp.dart';<br/>import 'package:stomp_dart_client/stomp_config.dart';<br/>import 'package:stomp_dart_client/stomp_frame.dart';<br/>import 'dart:convert';</span><span id="bf6e" class="kq kr hi km b fi kw kt l ku kv">class HomeStockSocket extends StatefulWidget {<br/>  HomeStockSocket({Key key, this.title}) : super(key: key);</span><span id="f6df" class="kq kr hi km b fi kw kt l ku kv">final String title;</span><span id="d6b7" class="kq kr hi km b fi kw kt l ku kv"><a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  _MyHomePageState createState() =&gt; _MyHomePageState();<br/>}</span><span id="d3b3" class="kq kr hi km b fi kw kt l ku kv">class _MyHomePageState extends State&lt;HomeStockSocket&gt; {<br/>  StompClient stompClient;<br/>  final socketUrl = '<a class="ae kx" href="http://localhost:8080/ws-message'" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/ws-message'</a>;</span><span id="90de" class="kq kr hi km b fi kw kt l ku kv">String message = '';<br/>  List&lt;Stock&gt; stockList;</span><span id="d216" class="kq kr hi km b fi kw kt l ku kv">void onConnect(StompClient client, StompFrame frame) {<br/>    client.subscribe(<br/>        destination: '/topic/message',<br/>        callback: (StompFrame frame) {<br/>          if (frame.body != null) {<br/>            Map&lt;String, dynamic&gt; obj = json.decode(frame.body);<br/>            List&lt;Stock&gt; stocks = new List&lt;Stock&gt;();</span><span id="f09c" class="kq kr hi km b fi kw kt l ku kv">for (int i = 0; i &lt; obj['stock'].length; i++) {<br/>              Stock stock = new Stock(<br/>                  company: obj['stock'][i]['name'],<br/>                  symbol: obj['stock'][i]['symbol'],<br/>                  price: obj['stock'][i]['price'],<br/>                  chg: obj['stock'][i]['chg']);<br/>              stocks.add(stock);<br/>            }</span><span id="3e35" class="kq kr hi km b fi kw kt l ku kv">setState(() =&gt; stockList = stocks);<br/>          }<br/>        });</span><span id="f4d1" class="kq kr hi km b fi kw kt l ku kv">client.send(destination: '/app/hello', body: "dimuthu");<br/>  }</span><span id="3c3a" class="kq kr hi km b fi kw kt l ku kv"><a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  void initState() {<br/>    super.initState();</span><span id="ac74" class="kq kr hi km b fi kw kt l ku kv">if (stompClient == null) {<br/>      stompClient = StompClient(<br/>          config: StompConfig.SockJS(<br/>        url: socketUrl,<br/>        onConnect: onConnect,<br/>        onWebSocketError: (dynamic error) =&gt; print(error.toString()),<br/>      ));</span><span id="f88a" class="kq kr hi km b fi kw kt l ku kv">stompClient.activate();<br/>    }<br/>  }</span><span id="e616" class="kq kr hi km b fi kw kt l ku kv"><a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>        body: Stack(children: &lt;Widget&gt;[<br/>      Container(<br/>        padding: EdgeInsets.all(15),<br/>        width: MediaQuery.of(context).size.width,<br/>        color: Colors.black,<br/>        child: SafeArea(<br/>          child: Column(<br/>            crossAxisAlignment: CrossAxisAlignment.start,<br/>            children: &lt;Widget&gt;[<br/>              Row(<br/>                children: &lt;Widget&gt;[<br/>                  Expanded(<br/>                    flex: 1,<br/>                    child: Text(<br/>                      "Watch List",<br/>                      style: TextStyle(<br/>                          color: Colors.white,<br/>                          fontSize: 30,<br/>                          fontWeight: FontWeight.bold),<br/>                    ),<br/>                  ),<br/>                  Expanded(<br/>                    flex: 1,<br/>                    child: Text(<br/>                      DateFormat('dd MMMM yyyy').format(DateTime.now()),<br/>                      textAlign: TextAlign.right,<br/>                      style: TextStyle(<br/>                          color: Colors.grey[500],<br/>                          fontSize: 24,<br/>                          fontWeight: FontWeight.bold),<br/>                    ),<br/>                  ),<br/>                ],<br/>              ),<br/>              Column(<br/>                crossAxisAlignment: CrossAxisAlignment.stretch,<br/>                children: [<br/>                  Text(<br/>                    DateFormat().add_jm().format(DateTime.now()),<br/>                    textAlign: TextAlign.right,<br/>                    style: TextStyle(<br/>                        color: Colors.grey[500],<br/>                        fontSize: 24,<br/>                        fontWeight: FontWeight.bold),<br/>                  ),<br/>                ],<br/>              ),<br/>              Padding(<br/>                padding: const EdgeInsets.only(top: 8),<br/>                child: SizedBox(<br/>                  height: 50,<br/>                  child: TextField(<br/>                    decoration: InputDecoration(<br/>                        hintStyle: TextStyle(color: Colors.grey[500]),<br/>                        hintText: "Search",<br/>                        prefix: Icon(Icons.search),<br/>                        fillColor: Colors.grey[800],<br/>                        filled: true,<br/>                        border: OutlineInputBorder(<br/>                            borderSide:<br/>                                BorderSide(width: 0, style: BorderStyle.none),<br/>                            borderRadius:<br/>                                BorderRadius.all(Radius.circular(16)))),<br/>                  ),<br/>                ),<br/>              ),<br/>              Padding(<br/>                padding: const EdgeInsets.only(top: 15),<br/>                child: SizedBox(<br/>                    height: MediaQuery.of(context).size.height - 310,<br/>                    child: StockList(<br/>                      stocks: stockList,<br/>                    )),<br/>              )<br/>            ],<br/>          ),<br/>        ),<br/>      )<br/>    ]));<br/>  }</span><span id="c172" class="kq kr hi km b fi kw kt l ku kv"><a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  void dispose() {<br/>    if (stompClient != null) {<br/>      stompClient.deactivate();<br/>    }</span><span id="27fe" class="kq kr hi km b fi kw kt l ku kv">super.dispose();<br/>  }<br/>}</span></pre><p id="d8b8" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在，我们必须将它添加到 main.dart 文件中，并替换之前显示的 HomePage 类。现在 main.dart 文件的代码如下所示。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6998" class="kq kr hi km b fi ks kt l ku kv">import 'package:flutter/material.dart';<br/>import 'package:stock_ui/home_stock_socket.dart';</span><span id="70e5" class="kq kr hi km b fi kw kt l ku kv">void main() {<br/>  runApp(MyApp());<br/>}</span><span id="7dc1" class="kq kr hi km b fi kw kt l ku kv">class MyApp extends StatelessWidget {<br/>  // This widget is the root of your application.<br/>  <a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Demo',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.blue,<br/>      ),<br/>      home: HomeStockSocket(title: 'Flutter Demo Home Page'),<br/>    );<br/>  }<br/>}</span></pre><p id="748d" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">一开始，Flutter app 会给出一个错误，因为 stockList 一开始就是空的。为了处理这个问题，我修改了 stock_list.dart 文件，如下所示。</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="78af" class="kq kr hi km b fi ks kt l ku kv">import 'package:flutter/material.dart';<br/>import 'package:stock_ui/stock.dart';</span><span id="e8cb" class="kq kr hi km b fi kw kt l ku kv">class StockList extends StatelessWidget {<br/>  final List&lt;Stock&gt; stocks;</span><span id="ca28" class="kq kr hi km b fi kw kt l ku kv">StockList({this.stocks});</span><span id="9243" class="kq kr hi km b fi kw kt l ku kv"><a class="ae kx" href="http://twitter.com/override" rel="noopener ugc nofollow" target="_blank">@override</a><br/>  Widget build(BuildContext context) {<br/>    return ListView.separated(<br/>      separatorBuilder: (context, index) {<br/>        return Divider(color: Colors.grey[400]);<br/>      },<br/>      itemCount: stocks != null ? stocks.length : 0,<br/>      itemBuilder: (context, index) {<br/>        final stock = stocks[index];<br/>        bool isChgNegative = true;</span><span id="b3d9" class="kq kr hi km b fi kw kt l ku kv">if (double.parse(stock.chg) &gt; 0) {<br/>          isChgNegative = false;<br/>        }</span><span id="ca7f" class="kq kr hi km b fi kw kt l ku kv">return ListTile(<br/>          contentPadding: EdgeInsets.all(10),<br/>          title: Column(<br/>              crossAxisAlignment: CrossAxisAlignment.start,<br/>              children: &lt;Widget&gt;[<br/>                Text("${stock.symbol}",<br/>                    style: TextStyle(<br/>                        color: Colors.white,<br/>                        fontSize: 24,<br/>                        fontWeight: FontWeight.w500)),<br/>                Text("${stock.company}",<br/>                    style: TextStyle(color: Colors.white, fontSize: 20))<br/>              ]),<br/>          trailing: Column(<br/>            crossAxisAlignment: CrossAxisAlignment.end,<br/>            children: &lt;Widget&gt;[<br/>              Text(<br/>                "\$${stock.price}",<br/>                style: TextStyle(<br/>                    color: Colors.white,<br/>                    fontSize: 24,<br/>                    fontWeight: FontWeight.w500),<br/>              ),<br/>              Container(<br/>                alignment: Alignment.center,<br/>                width: 75,<br/>                height: 20,<br/>                decoration: BoxDecoration(<br/>                    borderRadius: BorderRadius.circular(5),<br/>                    color: isChgNegative ? Colors.red : Colors.green),<br/>                child: Text(<br/>                  "${stock.chg}%",<br/>                  style: TextStyle(<br/>                    color: Colors.white,<br/>                    fontSize: 15,<br/>                  ),<br/>                ),<br/>              )<br/>            ],<br/>          ),<br/>        );<br/>      },<br/>    );<br/>  }<br/>}</span></pre><p id="fdd2" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">现在让我们使用，</p><pre class="kh ki kj kk fd kl km kn ko aw kp bi"><span id="6771" class="kq kr hi km b fi ks kt l ku kv">flutter run -d chrome --web-port 8000</span></pre><p id="209b" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated"><strong class="io hj">请记得运行我们上次创建的 spring boot 应用程序，以获取实时市场数据。</strong></p><p id="b779" class="pw-post-body-paragraph im in hi io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj hb bi translated">所以伙计们喜欢你用雅虎财经 API 制作的实时市场数据应用，spring boot 和 Flutter。因此，从本教程我将结束这个股票市场应用程序的开发。在下一个教程中，让我们从基础开始创建另一个很酷的应用程序。所以下次再见，快乐的编码伙计们！！！。</p><div class="jk jl ez fb jm jn"><a href="https://www.buymeacoffee.com/billacode" rel="noopener  ugc nofollow" target="_blank"><div class="jo ab dw"><div class="jp ab jq cl cj jr"><h2 class="bd hj fi z dy js ea eb jt ed ef hh bi translated">迪穆图·维克拉马那亚克</h2><div class="ju l"><h3 class="bd b fi z dy js ea eb jt ed ef dx translated">嘿，我是你的科技博客比拉代码。你可以在这里给我买杯咖啡。</h3></div><div class="jv l"><p class="bd b fp z dy js ea eb jt ed ef dx translated">www.buymeacoffee.com</p></div></div><div class="jw l"><div class="ky l jy jz ka jw kb ik jn"/></div></div></a></div></div></div>    
</body>
</html>