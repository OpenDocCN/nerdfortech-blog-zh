<html>
<head>
<title>Taming a Herd of Spreadsheets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">驯服一群电子表格</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/taming-a-herd-of-spreadsheets-b8d05d06d88d?source=collection_archive---------26-----------------------#2021-04-19">https://medium.com/nerd-for-tech/taming-a-herd-of-spreadsheets-b8d05d06d88d?source=collection_archive---------26-----------------------#2021-04-19</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="6945" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">介绍使用操作系统库的生产化 ETL(提取、转换、加载)过程。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ff76db0c5ee80042e4b99025e0933fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3y1a4sHTZvEWjbjN_SxLNg.jpeg"/></div></div></figure><p id="7723" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">厌倦了将多个不同电子表格中的数据复制粘贴到一个 Excel 文档中吗？希望有一种方法可以批量自动化这一过程？不要害怕！pandas 数据框架和操作系统库的简单组合可以节省您的时间，更不用说减少手动数据输入导致的人为错误了。</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><h1 id="87a0" class="jw jx hi bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">Python 操作系统模块</h1><p id="e58a" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">Python 的<a class="ae kz" href="https://docs.python.org/3/library/os.html" rel="noopener ugc nofollow" target="_blank"> OS 库</a>允许开发者以许多与使用命令行相同的方式与他们的操作系统交互。它提供了许多有用的功能来创建和删除文件夹，检索它们的内容，以及导航系统的文件目录。出于本示例的目的，我们将使用以下命令:</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="729f" class="lf jx hi lb b fi lg lh l li lj"><strong class="lb hj">import</strong> <strong class="lb hj">pandas</strong> <strong class="lb hj">as</strong> <strong class="lb hj">pd</strong><br/><strong class="lb hj">import</strong> <strong class="lb hj">numpy</strong> <strong class="lb hj">as</strong> <strong class="lb hj">np</strong><br/><strong class="lb hj">import</strong> <strong class="lb hj">os</strong></span><span id="f1cd" class="lf jx hi lb b fi lk lh l li lj"># Generate a list of the files in a folder<br/>os.listdir('FOLDER_NAME')</span><span id="2477" class="lf jx hi lb b fi lk lh l li lj"># Read in an Excel sheet to a pandas dataframe<br/>pd.read_excel('EXCEL_FILE', sheet_name = 'SHEET_NAME')</span><span id="503f" class="lf jx hi lb b fi lk lh l li lj"># Merge pandas dataframes<br/>df1.merge(df2, how='JOIN', on='COLUMN_NAME')</span><span id="d356" class="lf jx hi lb b fi lk lh l li lj"># Create a new folder<br/>os.mkdir('FOLDER_NAME')</span><span id="45c2" class="lf jx hi lb b fi lk lh l li lj"># Write dataframe to csv<br/>merged_df.to_csv('FILE_NAME.csv')</span></pre><p id="8af1" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">在我们开始之前，需要注意的是，这些命令可能偶尔会抛出 OSError 或 FileNotFoundError，所以为了安全起见，您可能需要仔细阅读 Try/Except 语句！</p><h1 id="38d8" class="jw jx hi bd jy jz ll kb kc kd lm kf kg kh ln kj kk kl lo kn ko kp lp kr ks kt bi translated">零售数据集样本</h1><p id="7688" class="pw-post-body-paragraph if ig hi ih b ii ku ik il im kv io ip iq kw is it iu kx iw ix iy ky ja jb jc hb bi translated">在这个演练中，我将使用 Kaggle 上的<a class="ae kz" href="https://www.kaggle.com/manjeetsingh/retaildataset" rel="noopener ugc nofollow" target="_blank">样本零售数据集</a>中的一些电子表格。首先，将当前目录中的所有文件读入一个列表。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="2c0a" class="lf jx hi lb b fi lg lh l li lj">files = os.listdir('.')</span></pre><p id="f33f" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">然后，将每个 excel 文件导入到它自己的数据框架中。如果没有指定 sheetname，pandas 将导入第一张工作表。您可以通过索引(从 0 开始)或工作表名称(“工作表 1”)来引用工作表。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="ba90" class="lf jx hi lb b fi lg lh l li lj">stores = pd.read_excel('stores.xlsx', sheet_name=0)<br/>sales = pd.read_excel('sales.xlsx', sheet_name=0)</span></pre><p id="ebf4" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">接下来，我们将合并“Store”列上的数据帧。与 SQL 类似，您必须指定哪种类型的联接(左联接、右联接、外联接、内联接)以及要联接的列名。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="c1e6" class="lf jx hi lb b fi lg lh l li lj">df_merge = sales.merge(stores, how='left', on='Store')</span></pre><p id="6130" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在我们将按商店解析合并的数据，并为每个商店保存一个新的电子表格。首先，让我们定义一个函数，为每个作为参数传递的商店号返回一个数据帧。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="cba6" class="lf jx hi lb b fi lg lh l li lj">def pull_store(df, store_no):<br/>    return df[df['Store']==store_no]</span></pre><p id="31af" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">让我们也创建一个“输出”文件夹来保存所有这些新文件。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="e795" class="lf jx hi lb b fi lg lh l li lj">os.mkdir('output')</span></pre><p id="4774" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">现在，我们只需要遍历商店编号，保存一个新的。csv 文件复制到每个分组的输出文件夹中。</p><pre class="je jf jg jh fd la lb lc ld aw le bi"><span id="1ac0" class="lf jx hi lb b fi lg lh l li lj">for store in df_merge['Store'].unique():<br/>    store_df = pull_store(df_merge, store)<br/>    store_df.to_csv('output/store_' + str(store) + '.csv')</span></pre><p id="5c74" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">仅此而已！这个循环应该生成 45 个新的。csv 文件放在您刚刚创建的“输出”文件夹中。干得好！</p></div><div class="ab cl jp jq gp jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="hb hc hd he hf"><blockquote class="lq lr ls"><p id="cee9" class="if ig lt ih b ii ij ik il im in io ip lu ir is it lv iv iw ix lw iz ja jb jc hb bi translated">这些脚本可能会变得非常复杂，尤其是当每个 Excel 文件有多个工作表，或者需要将文件名映射到标准命名约定时。</p></blockquote><p id="27b9" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">下面是一个完整的 ETL 脚本示例，用于杂货店销售及其对应的 10 个城市的 PLU 代码:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lx ly l"/></div></figure></div></div>    
</body>
</html>