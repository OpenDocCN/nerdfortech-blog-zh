<html>
<head>
<title>Client Certificate Handling on iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS上的客户端证书处理</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/client-certificate-handling-on-ios-f704d896cccd?source=collection_archive---------2-----------------------#2022-03-05">https://medium.com/nerd-for-tech/client-certificate-handling-on-ios-f704d896cccd?source=collection_archive---------2-----------------------#2022-03-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><p id="f549" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><strong class="ih hj">客户端证书认证</strong>，又称基于证书的相互认证，是指客户端向服务器提供其客户端证书来证明其身份。这作为SSL握手的一部分发生(<em class="jd">可选</em>)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/b8c02b1bd56350c12eb8e13c8e7828fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6rj13QPSw9sPcuGU.png"/></div></div></figure><p id="34fd" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">用户可以通过从Safari中下载、作为电子邮件附件打开以及使用配置描述文件(MDM！).</p><p id="d93b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">完成后，<code class="du jq jr js jt b">SafariViewController</code>或Safari应用程序可以成功打开页面，因为证书在Apple keychain access群组中。</p><p id="9fc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">但是</em>你使用<code class="du jq jr js jt b">URLSession</code>或者<code class="du jq jr js jt b">WKWebView</code>的应用会因为缺少客户端证书而收到HTTP 400响应？！？！</p><p id="39de" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">那是因为…</p><blockquote class="ju jv jw"><p id="a98f" class="if ig jd ih b ii ij ik il im in io ip jx ir is it jy iv iw ix jz iz ja jb jc hb bi translated"><em class="hi">应用程序只能访问它们自己的钥匙串访问群组中的钥匙串项目。这意味着Apple access群组中的项目仅适用于Apple提供的应用程序，如Safari或Mail。</em></p></blockquote><p id="e66b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">解决方法是</p><blockquote class="ju jv jw"><p id="77b4" class="if ig jd ih b ii ij ik il im in io ip jx ir is it jy iv iw ix jz iz ja jb jc hb bi translated"><em class="hi"> …你需要编写代码来导入它们。这通常意味着读入PKCS#12格式的blob，然后使用</em> <a class="ae ka" href="https://developer.apple.com/documentation/security/1396915-secpkcs12import" rel="noopener ugc nofollow" target="_blank"> <em class="hi">证书、密钥和信任服务参考</em> </a> <em class="hi">中记录的函数</em> <code class="du jq jr js jt b"><em class="hi">SecPKCS12Import</em></code> <em class="hi">将blob的内容导入应用程序的钥匙串。</em></p><p id="8e5f" class="if ig jd ih b ii ij ik il im in io ip jx ir is it jy iv iw ix jz iz ja jb jc hb bi translated"><em class="hi">这样，您的新钥匙串项目会与应用程序的钥匙串访问群组一起创建。</em></p></blockquote><p id="b34c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">这个<a class="ae ka" href="https://developer.apple.com/library/archive/qa/qa1745/_index.html" rel="noopener ugc nofollow" target="_blank">说法</a>来自苹果。</p><p id="9c2b" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">需要进行额外的工作。</p><ul class=""><li id="7c6c" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">URLSession: <code class="du jq jr js jt b">URLSessionDelegate</code>是必需的，它实现<code class="du jq jr js jt b"><a class="ae ka" href="https://developer.apple.com/documentation/foundation/nsurlsessiondelegate/1409308-urlsession" rel="noopener ugc nofollow" target="_blank">URLSession:didReceiveChallenge:completionHandler:</a></code>并返回<code class="du jq jr js jt b"><a class="ae ka" href="https://developer.apple.com/documentation/foundation/urlcredential/1418121-init" rel="noopener ugc nofollow" target="_blank">URLCredential</a></code>实例来解决客户端证书认证挑战。</li><li id="7813" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">WKWebView: <code class="du jq jr js jt b">WKNavigationDelegate</code>是必需的，它实现<code class="du jq jr js jt b"><a class="ae ka" href="https://developer.apple.com/documentation/webkit/wknavigationdelegate/1455638-webview" rel="noopener ugc nofollow" target="_blank">webView(_:didReceive:completionHandler:)</a></code>并返回<code class="du jq jr js jt b"><a class="ae ka" href="https://developer.apple.com/documentation/foundation/urlcredential/1418121-init" rel="noopener ugc nofollow" target="_blank">URLCredential</a></code>实例以解决客户端证书认证挑战。</li></ul><p id="c650" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">我创建了一个iOS应用程序来更好地演示这一切。使用这个应用程序以各种方式访问client.badssl.com</p><ul class=""><li id="2a4d" class="kb kc hi ih b ii ij im in iq kd iu ke iy kf jc kg kh ki kj bi translated">URLSession.dataTask</li><li id="c4c6" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">WKWebView</li><li id="6ca3" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">SFSafariViewController</li><li id="d631" class="kb kc hi ih b ii kk im kl iq km iu kn iy ko jc kg kh ki kj bi translated">在Safari中打开链接</li></ul><p id="9d18" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该网站需要有效的用户证书。否则服务器返回HTTP 400。</p><p id="283c" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">为了方便起见，我添加了<code class="du jq jr js jt b">badssl.com-client.p12</code>(从<a class="ae ka" href="http://badssl.com/download" rel="noopener ugc nofollow" target="_blank">badssl.com/download</a>下载)作为捆绑资源。这允许您使用<code class="du jq jr js jt b">URLSession</code>和<code class="du jq jr js jt b">WKWebView</code>用用户证书测试成功认证。</p><p id="8148" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">注意:如果证书不再有效(2023年12月4日到期)，请尝试从badssl.com/download<a class="ae ka" href="http://badssl.com/download" rel="noopener ugc nofollow" target="_blank">下载最新版本。</a></p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="kp kq l"/></div></figure><p id="8dc6" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated">该应用的源代码在GitHub上公开。</p><div class="kr ks ez fb kt ku"><a href="https://github.com/MarcoEidinger/ClientCertificateSwiftDemo" rel="noopener  ugc nofollow" target="_blank"><div class="kv ab dw"><div class="kw ab kx cl cj ky"><h2 class="bd hj fi z dy kz ea eb la ed ef hh bi translated">GitHub-MarcoEidinger/ClientCertificateSwiftDemo:iOS应用程序演示了一个…</h2><div class="lb l"><h3 class="bd b fi z dy kz ea eb la ed ef dx translated">iOS上客户端证书认证的解释和演示…</h3></div><div class="lc l"><p class="bd b fp z dy kz ea eb la ed ef dx translated">github.com</p></div></div><div class="ld l"><div class="le l lf lg lh ld li jo ku"/></div></div></a></div></div><div class="ab cl lj lk gp ll" role="separator"><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo lp"/><span class="lm bw bk ln lo"/></div><div class="hb hc hd he hf"><p id="0b68" class="pw-post-body-paragraph if ig hi ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc hb bi translated"><em class="jd">最初发布于</em><a class="ae ka" href="https://blog.eidinger.info/client-certificate-handling-on-ios" rel="noopener ugc nofollow" target="_blank"><em class="jd">https://blog . ei dinger . info</em></a><em class="jd">。</em></p></div></div>    
</body>
</html>