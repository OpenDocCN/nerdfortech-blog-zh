<html>
<head>
<title>Migrate Data — PostgreSQL to BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迁移数据— PostgreSQL到BigQuery</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/migrate-data-postgresql-to-bigquery-46e731d83958?source=collection_archive---------4-----------------------#2021-02-20">https://medium.com/nerd-for-tech/migrate-data-postgresql-to-bigquery-46e731d83958?source=collection_archive---------4-----------------------#2021-02-20</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/19482085679ec74e9a9ac9b1be17cb91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oltfBrJ_H7gm7SlO_Mj_1A.jpeg"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">转到云</figcaption></figure><p id="92e6" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">PostgreSQL，也称为Postgres，是一个高度稳定的数据库，由开源社区20多年的开发提供支持。是大规模分析数据的流行工具之一。</p><p id="335c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">然而，随着数据量和速度的增加，it需要大量的工作和专业知识来优化并使其在期望的时间内运行分析查询。因此，这可能会直接或间接地影响您的事务工作负载。这就是为什么大多数组织更喜欢使用单独的系统来处理分析工作负载。</p><p id="cb0c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">也许解决方案就在云中。云中的额外优势，如扩展的灵活性、最小的前期成本等。因此，许多公司选择将数据从PostgreSQL转移到BigQuery。</p><p id="3fac" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">这个领域的主要竞争者BigQuery是由Google云平台提供的。BigQuery是一个完全托管的、无服务器的数据仓库，能够对数Pb的数据进行可扩展的分析。它是一个平台即服务(PaaS ),支持使用ANSI SQL进行查询。它还内置了机器学习功能。BigQuery于2010年5月发布，并于2011年11月正式发布。BigQuery。专为业务灵活性而设计的无服务器、高度可扩展且经济高效的多云数据仓库。</p><p id="a9c7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">执行PostgreSQL到BigQuery迁移的方法。</strong></p><figure class="jt ju jv jw fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es js"><img src="../Images/414f4a00d27df67cae7a68397757b426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WV8PBX0ewT0HSD0GLm9CWQ.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">执行PostgreSQL到BigQuery迁移的方法</figcaption></figure><p id="b66c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">我们可以使用命令行从PostgreSQL表和标准文件系统文件中迁移数据，并且可以使用带有SQL函数或PL/pgSQL过程的普通SQL语句，这为提取数据提供了很大的灵活性，可以作为完全转储或增量方式。</p><p id="c9b7" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">上图展示了将Postgres迁移到BigQuery的高级步骤:</p><p id="43fc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">1.从PostgreSQL提取数据</p><p id="11cc" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.选择性地清理和转换数据</p><p id="2d11" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.上传到谷歌云存储(GCS)</p><p id="5c85" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">4.从GCS上传到BigQuery表。</p><p id="b741" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">让我们详细看看每一步。</strong></p><p id="2030" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第一步:数据提取</strong></p><p id="d326" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">Copy命令是在PostgreSQL表和标准文件系统之间移动数据的最有效方式。“复制到”命令将选择查询的结果或表的内容复制到该文件中。</p><blockquote class="jx jy jz"><p id="7a15" class="iu iv ka iw b ix iy iz ja jb jc jd je kb jg jh ji kc jk jl jm kd jo jp jq jr hb bi translated"><em class="hi">将actor复制到' ~Your Folder\actor.csv '中，分隔符为'，' csv头；</em></p></blockquote><p id="a585" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第二步:清理和转换数据。</strong></p><p id="ab46" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">除了为适应业务逻辑而进行的转换之外，在准备提取数据时，还需要记住一些基本的事情。</p><ol class=""><li id="5ff7" class="ke kf hi iw b ix iy jb jc jf kg jj kh jn ki jr kj kk kl km bi translated">BigQuery希望CSV数据采用UTF-8编码。</li><li id="15b9" class="ke kf hi iw b ix kn jb ko jf kp jj kq jn kr jr kj kk kl km bi translated">Postgres和BigQuery之间的列类型略有不同。大多数类型都有等价类型或可转换类型。</li></ol><p id="4e9c" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第三步:上传到谷歌云存储(GCS) </strong></p><ol class=""><li id="d92b" class="ke kf hi iw b ix iy jb jc jf kg jj kh jn ki jr kj kk kl km bi translated">首先，你必须登录你的GCP账户。在左侧边栏中，单击“Storage”并转到浏览器。</li></ol><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ks"><img src="../Images/32c0fc42d1ea6ba84470e0143cf31902.png" data-original-src="https://miro.medium.com/v2/resize:fit:286/format:webp/1*MlykdR6NOIwDgpoQ8ygEeQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">谷歌云存储</figcaption></figure><p id="25fd" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.创建bucket(如果没有),并选择要上传文件的GCS bucket。点击桶。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kt"><img src="../Images/4baac315086d846d8337a11e7ca8b32b.png" data-original-src="https://miro.medium.com/v2/resize:fit:274/format:webp/1*DgsyVMZE3wTCz_eLQX0Dgw.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建存储桶</figcaption></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ku"><img src="../Images/bce3a9321698134c37787c5a337c8840.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*GsWor-RgNa8N0yupOW-CEg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">水桶</figcaption></figure><p id="d81d" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.在bucket details页面中，您必须单击Upload files按钮并从您的系统中选择相关文件。上传完成后，文件将被列在存储桶中。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kv"><img src="../Images/24f71bfb8b7cff5d17d4e1e3fa961d12.png" data-original-src="https://miro.medium.com/v2/resize:fit:708/format:webp/1*KbDJn0VaS0d79qQ4R6KlEg.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">上传文件</figcaption></figure><p id="c5a4" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">步骤4:从GCS上传到BigQuery表</strong></p><p id="80c2" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">您可以使用web控制台用户界面。</p><ol class=""><li id="e181" class="ke kf hi iw b ix iy jb jc jf kg jj kh jn ki jr kj kk kl km bi translated">从左侧面板转到BigQuery控制台。</li></ol><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kw"><img src="../Images/59d3bb65f0e498c5487ec511c7d03169.png" data-original-src="https://miro.medium.com/v2/resize:fit:262/format:webp/1*rTW4ENPhswqDQU3cpKNXYQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">BigQuery</figcaption></figure><p id="8350" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">2.如果数据集不存在，则创建数据集。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kx"><img src="../Images/d47fbe556d6b3ae30a86503dcf423b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*NvrkUasv2vcPwc2mYByk7A.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建数据集</figcaption></figure><p id="9021" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">3.然后“创建表”选项将出现在查询编辑器下方。</p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es ky"><img src="../Images/455bf0d2df7e9fc7405556944ae1b737.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*iMYgRqxR5nMiPuhaq7qf8Q.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">创建表格</figcaption></figure><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es kz"><img src="../Images/ae998045d6be66cf18d27dd484127396.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*RtmgrpLBpyYa8xGoeJY0lQ.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">选择源数据</figcaption></figure><p id="db95" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">BigQuery提供了3个选项来写入现有的表:</p><ol class=""><li id="f4bd" class="ke kf hi iw b ix iy jb jc jf kg jj kh jn ki jr kj kk kl km bi translated">如果为空则写入</li><li id="ce22" class="ke kf hi iw b ix kn jb ko jf kp jj kq jn kr jr kj kk kl km bi translated">追加到表中</li><li id="72a9" class="ke kf hi iw b ix kn jb ko jf kp jj kq jn kr jr kj kk kl km bi translated">覆盖表格。</li></ol><p id="8030" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">第五步:在BigQuery中运行SQL脚本</strong></p><figure class="jt ju jv jw fd ij er es paragraph-image"><div class="er es la"><img src="../Images/64dbc7fbee449051a831a3278fce8728.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*QkDduI6-FTPsOT_NzJ8fhA.png"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">在BigQuery中运行SQL脚本</figcaption></figure><p id="378a" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">在当今这个数据驱动的商业时代，从数据中获取价值应该是快速的，并且摩擦最小。像BigQuery这样的数据仓库可以在这方面发挥极其重要的作用。然而，将数据移动到基于云的平台需要多个步骤，如提取数据、清理/转换数据和上传。它需要大量的工程资源和时间来确保整个过程中数据的正确性和一致性。但这相当于利益相关者将获得的利益。</p><p id="1e87" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated"><strong class="iw hj">结论</strong></p><p id="1972" class="pw-post-body-paragraph iu iv hi iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr hb bi translated">当今时代，技术发展非常迅速，有许多工具可用于迁移数据。我们建议您探索将数据从PostgreSQL转移到BigQuery的方法，并做出适合您需求的正确选择。</p></div></div>    
</body>
</html>