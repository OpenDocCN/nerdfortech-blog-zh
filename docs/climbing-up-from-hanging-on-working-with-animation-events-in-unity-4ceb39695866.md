# 从悬挂中向上爬，在 Unity 中处理动画事件

> 原文：<https://medium.com/nerd-for-tech/climbing-up-from-hanging-on-working-with-animation-events-in-unity-4ceb39695866?source=collection_archive---------9----------------------->

现在我们已经成功地悬挂了我们的角色，我们需要他们爬上去。谢天谢地，mixamo 仍然是一个救生员！

![](img/3da2aadaca0e9f2e79dd7bd014ceeeb1.png)

从这里你知道了训练，下载动画，把它拖到你的场景中，把装备改成人形，应用，复制攀爬动画，把它拖到你的玩家动画目录中。

![](img/64dfcc7b8d3fc16f41bafa4b254c94d8.png)

我们只希望动画发生一次，所以我们不会勾选循环模式。然而，我们将烘焙所有的选项，然后将它拖入动画。

![](img/534536b24c3b7eaf5594b545f93e8481.png)

从悬挂过渡到攀爬，然后创建一个名为 ClimbUp 的新触发器，我们将把过渡的条件设置为触发器。

![](img/018ce839da6310a59ba1e686e10bf38d.png)

如果一切顺利，您的动画将如下所示:

![](img/12715c10ccea63623e2723e89a12a2d5.png)

我发现由于某些原因，Unity 有时不能“点击”你放进去的动画。只是再仔细地重复一遍这些步骤，也许试着改变一些事情。比如，在将动画拖入 animator 组件之前，不要烘焙动画。Unity 可能很挑剔，只要坚持下去，你就会让它发挥作用。

我们现在将实现代码。这里有一个额外的挑战，因为当玩家爬上平台时，我们的控制器保持不动。

![](img/6723e0b603b04e4038b578508775b2c0.png)

但是让我们开始吧。我们要做的是按 E 让玩家爬上去。这样做很简单，在播放器脚本中，我创建了一个 _isHanging 布尔值，它自动设置为 false。然后我创建了一个名为“CheckOnLedge”的新方法，在更新中调用它。在方法内部，检查 E 是否被按下，一旦发生，触发“ClimbUp”动画，并将 _isHanging 设置为 false。现在的问题是如何在玩家完成攀爬动画后立即触发一个空闲动画。

![](img/ba40c912d0b6767cef62d050f9a29bbd.png)

答案就在动画行为脚本中。选择攀爬动画并创建一个脚本，并将其命名为“ClimbUp_Behaviour”。我们将为它创建一个动画脚本文件夹。

![](img/b2d5421f29c7eb5f10247e6b33445070.png)

当我们打开这个脚本时，它会给我们很多关于如何控制动画的选项，比如 OnStateEnter、OnStateUpdate 和 OnStateExit，这似乎是我们需要的。

![](img/36cb36aa19db0bc3b9faf4d8c818d875.png)

让我们取消 OnStateExit 的注释

![](img/6cb0cb92c35457830152307511cbad64.png)

这里，我们要做两件事:播放空闲的动画和将位置捕捉到完成姿势，最简单的方法是调用播放器内部的方法:

![](img/e05bdb43d1ee67358a5f088747f35b44.png)

首先，我们为播放器制作一个容器，因为动画师位于主播放器对象内部的子对象中，所以我们使用 GetComponentInParent <>来访问播放器脚本，然后我们访问一个名为 FinishedClimbing 的方法，稍后我们将编写该方法:

在玩家脚本中，让我们完成攀爬组件。

![](img/0a6edf6c0a387e7d2f42af52f1832190.png)

所以我们需要做的第一件事很简单，只是从攀爬过渡到空闲…但是有一个警告。

![](img/224afffd22188b09d0b92edb5cdd9d6c.png)

如果我们播放动画，播放器会向下移动，然后又向上弹回。

![](img/8583a89c3adb258e58164ebdd53adcd2.png)

玩家回复到原来的状态！这是为什么呢？让我们来看看编辑器中的播放器:

![](img/ce6fe455dccb3cfb1cd5872add3ef71a.png)

正在发生的事情是有意义的，玩家模型正在离开碰撞器，它根本没有移动，只是在播放攀爬动画。动画播放完毕后，我们将不得不自己找出动画结束后将播放器放在哪里。但首先，让我们移除退出时间并将过渡时间设置为 0，以阻止播放器浮动到原始变换位置:

![](img/3546324983f5cb17671c4a7e74c233ae.png)

太好了！现在玩家会停下来等待下一个姿势的出现。

![](img/944c799905d77266386d59bdc251a05d.png)

创建一个播放器的副本，将它向左移动一点，然后关闭它。

![](img/02875b4011e03c3fd17de945728b520b.png)

现在我们再玩一次游戏，爬上去，打开播放器，我们记下一些数字。

![](img/868398106295658423500f622643455b.png)

当我们的球员悬空时，注意位置是 0.02，67.69 和 123.12。

![](img/7267dc3a93a638ccbc34b83229a29882.png)

接下来，我们将打开复制播放器，将其放在边缘，并记下其位置:. 02，74.37，124.2

然后，我们将减去原始位置，当动画播放完成时，我们将剩下多少添加到我们的变换！

0, 6.68, 1.08

当动画调用 FinishedClimbing 函数时，我们将把这些数字插入到我们的变换中:

![](img/7ba1505a5ff020bec84b54def029c895.png)

只是为了好的衡量，我把 GrabLedge 的 boolean 设置为 false，否则会影响之后的跳转。但是我们将采用当前悬挂变换位置，然后将差异添加到我们站立的位置，当我们启用控制器时，玩家应该站在平台顶部。

所以我们来看看吧！

![](img/5bb9b3bd1f287e35cef1046344f3adf3.png)

现在我们有了一个可以爬上任何壁架的玩家！