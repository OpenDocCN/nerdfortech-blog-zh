<html>
<head>
<title>Android’s WebView Common Challenges and It’s Solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android的WebView常见挑战及其解决方案</h1>
<blockquote>原文：<a href="https://medium.com/nerd-for-tech/androids-webview-common-challenges-and-it-s-solution-part-1-9b970b95a482?source=collection_archive---------1-----------------------#2021-12-05">https://medium.com/nerd-for-tech/androids-webview-common-challenges-and-it-s-solution-part-1-9b970b95a482?source=collection_archive---------1-----------------------#2021-12-05</a></blockquote><div><div class="ds gw gx gy gz ha"/><div class="hb hc hd he hf"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es if"><img src="../Images/138fa49a7a7298376a436291896e768b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*a3VQi-wKmja0Leiy"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">丹尼尔·罗梅罗在<a class="ae iu" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄的照片</figcaption></figure><p id="edd9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">在Android开发中，我们经常会遇到一个网页被加载到我们的应用程序中，并在应用程序中的嵌入式网页和原生页面之间进行交互。这是由谷歌团队使用Android的<code class="du jt ju jv jw b">WebView</code>实现的。根据谷歌在Android开发者文档中的说法，<code class="du jt ju jv jw b">WebView</code>类是Android的<code class="du jt ju jv jw b"><a class="ae iu" href="https://developer.android.com/reference/android/view/View" rel="noopener ugc nofollow" target="_blank">View</a></code>类的扩展，允许你将网页显示为活动布局的一部分。所以基本上你可以在一个XML布局中包含<code class="du jt ju jv jw b">WebView</code>布局，然后加载一个URL显示给用户。</p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">XML格式的Webview</figcaption></figure><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">在MainActivity.kt中加载URL</figcaption></figure><figure class="jx jy jz ka fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/0b1ecd90e8114ac751d081663776d5a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1316/format:webp/1*EOQMGDL7IUITrcdBWxTuPg.png"/></div></div><figcaption class="iq ir et er es is it bd b be z dx translated">结果</figcaption></figure><p id="5dae" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">公平地说，使用<code class="du jt ju jv jw b">WebView</code>非常简单，但是Android的<code class="du jt ju jv jw b">WebView</code>可能会比我们之前想象的更加复杂。在以下情况下，事情可能会变得更加复杂:</p><ol class=""><li id="7102" class="ke kf hi ix b iy iz jc jd jg kg jk kh jo ki js kj kk kl km bi translated">当<code class="du jt ju jv jw b">WebView</code>开始加载一个URL时，显示闪烁的加载或加载对话框，直到它完成加载网页。</li><li id="2969" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated">如果本地应用程序支持从<code class="du jt ju jv jw b">WebView</code>重定向的任何URL，则重定向到本地页面。</li><li id="c249" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated"><code class="du jt ju jv jw b">WebView’s</code>崩溃时的错误处理。</li></ol><p id="41a9" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">现在，我们将在Android中使用<code class="du jt ju jv jw b">WebView</code>解决上述常见挑战。为了能够应对这些挑战，我们可能需要使用由<code class="du jt ju jv jw b">WebView</code>提供的<code class="du jt ju jv jw b">WebViewClient</code>。<code class="du jt ju jv jw b">WebViewClient </code>基本上是一个类，它使得任何<code class="du jt ju jv jw b">WebView’s</code>回调都有可能让我们覆盖或监听<code class="du jt ju jv jw b">WebView</code>行为。这些常见的挑战可以通过使用<code class="du jt ju jv jw b">WebViewClient</code>来解决。我们需要做的第一件事是创建一个<code class="du jt ju jv jw b">WebViewClient</code>并将其设置到我们的<code class="du jt ju jv jw b">WebView</code>中。</p><p id="e235" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">下面是代码片段。</p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div><figcaption class="iq ir et er es is it bd b be z dx translated">Webview中的WebviewClient</figcaption></figure><p id="d128" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">正如我们在这里看到的，<code class="du jt ju jv jw b">WebViewClient</code>给了我们很多选项来处理来自<code class="du jt ju jv jw b">WebView</code>的回调。正如我在上面分享的，这些方法中的一些将会解决我们遇到的一些挑战。但在开始之前，我要解释一下代码中的一些方法及其用法:</p><ol class=""><li id="6082" class="ke kf hi ix b iy iz jc jd jg kg jk kh jo ki js kj kk kl km bi translated"><code class="du jt ju jv jw b">onPageStarted</code>方法是在<code class="du jt ju jv jw b">WebView</code>开始加载网页期间触发的回调方法。我们可以使用这个回调来开始闪烁或任何本地加载行为来告诉用户等待，直到网页完成加载。</li><li id="f21b" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated"><code class="du jt ju jv jw b">onPageFinished</code>方法与<code class="du jt ju jv jw b">onPageStarted</code>用法相反。此方法在<code class="du jt ju jv jw b">WebView</code>完成加载时触发。如前所述，我们在<code class="du jt ju jv jw b">onPageStarted</code>开始加载，然后我们可以在这里忽略闪烁或其他加载。<code class="du jt ju jv jw b">onPageStarted</code>和<code class="du jt ju jv jw b">onPageFinished</code>方法对于我们处理本地加载行为非常有用，这样用户就不需要在等待页面加载时看到空白的加载页面。</li><li id="dde1" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated"><code class="du jt ju jv jw b">shouldOverrideUrlLoading</code>方法是当<code class="du jt ju jv jw b">WebView</code>试图加载URL时从<code class="du jt ju jv jw b">WebView</code>触发的回调方法。有时当<code class="du jt ju jv jw b">WebView</code>重定向到另一个网页时会发生这种情况。这里是关于<code class="du jt ju jv jw b">shouldOverrideUrlLoading</code>的伟大之处，正如你所看到的，这个方法期望我们返回一个<code class="du jt ju jv jw b">Boolean</code>。一个<code class="du jt ju jv jw b">Boolean</code>返回类型给了我们一个权限，允许或取消在我们的<code class="du jt ju jv jw b">WebView</code>中加载另一个URL。为了允许加载URL，我们可以返回true或其他值。该方法主要用于检查URL是否支持在本地页面中打开，如果支持，我们可以启动一个新活动并在<code class="du jt ju jv jw b">shouldOverrideUrlLoading</code>方法中返回<code class="du jt ju jv jw b">true</code>。这种方法肯定可以用来解决从<code class="du jt ju jv jw b">WebView</code>加载本地页面支持的URL时打开本地页面的需求。</li><li id="f198" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated"><code class="du jt ju jv jw b">onReceivedHttpError</code>方法帮助我们在有任何API或资源错误时接收回调，特别是≥ 400 HTTP状态代码。我们在这里可以使用的用例是显示或处理任何本机错误处理，如显示toast来告诉用户网页中有错误，并期望他们刷新或任何其他错误处理。</li><li id="7d8f" class="ke kf hi ix b iy kn jc ko jg kp jk kq jo kr js kj kk kl km bi translated"><code class="du jt ju jv jw b">onRenderProcessGone</code>方法通知我们<code class="du jt ju jv jw b">WebView</code>的渲染进程已经退出，这意味着<code class="du jt ju jv jw b">WebView</code>应该被有计划地处理和清理，因为我们不能在崩溃的<code class="du jt ju jv jw b">WebView</code>中加载任何URL。我们可以关闭<code class="du jt ju jv jw b">WebView’s</code>活动并告诉用户重新打开它，或者我们从视图层次结构中移除<code class="du jt ju jv jw b">WebView</code>类并以编程方式重新添加它以继续使用<code class="du jt ju jv jw b">WebView</code>。我们应该注意的一点是，<code class="du jt ju jv jw b">WebView</code>引擎可以在多个活动中共享，因此<code class="du jt ju jv jw b">onRenderProcessGone</code>可以在托管这些共享的<code class="du jt ju jv jw b">WebView</code>引擎的多个活动中被调用，而<code class="du jt ju jv jw b">onRenderProcessGone</code>方法仅在Android的API 26及以上版本中可用。<code class="du jt ju jv jw b">onRenderProcessGone</code>方法使我们能够优雅地处理<code class="du jt ju jv jw b">WebView</code>中的<code class="du jt ju jv jw b">WebView</code>崩溃。</li></ol><p id="b51b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">我们已经演练了一些可以在<code class="du jt ju jv jw b">WebViewClient</code>使用的方法。让我们看看常见的挑战，并尝试使用我们从<code class="du jt ju jv jw b">WebViewClient</code>功能中获得的知识来解决这些挑战。</p><ol class=""><li id="9516" class="ke kf hi ix b iy iz jc jd jg kg jk kh jo ki js kj kk kl km bi translated">当<code class="du jt ju jv jw b">WebView</code>开始加载URL时显示闪烁或加载对话框，直到完成网页加载。</li></ol><p id="0b45" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了解决这个挑战，我们可以使用<code class="du jt ju jv jw b">WebViewClient</code>中的<code class="du jt ju jv jw b">onPageStarted</code>和<code class="du jt ju jv jw b">onPageFinished</code>方法作为触发器，在每次页面加载时显示加载和隐藏加载。我们还可以使用这个回调来跟踪<code class="du jt ju jv jw b">WebView</code>完全加载页面需要多长时间。</p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div></figure><p id="4f47" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">2.如果有任何从本地应用程序支持的<code class="du jt ju jv jw b">WebView</code>重定向的URL，重定向到本地页面。</p><p id="3cc2" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">为了检测和拦截来自<code class="du jt ju jv jw b">WebView</code>的任何重定向，我们可以使用<code class="du jt ju jv jw b">shouldOverrideUrlLoading</code>，如果支持重定向到原生页面，则返回true，以便<code class="du jt ju jv jw b">WebView</code>停止网页中的URL重定向并停留在当前页面。</p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div></figure><p id="2d9b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">3.<code class="du jt ju jv jw b">WebView’s</code>崩溃时的错误处理。</p><p id="bc6b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">发动机可能死机是常有的事。当<code class="du jt ju jv jw b">WebView</code>崩溃时，它会将崩溃传播到应用程序，并停止应用程序运行，导致用户体验不佳。为了优雅地处理这个崩溃，我们可以使用<code class="du jt ju jv jw b">onRenderProcessGone</code>来监听<code class="du jt ju jv jw b">WebView’s</code>渲染崩溃事件并重新创建<code class="du jt ju jv jw b">WebView</code>。</p><figure class="jx jy jz ka fd ij"><div class="bz dy l di"><div class="kb kc l"/></div></figure><p id="706b" class="pw-post-body-paragraph iv iw hi ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js hb bi translated">这就是Android的WebView中的常见挑战。请继续关注我的下一篇关于<code class="du jt ju jv jw b">WebView</code>的文章，它将讨论使用<code class="du jt ju jv jw b">JavascriptInterface</code>和<code class="du jt ju jv jw b">evaluateJavascript</code>在Web应用和Android的<code class="du jt ju jv jw b">WebView</code>之间传递数据和交互。谢谢你。</p></div></div>    
</body>
</html>